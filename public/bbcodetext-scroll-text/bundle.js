(()=>{var Ke=Object.defineProperty,fn=Object.prototype.hasOwnProperty,gb=(a,b)=>()=>(b||(b={exports:{}},a(b.exports,b)),b.exports),gn=a=>Ke(a,"__esModule",{value:!0}),Vb=(a,b)=>{gn(a);for(var c in b)Ke(a,c,{get:b[c],enumerable:!0})},Qp=(a,b)=>{gn(a);if(typeof b==="object"||typeof b==="function")for(let c in b)fn.call(b,c)&&!fn.call(a,c)&&c!=="default"&&Ke(a,c,{get:()=>b[c],enumerable:!0});return a},Ka=a=>a&&a.__esModule?a:Qp(Ke({},"default",{value:a,enumerable:!0}),a);var lj=gb((a,b)=>{!function(c,d){"function"==typeof define&&define.amd?define([],d):"object"==typeof b&&"undefined"!=typeof a?b.exports=d():c.Papa=d()}(a,function c(){"use strict";var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==d?d:{},e=!d.document&&!!d.postMessage,f=e&&/blob:/i.test((d.location||{}).protocol),g={},j=0,i={parse:function(q,r){var h=(r=r||{}).dynamicTyping||!1;K(h)&&(r.dynamicTypingFunction=h,h={});if(r.dynamicTyping=h,r.transform=!!K(r.transform)&&r.transform,r.worker&&i.WORKERS_SUPPORTED){var m=function(){if(!i.WORKERS_SUPPORTED)return!1;var p=(o=d.URL||d.webkitURL||null,E=c.toString(),i.BLOB_URL||(i.BLOB_URL=o.createObjectURL(new Blob(["(",E,")();"],{type:"text/javascript"})))),t=new d.Worker(p),o,E;return t.onmessage=L,t.id=j++,g[t.id]=t}();return m.userStep=r.step,m.userChunk=r.chunk,m.userComplete=r.complete,m.userError=r.error,r.step=K(r.step),r.chunk=K(r.chunk),r.complete=K(r.complete),r.error=K(r.error),delete r.worker,void m.postMessage({input:q,config:r,workerId:m.id})}var l=null;return i.NODE_STREAM_INPUT,"string"==typeof q?l=r.download?new u(r):new A(r):!0===q.readable&&K(q.read)&&K(q.on)?l=new C(r):(d.File&&q instanceof File||q instanceof Object)&&(l=new w(r)),l.stream(q)},unparse:function(q,r){var h=!1,m=!0,l=",",p=`\r
`,t='"',o=t+t,E=!1,G=null;!function(){if("object"!=typeof r)return;"string"!=typeof r.delimiter||i.BAD_DELIMITERS.filter(function(B){return-1!==r.delimiter.indexOf(B)}).length||(l=r.delimiter),("boolean"==typeof r.quotes||"function"==typeof r.quotes||Array.isArray(r.quotes))&&(h=r.quotes),"boolean"!=typeof r.skipEmptyLines&&"string"!=typeof r.skipEmptyLines||(E=r.skipEmptyLines),"string"==typeof r.newline&&(p=r.newline),"string"==typeof r.quoteChar&&(t=r.quoteChar),"boolean"==typeof r.header&&(m=r.header);if(Array.isArray(r.columns)){if(0===r.columns.length)throw new Error("Option columns is empty");G=r.columns}void 0!==r.escapeChar&&(o=r.escapeChar+t)}();var X=new RegExp(H(t),"g");"string"==typeof q&&(q=JSON.parse(q));if(Array.isArray(q)){if(!q.length||Array.isArray(q[0]))return Y(null,q,E);if("object"==typeof q[0])return Y(G||z(q[0]),q,E)}else if("object"==typeof q)return"string"==typeof q.data&&(q.data=JSON.parse(q.data)),Array.isArray(q.data)&&(q.fields||(q.fields=q.meta&&q.meta.fields),q.fields||(q.fields=Array.isArray(q.data[0])?q.fields:z(q.data[0])),Array.isArray(q.data[0])||"object"==typeof q.data[0]||(q.data=[q.data])),Y(q.fields||[],q.data||[],E);throw new Error("Unable to serialize unrecognized input");function z(B){if("object"!=typeof B)return[];var J=[];for(var Z in B)J.push(Z);return J}function Y(B,J,Z){var ia="";"string"==typeof B&&(B=JSON.parse(B)),"string"==typeof J&&(J=JSON.parse(J));var na=Array.isArray(B)&&0<B.length,pa=!Array.isArray(J[0]);if(na&&m){for(var ma=0;ma<B.length;ma++)0<ma&&(ia+=l),ia+=M(B[ma],ma);0<J.length&&(ia+=p)}for(var T=0;T<J.length;T++){var ea=na?B.length:J[T].length,ja=!1,ka=na?0===Object.keys(J[T]).length:0===J[T].length;if(Z&&!na&&(ja="greedy"===Z?""===J[T].join("").trim():1===J[T].length&&0===J[T][0].length),"greedy"===Z&&na){for(var P=[],S=0;S<ea;S++){var ga=pa?B[S]:S;P.push(J[T][ga])}ja=""===P.join("").trim()}if(!ja){for(var N=0;N<ea;N++){0<N&&!ka&&(ia+=l);var fa=na&&pa?B[N]:N;ia+=M(J[T][fa],N)}T<J.length-1&&(!Z||0<ea&&!ka)&&(ia+=p)}}return ia}function M(B,J){if(null==B)return"";if(B.constructor===Date)return JSON.stringify(B).slice(1,25);var Z=B.toString().replace(X,o),ia="boolean"==typeof h&&h||"function"==typeof h&&h(B,J)||Array.isArray(h)&&h[J]||function(na,pa){for(var ma=0;ma<pa.length;ma++)if(-1<na.indexOf(pa[ma]))return!0;return!1}(Z,i.BAD_DELIMITERS)||-1<Z.indexOf(l)||" "===Z.charAt(0)||" "===Z.charAt(Z.length-1);return ia?t+Z+t:Z}}};if(i.RECORD_SEP=String.fromCharCode(30),i.UNIT_SEP=String.fromCharCode(31),i.BYTE_ORDER_MARK="ï»¿",i.BAD_DELIMITERS=["\r",`
`,'"',i.BYTE_ORDER_MARK],i.WORKERS_SUPPORTED=!e&&!!d.Worker,i.NODE_STREAM_INPUT=1,i.LocalChunkSize=10485760,i.RemoteChunkSize=5242880,i.DefaultDelimiter=",",i.Parser=Q,i.ParserHandle=F,i.NetworkStreamer=u,i.FileStreamer=w,i.StringStreamer=A,i.ReadableStreamStreamer=C,d.jQuery){var k=d.jQuery;k.fn.parse=function(q){var r=q.config||{},h=[];return this.each(function(p){if(!("INPUT"===k(this).prop("tagName").toUpperCase()&&"file"===k(this).attr("type").toLowerCase()&&d.FileReader)||!this.files||0===this.files.length)return!0;for(var t=0;t<this.files.length;t++)h.push({file:this.files[t],inputElem:this,instanceConfig:k.extend({},r)})}),m(),this;function m(){if(0!==h.length){var p,t,o,E,G=h[0];if(K(q.before)){var X=q.before(G.file,G.inputElem);if("object"==typeof X){if("abort"===X.action)return p="AbortError",t=G.file,o=G.inputElem,E=X.reason,void(K(q.error)&&q.error({name:p},t,o,E));if("skip"===X.action)return void l();"object"==typeof X.config&&(G.instanceConfig=k.extend(G.instanceConfig,X.config))}else if("skip"===X)return void l()}var z=G.instanceConfig.complete;G.instanceConfig.complete=function(Y){K(z)&&z(Y,G.file,G.inputElem),l()},i.parse(G.file,G.instanceConfig)}else K(q.complete)&&q.complete()}function l(){h.splice(0,1),m()}}}function n(q){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(r){var h=V(r);h.chunkSize=parseInt(h.chunkSize),r.step||r.chunk||(h.chunkSize=null),this._handle=new F(h),(this._handle.streamer=this)._config=h}.call(this,q),this.parseChunk=function(r,h){if(this.isFirstChunk&&K(this._config.beforeFirstChunk)){var m=this._config.beforeFirstChunk(r);void 0!==m&&(r=m)}this.isFirstChunk=!1,this._halted=!1;var l=this._partialLine+r;this._partialLine="";var p=this._handle.parse(l,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var t=p.meta.cursor;this._finished||(this._partialLine=l.substring(t-this._baseIndex),this._baseIndex=t),p&&p.data&&(this._rowCount+=p.data.length);var o=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(f)d.postMessage({results:p,workerId:i.WORKER_ID,finished:o});else if(K(this._config.chunk)&&!h){if(this._config.chunk(p,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);p=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(p.data),this._completeResults.errors=this._completeResults.errors.concat(p.errors),this._completeResults.meta=p.meta),this._completed||!o||!K(this._config.complete)||p&&p.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),o||p&&p.meta.paused||this._nextChunk(),p}this._halted=!0},this._sendError=function(r){K(this._config.error)?this._config.error(r):f&&this._config.error&&d.postMessage({workerId:i.WORKER_ID,error:r,finished:!1})}}function u(q){var r;(q=q||{}).chunkSize||(q.chunkSize=i.RemoteChunkSize),n.call(this,q),this._nextChunk=e?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(h){this._input=h,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(r=new XMLHttpRequest(),this._config.withCredentials&&(r.withCredentials=this._config.withCredentials),e||(r.onload=W(this._chunkLoaded,this),r.onerror=W(this._chunkError,this)),r.open(this._config.downloadRequestBody?"POST":"GET",this._input,!e),this._config.downloadRequestHeaders){var h=this._config.downloadRequestHeaders;for(var m in h)r.setRequestHeader(m,h[m])}if(this._config.chunkSize){var l=this._start+this._config.chunkSize-1;r.setRequestHeader("Range","bytes="+this._start+"-"+l)}try{r.send(this._config.downloadRequestBody)}catch(p){this._chunkError(p.message)}e&&0===r.status&&this._chunkError()}},this._chunkLoaded=function(){4===r.readyState&&(r.status<200||400<=r.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:r.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(h){var m=h.getResponseHeader("Content-Range");return null===m?-1:parseInt(m.substring(m.lastIndexOf("/")+1))}(r),this.parseChunk(r.responseText)))},this._chunkError=function(h){var m=r.statusText||h;this._sendError(new Error(m))}}function w(q){var r,h;(q=q||{}).chunkSize||(q.chunkSize=i.LocalChunkSize),n.call(this,q);var m="undefined"!=typeof FileReader;this.stream=function(l){this._input=l,h=l.slice||l.webkitSlice||l.mozSlice,m?((r=new FileReader()).onload=W(this._chunkLoaded,this),r.onerror=W(this._chunkError,this)):r=new FileReaderSync(),this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var l=this._input;if(this._config.chunkSize){var p=Math.min(this._start+this._config.chunkSize,this._input.size);l=h.call(l,this._start,p)}var t=r.readAsText(l,this._config.encoding);m||this._chunkLoaded({target:{result:t}})},this._chunkLoaded=function(l){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(l.target.result)},this._chunkError=function(){this._sendError(r.error)}}function A(q){var r;n.call(this,q=q||{}),this.stream=function(h){return r=h,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var h,m=this._config.chunkSize;return m?(h=r.substring(0,m),r=r.substring(m)):(h=r,r=""),this._finished=!r,this.parseChunk(h)}}}function C(q){n.call(this,q=q||{});var r=[],h=!0,m=!1;this.pause=function(){n.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){n.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(l){this._input=l,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){m&&1===r.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),r.length?this.parseChunk(r.shift()):h=!0},this._streamData=W(function(l){try{r.push("string"==typeof l?l:l.toString(this._config.encoding)),h&&(h=!1,this._checkIsFinished(),this.parseChunk(r.shift()))}catch(p){this._streamError(p)}},this),this._streamError=W(function(l){this._streamCleanUp(),this._sendError(l)},this),this._streamEnd=W(function(){this._streamCleanUp(),m=!0,this._streamData("")},this),this._streamCleanUp=W(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function F(q){var r,h,m,l=Math.pow(2,53),p=-l,t=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)(e[-+]?\d+)?\s*$/,o=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,E=this,G=0,X=0,z=!1,Y=!1,M=[],B={data:[],errors:[],meta:{}};if(K(q.step)){var J=q.step;q.step=function(T){if(B=T,na())ia();else{if(ia(),0===B.data.length)return;G+=T.data.length,q.preview&&G>q.preview?h.abort():(B.data=B.data[0],J(B,E))}}}function Z(T){return"greedy"===q.skipEmptyLines?""===T.join("").trim():1===T.length&&0===T[0].length}function ia(){if(B&&m&&(ma("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+i.DefaultDelimiter+"'"),m=!1),q.skipEmptyLines)for(var T=0;T<B.data.length;T++)Z(B.data[T])&&B.data.splice(T--,1);return na()&&function(){if(!B)return;function ea(ka){K(q.transformHeader)&&(ka=q.transformHeader(ka)),M.push(ka)}if(Array.isArray(B.data[0])){for(var ja=0;na()&&ja<B.data.length;ja++)B.data[ja].forEach(ea);B.data.splice(0,1)}else B.data.forEach(ea)}(),function(){if(!B||!q.header&&!q.dynamicTyping&&!q.transform)return B;function ea(ka,P){var S,ga=q.header?{}:[];for(S=0;S<ka.length;S++){var N=S,fa=ka[S];q.header&&(N=S>=M.length?"__parsed_extra":M[S]),q.transform&&(fa=q.transform(fa,N)),fa=pa(N,fa),"__parsed_extra"===N?(ga[N]=ga[N]||[],ga[N].push(fa)):ga[N]=fa}return q.header&&(S>M.length?ma("FieldMismatch","TooManyFields","Too many fields: expected "+M.length+" fields but parsed "+S,X+P):S<M.length&&ma("FieldMismatch","TooFewFields","Too few fields: expected "+M.length+" fields but parsed "+S,X+P)),ga}var ja=1;return!B.data.length||Array.isArray(B.data[0])?(B.data=B.data.map(ea),ja=B.data.length):B.data=ea(B.data,0),q.header&&B.meta&&(B.meta.fields=M),X+=ja,B}()}function na(){return q.header&&0===M.length}function pa(T,ea){return ja=T,q.dynamicTypingFunction&&void 0===q.dynamicTyping[ja]&&(q.dynamicTyping[ja]=q.dynamicTypingFunction(ja)),!0===(q.dynamicTyping[ja]||q.dynamicTyping)?"true"===ea||"TRUE"===ea||"false"!==ea&&"FALSE"!==ea&&(function(ka){if(t.test(ka)){var P=parseFloat(ka);if(p<P&&P<l)return!0}return!1}(ea)?parseFloat(ea):o.test(ea)?new Date(ea):""===ea?null:ea):ea;var ja}function ma(T,ea,ja,ka){var P={type:T,code:ea,message:ja};void 0!==ka&&(P.row=ka),B.errors.push(P)}this.parse=function(T,ea,ja){var ka=q.quoteChar||'"';if(q.newline||(q.newline=function(ga,N){ga=ga.substring(0,1048576);var fa=new RegExp(H(N)+"([^]*?)"+H(N),"gm"),O=(ga=ga.replace(fa,"")).split("\r"),ua=ga.split(`
`),v=1<ua.length&&ua[0].length<O[0].length;if(1===O.length||v)return`
`;for(var s=0,y=0;y<O.length;y++)`
`===O[y][0]&&s++;return s>=O.length/2?`\r
`:"\r"}(T,ka)),m=!1,q.delimiter)K(q.delimiter)&&(q.delimiter=q.delimiter(T),B.meta.delimiter=q.delimiter);else{var P=function(ga,N,fa,O,ua){var v,s,y,D;ua=ua||[",","	","|",";",i.RECORD_SEP,i.UNIT_SEP];for(var x=0;x<ua.length;x++){var U=ua[x],$=0,_=0,ha=0;y=void 0;for(var da=new Q({comments:O,delimiter:U,newline:N,preview:10}).parse(ga),sa=0;sa<da.data.length;sa++)if(fa&&Z(da.data[sa]))ha++;else{var la=da.data[sa].length;_+=la,void 0!==y?0<la&&($+=Math.abs(la-y),y=la):y=la}0<da.data.length&&(_/=da.data.length-ha),(void 0===s||$<=s)&&(void 0===D||D<_)&&1.99<_&&(s=$,v=U,D=_)}return{successful:!!(q.delimiter=v),bestDelimiter:v}}(T,q.newline,q.skipEmptyLines,q.comments,q.delimitersToGuess);P.successful?q.delimiter=P.bestDelimiter:(m=!0,q.delimiter=i.DefaultDelimiter),B.meta.delimiter=q.delimiter}var S=V(q);return q.preview&&q.header&&S.preview++,r=T,h=new Q(S),B=h.parse(r,ea,ja),ia(),z?{meta:{paused:!0}}:B||{meta:{paused:!1}}},this.paused=function(){return z},this.pause=function(){z=!0,h.abort(),r=K(q.chunk)?"":r.substring(h.getCharIndex())},this.resume=function(){E.streamer._halted?(z=!1,E.streamer.parseChunk(r,!0)):setTimeout(E.resume,3)},this.aborted=function(){return Y},this.abort=function(){Y=!0,h.abort(),B.meta.aborted=!0,K(q.complete)&&q.complete(B),r=""}}function H(q){return q.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Q(q){var r,h=(q=q||{}).delimiter,m=q.newline,l=q.comments,p=q.step,t=q.preview,o=q.fastMode,E=r=void 0===q.quoteChar?'"':q.quoteChar;if(void 0!==q.escapeChar&&(E=q.escapeChar),("string"!=typeof h||-1<i.BAD_DELIMITERS.indexOf(h))&&(h=","),l===h)throw new Error("Comment character same as delimiter");!0===l?l="#":("string"!=typeof l||-1<i.BAD_DELIMITERS.indexOf(l))&&(l=!1),`
`!==m&&"\r"!==m&&`\r
`!==m&&(m=`
`);var G=0,X=!1;this.parse=function(z,Y,M){if("string"!=typeof z)throw new Error("Input must be a string");var B=z.length,J=h.length,Z=m.length,ia=l.length,na=K(p),pa=[],ma=[],T=[],ea=G=0;if(!z)return x();if(o||!1!==o&&-1===z.indexOf(r)){for(var ja=z.split(m),ka=0;ka<ja.length;ka++){if(T=ja[ka],G+=T.length,ka!==ja.length-1)G+=m.length;else if(M)return x();if(!l||T.substring(0,ia)!==l){if(na){if(pa=[],v(T.split(h)),U(),X)return x()}else v(T.split(h));if(t&&t<=ka)return pa=pa.slice(0,t),x(!0)}}return x()}for(var P=z.indexOf(h,G),S=z.indexOf(m,G),ga=new RegExp(H(E)+H(r),"g"),N=z.indexOf(r,G);;)if(z[G]!==r)if(l&&0===T.length&&z.substring(G,G+ia)===l){if(-1===S)return x();G=S+Z,S=z.indexOf(m,G),P=z.indexOf(h,G)}else{if(-1!==P&&(P<S||-1===S)){if(!(P<N)){T.push(z.substring(G,P)),G=P+J,P=z.indexOf(h,G);continue}var fa=$(P,N,S);if(fa&&void 0!==fa.nextDelim){P=fa.nextDelim,N=fa.quoteSearch,T.push(z.substring(G,P)),G=P+J,P=z.indexOf(h,G);continue}}if(-1===S)break;if(T.push(z.substring(G,S)),D(S+Z),na&&(U(),X))return x();if(t&&pa.length>=t)return x(!0)}else for(N=G,G++;;){if(-1===(N=z.indexOf(r,N+1)))return M||ma.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:pa.length,index:G}),y();if(N===B-1)return y(z.substring(G,N).replace(ga,r));if(r!==E||z[N+1]!==E){if(r===E||0===N||z[N-1]!==E){-1!==P&&P<N+1&&(P=z.indexOf(h,N+1)),-1!==S&&S<N+1&&(S=z.indexOf(m,N+1));var O=s(-1===S?P:Math.min(P,S));if(z[N+1+O]===h){T.push(z.substring(G,N).replace(ga,r)),z[G=N+1+O+J]!==r&&(N=z.indexOf(r,G)),P=z.indexOf(h,G),S=z.indexOf(m,G);break}var ua=s(S);if(z.substring(N+1+ua,N+1+ua+Z)===m){if(T.push(z.substring(G,N).replace(ga,r)),D(N+1+ua+Z),P=z.indexOf(h,G),N=z.indexOf(r,G),na&&(U(),X))return x();if(t&&pa.length>=t)return x(!0);break}ma.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:pa.length,index:G}),N++}}else N++}return y();function v(_){pa.push(_),ea=G}function s(_){var ha=0;if(-1!==_){var da=z.substring(N+1,_);da&&""===da.trim()&&(ha=da.length)}return ha}function y(_){return M||(void 0===_&&(_=z.substring(G)),T.push(_),G=B,v(T),na&&U()),x()}function D(_){G=_,v(T),T=[],S=z.indexOf(m,G)}function x(_){return{data:pa,errors:ma,meta:{delimiter:h,linebreak:m,aborted:X,truncated:!!_,cursor:ea+(Y||0)}}}function U(){p(x()),pa=[],ma=[]}function $(_,ha,da){var sa={nextDelim:void 0,quoteSearch:void 0},la=z.indexOf(r,ha+1);if(ha<_&&_<la&&(la<da||-1===da)){var ya=z.indexOf(h,la);if(-1===ya)return sa;la<ya&&(la=z.indexOf(r,la+1)),sa=$(ya,la,da)}else sa={nextDelim:_,quoteSearch:ha};return sa}},this.abort=function(){X=!0},this.getCharIndex=function(){return G}}function L(q){var r=q.data,h=g[r.workerId],m=!1;if(r.error)h.userError(r.error,r.file);else if(r.results&&r.results.data){var l={abort:function(){m=!0,R(r.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:I,resume:I};if(K(h.userStep)){for(var p=0;p<r.results.data.length&&(h.userStep({data:r.results.data[p],errors:r.results.errors,meta:r.results.meta},l),!m);p++);delete r.results}else K(h.userChunk)&&(h.userChunk(r.results,l,r.file),delete r.results)}r.finished&&!m&&R(r.workerId,r.results)}function R(q,r){var h=g[q];K(h.userComplete)&&h.userComplete(r),h.terminate(),delete g[q]}function I(){throw new Error("Not implemented.")}function V(q){if("object"!=typeof q||null===q)return q;var r=Array.isArray(q)?[]:{};for(var h in q)r[h]=V(q[h]);return r}function W(q,r){return function(){q.apply(r,arguments)}}function K(q){return"function"==typeof q}return f&&(d.onmessage=function(q){var r=q.data;void 0===i.WORKER_ID&&r&&(i.WORKER_ID=r.workerId);if("string"==typeof r.input)d.postMessage({workerId:i.WORKER_ID,results:i.parse(r.input,r.config),finished:!0});else if(d.File&&r.input instanceof File||r.input instanceof Object){var h=i.parse(r.input,r.config);h&&d.postMessage({workerId:i.WORKER_ID,results:h,finished:!0})}}),(u.prototype=Object.create(n.prototype)).constructor=u,(w.prototype=Object.create(n.prototype)).constructor=w,(A.prototype=Object.create(A.prototype)).constructor=A,(C.prototype=Object.create(n.prototype)).constructor=C,i})});var _h=gb(q=>{Vb(q,{__assign:()=>c,__asyncDelegator:()=>Q,__asyncGenerator:()=>H,__asyncValues:()=>L,__await:()=>F,__awaiter:()=>j,__classPrivateFieldGet:()=>W,__classPrivateFieldSet:()=>K,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>V,__importStar:()=>I,__makeTemplateObject:()=>R,__metadata:()=>g,__param:()=>f,__read:()=>w,__rest:()=>d,__spread:()=>A,__spreadArrays:()=>C,__values:()=>u});var a=function(h,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,p){l.__proto__=p}||function(l,p){for(var t in p)p.hasOwnProperty(t)&&(l[t]=p[t])},a(h,m)};function b(h,m){a(h,m);function l(){this.constructor=h}h.prototype=m===null?Object.create(m):(l.prototype=m.prototype,new l())}var c=function(){return c=Object.assign||function h(m){for(var l,p=1,t=arguments.length;p<t;p++){l=arguments[p];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(m[o]=l[o])}return m},c.apply(this,arguments)};function d(h,m){var l={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&m.indexOf(p)<0&&(l[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var t=0,p=Object.getOwnPropertySymbols(h);t<p.length;t++)m.indexOf(p[t])<0&&Object.prototype.propertyIsEnumerable.call(h,p[t])&&(l[p[t]]=h[p[t]]);return l}function e(h,m,l,p){var t=arguments.length,o=t<3?m:p===null?p=Object.getOwnPropertyDescriptor(m,l):p,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(h,m,l,p);else for(var G=h.length-1;G>=0;G--)(E=h[G])&&(o=(t<3?E(o):t>3?E(m,l,o):E(m,l))||o);return t>3&&o&&Object.defineProperty(m,l,o),o}function f(h,m){return function(l,p){m(l,p,h)}}function g(h,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,m)}function j(h,m,l,p){function t(o){return o instanceof l?o:new l(function(E){E(o)})}return new(l||(l=Promise))(function(o,E){function G(Y){try{z(p.next(Y))}catch(M){E(M)}}function X(Y){try{z(p.throw(Y))}catch(M){E(M)}}function z(Y){Y.done?o(Y.value):t(Y.value).then(G,X)}z((p=p.apply(h,m||[])).next())})}function i(h,m){var l={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},p,t,o,E;return E={next:G(0),throw:G(1),return:G(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function G(z){return function(Y){return X([z,Y])}}function X(z){if(p)throw new TypeError("Generator is already executing.");for(;l;)try{if(p=1,t&&(o=z[0]&2?t.return:z[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,z[1])).done)return o;(t=0,o)&&(z=[z[0]&2,o.value]);switch(z[0]){case 0:case 1:o=z;break;case 4:return l.label++,{value:z[1],done:!1};case 5:l.label++,t=z[1],z=[0];continue;case 7:z=l.ops.pop(),l.trys.pop();continue;default:if(!(o=l.trys,o=o.length>0&&o[o.length-1])&&(z[0]===6||z[0]===2)){l=0;continue}if(z[0]===3&&(!o||z[1]>o[0]&&z[1]<o[3])){l.label=z[1];break}if(z[0]===6&&l.label<o[1]){l.label=o[1],o=z;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(z);break}o[2]&&l.ops.pop(),l.trys.pop();continue}z=m.call(h,l)}catch(Y){z=[6,Y],t=0}finally{p=o=0}if(z[0]&5)throw z[1];return{value:z[0]?z[1]:void 0,done:!0}}}function k(h,m,l,p){p===void 0&&(p=l),h[p]=m[l]}function n(h,m){for(var l in h)l!=="default"&&!m.hasOwnProperty(l)&&(m[l]=h[l])}function u(h){var m=typeof Symbol==="function"&&Symbol.iterator,l=m&&h[m],p=0;if(l)return l.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function w(h,m){var l=typeof Symbol==="function"&&h[Symbol.iterator];if(!l)return h;var p=l.call(h),t,o=[],E;try{for(;(m===void 0||m-- >0)&&!(t=p.next()).done;)o.push(t.value)}catch(G){E={error:G}}finally{try{t&&!t.done&&(l=p.return)&&l.call(p)}finally{if(E)throw E.error}}return o}function A(){for(var h=[],m=0;m<arguments.length;m++)h=h.concat(w(arguments[m]));return h}function C(){for(var h=0,m=0,l=arguments.length;m<l;m++)h+=arguments[m].length;for(var p=Array(h),t=0,m=0;m<l;m++)for(var o=arguments[m],E=0,G=o.length;E<G;E++,t++)p[t]=o[E];return p}function F(h){return this instanceof F?(this.v=h,this):new F(h)}function H(h,m,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=l.apply(h,m||[]),t,o=[];return t={},E("next"),E("throw"),E("return"),t[Symbol.asyncIterator]=function(){return this},t;function E(B){p[B]&&(t[B]=function(J){return new Promise(function(Z,ia){o.push([B,J,Z,ia])>1||G(B,J)})})}function G(B,J){try{X(p[B](J))}catch(Z){M(o[0][3],Z)}}function X(B){B.value instanceof F?Promise.resolve(B.value.v).then(z,Y):M(o[0][2],B)}function z(B){G("next",B)}function Y(B){G("throw",B)}function M(B,J){(B(J),o.shift(),o.length)&&G(o[0][0],o[0][1])}}function Q(h){var m,l;return m={},p("next"),p("throw",function(t){throw t}),p("return"),m[Symbol.iterator]=function(){return this},m;function p(t,o){m[t]=h[t]?function(E){return(l=!l)?{value:F(h[t](E)),done:t==="return"}:o?o(E):E}:o}}function L(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=h[Symbol.asyncIterator],l;return m?m.call(h):(h=typeof u==="function"?u(h):h[Symbol.iterator](),l={},p("next"),p("throw"),p("return"),l[Symbol.asyncIterator]=function(){return this},l);function p(o){l[o]=h[o]&&function(E){return new Promise(function(G,X){E=h[o](E),t(G,X,E.done,E.value)})}}function t(o,E,G,X){Promise.resolve(X).then(function(z){o({value:z,done:G})},E)}}function R(h,m){return Object.defineProperty?Object.defineProperty(h,"raw",{value:m}):h.raw=m,h}function I(h){if(h&&h.__esModule)return h;var m={};if(h!=null)for(var l in h)Object.hasOwnProperty.call(h,l)&&(m[l]=h[l]);return m.default=h,m}function V(h){return h&&h.__esModule?h:{default:h}}function W(h,m){if(!m.has(h))throw new TypeError("attempted to get private field on non-instance");return m.get(h)}function K(h,m,l){if(!m.has(h))throw new TypeError("attempted to set private field on non-instance");return m.set(h,l),l}});var ci=gb(q=>{Vb(q,{__assign:()=>c,__asyncDelegator:()=>Q,__asyncGenerator:()=>H,__asyncValues:()=>L,__await:()=>F,__awaiter:()=>j,__classPrivateFieldGet:()=>W,__classPrivateFieldSet:()=>K,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>V,__importStar:()=>I,__makeTemplateObject:()=>R,__metadata:()=>g,__param:()=>f,__read:()=>w,__rest:()=>d,__spread:()=>A,__spreadArrays:()=>C,__values:()=>u});var a=function(h,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,p){l.__proto__=p}||function(l,p){for(var t in p)p.hasOwnProperty(t)&&(l[t]=p[t])},a(h,m)};function b(h,m){a(h,m);function l(){this.constructor=h}h.prototype=m===null?Object.create(m):(l.prototype=m.prototype,new l())}var c=function(){return c=Object.assign||function h(m){for(var l,p=1,t=arguments.length;p<t;p++){l=arguments[p];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(m[o]=l[o])}return m},c.apply(this,arguments)};function d(h,m){var l={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&m.indexOf(p)<0&&(l[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var t=0,p=Object.getOwnPropertySymbols(h);t<p.length;t++)m.indexOf(p[t])<0&&Object.prototype.propertyIsEnumerable.call(h,p[t])&&(l[p[t]]=h[p[t]]);return l}function e(h,m,l,p){var t=arguments.length,o=t<3?m:p===null?p=Object.getOwnPropertyDescriptor(m,l):p,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(h,m,l,p);else for(var G=h.length-1;G>=0;G--)(E=h[G])&&(o=(t<3?E(o):t>3?E(m,l,o):E(m,l))||o);return t>3&&o&&Object.defineProperty(m,l,o),o}function f(h,m){return function(l,p){m(l,p,h)}}function g(h,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,m)}function j(h,m,l,p){function t(o){return o instanceof l?o:new l(function(E){E(o)})}return new(l||(l=Promise))(function(o,E){function G(Y){try{z(p.next(Y))}catch(M){E(M)}}function X(Y){try{z(p.throw(Y))}catch(M){E(M)}}function z(Y){Y.done?o(Y.value):t(Y.value).then(G,X)}z((p=p.apply(h,m||[])).next())})}function i(h,m){var l={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},p,t,o,E;return E={next:G(0),throw:G(1),return:G(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function G(z){return function(Y){return X([z,Y])}}function X(z){if(p)throw new TypeError("Generator is already executing.");for(;l;)try{if(p=1,t&&(o=z[0]&2?t.return:z[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,z[1])).done)return o;(t=0,o)&&(z=[z[0]&2,o.value]);switch(z[0]){case 0:case 1:o=z;break;case 4:return l.label++,{value:z[1],done:!1};case 5:l.label++,t=z[1],z=[0];continue;case 7:z=l.ops.pop(),l.trys.pop();continue;default:if(!(o=l.trys,o=o.length>0&&o[o.length-1])&&(z[0]===6||z[0]===2)){l=0;continue}if(z[0]===3&&(!o||z[1]>o[0]&&z[1]<o[3])){l.label=z[1];break}if(z[0]===6&&l.label<o[1]){l.label=o[1],o=z;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(z);break}o[2]&&l.ops.pop(),l.trys.pop();continue}z=m.call(h,l)}catch(Y){z=[6,Y],t=0}finally{p=o=0}if(z[0]&5)throw z[1];return{value:z[0]?z[1]:void 0,done:!0}}}function k(h,m,l,p){p===void 0&&(p=l),h[p]=m[l]}function n(h,m){for(var l in h)l!=="default"&&!m.hasOwnProperty(l)&&(m[l]=h[l])}function u(h){var m=typeof Symbol==="function"&&Symbol.iterator,l=m&&h[m],p=0;if(l)return l.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function w(h,m){var l=typeof Symbol==="function"&&h[Symbol.iterator];if(!l)return h;var p=l.call(h),t,o=[],E;try{for(;(m===void 0||m-- >0)&&!(t=p.next()).done;)o.push(t.value)}catch(G){E={error:G}}finally{try{t&&!t.done&&(l=p.return)&&l.call(p)}finally{if(E)throw E.error}}return o}function A(){for(var h=[],m=0;m<arguments.length;m++)h=h.concat(w(arguments[m]));return h}function C(){for(var h=0,m=0,l=arguments.length;m<l;m++)h+=arguments[m].length;for(var p=Array(h),t=0,m=0;m<l;m++)for(var o=arguments[m],E=0,G=o.length;E<G;E++,t++)p[t]=o[E];return p}function F(h){return this instanceof F?(this.v=h,this):new F(h)}function H(h,m,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=l.apply(h,m||[]),t,o=[];return t={},E("next"),E("throw"),E("return"),t[Symbol.asyncIterator]=function(){return this},t;function E(B){p[B]&&(t[B]=function(J){return new Promise(function(Z,ia){o.push([B,J,Z,ia])>1||G(B,J)})})}function G(B,J){try{X(p[B](J))}catch(Z){M(o[0][3],Z)}}function X(B){B.value instanceof F?Promise.resolve(B.value.v).then(z,Y):M(o[0][2],B)}function z(B){G("next",B)}function Y(B){G("throw",B)}function M(B,J){(B(J),o.shift(),o.length)&&G(o[0][0],o[0][1])}}function Q(h){var m,l;return m={},p("next"),p("throw",function(t){throw t}),p("return"),m[Symbol.iterator]=function(){return this},m;function p(t,o){m[t]=h[t]?function(E){return(l=!l)?{value:F(h[t](E)),done:t==="return"}:o?o(E):E}:o}}function L(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=h[Symbol.asyncIterator],l;return m?m.call(h):(h=typeof u==="function"?u(h):h[Symbol.iterator](),l={},p("next"),p("throw"),p("return"),l[Symbol.asyncIterator]=function(){return this},l);function p(o){l[o]=h[o]&&function(E){return new Promise(function(G,X){E=h[o](E),t(G,X,E.done,E.value)})}}function t(o,E,G,X){Promise.resolve(X).then(function(z){o({value:z,done:G})},E)}}function R(h,m){return Object.defineProperty?Object.defineProperty(h,"raw",{value:m}):h.raw=m,h}function I(h){if(h&&h.__esModule)return h;var m={};if(h!=null)for(var l in h)Object.hasOwnProperty.call(h,l)&&(m[l]=h[l]);return m.default=h,m}function V(h){return h&&h.__esModule?h:{default:h}}function W(h,m){if(!m.has(h))throw new TypeError("attempted to get private field on non-instance");return m.get(h)}function K(h,m,l){if(!m.has(h))throw new TypeError("attempted to set private field on non-instance");return m.set(h,l),l}});var Se=gb(O=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});var a=ci();var b={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};var c=function(v,s){if(!v)throw d(s)},d=function(v){return new Error("Firebase Database ("+b.SDK_VERSION+") INTERNAL ASSERT FAILED: "+v)};var e=function(v){for(var s=[],y=0,D=0;D<v.length;D++){var x=v.charCodeAt(D);x<128?s[y++]=x:x<2048?(s[y++]=x>>6|192,s[y++]=x&63|128):(x&64512)===55296&&D+1<v.length&&(v.charCodeAt(D+1)&64512)===56320?(x=65536+((x&1023)<<10)+(v.charCodeAt(++D)&1023),s[y++]=x>>18|240,s[y++]=x>>12&63|128,s[y++]=x>>6&63|128,s[y++]=x&63|128):(s[y++]=x>>12|224,s[y++]=x>>6&63|128,s[y++]=x&63|128)}return s},f=function(v){for(var s=[],y=0,D=0;y<v.length;){var x=v[y++];if(x<128)s[D++]=String.fromCharCode(x);else if(x>191&&x<224){var U=v[y++];s[D++]=String.fromCharCode((x&31)<<6|U&63)}else if(x>239&&x<365){var U=v[y++],$=v[y++],_=v[y++],ha=((x&7)<<18|(U&63)<<12|($&63)<<6|_&63)-65536;s[D++]=String.fromCharCode(55296+(ha>>10)),s[D++]=String.fromCharCode(56320+(ha&1023))}else{var U=v[y++],$=v[y++];s[D++]=String.fromCharCode((x&15)<<12|(U&63)<<6|$&63)}}return s.join("")},g={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob==="function",encodeByteArray:function(v,s){if(!Array.isArray(v))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var y=s?this.byteToCharMapWebSafe_:this.byteToCharMap_,D=[],x=0;x<v.length;x+=3){var U=v[x],$=x+1<v.length,_=$?v[x+1]:0,ha=x+2<v.length,da=ha?v[x+2]:0,sa=U>>2,la=(U&3)<<4|_>>4,ya=(_&15)<<2|da>>6,Le=da&63;ha||(Le=64,$||(ya=64)),D.push(y[sa],y[la],y[ya],y[Le])}return D.join("")},encodeString:function(v,s){return this.HAS_NATIVE_SUPPORT&&!s?btoa(v):this.encodeByteArray(e(v),s)},decodeString:function(v,s){return this.HAS_NATIVE_SUPPORT&&!s?atob(v):f(this.decodeStringToByteArray(v,s))},decodeStringToByteArray:function(v,s){this.init_();for(var y=s?this.charToByteMapWebSafe_:this.charToByteMap_,D=[],x=0;x<v.length;){var U=y[v.charAt(x++)],$=x<v.length,_=$?y[v.charAt(x)]:0;++x;var ha=x<v.length,da=ha?y[v.charAt(x)]:64;++x;var sa=x<v.length,la=sa?y[v.charAt(x)]:64;++x;if(U==null||_==null||da==null||la==null)throw Error();var ya=U<<2|_>>4;D.push(ya);if(da!==64){var Le=_<<4&240|da>>2;D.push(Le);if(la!==64){var Rp=da<<6&192|la;D.push(Rp)}}}return D},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var v=0;v<this.ENCODED_VALS.length;v++)this.byteToCharMap_[v]=this.ENCODED_VALS.charAt(v),this.charToByteMap_[this.byteToCharMap_[v]]=v,this.byteToCharMapWebSafe_[v]=this.ENCODED_VALS_WEBSAFE.charAt(v),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[v]]=v,v>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(v)]=v,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(v)]=v)}}},j=function(v){var s=e(v);return g.encodeByteArray(s,!0)},i=function(v){try{return g.decodeString(v,!0)}catch(s){console.error("base64Decode failed: ",s)}return null};function k(v){return n(void 0,v)}function n(v,s){if(!(s instanceof Object))return s;switch(s.constructor){case Date:var y=s;return new Date(y.getTime());case Object:v===void 0&&(v={});break;case Array:v=[];break;default:return s}for(var D in s){if(!s.hasOwnProperty(D))continue;v[D]=n(v[D],s[D])}return v}var u=function(){function v(){var s=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(y,D){s.resolve=y,s.reject=D})}return v.prototype.wrapCallback=function(s){var y=this;return function(D,x){D?y.reject(D):y.resolve(x),typeof s==="function"&&(y.promise.catch(function(){}),s.length===1?s(D):s(D,x))}},v}();function w(){return typeof navigator!=="undefined"&&typeof navigator.userAgent==="string"?navigator.userAgent:""}function A(){return typeof window!=="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(w())}function C(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(v){return!1}}function F(){return typeof self==="object"&&self.self===self}function H(){var v=typeof chrome==="object"?chrome.runtime:typeof browser==="object"?browser.runtime:void 0;return typeof v==="object"&&v.id!==void 0}function Q(){return typeof navigator==="object"&&navigator.product==="ReactNative"}function L(){return w().indexOf("Electron/")>=0}function R(){var v=w();return v.indexOf("MSIE ")>=0||v.indexOf("Trident/")>=0}function I(){return w().indexOf("MSAppHost/")>=0}function V(){return b.NODE_CLIENT===!0||b.NODE_ADMIN===!0}function W(){return!C()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}var K="FirebaseError",q=function(v){a.__extends(s,v);function s(y,D){var x=v.call(this,D)||this;return x.code=y,x.name=K,Object.setPrototypeOf(x,s.prototype),Error.captureStackTrace&&Error.captureStackTrace(x,r.prototype.create),x}return s}(Error),r=function(){function v(s,y,D){this.service=s,this.serviceName=y,this.errors=D}return v.prototype.create=function(s){for(var y=[],D=1;D<arguments.length;D++)y[D-1]=arguments[D];for(var x=y[0]||{},U=this.service+"/"+s,$=this.errors[s],_=$?h($,x):"Error",ha=this.serviceName+": "+_+" ("+U+").",da=new q(U,ha),sa=0,la=Object.keys(x);sa<la.length;sa++){var ya=la[sa];ya.slice(-1)!=="_"&&(ya in da&&console.warn('Overwriting FirebaseError base field "'+ya+'" can cause unexpected behavior.'),da[ya]=x[ya])}return da},v}();function h(v,s){return v.replace(m,function(y,D){var x=s[D];return x!=null?String(x):"<"+D+"?>"})}var m=/\{\$([^}]+)}/g;function l(v){return JSON.parse(v)}function p(v){return JSON.stringify(v)}var t=function(v){var s={},y={},D={},x="";try{var U=v.split(".");s=l(i(U[0])||""),y=l(i(U[1])||""),x=U[2],D=y.d||{},delete y.d}catch($){}return{header:s,claims:y,data:D,signature:x}},o=function(v){var s=t(v).claims,y=Math.floor(new Date().getTime()/1e3),D=0,x=0;return typeof s==="object"&&(s.hasOwnProperty("nbf")?D=s.nbf:s.hasOwnProperty("iat")&&(D=s.iat),s.hasOwnProperty("exp")?x=s.exp:x=D+86400),!!y&&!!D&&!!x&&y>=D&&y<=x},E=function(v){var s=t(v).claims;return typeof s==="object"&&s.hasOwnProperty("iat")?s.iat:null},G=function(v){var s=t(v),y=s.claims;return!!y&&typeof y==="object"&&y.hasOwnProperty("iat")},X=function(v){var s=t(v).claims;return typeof s==="object"&&s.admin===!0};function z(v,s){return Object.prototype.hasOwnProperty.call(v,s)}function Y(v,s){return Object.prototype.hasOwnProperty.call(v,s)?v[s]:void 0}function M(v){for(var s in v)if(Object.prototype.hasOwnProperty.call(v,s))return!1;return!0}function B(v,s,y){var D={};for(var x in v)Object.prototype.hasOwnProperty.call(v,x)&&(D[x]=s.call(y,v[x],x,v));return D}function J(v){for(var s=[],y=function(ha,da){Array.isArray(da)?da.forEach(function(sa){s.push(encodeURIComponent(ha)+"="+encodeURIComponent(sa))}):s.push(encodeURIComponent(ha)+"="+encodeURIComponent(da))},D=0,x=Object.entries(v);D<x.length;D++){var U=x[D],$=U[0],_=U[1];y($,_)}return s.length?"&"+s.join("&"):""}function Z(v){var s={},y=v.replace(/^\?/,"").split("&");return y.forEach(function(D){if(D){var x=D.split("=");s[x[0]]=x[1]}}),s}var ia=function(){function v(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(var s=1;s<this.blockSize;++s)this.pad_[s]=0;this.reset()}return v.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},v.prototype.compress_=function(s,y){y||(y=0);var D=this.W_;if(typeof s==="string")for(var x=0;x<16;x++)D[x]=s.charCodeAt(y)<<24|s.charCodeAt(y+1)<<16|s.charCodeAt(y+2)<<8|s.charCodeAt(y+3),y+=4;else for(var x=0;x<16;x++)D[x]=s[y]<<24|s[y+1]<<16|s[y+2]<<8|s[y+3],y+=4;for(var x=16;x<80;x++){var U=D[x-3]^D[x-8]^D[x-14]^D[x-16];D[x]=(U<<1|U>>>31)&4294967295}for(var $=this.chain_[0],_=this.chain_[1],ha=this.chain_[2],da=this.chain_[3],sa=this.chain_[4],la,ya,x=0;x<80;x++){x<40?x<20?(la=da^_&(ha^da),ya=1518500249):(la=_^ha^da,ya=1859775393):x<60?(la=_&ha|da&(_|ha),ya=2400959708):(la=_^ha^da,ya=3395469782);var U=($<<5|$>>>27)+la+sa+ya+D[x]&4294967295;sa=da,da=ha,ha=(_<<30|_>>>2)&4294967295,_=$,$=U}this.chain_[0]=this.chain_[0]+$&4294967295,this.chain_[1]=this.chain_[1]+_&4294967295,this.chain_[2]=this.chain_[2]+ha&4294967295,this.chain_[3]=this.chain_[3]+da&4294967295,this.chain_[4]=this.chain_[4]+sa&4294967295},v.prototype.update=function(s,y){if(s==null)return;y===void 0&&(y=s.length);for(var D=y-this.blockSize,x=0,U=this.buf_,$=this.inbuf_;x<y;){if($===0)for(;x<=D;)this.compress_(s,x),x+=this.blockSize;if(typeof s==="string")for(;x<y;){U[$]=s.charCodeAt(x),++$,++x;if($===this.blockSize){this.compress_(U),$=0;break}}else for(;x<y;){U[$]=s[x],++$,++x;if($===this.blockSize){this.compress_(U),$=0;break}}}this.inbuf_=$,this.total_+=y},v.prototype.digest=function(){var s=[],y=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var D=this.blockSize-1;D>=56;D--)this.buf_[D]=y&255,y/=256;this.compress_(this.buf_);for(var x=0,D=0;D<5;D++)for(var U=24;U>=0;U-=8)s[x]=this.chain_[D]>>U&255,++x;return s},v}();function na(v,s){var y=new pa(v,s);return y.subscribe.bind(y)}var pa=function(){function v(s,y){var D=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=y,this.task.then(function(){s(D)}).catch(function(x){D.error(x)})}return v.prototype.next=function(s){this.forEachObserver(function(y){y.next(s)})},v.prototype.error=function(s){this.forEachObserver(function(y){y.error(s)}),this.close(s)},v.prototype.complete=function(){this.forEachObserver(function(s){s.complete()}),this.close()},v.prototype.subscribe=function(s,y,D){var x=this,U;if(s===void 0&&y===void 0&&D===void 0)throw new Error("Missing Observer.");T(s,["next","error","complete"])?U=s:U={next:s,error:y,complete:D},U.next===void 0&&(U.next=ea),U.error===void 0&&(U.error=ea),U.complete===void 0&&(U.complete=ea);var $=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{x.finalError?U.error(x.finalError):U.complete()}catch(_){}return}),this.observers.push(U),$},v.prototype.unsubscribeOne=function(s){if(this.observers===void 0||this.observers[s]===void 0)return;delete this.observers[s],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this)},v.prototype.forEachObserver=function(s){if(this.finalized)return;for(var y=0;y<this.observers.length;y++)this.sendOne(y,s)},v.prototype.sendOne=function(s,y){var D=this;this.task.then(function(){if(D.observers!==void 0&&D.observers[s]!==void 0)try{y(D.observers[s])}catch(x){typeof console!=="undefined"&&console.error&&console.error(x)}})},v.prototype.close=function(s){var y=this;if(this.finalized)return;this.finalized=!0,s!==void 0&&(this.finalError=s),this.task.then(function(){y.observers=void 0,y.onNoObservers=void 0})},v}();function ma(v,s){return function(){for(var y=[],D=0;D<arguments.length;D++)y[D]=arguments[D];Promise.resolve(!0).then(function(){v.apply(void 0,y)}).catch(function(x){s&&s(x)})}}function T(v,s){if(typeof v!=="object"||v===null)return!1;for(var y=0,D=s;y<D.length;y++){var x=D[y];if(x in v&&typeof v[x]==="function")return!0}return!1}function ea(){}var ja=function(v,s,y,D){var x;D<s?x="at least "+s:D>y&&(x=y===0?"none":"no more than "+y);if(x){var U=v+" failed: Was called with "+D+(D===1?" argument.":" arguments.")+" Expects "+x+".";throw new Error(U)}};function ka(v,s,y){var D="";switch(s){case 1:D=y?"first":"First";break;case 2:D=y?"second":"Second";break;case 3:D=y?"third":"Third";break;case 4:D=y?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var x=v+" failed: ";return x+=D+" argument ",x}function P(v,s,y,D){if(D&&!y)return;if(typeof y!=="string")throw new Error(ka(v,s,D)+"must be a valid firebase namespace.")}function S(v,s,y,D){if(D&&!y)return;if(typeof y!=="function")throw new Error(ka(v,s,D)+"must be a valid function.")}function ga(v,s,y,D){if(D&&!y)return;if(typeof y!=="object"||y===null)throw new Error(ka(v,s,D)+"must be a valid context object.")}var N=function(v){for(var s=[],y=0,D=0;D<v.length;D++){var x=v.charCodeAt(D);if(x>=55296&&x<=56319){var U=x-55296;D++,c(D<v.length,"Surrogate pair missing trail surrogate.");var $=v.charCodeAt(D)-56320;x=65536+(U<<10)+$}x<128?s[y++]=x:x<2048?(s[y++]=x>>6|192,s[y++]=x&63|128):x<65536?(s[y++]=x>>12|224,s[y++]=x>>6&63|128,s[y++]=x&63|128):(s[y++]=x>>18|240,s[y++]=x>>12&63|128,s[y++]=x>>6&63|128,s[y++]=x&63|128)}return s},fa=function(v){for(var s=0,y=0;y<v.length;y++){var D=v.charCodeAt(y);D<128?s++:D<2048?s+=2:D>=55296&&D<=56319?(s+=4,y++):s+=3}return s};O.CONSTANTS=b;O.Deferred=u;O.ErrorFactory=r;O.FirebaseError=q;O.Sha1=ia;O.assert=c;O.assertionError=d;O.async=ma;O.base64=g;O.base64Decode=i;O.base64Encode=j;O.contains=z;O.createSubscribe=na;O.decode=t;O.deepCopy=k;O.deepExtend=n;O.errorPrefix=ka;O.getUA=w;O.isAdmin=X;O.isBrowser=F;O.isBrowserExtension=H;O.isElectron=L;O.isEmpty=M;O.isIE=R;O.isMobileCordova=A;O.isNode=C;O.isNodeSdk=V;O.isReactNative=Q;O.isSafari=W;O.isUWP=I;O.isValidFormat=G;O.isValidTimestamp=o;O.issuedAtTime=E;O.jsonEval=l;O.map=B;O.querystring=J;O.querystringDecode=Z;O.safeGet=Y;O.stringLength=fa;O.stringToByteArray=N;O.stringify=p;O.validateArgCount=ja;O.validateCallback=S;O.validateContextObject=ga;O.validateNamespace=P});var ai=gb(q=>{Vb(q,{__assign:()=>c,__asyncDelegator:()=>Q,__asyncGenerator:()=>H,__asyncValues:()=>L,__await:()=>F,__awaiter:()=>j,__classPrivateFieldGet:()=>W,__classPrivateFieldSet:()=>K,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>V,__importStar:()=>I,__makeTemplateObject:()=>R,__metadata:()=>g,__param:()=>f,__read:()=>w,__rest:()=>d,__spread:()=>A,__spreadArrays:()=>C,__values:()=>u});var a=function(h,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,p){l.__proto__=p}||function(l,p){for(var t in p)p.hasOwnProperty(t)&&(l[t]=p[t])},a(h,m)};function b(h,m){a(h,m);function l(){this.constructor=h}h.prototype=m===null?Object.create(m):(l.prototype=m.prototype,new l())}var c=function(){return c=Object.assign||function h(m){for(var l,p=1,t=arguments.length;p<t;p++){l=arguments[p];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(m[o]=l[o])}return m},c.apply(this,arguments)};function d(h,m){var l={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&m.indexOf(p)<0&&(l[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var t=0,p=Object.getOwnPropertySymbols(h);t<p.length;t++)m.indexOf(p[t])<0&&Object.prototype.propertyIsEnumerable.call(h,p[t])&&(l[p[t]]=h[p[t]]);return l}function e(h,m,l,p){var t=arguments.length,o=t<3?m:p===null?p=Object.getOwnPropertyDescriptor(m,l):p,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(h,m,l,p);else for(var G=h.length-1;G>=0;G--)(E=h[G])&&(o=(t<3?E(o):t>3?E(m,l,o):E(m,l))||o);return t>3&&o&&Object.defineProperty(m,l,o),o}function f(h,m){return function(l,p){m(l,p,h)}}function g(h,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,m)}function j(h,m,l,p){function t(o){return o instanceof l?o:new l(function(E){E(o)})}return new(l||(l=Promise))(function(o,E){function G(Y){try{z(p.next(Y))}catch(M){E(M)}}function X(Y){try{z(p.throw(Y))}catch(M){E(M)}}function z(Y){Y.done?o(Y.value):t(Y.value).then(G,X)}z((p=p.apply(h,m||[])).next())})}function i(h,m){var l={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},p,t,o,E;return E={next:G(0),throw:G(1),return:G(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function G(z){return function(Y){return X([z,Y])}}function X(z){if(p)throw new TypeError("Generator is already executing.");for(;l;)try{if(p=1,t&&(o=z[0]&2?t.return:z[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,z[1])).done)return o;(t=0,o)&&(z=[z[0]&2,o.value]);switch(z[0]){case 0:case 1:o=z;break;case 4:return l.label++,{value:z[1],done:!1};case 5:l.label++,t=z[1],z=[0];continue;case 7:z=l.ops.pop(),l.trys.pop();continue;default:if(!(o=l.trys,o=o.length>0&&o[o.length-1])&&(z[0]===6||z[0]===2)){l=0;continue}if(z[0]===3&&(!o||z[1]>o[0]&&z[1]<o[3])){l.label=z[1];break}if(z[0]===6&&l.label<o[1]){l.label=o[1],o=z;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(z);break}o[2]&&l.ops.pop(),l.trys.pop();continue}z=m.call(h,l)}catch(Y){z=[6,Y],t=0}finally{p=o=0}if(z[0]&5)throw z[1];return{value:z[0]?z[1]:void 0,done:!0}}}function k(h,m,l,p){p===void 0&&(p=l),h[p]=m[l]}function n(h,m){for(var l in h)l!=="default"&&!m.hasOwnProperty(l)&&(m[l]=h[l])}function u(h){var m=typeof Symbol==="function"&&Symbol.iterator,l=m&&h[m],p=0;if(l)return l.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function w(h,m){var l=typeof Symbol==="function"&&h[Symbol.iterator];if(!l)return h;var p=l.call(h),t,o=[],E;try{for(;(m===void 0||m-- >0)&&!(t=p.next()).done;)o.push(t.value)}catch(G){E={error:G}}finally{try{t&&!t.done&&(l=p.return)&&l.call(p)}finally{if(E)throw E.error}}return o}function A(){for(var h=[],m=0;m<arguments.length;m++)h=h.concat(w(arguments[m]));return h}function C(){for(var h=0,m=0,l=arguments.length;m<l;m++)h+=arguments[m].length;for(var p=Array(h),t=0,m=0;m<l;m++)for(var o=arguments[m],E=0,G=o.length;E<G;E++,t++)p[t]=o[E];return p}function F(h){return this instanceof F?(this.v=h,this):new F(h)}function H(h,m,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=l.apply(h,m||[]),t,o=[];return t={},E("next"),E("throw"),E("return"),t[Symbol.asyncIterator]=function(){return this},t;function E(B){p[B]&&(t[B]=function(J){return new Promise(function(Z,ia){o.push([B,J,Z,ia])>1||G(B,J)})})}function G(B,J){try{X(p[B](J))}catch(Z){M(o[0][3],Z)}}function X(B){B.value instanceof F?Promise.resolve(B.value.v).then(z,Y):M(o[0][2],B)}function z(B){G("next",B)}function Y(B){G("throw",B)}function M(B,J){(B(J),o.shift(),o.length)&&G(o[0][0],o[0][1])}}function Q(h){var m,l;return m={},p("next"),p("throw",function(t){throw t}),p("return"),m[Symbol.iterator]=function(){return this},m;function p(t,o){m[t]=h[t]?function(E){return(l=!l)?{value:F(h[t](E)),done:t==="return"}:o?o(E):E}:o}}function L(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=h[Symbol.asyncIterator],l;return m?m.call(h):(h=typeof u==="function"?u(h):h[Symbol.iterator](),l={},p("next"),p("throw"),p("return"),l[Symbol.asyncIterator]=function(){return this},l);function p(o){l[o]=h[o]&&function(E){return new Promise(function(G,X){E=h[o](E),t(G,X,E.done,E.value)})}}function t(o,E,G,X){Promise.resolve(X).then(function(z){o({value:z,done:G})},E)}}function R(h,m){return Object.defineProperty?Object.defineProperty(h,"raw",{value:m}):h.raw=m,h}function I(h){if(h&&h.__esModule)return h;var m={};if(h!=null)for(var l in h)Object.hasOwnProperty.call(h,l)&&(m[l]=h[l]);return m.default=h,m}function V(h){return h&&h.__esModule?h:{default:h}}function W(h,m){if(!m.has(h))throw new TypeError("attempted to get private field on non-instance");return m.get(h)}function K(h,m,l){if(!m.has(h))throw new TypeError("attempted to set private field on non-instance");return m.set(h,l),l}});var $h=gb(i=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=ai(),b=Se(),c=function(){function n(u,w,A){this.name=u,this.instanceFactory=w,this.type=A,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return n.prototype.setInstantiationMode=function(u){return this.instantiationMode=u,this},n.prototype.setMultipleInstances=function(u){return this.multipleInstances=u,this},n.prototype.setServiceProps=function(u){return this.serviceProps=u,this},n}();var d="[DEFAULT]";var e=function(){function n(u,w){this.name=u,this.container=w,this.component=null,this.instances=new Map(),this.instancesDeferred=new Map()}return n.prototype.get=function(u){u===void 0&&(u=d);var w=this.normalizeInstanceIdentifier(u);if(!this.instancesDeferred.has(w)){var A=new b.Deferred();this.instancesDeferred.set(w,A);try{var C=this.getOrInitializeService(w);C&&A.resolve(C)}catch(F){}}return this.instancesDeferred.get(w).promise},n.prototype.getImmediate=function(u){var w=a.__assign({identifier:d,optional:!1},u),A=w.identifier,C=w.optional,F=this.normalizeInstanceIdentifier(A);try{var H=this.getOrInitializeService(F);if(!H){if(C)return null;throw Error("Service "+this.name+" is not available")}return H}catch(Q){if(C)return null;throw Q}},n.prototype.getComponent=function(){return this.component},n.prototype.setComponent=function(u){var w,A;if(u.name!==this.name)throw Error("Mismatching Component "+u.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");this.component=u;if(g(u))try{this.getOrInitializeService(d)}catch(V){}try{for(var C=a.__values(this.instancesDeferred.entries()),F=C.next();!F.done;F=C.next()){var H=a.__read(F.value,2),Q=H[0],L=H[1],R=this.normalizeInstanceIdentifier(Q);try{var I=this.getOrInitializeService(R);L.resolve(I)}catch(V){}}}catch(V){w={error:V}}finally{try{F&&!F.done&&(A=C.return)&&A.call(C)}finally{if(w)throw w.error}}},n.prototype.clearInstance=function(u){u===void 0&&(u=d),this.instancesDeferred.delete(u),this.instances.delete(u)},n.prototype.delete=function(){return a.__awaiter(this,void 0,void 0,function(){var u;return a.__generator(this,function(w){switch(w.label){case 0:return u=Array.from(this.instances.values()),[4,Promise.all(u.filter(function(A){return"INTERNAL"in A}).map(function(A){return A.INTERNAL.delete()}))];case 1:return w.sent(),[2]}})})},n.prototype.isComponentSet=function(){return this.component!=null},n.prototype.getOrInitializeService=function(u){var w=this.instances.get(u);return!w&&this.component&&(w=this.component.instanceFactory(this.container,f(u)),this.instances.set(u,w)),w||null},n.prototype.normalizeInstanceIdentifier=function(u){return this.component?this.component.multipleInstances?u:d:u},n}();function f(n){return n===d?void 0:n}function g(n){return n.instantiationMode==="EAGER"}var j=function(){function n(u){this.name=u,this.providers=new Map()}return n.prototype.addComponent=function(u){var w=this.getProvider(u.name);if(w.isComponentSet())throw new Error("Component "+u.name+" has already been registered with "+this.name);w.setComponent(u)},n.prototype.addOrOverwriteComponent=function(u){var w=this.getProvider(u.name);w.isComponentSet()&&this.providers.delete(u.name),this.addComponent(u)},n.prototype.getProvider=function(u){if(this.providers.has(u))return this.providers.get(u);var w=new e(u,this);return this.providers.set(u,w),w},n.prototype.getProviders=function(){return Array.from(this.providers.values())},n}();i.Component=c;i.ComponentContainer=j;i.Provider=e});var bi=gb(u=>{Vb(u,{LogLevel:()=>d,Logger:()=>i,setLogLevel:()=>k,setUserLogHandler:()=>n});function a(){for(var A=0,C=0,F=arguments.length;C<F;C++)A+=arguments[C].length;for(var H=Array(A),Q=0,C=0;C<F;C++)for(var L=arguments[C],R=0,I=L.length;R<I;R++,Q++)H[Q]=L[R];return H}var b,c=[],d;(function(A){A[A.DEBUG=0]="DEBUG",A[A.VERBOSE=1]="VERBOSE",A[A.INFO=2]="INFO",A[A.WARN=3]="WARN",A[A.ERROR=4]="ERROR",A[A.SILENT=5]="SILENT"})(d||(d={}));var e={debug:d.DEBUG,verbose:d.VERBOSE,info:d.INFO,warn:d.WARN,error:d.ERROR,silent:d.SILENT},f=d.INFO,g=(b={},b[d.DEBUG]="log",b[d.VERBOSE]="log",b[d.INFO]="info",b[d.WARN]="warn",b[d.ERROR]="error",b),j=function(A,C){for(var F=[],H=2;H<arguments.length;H++)F[H-2]=arguments[H];if(C<A.logLevel)return;var Q=new Date().toISOString(),L=g[C];if(L)console[L].apply(console,a(["["+Q+"]  "+A.name+":"],F));else throw new Error("Attempted to log a message with an invalid logType (value: "+C+")")},i=function(){function A(C){this.name=C,this._logLevel=f,this._logHandler=j,this._userLogHandler=null,c.push(this)}return Object.defineProperty(A.prototype,"logLevel",{get:function(){return this._logLevel},set:function(C){if(!(C in d))throw new TypeError('Invalid value "'+C+'" assigned to `logLevel`');this._logLevel=C},enumerable:!1,configurable:!0}),A.prototype.setLogLevel=function(C){this._logLevel=typeof C==="string"?e[C]:C},Object.defineProperty(A.prototype,"logHandler",{get:function(){return this._logHandler},set:function(C){if(typeof C!=="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=C},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(C){this._userLogHandler=C},enumerable:!1,configurable:!0}),A.prototype.debug=function(){for(var C=[],F=0;F<arguments.length;F++)C[F]=arguments[F];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.DEBUG],C)),this._logHandler.apply(this,a([this,d.DEBUG],C))},A.prototype.log=function(){for(var C=[],F=0;F<arguments.length;F++)C[F]=arguments[F];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.VERBOSE],C)),this._logHandler.apply(this,a([this,d.VERBOSE],C))},A.prototype.info=function(){for(var C=[],F=0;F<arguments.length;F++)C[F]=arguments[F];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.INFO],C)),this._logHandler.apply(this,a([this,d.INFO],C))},A.prototype.warn=function(){for(var C=[],F=0;F<arguments.length;F++)C[F]=arguments[F];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.WARN],C)),this._logHandler.apply(this,a([this,d.WARN],C))},A.prototype.error=function(){for(var C=[],F=0;F<arguments.length;F++)C[F]=arguments[F];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.ERROR],C)),this._logHandler.apply(this,a([this,d.ERROR],C))},A}();function k(A){c.forEach(function(C){C.setLogLevel(A)})}function n(A,C){for(var F=function(R){var I=null;C&&C.level&&(I=e[C.level]),A===null?R.userLogHandler=null:R.userLogHandler=function(V,W){for(var K=[],q=2;q<arguments.length;q++)K[q-2]=arguments[q];var r=K.map(function(h){if(h==null)return null;{if(typeof h==="string")return h;{if(typeof h==="number"||typeof h==="boolean")return h.toString();{if(h instanceof Error)return h.message;try{return JSON.stringify(h)}catch(m){return null}}}}}).filter(function(h){return h}).join(" ");W>=(I!==null&&I!==void 0?I:V.logLevel)&&A({level:d[W].toLowerCase(),message:r,args:K,type:V.name})}},H=0,Q=c;H<Q.length;H++){var L=Q[H];F(L)}}});var Zh=gb(z=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0});var a=_h(),b=Se(),c=$h(),d=bi();var e,f=(e={},e["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",e["bad-app-name"]="Illegal App name: '{$appName}",e["duplicate-app"]="Firebase App named '{$appName}' already exists",e["app-deleted"]="Firebase App named '{$appName}' already deleted",e["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",e["invalid-log-argument"]="First argument to `onLog` must be null or a function.",e),g=new b.ErrorFactory("app","Firebase",f),j="@firebase/app",i="0.6.8",k="@firebase/analytics",n="@firebase/auth",u="@firebase/database",w="@firebase/functions",A="@firebase/installations",C="@firebase/messaging",F="@firebase/performance",H="@firebase/remote-config",Q="@firebase/storage",L="@firebase/firestore",R="firebase-wrapper";var I,V="[DEFAULT]",W=(I={},I[j]="fire-core",I[k]="fire-analytics",I[n]="fire-auth",I[u]="fire-rtdb",I[w]="fire-fn",I[A]="fire-iid",I[C]="fire-fcm",I[F]="fire-perf",I[H]="fire-rc",I[Q]="fire-gcs",I[L]="fire-fst",I["fire-js"]="fire-js",I[R]="fire-js-all",I);var K=new d.Logger("@firebase/app");var q=function(){function M(B,J,Z){var ia,na,pa=this;this.firebase_=Z,this.isDeleted_=!1,this.name_=J.name,this.automaticDataCollectionEnabled_=J.automaticDataCollectionEnabled||!1,this.options_=b.deepCopy(B),this.container=new c.ComponentContainer(J.name),this._addComponent(new c.Component("app",function(){return pa},"PUBLIC"));try{for(var ma=a.__values(this.firebase_.INTERNAL.components.values()),T=ma.next();!T.done;T=ma.next()){var ea=T.value;this._addComponent(ea)}}catch(ja){ia={error:ja}}finally{try{T&&!T.done&&(na=ma.return)&&na.call(ma)}finally{if(ia)throw ia.error}}}return Object.defineProperty(M.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(B){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=B},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),M.prototype.delete=function(){var B=this;return new Promise(function(J){B.checkDestroyed_(),J()}).then(function(){return B.firebase_.INTERNAL.removeApp(B.name_),Promise.all(B.container.getProviders().map(function(J){return J.delete()}))}).then(function(){B.isDeleted_=!0})},M.prototype._getService=function(B,J){return J===void 0&&(J=V),this.checkDestroyed_(),this.container.getProvider(B).getImmediate({identifier:J})},M.prototype._removeServiceInstance=function(B,J){J===void 0&&(J=V),this.container.getProvider(B).clearInstance(J)},M.prototype._addComponent=function(B){try{this.container.addComponent(B)}catch(J){K.debug("Component "+B.name+" failed to register with FirebaseApp "+this.name,J)}},M.prototype._addOrOverwriteComponent=function(B){this.container.addOrOverwriteComponent(B)},M.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw g.create("app-deleted",{appName:this.name_})},M}();q.prototype.name&&q.prototype.options||q.prototype.delete||console.log("dc");var r="7.16.0";function h(M){var B={},J=new Map(),Z={__esModule:!0,initializeApp:pa,app:na,registerVersion:ea,setLogLevel:d.setLogLevel,onLog:ja,apps:null,SDK_VERSION:r,INTERNAL:{registerComponent:T,removeApp:ia,components:J,useAsService:ka}};Z.default=Z,Object.defineProperty(Z,"apps",{get:ma});function ia(P){delete B[P]}function na(P){P=P||V;if(!b.contains(B,P))throw g.create("no-app",{appName:P});return B[P]}na.App=M;function pa(P,S){S===void 0&&(S={});if(typeof S!=="object"||S===null){var ga=S;S={name:ga}}var N=S;N.name===void 0&&(N.name=V);var fa=N.name;if(typeof fa!=="string"||!fa)throw g.create("bad-app-name",{appName:String(fa)});if(b.contains(B,fa))throw g.create("duplicate-app",{appName:fa});var O=new M(P,N,Z);return B[fa]=O,O}function ma(){return Object.keys(B).map(function(P){return B[P]})}function T(P){var S,ga,N=P.name;if(J.has(N))return K.debug("There were multiple attempts to register component "+N+"."),P.type==="PUBLIC"?Z[N]:null;J.set(N,P);if(P.type==="PUBLIC"){var fa=function(s){s===void 0&&(s=na());if(typeof s[N]!=="function")throw g.create("invalid-app-argument",{appName:N});return s[N]()};P.serviceProps!==void 0&&b.deepExtend(fa,P.serviceProps),Z[N]=fa,M.prototype[N]=function(){for(var s=[],y=0;y<arguments.length;y++)s[y]=arguments[y];var D=this._getService.bind(this,N);return D.apply(this,P.multipleInstances?s:[])}}try{for(var O=a.__values(Object.keys(B)),ua=O.next();!ua.done;ua=O.next()){var v=ua.value;B[v]._addComponent(P)}}catch(s){S={error:s}}finally{try{ua&&!ua.done&&(ga=O.return)&&ga.call(O)}finally{if(S)throw S.error}}return P.type==="PUBLIC"?Z[N]:null}function ea(P,S,ga){var N,fa=(N=W[P])!==null&&N!==void 0?N:P;ga&&(fa+="-"+ga);var O=fa.match(/\s|\//),ua=S.match(/\s|\//);if(O||ua){var v=['Unable to register library "'+fa+'" with version "'+S+'":'];O&&v.push('library name "'+fa+'" contains illegal characters (whitespace or "/")'),O&&ua&&v.push("and"),ua&&v.push('version name "'+S+'" contains illegal characters (whitespace or "/")'),K.warn(v.join(" "));return}T(new c.Component(fa+"-version",function(){return{library:fa,version:S}},"VERSION"))}function ja(P,S){if(P!==null&&typeof P!=="function")throw g.create("invalid-log-argument",{appName:name});d.setUserLogHandler(P,S)}function ka(P,S){if(S==="serverAuth")return null;var ga=S;return ga}return Z}function m(){var M=h(q);M.INTERNAL=a.__assign(a.__assign({},M.INTERNAL),{createFirebaseNamespace:m,extendNamespace:B,createSubscribe:b.createSubscribe,ErrorFactory:b.ErrorFactory,deepExtend:b.deepExtend});function B(J){b.deepExtend(M,J)}return M}var l=m();var p=function(){function M(B){this.container=B}return M.prototype.getPlatformInfoString=function(){var B=this.container.getProviders();return B.map(function(J){if(t(J)){var Z=J.getImmediate();return Z.library+"/"+Z.version}else return null}).filter(function(J){return J}).join(" ")},M}();function t(M){var B=M.getComponent();return(B===null||B===void 0?void 0:B.type)==="VERSION"}function o(M,B){M.INTERNAL.registerComponent(new c.Component("platform-logger",function(J){return new p(J)},"PRIVATE")),M.registerVersion(j,i,B),M.registerVersion("fire-js","")}if(b.isBrowser()&&self.firebase!==void 0){K.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);var E=self.firebase.SDK_VERSION;E&&E.indexOf("LITE")>=0&&K.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}var G=l.initializeApp;l.initializeApp=function(){for(var M=[],B=0;B<arguments.length;B++)M[B]=arguments[B];return b.isNode()&&K.warn(`
      Warning: This is a browser-targeted Firebase bundle but it appears it is being
      run in a Node environment.  If running in a Node environment, make sure you
      are using the bundle specified by the "main" field in package.json.
      
      If you are using Webpack, you can specify "main" as the first item in
      "resolve.mainFields":
      https://webpack.js.org/configuration/resolve/#resolvemainfields
      
      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"
      as the first item in "mainFields", e.g. ['main', 'module'].
      https://github.com/rollup/rollup-plugin-node-resolve
      `),G.apply(void 0,M)};var X=l;o(X);z.default=X;z.firebase=X});var La=gb((e,f)=>{"use strict";function a(g){return g&&typeof g==="object"&&"default"in g?g.default:g}var b=a(Zh()),c="firebase",d="7.16.0";b.registerVersion(c,d,"app");f.exports=b});var en=gb((b,c)=>{var a=function(){function d(k,n){if(!j[k]){j[k]={};for(var u=0;u<k.length;u++)j[k][k.charAt(u)]=u}return j[k][n]}var e=String.fromCharCode,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",j={},i={compressToBase64:function(k){if(null==k)return"";var n=i._compress(k,6,function(u){return f.charAt(u)});switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(k){return null==k?"":""==k?null:i._decompress(k.length,32,function(n){return d(f,k.charAt(n))})},compressToUTF16:function(k){return null==k?"":i._compress(k,15,function(n){return e(n+32)})+" "},decompressFromUTF16:function(k){return null==k?"":""==k?null:i._decompress(k.length,16384,function(n){return k.charCodeAt(n)-32})},compressToUint8Array:function(k){for(var n=i.compress(k),u=new Uint8Array(2*n.length),w=0,A=n.length;A>w;w++){var C=n.charCodeAt(w);u[2*w]=C>>>8,u[2*w+1]=C%256}return u},decompressFromUint8Array:function(k){if(null===k||void 0===k)return i.decompress(k);for(var n=new Array(k.length/2),u=0,w=n.length;w>u;u++)n[u]=256*k[2*u]+k[2*u+1];var A=[];return n.forEach(function(C){A.push(e(C))}),i.decompress(A.join(""))},compressToEncodedURIComponent:function(k){return null==k?"":i._compress(k,6,function(n){return g.charAt(n)})},decompressFromEncodedURIComponent:function(k){return null==k?"":""==k?null:(k=k.replace(/ /g,"+"),i._decompress(k.length,32,function(n){return d(g,k.charAt(n))}))},compress:function(k){return i._compress(k,16,function(n){return e(n)})},_compress:function(k,n,u){if(null==k)return"";var w,A,C,F={},H={},Q="",L="",R="",I=2,V=3,W=2,K=[],q=0,r=0;for(C=0;C<k.length;C+=1)if(Q=k.charAt(C),Object.prototype.hasOwnProperty.call(F,Q)||(F[Q]=V++,H[Q]=!0),L=R+Q,Object.prototype.hasOwnProperty.call(F,L))R=L;else{if(Object.prototype.hasOwnProperty.call(H,R)){if(R.charCodeAt(0)<256){for(w=0;W>w;w++)q<<=1,r==n-1?(r=0,K.push(u(q)),q=0):r++;for(A=R.charCodeAt(0),w=0;8>w;w++)q=q<<1|1&A,r==n-1?(r=0,K.push(u(q)),q=0):r++,A>>=1}else{for(A=1,w=0;W>w;w++)q=q<<1|A,r==n-1?(r=0,K.push(u(q)),q=0):r++,A=0;for(A=R.charCodeAt(0),w=0;16>w;w++)q=q<<1|1&A,r==n-1?(r=0,K.push(u(q)),q=0):r++,A>>=1}I--,0==I&&(I=Math.pow(2,W),W++),delete H[R]}else for(A=F[R],w=0;W>w;w++)q=q<<1|1&A,r==n-1?(r=0,K.push(u(q)),q=0):r++,A>>=1;I--,0==I&&(I=Math.pow(2,W),W++),F[L]=V++,R=String(Q)}if(""!==R){if(Object.prototype.hasOwnProperty.call(H,R)){if(R.charCodeAt(0)<256){for(w=0;W>w;w++)q<<=1,r==n-1?(r=0,K.push(u(q)),q=0):r++;for(A=R.charCodeAt(0),w=0;8>w;w++)q=q<<1|1&A,r==n-1?(r=0,K.push(u(q)),q=0):r++,A>>=1}else{for(A=1,w=0;W>w;w++)q=q<<1|A,r==n-1?(r=0,K.push(u(q)),q=0):r++,A=0;for(A=R.charCodeAt(0),w=0;16>w;w++)q=q<<1|1&A,r==n-1?(r=0,K.push(u(q)),q=0):r++,A>>=1}I--,0==I&&(I=Math.pow(2,W),W++),delete H[R]}else for(A=F[R],w=0;W>w;w++)q=q<<1|1&A,r==n-1?(r=0,K.push(u(q)),q=0):r++,A>>=1;I--,0==I&&(I=Math.pow(2,W),W++)}for(A=2,w=0;W>w;w++)q=q<<1|1&A,r==n-1?(r=0,K.push(u(q)),q=0):r++,A>>=1;for(;;){if(q<<=1,r==n-1){K.push(u(q));break}r++}return K.join("")},decompress:function(k){return null==k?"":""==k?null:i._decompress(k.length,32768,function(n){return k.charCodeAt(n)})},_decompress:function(k,n,u){var w,A,C,F,H,Q,L,R,I=[],V=4,W=4,K=3,q="",r=[],h={val:u(0),position:n,index:1};for(A=0;3>A;A+=1)I[A]=A;for(F=0,Q=Math.pow(2,2),L=1;L!=Q;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),F|=(H>0?1:0)*L,L<<=1;switch(w=F){case 0:for(F=0,Q=Math.pow(2,8),L=1;L!=Q;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),F|=(H>0?1:0)*L,L<<=1;R=e(F);break;case 1:for(F=0,Q=Math.pow(2,16),L=1;L!=Q;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),F|=(H>0?1:0)*L,L<<=1;R=e(F);break;case 2:return""}for(I[3]=R,C=R,r.push(R);;){if(h.index>k)return"";for(F=0,Q=Math.pow(2,K),L=1;L!=Q;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),F|=(H>0?1:0)*L,L<<=1;switch(R=F){case 0:for(F=0,Q=Math.pow(2,8),L=1;L!=Q;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),F|=(H>0?1:0)*L,L<<=1;I[W++]=e(F),R=W-1,V--;break;case 1:for(F=0,Q=Math.pow(2,16),L=1;L!=Q;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),F|=(H>0?1:0)*L,L<<=1;I[W++]=e(F),R=W-1,V--;break;case 2:return r.join("")}if(0==V&&(V=Math.pow(2,K),K++),I[R])q=I[R];else{if(R!==W)return null;q=C+C.charAt(0)}r.push(q),I[W++]=C+q.charAt(0),V--,C=q,0==V&&(V=Math.pow(2,K),K++)}}};return i}();"function"==typeof define&&define.amd?define(function(){return a}):"undefined"!=typeof c&&null!=c&&(c.exports=a)});let hi,ii=0,ji=0;const wa={get:()=>hi,set:a=>{hi=a},getFrame:()=>ii,setFrame:a=>{ii=a},getElapsed:()=>ji,setElapsed:a=>{ji=a}};let ni=0;function Me(a=0){return()=>{ni=a}}function $c(){return ni}let Xe="Phaser",jn="https://phaser4.io",kn="#fff",ln="linear-gradient(#3e0081 40%, #00bcc3)";function Te(){if(Xe!==""){const a=wa.get(),b=Xe==="Phaser"?" v"+a.VERSION:"";console.log(`%c${Xe}${b}%c ${jn}`,`padding: 4px 16px; color: ${kn}; background: ${ln}`,"")}}let si=800,ti=600,ui=1;function Pe(a=800,b=600,c=1){return c===0&&(c=window.devicePixelRatio),()=>{si=a,ti=b,ui=c}}function Wb(){return si}function Xb(){return ti}function Yb(){return ui}const kf=[],Zb={add:a=>{kf.push(a)},get:()=>kf,clear:()=>{kf.length=0}};let ri;function ad(a){ri=a}function Ue(){return ri}let Ye=.5,Ze=.5;let oi=0;function _e(a){oi=a}function pc(){return oi}function bd(a){let b;return a&&(typeof a==="string"?b=document.getElementById(a):typeof a==="object"&&a.nodeType===1&&(b=a)),b||(b=document.body),b}let pi;function Ne(a){return()=>{a&&(pi=bd(a))}}function Ve(){return pi}let qi=[];function Oe(a){return()=>{qi=[].concat(a)}}function $e(){return qi}let nn={alpha:!1,antialias:!1,depth:!1,premultipliedAlpha:!1};function af(){return nn}class Ti{constructor(a){this.stack=[],this.current=null,this.renderer=a}reset(){this.stack=[],this.current=null;const a=this.renderer,b=a.gl;b.bindFramebuffer(b.FRAMEBUFFER,null),b.viewport(0,0,a.width,a.height)}add(a,b=!0,c=0,d=0){this.stack.push({framebuffer:a,width:c,height:d}),this.set(a,b,c,d)}set(a,b=!0,c=0,d=0){const e=this.renderer,f=e.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),b&&(f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),c>0&&f.viewport(0,0,c,d),this.current=a}pop(){this.stack.pop();const a=this.stack.length;if(a>0){const b=this.stack[a-1];this.set(b.framebuffer,!1,b.width,b.height)}else this.reset()}rebind(){const a=this.renderer.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.current)}destroy(){this.stack=[]}}let Si;const Aa={get:()=>Si,set:a=>{Si=a}};function Ui(a,b=[]){const c=a>>16&255,d=a>>8&255,e=a&255,f=a>16777215?a>>>24:255;return b[0]=c/255,b[1]=d/255,b[2]=e/255,b[3]=f/255,b}function Pi(a,b){return a.a===b.a&&a.b===b.b&&a.c===b.c&&a.d===b.d&&a.tx===b.tx&&a.ty===b.ty}function $i(a,b){const c=Aa.get();b||(b=c.COLOR_ATTACHMENT0);const d=c.createFramebuffer();return c.bindFramebuffer(c.FRAMEBUFFER,d),c.framebufferTexture2D(c.FRAMEBUFFER,b,c.TEXTURE_2D,a,0),c.bindFramebuffer(c.FRAMEBUFFER,null),d}function nd(a){const b=Aa.get();if(!b)return;const{parent:c,flipY:d,unpackPremultiplyAlpha:e,minFilter:f,magFilter:g,wrapS:j,wrapT:i,generateMipmap:k,isPOT:n}=a,u=c.image;let w=c.width,A=c.height;const C=b.createTexture();return b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,C),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,d),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),u?(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,u),w=u.width,A=u.height):b.texImage2D(b.TEXTURE_2D,0,b.RGBA,w,A,0,b.RGBA,b.UNSIGNED_BYTE,null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,g),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,j),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,i),k&&n&&b.generateMipmap(b.TEXTURE_2D),a.texture=C,C}function aj(a){const b=Aa.get();b&&b.isFramebuffer(a)&&b.deleteFramebuffer(a)}function lf(a){const b=Aa.get();if(!b)return;b.isTexture(a)&&b.deleteTexture(a)}function Qi(a,b){return a<1||b<1?!1:(a&a-1)===0&&(b&b-1)===0}function dj(a,b=!0){const c=Aa.get();c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,a);const d=b?c.LINEAR:c.NEAREST;c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,d),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,d)}function ej(a){const b=Aa.get(),c=a.parent.image,d=c.width,e=c.height;return d>0&&e>0&&(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,a.texture),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,a.flipY),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,c)),a.texture}class md{constructor(a,b={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1;const c=Aa.get();this.parent=a,this.isPOT=Qi(a.width,a.height);const{texture:d=null,framebuffer:e=null,unpackPremultiplyAlpha:f=!0,minFilter:g=c.LINEAR,magFilter:j=c.LINEAR,wrapS:i=c.CLAMP_TO_EDGE,wrapT:k=c.CLAMP_TO_EDGE,generateMipmap:n=this.isPOT,flipY:u=!1}=b;this.minFilter=g,this.magFilter=j,this.wrapS=i,this.wrapT=k,this.generateMipmap=n,this.flipY=u,this.unpackPremultiplyAlpha=f,e&&(this.framebuffer=e),d?this.texture=d:nd(this)}setFilter(a){this.texture&&dj(this.texture,a)}create(){const a=this.texture;return a&&lf(a),nd(this)}update(){const a=this.texture;return a?ej(this):nd(this)}setIndex(a){this.dirtyIndex=a!==this.index,this.index=a}destroy(){lf(this.texture),aj(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}}class _i{constructor(a,b,c,d,e){this.batchSize=a,this.dataSize=b,this.indexSize=c,this.vertexElementSize=d,this.quadIndexSize=e,this.vertexByteSize=d*b,this.quadByteSize=this.vertexByteSize*4,this.quadElementSize=d*4,this.bufferByteSize=a*this.quadByteSize,this.create()}create(){let a=[];for(let c=0;c<this.batchSize*this.indexSize;c+=this.indexSize)a.push(c+0,c+1,c+2,c+2,c+3,c+0);this.data=new ArrayBuffer(this.bufferByteSize),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const b=Aa.get();this.vertexBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.data,b.DYNAMIC_DRAW),this.indexBuffer=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.index,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,null),a=[]}destroy(){}}class mf{constructor(a,b,c,d,e,f){this.trimmed=!1,this.texture=a,this.key=b,this.x=c,this.y=d,this.width=e,this.height=f,this.sourceSizeWidth=e,this.sourceSizeHeight=f,this.updateUVs()}setPivot(a,b){this.pivot={x:a,y:b}}setSize(a,b){this.width=a,this.height=b,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.updateUVs()}setSourceSize(a,b){this.sourceSizeWidth=a,this.sourceSizeHeight=b}setTrim(a,b,c,d,e,f){this.trimmed=!0,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.spriteSourceSizeX=c,this.spriteSourceSizeY=d,this.spriteSourceSizeWidth=e,this.spriteSourceSizeHeight=f}getExtent(a,b){const c=this.sourceSizeWidth,d=this.sourceSizeHeight;let e,f,g,j;return this.trimmed?(e=this.spriteSourceSizeX-a*c,f=e+this.spriteSourceSizeWidth,g=this.spriteSourceSizeY-b*d,j=g+this.spriteSourceSizeHeight):(e=-a*c,f=e+c,g=-b*d,j=g+d),{left:e,right:f,top:g,bottom:j}}setExtent(a){const b=a.transform,c=b.origin.x,d=b.origin.y,e=this.sourceSizeWidth,f=this.sourceSizeHeight;let g,j,i,k;this.trimmed?(g=this.spriteSourceSizeX-c*e,j=this.spriteSourceSizeY-d*f,i=this.spriteSourceSizeWidth,k=this.spriteSourceSizeHeight):(g=-c*e,j=-d*f,i=e,k=f),b.setExtent(g,j,i,k)}updateUVs(){const{x:a,y:b,width:c,height:d}=this,e=this.texture.width,f=this.texture.height;this.u0=a/e,this.v0=b/f,this.u1=(a+c)/e,this.v1=(b+d)/f}}class $a{constructor(a,b,c){this.key="",a&&(b=a.width,c=a.height),this.image=a,this.width=b,this.height=c,this.frames=new Map(),this.data={},this.addFrame("__BASE",0,0,b,c),Zb.add(this)}addFrame(a,b,c,d,e){if(this.frames.has(a))return null;const f=new mf(this,a,b,c,d,e);return this.frames.set(a,f),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=f),f}getFrame(a){if(!a)return this.firstFrame;a instanceof mf&&(a=a.key);let b=this.frames.get(a);return b||(console.warn(`Frame missing: ${a}`),b=this.firstFrame),b}setSize(a,b){this.width=a,this.height=b;const c=this.frames.get("__BASE");c.setSize(a,b)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}}let Zi;const xc={get:()=>Zi,set:a=>{Zi=a}};const cj={fragmentShader:`\r
#define SHADER_NAME SINGLE_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture;\r
\r
void main (void)\r
{\r
    vec4 color = texture2D(uTexture, vTextureCoord);\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`,vertexShader:`\r
#define SHADER_NAME SINGLE_QUAD_VERT\r
\r
precision highp float;\r
\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
attribute float aTextureId;\r
attribute vec4 aTintColor;\r
\r
uniform mat4 uProjectionMatrix;\r
uniform mat4 uCameraMatrix;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
void main (void)\r
{\r
    vTextureCoord = aTextureCoord;\r
    vTextureId = aTextureId;\r
    vTintColor = aTintColor;\r
\r
    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\r
}`};class ld{constructor(a={}){this.attribs={aVertexPosition:0,aTextureCoord:0,aTextureId:0,aTintColor:0},this.uniforms={uProjectionMatrix:0,uCameraMatrix:0,uTexture:0,uTime:0,uResolution:0},this.renderToFBO=!1,this.renderer=xc.get();const{batchSize:b=4096,dataSize:c=4,indexSize:d=4,vertexElementSize:e=6,quadIndexSize:f=6,fragmentShader:g=cj.fragmentShader,vertexShader:j=cj.vertexShader,width:i=Wb(),height:k=Xb(),resolution:n=Yb(),renderToFBO:u=!1}=a;this.buffer=new _i(b,c,d,e,f),this.createShaders(g,j),this.count=0,this.renderToFBO=u;const w=new $a(null,i*n,k*n),A=new md(w);w.binding=A,A.framebuffer=$i(A.texture),this.texture=w,this.framebuffer=A.framebuffer}createShaders(a,b){const c=this.renderer.gl,d=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(d,a),c.compileShader(d);let e=!1,f=c.getShaderInfoLog(d);f.length>0&&(e=!0,console.error(f));const g=c.createShader(c.VERTEX_SHADER);c.shaderSource(g,b),c.compileShader(g),f=c.getShaderInfoLog(d),f.length>0&&(e=!0,console.error(f));if(e)return;const j=c.createProgram();c.attachShader(j,g),c.attachShader(j,d),c.linkProgram(j),c.useProgram(j),this.program=j;for(const i of Object.keys(this.attribs)){const k=c.getAttribLocation(j,i);c.enableVertexAttribArray(k),this.attribs[i]=k}for(const i of Object.keys(this.uniforms))this.uniforms[i]=c.getUniformLocation(j,i)}bind(a,b,c){if(!this.program)return!1;const d=this.renderer,e=d.gl,f=this.uniforms;return e.useProgram(this.program),e.uniformMatrix4fv(f.uProjectionMatrix,!1,a),e.uniformMatrix4fv(f.uCameraMatrix,!1,b),e.uniform1i(f.uTexture,d.textures.textureIndex[c]),e.uniform1f(f.uTime,performance.now()),e.uniform2f(f.uResolution,d.width,d.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}bindBuffers(a,b){const c=this.renderer.gl,d=this.buffer.vertexByteSize,e=this.attribs;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a),c.bindBuffer(c.ARRAY_BUFFER,b),c.vertexAttribPointer(e.aVertexPosition,2,c.FLOAT,!1,d,0),c.vertexAttribPointer(e.aTextureCoord,2,c.FLOAT,!1,d,8),c.vertexAttribPointer(e.aTextureId,1,c.FLOAT,!1,d,16),c.vertexAttribPointer(e.aTintColor,4,c.UNSIGNED_BYTE,!0,d,20),this.count=0}draw(a){const b=this.renderer,c=b.gl,d=this.buffer;if(a===d.batchSize)c.bufferData(c.ARRAY_BUFFER,d.data,c.DYNAMIC_DRAW);else{const e=d.vertexViewF32.subarray(0,a*d.quadElementSize);c.bufferSubData(c.ARRAY_BUFFER,0,e)}this.renderToFBO&&b.fbo.add(this.framebuffer,!0),c.drawElements(c.TRIANGLES,a*d.quadIndexSize,c.UNSIGNED_SHORT,0),this.renderToFBO&&b.fbo.pop()}flush(){const a=this.count;return a===0?!1:(this.draw(a),this.prevCount=a,this.count=0,!0)}}const xn=`\r
#define SHADER_NAME MULTI_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture[%count%];\r
\r
void main (void)\r
{\r
    vec4 color;\r
\r
    %forloop%\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`;class Vi extends ld{constructor(a={fragmentShader:xn}){super(a)}createShaders(a,b){const c=pc();let d="";for(let e=1;e<c;e++)e>1&&(d+=`
	else `),e<c-1&&(d+=`if (vTextureId < ${e}.5)`),d+=`
	{`,d+=`
		color = texture2D(uTexture[${e}], vTextureCoord);`,d+=`
	}`;a=a.replace(/%count%/gi,`${c}`),a=a.replace(/%forloop%/gi,d),super.createShaders(a,b)}bind(a,b){if(!this.program)return!1;const c=this.renderer,d=c.gl,e=this.uniforms;return d.useProgram(this.program),d.uniformMatrix4fv(e.uProjectionMatrix,!1,a),d.uniformMatrix4fv(e.uCameraMatrix,!1,b),d.uniform1iv(e.uTexture,c.textures.textureIndex),d.uniform1f(e.uTime,performance.now()),d.uniform2f(e.uResolution,c.width,c.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}}function Wi(a,b,c=-1,d=1){const e=-2*(1/-a),f=-2*(1/b),g=2*(1/(c-d));return new Float32Array([e,0,0,0,0,f,0,0,0,0,g,0,-1,1,0,1])}class Xi{constructor(a,b){this.renderer=a;const c={shader:new b()};this.stack=[c],this.currentEntry=c,this.current=c.shader,this.singleQuadShader=new ld()}add(a,b){const c={shader:a,textureID:b};return this.stack.push(c),c}set(a,b){this.flush();const c=this.renderer,d=c.projectionMatrix,e=c.currentCamera.matrix,f=a.bind(d,e,b);if(f){const g=this.add(a,b);this.currentEntry=g,this.current=a}return f}setDefault(a){this.set(this.singleQuadShader,a)}pop(){this.flush();const a=this.stack;a.length>1&&a.pop(),this.currentEntry=a[a.length-1],this.current=this.currentEntry.shader}reset(){this.pop(),this.rebind()}flush(){return this.current.flush()?(this.renderer.flushTotal++,!0):!1}rebind(){const a=this.renderer,b=a.projectionMatrix,c=a.currentCamera.matrix,d=this.currentEntry;d.shader.bind(b,c,d.textureID)}popAndRebind(){this.pop(),this.rebind()}clear(){}destroy(){}}const vn=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function wn(a){let b="";for(let c=0;c<a;++c)c>0&&(b+=`
else `),c<a-1&&(b+=`if(test == ${c}.0){}`);return b}function bj(a,b){const c=b.createShader(b.FRAGMENT_SHADER);for(;;){const d=vn.replace(/%forloop%/gi,wn(a));b.shaderSource(c,d),b.compileShader(c);if(!b.getShaderParameter(c,b.COMPILE_STATUS))a=a/2|0;else break}return a}class Yi{constructor(a){this.startActiveTexture=0,this.renderer=a,this.tempTextures=[],this.textureIndex=[]}init(){const a=this.renderer.gl;let b=bj(a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),a);const c=pc();c===0||c>0&&c>b?_e(b):c>0&&c<b&&(b=Math.max(8,c));const d=this.tempTextures;d.length&&d.forEach(f=>{a.deleteTexture(f)});const e=[];for(let f=0;f<b;f++){const g=a.createTexture();a.activeTexture(a.TEXTURE0+f),a.bindTexture(a.TEXTURE_2D,g),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),d[f]=g,e.push(f)}this.maxTextures=b,this.textureIndex=e,this.currentActiveTexture=1}update(){const a=Zb.get();for(let b=0;b<a.length;b++){const c=a[b];c.binding||(c.binding=new md(c))}Zb.clear()}reset(){const a=this.renderer.gl,b=this.tempTextures;for(let c=0;c<b.length;c++)a.activeTexture(a.TEXTURE0+c),a.bindTexture(a.TEXTURE_2D,b[c]);this.currentActiveTexture=1,this.startActiveTexture++}bind(a,b=0){const c=this.renderer.gl,d=a.binding;d.setIndex(b),c.activeTexture(c.TEXTURE0+b),c.bindTexture(c.TEXTURE_2D,d.texture)}unbind(a=0){const b=this.renderer.gl;b.activeTexture(b.TEXTURE0+a),b.bindTexture(b.TEXTURE_2D,this.tempTextures[a]),a>0&&this.startActiveTexture++}request(a){const b=this.renderer.gl,c=a.binding,d=this.currentActiveTexture;return c.indexCounter>=this.startActiveTexture?!1:(c.indexCounter=this.startActiveTexture,d<this.maxTextures?(c.setIndex(d),b.activeTexture(b.TEXTURE0+d),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture++):(this.renderer.flush(),this.startActiveTexture++,c.indexCounter=this.startActiveTexture,c.setIndex(1),b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture=2),!0)}}class vi{constructor(){this.clearColor=[0,0,0,1],this.flushTotal=0,this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.currentCamera=null,this.width=Wb(),this.height=Xb(),this.resolution=Yb(),this.setBackgroundColor($c());const a=document.createElement("canvas");a.addEventListener("webglcontextlost",b=>this.onContextLost(b),!1),a.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=a,this.fbo=new Ti(this),this.textures=new Yi(this),this.initContext(),xc.set(this),this.shaders=new Xi(this,Vi)}initContext(){const a=this.canvas.getContext("webgl",af());Aa.set(a),this.gl=a,a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE),this.resize(this.width,this.height,this.resolution),this.textures.init()}resize(a,b,c=1){this.width=a*c,this.height=b*c,this.resolution=c;const d=this.canvas;d.width=this.width,d.height=this.height,this.autoResize&&(d.style.width=(this.width/c).toString()+"px",d.style.height=(this.height/c).toString()+"px"),this.gl.viewport(0,0,this.width,this.height),this.projectionMatrix=Wi(a,b)}onContextLost(a){a.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(a){return Ui(a,this.clearColor),this}reset(a=null,b=this.width,c=this.height){const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),d.viewport(0,0,b,c),d.enable(d.BLEND),d.blendFunc(d.ONE,d.ONE_MINUS_SRC_ALPHA),this.flushTotal=0,this.currentCamera=null,this.textures.update()}render(a){if(this.contextLost)return;this.reset();if(this.optimizeRedraw&&a.numDirtyFrames===0&&a.numDirtyCameras===0)return;const b=this.gl;if(this.clearBeforeRender){const d=this.clearColor;b.clearColor(d[0],d[1],d[2],d[3]),b.clear(b.COLOR_BUFFER_BIT)}const c=a.worldData;for(let d=0;d<c.length;d++){const{camera:e,renderList:f}=c[d];(!this.currentCamera||!Pi(e.worldTransform,this.currentCamera.worldTransform))&&(this.flush(),this.currentCamera=e,this.shaders.rebind()),f.forEach(g=>{g.children.length?this.renderNode(g):g.node.renderGL(this)})}this.flush()}renderNode(a){a.node.renderGL(this),a.children.forEach(b=>{b.children.length>0?this.renderNode(b):b.node.renderGL(this)}),a.node.postRenderGL(this)}flush(){this.shaders.flush()}destroy(){xc.set(void 0)}}function Qe(){return()=>{ad(vi)}}function xa(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);for(const e of d)e.callback.apply(e.context,c),e.once&&d.delete(e);return d.size===0&&a.events.delete(b),!0}function di(a,b){const c=bd(b);return c.appendChild(a),a}function ei(a){const b=document.readyState;if(b==="complete"||b==="interactive"){a();return}const c=()=>{document.removeEventListener("deviceready",c,!0),document.removeEventListener("DOMContentLoaded",c,!0),window.removeEventListener("load",c,!0),a()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",c,!0):(document.addEventListener("DOMContentLoaded",c,!0),window.addEventListener("load",c,!0)):window.setTimeout(c,20)}class We{constructor(){this.events=new Map()}}class sc{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function hb(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new sc(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function uc(a,b,c,d=a){return hb(a,b,c,d,!0)}function fj(){return{gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]}}function ij(a,b=0){a.gameFrame=b,a.numTotalFrames=0,a.numDirtyFrames=0,a.numDirtyCameras=0,a.worldData.length=0}let jj;const od={get:()=>jj,set:a=>{jj=a}};class fi{constructor(){this.scenes=new Map(),this.sceneIndex=0,this.flush=!1,this.renderResult=fj(),this.game=wa.get(),od.set(this),uc(this.game,"boot",()=>this.boot())}boot(){$e().forEach(a=>new a())}update(a,b){for(const c of this.scenes.values())xa(c,"update",a,b)}render(a){const b=this.renderResult;ij(b,a);for(const c of this.scenes.values())xa(c,"render",b);return this.flush&&(b.numDirtyFrames++,this.flush=!1),b}}function zc(a,b){const c=document.createElement("canvas");return c.width=a,c.height=b,c.getContext("2d")}let kj;const Ea={get:()=>kj,set:a=>{kj=a}};class gi{constructor(){this.textures=new Map(),this.createDefaultTextures(),Ea.set(this)}createDefaultTextures(){this.add("__BLANK",new $a(zc(32,32).canvas));const a=zc(32,32);a.strokeStyle="#0f0",a.moveTo(0,0),a.lineTo(32,32),a.stroke(),a.strokeRect(.5,.5,31,31),this.add("__MISSING",new $a(a.canvas))}get(a){const b=this.textures;return b.has(a)?b.get(a):b.get("__MISSING")}has(a){return this.textures.has(a)}add(a,b){let c;const d=this.textures;return d.has(a)||(b instanceof $a?c=b:c=new $a(b),c.key=a,d.set(a,c)),c}}class Wh extends We{constructor(...a){super();this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,wa.set(this),ei(()=>this.boot(a))}boot(a){a.forEach(d=>d());const b=Ue();this.renderer=new b(),this.textureManager=new gi(),this.sceneManager=new fi();const c=Ve();c&&di(this.renderer.canvas,c),this.isBooted=!0,Te(),xa(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(a){const b=a-this.lastTick;this.lastTick=a,this.elapsed+=b,this.isPaused||(this.willUpdate&&(this.sceneManager.update(b,a),xa(this,"update",b,a)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,wa.setFrame(this.frame),wa.setElapsed(this.elapsed),requestAnimationFrame(c=>this.step(c))}destroy(){}}function gj(a,b,c){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:c}function hj(a,b={}){const c=od.get(),d=c.scenes.size,e=c.sceneIndex,f=d===0;typeof b==="string"?a.key=b:(b||!b&&f)&&(a.key=gj(b,"key","scene"+e.toString())),c.scenes.has(a.key)?console.warn("Scene key already in use: "+a.key):(c.scenes.set(a.key,a),c.flush=!0,c.sceneIndex++)}class Xh{constructor(a){this.game=wa.get(),this.events=new Map(),hj(this,a)}}class Cb{constructor(a=1,b=0,c=0,d=1,e=0,f=0){this.set(a,b,c,d,e,f)}set(a=1,b=0,c=0,d=1,e=0,f=0){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=e,this.ty=f,this}identity(){return this.set()}toArray(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]}fromArray(a){return this.set(a[0],a[1],a[2],a[3],a[4],a[5])}}function id(a,b,c){return a.width<=0||a.height<=0?!1:a.x<=b&&a.x+a.width>=b&&a.y<=c&&a.y+a.height>=c}class Ha{constructor(a=0,b=0,c=0,d=0){this.set(a,b,c,d)}set(a=0,b=0,c=0,d=0){return this.x=a,this.y=b,this.width=c,this.height=d,this}contains(a,b){return id(this,a,b)}set right(a){a<=this.x?this.width=0:this.width=a-this.x}get right(){return this.x+this.width}set bottom(a){a<=this.y?this.height=0:this.height=a-this.y}get bottom(){return this.y+this.height}}function Ri(){}class ib{constructor(a,b=0,c=0,d=!1){this.compareValue=!1,this._x=b,this._y=c,this.callback=a,this.compareValue=d}set(a=0,b=0){return this._x=a,this._y=b,this.callback(this),this}destroy(){this.callback=Ri}set x(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._x=a,this.callback(this))}get x(){return this._x}set y(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._y=a,this.callback(this))}get y(){return this._y}}function Oi(a,b,c){const d=c-b;return b+((a-b)%d+d)%d}function ki(a){return Oi(a,-Math.PI,Math.PI)}class li{constructor(){this._rotation=0,this.type="Camera",this.dirtyRender=!0;const a=wa.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1]),this.bounds=new Ha(),this.worldTransform=new Cb(),this.position=new ib(()=>this.updateTransform(),0,0),this.scale=new ib(()=>this.updateTransform(),1,1),this.origin=new ib(()=>this.updateTransform(),.5,.5),this.reset()}updateTransform(){const a=this.matrix,b=this.position.x,c=this.position.y,d=this.scale.x,e=this.scale.y,f=-b+this.width*this.origin.x,g=-c+this.height*this.origin.y,j=Math.sin(this.rotation),i=Math.cos(this.rotation),k=j+j,n=j*k,u=i*k,w=(1-n)*d,A=u*d,C=-u*e,F=(1-n)*e;a[0]=w,a[1]=A,a[4]=C,a[5]=F,a[12]=b+f-(w*f+C*g),a[13]=c+g-(A*f+F*g),this.worldTransform.set(i*d,j*d,-j*e,i*e,-b,-c);const H=this.width*(1/d),Q=this.height*(1/e);this.bounds.set(f-H/2,g-Q/2,H,Q),this.dirtyRender=!0}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}set rotation(a){a!==this._rotation&&(this._rotation=ki(a),this.updateTransform())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.origin.destroy(),this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}class mi{constructor(){this.type="StaticCamera",this.dirtyRender=!0;const a=wa.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.bounds=new Ha(),this.worldTransform=new Cb(),this.reset()}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}function Eb(a){const b=[a],c=[];for(;b.length>0;){const d=b.shift();c.push(d);const e=d.numChildren;if(e>0)for(let f=e-1;f>=0;f--)b.unshift(d.children[f])}return c.shift(),c}function jb(a,b){return a.children.indexOf(b)}function cd(a,b){const c=a.children;let d;if(b>=0&&b<c.length){const e=c.splice(b,1);e[0]&&(d=e[0],d.parent=null)}return d}function rc(a,b){const c=jb(a,b);return c>-1&&cd(a,c),b}const ff="addedtoworld";const dd="destroy";const Ci="postupdate";const gf="removedfromworld";const Di="update";function ef(a,...b){return b.forEach(c=>{c.world&&(xa(c.world,gf,c,c.world),xa(c,gf,c,c.world)),c.world=a,xa(a,ff,c,a),xa(c,ff,c,a)}),b}function Db(a,...b){b.forEach(d=>{d.parent&&rc(d.parent,d),d.parent=a});const c=a.world;return c&&ef(c,...Eb(a)),b}const aa={CLEAR:0,TRANSFORM:1,UPDATE:2,CHILD_CACHE:4,POST_RENDER:8,COLORS:16,BOUNDS:32,TEXTURE:64,FRAME:128,ALPHA:256,CHILD:512,DEFAULT:1+2+16+32,USER1:536870912,USER2:1073741824,USER3:2147483648,USER4:4294967296};function qc(a,b=0,c){const d=a.children;c===void 0&&(c=d.length);const e=c-b;if(e>0&&e<=c){const f=d.splice(b,e);return f.forEach(g=>{g.parent=null}),f}else return[]}function bf(a,b=0,c){const d=qc(a,b,c);d.forEach(e=>{e.destroy()})}function cf(a,...b){return b.forEach(c=>{rc(a,c)}),b}function df(a,b,c=0,d){const e=qc(a,c,d);return Db(b,...e),e.forEach(f=>{f.transform.updateWorld()}),e}function tc(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof sc)g.delete(c);else{const j=!d,i=e!==void 0;for(const k of g)k.callback===c&&(j&&k.context===d)&&(i&&k.once===e)&&g.delete(k)}return g.size===0&&f.delete(b),a}function fd(a){const{a:b,b:c,c:d,d:e,tx:f,ty:g}=a.world,{x:j,y:i,right:k,bottom:n}=a.extent,u=j*b+i*d+f,w=j*c+i*e+g,A=j*b+n*d+f,C=j*c+n*e+g,F=k*b+n*d+f,H=k*c+n*e+g,Q=k*b+i*d+f,L=k*c+i*e+g;return{x0:u,y0:w,x1:A,y1:C,x2:F,y2:H,x3:Q,y3:L}}class wi{constructor(a){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=a,this.area=new Ha()}set(a,b,c,d){this.area.set(a,b,c,d)}get(){return this.entity.isDirty(aa.BOUNDS)&&!this.fixed&&this.update(),this.area}updateLocal(){const{x0:a,y0:b,x1:c,y1:d,x2:e,y2:f,x3:g,y3:j}=fd(this.entity.transform),i=Math.min(a,c,e,g),k=Math.min(b,d,f,j),n=Math.max(a,c,e,g),u=Math.max(b,d,f,j);return this.area.set(i,k,n-i,u-k)}update(){const a=this.updateLocal();this.entity.clearDirty(aa.BOUNDS);if(!this.includeChildren||!this.entity.numChildren)return a;const b=this.visibleOnly,c=this.entity.children;let d=a.x,e=a.y,f=a.right,g=a.bottom;for(let j=0;j<c.length;j++){const i=c[j];if(!i||b&&!i.visible)continue;const k=i.bounds.get();k.x<d&&(d=k.x),k.y<e&&(e=k.y),k.right>f&&(f=k.right),k.bottom>g&&(g=k.bottom)}return a.set(d,e,f-d,g-e)}destroy(){this.entity=null,this.area=null}}class xi{constructor(a){this.enabled=!1,this.enabledChildren=!0,this.entity=a}destroy(){this.entity=null,this.hitArea=null}}class _a{constructor(a=0,b=0){this.set(a,b)}set(a=0,b=0){return this.x=a,this.y=b,this}getArray(){return[this.x,this.y]}fromArray(a){return this.set(a[0],a[1])}toString(){return`[x=${this.x}, y=${this.y}]`}}function zi(a){const b=a.local,c=a.position.x,d=a.position.y,e=a.rotation,f=a.scale.x,g=a.scale.y,j=a.skew.x,i=a.skew.y;b.set(Math.cos(e+i)*f,Math.sin(e+i)*f,-Math.sin(e-j)*g,Math.cos(e-j)*g,c,d)}function hf(a,b){return b.set(a.a,a.b,a.c,a.d,a.tx,a.ty)}function Ai(a){const b=a.parent,c=a.transform,d=c.local,e=c.world;if(!b)hf(d,e);else if(c.passthru)hf(b.transform.world,e);else{const{a:f,b:g,c:j,d:i,tx:k,ty:n}=d,{a:u,b:w,c:A,d:C,tx:F,ty:H}=b.transform.world;e.set(f*u+g*A,f*w+g*C,j*u+i*A,j*w+i*C,k*u+n*A+F,k*w+n*C+H)}}class yi{constructor(a,b=0,c=0){this.passthru=!1,this._rotation=0,this.entity=a,this.local=new Cb(),this.world=new Cb(),this.position=new ib(()=>this.update(),b,c),this.scale=new ib(()=>this.update(),1,1,!0),this.skew=new ib(()=>this.update(),0,0,!0),this.origin=new ib(()=>this.updateExtent(),Ye,Ze),this.extent=new Ha()}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(aa.TRANSFORM,aa.BOUNDS),zi(this)}updateWorld(){const a=this.entity;a.setDirty(aa.TRANSFORM,aa.BOUNDS),Ai(a),a.numChildren&&this.updateChildren()}updateChildren(){const a=this.entity.children;for(let b=0;b<a.length;b++){const c=a[b];c.transform.updateWorld()}}globalToLocal(a,b,c=new _a()){const{a:d,b:e,c:f,d:g,tx:j,ty:i}=this.world,k=1/(d*g+f*-e);return c.x=g*k*a+-f*k*b+(i*f-j*g)*k,c.y=d*k*b+-e*k*a+(-i*d+j*e)*k,c}localToGlobal(a,b,c=new _a()){const{a:d,b:e,c:f,d:g,tx:j,ty:i}=this.world;return c.x=d*a+f*b+j,c.y=e*a+g*b+i,c}setExtent(a,b,c,d){this.extent.set(a,b,c,d),this.entity.setDirty(aa.TRANSFORM,aa.BOUNDS)}updateExtent(a,b){const c=this.extent,d=this.entity;a!==void 0&&(c.width=a),b!==void 0&&(c.height=b),c.x=-this.origin.x*c.width,c.y=-this.origin.y*c.height,d.setDirty(aa.TRANSFORM,aa.BOUNDS)}set rotation(a){a!==this._rotation&&(this._rotation=a,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}}class ed{constructor(a=0,b=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.events=new Map(),this.transform=new yi(this,a,b),this.bounds=new wi(this),this.input=new xi(this),this.dirty=aa.DEFAULT,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(a){return(this.dirty&a)!==0}clearDirty(a){return this.isDirty(a)&&(this.dirty^=a),this}setDirty(a,b){return this.isDirty(a)||(this.dirty^=a,this.dirtyFrame=wa.getFrame()),this.isDirty(b)||(this.dirty^=b),this}update(a,b){if(this.willUpdateChildren){const c=this.children;for(let d=0;d<c.length;d++){const e=c[d];e&&e.willUpdate&&e.update(a,b)}}this.postUpdate(a,b)}postUpdate(a,b){}renderGL(a){}renderCanvas(a){}postRenderGL(a){}postRenderCanvas(a){}get numChildren(){return this.children.length}destroy(a){a?df(this,a):bf(this),xa(this,dd,this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}}const jd="worldrender";const kd="worldshutdown";var un=Object.freeze({__proto__:null,WorldRenderEvent:jd,WorldShutdownEvent:kd});function pd(a,b){b.numRendered++,b.numRenderable++,a.node.dirtyFrame>=b.gameFrame&&b.dirtyFrame++,a.children.forEach(c=>{c.children.length>0&&pd(c,b)})}function qf(a){if(a.node.isDirty(aa.CHILD_CACHE))return!0;const b=[a];for(;b.length>0;){const c=b.pop();if(c.node.isDirty(aa.TRANSFORM))return!0;const d=c.children.length;if(d>0)for(let e=0;e<d;e++)b.push(c.children[e])}return b.length=0,!1}function pf(a,b){a.forEach(c=>{b||qf(c)?c.node.setDirty(aa.CHILD_CACHE):c.children.length=0})}function qd(a,b,c=[]){for(let d=0;d<b.numChildren;d++){const e=b.children[d];if(e.isRenderable()){const f=[],g={node:e,children:f};c.push(g),e.willRenderChildren&&e.numChildren>0&&(e.willCacheChildren&&a.push(g),qd(a,e,f))}}return c}function nf(a){const b=[],c=[],d=qd(b,a,c),e=a.renderData;b.length>0&&pf(b,a.camera.dirtyRender),d.forEach(f=>{f.children.length?pd(f,e):(e.numRendered++,e.numRenderable++,f.node.dirtyFrame>=e.gameFrame&&e.dirtyFrame++)}),e.renderList=d,a.forceRefresh&&(e.dirtyFrame++,a.forceRefresh=!1)}function of(a,b){a.numDirtyFrames+=b.dirtyFrame,a.numTotalFrames+=b.numRendered,b.camera.dirtyRender&&a.numDirtyCameras++,a.worldData.push(b)}function Ac(a,b){a.gameFrame=b,a.dirtyFrame=0,a.numRendered=0,a.numRenderable=0,a.renderList.length=0}class Bc extends ed{constructor(a){super();this.forceRefresh=!1,this.type="BaseWorld",this.scene=a,this.world=this,this.events=new Map(),this._updateListener=hb(a,"update",(b,c)=>this.update(b,c)),this._renderListener=hb(a,"render",b=>this.render(b)),this._shutdownListener=hb(a,"shutdown",()=>this.shutdown()),uc(a,"destroy",()=>this.destroy())}update(a,b){if(!this.willUpdate)return;xa(this,Di,a,b,this),super.update(a,b)}postUpdate(a,b){xa(this,Ci,a,b,this)}render(a){const b=this.renderData;Ac(b,a.gameFrame);if(!this.willRender||!this.visible)return;nf(this),xa(this,jd,b,this),of(a,b),this.camera&&(this.camera.dirtyRender=!1)}shutdown(){const a=this.scene;tc(a,"update",this._updateListener),tc(a,"render",this._renderListener),tc(a,"shutdown",this._shutdownListener),cf(this),xa(this,kd,this),Ac(this.renderData,0),this.camera&&this.camera.reset()}destroy(a){super.destroy(a),xa(this,dd,this),Ac(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}}function Cc(a){return{camera:a,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0,renderList:[]}}class Re extends Bc{constructor(a){super(a);this.type="StaticWorld",this.camera=new mi(),this.renderData=Cc(this.camera)}}class yn extends Bc{constructor(a){super(a);this.enableCameraCull=!0,this.type="World",this.camera=new li(),this.renderData=Cc(this.camera)}}function Zc(a,b){return a.children.push(b),Db(a,b),b.transform.updateWorld(),b}class Li{constructor(a,b,c){this.responseType="text",this.crossOrigin=void 0,this.skipCache=!1,this.hasLoaded=!1,this.key=a,this.url=b,this.config=c}}function Mi(a,b,c,d){return b||(b=a+c),/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/.exec(b)?b:d?d.baseURL+d.path+b:b}function Ni(a){return a.data=new Image(),a.crossOrigin&&(a.data.crossOrigin=a.crossOrigin),new Promise((b,c)=>{a.data.onload=()=>{a.data.onload&&(a.data.onload=null,a.data.onerror=null,b(a))},a.data.onerror=d=>{a.data.onload&&(a.data.onload=null,a.data.onerror=null,a.error=d,c(a))},a.data.src=a.url,a.data.complete&&a.data.width&&a.data.height&&(a.data.onload=null,a.data.onerror=null,b(a))})}function Yh(a,b){const c=new Li(a,b);return c.load=()=>(c.url=Mi(c.key,c.url,".png",c.loader),c.loader&&(c.crossOrigin=c.loader.crossOrigin),new Promise((d,e)=>{const f=Ea.get();f.has(c.key)?d(c):Ni(c).then(g=>{f.add(g.key,g.data),d(g)}).catch(g=>{e(g)})})),c}var Mh;(function(a){a[a.IDLE=0]="IDLE",a[a.UPDATING=1]="UPDATING"})(Mh||(Mh={}));function Ra(a,b){return a===void 0||b===void 0?void 0:`${a}|${b}`}function nk(a,b){let c=a.split("|");return b===void 0&&(b=wo),b.x=parseInt(c[0]),b.y=parseInt(c[1]),b}let wo={x:0,y:0};class Sb{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(a){return this.items.push(a),this}pushMultiple(a){return this.items.push.apply(this.items,a),a.length=0,this}clear(){return this.items.length=0,this}}let cn=new Sb();function vj(){let a=cn.pop();return a===null&&(a=new Map()),a}function Jd(a){cn.push(a)}function tj(a,b,c,d,e,f,g,j){if(c===f&&d===g&&e===j)return;let i=Ra(c,d),k=Ra(f,g);if(i){let n=b.get(i);n.delete(e);if(i===k){n.set(j,a);return}else n.size===0&&(Jd(n),b.delete(i))}if(k){let n=b.get(k);n?n.set(j,a):(n=vj(),n.set(j,a),b.set(k,n))}}function Jf(a,b,c,d){let e=Ra(b,c),f=a.get(e);f&&(d!==void 0?(f.delete(d),f.size===0&&(Jd(f),a.delete(e))):(f.clear(),Jd(f),a.delete(e)))}let dn=new Sb();function uj(){let a=dn.pop();return a===null&&(a=new Set()),a}function If(a){dn.push(a)}function Id(a,b,c,d){if(c===d)return;if(c!==void 0){let e=b.get(c);e&&(e.delete(a),e.size===0&&(If(e),b.delete(c)))}if(d!==void 0){let e=b.get(d);e?e.add(a):(e=uj(),e.add(a),b.set(d,e))}}function Ib(a,b,c){let d=a.get(b);d&&(d.delete(c),d.size===0&&(If(d),a.delete(b)))}function oj(a,b,c,d,e){let f=a.chessToXYZ.get(b),g=f?f.x:void 0,j=f?f.y:void 0,i=f?f.y:void 0;f?(f.x=c,f.y=d,f.z=e):a.chessToXYZ.set(b,{x:c,y:d,z:e}),tj(b,a.XYToZMap,g,j,i,c,d,e),Id(b,a.XToChessSet,g,c),Id(b,a.YToChessSet,j,d),Id(b,a.ZToChessSet,i,e)}function Hb(a,b,c,d){let e=a.XYToZMap.get(Ra(b,c));return e===void 0?null:d!==void 0?e.has(d)?e.get(d):null:e}function pj(a,b,c,d){if(d!==void 0){let e=Hb(a,b,c,d);if(e===void 0)return;a.chessToXYZ.delete(e),Jf(a.XYToZMap,b,c,d),Ib(a.XToChessSet,b,e),Ib(a.YToChessSet,c,e),Ib(a.ZToChessSet,d,e)}else{let e=Hb(a,b,c);if(e){for(const[f,g]of e)a.chessToXYZ.delete(g),Ib(a.XToChessSet,b,g),Ib(a.YToChessSet,c,g),Ib(a.ZToChessSet,f,g);Jf(a.XYToZMap,b,c)}}}function qj(a,b){return a.chessToXYZ.has(b)}function rj(a,b,c,d){return Hb(a,b,c,d)!==null}function sj(a,b){return a.chessToXYZ.get(b)||null}function Gf(a){let b=-Infinity;for(const[c,d]of a)b<c&&(b=c);return b}function Hf(a){let b=Infinity;for(const[c,d]of a)b>c&&(b=c);return b}class rf{constructor(){this.chessToXYZ=new Map(),this.XYToZMap=new Map(),this.XToChessSet=new Map(),this.YToChessSet=new Map(),this.ZToChessSet=new Map(),this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0}destroy(){this.clear()}clear(){return this.chessToXYZ.clear(),this.XYToZMap.clear(),this.XToChessSet.clear(),this.YToChessSet.clear(),this.ZToChessSet.clear(),this.clearBounds(),this}clearBounds(){return this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0,this}addChess(a,b,c,d){return oj(this,a,b,c,d),this.clearBounds(),this}getChess(a,b,c){return Hb(this,a,b,c)}removeChess(a,b,c){return pj(this,a,b,c),this.clearBounds(),this}hasChess(a){return qj(this,a)}contains(a,b,c){return rj(this,a,b,c)}getXYZ(a){return sj(this,a)}get xMax(){return this._xMax===void 0&&(this._xMax=Gf(this.XToChessSet)),this._xMax}get xMin(){return this._xMin===void 0&&(this._xMin=Hf(this.XToChessSet)),this._xMin}get yMax(){return this._yMax===void 0&&(this._yMax=Gf(this.YToChessSet)),this._yMax}get yMin(){return this._yMin===void 0&&(this._yMin=Hf(this.YToChessSet)),this._yMin}}function ab(a,b=[]){let c=a.boardData.chessToXYZ;for(const[d,e]of c)b.push(d);return b}function ok(a){if(typeof a!=="object"||a.nodeType||a===a.window)return!1;try{if(a.constructor&&!{}.hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0}function Hc(a){return ok(a)?!0:typeof a==="object"?a.isTileXYZ:!1}function ba(a,b){let c=a.boardData.getXYZ(b);return c?c:Hc(b)?b:null}function qa(a,b,c,d){return a.boardData.getChess(b,c,d)}class wj{constructor(a){this.parent=a,this.board=null,this.blocker=!1,this.boot()}boot(){typeof this.parent==="object"&&this.parent.on&&this.parent.on("destroy",this.destroy,this)}destroy(){if(this.board){let a=this.tileXYZ;this.board.boardData.removeChess(a.x,a.y,a.z)}this.parent=void 0,this.board=null}setBoard(a){return this.board=a,this}get tileXYZ(){return this.board==null?null:this.board.boardData.getXYZ(this.parent)}setBlocker(a=!0){return this.blocker=a,this}setBlockEdge(a,b=!0){typeof this.blocker==="boolean"&&(this.blocker={});let c=this.blocker;if(typeof a==="object"){let d=a;for(let e in d)c[e]=d[e]}else c[a]=b;return this}getBlockEdge(a){return typeof this.blocker==="boolean"?!1:this.blocker.hasOwnProperty(a)?this.blocker[a]:!1}}function Ua(a){return a.hasOwnProperty("rexChess")||(a.rexChess=new wj(a)),a.rexChess}function Na(a,b,c,d,e,f=!1,g=!1){if(b){let j=ba(a,b);if(j)c=j.x,d=j.y,e=j.z;else return}else{b=qa(a,c,d,e);if(!b)return}g||a.boardData.removeChess(c,d,e),a._isBoard&&Ua(b).setBoard(null),f&&b.destroy&&b.destroy()}function Gb(a,b){if(a.infinityMode)return;if(a.height===void 0||a.height<=b){a.height=b;return}let c=ab(a);c.forEach(d=>{let e=ba(a,d);e.y>b&&Na(a,d)}),a.height=b}function Fb(a,b){if(a.infinityMode)return;if(a.width===void 0||a.width<=b){a.width=b;return}let c=ab(a);c.forEach(d=>{let e=ba(a,d);e.x>b&&Na(a,d)}),a.width=b}class rd{constructor({grid:a=void 0,wrap:b=!1,inifinity:c=!1,width:d=0,height:e=0}={}){this.boardData=new rf(),this._isBoard=!0,this.setGrid(a),this.setWrapMode(b),this.setInfinityMode(c),this.setBoardSize(d,e)}destroy(){}setGrid(a){return this.grid=a,this}setWrapMode(a=!0){return this.wrapMode=a,this}setInfinityMode(a=!0){return this.infinityMode=a,this}setBoardSize(a=0,b=0){return Fb(this,a),Gb(this,b),this}}function Ta(a,b,c,d){let e;return a.infinityMode?e=!0:e=b>=0&&b<a.width&&c>=0&&c<a.height,e&&d!==void 0&&(e=a.boardData.contains(b,c,d)),e}function Fa(a,b,c,d){return a.grid.getWorldXY(b,c,d)}function ec(a,b,c,d){if(b===void 0){let e=ab(a);for(let f=0,g=e.length;f<g;f++){let j=e[f],i=ba(a,j);Fa(a,i.x,i.y,j)}}else{if(c===void 0){let e=ba(a,b);c=e.x,d=e.y}Fa(a,c,d,b)}}function pb(a,b,c,d,e,f=!0){if(!Ta(a,c,d))return;let g=ba(a,b);e===void 0&&(g?e=g.z:e=0);if(g&&g.x===c&&g.y===d&&g.z===e)return;let j=qa(a,c,d,e);j&&Na(a,null,c,d,e),a.boardData.addChess(b,c,d,e),a._isBoard&&Ua(b).setBoard(a),f&&ec(a,b,c,d)}function Mb(a,b,c,d){return Math.atan2(d-b,c-a)}function qb(a,b,c){let d=ba(a,b),e=ba(a,c),f=Fa(a,d.x,d.y,!0),g=f.x,j=f.y;f=Fa(a,e.x,e.y,!0);let i=f.x,k=f.y;return Mb(g,j,i,k)}function kb(a,b,c){let d=c-b;return b+((a-b)%d+d)%d}function dc(a,b,c,d={x:0,y:0}){return d===!0&&(d=En),a.wrapMode?b=kb(b,0,a.width):!a.infinityMode&&(b<0||b>=a.width)&&(b=null),a.wrapMode?c=kb(c,0,a.height):!a.infinityMode&&(c<0||c>=a.height)&&(c=null),d.x=b,d.y=c,d}let En={x:0,y:0};function Ma(a,b,c,d,e){let f=ba(a,b);if(f===null)return null;typeof c==="string"&&(c.indexOf(",")===-1?c=parseInt(c):c=c.split(".").map(k=>parseInt(k,10)));let g=typeof c==="number",j=typeof d==="number";if(g&&j){let k=a.grid.getTileXYAtDirection(f,c,d,e);return dc(a,k.x,k.y,k),(k.x===null||k.y===null)&&(k=null),k}Array.isArray(e)||(e=[]),c===null&&(c=a.grid.allDirections);let i;if(g)if(Array.isArray(d))for(let k=0,n=d.length;k<n;k++)i=Ma(a,f,c,d[k]),i!==null&&e.push(i);else{let k,n,u;({end:k=1,start:n=k>0?1:-1,step:u=k>=n?1:-1}=d);if(n===k)i=Ma(a,f,c,k),i!==null&&e.push(i);else if(n<k)for(let w=n;w<=k;w+=u)i=Ma(a,f,c,w),i!==null&&e.push(i);else for(let w=n;w>=k;w+=u)i=Ma(a,f,c,w),i!==null&&e.push(i)}else for(let k=0,n=c.length;k<n;k++)j?(i=Ma(a,f,c[k],d),i!==null&&e.push(i)):Ma(a,f,c[k],d,e);return e}function eb(a,b,c=null,d={x:0,y:0}){return Ma(a,b,c,1,d)}function ac(a,b,c){b===void 0&&(b=In);let d=a.wrapMode,e=a.infinityMode;a.wrapMode=!1,a.infinityMode=!0;let f=eb(a,b,c,!0);return a.wrapMode=d,a.infinityMode=e,qb(a,b,f)}let In={x:0,y:0};const Np=180/Math.PI;function hc(a){return a*Np}function Aj(a,b){let c=b-a;if(c===0)return 0;let d=Math.floor((c- -180)/360);return c-d*360}function $b(a,b,c){c=hc(c);let d=a.grid.allDirections,e=Infinity,f;for(let g=0,j=d.length;g<j;g++){let i=hc(ac(a,b,d[g])),k=Math.abs(Aj(c,i));k<e&&(e=k,f=g)}return f}function cc(a,b,c){if(b===null||c===null)return null;if(b.x===c.x&&b.y===c.y)return null;let d=a.grid.getNeighborTileDirection(b,c);if(a.wrapMode&&d===null){let e=eb(a,b,null);for(let f=0,g=e.length;f<g;f++){let j=e[f];if(c.x===j.x&&c.y===j.y){d=f;break}}}return d}function bc(a,b,c){let d=ba(a,b),e=ba(a,c);return cc(a,d,e)}function td(a,b,c){return bc(a,b,c)!==null}function ud(a,b,c,d=!0){let e=ba(a,b),f=ba(a,c);return e===null||f===null?null:a.grid.directionBetween(e,f,d)}function Ec(a,b,c=1,d=[]){let e=a.grid.ringToTileXYArray(b,c);for(let f=0,g=e.length;f<g;f++){let j=e[f];Ta(a,j.x,j.y)&&d.push(j)}return d}function sf(a,b,c,d=!0,e=[]){for(let f=0;f<=c;f++){let g=d?f:c-f;Ec(a,b,g,e)}return e}function bb(a,b,c,d,e={x:0,y:0}){return e===!0&&(e=Gn),c===0&&d===0?(e.x=b.x,e.y=b.y):a.grid.offset(b,c,d,e),e}let Gn={x:0,y:0};function tf(a,b){let c=Infinity,d=Infinity,e;for(let j=0,i=b.length;j<i;j++)e=b[j],c=Math.min(c,e.x),d=Math.min(d,e.y);if(c!==0||d!==0)for(let j=0,i=b.length;j<i;j++)e=b[j],bb(a,e,-c,-d,e);let f=-Infinity,g=-Infinity;for(let j=0,i=b.length;j<i;j++)e=b[j],f=Math.max(f,e.x),g=Math.max(g,e.y);return Fb(a,f+1),Gb(a,g+1),b}var Kb;(function(a){a[a["x+,y+"]=0]="x+,y+",a[a["x-,y+"]=1]="x-,y+",a[a["y+,x+"]=2]="y+,x+",a[a["y-,x+"]=3]="y-,x+"})(Kb||(Kb={}));function vd(a,b,c,d=0){let e={x:0,y:0};switch(d){case 0:for(let f=0;f<a.height;f++)for(let g=0;g<a.width;g++)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 1:for(let f=0;f<a.height;f++)for(let g=a.width-1;g>=0;g--)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 2:for(let f=0;f<a.width;f++)for(let g=0;g<a.height;g++)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a);break;case 3:for(let f=0;f<a.width;f++)for(let g=a.height-1;g>=0;g--)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a)}}function wd(a,b,c,d){return a.grid.getDistance(b,c,d)}function Dc(a,b=0,c=[]){if(Array.isArray(b)){let d=b;for(let e=0;e<a.height;e++)for(let f=0;f<a.width;f++){let g=!0;for(let j=0,i=d.length;j<i;j++)if(qa(a,f,e,d[j])!==null){g=!1;break}g&&c.push({x:f,y:e})}}else for(let d=0;d<a.height;d++)for(let e=0;e<a.width;e++)qa(a,e,d,b)===null&&c.push({x:e,y:d});return c}function xd(a,b,c,d){return a.grid.getGridPoints(b,c,d)}function Oa(a,b,c,d=[]){let e=a.boardData.getChess(b,c);for(const[f,g]of e)d.push(g);return d}function fc(a,b,c,d=[]){let e=c!=null,f,g;for(let j=0,i=b.length;j<i;j++)f=b[j],e?(g=qa(a,f.x,f.y,c),g!==null&&d.push(g)):Oa(a,f.x,f.y,d);return d}function yd(a,b,c,d,e){let f=ba(a,b);if(f===null)return null;d==null&&(d=f.hasOwnProperty("z")?f.z:null);let g=eb(a,f,c,!0);return g===null?null:Array.isArray(g)?(e===void 0&&(e=[]),fc(a,g,d,e)):d==null?(e===void 0&&(e=[]),Oa(a,g.x,g.y,e)):qa(a,g.x,g.y,d)}function zd(a,b,c,d={x:0,y:0}){let e=$b(a,b,c);return Ma(a,b,e,1,d)}function Ad(a,b,c,d){return a.grid.getOppositeDirection(b,c,d)}function Fc(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function gc(a,b=0,c=a.length){let d=b+Math.floor(Math.random()*c);return a[d]===void 0?null:a[d]}function uf(a,b=0,c={x:0,y:0}){c===!0&&(c=Bn);let d=Math.floor(a.width*a.height*.3);for(let f=0;f<d;f++){let g=Fc(0,a.width-1),j=Fc(0,a.height-1);if(qa(a,g,j,b)===null)return c.x=g,c.y=j,c}let e=Dc(a,b);if(e.length===0)return null;{let f=gc(e);return c.x=f.x,c.y=f.y,c}}let Bn={x:0,y:0};function vf(a,b,c,d){if(d===void 0){let e=Oa(a,b,c);for(let f=0,g=e.length;f<g;f++){let j=Ua(e[f]).blocker;if(j===!0)return!0}return!1}else{let e=qa(a,b,c,d);if(e===null)return!1;let f=Ua(e).blocker;return f===!0}}function wf(a,b){return a.boardData.chessToXYZ.has(b)}function xf(a,b,c,d,e){if(d===void 0){let f=Oa(a,b,c);for(let g=0,j=f.length;g<j;g++)if(nj(Ua(f[g]).blocker,e))return!0;return!1}else{let f=qa(a,b,c,d);return f===null?!1:nj(Ua(f).blocker,e)}}function nj(a,b){return a===!1||a===!0?a:a[b]===!0}function Lf(a){return a=a%_m,a>=0?a:a+_m}const _m=Math.PI*2;function Bj(a,b,c=1e-4){return Math.abs(a-b)<c}function Bd(a,b,c,d,e){let f=ba(a,b),g=ba(a,c),j=qb(a,f,g);j=Lf(j);let i=Math.abs(j-d);i=Math.min(i,Jn-i);let k=e/2;return Bj(i,k)||i<k}const Jn=Math.PI*2;function Cd(a,b,c,d,e){let f=ba(a,b),g=ba(a,c),j=a.grid.directions;a.grid.directions=a.grid.sides;let i=a.grid.directionBetween(f,g,!1);a.grid.directions=j;let k=Math.abs(i-d);return k=Math.min(k,a.grid.directions-k),k<=e/2}function Ia(a,b,c,d={x:0,y:0}){return a.grid.getTileXY(b,c,d)}function Dd(a,b,c,d){if(a.infinityMode&&d===void 0)return!0;let e=Ia(a,b,c,!0);return Ta(a,e.x,e.y,d)}function zj(a,b,c,d){let e=a-c,f=b-d;return Math.sqrt(e*e+f*f)}function Kf(a,b,c){return(b-a)*c+a}function yf(a,b,c,d,e,f=[]){let g=zj(b,c,d,e),j=Math.min(a.grid.width,a.grid.height),i=Math.ceil(g/(j/4)),k;for(let n=0;n<=i;n++){let u=n/i,w=Kf(b,d,u),A=Kf(c,e,u),C=Ia(a,w,A);if(!Ta(a,C.x,C.y))continue;if(k&&k.x===C.x&&k.y===C.y)continue;f.push(C),k=C}return f}var Lb;(function(a){a[a.x=1]="x",a[a.horizontal=1]="horizontal",a[a.h=1]="h",a[a.y=2]="y",a[a.vertical=2]="vertical",a[a.v=2]="v",a[a.xy=3]="xy"})(Lb||(Lb={}));function zf(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=Fn),d!==null?bb(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.mirror(e,c,e),d!==null&&bb(a,e,d.x,d.y,e),e}let Fn={x:0,y:0};function Af(a,b=!1,c=!1){let d=ab(a);for(let e=0,f=d.length;e<f;e++)Na(a,d[e],void 0,void 0,void 0,b,c)}function Bf(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=Hn),d!==null?bb(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.rotate(e,c,e),d!==null&&bb(a,e,d.x,d.y,e),e}let Hn={x:0,y:0};function Cf(a,b,c){let d=ba(a,b);if(d===null)return;pb(a,b,d.x,d.y,c)}function Gc(a,b,c){return Math.max(b,Math.min(c,a))}function Df(a,b,c,d=[]){let e=Ia(a,b.left,b.top,!0),f=e.x-1,g=e.y-1,j=Ia(a,b.right,b.bottom,!0),i=j.x+1,k=j.y+1;a.infinityMode||(f=Gc(f,0,a.width-1),g=Gc(g,0,a.height-1),i=Gc(i,0,a.width-1),k=Gc(k,0,a.height-1));for(let n=f;n<=i;n++)for(let u=g;u<=k;u++){let w=Fa(a,n,u,!0);c(b,w.x,w.y)&&d.push({x:n,y:u})}return d}function Ef(a,b,c,d=!0){let e=ba(a,b),f=ba(a,c);if(e==null||f==null)return;Na(a,b),Na(a,c),pb(a,b,f.x,f.y,f.z,d),pb(a,c,e.x,e.y,e.z,d)}function Ed(a,b,c=[]){let d=a.boardData.ZToChessSet.get(b);if(d)for(const e of d)c.push(e);return c}function Fd(a,b,c=[]){for(let d=0,e=b.length;d<e;d++){let f=b[d];c.push(Fa(a,f.x,f.y))}return c}function Gd(a,b,c,d={x:0,y:0}){return d===!0&&(d=Kn),Ia(a,b,c,d),Fa(a,d.x,d.y,d),d}let Kn={x:0,y:0};function Hd(a,b,c,d,e){let f=Ia(a,b,c,!0);return d!==void 0?qa(a,f.x,f.y,d):Oa(a,f.x,f.y,e)}class sd extends rd{addChess(a,b,c,d,e=!0){return pb(this,a,b,c,d,e),this}angleBetween(a,b){return qb(this,a,b)}angleSnapToDirection(a,b){return $b(this,a,b)}angleToward(a,b){return ac(this,a,b)}areNeighbors(a,b){return td(this,a,b)}chessToTileXYZ(a){return ba(this,a)}contains(a,b,c){return Ta(this,a,b,c)}directionBetween(a,b,c=!0){return ud(this,a,b,c)}filledRingToTileXYArray(a,b,c=!0,d=[]){return sf(this,a,b,c,d)}fit(a){return tf(this,a)}forEachTileXY(a,b,c=0){return vd(this,a,b,c),this}getAllChess(a=[]){return ab(this,a)}getChessData(a){return Ua(a)}getDistance(a,b,c=!1){return wd(this,a,b,c)}getEmptyTileXYArray(a=0,b=[]){return Dc(this,a,b)}getGridPoints(a,b,c){return xd(this,a,b,c)}getNeighborChess(a,b,c,d){return yd(this,a,b,c,d)}getNeighborChessDirection(a,b){return bc(this,a,b)}getNeighborTileDirection(a,b){return cc(this,a,b)}getNeighborTileXY(a,b=null,c={x:0,y:0}){return eb(this,a,b,c)}getNeighborTileXYAtAngle(a,b,c={x:0,y:0}){return zd(this,a,b,c)}getOppositeDirection(a,b,c){return Ad(this,a,b,c)}getRandomEmptyTileXY(a=0,b={x:0,y:0}){return uf(this,a,b)}getTileXYAtDirection(a,b,c,d){return Ma(this,a,b,c,d)}getWrapTileXY(a,b,c={x:0,y:0}){return dc(this,a,b,c)}gridAlign(a,b,c){return ec(this,a,b,c),this}hasBlocker(a,b,c){return vf(this,a,b,c)}hasChess(a){return wf(this,a)}hasEdgeBlocker(a,b,c,d){return xf(this,a,b,c,d)}isAngleInCone(a,b,c,d){return Bd(this,a,b,c,d)}isDirectionInCone(a,b,c,d){return Cd(this,a,b,c,d)}isOverlappingPoint(a,b,c){return Dd(this,a,b,c)}lineToTileXYArray(a,b,c,d,e=[]){return yf(this,a,b,c,d,e)}mirror(a,b,c=null,d={x:0,y:0}){return zf(this,a,b,c,d)}offset(a,b,c,d){return bb(this,a,b,c,d)}removeAllChess(a=!1,b=!1){return Af(this,a,b),this}removeChess(a,b,c,d,e=!1,f=!1){return Na(this,a,b,c,d,e,f),this}ringToTileXYArray(a,b=1,c=[]){return Ec(this,a,b,c)}rotate(a,b,c=null,d={x:0,y:0}){return Bf(this,a,b,c,d)}setBoardWidth(a=0){return Fb(this,a),this}setBoardHeight(a=0){return Gb(this,a),this}setTileZ(a,b){return Cf(this,a,b),this}shapeToTileXYArray(a,b,c=[]){return Df(this,a,b,c)}swapChess(a,b,c=!0){return Ef(this,a,b,c),this}tileXYArrayToChessArray(a,b,c=[]){return fc(this,a,b,c)}tileXYToChessArray(a,b,c=[]){return Oa(this,a,b,c)}tileXYZToChess(a,b,c){return qa(this,a,b,c)}tileZToChessArray(a,b=[]){return Ed(this,a,b)}tileXYArrayToWorldXYArray(a,b=[]){return Fd(this,a,b)}tileXYToWorldXY(a,b,c={x:0,y:0}){return Fa(this,a,b,c)}worldXYSnapToGrid(a,b,c={x:0,y:0}){return Gd(this,a,b,c)}worldXYToChess(a,b,c,d){return Hd(this,a,b,c,d)}worldXYToTileXY(a,b,c){return Ia(this,a,b,c)}}class mj extends sd{}const Va={};Vb(Va,{ChessToTileXYZ:()=>ba,Contains:()=>Ta,DirectionBetween:()=>ud,ForEachTileXY:()=>vd,GetDistance:()=>wd,GetOppositeDirection:()=>Ad,GetTileXYAtDirection:()=>Ma,GetWrapTileXY:()=>dc,IsDirectionInCone:()=>Cd,TileXYArrayToChessArray:()=>fc,TileXYToChessArray:()=>Oa,TileXYZToChess:()=>qa,TileZToChessArray:()=>Ed});const rb={};Vb(rb,{AngleBetween:()=>qb,AngleSnapToDirection:()=>$b,AngleToward:()=>ac,GetGridPoints:()=>xd,GridAlign:()=>ec,IsAngleInCone:()=>Bd,IsOverlappingPoint:()=>Dd,TileXYArrayToWorldXYArray:()=>Fd,TileXYToWorldXY:()=>Fa,WorldXYSnapToGrid:()=>Gd,WorldXYToChess:()=>Hd,WorldXYToTileXY:()=>Ia});const Jb={};Vb(Jb,{AreNeighbors:()=>td,GetNeighborChess:()=>yd,GetNeighborChessDirection:()=>bc,GetNeighborTileDirection:()=>cc,GetNeighborTileXY:()=>eb,GetNeighborTileXYAtAngle:()=>zd});var oa;(function(a){a[a.orthogonal=0]="orthogonal",a[a.isometric=1]="isometric"})(oa||(oa={}));var lb;(function(a){a[a["4dir"]=4]="4dir",a[a["8dir"]=8]="8dir"})(lb||(lb={}));class hk{constructor({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=oa.orthogonal,dir:f=lb["4dir"]}={}){this.setOriginPosition(a,b),this.setCellSize(c,d),this.setType(e),this.setDirectionMode(f)}fromJSON({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=oa.orthogonal,dir:f=lb["4dir"]}={}){return this.setType(e),this.setDirectionMode(f),this.setOriginPosition(a,b),this.setCellSize(c,d),this}toJSON(){return{x:this.x,y:this.y,cellWidth:this.cellWidth,cellHeight:this.cellHeight,type:this.mode,dir:this.directions}}setOriginPosition(a=0,b=0){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setType(a=oa.orthogonal){return typeof a==="string"&&(a=oa[a]),this.mode=a,this}setDirectionMode(a=lb["4dir"]){return typeof a==="string"&&(a=lb[a]),this.directions=a,this}}function $j(a,b,c,d=!0){let e;switch(a.mode){case oa.orthogonal:case oa.isometric:if(b.y===c.y)e=c.x>=b.x?0:2;else if(b.x===c.x)e=c.y>=b.y?1:3;else if(a.directions===lb["4dir"]){let f=hc(Mb(b.x,b.y,c.x,c.y));f<0&&(f+=360),e=f/90,d&&(e=Math.round(e))}else{let f=c.x-b.x,g=c.y-b.y;if(f===g)e=f>0?4:6;else if(f===-g)e=f>0?7:5;else{let j=hc(Math.atan2(g,f));j<0&&(j+=360);let i=j/45;d&&(i=Math.round(i)),i>=0&&i<1?e=i:i>=1&&i<2?e=i+3:i>=2&&i<3?e=i-1:i>=3&&i<4?e=i+2:i>=4&&i<5?e=i-2:i>=5&&i<6?e=i+1:i>=6&&i<7?e=i-3:e=i}}break}return e===a.directions&&(e=0),e}function Td(a,b){return kb(b,0,a.directions)}function ak(a,b,c,d=!1){let e=c.x-b.x,f=c.y-b.y,g;return d?g=Math.abs(e)+Math.abs(f):g=Math.sqrt(e*e+f*f),g}function Pd(a,b=[]){if(!(b.length===a))if(b.length<a)for(let c=b.length;c<a;c++)b.push({x:0,y:0});else b.length=a;return b}function Wd(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=eo);let e,f;switch(a.mode){case oa.orthogonal:e=b*a.width,f=c*a.height;break;case oa.isometric:e=(b-c)*a._halfWidth,f=(b+c)*a._halfHeight;break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let eo={x:0,y:0};function bk(a,b=0,c=0,d=[]){if(typeof b==="object"){let i=b;c=i.y,b=i.x}d===!0&&(d=$n),Pd(4,d);let e,f;({x:e,y:f}=Wd(a,b,c));let g=a._halfWidth,j=a._halfHeight;switch(a.mode){case oa.orthogonal:d[0].x=e+g,d[0].y=f-j,d[1].x=e+g,d[1].y=f+j,d[2].x=e-g,d[2].y=f+j,d[3].x=e-g,d[3].y=f-j;break;case oa.isometric:d[0].x=e+g,d[0].y=f,d[1].x=e,d[1].y=f+j,d[2].x=e-g,d[2].y=f,d[3].x=e,d[3].y=f-j;break}return d}let $n=[];const ic=[[1,0],[0,1],[-1,0],[0,-1],[1,1],[-1,1],[-1,-1],[1,-1]],Ic=ic;function Yj(a){let b={},c,d,e;for(let f in a)c=a[f],d=c[0],e=c[1],b.hasOwnProperty(d)||(b[d]={}),b[d][e]=parseInt(f);return b}const Zj=Yj(ic),_j=Yj(Ic);function ck(a,b,c){let d;switch(a.mode){case oa.orthogonal:d=Zj;break;case oa.isometric:d=_j;break}let e=c.x-b.x,f=c.y-b.y;if(d.hasOwnProperty(e)){let g=d[e];if(g.hasOwnProperty(f))return g[f]}return null}function Xd(a,b,c,d,e={x:0,y:0}){e===!0&&(e=co);let f,g;switch(a.mode){case oa.orthogonal:f=ic[c][0],g=ic[c][1];break;case oa.isometric:f=Ic[c][0],g=Ic[c][1];break}return d===1?(e.x=b.x+f,e.y=b.y+g):(e.x=b.x+d*f,e.y=b.y+d*g),e}let co={x:0,y:0};function dk(a,b,c,d={x:0,y:0}){return Xd(a,b,c,1,d)}function ek(a,b,c,d){return ao[d]}const ao={0:2,1:3,2:0,3:1,4:6,5:7,6:4,7:5};function fk(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=bo),b-=a.x,c-=a.y;let e=b/a.width,f=c/a.height;switch(a.mode){case oa.orthogonal:d.x=Math.round(e),d.y=Math.round(f);break;case oa.isometric:d.x=Math.round(+e+f),d.y=Math.round(-e+f);break}return d}let bo={x:0,y:0};function gk(a,b,c,d={x:0,y:0}){return typeof c==="string"&&(c=Lb[c]),d===!0&&(d=fo),d.x=c&1?-b.x:b.x,d.y=c&2?-b.y:b.y,d}let fo={x:0,y:0};function Nb(a,b,c,d,e={x:0,y:0}){e===!0&&(e=go);let f=b.x+c,g=b.y+d;return e.x=f,e.y=g,e}let go={x:0,y:0};function ik(a,b,c,d=[]){let e,f;for(e=c,f=-c;f<=c;f++)d.push(Nb(a,b,e,f));for(f=c,e=c-1;e>=-c;e--)d.push(Nb(a,b,e,f));for(e=-c,f=c-1;f>=-c;f--)d.push(Nb(a,b,e,f));for(f=-c,e=-c+1;e<=c-1;e++)d.push(Nb(a,b,e,f));return d}function jk(a,b,c,d={x:0,y:0}){d===!0&&(d=lo),c=kb(c,0,3);let e,f;switch(c){case 1:e=-b.y,f=b.x;break;case 2:e=-b.x,f=-b.y;break;case 3:e=b.y,f=-b.x;break;default:e=b.x,f=b.y;break}return d.x=e,d.y=f,d}let lo={x:0,y:0};function Ud(a){a._savedOriginX=a.x,a._savedOriginY=a.y}function Vd(a){a.x=a._savedOriginX,a.y=a._savedOriginY}class Xj extends hk{get sides(){return 4}get allDirections(){return this.directions===4?ho:io}get halfDirections(){return this.directions===4?jo:ko}directionBetween(a,b,c=!0){return $j(this,a,b,c)}directionNormalize(a){return Td(this,a)}getDistance(a,b,c=!1){return ak(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return bk(this,a,b,c)}getNeighborTileDirection(a,b){return ck(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return dk(this,a,b,c)}getOppositeDirection(a,b,c){return ek(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return fk(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return Xd(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return Wd(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return gk(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return Nb(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return ik(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return jk(this,a,b,c)}restoreOrigin(){return Vd(this),this}saveOrigin(){return Ud(this),this}}const ho=[0,1,2,3],io=[0,1,2,3,4,5,6,7],jo=[0,1],ko=[0,1,4,5];var ca;(function(a){a[a.ODD_R=0]="ODD_R",a[a.EVEN_R=1]="EVEN_R",a[a.ODD_Q=2]="ODD_Q",a[a.EVEN_Q=3]="EVEN_Q"})(ca||(ca={}));var cb;(function(a){a[a.y=0]="y",a[a.flat=0]="flat",a[a.x=1]="x",a[a.pointy=1]="pointy"})(cb||(cb={}));var ub;(function(a){a[a.even=0]="even",a[a.odd=1]="odd"})(ub||(ub={}));class Qj{constructor({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=cb.x,staggerIndex:g=ub.odd}={}){this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e)}fromJSON({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=cb.x,staggerIndex:g=ub.odd}={}){return this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e),this}toJSON(){return{x:this.x,y:this.y,radius:this.radius,cellWidth:this.cellWidth,cellHeight:this.cellHeight,staggerAxis:this.staggerAxis,staggerIndex:this.staggerIndex}}setOriginPosition(a,b){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this.radius=void 0,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setRadius(a=0){let b,c;return this.staggerAxis===cb.y?(b=2*a,c=Wj*a):(b=Wj*a,c=2*a),this.setCellSize(b,c),this.radius=a,this}setDirectionMode(){return this.directions=6,this}setType(a=1,b=1){return typeof a==="string"&&(a=cb[a]),typeof b==="string"&&(b=ub[b]),this.staggerAxis=a,this.staggerIndex=b,a===cb.y?this.mode=b===ub.even?ca.EVEN_Q:ca.ODD_Q:this.mode=b===ub.even?ca.EVEN_R:ca.ODD_R,this}}const Wj=Math.sqrt(3);function Pa(a,b,c,d={x:0,y:0,z:0}){d===!0&&(d=Mf);switch(a){case ca.ODD_R:d.x=b-(c-(c&1))/2,d.z=c;break;case ca.EVEN_R:d.x=b-(c+(c&1))/2,d.z=c;break;case ca.ODD_Q:d.x=b,d.z=c-(b-(b&1))/2;break;case ca.EVEN_Q:d.x=b,d.z=c-(b+(b&1))/2;break}return d.y=-d.x-d.z,d}function Ej(a,b,c,d={x:0,y:0,z:0}){typeof a!=="number"&&(d=a,a=d.x,b=d.y,c=d.z),d===!0&&(d=Mf);let e=Math.round(a),f=Math.round(b),g=Math.round(c),j=Math.abs(e-a),i=Math.abs(f-b),k=Math.abs(g-c);return j>i&&j>k?e=-f-g:i>k?f=-e-g:g=-e-f,d.x=e,d.y=f,d.z=g,d}function Ba(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Mn);switch(a){case ca.ODD_R:e.x=b+(d-(d&1))/2,e.y=d;break;case ca.EVEN_R:e.x=b+(d+(d&1))/2,e.y=d;break;case ca.ODD_Q:e.x=b,e.y=d+(b-(b&1))/2;break;case ca.EVEN_Q:e.x=b,e.y=d+(b+(b&1))/2;break}return e}function Fj(a,b,c={x:0,y:0,z:0}){return c===!0&&(c=Mf),c.x=a,c.y=-a-b,c.z=b,c}let Mf={x:0,y:0,z:0},Mn={x:0,y:0};function Hj(a,b,c,d=!0){let e;Pa(a.mode,b.x,b.y,Ld),Pa(a.mode,c.x,c.y,Md);let f=Md.x-Ld.x,g=Md.y-Ld.y,j=Md.z-Ld.z;return j===0?e=f>0?0:3:f===0?e=j>0?1:4:g===0?e=j>0?2:5:f>0&&g<0&&j>0?e=0+j/-g:f<0&&g<0&&j>0?e=1+-g/j:f<0&&g>0&&j>0?e=2+g/-f:f<0&&g>0&&j<0?e=3+-j/g:f>0&&g>0&&j<0?e=4+f/-j:e=5+-g/f,d&&(e=Math.round(e)),e}let Ld={x:0,y:0,z:0},Md={x:0,y:0,z:0};function Ij(a,b,c,d=!1){Pa(a.mode,b.x,b.y,Nd),Pa(a.mode,c.x,c.y,Od);let e=Od.x-Nd.x,f=Od.y-Nd.y,g=Od.z-Nd.z;return(Math.abs(e)+Math.abs(f)+Math.abs(g))/2}let Nd={x:0,y:0,z:0},Od={x:0,y:0,z:0};function Qd(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Vn);let e=b*a.width,f=c*a.height;switch(a.mode){case ca.ODD_R:c&1&&(e+=a._halfWidth),f*=.75;break;case ca.EVEN_R:c&1&&(e-=a._halfWidth),f*=.75;break;case ca.ODD_Q:e*=.75,b&1&&(f+=a._halfHeight);break;case ca.EVEN_Q:e*=.75,b&1&&(f-=a._halfHeight);break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let Vn={x:0,y:0};const Mp=Math.PI/180;function sb(a){return a*Mp}function Jj(a,b=0,c=0,d=[]){if(typeof b==="object"){let g=b;c=g.y,b=g.x}d===!0&&(d=Rn),Pd(6,d);let e,f;({x:e,y:f}=Qd(a,b,c));if(a.radius!==void 0){let g=a.radius,j=a.staggerAxis===cb.flat?0:-30;for(let i=0;i<6;i++){let k=60*i+j,n=sb(k);d[i].x=e+g*Math.cos(n),d[i].y=f+g*Math.sin(n)}}else{let g=a._halfWidth,j=g/2,i=a._halfHeight,k=i/2;a.staggerAxis===cb.flat?(d[0].x=e+g,d[0].y=f,d[1].x=e+j,d[1].y=f+i,d[2].x=e-j,d[2].y=f+i,d[3].x=e-g,d[3].y=f,d[4].x=e-j,d[4].y=f-i,d[5].x=e+j,d[5].y=f-i):(d[0].x=e+g,d[0].y=f-k,d[1].x=e+g,d[1].y=f+k,d[2].x=e,d[2].y=f+i,d[3].x=e-g,d[3].y=f+k,d[4].x=e-g,d[4].y=f-k,d[5].x=e,d[5].y=f-i)}return d}let Rn=[];const Nn=[[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]]],On=[[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]],[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]]],Pn=[[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]],[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]]],Qn=[[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]],[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]]],Wa=[Nn,On,Pn,Qn];function tb(a){let b={},c,d;for(let e in a)[c,d]=a[e],b.hasOwnProperty(c)||(b[c]={}),b[c][d]=parseInt(e);return b}const Gj=[[tb(Wa[0][0]),tb(Wa[0][1])],[tb(Wa[1][0]),tb(Wa[1][1])],[tb(Wa[2][0]),tb(Wa[2][1])],[tb(Wa[3][0]),tb(Wa[3][1])]];function Rd(a,b,c){let d;switch(a){case ca.ODD_R:case ca.EVEN_R:d=c&1;break;case ca.ODD_Q:case ca.EVEN_Q:d=b&1;break}return d}function Kj(a,b,c){let d=a.mode,e=Rd(d,b.x,b.y),f=Gj[d][e],g=c.x-b.x,j=c.y-b.y;if(f.hasOwnProperty(g)){let i=f[g];if(i.hasOwnProperty(j))return i[j]}return null}function Sd(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Un);let f=a.mode,g=b.x,j=b.y;if(d===1){let i=Rd(f,g,j);e.x=g+Wa[f][i][c][0],e.y=j+Wa[f][i][c][1]}else if(d===0)e.x=g,e.y=j;else{let i=Pa(f,g,j,!0),k,n,u;switch(c){case 1:k=i.x,n=i.y-d,u=i.z+d;break;case 2:k=i.x-d,n=i.y,u=i.z+d;break;case 3:k=i.x-d,n=i.y+d,u=i.z;break;case 4:k=i.x,n=i.y+d,u=i.z-d;break;case 5:k=i.x+d,n=i.y,u=i.z-d;break;default:k=i.x+d,n=i.y-d,u=i.z;break}Ba(f,k,n,u,e)}return e}let Un={x:0,y:0};function Lj(a,b,c,d={x:0,y:0}){return Sd(a,b,c,1,d)}function Mj(a,b,c,d){return(d+3)%6}const Nj=4/3,Oj=2/3;function Pj(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Tn),b-=a.x,c-=a.y;let e,f;switch(a.mode){case ca.ODD_R:case ca.EVEN_R:f=c*Nj/a.height,e=b/a.width-Oj*(c/a.height);break;case ca.ODD_Q:case ca.EVEN_Q:f=c/a.height-Oj*(b/a.width),e=b*Nj/a.width;break}let g=Fj(e,f,Sn);return Ej(g),Ba(a.mode,g.x,g.y,g.z,d),d}let Sn={x:0,y:0,z:0},Tn={x:0,y:0};function Rj(a,b,c,d={x:0,y:0}){typeof c==="string"&&(c=Lb[c]),d===!0&&(d=Yn);let e=Pa(a.mode,b.x,b.y,!0),f=a.mode===ca.ODD_R||a.mode===ca.EVEN_R,g,j,i;return c&1&&(f?(g=e.y,j=e.x,i=e.z):(g=-e.x,j=-e.z,i=-e.y),e.x=g,e.y=j,e.z=i),c&2&&(f?(g=-e.y,j=-e.x,i=-e.z):(g=e.x,j=e.z,i=e.y)),Ba(a.mode,g,j,i,d),d}let Yn={x:0,y:0};function Sj(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Zn);let f=b.x+c,g=b.y+d;switch(a.mode){case ca.ODD_R:(d&1)!==0&&((g&1)===0&&(f+=1));break;case ca.EVEN_R:(d&1)!==0&&((g&1)===0&&(f-=1));break;case ca.ODD_Q:(c&1)!==0&&((f&1)==0&&(g+=1));break;case ca.EVEN_Q:(c&1)!==0&&((f&1)==0&&(g-=1));break}return e.x=f,e.y=g,e}let Zn={x:0,y:0};function Tj(a,b,c,d=[]){let e=Pa(a.mode,b.x,b.y,!0),f=e.x,g=e.y,j=e.z,i,k,n;for(n=c,i=0;i>=-c;i--)k=-i-n,d.push(Ba(a.mode,f+i,g+k,j+n));for(i=-c,k=1;k<=c;k++)n=-i-k,d.push(Ba(a.mode,f+i,g+k,j+n));for(k=c,n=-1;n>=-c;n--)i=-k-n,d.push(Ba(a.mode,f+i,g+k,j+n));for(n=-c,i=1;i<=c;i++)k=-i-n,d.push(Ba(a.mode,f+i,g+k,j+n));for(i=c,k=-1;k>=-c;k--)n=-i-k,d.push(Ba(a.mode,f+i,g+k,j+n));for(k=-c,n=1;n<=c-1;n++)i=-k-n,d.push(Ba(a.mode,f+i,g+k,j+n));return d}function Uj(a,b,c,d={x:0,y:0}){d===!0&&(d=_n),c=kb(c,0,5);let e=Pa(a.mode,b.x,b.y,!0),f,g,j;switch(c){case 1:f=-e.z,g=-e.x,j=-e.y;break;case 2:f=e.y,g=e.z,j=e.x;break;case 3:f=-e.x,g=-e.y,j=-e.z;break;case 4:f=e.z,g=e.x,j=e.y;break;case 5:f=-e.y,g=-e.z,j=-e.x;break;default:f=e.x,g=e.y,j=e.z;break}return Ba(a.mode,f,g,j,d),d}let _n={x:0,y:0};class Vj extends Qj{get sides(){return 6}get allDirections(){return Wn}get halfDirections(){return Xn}directionBetween(a,b,c=!0){return Hj(this,a,b,c)}directionNormalize(a){return Td(this,a)}getDistance(a,b,c=!1){return Ij(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return Jj(this,a,b,c)}getNeighborTileDirection(a,b){return Kj(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return Lj(this,a,b,c)}getOppositeDirection(a,b,c){return Mj(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return Pj(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return Sd(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return Qd(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return Rj(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return Sj(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return Tj(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return Uj(this,a,b,c)}restoreOrigin(){return Vd(this),this}saveOrigin(){return Ud(this),this}}const Wn=[0,1,2,3,4,5],Xn=[0,1,2];var za;(function(a){a[a.random=0]="random",a[a.diagonal=1]="diagonal",a[a.straight=2]="straight",a[a.line=3]="line",a[a.astar=10]="astar",a[a["astar-random"]=11]="astar-random",a[a["astar-line"]=12]="astar-line"})(za||(za={}));const Ob=null;class Qm{constructor(a){this.content=[],this.scoreFunction=a}clear(){this.content.length=0}push(a){this.content.push(a),this.sinkDown(this.content.length-1)}pop(){let a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.bubbleUp(0)),a}remove(a){let b=this.content.indexOf(a),c=this.content.pop();b!==this.content.length-1&&(this.content[b]=c,this.scoreFunction(c)<this.scoreFunction(a)?this.sinkDown(b):this.bubbleUp(b))}get size(){return this.content.length}rescoreElement(a){this.sinkDown(this.content.indexOf(a))}sinkDown(a){let b=this.content[a];for(;a>0;){let c=(a+1>>1)-1,d=this.content[c];if(this.scoreFunction(b)<this.scoreFunction(d))this.content[c]=b,this.content[a]=d,a=c;else break}}bubbleUp(a){let b=this.content.length,c=this.content[a],d=this.scoreFunction(c);for(;;){let e=a+1<<1,f=e-1,g=null,j;if(f<b){let i=this.content[f];j=this.scoreFunction(i),j<d&&(g=f)}if(e<b){let i=this.content[e],k=this.scoreFunction(i);k<(g===null?d:j)&&(g=e)}if(g!==null)this.content[a]=this.content[g],this.content[g]=c,a=g;else break}}}let aca=new Qm(a=>a.f);const Ge=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d=d.prevNodes[0];return c.reverse()};const Tm=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d.prevNodes.length===1?d=d.prevNodes[0]:d=gc(d.prevNodes);return c.reverse()};const Sm=function(a,b,c=[]){let d=b,e=b.angleTo(a);for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1)d=d.prevNodes[0];else{let f=Infinity;for(let g=1,j=d.prevNodes.length;g<j;g++){let i=d.prevNodes[g],k=Math.abs(b.angleTo(i)-e);k<f&&(f=k,d=i)}}}return c.reverse()};const Rm=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let j=0,i=d.prevNodes.length;j<i;j++){f=d.prevNodes[j],g=f.logicDirTo(d);if(g!==e)break}e=g,d=f}}return c.reverse()};const Um=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let j=0,i=d.prevNodes.length;j<i;j++){f=d.prevNodes[j],g=f.logicDirTo(d);if(g===e)break}e=g,d=f}}return c.reverse()};let Ub={};Ub[za.astar]=Ge;Ub[za["astar-line"]]=Ge;Ub[za["astar-random"]]=Ge;Ub[za.random]=Tm;Ub[za.line]=Sm;Ub[za.diagonal]=Rm;Ub[za.straight]=Um;class mk{constructor(){this.prevNodes=[]}shutdown(){this.key=void 0,this.prevNodes.length=0}destroy(){this.shutdown()}reset(a){this.key=a,this.f=0,this.g=0,this.h=void 0,this.closerH=void 0,this.visited=!1,this.closed=!1}heuristic(a,b,c){if(b===null)return 0;let d,e=this.distanceTo(a)*this.manager.weight;switch(b){case za.astar:d=e;break;case za["astar-line"]:if(c!==void 0){let f=a.angleTo(c)-this.angleTo(c);d=e+Math.abs(f)}else d=e;case za["astar-random"]:d=e+Math.random();break;default:d=e;break}return d}getNextNodes(){return[]}getCost(a){return Ob}distanceTo(a){return 0}angleTo(a){return 0}logicDirTo(a){return 0}getNode(a,b=!1){return this.manager.getNode(a,b)}}function Yd(a){for(let b=a.length-1;b>0;b--){let c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a}class vo extends mk{constructor(a){super();this.isTileXYZ=!0;this.pathFinder=a}reset(a){super.reset(a),this.key=a,nk(a,this),this._px=void 0,this._py=void 0,this.cost=void 0}getNextNodes(){let a=Jb.GetNeighborTileXY(this.board,this);this.pathFinder.shuffleNeighbors&&Yd(a);let b=[];return a.forEach(c=>{let d=this.getNode(Ra(c.x,c.y),!0);b.push(d)}),b}getCost(a){return this.pathFinder.cacheCost?this.cost===void 0&&(this.cost=this.pathFinder.getCost(this,a)):this.cost=this.pathFinder.getCost(this,a),this.cost}distanceTo(a){return Va.GetDistance(this.board,this,a,!0)}angleTo(a){return Mb(this.worldX,this.wroldY,a.worldX,a.worldX)}logicDirTo(a){return Jb.GetNeighborTileDirection(this.board,this,a)}get board(){return this.pathFinder.board}get worldX(){if(this._px===void 0){let a=rb.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._px}get wroldY(){if(this._py===void 0){let a=rb.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._py}}class qo{constructor(){this.data=[];this.visited=new Set()}push(a,b){if(Array.isArray(a)){let d=a;for(let e=0,f=d.length;e<f;e++)this.push(d[e]);return this}if(typeof a==="object"){let d=a;a=d.x,b=d.y}let c=`${a},${b}`;return this.visited.has(c)?this:(this.data.push({x:a,y:b}),this.visited.add(c),this)}pop(){return this.data.pop()}get length(){return this.data.length}clear(){return this.data.length=0,this.visited.clear(),this}}let WU=new qo();var Kd;(function(a){a[a.direction=0]="direction",a[a.angle=1]="angle"})(Kd||(Kd={}));function _b(a=32,b=32){const c=zc(a,b);return new $a(c.canvas)}function Fi(a,b){const c=a.texture,d=b.shaders.current,e=d.buffer,f=c.binding;d.count===e.batchSize&&b.flush();const g=a.vertexData;b.textures.request(c);const j=f.index;g[4]=j,g[10]=j,g[16]=j,g[22]=j;const i=d.count*e.quadElementSize;e.vertexViewF32.set(g,i);const k=a.vertexColor,n=e.vertexViewU32;n[i+5]=k[0],n[i+11]=k[2],n[i+17]=k[3],n[i+23]=k[1],d.count++}class Bi extends ed{constructor(a=0,b=0){super(a,b);this._alpha=1,this.type="Container"}setSize(a,b=a){return this.transform.updateExtent(a,b),this}setPosition(a,b){return this.transform.position.set(a,b),this}setOrigin(a,b=a){return this.transform.origin.set(a,b),this}setSkew(a,b=a){return this.transform.skew.set(a,b),this}setScale(a,b=a){return this.transform.scale.set(a,b),this}setRotation(a){return this.transform.rotation=a,this}set width(a){this.transform.updateExtent(a)}get width(){return this.transform.extent.width}set height(a){this.transform.updateExtent(void 0,a)}get height(){return this.transform.extent.height}set x(a){this.transform.position.x=a}get x(){return this.transform.position.x}set y(a){this.transform.position.y=a}get y(){return this.transform.position.y}set originX(a){this.transform.origin.x=a}get originX(){return this.transform.origin.x}set originY(a){this.transform.origin.y=a}get originY(){return this.transform.origin.y}set skewX(a){this.transform.skew.x=a}get skewX(){return this.transform.skew.x}set skewY(a){this.transform.skew.y=a}get skewY(){return this.transform.skew.y}set scaleX(a){this.transform.scale.x=a}get scaleX(){return this.transform.scale.x}set scaleY(a){this.transform.scale.y=a}get scaleY(){return this.transform.scale.y}set rotation(a){this.transform.rotation=a}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(a){a!==this._alpha&&(this._alpha=a,this.setDirty(aa.TRANSFORM))}}function Gi(a,b){const c=a.frame;if(!c)return;const d=b.ctx,e=a.transform,{a:f,b:g,c:j,d:i,tx:k,ty:n}=e.world,{x:u,y:w}=e.extent;d.save(),d.setTransform(f,g,j,i,k,n),d.globalAlpha=a.alpha,d.drawImage(c.texture.image,c.x,c.y,c.width,c.height,u,w,c.width,c.height),d.restore()}function yc(a,b){const c=(b*255|0)&255;return(c<<24|a)>>>0}function Hi(a){const b=a.vertexAlpha,c=a.vertexTint,d=a.vertexColor;return d[0]=yc(c[0],b[0]),d[1]=yc(c[1],b[1]),d[2]=yc(c[2],b[2]),d[3]=yc(c[3],b[3]),a}function gd(a,b,...c){const d=a.getFrame(b),{u0:e,u1:f,v0:g,v1:j,pivot:i}=d;return c.forEach(k=>{if(!k||d===k.frame)return;k.frame=d,i&&k.setOrigin(i.x,i.y),k.frame.setExtent(k),k.hasTexture=!0;const n=k.vertexData;n[2]=e,n[3]=g,n[8]=e,n[9]=j,n[14]=f,n[15]=j,n[20]=f,n[21]=g}),c}function Ei(a,b,...c){if(!a)c.forEach(d=>{d.texture=null,d.frame=null,d.hasTexture=!1});else{let d;a instanceof $a?d=a:d=Ea.get().get(a),d?(c.forEach(e=>{e.texture=d}),gd(d,b,...c)):console.warn(`Invalid Texture key: ${a}`)}return c}function Ii(a){const b=a.vertexData,{x0:c,y0:d,x1:e,y1:f,x2:g,y2:j,x3:i,y3:k}=fd(a.transform);return b[0]=c,b[1]=d,b[6]=e,b[7]=f,b[12]=g,b[13]=j,b[18]=i,b[19]=k,a}class hd extends Bi{constructor(a,b,c,d){super(a,b);this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertexData=new Float32Array(24).fill(0),this.vertexColor=new Uint32Array(4).fill(4294967295),this.vertexAlpha=new Float32Array(4).fill(1),this.vertexTint=new Uint32Array(4).fill(16777215),this.setTexture(c,d)}setTexture(a,b){return Ei(a,b,this),this}setFrame(a){return gd(this.texture,a,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}preRender(){this.isDirty(aa.COLORS)&&(Hi(this),this.clearDirty(aa.COLORS)),this.isDirty(aa.TRANSFORM)&&(Ii(this),this.clearDirty(aa.TRANSFORM))}renderGL(a){this.preRender(),Fi(this,a)}renderCanvas(a){this.preRender(),Gi(this,a)}get alpha(){return this._alpha}set alpha(a){if(a!==this._alpha){this._alpha=a;const b=this.vertexAlpha;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(aa.ALPHA)}}get tint(){return this._tint}set tint(a){if(a!==this._tint){this._tint=a;const b=this.vertexTint;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(aa.COLORS)}}destroy(a){super.destroy(a),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertexData=null,this.vertexColor=null,this.vertexAlpha=null,this.vertexTint=null}}function se(a,b,c){const d=Math.ceil(b*a.resolution),e=Math.ceil(c*a.resolution),f=a.canvas;if(f.width===d||f.height===e){te(a);return}f.width=d,f.height=e,a.texture.setSize(b,c),a.setSize(b,c),a.updateTexture()}function te(a){a.context.clearRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function dh(a,b="#fff"){let c=a.context;c.fillStyle=b,c.fillRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function ue(a,b,c){const d=new Image();d.onload=function(){const e=a.resolution,f=d.width/e,g=d.height/e;se(a,f,g),a.context.drawImage(d,0,0),a.updateTexture(),c&&c(),d.onload=null,d.src="",d.remove()},d.src=b}function eh(a,b){return new Promise(function(c,d){ue(a,b,c)})}function fh(a,b,c){return a.canvas.toDataURL(b,c)}function gh(a,b,c,d=[0,0,0,0]){const e=a.context.getImageData(b,c,1,1).data;return d[0]=e[0],d[1]=e[1],d[2]=e[2],d[3]=e[3],d}function hh(a,b,c,d,e,f,g){g===void 0&&(g=d!==0||e!==0||f!==0?255:0);const j=a.context.createImageData(1,1);j.data[0]=d,j.data[1]=e,j.data[2]=f,j.data[3]=g,a.context.putImageData(j,b,c),a.updateTexture()}class Uc extends hd{constructor(a=0,b=0,c=32,d=32){super(a,b,_b());this.type="rexCanvas";const e=wa.get();this.resolution=e.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.resize(c,d)}updateTexture(){return this.texture.binding&&this.texture.binding.update(),this.setDirty(aa.TEXTURE),this}destroy(a){this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}resize(a,b){return se(this,a,b),this}clear(){return te(this),this}}function Ab(a,b,c,d=1){let e;if(typeof a==="string"){let j=Ea.get();j.has(a)||j.add(a,_b()),e=j.get(a)}else e=a;let f=e.image,g=f.getContext("2d");return c?b.call(c,f,g):b(f,g),e.setSize(f.width/d,f.height/d),e.binding&&e.binding.update(),e}class Vm{constructor(a=0,b=a,c=0,d=c,e=0){this._width=0;this._height=0;this.cornerRadius={tl:Za(0),tr:Za(0),bl:Za(0),br:Za(0)};this.setTo(a,b,c,d,e)}setTo(a=0,b=a,c=0,d=c,e=0){return this.setPosition(a,b),this.setRadius(e),this.setSize(c,d),this}setPosition(a=0,b=a){return this.x=a,this.y=b,this}setRadius(a=0){let b=this.cornerRadius;if(typeof a==="number"){const c=a,d=a;b.tl=Za(void 0,c,d),b.tr=Za(void 0,c,d),b.bl=Za(void 0,c,d),b.br=Za(void 0,c,d)}else{const c=a.x??0,d=a.y??0;b.tl=Za(a.tl,c,d),b.tr=Za(a.tr,c,d),b.bl=Za(a.bl,c,d),b.br=Za(a.br,c,d)}return this}setSize(a=0,b=a){return this.width=a,this.height=b,this}get minWidth(){let a=this.cornerRadius;return Math.max(a.tl.x+a.tr.x,a.bl.x+a.br.x)}get minHeight(){let a=this.cornerRadius;return Math.max(a.tl.y+a.bl.y,a.tr.y+a.br.y)}get width(){return this._width}set width(a){a==null&&(a=0),this._width=Math.max(a,this.minWidth)}get height(){return this._height}set height(a){a==null&&(a=0),this._height=Math.max(a,this.minHeight)}get radius(){let a=this.cornerRadius,b=Math.max(a.tl.x,a.tl.y,a.tr.x,a.tr.y,a.bl.x,a.bl.y,a.br.x,a.br.y);return b}}function Za(a,b,c){return a===void 0?{x:b,y:c}:typeof a==="number"?{x:a,y:a}:a}const Wm=sb(0),Xm=sb(90),Ym=sb(180),Zm=sb(270);function ve(a,b,c,d,e,f){const g=new Vm(b,c,d,e,f),j=g.minWidth,i=g.minHeight,k=d>=j?1:d/j,n=e>=i?1:e/i,u=g.cornerRadius;let w,A,C,F,H;a.beginPath(),a.translate(b,c),w=u.br,A=w.x*k,C=w.y*n,F=g.width-A,H=g.height-C,He(w)?a.ellipse(F,H,A,C,0,Wm,Xm):(a.moveTo(g.width,H),a.lineTo(g.width,g.height),a.lineTo(F,g.height)),w=u.bl,A=w.x*k,C=w.y*n,F=A,H=g.height-C,a.lineTo(A,g.height),He(w)?a.ellipse(F,H,A,C,0,Xm,Ym):(a.lineTo(0,g.height),a.lineTo(0,H)),w=u.tl,A=w.x*k,C=w.y*n,F=A,H=C,a.lineTo(0,H),He(w)?a.ellipse(F,H,A,C,0,Ym,Zm):(a.lineTo(0,0),a.lineTo(F,0)),w=u.tr,A=w.x*k,C=w.y*n,F=g.width-A,H=C,a.lineTo(F,0),He(w)?a.ellipse(F,H,A,C,0,Zm,Wm):(a.lineTo(g.width,0),a.lineTo(g.width,H)),a.closePath()}function He(a){return a.x!==0&&a.y!==0}function Ah(a,b,c,d,e,f,g,j,i,k){ve(b,c,d,e,f,g),j&&(b.fillStyle=j,b.fill()),i&&(b.strokeStyle=i,b.lineWidth=k,b.stroke())}var Pm;(function(a){a[a.right=0]="right",a[a.down=1]="down",a[a.left=2]="left",a[a.up=3]="up"})(Pm||(Pm={}));function gm(a,b){b.width!==a.width&&(b.width=a.width),b.height!==a.height&&(b.height=a.height);let c=b.getContext("2d");c.drawImage(a.texture.image,a.x,a.y,a.width,a.height)}function ih(a,b,c=0,d=0,e=a.width,f=a.height){const g=a.resolution,j=a.canvas,i=Math.ceil(e*g),k=Math.ceil(f*g);Ab(b,function(n,u){n.width!==i&&(n.width=i),n.height!==k&&(n.height=k),u.clearRect(0,0,i,k),u.drawImage(j,c,d,i,k)},void 0,a.resolution)}function jh(a,b,c){const d=Ea.get();if(!d.has(b))return;gm(d.get(b).getFrame(c),a.canvas);const e=a.canvas.width,f=a.canvas.height,g=a.resolution,j=e/g,i=f/g;a.texture.setSize(j,i),a.setSize(j,i),a.updateTexture()}class fm extends Uc{fill(a="#fff"){return dh(this,a),this}getCanvas(){return this.canvas}getContext(){return this.context}getDataURL(a,b){return fh(this,a,b)}getPixel(a,b,c=[0,0,0,0]){return gh(this,a,b,c)}generateTexture(a,b=0,c=0,d=this.width,e=this.height){return ih(this,a,b,c,d,e),this}loadFromURL(a,b){return ue(this,a,b),this}loadFromURLPromise(a){return eh(this,a)}loadTexture(a,b){return jh(this,a,b),this}setPixel(a,b,c,d,e,f){return hh(this,a,b,c,d,e,f),this}}const Ida=Ka(lj());const Qf="receive";const qk={receive:Qf};function Rh(a,b){return a.events.delete(b),a}function Qh(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);for(const e of d)e.callback.apply(e.context,c),e.once&&d.delete(e);return d.size===0&&a.events.delete(b),!0}class Nh{constructor(){this.events=new Map()}}class Xc{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function Th(a){return[...a.events.keys()]}function Sh(a,b){const c=a.events.get(b);return c?c.size:0}function Uh(a,b){const c=[],d=a.events.get(b);return d.forEach(e=>{c.push(e.callback)}),c}function Ph(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof Xc)g.delete(c);else{const j=!d,i=e!==void 0;for(const k of g)k.callback===c&&(j&&k.context===d)&&(i&&k.once===e)&&g.delete(k)}return g.size===0&&f.delete(b),a}function Wc(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new Xc(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function Oh(a,b,c,d=a){return Wc(a,b,c,d,!0)}function Ie(a,b){b?a.events.delete(b):a.events.clear()}class Ca{setEventEmitter(a){return this.privateEE=a===void 0,this.eventEmitter=this.privateEE?new Nh():a,this.lastEventInstance=null,this}clearEventEmitter(){return this.setEventEmitter(null),this}destroyEventEmitter(){return this.lastEventInstance=null,this.eventEmitter&&this.privateEE&&(Ie(this.eventEmitter),this.eventEmitter=null),this}on(a,b,c=this,d=!1){return this.lastEventInstance=null,this.eventEmitter&&(this.lastEventInstance=Wc(this.eventEmitter,a,b,c,d)),this}once(a,b,c=this){return this.lastEventInstance=null,this.eventEmitter&&(this.lastEventInstance=Oh(this.eventEmitter,a,b,c)),this}off(a,b,c,d){return this.lastEventInstance=null,this.eventEmitter&&Ph(this.eventEmitter,a,b,c,d),this}emit(a,...b){return this.lastEventInstance=null,this.eventEmitter&&Qh(this.eventEmitter,a,...b),this}removeAllListeners(a){return this.lastEventInstance=null,this.eventEmitter&&Ie(this.eventEmitter,a),this}clearEvent(a){return this.lastEventInstance=null,this.eventEmitter&&Rh(this.eventEmitter,a),this}getListenerCount(a){return this.lastEventInstance=null,this.eventEmitter?Sh(this.eventEmitter,a):0}getEventNames(){return this.lastEventInstance=null,this.eventEmitter?Th(this.eventEmitter):[]}getListeners(a){return this.lastEventInstance=null,this.eventEmitter?Uh(this.eventEmitter,a):[]}}function rk(a,b){(!a.sendToRef||a.sendToRef.key!==a.receiverID)&&(a.sendToRef=a.database.ref(a.rootPath).child(a.receiverID));if(b===void 0)return a.sendToRef.remove();let c={message:b,senderID:a.userID,stamp:a.stamp};return a.userName!==void 0&&(c.senderName=a.userName),a.skipFirst=!1,a.stamp=!a.stamp,a.sendToRef.set(c)}function sk(a){if(a.isReceiving&&a.receiverRef.key===a.receiverID)return;Pf(a),a.isReceiving=!0,a.skipFirst=!0,a.receiverRef=a.database.ref(a.rootPath).child(a.receiverID),a.receiverRef.on("value",uk,a),a.receiverRef.onDisconnect().remove()}function Pf(a){if(!a.isReceiving)return;a.isReceiving=!1,a.receiverRef.off("value",uk,a),a.receiverRef.remove(),a.receiverRef.onDisconnect().cancel()}function uk(a){if(this.skipFirst){this.skipFirst=!1;return}let b=a.val();if(b==null)return;delete b.stamp,this.history.add(b),this.emit(this.eventNames.receive,b)}class tk{constructor({maxLength:a=-1}={}){this.maxLength=a,this.records=[]}add(a){return this.maxLength===0?this:(this.records.push(a),this.maxLength>0&&this.records.length>this.maxLength&&this.records.shift(),this)}clear(){return this.records.length=0,this}changeUserName(a,b){return this.maxLength===0?this:(this.records.forEach(c=>{c.senderID===a&&(c.senderName=b)}),this)}}const $X=Ka(La());class jc extends Ca{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d,receiverID:e="",history:f=0,eventNames:g=qk}={}){super();this.setEventEmitter(a),this.eventNames=g,this.database=$X.database(),this.setRootPath(b),this.skipFirst=!0,this.stamp=!1,this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.isReceiving=!1,f===!0?f=-1:f===!1&&(f=0),this.history=new tk({maxLength:f})}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.sendToRef=void 0,this.receiverRef=void 0,this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.receiverID=a,this}changeUserName(a,b){return a===this.userID&&(this.userName=b),this.history.changeUserName(a,b),this}getHistory(){return this.history.records}clearHistory(){return this.history.clear(),this}send(a){return rk(this,a)}startReceiving(){return sk(this),this}stopReceiving(){return Pf(this),this}}const Pp="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function de(a,b,c=Pp){let d=b===void 0?a:Fc(a,b),e="";for(let f=0;f<d;f++)e+=gc(Array.from(c));return e}const l4=Ka(La());var ra;(function(a){a[a["1d"]=1]="1d",a[a["2d"]=2]="2d",a[a["3d"]=3]="3d"})(ra||(ra={}));const Xf="init";const Yf="update";const Rf="addkey0";const Sf="addkey1";const Tf="addkey2";const Zf="removekey0";const _f="removekey1";const $f="removekey2";const Uf="changekey0";const Vf="changekey1";const Wf="changekey2";const vk={init:Xf,update:Yf,addkey0:Rf,removekey0:Zf,changekey0:Uf,addkey1:Sf,removekey1:_f,changekey1:Vf,addkey2:Tf,removekey2:$f,changekey2:Wf};function an(a){return a==null||a===""||a.length===0}function Op(a,b,c={}){let d=a;if(!an(b)){typeof b==="string"&&(b=b.split("."));let e;for(let f=0,g=b.length;f<g;f++){e=b[f];if(d[e]==null||typeof d[e]!=="object"){let j;f===g-1?j=c:j={},d[e]=j}d=d[e]}}return d}function bn(a,b,c){if(typeof a!=="object")return;if(an(b)){if(c==null)return;typeof c==="object"&&(a=c)}else{typeof b==="string"&&(b=b.split("."));let d=b.pop(),e=Op(a,b);e[d]=c}return a}function Je(a){if(Array.isArray(a))a.length=0;else for(let b in a)delete a[b]}function $m(a){return JSON.parse(JSON.stringify(a))}class wk{constructor(){this.data={}}setValue(a,b){return a==null?this.clear():typeof a==="object"?this.data=a:bn(this.data,a,b),this}getValue(a){if(a==null)return this.data;{typeof a==="string"&&(a=a.split("."));let b=this.data;for(let c=0,d=a.length;c<d;c++){if(!Vh(b))return;b=b[a[c]]}return b}}cloneValue(a){return $m(this.getValue(a))}removeKey(a){if(a==null)this.clear();else{typeof a==="string"&&(a=a.split("."));let b=a.pop(),c=this.data;for(let d=0,e=a.length;d<e;d++){if(!Vh(c))return this;c=c[a[d]]}Vh(c)&&delete c[b]}return this}clear(){return Je(this.data),this}}function Vh(a){return a!=null&&typeof a==="object"}const qZ=Ka(La());class Pb extends Ca{constructor({eventEmitter:a,parent:b,key:c,type:d,eventNames:e,table:f}={}){super();this.setEventEmitter(a),this.parent=b,this.children=new Map(),this.key=c,this.parent?this.fullKeyPath=Gk(this.parent.fullKeyPath,this.key):this.fullKeyPath="",this.type=d,this.eventNames=e,this.table=f,this.database=qZ.database(),this.setRootPath()}destroy(){this.stopUpdate().clear().destroyEventEmitter()}setRootPath(a){if(a===void 0){let b=this.parent?this.parent.rootPath:"";a=`${b}/${this.key}`}this.rootPath=a,this.rootRef=a!==""?this.database.ref(a):void 0;for(const[b,c]of this.children)c instanceof Pb&&c.setRootPath();return this}setData(a,b){if(arguments.length===0)this.clear();else if(typeof a=="string")this.setChildData(a,b);else{let c=a;for(const[d,e]of this.children)c.hasOwnProperty(d)||this.removeChild(d);for(let d in c)this.setChildData(d,c[d])}return this}clear(){this.table.removeKey(this.fullKeyPath);for(const[a,b]of this.children)this.removeChild(a);return this}get childClass(){return null}setChildData(a,b){const c=Gk(this.fullKeyPath,a);this.table.setValue(c,b);if(!(typeof b!=="object")){if(this.children.has(a))this.children.get(a).setData(b);else if(this.childClass){let d=new this.childClass({parent:this,key:a,type:this.type,eventEmitter:this.eventEmitter,eventNames:this.eventNames,table:this.table});d.startUpdate(),this.children.set(a,d)}}return this}removeChild(a){return this.children.has(a)&&(this.children.get(a).destroy(),this.children.delete(a)),this}startUpdate(){return this}stopUpdate(){return this}}function Gk(a,b){return a==null||a===""?b:b==null||b===""?a:`${a}.${b}`}class Jc extends Pb{startUpdate(){return this.rootRef.on("child_added",this.addCol,this),this.rootRef.on("child_removed",this.removeCol,this),this.rootRef.on("child_changed",this.changeColValue,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addCol,this),this.rootRef.off("child_removed",this.removeCol,this),this.rootRef.off("child_changed",this.changeColValue,this),this}addCol(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["1d"]:this.emit(this.eventNames.addkey0,b,c);break;case ra["2d"]:this.emit(this.eventNames.addkey1,this.key,b,c);break;default:this.emit(this.eventNames.addkey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}removeCol(a){const b=a.key;this.removeChild(b);switch(this.type){case ra["1d"]:this.emit(this.eventNames.removekey0,b);break;case ra["2d"]:this.emit(this.eventNames.removekey1,this.key,b);break;default:this.emit(this.eventNames.removekey2,this.pageKey,this.key,b);break}this.emit(this.eventNames.update,this.table.data)}changeColValue(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["1d"]:this.emit(this.eventNames.changekey0,b,c);break;case ra["2d"]:this.emit(this.eventNames.changekey1,this.key,b,c);break;default:this.emit(this.eventNames.changekey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}get pageKey(){return this.parent.key}}class Kc extends Pb{startUpdate(){return this.rootRef.on("child_added",this.addRow,this),this.rootRef.on("child_removed",this.removeRow,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addRow,this),this.rootRef.off("child_removed",this.removeRow,this),this}addRow(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["2d"]:this.emit(this.eventNames.addkey0,b,c);break;default:this.emit(this.eventNames.addkey1,this.key,b,c);break}}removeRow(a){const b=a.key;this.removeChild(b);switch(this.type){case ra["2d"]:this.emit(this.eventNames.removekey0,b);break;default:this.emit(this.eventNames.removekey1,this.key,b);break}}get childClass(){return Jc}}class ag extends Pb{startUpdate(){return this.rootRef.on("child_added",this.addPage,this),this.rootRef.on("child_removed",this.removePage,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addPage,this),this.rootRef.off("child_removed",this.removePage,this),this}addPage(a){const b=a.key,c=a.val();this.setData(b,c),this.emit(this.eventNames.addkey0,b,c)}removePage(a){const b=a.key;this.removeChild(b),this.emit(this.eventNames.removekey0,b)}get childClass(){return Kc}}const $d={};$d[ra["1d"]]=Jc;$d[ra["2d"]]=Kc;$d[ra["3d"]]=ag;function xk(a){return new $d[a.tableType]({type:a.tableType,eventEmitter:a.eventEmitter,eventNames:a.eventNames,table:a.table})}function yk(a){return a.updater.clear(),a.initialFlag=!1,a.rootRef.once("value").then(function(b){let c=b.val()??{};return a.table.setValue(c),a.emit(a.eventNames.init,c),a.initialFlag=!0,Promise.resolve(c)})}function Ga(a,b,c,d){let e=a.rootRef;return e=b?e.child(b):e,e=c?e.child(c):e,e=d?e.child(d):e,e}function zk(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ga(a,c,d,e).set(f)}function Ak(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;default:c=b[0];break}return Ga(a,c,d,e).remove()}function Bk(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ga(a,c,d,e).transaction(function(g){return g===null&&(g=0),g+f})}function Ck(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ga(a,c,d,e).transaction(f)}function Dk(a,b){return Ga(a).update(b)}function Ek(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;case 1:c=b[0];break}return Ga(a,c,d,e).onDisconnect().remove()}function Fk(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ga(a,c,d,e).onDisconnect().set(f)}const tY=Ka(La());class kc extends Ca{constructor({eventEmitter:a,root:b="",type:c=ra["3d"],eventNames:d=vk}={}){super();this.setEventEmitter(a),this.eventNames=d,this.database=tY.database(),this.table=new wk(),this.setTableType(c),this.setRootPath(b),this.initialFlag=!1}destroy(){this.updater.destroy(),this.destroyEventEmitter().stopUpdate()}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):null,this.updater.setRootPath(a),this}setTableType(a){return typeof a==="string"&&(a=ra[a]),this.tableType=a,this.updater&&this.updater.destroy(),this.updater=xk(this),this}startUpdate(){return yk(this),this.updater.startUpdate(),this}stopUpdate(){return this.updater.stopUpdate(),this}clear(){return this.updater.clear(),this}getData(){return this.table.getValue(...arguments)}cloneData(){return this.table.cloneValue(...arguments)}getItemRef(a,b,c){return Ga(this,a,b,c)}setData(...a){return zk(this,...a)}removeData(...a){return Ak(this,...a)}incValue(...a){return Bk(this,...a)}transaction(...a){return Ck(this,...a)}updateData(a){return Dk(this,a)}removeDataOnDisconnect(...a){return Ek(this,...a)}setDataOnDisconnect(...a){return Fk(this,...a)}}const v3=Ka(La());var _g;(function(a){a.d="d",a.w="w",a.m="m",a.y="y",a.day="d",a.week="w",a.month="m",a.year="y"})(_g||(_g={}));var Sc;(function(a){a.d="tagD",a.w="tagW",a.m="tagM",a.y="tagY"})(Sc||(Sc={}));var Tc;(function(a){a.d="scoreD",a.w="scoreW",a.m="scoreM",a.y="scoreY"})(Tc||(Tc={}));var Ol;(function(a){a.d="day",a.w="week",a.m="month",a.y="year"})(Ol||(Ol={}));function ch({query:a,totalLines:b=Infinity,linesPerPage:c=1e3,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g}){return em({query:a,remainderLines:b,linesPerPage:c,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g})}function em(a){let b=a.query;a.startDocRef&&(b=b[a.startMode](a.startDocRef));let c=Math.min(a.remainderLines,a.linesPerPage);return a.remainderLines-=c,b.limit(c).get().then(function(d){let e=a.remainderLines===0||d.size<c,f=!1;a.forEachPageCallback&&(f=a.forEachPageCallback(d)||!1),e=e||f;if(e){let g;return a.resolveCallback&&(g=a.resolveCallback()),Promise.resolve(g)}else return a.startDocRef=d.docs[d.size-1],a.startMode="startAfter",em(a)})}function Ja(a,b=Infinity,c=0,d,e){let f=[],g=0;return ch({query:a,totalLines:c+b,startDocRef:d,startMode:e,forEachPageCallback:function(j){let i,k=j.size,n=c-g;n<=0?i=j.docs:n<k&&(i=j.docs.slice(n,k)),i&&f.push(...i),g+=k},resolveCallback:function(){return f}})}const A6=Ka(La());function Xl(a,b,c=0){return Ja(a.nextQuery,b,c,a.baselineDocRef,a.baselineMode).then(function(d){let e=d.length;return a.cacheItems=d,a.pageIndex=void 0,a.startItemIndex=c,a.endItemIndex=a.startItemIndex+e-1,a.isFullPage=b===void 0?!0:e===b,Promise.resolve(a.cacheItems)})}const _5=Ka(La());class re{constructor({query:a={next:void 0,previous:void 0},itemCount:b=100,baselineDoc:c,baselineMode:d="startAt"}={}){this.setQuery(a),this.setItemCount(b),this.setBaselineDoc(c,d),this.pageIndex=void 0,this.baselineDocRef=void 0,this.baselineMode="startAt",this.startItemIndex=void 0,this.endItemIndex=void 0,this.cacheItems=void 0,this.isFullPage=void 0}setQuery(a,b){if(a instanceof _5.firestore.Query)this.nextQuery=a,this.prevQuery=b;else{var c=a;this.nextQuery=c.next,this.prevQuery=c.previous}return this.pageIndex=null,this.isFullPage=!0,this}setItemCount(a){return this.itemCount=a,this}setBaselineDoc(a,b){return a?(this.baselineDocRef=a.ref,this.baselineMode=b):this.baselineDocRef=void 0,this}load(a,b=0){return Xl(this,a,b)}loadFirstPage(){return this._loadFirstPage()}loadNextPage(){return this.pageIndex==null?this._loadFirstPage():this._loadNextPage()}loadPreviousPage(){return this.pageIndex==null||this.pageIndex===1?this._loadFirstPage():this._loadPreviousPage()}loadCurrentPage(){return this.pageIndex==null||this.pageIndex===0?this._loadFirstPage():this._loadCurrentPage()}}function bm(a){return Ja(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=null,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function Yl(a){return Ja(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,Promise.resolve(a.cacheItems)})}function cm(a){return Ja(a.nextQuery,a.itemCount,0,a.currPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=a.currPageEndDocRef,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function Zl(a){let b=(a.pageIndex+1)*a.itemCount;return Ja(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function dm(a){return Ja(a.prevQuery,a.itemCount+1,0,a.currPageStartDocRef,"startAfter").then(function(b){let c=b.length-1;return a.cacheItems=b,a.cacheItems.pop(),a.cacheItems.reverse(),a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-c+1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=b[c].ref,a.currPageStartDocRef=b[c-1].ref,a.currPageEndDocRef=b[0].ref,Promise.resolve(a.cacheItems)})}function _l(a){let b=(a.pageIndex-1)*a.itemCount;return Ja(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-d+1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function am(a){return Ja(a.nextQuery,a.itemCount,0,a.prevPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function $l(a){let b=a.pageIndex*a.itemCount;return Ja(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}class $g extends re{_loadFirstPage(){return Yl(this)}_loadNextPage(){return Zl(this)}_loadPreviousPage(){return _l(this)}_loadCurrentPage(){return $l(this)}}const _4=Ka(La());class qe extends re{_loadFirstPage(){return bm(this)}_loadNextPage(){return cm(this)}_loadPreviousPage(){return dm(this)}_loadCurrentPage(){return am(this)}}const T5=Ka(La());function Ql(a,b){let c={senderID:a.userID,message:b,timestamp:T5.firestore.FieldValue.serverTimestamp()};return a.userName!==void 0&&(c.senderName=a.userName),a.receiverID!==void 0&&(c.receiverID=a.receiverID),a.rootRef.add(c)}function ah(a,b=a.receiverID){let c=a.rootRef;return c=b!==void 0?c.where("receiverID","==",b):c,c}function Pl(a,b=a.receiverID){let c=ah(a,b),d=c.orderBy("timestamp"),e=c.orderBy("timestamp","desc");return{next:d,previous:e}}const bh="receive";function Rl(a){let b=ah(a).orderBy("timestamp","desc").limit(1);a.unsubscribe=b.onSnapshot({includeMetadataChanges:!0},function(c){if(c.size>0){let d=c.docs[0];if(d.metadata.hasPendingWrites){a.skipFirst&&(a.skipFirst=!1);return}Vl(a,a.receiverID,d);if(a.skipFirst)a.skipFirst=!1;else{let e=Wl(d);a.cacheMessages.push(e),a.emit(bh,e)}}else a.skipFirst&&(a.skipFirst=!1)},function(c){debugger})}function Sl(a){a.unsubscribe&&a.unsubscribe(),a.resetQueryFlag=!0,a.cacheMessages.length=0}function Tl(a){return Vl(a),a.page.loadNextPage().then(function(b){let c=[];for(let d=0,e=b.length;d<e;d++)c.push(Wl(b[d]));return a.cacheMessages.splice(0,0,...c),Promise.resolve(c)})}function Vl(a,b=a.receiverID,c){if(!a.resetQueryFlag)return;a.resetQueryFlag=!1;let d=a.skipFirst?"startAt":"startAfter";a.page.setBaselineDoc(c,d).setQuery(Pl(a,b));return}function Wl(a){let b=a.data();return b.timestamp=b.timestamp.toDate(),b}const K5=Ka(La());class Ul extends Ca{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d="",receiverID:e,pageItemCount:f=100}={}){super();this.setEventEmitter(a),this.database=K5.firestore(),this.setRootPath(b),this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.skipFirst=!0,this.unsubscribe=void 0,this.page=new qe(),this.setPageItemCount(f),this.resetQueryFlag=!0,this.cacheMessages=[]}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.resetQueryFlag=this.resetQueryFlag||this.rootPath!==a,this.rootPath=a,this.rootRef=this.database.collection(a),this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.resetQueryFlag=this.resetQueryFlag||this.receiverID!==a,this.receiverID=a,this}setPageItemCount(a){return this.page.setItemCount(a),this}get hasPreviousMessage(){return this.page.isFullPage!==!1}send(a){return Ql(this,a)}startReceiving(){return Rl(this),this}stopReceiving(){return Sl(this),this}loadPreviousMessages(){return Tl(this)}}const eg="join";const fg="leave";const hg="init";const gg="update";const dg="changename";const cg="change";const Lk={join:eg,leave:fg,update:gg,change:cg,init:hg,changename:dg};var ob;(function(a){a[a.once=0]="once",a[a.child=1]="child",a[a.all=2]="all"})(ob||(ob={}));const Rg="add";const Tg="remove";const Sg="change";const Ug="update";const Dl={add:Rg,remove:Tg,update:Ug,change:Sg};function oe(a){a.items.length=0,a.itemID2Index.clear()}function El(a){return a.items}function Fl(a,b){return a.itemID2Index.has(b)}function Qg(a,b){return b==null?null:a.itemID2Index.get(b)}function Gl(a,b){if(b==null)return null;let c=Qg(a,b);return c==null?null:a.items[c]}function Hl(a,b,c){a.items.forEach(b,c)}function zb(a){a.itemID2Index.clear();let b=a.items;for(var c=0,d=b.length;c<d;c++){let e=b[c][a.keyItemID];a.itemID2Index.set(e,c)}}function Il(a,b){if(b>=a.length)return;let c=a.length-1,d=a[b];for(let e=b;e<c;e++)a[e]=a[e+1];return a.length=c,d}function Vg(a,b){let c=Xg.call(this,a,b);zb(this),this.emit(this.eventNames.add,c),this.emit(this.eventNames.update,this.items)}function Qc(a,b){let c=Jl.call(this,a);zb(this);let d=Xg.call(this,a,b);zb(this),this.emit(this.eventNames.change,d,c),this.emit(this.eventNames.update,this.items)}function Wg(a){let b=Jl.call(this,a);zb(this),this.emit(this.eventNames.remove,b),this.emit(this.eventNames.update,this.items)}function Rc(a){oe(this),a.forEach(function(b){Xg.call(this,b,null,!0)}.bind(this)),zb(this),this.emit(this.eventNames.update,this.items)}function Xg(a,b,c=!1){let d,e=this.getItemCallback,f=this.getItemCallbackScope;f?d=e.call(f,a):d=e(a);if(c)return this.items.push(d),d;if(b==null)this.items.unshift(d);else{let g=this.itemID2Index.get(b);g===this.items.length-1?this.items.push(d):this.items.splice(g+1,0,d)}return d}function Jl(a){let b=this.itemID2Index.get(a.key),c=Il(this.items,b);return c}const Ml={start(a,b){a.isUpdating=!1,b.once("value",Rc,a)},stop(a){}};const Ll={start(a,b){b.on("child_added",Vg,a),b.on("child_removed",Wg,a),b.on("child_moved",Qc,a),b.on("child_changed",Qc,a)},stop(a){a.query.off("child_added",Vg,a),a.query.off("child_removed",Wg,a),a.query.off("child_moved",Qc,a),a.query.off("child_changed",Qc,a)}};const Kl={start(a,b){b.on("value",Rc,a)},stop(a){a.query.off("value",Rc,a)}};const Pc={};Pc[ob.all]=Kl;Pc[ob.child]=Ll;Pc[ob.once]=Ml;class Qb extends Ca{constructor({eventEmitter:a,itemIDKey:b="__itemID__",mode:c=ob.child,getItemCallback:d=Ro,getItemCallbackScope:e,query:f,eventNames:g=Dl}={}){super();this.setEventEmitter(a),this.eventNames=g,this.isUpdating=!1,this.items=[],this.itemID2Index=new Map(),this.setItemIDKey(b),this.setMode(c),e===void 0&&(e=this),this.setGetitemCallback(d,e),this.setQuery(f)}destroy(){this.stopUpdate().clear()}setItemIDKey(a){return this.keyItemID=a,this}setMode(a){return typeof a==="string"&&(a=ob[a]),this.mode=a,this.updater=Pc[a],this}setGetitemCallback(a,b){return this.getItemCallback=a,this.getItemCallbackScope=b,this}setQuery(a){return this.query=a,this}startUpdate(a){if(a)this.setQuery(a);else if(this.query)a=this.query;else return this;return this.stopUpdate().clear(),this.isUpdating=!0,this.updater.start(this,a),this}stopUpdate(){return!this.query||!this.isUpdating?this:(this.isUpdating=!1,this.updater.stop(this),this)}clear(){return oe(this),this}getItems(){return El(this)}hasItem(a){return Fl(this,a)}getItemIndexFromItemID(a){return Qg(this,a)}getItemFromItemID(a){return Gl(this,a)}forEach(a,b){return Hl(this,a,b),this}updateItemID2Index(){return zb(this),this}}const Ro=function(a){let b=a.val();return b[this.keyItemID]=a.key,b};function vb(a,b=a.userID){return a.userID2ItemID.has(b)}function ae(a,b=a.userID){if(!vb(a,b))return null;let c=a.userID2ItemID.get(b);return a.rootRef.child(c)}function Mk(a,b=a.userID){if(!vb(a,b))return null;let c=a.userID2ItemID.get(b);return a.userList.getItemFromItemID(c)}function bg(a){return a.userList.getItems()}function Nk(a){a.userList.clear()}function Ok(a,b,c){a.userList.forEach(b,c)}function Pk(a,b=a.userID){let c=a.userList.getItems()[0];return c&&c.userID===b}function Qk(a){return a.maxUsers===0?!1:a.userList.getItems().length>=a.maxUsers}function Ik(a=0,b){return new Promise(function(c,d){setTimeout(function(){c(b)},a)})}function Jk(a,b=a.userID,c=a.userName){if(vb(a,b))return Promise.resolve();let d={userID:b,userName:c},e=a.maxUsers,f=a.database.ref(a.rootPath),g=f.push();return g.onDisconnect().remove().then(function(){return g.set(d)}).then(function(){return Ik(0)}).then(function(){return e===0?(a.isInList=!0,Promise.resolve()):f.limitToFirst(e).once("value").then(function(j){return Fo(j,b)?(a.isInList=!0,Promise.resolve()):(a.isInList=!1,g.remove().then(function(){return g.onDisconnect().cancel()}).then(function(){return Promise.reject()}))})})}function Fo(a,b){let c=!1;return a.forEach(function(d){let e=d.val();if(e.userID===b)return c=!0,!0}),c}function Kk(a,b=a.userID){if(!vb(a,b))return Promise.resolve();let c=a.userID2ItemID.get(b),d=a.database.ref(a.rootPath).child(c);return d.remove()}function Hk(a,b){return new Promise(function(c,d){let e=ae(a);if(e)return c(e);{let f=a.rootRef.orderByChild("userID").equalTo(a.userID);f.once("child_added").then(function(g){return c(g.ref)})}}).then(function(c){return c.child("userName").set(b)}).then(function(){return a.userName=b,Promise.resolve()})}const a_=Ka(La());class lc extends Ca{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,eventNames:f=Lk}={}){super();this.setEventEmitter(a),this.eventNames=f,this.database=a_.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.setMaxUsers(e),this.userList=new Qb({eventEmitter:this.eventEmitter,itemIDKey:"joinAt",eventNames:{add:f.join,remove:f.leave,update:f.update,change:f.change}}),this.isInList=!1,this.userID2ItemID=new Map(),this.userList.on(this.eventNames.join,function(g){this.userID2ItemID.set(g.userID,g.joinAt),g.userID===this.userInfo.userID&&this.emit(this.eventNames.init,bg(this))},this).on(this.eventNames.leave,function(g){this.userID2ItemID.delete(g.userID),g.userID===this.userID&&(this.isInList=!1)},this).on(this.eventNames.change,function(g,j){let i=g.userID,k=g.userName,n=j.userName;k!==n&&this.emit(this.eventNames.changename,i,k,n)},this)}destroy(){this.stopUpdate().destroyEventEmitter().leave(),this.userList.destroy()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setMaxUsers(a){return this.maxUsers=a,this}clear(){return Nk(this),this}forEach(a,b){return Ok(this,a,b),this}isFull(){return Qk(this)}isFirstUser(a=this.userID){return Pk(this,a)}getUser(a=this.userID){return Mk(this,a)}getUsers(){return bg(this)}getUserRef(a=this.userID){return ae(this,a)}contains(a=this.userID){return vb(this,a)}join(a=this.userID,b=this.userName){return Jk(this,a,b)}leave(a=this.userID){return Kk(this,a)}changeUserName(a){return Hk(this,a)}startUpdate(){let a=this.rootRef;return this.maxUsers>0&&(a=a.limitToFirst(this.maxUsers)),this.userList.startUpdate(a),this}stopUpdate(){return this.userList.stopUpdate(),this}}const Rb="room.join";const xb="room.leave";const xg="userlist.join";const yg="userlist.leave";const Ag="userlist.init";const zg="userlist.update";const Mc="userlist.changename";const ig="broadcast.receive";function mg(a){return`tables.${a}.init`}function ng(a){return`tables.${a}.update`}function og(a){return`tables.${a}.addkey0`}function pg(a){return`tables.${a}.addkey1`}function qg(a){return`tables.${a}.addkey2`}function rg(a){return`tables.${a}.removekey0`}function sg(a){return`tables.${a}.removekey1`}function tg(a){return`tables.${a}.removekey2`}function ug(a){return`tables.${a}.changekey0`}function vg(a){return`tables.${a}.changekey1`}function wg(a){return`tables.${a}.changekey2`}const jg="roomlist.add";const kg="roomlist.remove";const lg="roomlist.update";function bl(a){const b=new lc({eventEmitter:a.eventEmitter,eventNames:{join:xg,leave:yg,update:zg,change:"userlist.change",init:Ag,changename:Mc},userID:a.userInfo});return b.on("userlist.leave",function(c){c.userID===a.userID&&Ko(a)}),a.on(Rb,function(){b.startUpdate()}).on(xb,function(){b.stopUpdate().clear()}),b}function Ko(a){a.emit(xb),setTimeout(function(){a.roomID=void 0,a.roomName=void 0,a.doorState=void 0,a.leftRoomFlag=!1},0)}function _k(a){const b=new Qb({eventEmitter:a.eventEmitter,itemIDKey:"roomID",eventNames:{update:lg,add:jg,remove:kg,change:"roomlist.change"},mode:"once"});return b}function il(a){return a.split("|")[0]}function hl(a){return a.split("|")[1]}function mc(a,b=""){return`${a}|${b}`}function db(a,b){let c=a.rootRef;return b&&(c=c.child(b)),c}function Nc(a,b,c){let d=db(a,"rooms");return b!==void 0&&(d=d.child(b),c!==void 0&&(d=d.child(c))),d}function Zk(a,b){return Nc(a,b,"alive")}function cl(a,b){return Nc(a,b,"users")}function Lc(a,b){let c=db(a,"room-filters");return b!==void 0&&(c=c.child(b)),c}function nc(a,b){let c=db(a,"room-metadata");return b!==void 0&&(c=c.child(b)),c}function ce(a,b,c){let d=`${a.rootPath}/rooms/${b}`;return c&&(d+=`/${c}`),d}function fe(a,b){return ce(a,b,"users")}function $k(a,b,c){let d=ce(a,b,"tables");return c&&(d+=`/${c}`),d}function dl(a,b,c="open"){let d=Lc(a);return d=d.orderByChild("filter"),b===void 0?d=d.startAt(c).endAt(`${c}~`):d=d.equalTo(mc(c,b)),d}function Wk(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new jc({eventEmitter:a.eventEmitter,eventNames:{receive:ig},receiverID:"boradcast",senderID:a.userInfo,history:b.history});return a.on(Rb,function(d){c.setRootPath(ce(a,d.roomID)).startReceiving()}).on(xb,function(){c.stopReceiving()}).on(Mc,function(d,e){c.changeUserName(d,e)}),c}function al(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,Jo(a,d))}),a.on(Rb,function(d){for(const[e,f]of c)f.setRootPath($k(a,d.roomID,e)).startUpdate()}).on(xb,function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function Jo(a,{key:b,type:c=ra["1d"]}){const d=new kc({eventEmitter:a.eventEmitter,type:c,eventNames:{init:mg(b),update:ng(b),addkey0:og(b),removekey0:rg(b),changekey0:ug(b),addkey1:pg(b),removekey1:sg(b),changekey1:vg(b),addkey2:qg(b),removekey2:tg(b),changekey2:wg(b)}});return d}function Qa(a,b=a.roomID,c=a.roomName){return{roomID:b,roomName:c}}function je(a,b){return b===void 0?a.roomID!==void 0:a.roomID===b}function ll(a){return a.userList.isFull()}function ml(a,b=a.userID){return a.userList.isFirstUser(b)}function nl(a){return a.userList.getUsers()}function ge(a,b,c,d){a.roomID=b,a.roomName=c,a.roomType=d,a.emit("room.join",Qa(a))}function ee(a,b={}){return b.roomID==null&&(b.roomID=Nc(a).push().key),Ho(a,b.roomID).then(function(){return Io(a,b)})}function Ho(a,b){return Zk(a,b).transaction(function(c){return c===null?!0:void 0})}function Io(a,{roomID:b,roomName:c="",roomType:d="",maxUsers:e=0,presisted:f=!1,door:g="open",join:j=!0,filterData:i}){let k=Nc(a,b),n=Lc(a,b),u=nc(a,b);a.isRemoveRoomWhenLeft=!f,a.isRemoveRoomWhenLeft&&(k.onDisconnect().remove(),n.onDisconnect().remove(),u.onDisconnect().remove());const w=mc(g,d),A={},C={filter:w,name:c};i&&(C.data=i),A[`room-filters/${b}`]=C;const F={name:c,filter:w,maxUsers:e,moderators:{}};return F.moderators[a.userID]=a.userName,A[`room-metadata/${b}`]=F,new Promise(function(H,Q){if(j){const L=a.userList.setRootPath(fe(a,b)).setMaxUsers(0).join();return a.userList.setMaxUsers(e),L.then(H,Q)}else return H()}).then(function(){return db(a).update(A)}).then(function(){return a.isRoomCreator=!0,j&&ge(a,b,c,d),Promise.resolve(Qa(a))})}function Xk(a,{digits:b=10,candidates:c="0123456789",retry:d=1e3}){let e=arguments[1];return Yk(a,b,c,d,e)}function Yk(a,b,c,d,e){return e.roomID=de(b,b,c),d<=0?Promise.reject(e):(d--,ee(a,e).catch(function(){return Yk(a,b,c,d,e)}))}function ke(a,b=a.roomID){const c={};c[`room-filter/${b}`]=null,c[`room-metadata/${b}`]=null,c[`rooms/${b}`]=null;const d=Qa(a);return db(a).update(c).then(function(){return Promise.resolve(d)})}function oc(a){if(!je(a))return Promise.resolve(Qa(a));a.leftRoomFlag=!0;if(a.isRemoveRoomWhenLeft)return ke(a);{const b=Qa(a);return a.userList.leave().then(function(){return Promise.resolve(b)})}}function ie(a,{leftThenJoin:b=!0,roomID:c}){return b?oc(a).then(function(){return jl(a,c)}):jl(a,c)}function jl(a,b){return b==null?Promise.reject(Qa(a,b,"")):(a.isRemoveRoomWhenLeft=!1,Lo(a,b).then(function(c){return a.userList.setRootPath(fe(a,b)).setMaxUsers(c.maxUsers).join().then(function(){return Promise.resolve(c)})}).then(function(c){return ge(a,b,c.name,hl(c.filter)),Promise.resolve(Qa(a))}))}function Lo(a,b){return nc(a,b).once("value").then(function(c){let d=c.val();return Mo(a,d)?Promise.resolve(d):Promise.reject()})}function Mo(a,b){if(b==null)return!1;if(il(b.filter)==="closed")return!1;const c=a.userID;if(b.moderators[c])return!0;switch(b.permission){case"blocklist":const d=b.blocklist;return!(d&&d[c]);case"allowlist":const e=b.allowlist;return e&&e[c];default:return!0}}function he(a,b,c){return new Promise(function(d,e){a.roomList.once("roomlist.update",function(f){d(f)}).startUpdate(dl(a,b,c))})}function fl(a,{roomType:b="",leftThenJoin:c=!0}={}){return he(a,b,"open").then(function(d){if(d.length===0)return Promise.reject("No filtered room");Yd(d);const e={leftThenJoin:c,roomID:""};return gl(a,e,d)})}function gl(a,b,c,d=0){return d===c.length?Promise.reject("Can't join any room"):(b.roomID=c[d].roomID,d++,ie(a,b).catch(function(){return gl(a,b,c,d)}))}function kl(a,b){return a.userList.contains(b)?b===a.userID?oc(a):a.userList.leave(b):Promise.resolve()}function wb(a,b){return b===a.roomID?Promise.resolve(!0):nc(a,b).once("value").then(function(c){const d=c.val()!==null;return Promise.resolve(d)})}function be(a,b,c=a.roomID){return wb(a,c).then(function(d){if(!d)return Promise.resolve();const e=mc(b,a.roomType),f={};return f[`room-filters/${c}/filter`]=e,f[`room-metadata/${c}/filter`]=e,db(a).update(f)})}function Tk(a,b=a.roomID){return be(a,"open",b)}function Uk(a,b=a.roomID){return be(a,"closed",b)}function Rk(a,b,c=a.roomID){return wb(a,c).then(function(d){return d?Lc(a,c).child("data").update(b):Promise.resolve()})}function Vk(a,b){return a.userList.changeUserName(b)}function Sk(a,b,c=a.roomID){return wb(a,c).then(function(d){if(!d)return Promise.resolve();const e={};return e[`room-filters/${c}/name`]=b,e[`room-metadata/${c}/name`]=b,db(a).update(e)})}function el(a,b=a.roomID){return b===a.roomID?a.userList.getUsers():new Promise(function(c,d){const e=new Qb({itemIDKey:"joinAt",mode:"once"});e.once("update",function(f){c(f)}).startUpdate(cl(a,b))})}const N$=Ka(La());class ol extends Ca{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",broadcast:e=!0,tables:f=!1}={}){super();this.setEventEmitter(a),this.database=N$.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.isRoomCreator=!1,this.roomID=void 0,this.roomName=void 0,this.roomType=void 0,this.doorState=void 0,this.leftRoomFlag=!1,this.isRemoveRoomWhenLeft=void 0,this.userList=bl(this),this.roomList=_k(this),this.broadcast=Wk(this,e),this.tables=al(this,f)}destroy(){var a=this;this.destroyEventEmitter().leaveRoom().then(function(){a.userList.destroy(),a.userList=void 0,a.roomList.destroy(),a.roomList=void 0,a.broadcast.destroy(),a.broadcast=void 0})}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}getRoomInfo(a,b){return Qa(this,a,b)}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(a){return je(this,a)}isFull(){return ll(this)}isFirstUser(a=this.userID){return ml(this,a)}getUsers(){return nl(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}createRoom(a){return ee(this,a)}createRandomRoom(a={}){return Xk(this,a)}joinRoom(a){return ie(this,a)}joinRandomRoom(a={}){return fl(this,a)}leaveRoom(){return oc(this)}removeRoom(a=this.roomID){return ke(this,a)}kickUser(a){return kl(this,a)}changeRoomState(a,b=this.roomID){return be(this,a,b)}openRoom(a=this.roomID){return Tk(this,a)}closeRoom(a=this.roomID){return Uk(this,a)}changeUserName(a){return Vk(this,a)}changeFilterData(a,b=this.roomID){return Rk(this,a,b)}changeRoomName(a,b,c=a.roomID){return Sk(this,b,c)}getUserList(a=this.roomID){return el(this,a)}getRoomList(a,b){return he(this,a,b)}HasRoom(a){return wb(this,a)}}function vl(a,b){let c=a.rootPath;return b&&(c+=`/${b}`),c}function tl(a){return vl(a,"users")}function rl(a,b){return`${vl(a,"tables")}/${b}`}const nb="room.join";const yb="room.leave";const Ng="userlist.join";const le="userlist.leave";const Pg="userlist.init";const Og="userlist.update";const Oc="userlist.changename";const Bg="broadcast.receive";function Cg(a){return`tables.${a}.init`}function Dg(a){return`tables.${a}.update`}function Eg(a){return`tables.${a}.addkey0`}function Fg(a){return`tables.${a}.addkey1`}function Gg(a){return`tables.${a}.addkey2`}function Hg(a){return`tables.${a}.removekey0`}function Ig(a){return`tables.${a}.removekey1`}function Jg(a){return`tables.${a}.removekey2`}function Kg(a){return`tables.${a}.changekey0`}function Lg(a){return`tables.${a}.changekey1`}function Mg(a){return`tables.${a}.changekey2`}function ul(a,b=0){const c=new lc({eventEmitter:a.eventEmitter,eventNames:{join:Ng,leave:le,update:Og,change:"userlist.change",init:Pg,changename:Oc},root:tl(a),userID:a.userInfo,maxUsers:b});return c.on(le,function(d){d.userID===a.userID&&Po(a)}),a.on(nb,function(){c.startUpdate()}).on(yb,function(){c.stopUpdate().clear()}),c}function Po(a){a.emit(yb),setTimeout(function(){a.leftRoomFlag=!1},0)}function ql(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new jc({eventEmitter:a.eventEmitter,eventNames:{receive:Bg},receiverID:"broadcast",senderID:a.userInfo,history:b.history});return a.on(nb,function(){c.setRootPath(a.rootPath).startReceiving()}).on(yb,function(){c.stopReceiving()}).on(Oc,function(d,e){c.changeUserName(d,e)}),c}function sl(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,Oo(a,d))}),a.on(nb,function(){for(const[d,e]of c)e.setRootPath(rl(a,d)).startUpdate()}).on(yb,function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function Oo(a,{key:b,type:c=ra["1d"]}){const d=new kc({eventEmitter:a.eventEmitter,type:c,eventNames:{init:Cg(b),update:Dg(b),addkey0:Eg(b),removekey0:Hg(b),changekey0:Kg(b),addkey1:Fg(b),removekey1:Ig(b),changekey1:Lg(b),addkey2:Gg(b),removekey2:Jg(b),changekey2:Mg(b)}});return d}function ne(a){return a.userList.isInList}function zl(a){return a.userList.isFull()}function Al(a,b=a.userID){return a.userList.isFirstUser(b)}function Bl(a){return a.userList.getUsers()}function xl(a){return a.userList.join().then(function(){return a.emit(nb),Promise.resolve()})}function me(a){return ne(a)?(a.leftRoomFlag=!0,a.userList.leave()):Promise.resolve()}function wl(a){return a.userList.getUsers()}function yl(a,b){return a.userList.contains(b)?b===a.userID?me(a):a.userList.leave(b):Promise.resolve()}function pl(a,b){return a.userList.changeUserName(b)}const z1=Ka(La());class Cl extends Ca{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,broadcast:f=!0,tables:g=!1}={}){const j=arguments[0];super();this.setEventEmitter(a),this.database=z1.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.leftRoomFlag=!1,this.userList=ul(this,e),this.broadcast=ql(this,f),this.tables=sl(this,g)}shutdown(){}destroy(){this.shutdown()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(){return ne(this)}isFull(){return zl(this)}isFirstUser(a=this.userID){return Al(this,a)}getUsers(){return Bl(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}joinRoom(){return xl(this)}leaveRoom(){return me(this)}getUserList(){return wl(this)}kickUser(a){return yl(this,a)}changeUserName(a){return pl(this,a)}}const Gh="statechange";function Hh(a){return`exit_${a}`}function Ih(a){return`enter_${a}`}class Fh extends Ca{constructor({eventEmitter:a=!0}={}){super();this.enable=!0;a&&this.setEventEmitter()}destroy(){this.destroyEventEmitter()}toJSON(){return{curState:this.state,prevState:this.prevState,enable:this.enable,start:this._start}}setEnable(a=!0){return this.enable=a,this}set state(a){if(!this.enable||this._stateLock)return;if(this._state===a)return;this._prevState=this._state,this._state=a,this._stateLock=!0,this.emit(Gh,this);if(this._prevState!=null){let b=Hh(this._prevState),c=this[b];c&&c.call(this),this.emit(b,this)}this._stateLock=!1;if(this._state!=null){let b=Ih(this._state),c=this[b];c&&c.call(this),this.emit(b,this)}}get state(){return this._state}get prevState(){return this._prevState}start(a){return this._start=a,this._prevState=void 0,this._state=a,this}goto(a){return a!=null&&(this.state=a),this}next(){let a,b=this["next_"+this.state];return b?(typeof b==="string"?a=b:a=b.call(this),this.goto(a),this):this}update(a,b,c="update"){let d=this[`${c}_${this.state}`];d&&d.call(this,a,b)}preupdate(a,b){this.update(a,b,"preupdate")}postupdate(a,b){this.update(a,b,"postupdate")}addState(a,{next:b,exit:c,enter:d}){return b&&(this[`next_${a}`]=b),c&&(this[`exit_${a}`]=c),d&&(this[`enter_${a}`]=d),this}addStates(a){for(const b in a)this.addState(b,a[b]);return this}}var Jh;(function(a){a[a.shuffle=0]="shuffle",a[a.random=1]="random"})(Jh||(Jh={}));const Gda=Ka(en());var Kh;(function(a){a[a.none=0]="none",a[a.base64=1]="base64",a[a.utf16=2]="utf16",a[a.uri=3]="uri"})(Kh||(Kh={}));var Bb;(function(a){a[a.circle=0]="circle",a[a.ellipse=1]="ellipse",a[a.roundRectangle=2]="roundRectangle"})(Bb||(Bb={}));class hm extends Uc{constructor(a,b,c,d,e=Bb.circle){super(a,b);this.type="rexMaskedImage",this.maskImage(c,d,e)}maskImage(a,b,c=Bb.circle){let d,e,f;typeof c==="object"?{maskType:d,backgroundStyle:e,radius:f}=c:d=c,typeof d==="string"&&(d=Bb[d]);const g=this.canvas,j=this.context,i=Ea.get();if(!i.has(a))return;const k=i.get(a).getFrame(b),n=k.width,u=k.height;g.width!==n&&(g.width=n),g.height!==u&&(g.height=u),j.clearRect(0,0,n,u),e&&(j.fillStyle=e,j.fillRect(0,0,n,u)),j.beginPath();switch(d){case Bb.roundRectangle:ve(j,0,0,n,u,f);break;default:const w=Math.floor(n/2),A=Math.floor(u/2);d===Bb.circle?j.arc(w,A,Math.min(w,A),0,2*Math.PI):j.ellipse(w,A,w,A,0,0,2*Math.PI);break}j.clip(),j.drawImage(k.texture.image,k.x,k.y,k.width,k.height),this.texture.setSize(n,u),this.setSize(n,u),this.updateTexture()}}var Da;(function(a){a[a.none=0]="none",a[a.word=1]="word",a[a.char=2]="char"})(Da||(Da={}));var va;(function(a){a[a.none=0]="none",a[a.raw=1]="raw",a[a.wrapped=2]="wrapped"})(va||(va={}));const yh=/(?:\r\n|\r|\n)/;function ym(a,b,c,d,e,f=0){e<=0&&(d=0);let g=[];if(!a||!a.length)return g;let j=a.split(yh),i=j.length-1;a.slice(-1)===`
`&&(j.length-=1);let k;for(let n=0,u=j.length;n<u;n++){let w=j[n],A=n===i?0:1;if(d===0){g.push(Yc(w,b(w,c),A));continue}n===0?k=e-f:k=e;if(w.length<=100){let L=b(w,c);if(L<=k){g.push(Yc(w,L,A));continue}}let C;d===1?C=w.split(" "):C=w;let F="",H="",Q=0;for(let L=0,R=C.length;L<R;L++){let I=C[L];d===1?(F+=I,L<R-1&&(F+=" ")):F+=I;let V=b(F,c);V>k&&(L===0?g.push(Yc("",0,2)):(g.push(Yc(H,Q,2)),F=I,d===1&&(L<R-1&&(F+=" ")),V=b(F,c)),k=e),H=F,Q=V}g.push(Yc(H,Q,A))}return g}let Yc=function(a,b,c){return{text:a,width:b,newLineMode:c}};var Xa;(function(a){a[a.left=0]="left",a[a.center=1]="center",a[a.right=2]="right"})(Xa||(Xa={}));var Ya;(function(a){a[a.top=0]="top",a[a.center=1]="center",a[a.bottom=2]="bottom"})(Ya||(Ya={}));class Bh{constructor(){this.pens=[]}destroy(){this.pens.length=0}addPen(a){return this.pens.push(a),this}get firstPen(){return this.pens[0]}get lastPen(){return this.pens[this.pens.length-1]}hasPen(){return this.pens.length>0}get pensCount(){return this.pens.length}get startIndex(){let a=this.pens[0];return a?a.startIndex:0}get width(){let a=this.lastPen;return a?a.lastX:0}}function Tb(a,b=Array.isArray(a)?[]:{}){Je(b);if(Array.isArray(a)){b.length=a.length;for(let c=0,d=a.length;c<d;c++)b[c]=a[c]}else for(let c in a)b[c]=a[c];return b}class Ch{constructor(){this.text="";this.x=0;this.y=0;this.width=0;this.height=0;this.ascent=0;this.descent=0;this.prop={};this.newLineMode=va.none;this.startIndex=0}set(a="",b=0,c=0,d=0,e=0,f=0,g=0,j={},i=va.none,k=0){return this.text=a,this.x=b,this.y=c,this.width=d,this.height=e,this.ascent=f,this.descent=g,this.prop=j,this.newLineMode=i,this.startIndex=k,this}clone(){let a=new Ch();return a.set(this.text,this.x,this.y,this.width,this.height,this.ascent,this.descent,Tb(this.prop),this.newLineMode,this.startIndex),a}get plainText(){return this.newLineMode===va.raw?`${this.text}
`:this.text}get wrapText(){return this.newLineMode!==va.none?`${this.text}
`:this.text}get plainTextLength(){let a=this.text.length;return this.newLineMode===va.raw&&(a+=1),a}get endIndex(){return this.startIndex+this.plainTextLength}get lastX(){return this.x+this.width}get isTextPen(){return this.text!==""}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}}class Vc{constructor({penPool:a}){this.pens=[];this.lines=[];this.pens=[],this.lines=[],this.penPool=a}destroy(){this.freePens()}freePens(){return this.penPool.pushMultiple(this.pens),this.lines.forEach(a=>{a.destroy()}),this.lines.length=0,this.maxLineWidth=0,this.totalLineHeight=0,this}addTextPen(a,b,c,d,e,f,g,j,i=va.none){let k=this.penPool.pop();return k==null&&(k=new Ch()),k.set(a,b,c,d,e,f,g,j,i),this.addPen(k),this}addImagePen(a,b,c,d,e){return this.addTextPen("",a,b,c,d,d,0,e,va.none),this}addNewLinePen(a){let b=this.lastPen;return b&&b.newLineMode===va.none&&(b.newLineMode=a),this}addPen(a){let b=this.lastPen;b==null?a.startIndex=0:a.startIndex=b.endIndex,this.pens.push(a);let c=this.lastLine;return c==null&&(c=new Bh(),this.lines.push(c)),c.addPen(a),a.newLineMode!==va.none&&(c=new Bh(),this.lines.push(c)),this}clone(a){a==null&&(a=new Vc({penPool:this.penPool})),a.freePens();const b=this.pens;for(let e=0,f=b.length;e<f;e++)a.addPen(b[e].clone());const c=this.lines,d=a.lines;for(let e=0,f=c.length;e<f;e++){const g=c[e],j=d[e];j.y=g.y,j.height=g.height}return a}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(a){if(a>=this.lines.length)return this.getLineEndIndex(a);{let b=this.lines[a];if(!b)return 0;let c=b.firstPen;return c?c.startIndex:0}}getLineEndIndex(a){let b=this.lines.length;a>=b&&(a=b-1);for(let c=a;c>=0;c--){let d=this.lines[c];if(d&&d.hasPen())return d.lastPen.endIndex}return 0}getLineWidth(a){let b=this.lines[a];return b?b.width:0}getLineHeights(a=[]){return this.lines.forEach(function(b){a.push(b.height)}),a}get lineCount(){return this.lines.length}get plainText(){let a=[],b=this.pens;for(let c=0,d=b.length;c<d;c++)a.push(b[c].plainText);return a.join()}get plainTextLength(){let a=0;for(let b=0,c=this.pens.length;b<c;b++)a+=this.pens[b].plainTextLength;return a}getSliceTagText(a,b,c=0,d,e=!1){if(d===void 0){let k=this.lastPen;if(!k)return"";d=k.endIndex}let f=[],g;for(var j=0,i=this.pens.length;j<i;j++){let k=this.pens[j],n=k.endIndex;if(n<=c)continue;let u=e?k.wrapText:k.plainText,w=k.prop,A=k.startIndex,C=A>=c&&n<=d;C||(u=u.substring(c-A,d-A)),b?f.push(a.call(b,u,w,g)):f.push(a(u,w,g)),g=w;if(n>=d)break}return f.join()}}function vm(a,b,c){let d=Tb(a,c);for(let e in b)d.hasOwnProperty(e)&&(d[e]=b[e]);return d}function Be(a,b,c={key:b}){c=vm(kp,c);let d=Ea.get(),e=d.get(c.key);if(!e)return;let f=e.getFrame(c.frame);if(!f)return;let g=c.width,j=c.height;(g===void 0||j===void 0)&&(g===void 0&&j===void 0?(c.width=f.width,c.height=f.height):g===void 0?c.width=f.width*(j/f.height):j===void 0&&(c.height=f.height*(g/f.width))),a.images.set(b,c)}const kp={key:void 0,frame:void 0,width:void 0,height:void 0,y:0,left:0,right:0,top:0,bottom:0};class rm{constructor(){this.images=new Map()}destroy(){this.images.clear()}add(a,b){if(typeof a==="string")Be(this,a,b);else if(Array.isArray(a)){let c=a;for(let d=0,e=c.length;d<e;d++)Be(this,c[d])}else{let c=a;for(a in c)Be(this,a,c[a])}return this}remove(a){return this.images.delete(a),this}get(a){return this.images.get(a)}getOuterWidth(a){let b=this.images.get(a);return b?b.width+b.left+b.right:0}getOuterHeight(a){let b=this.images.get(a);return b?b.height+b.top+b.bottom:0}getFrame(a){let b=this.images.get(a);if(!b)return;let c=Ea.get(),d=c.get(b.key);if(!d)return;let e=d.getFrame(b.frame);return e}hasTexture(a){return!!this.getFrame(a)}}function ze(a,b){a.font=b.font}function Ae(a,b){a.textBaseline="alphabetic",a.textAlign="start",a.fillStyle=b.fillStyle,a.strokeStyle=b.strokeStyle,a.lineWidth=b.strokeThickness,a.lineCap="round",a.lineJoin="round",a.imageSmoothingEnabled=b.antialias}function zh(a,b,c){c?(a.shadowColor=b.shadowColor,a.shadowBlur=b.shadowBlur,a.shadowOffsetX=b.shadowOffsetX,a.shadowOffsetY=b.shadowOffsetY):(a.shadowColor="#000",a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0)}function wm(a,b){return b.measureText(a).width}function xm(a,b,c=0){let d=b.measureText(a),e=d.actualBoundingBoxAscent,f=d.actualBoundingBoxDescent;return(!e&&!f||a==="")&&(e=c,f=0),Fe.ascent=e,Fe.descent=f,Fe.height=Math.ceil(Math.abs(e)+Math.abs(f)),Fe}let Fe={ascent:0,descent:0,height:0};function sm(a,b,c,d,e){a.freePens();if(b==="")return a;let f=c.canvas,g=c.context,j=c.parent,i=c.parser.splitText(b),k,n,u=0;for(var w=0,A=i.length;w<A;w++){let L=c.parser.tagTextToProp(i[w],k),R=L.text;k=L.prop;if(k.img){let I,V;c.imageManager?(I=c.imageManager.getOuterWidth(k.img),V=c.imageManager.getOuterHeight(k.img)):(I=0,V=0),e>0&&d!==Da.none&&(e<u+I&&(a.addNewLinePen(va.wrapped),u=0)),a.addImagePen(u,0,I,V,Tb(k)),u+=I}else if(R!==""){g.save();let I=c.parser.propToStyle(j,k);ze(g,I),Ae(g,I);let V=I.strokeThickness,W=V/2;n=ym(R,wm,g,d,e,u);let K=xm("|MÃq",g);for(let q=0,r=n.length;q<r;q++){const h=n[q],m=K.height+V,l=K.ascent+W,p=K.descent+W;a.addTextPen(h.text,u,0,h.width,m,l,p,Tb(k),h.newLineMode),h.newLineMode!==va.none?u=0:u+=h.width}g.restore()}}let C=a.lines,F=c.parent.lineSpacing,H=0,Q=0;for(let L=0,R=C.length;L<R;L++){const I=C[L],V=I.pens,W=V.length;let K=0,q=0;for(let m=0;m<W;m++){const l=V[m];K=Math.max(K,l.ascent),q=Math.max(q,l.descent)}const r=K+q,h=Q+K;for(let m=0;m<W;m++)V[m].y+=h;I.y=h,I.height=r,H=Math.max(H,I.width),Q+=r+F}return a.maxLineWidth=H,a.totalLineHeight=Q-F,a}const Ki={PI2:Math.PI*2,HALF_PI:Math.PI*.5,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};class jp extends Ha{constructor(a,b,c,d,e){super(a,b,c,d);this.name=e}}class um{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return this.hitAreas.length=0,this}add(a,b,c,d,e){let f=new jp(b,c,d,e,a);return this.hitAreas.push(f),this}getFirstHitArea(a,b){for(let c=0,d=this.hitAreas.length;c<d;c++){let e=this.hitAreas[c];if(e.contains(a,b))return e}return null}}function tm(a,b,c,d,e,f=0,g=0,j=a.penManager){a.hitAreaManager&&a.hitAreaManager.clear();let i=j.totalLineHeight;if(i===0)return;const k=d<a.textWidth||e<a.textHeight;let n=a.context;n.save();let u=a.parent;ep(a,u),fp(a,u),k&&(n.beginPath(),n.rect(b,c,d,e),n.clip());const w=u.hAlign,A=u.vAlign;let C=c+g;switch(A){case Ya.center:C+=(e-i)/2;break;case Ya.bottom:C+=e-i-2;break}let F=j.lines,H=C;const Q=b+e;for(let L=0,R=F.length;L<R;L++){let I=F[L];if(H>Q)break;const V=H+I.height;if(V<c){H=V;continue}let W=I.width;if(W===0){H=V;continue}let K=b+f;switch(w){case Xa.center:K+=(d-W)/2;break;case Xa.right:K+=d-W;break}let q=I.pens;for(let r=0,h=q.length;r<h;r++)dp(a,q[r],K,C);H=V}n.restore()}function dp(a,b,c,d){c+=b.x,d+=b.y;let e=a.canvas,f=a.context,g=a.parent;f.save();let j=a.parser.propToStyle(g,b.prop);ze(f,j),Ae(f,j),j.underlineThickness>0&&b.width>0&&gp(a,c,d,b.width,j),b.isTextPen&&hp(a,c,d,b.text,j),b.isImagePen&&ip(a,c,d,b.prop.img,j),f.restore(),b.hasAreaMarker&&b.width>0&&(a.hitAreaManager||(a.hitAreaManager=new um()),a.hitAreaManager.add(b.prop.area,c,d,b.width,b.height))}function ep(a,b){let c=a.canvas,d=a.context;d.clearRect(0,0,c.width,c.height)}function fp(a,b){let c=a.canvas,d=a.context;d.clearRect(0,0,c.width,c.height);const e=b.backgroundFillStyle,f=b.backgroundStrokeStyle;if(e||f){const g=b.backgroundStrokeThickness,j=g/2,i=b.cornerRadius,k=j,n=j,u=c.width-g,w=c.height-g;Ah(c,d,k,n,u,w,i,e,f,g)}else d.clearRect(0,0,c.width,c.height)}function gp(a,b,c,d,e){c+=e.underlineOffsetY-e.underlineThickness/2;let f=a.context,g=f.lineCap;f.lineCap="butt",f.beginPath(),f.strokeStyle=e.underlineStyle,f.lineWidth=e.underlineThickness,f.moveTo(b,c),f.lineTo(b+d,c),f.stroke(),f.lineCap=g}function hp(a,b,c,d,e){let f=a.context;e.strokeStyle&&e.strokeStyle!=="none"&&e.strokeThickness>0&&(zh(f,e,e.shadowStroke),f.strokeText(d,b,c)),e.fillStyle&&e.fillStyle!=="none"&&(zh(f,e,e.shadowFill),f.fillText(d,b,c))}function ip(a,b,c,d,e){let f=a.imageManager;if(!f)return;let g=f.get(d),j=f.getFrame(d);b+=g.left,c+=g.y-g.height;let i=a.context;i.drawImage(j.texture.image,j.x,j.y,j.width,j.height,b,c,g.width,g.height)}class im{constructor({canvas:a,context:b,parent:c,parser:d,penPool:e=new Sb()}){this.textOffsetX=0;this.textOffsetY=0;this.canvas=a,this.context=b,this.parser=d,this.parent=c,this.penPool=e,this.penManager=new Vc({penPool:e})}destroy(){this.parser.destroy(),this.canvas=null,this.context=null,this.parser=null,this.parent=null,this.penManager&&(this.penManager.destroy(),this.penManager=null),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=null),this.imageManager&&(this.imageManager.destroy(),this.imageManager=null),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=null)}get textWidth(){return this.penManager.maxLineWidth}get textHeight(){return this.penManager.totalLineHeight}updatePenManager(a,b,c,d=this.penManager){return sm(d,a,this,b,c)}draw(a,b,c,d,e=0,f=0){return tm(this,a,b,c,d,e,f,this.penManager),this}get lines(){return this.penManager.lines}get tmpPenManager(){return this._tmpPenManager===null&&(this._tmpPenManager=new Vc({penPool:this.penPool})),this._tmpPenManager}getPlainText(a,b,c){let d;return a==null?d=this.penManager.plainText:d=this.parser.splitText(a,!0).join(""),(b!=null||c!=null)&&(b==null&&(b=0),c==null&&(c=d.length),d=d.substring(b,c)),d}getPenManager(a,b){return a===void 0?this.clonePenManager(b,this.penManager):(b===void 0&&(b=new Vc({penPool:this.penPool})),this.updatePenManager(a,this.parent.wrapMode,this.parent.wrapWidth,b),b)}getText(a,b,c,d){if(a==null)return this.penManager.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d);let e=this.tmpPenManager;return this.updatePenManager(a,this.parent.wrapMode,this.parent.wrapWidth,e),e.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d)}clonePenManager(a,b=this.penManager){return b.clone(a)}getLastPen(a=this.penManager){return a.lastPen}addImageInfo(a,b){return this.imageManager===void 0&&(this.imageManager=new rm()),this.imageManager.add(a,b),this}}function lh(a){let b=a.canvasText;a.canvasText.updatePenManager(a.text,a.wrapMode,a.wrapWidth);let c=a.padding,d,e,f,g;a.fixedWidth===0?(d=b.textWidth,f=d+c.left+c.right):(f=a.fixedWidth,d=f-c.left-c.right,d>b.textWidth&&(d=b.textWidth)),a.fixedHeight===0?(e=b.textHeight,g=e+c.top+c.bottom):(g=a.fixedHeight,e=g-c.top-c.bottom,e>b.textHeight&&(e=b.textHeight));let j=a.resolution,i=Math.ceil(f*j),k=Math.ceil(g*j),n=a.canvas;(n.width!==i||n.height!==k)&&(n.width=i,n.height=k,a.texture.setSize(f,g),a.setSize(f,g));let u=a.context;u.save(),u.scale(j,j),b.draw(c.left,c.top,d,e,0,a.textOffsetY),u.restore(),a.texture.binding&&a.texture.binding.update(),a.setDirty(aa.TEXTURE)}function we(a,b=0,c=0){a.fixedWidth=b,a.fixedHeight=c,ye(a)}function mh(a,b,c,d,e){const f=a.padding;if(typeof b==="number")f.left=b,f.right=c===void 0?b:c,f.top=d===void 0?b:d,f.bottom=e===void 0?b:e;else{let g=b;f.left=g.left??0,f.right=g.right??0,f.top=g.top??0,f.bottom=g.bottom??0}ye(a)}function ye(a){const b=a.fixedWidth;if(a.wrapMode!==Da.none){const c=a.padding,d=b-c.left-c.right;a.wrapWidth=Math.max(d,0)}else a.wrapWidth=0}function jm(a,b,c=!1){c?a.textOffsetYPercentage=b:a.textOffsetY=b}function nh(a,b=Xa.left){typeof b==="string"&&(b=Xa[b]),a.hAlign=b}function oh(a,b=Ya.top){typeof b==="string"&&(b=Ya[b]),a.vAlign=b}function ph(a,b=0){a.lineSpacing=b}function qh(a,b,c,d=0,e=0){c||(d=0),a.backgroundFillStyle=b,a.backgroundStrokeStyle=c,a.backgroundStrokeThickness=d,a.cornerRadius=e}function km(a,b,c){b&&rh(a,b),c&&sh(a,c)}function rh(a,b){a.fontFamily=b}function sh(a,b){typeof b==="number"&&(b=`${b}px`),a.fontSize=b}function th(a,b){a.fillStyle=b}function uh(a,b,c=2){a.strokeStyle=b,a.strokeThickness=c}function vh(a,b="#000",c=5,d=0,e=0,f=!1,g=!1){a.shadowColor=b,a.shadowBlur=c,a.shadowOffsetX=d,a.shadowOffsetY=e,a.shadowFill=f,a.shadowStroke=g}function wh(a,b,c){typeof b==="string"&&(b=Da[b]),a.wrapMode=b,c===void 0?ye(a):a.wrapWidth=c}function xh(a,b,c=2,d=0){a.underlineStyle=b,a.underlineThickness=c,a.underlineOffsetY=d}function kh(a,b,c){a.canvasText.addImageInfo(b,c)}function lm(a,b,c,d){return b=a.canvasText.getText(b,c,d,!0),b.split(yh)}function mm(a,b,c,d){return a.canvasText.getPlainText(b,c,d)}function nm(a,b,c,d){return a.canvasText.getText(b,c,d,!1)}function om(a,b,c,d){return a.canvasText.getText(b,c,d,!1)}function pm(a,b){return a.canvasText.clonePenManager(b)}function qm(a,b,c){return a.canvasText.getPenManager(b,c)}class xe extends hd{constructor(a,b,c="",{width:d=0,height:e=0,padding:f,wrapMode:g=Da.none,backgroundFillStyle:j,backgroundStrokeStyle:i,backgroundStrokeThickness:k,cornerRadius:n=0,hAlign:u=Xa.left,vAlign:w=Ya.top,lineSpacing:A=0,fontFamily:C="monospace",fontSize:F="16px",fillStyle:H="#fff",strokeStyle:Q,strokeThickness:L=1,shadowColor:R="#000",shadowBlur:I=4,shadowOffsetX:V=0,shadowOffsetY:W=0,shadowFill:K=!1,shadowStroke:q=!1,underlineStyle:r="#fff",underlineThickness:h=1,underlineOffsetY:m=0,images:l}={},p){super(a,b,_b());this.antialias=!1;this.fontFamily="monospace";this.fontSize="16px";this.fillStyle="#fff";this.strokeThickness=1;this.shadowStroke=!1;this.shadowFill=!1;this.shadowColor="#000";this.shadowBlur=4;this.shadowOffsetX=0;this.shadowOffsetY=0;this.underlineStyle="#fff";this.underlineThickness=1;this.underlineOffsetY=0;this.hAlign=Xa.left;this.vAlign=Ya.top;this.lineSpacing=0;this.wrapMode=Da.none;this.wrapWidth=0;this.fixedWidth=0;this.fixedHeight=0;this.padding={left:0,right:0,top:0,bottom:0};this._textOffsetY=0;this.type="rexText";const t=wa.get();this.resolution=t.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.canvasText=new im({canvas:this.canvas,context:this.context,parent:this,parser:p}),we(this,d,e),f&&mh(this,f),wh(this,g),nh(this,u),oh(this,w),ph(this,A),qh(this,j,i,k,n),rh(this,C),sh(this,F),th(this,H),Q&&uh(this,Q,L),vh(this,R,I,V,W,K,q),xh(this,r,h,m),l&&kh(this,l),this.setText(c)}destroy(a){this.canvasText.destroy(),this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}updateText(){return lh(this),this}get text(){return this._text}set text(a){this.setText(a)}setText(a="",b=!0){return Array.isArray(a)&&(a=a.join(`
`)),a!==this._text&&(this._text=a.toString(),b&&this.updateText()),this}setBackgroundStyle(a,b,c=2,d=0){return qh(this,a,b,c,d),this}setFixedSize(a,b){return we(this,a,b),this}setPadding(a,b,c,d){return mh(this,a,b,c,d),this}setTextOffsetY(a,b=!1){return jm(this,a,b),this}setHAlign(a=Xa.left){return nh(this,a),this}setVAlign(a=Ya.top){return oh(this,a),this}setLineSpacing(a=0){return ph(this,a),this}setFont(a,b){return km(this,a,b),this}setFillStyle(a){return th(this,a),this}setStrokeStyle(a,b=2){return uh(this,a,b),this}setShadow(a="#000",b=5,c=0,d=0,e=!1,f=!1){return vh(this,a,b,c,d,e,f),this}resize(a,b){return we(this,a,b),lh(this),this}setWrapMode(a,b=0){return wh(this,a,b),this}setUnderline(a,b=2,c=0){return xh(this,a,b,c),this}addImageInfo(a,b){return kh(this,a,b),this}getWrappedText(a,b,c){return lm(this,a,b,c)}getPlainText(a,b,c){return mm(this,a,b,c)}getText(a,b,c){return nm(this,a,b,c)}getSubString(a,b,c){return om(this,a,b,c)}clonePenManager(a){return pm(this,a)}getPenManager(a,b){return qm(this,a,b)}get textOffsetY(){return this._textOffsetY}set textOffsetY(a){this._textOffsetY=a}get textOffsetYPercentage(){return-this._textOffsetY/(this.totalTextHeight-this.displayTextHeight)}set textOffsetYPercentage(a){const b=this.displayTextHeight,c=this.totalTextHeight;c<=b?this._textOffsetY=0:this._textOffsetY=-(c-b)*a}get totalTextHeight(){return this.canvasText.textHeight}get displayTextHeight(){const a=this.padding;return this.height-a.top-a.bottom}}class Ce{destroy(){}}const De={text:null,prop:null},Ee={font:void 0,fontFamily:void 0,fontStyle:void 0,fontSize:void 0,fillStyle:void 0,strokeStyle:void 0,strokeThickness:void 0,shadowColor:void 0,shadowOffsetX:void 0,shadowOffsetY:void 0,shadowBlur:void 0,shadowStroke:void 0,shadowFill:void 0,underlineStyle:void 0,underlineThickness:void 0,underlineOffsetY:void 0,image:void 0};class zm extends Ce{splitText(a,b=!1){const c=[];let d=0;for(;;){const f=Dh.exec(a);if(!f)break;const g=f[0],j=Dh.lastIndex-g.length;d<j&&c.push(a.substring(d,j)),b||c.push(g),d=Dh.lastIndex}const e=a.length;return d<e&&c.push(a.substring(d,e)),c}tagTextToProp(a,b){let c,d;b==null&&(b={}),b.img&&ta(b,fb,"img"),np.test(a)?(ta(b,Sa,"b",!0),c=""):op.test(a)?(ta(b,fb,"b"),c=""):pp.test(a)?(ta(b,Sa,"i",!0),c=""):qp.test(a)?(ta(b,fb,"i"),c=""):Am.test(a)?(d=a.match(Am),ta(b,Sa,"size",d[1]+"px"),c=""):rp.test(a)?(ta(b,fb,"size"),c=""):Bm.test(a)?(d=a.match(Bm),ta(b,Sa,"color",d[1]),c=""):sp.test(a)?(ta(b,fb,"color"),c=""):Cm.test(a)?(d=a.match(Cm),ta(b,Sa,"u",!0),c=""):Dm.test(a)?(d=a.match(Dm),ta(b,Sa,"u",d[1]),c=""):tp.test(a)?(ta(b,fb,"u"),c=""):up.test(a)?(ta(b,Sa,"shadow",!0),c=""):Em.test(a)?(d=a.match(Em),ta(b,Sa,"shadow",d[1]),c=""):vp.test(a)?(ta(b,fb,"shadow"),c=""):wp.test(a)?(ta(b,Sa,"stroke",!0),c=""):Fm.test(a)?(d=a.match(Fm),ta(b,Sa,"stroke",d[1]),c=""):xp.test(a)?(ta(b,fb,"stroke"),c=""):Gm.test(a)?(d=a.match(Gm),ta(b,Sa,"img",d[1]),c=""):yp.test(a)?(ta(b,fb,"img"),c=""):Hm.test(a)?(d=a.match(Hm),ta(b,Sa,"area",d[1]),c=""):zp.test(a)?(ta(b,fb,"area"),c=""):c=a;const e=De;return e.text=c,e.prop=b,e}propToStyle(a,b){const c=Ee;return b.hasOwnProperty("img")?c.image=b.img:(c.image=null,c.fontFamily=a.fontFamily,c.fontSize=b.size??a.fontSize,c.fontStyle=lp(b.b,b.i),c.font=`${c.fontStyle} ${c.fontSize} ${c.fontFamily}`,c.fillStyle=b.color??a.fillStyle,b.hasOwnProperty("stroke")?b.stroke===!0?(c.strokeStyle=a.strokeStyle,c.strokeThickness=a.strokeThickness):(c.strokeStyle=b.stroke,c.strokeThickness=a.strokeThickness):(c.strokeStyle=a.strokeStyle,c.strokeThickness=0)),b.hasOwnProperty("shadow")?b.shadow===!0?(c.shadowColor=a.shadowColor,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor=b.shadow,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor="#000",c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=0,c.shadowStroke=!1,c.shadowFill=!1),b.hasOwnProperty("u")?b.u===!0?(c.underlineStyle=a.underlineStyle,c.underlineThickness=a.underlineThickness,c.underlineOffsetY=a.underlineOffsetY):(c.underlineStyle=b.u,c.underlineThickness=a.underlineThickness,c.underlineOffsetY=a.underlineOffsetY):(c.underlineStyle="#000",c.underlineThickness=0,c.underlineOffsetY=0),c}propToTagText(a,b,c){c==null&&(c=mp);let d=[];for(const f in c){if(b.hasOwnProperty(f))continue;d.push(`[/${f}]`)}a=`${d.join()}${a}`;let e=[];for(const f in b){if(c[f]===b[f])continue;switch(f){case"size":const g=b.size.replace("px","");e.push(`[size=${g}]`);break;case"color":case"img":case"area":e.push(`[${f}=${b[f]}]`);break;case"stroke":case"u":b[f]===!0?e.push(`[${f}]`):e.push(`[${f}=${b[f]}]`);break;default:e.push(`[${f}]`);break}}return a=`${a}${e.join()}`,a}}const ta=function(a,b,c,d){return b===Sa?a[c]=d:a.hasOwnProperty(c)&&delete a[c],a};var lp=function(a,b){return a&&b?"bold italic":a?"bold":b?"italic":""};const mp={},Dh=/\[b\]|\[\/b\]|\[i\]|\[\/i\]|\[size=(\d+)\]|\[\/size\]|\[color=([a-z]+|#[0-9abcdef]+)\]|\[\/color\]|\[u\]|\[u=([a-z]+|#[0-9abcdef]+)\]|\[\/u\]|\[shadow\]|\[shadow=([a-z]+|#[0-9abcdef]+)\]|\[\/shadow\]|\[stroke\]|\[stroke=([a-z]+|#[0-9abcdef]+)\]|\[\/stroke\]|\[img=([^\]]+)\]|\[\/img\]|\[area=([^\]]+)\]|\[\/area\]/ig;var np=/\[b\]/i,op=/\[\/b\]/i,pp=/\[i\]/i,qp=/\[\/i\]/i,Am=/\[size=(\d+)\]/i,rp=/\[\/size\]/i,Bm=/\[color=([a-z]+|#[0-9abcdef]+)\]/i,sp=/\[\/color\]/i,Cm=/\[u\]/i,Dm=/\[u=([a-z]+|#[0-9abcdef]+)\]/i,tp=/\[\/u\]/i,up=/\[shadow\]/i,Em=/\[shadow=([a-z]+|#[0-9abcdef]+)\]/i,vp=/\[\/shadow\]/i,wp=/\[stroke\]/i,Fm=/\[stroke=([a-z]+|#[0-9abcdef]+)\]/i,xp=/\[\/stroke\]/i,Gm=/\[img=([^\]]+)\]/i,yp=/\[\/img\]/i,Hm=/\[area=([^\]]+)\]/i,zp=/\[\/area\]/i;const fb=!1,Sa=!0;class _c extends xe{constructor(a,b,c="",d){super(a,b,c,d,new zm());this.type="rexBBcodeText"}}class Jm extends Ce{constructor(a){super();this.tags=new Map();if(a)for(const b in a)this.addTag(b,a[b])}destroy(){this.tags.clear()}addTag(a,b){return this.tags.set(a,b),this}isTextTag(a){const b=this.tags.get(a);return b?b.img==null:!1}splitText(a,b=!1){const c=[];let d=0;for(;;){const f=Eh.exec(a);if(!f)break;const g=f[0],j=Eh.lastIndex-g.length;d<j&&c.push(a.substring(d,j));if(!b)c.push(g);else if(Lm.test(g)){const i=g.match(Mm);c.push(i[2])}else if(Nm.test(g)){const i=g.match(Om);c.push(i[2])}d=Eh.lastIndex}const e=a.length;return d<e&&c.push(a.substring(d,e)),c}tagTextToProp(a,b){let c,d;if(Lm.test(a)){const f=a.match(Mm);if(f!=null){const g=f[1],j=this.tags;d=j.get(g)??{},d._class=g,c=f[2]}}else if(Nm.test(a)){const f=a.match(Om);if(f!=null){const g=f[1];d=Ap(g),d._style=g,c=f[2]}}c===void 0&&(c=a),d===void 0&&(d={});const e=De;return e.text=c,e.prop=d,e}propToStyle(a,b){const c=Ee;if(b.hasOwnProperty("img"))c.image=b.img;else{c.image=null,c.fontFamily=b.family??b.fontFamily??b["font-family"]??a.fontFamily;let d=b.size??b.fontSize??b["font-size"]??a.fontSize;typeof d==="number"&&(d=`${d}px`),c.fontSize=d,c.fontStyle=b.style??b.fontStyle??b["font-style"]??"",c.font=`${c.fontStyle} ${c.fontSize} ${c.fontFamily}`,c.fillStyle=b.color??b["font-color"]??a.fillStyle;if(b.hasOwnProperty("stroke")){const e=b.stroke;c.strokeStyle=e.color??a.strokeStyle,c.strokeThickness=e.thinkness??a.strokeThickness}else c.strokeStyle=a.strokeStyle,c.strokeThickness=a.strokeThickness}if(b.hasOwnProperty("shadow")){const d=b.shadow;c.shadowColor=d.color??a.shadowColor,c.shadowOffsetX=d.offsetX??a.shadowOffsetX,c.shadowOffsetY=d.offsetY??a.shadowOffsetY,c.shadowBlur=d.blur??a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0}else c.shadowColor=a.shadowColor,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=a.shadowStroke,c.shadowFill=a.shadowFill;if(b.hasOwnProperty("u")||b.hasOwnProperty("underline")){const d=b.u??b.underline;c.underlineStyle=d.color??a.underlineStyle,c.underlineThickness=d.thinkness??a.underlineThickness,c.underlineOffsetY=d.offset??a.underlineOffsetY}else c.underlineStyle="#000",c.underlineThickness=0,c.underlineOffsetY=0;return c}propToTagText(a,b,c){if(b.hasOwnProperty("_class")){if(a===""){if(this.isTextTag(b._class))return""}return`<class=${b._class}>${a}</class>`}else if(b.hasOwnProperty("_style"))return`<style=${b._style}>${a}</style>`}}function Ap(a){const b=a.split(";"),c={};for(var d=0,e=b.length;d<e;d++){const[f,g]=b[d].split(":");if(Km(f)||Km(g))continue;if(f==="stroke"){const j=g.split(" "),i={},k=j.length;k>=1&&(i.color=j[0]),k>=2&&(i.thinkness=parseInt(j[1].replace("px",""))),c.stroke=i}else if(f==="shadow"){const j=g.split(" "),i={},k=j.length;k>=1&&(i.color=j[0]),k>=2&&(i.offsetX=parseInt(j[1].replace("px",""))),k>=3&&(i.offsetY=parseInt(j[2].replace("px",""))),k>=4&&(i.blur=parseInt(j[3].replace("px",""))),c.shadow=i}else if(f==="u"||f==="underline"){const j=g.split(" "),i={},k=j.length;k>=1&&(i.color=j[0]),k>=2&&(i.thinkness=parseInt(j[1].replace("px",""))),k>=3&&(i.offset=parseInt(j[2].replace("px",""))),c[f]=i}else c[f]=g}return c}function Km(a){return a=a.replace(Bp,""),a.length===0}const Eh=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,Lm=/<\s*class=/i,Mm=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,Nm=/<\s*style=/i,Om=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,Bp=/^\s+|\s+$/;class Im extends xe{constructor(a,b,c="",d){const e=d?d.tags:void 0;super(a,b,c,d,new Jm(e));this.type="rexTagText"}get parser(){return this.canvasText.parser}addTag(a,b){return this.parser.addTag(a,b),this}addTags(a){for(const b in a)this.parser.addTag(b,a[b]);return this}}var Of;(function(a){a[a.ascending=0]="ascending",a[a.descending=1]="descending",a[a.logical_ascending=2]="logical_ascending",a[a.logical_descending=3]="logical_descending"})(Of||(Of={}));class hn extends Xh{constructor(){super();Yh("dude","../assets/phaser-dude.png").load().then(()=>{this.create()})}create(){const a=new Re(this),b=new _c(400,300,"",{width:140,height:240,padding:20,wrapMode:"char",backgroundStrokeStyle:"BurlyWood",backgroundStrokeThickness:4,cornerRadius:20,images:["dude"]});Zc(a,b);const c=[];for(let g=0;g<100;g++){let j=g%5===0?`[size=30][color=red]${g}[img=dude]`:`[size=20][color=green]${g}`;c.push(j)}b.setText(c);let d=20*1e3,e=!1,f=0;hb(a,"update",function(g){f+=e?-g:g,f<0?(f=0,e=!1):f>d&&(f=d,e=!0),b.setTextOffsetY(f/d,!0).updateText()})}}new Wh(Qe(),Pe(800,600),Ne("game"),Me(2960685),Oe(hn));})();
/* @license
Papa Parse
v5.2.0
https://github.com/mholt/PapaParse
License: MIT
*/
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
//# sourceMappingURL=bundle.js.map

(()=>{var Te=Object.defineProperty,xn=Object.prototype.hasOwnProperty,jb=(a,b)=>()=>(b||(b={exports:{}},a(b.exports,b)),b.exports),yn=a=>Te(a,"__esModule",{value:!0}),$b=(a,b)=>{yn(a);for(var c in b)Te(a,c,{get:b[c],enumerable:!0})},jq=(a,b)=>{yn(a);if(typeof b==="object"||typeof b==="function")for(let c in b)xn.call(b,c)&&!xn.call(a,c)&&c!=="default"&&Te(a,c,{get:()=>b[c],enumerable:!0});return a},Ia=a=>a&&a.__esModule?a:jq(Te({},"default",{value:a,enumerable:!0}),a);var Af=jb((a,b)=>{!function(c,d){"function"==typeof define&&define.amd?define([],d):"object"==typeof b&&"undefined"!=typeof a?b.exports=d():c.Papa=d()}(a,function c(){"use strict";var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==d?d:{},e=!d.document&&!!d.postMessage,f=e&&/blob:/i.test((d.location||{}).protocol),g={},j=0,i={parse:function(q,r){var h=(r=r||{}).dynamicTyping||!1;K(h)&&(r.dynamicTypingFunction=h,h={});if(r.dynamicTyping=h,r.transform=!!K(r.transform)&&r.transform,r.worker&&i.WORKERS_SUPPORTED){var m=function(){if(!i.WORKERS_SUPPORTED)return!1;var p=(o=d.URL||d.webkitURL||null,E=c.toString(),i.BLOB_URL||(i.BLOB_URL=o.createObjectURL(new Blob(["(",E,")();"],{type:"text/javascript"})))),u=new d.Worker(p),o,E;return u.onmessage=L,u.id=j++,g[u.id]=u}();return m.userStep=r.step,m.userChunk=r.chunk,m.userComplete=r.complete,m.userError=r.error,r.step=K(r.step),r.chunk=K(r.chunk),r.complete=K(r.complete),r.error=K(r.error),delete r.worker,void m.postMessage({input:q,config:r,workerId:m.id})}var l=null;return i.NODE_STREAM_INPUT,"string"==typeof q?l=r.download?new t(r):new x(r):!0===q.readable&&K(q.read)&&K(q.on)?l=new C(r):(d.File&&q instanceof File||q instanceof Object)&&(l=new v(r)),l.stream(q)},unparse:function(q,r){var h=!1,m=!0,l=",",p=`\r
`,u='"',o=u+u,E=!1,G=null;!function(){if("object"!=typeof r)return;"string"!=typeof r.delimiter||i.BAD_DELIMITERS.filter(function(B){return-1!==r.delimiter.indexOf(B)}).length||(l=r.delimiter),("boolean"==typeof r.quotes||"function"==typeof r.quotes||Array.isArray(r.quotes))&&(h=r.quotes),"boolean"!=typeof r.skipEmptyLines&&"string"!=typeof r.skipEmptyLines||(E=r.skipEmptyLines),"string"==typeof r.newline&&(p=r.newline),"string"==typeof r.quoteChar&&(u=r.quoteChar),"boolean"==typeof r.header&&(m=r.header);if(Array.isArray(r.columns)){if(0===r.columns.length)throw new Error("Option columns is empty");G=r.columns}void 0!==r.escapeChar&&(o=r.escapeChar+u)}();var X=new RegExp(H(u),"g");"string"==typeof q&&(q=JSON.parse(q));if(Array.isArray(q)){if(!q.length||Array.isArray(q[0]))return Y(null,q,E);if("object"==typeof q[0])return Y(G||A(q[0]),q,E)}else if("object"==typeof q)return"string"==typeof q.data&&(q.data=JSON.parse(q.data)),Array.isArray(q.data)&&(q.fields||(q.fields=q.meta&&q.meta.fields),q.fields||(q.fields=Array.isArray(q.data[0])?q.fields:A(q.data[0])),Array.isArray(q.data[0])||"object"==typeof q.data[0]||(q.data=[q.data])),Y(q.fields||[],q.data||[],E);throw new Error("Unable to serialize unrecognized input");function A(B){if("object"!=typeof B)return[];var J=[];for(var Z in B)J.push(Z);return J}function Y(B,J,Z){var ia="";"string"==typeof B&&(B=JSON.parse(B)),"string"==typeof J&&(J=JSON.parse(J));var na=Array.isArray(B)&&0<B.length,pa=!Array.isArray(J[0]);if(na&&m){for(var ma=0;ma<B.length;ma++)0<ma&&(ia+=l),ia+=M(B[ma],ma);0<J.length&&(ia+=p)}for(var T=0;T<J.length;T++){var ea=na?B.length:J[T].length,ja=!1,ka=na?0===Object.keys(J[T]).length:0===J[T].length;if(Z&&!na&&(ja="greedy"===Z?""===J[T].join("").trim():1===J[T].length&&0===J[T][0].length),"greedy"===Z&&na){for(var P=[],S=0;S<ea;S++){var ga=pa?B[S]:S;P.push(J[T][ga])}ja=""===P.join("").trim()}if(!ja){for(var N=0;N<ea;N++){0<N&&!ka&&(ia+=l);var fa=na&&pa?B[N]:N;ia+=M(J[T][fa],N)}T<J.length-1&&(!Z||0<ea&&!ka)&&(ia+=p)}}return ia}function M(B,J){if(null==B)return"";if(B.constructor===Date)return JSON.stringify(B).slice(1,25);var Z=B.toString().replace(X,o),ia="boolean"==typeof h&&h||"function"==typeof h&&h(B,J)||Array.isArray(h)&&h[J]||function(na,pa){for(var ma=0;ma<pa.length;ma++)if(-1<na.indexOf(pa[ma]))return!0;return!1}(Z,i.BAD_DELIMITERS)||-1<Z.indexOf(l)||" "===Z.charAt(0)||" "===Z.charAt(Z.length-1);return ia?u+Z+u:Z}}};if(i.RECORD_SEP=String.fromCharCode(30),i.UNIT_SEP=String.fromCharCode(31),i.BYTE_ORDER_MARK="ï»¿",i.BAD_DELIMITERS=["\r",`
`,'"',i.BYTE_ORDER_MARK],i.WORKERS_SUPPORTED=!e&&!!d.Worker,i.NODE_STREAM_INPUT=1,i.LocalChunkSize=10485760,i.RemoteChunkSize=5242880,i.DefaultDelimiter=",",i.Parser=Q,i.ParserHandle=F,i.NetworkStreamer=t,i.FileStreamer=v,i.StringStreamer=x,i.ReadableStreamStreamer=C,d.jQuery){var k=d.jQuery;k.fn.parse=function(q){var r=q.config||{},h=[];return this.each(function(p){if(!("INPUT"===k(this).prop("tagName").toUpperCase()&&"file"===k(this).attr("type").toLowerCase()&&d.FileReader)||!this.files||0===this.files.length)return!0;for(var u=0;u<this.files.length;u++)h.push({file:this.files[u],inputElem:this,instanceConfig:k.extend({},r)})}),m(),this;function m(){if(0!==h.length){var p,u,o,E,G=h[0];if(K(q.before)){var X=q.before(G.file,G.inputElem);if("object"==typeof X){if("abort"===X.action)return p="AbortError",u=G.file,o=G.inputElem,E=X.reason,void(K(q.error)&&q.error({name:p},u,o,E));if("skip"===X.action)return void l();"object"==typeof X.config&&(G.instanceConfig=k.extend(G.instanceConfig,X.config))}else if("skip"===X)return void l()}var A=G.instanceConfig.complete;G.instanceConfig.complete=function(Y){K(A)&&A(Y,G.file,G.inputElem),l()},i.parse(G.file,G.instanceConfig)}else K(q.complete)&&q.complete()}function l(){h.splice(0,1),m()}}}function n(q){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(r){var h=V(r);h.chunkSize=parseInt(h.chunkSize),r.step||r.chunk||(h.chunkSize=null),this._handle=new F(h),(this._handle.streamer=this)._config=h}.call(this,q),this.parseChunk=function(r,h){if(this.isFirstChunk&&K(this._config.beforeFirstChunk)){var m=this._config.beforeFirstChunk(r);void 0!==m&&(r=m)}this.isFirstChunk=!1,this._halted=!1;var l=this._partialLine+r;this._partialLine="";var p=this._handle.parse(l,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var u=p.meta.cursor;this._finished||(this._partialLine=l.substring(u-this._baseIndex),this._baseIndex=u),p&&p.data&&(this._rowCount+=p.data.length);var o=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(f)d.postMessage({results:p,workerId:i.WORKER_ID,finished:o});else if(K(this._config.chunk)&&!h){if(this._config.chunk(p,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);p=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(p.data),this._completeResults.errors=this._completeResults.errors.concat(p.errors),this._completeResults.meta=p.meta),this._completed||!o||!K(this._config.complete)||p&&p.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),o||p&&p.meta.paused||this._nextChunk(),p}this._halted=!0},this._sendError=function(r){K(this._config.error)?this._config.error(r):f&&this._config.error&&d.postMessage({workerId:i.WORKER_ID,error:r,finished:!1})}}function t(q){var r;(q=q||{}).chunkSize||(q.chunkSize=i.RemoteChunkSize),n.call(this,q),this._nextChunk=e?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(h){this._input=h,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(r=new XMLHttpRequest(),this._config.withCredentials&&(r.withCredentials=this._config.withCredentials),e||(r.onload=W(this._chunkLoaded,this),r.onerror=W(this._chunkError,this)),r.open(this._config.downloadRequestBody?"POST":"GET",this._input,!e),this._config.downloadRequestHeaders){var h=this._config.downloadRequestHeaders;for(var m in h)r.setRequestHeader(m,h[m])}if(this._config.chunkSize){var l=this._start+this._config.chunkSize-1;r.setRequestHeader("Range","bytes="+this._start+"-"+l)}try{r.send(this._config.downloadRequestBody)}catch(p){this._chunkError(p.message)}e&&0===r.status&&this._chunkError()}},this._chunkLoaded=function(){4===r.readyState&&(r.status<200||400<=r.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:r.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(h){var m=h.getResponseHeader("Content-Range");return null===m?-1:parseInt(m.substring(m.lastIndexOf("/")+1))}(r),this.parseChunk(r.responseText)))},this._chunkError=function(h){var m=r.statusText||h;this._sendError(new Error(m))}}function v(q){var r,h;(q=q||{}).chunkSize||(q.chunkSize=i.LocalChunkSize),n.call(this,q);var m="undefined"!=typeof FileReader;this.stream=function(l){this._input=l,h=l.slice||l.webkitSlice||l.mozSlice,m?((r=new FileReader()).onload=W(this._chunkLoaded,this),r.onerror=W(this._chunkError,this)):r=new FileReaderSync(),this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var l=this._input;if(this._config.chunkSize){var p=Math.min(this._start+this._config.chunkSize,this._input.size);l=h.call(l,this._start,p)}var u=r.readAsText(l,this._config.encoding);m||this._chunkLoaded({target:{result:u}})},this._chunkLoaded=function(l){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(l.target.result)},this._chunkError=function(){this._sendError(r.error)}}function x(q){var r;n.call(this,q=q||{}),this.stream=function(h){return r=h,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var h,m=this._config.chunkSize;return m?(h=r.substring(0,m),r=r.substring(m)):(h=r,r=""),this._finished=!r,this.parseChunk(h)}}}function C(q){n.call(this,q=q||{});var r=[],h=!0,m=!1;this.pause=function(){n.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){n.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(l){this._input=l,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){m&&1===r.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),r.length?this.parseChunk(r.shift()):h=!0},this._streamData=W(function(l){try{r.push("string"==typeof l?l:l.toString(this._config.encoding)),h&&(h=!1,this._checkIsFinished(),this.parseChunk(r.shift()))}catch(p){this._streamError(p)}},this),this._streamError=W(function(l){this._streamCleanUp(),this._sendError(l)},this),this._streamEnd=W(function(){this._streamCleanUp(),m=!0,this._streamData("")},this),this._streamCleanUp=W(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function F(q){var r,h,m,l=Math.pow(2,53),p=-l,u=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)(e[-+]?\d+)?\s*$/,o=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,E=this,G=0,X=0,A=!1,Y=!1,M=[],B={data:[],errors:[],meta:{}};if(K(q.step)){var J=q.step;q.step=function(T){if(B=T,na())ia();else{if(ia(),0===B.data.length)return;G+=T.data.length,q.preview&&G>q.preview?h.abort():(B.data=B.data[0],J(B,E))}}}function Z(T){return"greedy"===q.skipEmptyLines?""===T.join("").trim():1===T.length&&0===T[0].length}function ia(){if(B&&m&&(ma("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+i.DefaultDelimiter+"'"),m=!1),q.skipEmptyLines)for(var T=0;T<B.data.length;T++)Z(B.data[T])&&B.data.splice(T--,1);return na()&&function(){if(!B)return;function ea(ka){K(q.transformHeader)&&(ka=q.transformHeader(ka)),M.push(ka)}if(Array.isArray(B.data[0])){for(var ja=0;na()&&ja<B.data.length;ja++)B.data[ja].forEach(ea);B.data.splice(0,1)}else B.data.forEach(ea)}(),function(){if(!B||!q.header&&!q.dynamicTyping&&!q.transform)return B;function ea(ka,P){var S,ga=q.header?{}:[];for(S=0;S<ka.length;S++){var N=S,fa=ka[S];q.header&&(N=S>=M.length?"__parsed_extra":M[S]),q.transform&&(fa=q.transform(fa,N)),fa=pa(N,fa),"__parsed_extra"===N?(ga[N]=ga[N]||[],ga[N].push(fa)):ga[N]=fa}return q.header&&(S>M.length?ma("FieldMismatch","TooManyFields","Too many fields: expected "+M.length+" fields but parsed "+S,X+P):S<M.length&&ma("FieldMismatch","TooFewFields","Too few fields: expected "+M.length+" fields but parsed "+S,X+P)),ga}var ja=1;return!B.data.length||Array.isArray(B.data[0])?(B.data=B.data.map(ea),ja=B.data.length):B.data=ea(B.data,0),q.header&&B.meta&&(B.meta.fields=M),X+=ja,B}()}function na(){return q.header&&0===M.length}function pa(T,ea){return ja=T,q.dynamicTypingFunction&&void 0===q.dynamicTyping[ja]&&(q.dynamicTyping[ja]=q.dynamicTypingFunction(ja)),!0===(q.dynamicTyping[ja]||q.dynamicTyping)?"true"===ea||"TRUE"===ea||"false"!==ea&&"FALSE"!==ea&&(function(ka){if(u.test(ka)){var P=parseFloat(ka);if(p<P&&P<l)return!0}return!1}(ea)?parseFloat(ea):o.test(ea)?new Date(ea):""===ea?null:ea):ea;var ja}function ma(T,ea,ja,ka){var P={type:T,code:ea,message:ja};void 0!==ka&&(P.row=ka),B.errors.push(P)}this.parse=function(T,ea,ja){var ka=q.quoteChar||'"';if(q.newline||(q.newline=function(ga,N){ga=ga.substring(0,1048576);var fa=new RegExp(H(N)+"([^]*?)"+H(N),"gm"),O=(ga=ga.replace(fa,"")).split("\r"),va=ga.split(`
`),w=1<va.length&&va[0].length<O[0].length;if(1===O.length||w)return`
`;for(var s=0,z=0;z<O.length;z++)`
`===O[z][0]&&s++;return s>=O.length/2?`\r
`:"\r"}(T,ka)),m=!1,q.delimiter)K(q.delimiter)&&(q.delimiter=q.delimiter(T),B.meta.delimiter=q.delimiter);else{var P=function(ga,N,fa,O,va){var w,s,z,D;va=va||[",","	","|",";",i.RECORD_SEP,i.UNIT_SEP];for(var y=0;y<va.length;y++){var U=va[y],$=0,_=0,ha=0;z=void 0;for(var da=new Q({comments:O,delimiter:U,newline:N,preview:10}).parse(ga),sa=0;sa<da.data.length;sa++)if(fa&&Z(da.data[sa]))ha++;else{var la=da.data[sa].length;_+=la,void 0!==z?0<la&&($+=Math.abs(la-z),z=la):z=la}0<da.data.length&&(_/=da.data.length-ha),(void 0===s||$<=s)&&(void 0===D||D<_)&&1.99<_&&(s=$,w=U,D=_)}return{successful:!!(q.delimiter=w),bestDelimiter:w}}(T,q.newline,q.skipEmptyLines,q.comments,q.delimitersToGuess);P.successful?q.delimiter=P.bestDelimiter:(m=!0,q.delimiter=i.DefaultDelimiter),B.meta.delimiter=q.delimiter}var S=V(q);return q.preview&&q.header&&S.preview++,r=T,h=new Q(S),B=h.parse(r,ea,ja),ia(),A?{meta:{paused:!0}}:B||{meta:{paused:!1}}},this.paused=function(){return A},this.pause=function(){A=!0,h.abort(),r=K(q.chunk)?"":r.substring(h.getCharIndex())},this.resume=function(){E.streamer._halted?(A=!1,E.streamer.parseChunk(r,!0)):setTimeout(E.resume,3)},this.aborted=function(){return Y},this.abort=function(){Y=!0,h.abort(),B.meta.aborted=!0,K(q.complete)&&q.complete(B),r=""}}function H(q){return q.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Q(q){var r,h=(q=q||{}).delimiter,m=q.newline,l=q.comments,p=q.step,u=q.preview,o=q.fastMode,E=r=void 0===q.quoteChar?'"':q.quoteChar;if(void 0!==q.escapeChar&&(E=q.escapeChar),("string"!=typeof h||-1<i.BAD_DELIMITERS.indexOf(h))&&(h=","),l===h)throw new Error("Comment character same as delimiter");!0===l?l="#":("string"!=typeof l||-1<i.BAD_DELIMITERS.indexOf(l))&&(l=!1),`
`!==m&&"\r"!==m&&`\r
`!==m&&(m=`
`);var G=0,X=!1;this.parse=function(A,Y,M){if("string"!=typeof A)throw new Error("Input must be a string");var B=A.length,J=h.length,Z=m.length,ia=l.length,na=K(p),pa=[],ma=[],T=[],ea=G=0;if(!A)return y();if(o||!1!==o&&-1===A.indexOf(r)){for(var ja=A.split(m),ka=0;ka<ja.length;ka++){if(T=ja[ka],G+=T.length,ka!==ja.length-1)G+=m.length;else if(M)return y();if(!l||T.substring(0,ia)!==l){if(na){if(pa=[],w(T.split(h)),U(),X)return y()}else w(T.split(h));if(u&&u<=ka)return pa=pa.slice(0,u),y(!0)}}return y()}for(var P=A.indexOf(h,G),S=A.indexOf(m,G),ga=new RegExp(H(E)+H(r),"g"),N=A.indexOf(r,G);;)if(A[G]!==r)if(l&&0===T.length&&A.substring(G,G+ia)===l){if(-1===S)return y();G=S+Z,S=A.indexOf(m,G),P=A.indexOf(h,G)}else{if(-1!==P&&(P<S||-1===S)){if(!(P<N)){T.push(A.substring(G,P)),G=P+J,P=A.indexOf(h,G);continue}var fa=$(P,N,S);if(fa&&void 0!==fa.nextDelim){P=fa.nextDelim,N=fa.quoteSearch,T.push(A.substring(G,P)),G=P+J,P=A.indexOf(h,G);continue}}if(-1===S)break;if(T.push(A.substring(G,S)),D(S+Z),na&&(U(),X))return y();if(u&&pa.length>=u)return y(!0)}else for(N=G,G++;;){if(-1===(N=A.indexOf(r,N+1)))return M||ma.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:pa.length,index:G}),z();if(N===B-1)return z(A.substring(G,N).replace(ga,r));if(r!==E||A[N+1]!==E){if(r===E||0===N||A[N-1]!==E){-1!==P&&P<N+1&&(P=A.indexOf(h,N+1)),-1!==S&&S<N+1&&(S=A.indexOf(m,N+1));var O=s(-1===S?P:Math.min(P,S));if(A[N+1+O]===h){T.push(A.substring(G,N).replace(ga,r)),A[G=N+1+O+J]!==r&&(N=A.indexOf(r,G)),P=A.indexOf(h,G),S=A.indexOf(m,G);break}var va=s(S);if(A.substring(N+1+va,N+1+va+Z)===m){if(T.push(A.substring(G,N).replace(ga,r)),D(N+1+va+Z),P=A.indexOf(h,G),N=A.indexOf(r,G),na&&(U(),X))return y();if(u&&pa.length>=u)return y(!0);break}ma.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:pa.length,index:G}),N++}}else N++}return z();function w(_){pa.push(_),ea=G}function s(_){var ha=0;if(-1!==_){var da=A.substring(N+1,_);da&&""===da.trim()&&(ha=da.length)}return ha}function z(_){return M||(void 0===_&&(_=A.substring(G)),T.push(_),G=B,w(T),na&&U()),y()}function D(_){G=_,w(T),T=[],S=A.indexOf(m,G)}function y(_){return{data:pa,errors:ma,meta:{delimiter:h,linebreak:m,aborted:X,truncated:!!_,cursor:ea+(Y||0)}}}function U(){p(y()),pa=[],ma=[]}function $(_,ha,da){var sa={nextDelim:void 0,quoteSearch:void 0},la=A.indexOf(r,ha+1);if(ha<_&&_<la&&(la<da||-1===da)){var za=A.indexOf(h,la);if(-1===za)return sa;la<za&&(la=A.indexOf(r,la+1)),sa=$(za,la,da)}else sa={nextDelim:_,quoteSearch:ha};return sa}},this.abort=function(){X=!0},this.getCharIndex=function(){return G}}function L(q){var r=q.data,h=g[r.workerId],m=!1;if(r.error)h.userError(r.error,r.file);else if(r.results&&r.results.data){var l={abort:function(){m=!0,R(r.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:I,resume:I};if(K(h.userStep)){for(var p=0;p<r.results.data.length&&(h.userStep({data:r.results.data[p],errors:r.results.errors,meta:r.results.meta},l),!m);p++);delete r.results}else K(h.userChunk)&&(h.userChunk(r.results,l,r.file),delete r.results)}r.finished&&!m&&R(r.workerId,r.results)}function R(q,r){var h=g[q];K(h.userComplete)&&h.userComplete(r),h.terminate(),delete g[q]}function I(){throw new Error("Not implemented.")}function V(q){if("object"!=typeof q||null===q)return q;var r=Array.isArray(q)?[]:{};for(var h in q)r[h]=V(q[h]);return r}function W(q,r){return function(){q.apply(r,arguments)}}function K(q){return"function"==typeof q}return f&&(d.onmessage=function(q){var r=q.data;void 0===i.WORKER_ID&&r&&(i.WORKER_ID=r.workerId);if("string"==typeof r.input)d.postMessage({workerId:i.WORKER_ID,results:i.parse(r.input,r.config),finished:!0});else if(d.File&&r.input instanceof File||r.input instanceof Object){var h=i.parse(r.input,r.config);h&&d.postMessage({workerId:i.WORKER_ID,results:h,finished:!0})}}),(t.prototype=Object.create(n.prototype)).constructor=t,(v.prototype=Object.create(n.prototype)).constructor=v,(x.prototype=Object.create(x.prototype)).constructor=x,(C.prototype=Object.create(n.prototype)).constructor=C,i})});var ji=jb(q=>{$b(q,{__assign:()=>c,__asyncDelegator:()=>Q,__asyncGenerator:()=>H,__asyncValues:()=>L,__await:()=>F,__awaiter:()=>j,__classPrivateFieldGet:()=>W,__classPrivateFieldSet:()=>K,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>V,__importStar:()=>I,__makeTemplateObject:()=>R,__metadata:()=>g,__param:()=>f,__read:()=>v,__rest:()=>d,__spread:()=>x,__spreadArrays:()=>C,__values:()=>t});var a=function(h,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,p){l.__proto__=p}||function(l,p){for(var u in p)p.hasOwnProperty(u)&&(l[u]=p[u])},a(h,m)};function b(h,m){a(h,m);function l(){this.constructor=h}h.prototype=m===null?Object.create(m):(l.prototype=m.prototype,new l())}var c=function(){return c=Object.assign||function h(m){for(var l,p=1,u=arguments.length;p<u;p++){l=arguments[p];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(m[o]=l[o])}return m},c.apply(this,arguments)};function d(h,m){var l={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&m.indexOf(p)<0&&(l[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var u=0,p=Object.getOwnPropertySymbols(h);u<p.length;u++)m.indexOf(p[u])<0&&Object.prototype.propertyIsEnumerable.call(h,p[u])&&(l[p[u]]=h[p[u]]);return l}function e(h,m,l,p){var u=arguments.length,o=u<3?m:p===null?p=Object.getOwnPropertyDescriptor(m,l):p,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(h,m,l,p);else for(var G=h.length-1;G>=0;G--)(E=h[G])&&(o=(u<3?E(o):u>3?E(m,l,o):E(m,l))||o);return u>3&&o&&Object.defineProperty(m,l,o),o}function f(h,m){return function(l,p){m(l,p,h)}}function g(h,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,m)}function j(h,m,l,p){function u(o){return o instanceof l?o:new l(function(E){E(o)})}return new(l||(l=Promise))(function(o,E){function G(Y){try{A(p.next(Y))}catch(M){E(M)}}function X(Y){try{A(p.throw(Y))}catch(M){E(M)}}function A(Y){Y.done?o(Y.value):u(Y.value).then(G,X)}A((p=p.apply(h,m||[])).next())})}function i(h,m){var l={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},p,u,o,E;return E={next:G(0),throw:G(1),return:G(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function G(A){return function(Y){return X([A,Y])}}function X(A){if(p)throw new TypeError("Generator is already executing.");for(;l;)try{if(p=1,u&&(o=A[0]&2?u.return:A[0]?u.throw||((o=u.return)&&o.call(u),0):u.next)&&!(o=o.call(u,A[1])).done)return o;(u=0,o)&&(A=[A[0]&2,o.value]);switch(A[0]){case 0:case 1:o=A;break;case 4:return l.label++,{value:A[1],done:!1};case 5:l.label++,u=A[1],A=[0];continue;case 7:A=l.ops.pop(),l.trys.pop();continue;default:if(!(o=l.trys,o=o.length>0&&o[o.length-1])&&(A[0]===6||A[0]===2)){l=0;continue}if(A[0]===3&&(!o||A[1]>o[0]&&A[1]<o[3])){l.label=A[1];break}if(A[0]===6&&l.label<o[1]){l.label=o[1],o=A;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(A);break}o[2]&&l.ops.pop(),l.trys.pop();continue}A=m.call(h,l)}catch(Y){A=[6,Y],u=0}finally{p=o=0}if(A[0]&5)throw A[1];return{value:A[0]?A[1]:void 0,done:!0}}}function k(h,m,l,p){p===void 0&&(p=l),h[p]=m[l]}function n(h,m){for(var l in h)l!=="default"&&!m.hasOwnProperty(l)&&(m[l]=h[l])}function t(h){var m=typeof Symbol==="function"&&Symbol.iterator,l=m&&h[m],p=0;if(l)return l.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function v(h,m){var l=typeof Symbol==="function"&&h[Symbol.iterator];if(!l)return h;var p=l.call(h),u,o=[],E;try{for(;(m===void 0||m-- >0)&&!(u=p.next()).done;)o.push(u.value)}catch(G){E={error:G}}finally{try{u&&!u.done&&(l=p.return)&&l.call(p)}finally{if(E)throw E.error}}return o}function x(){for(var h=[],m=0;m<arguments.length;m++)h=h.concat(v(arguments[m]));return h}function C(){for(var h=0,m=0,l=arguments.length;m<l;m++)h+=arguments[m].length;for(var p=Array(h),u=0,m=0;m<l;m++)for(var o=arguments[m],E=0,G=o.length;E<G;E++,u++)p[u]=o[E];return p}function F(h){return this instanceof F?(this.v=h,this):new F(h)}function H(h,m,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=l.apply(h,m||[]),u,o=[];return u={},E("next"),E("throw"),E("return"),u[Symbol.asyncIterator]=function(){return this},u;function E(B){p[B]&&(u[B]=function(J){return new Promise(function(Z,ia){o.push([B,J,Z,ia])>1||G(B,J)})})}function G(B,J){try{X(p[B](J))}catch(Z){M(o[0][3],Z)}}function X(B){B.value instanceof F?Promise.resolve(B.value.v).then(A,Y):M(o[0][2],B)}function A(B){G("next",B)}function Y(B){G("throw",B)}function M(B,J){(B(J),o.shift(),o.length)&&G(o[0][0],o[0][1])}}function Q(h){var m,l;return m={},p("next"),p("throw",function(u){throw u}),p("return"),m[Symbol.iterator]=function(){return this},m;function p(u,o){m[u]=h[u]?function(E){return(l=!l)?{value:F(h[u](E)),done:u==="return"}:o?o(E):E}:o}}function L(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=h[Symbol.asyncIterator],l;return m?m.call(h):(h=typeof t==="function"?t(h):h[Symbol.iterator](),l={},p("next"),p("throw"),p("return"),l[Symbol.asyncIterator]=function(){return this},l);function p(o){l[o]=h[o]&&function(E){return new Promise(function(G,X){E=h[o](E),u(G,X,E.done,E.value)})}}function u(o,E,G,X){Promise.resolve(X).then(function(A){o({value:A,done:G})},E)}}function R(h,m){return Object.defineProperty?Object.defineProperty(h,"raw",{value:m}):h.raw=m,h}function I(h){if(h&&h.__esModule)return h;var m={};if(h!=null)for(var l in h)Object.hasOwnProperty.call(h,l)&&(m[l]=h[l]);return m.default=h,m}function V(h){return h&&h.__esModule?h:{default:h}}function W(h,m){if(!m.has(h))throw new TypeError("attempted to get private field on non-instance");return m.get(h)}function K(h,m,l){if(!m.has(h))throw new TypeError("attempted to set private field on non-instance");return m.set(h,l),l}});var ni=jb(q=>{$b(q,{__assign:()=>c,__asyncDelegator:()=>Q,__asyncGenerator:()=>H,__asyncValues:()=>L,__await:()=>F,__awaiter:()=>j,__classPrivateFieldGet:()=>W,__classPrivateFieldSet:()=>K,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>V,__importStar:()=>I,__makeTemplateObject:()=>R,__metadata:()=>g,__param:()=>f,__read:()=>v,__rest:()=>d,__spread:()=>x,__spreadArrays:()=>C,__values:()=>t});var a=function(h,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,p){l.__proto__=p}||function(l,p){for(var u in p)p.hasOwnProperty(u)&&(l[u]=p[u])},a(h,m)};function b(h,m){a(h,m);function l(){this.constructor=h}h.prototype=m===null?Object.create(m):(l.prototype=m.prototype,new l())}var c=function(){return c=Object.assign||function h(m){for(var l,p=1,u=arguments.length;p<u;p++){l=arguments[p];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(m[o]=l[o])}return m},c.apply(this,arguments)};function d(h,m){var l={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&m.indexOf(p)<0&&(l[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var u=0,p=Object.getOwnPropertySymbols(h);u<p.length;u++)m.indexOf(p[u])<0&&Object.prototype.propertyIsEnumerable.call(h,p[u])&&(l[p[u]]=h[p[u]]);return l}function e(h,m,l,p){var u=arguments.length,o=u<3?m:p===null?p=Object.getOwnPropertyDescriptor(m,l):p,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(h,m,l,p);else for(var G=h.length-1;G>=0;G--)(E=h[G])&&(o=(u<3?E(o):u>3?E(m,l,o):E(m,l))||o);return u>3&&o&&Object.defineProperty(m,l,o),o}function f(h,m){return function(l,p){m(l,p,h)}}function g(h,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,m)}function j(h,m,l,p){function u(o){return o instanceof l?o:new l(function(E){E(o)})}return new(l||(l=Promise))(function(o,E){function G(Y){try{A(p.next(Y))}catch(M){E(M)}}function X(Y){try{A(p.throw(Y))}catch(M){E(M)}}function A(Y){Y.done?o(Y.value):u(Y.value).then(G,X)}A((p=p.apply(h,m||[])).next())})}function i(h,m){var l={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},p,u,o,E;return E={next:G(0),throw:G(1),return:G(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function G(A){return function(Y){return X([A,Y])}}function X(A){if(p)throw new TypeError("Generator is already executing.");for(;l;)try{if(p=1,u&&(o=A[0]&2?u.return:A[0]?u.throw||((o=u.return)&&o.call(u),0):u.next)&&!(o=o.call(u,A[1])).done)return o;(u=0,o)&&(A=[A[0]&2,o.value]);switch(A[0]){case 0:case 1:o=A;break;case 4:return l.label++,{value:A[1],done:!1};case 5:l.label++,u=A[1],A=[0];continue;case 7:A=l.ops.pop(),l.trys.pop();continue;default:if(!(o=l.trys,o=o.length>0&&o[o.length-1])&&(A[0]===6||A[0]===2)){l=0;continue}if(A[0]===3&&(!o||A[1]>o[0]&&A[1]<o[3])){l.label=A[1];break}if(A[0]===6&&l.label<o[1]){l.label=o[1],o=A;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(A);break}o[2]&&l.ops.pop(),l.trys.pop();continue}A=m.call(h,l)}catch(Y){A=[6,Y],u=0}finally{p=o=0}if(A[0]&5)throw A[1];return{value:A[0]?A[1]:void 0,done:!0}}}function k(h,m,l,p){p===void 0&&(p=l),h[p]=m[l]}function n(h,m){for(var l in h)l!=="default"&&!m.hasOwnProperty(l)&&(m[l]=h[l])}function t(h){var m=typeof Symbol==="function"&&Symbol.iterator,l=m&&h[m],p=0;if(l)return l.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function v(h,m){var l=typeof Symbol==="function"&&h[Symbol.iterator];if(!l)return h;var p=l.call(h),u,o=[],E;try{for(;(m===void 0||m-- >0)&&!(u=p.next()).done;)o.push(u.value)}catch(G){E={error:G}}finally{try{u&&!u.done&&(l=p.return)&&l.call(p)}finally{if(E)throw E.error}}return o}function x(){for(var h=[],m=0;m<arguments.length;m++)h=h.concat(v(arguments[m]));return h}function C(){for(var h=0,m=0,l=arguments.length;m<l;m++)h+=arguments[m].length;for(var p=Array(h),u=0,m=0;m<l;m++)for(var o=arguments[m],E=0,G=o.length;E<G;E++,u++)p[u]=o[E];return p}function F(h){return this instanceof F?(this.v=h,this):new F(h)}function H(h,m,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=l.apply(h,m||[]),u,o=[];return u={},E("next"),E("throw"),E("return"),u[Symbol.asyncIterator]=function(){return this},u;function E(B){p[B]&&(u[B]=function(J){return new Promise(function(Z,ia){o.push([B,J,Z,ia])>1||G(B,J)})})}function G(B,J){try{X(p[B](J))}catch(Z){M(o[0][3],Z)}}function X(B){B.value instanceof F?Promise.resolve(B.value.v).then(A,Y):M(o[0][2],B)}function A(B){G("next",B)}function Y(B){G("throw",B)}function M(B,J){(B(J),o.shift(),o.length)&&G(o[0][0],o[0][1])}}function Q(h){var m,l;return m={},p("next"),p("throw",function(u){throw u}),p("return"),m[Symbol.iterator]=function(){return this},m;function p(u,o){m[u]=h[u]?function(E){return(l=!l)?{value:F(h[u](E)),done:u==="return"}:o?o(E):E}:o}}function L(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=h[Symbol.asyncIterator],l;return m?m.call(h):(h=typeof t==="function"?t(h):h[Symbol.iterator](),l={},p("next"),p("throw"),p("return"),l[Symbol.asyncIterator]=function(){return this},l);function p(o){l[o]=h[o]&&function(E){return new Promise(function(G,X){E=h[o](E),u(G,X,E.done,E.value)})}}function u(o,E,G,X){Promise.resolve(X).then(function(A){o({value:A,done:G})},E)}}function R(h,m){return Object.defineProperty?Object.defineProperty(h,"raw",{value:m}):h.raw=m,h}function I(h){if(h&&h.__esModule)return h;var m={};if(h!=null)for(var l in h)Object.hasOwnProperty.call(h,l)&&(m[l]=h[l]);return m.default=h,m}function V(h){return h&&h.__esModule?h:{default:h}}function W(h,m){if(!m.has(h))throw new TypeError("attempted to get private field on non-instance");return m.get(h)}function K(h,m,l){if(!m.has(h))throw new TypeError("attempted to set private field on non-instance");return m.set(h,l),l}});var $e=jb(O=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});var a=ni();var b={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};var c=function(w,s){if(!w)throw d(s)},d=function(w){return new Error("Firebase Database ("+b.SDK_VERSION+") INTERNAL ASSERT FAILED: "+w)};var e=function(w){for(var s=[],z=0,D=0;D<w.length;D++){var y=w.charCodeAt(D);y<128?s[z++]=y:y<2048?(s[z++]=y>>6|192,s[z++]=y&63|128):(y&64512)===55296&&D+1<w.length&&(w.charCodeAt(D+1)&64512)===56320?(y=65536+((y&1023)<<10)+(w.charCodeAt(++D)&1023),s[z++]=y>>18|240,s[z++]=y>>12&63|128,s[z++]=y>>6&63|128,s[z++]=y&63|128):(s[z++]=y>>12|224,s[z++]=y>>6&63|128,s[z++]=y&63|128)}return s},f=function(w){for(var s=[],z=0,D=0;z<w.length;){var y=w[z++];if(y<128)s[D++]=String.fromCharCode(y);else if(y>191&&y<224){var U=w[z++];s[D++]=String.fromCharCode((y&31)<<6|U&63)}else if(y>239&&y<365){var U=w[z++],$=w[z++],_=w[z++],ha=((y&7)<<18|(U&63)<<12|($&63)<<6|_&63)-65536;s[D++]=String.fromCharCode(55296+(ha>>10)),s[D++]=String.fromCharCode(56320+(ha&1023))}else{var U=w[z++],$=w[z++];s[D++]=String.fromCharCode((y&15)<<12|(U&63)<<6|$&63)}}return s.join("")},g={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob==="function",encodeByteArray:function(w,s){if(!Array.isArray(w))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var z=s?this.byteToCharMapWebSafe_:this.byteToCharMap_,D=[],y=0;y<w.length;y+=3){var U=w[y],$=y+1<w.length,_=$?w[y+1]:0,ha=y+2<w.length,da=ha?w[y+2]:0,sa=U>>2,la=(U&3)<<4|_>>4,za=(_&15)<<2|da>>6,Ue=da&63;ha||(Ue=64,$||(za=64)),D.push(z[sa],z[la],z[za],z[Ue])}return D.join("")},encodeString:function(w,s){return this.HAS_NATIVE_SUPPORT&&!s?btoa(w):this.encodeByteArray(e(w),s)},decodeString:function(w,s){return this.HAS_NATIVE_SUPPORT&&!s?atob(w):f(this.decodeStringToByteArray(w,s))},decodeStringToByteArray:function(w,s){this.init_();for(var z=s?this.charToByteMapWebSafe_:this.charToByteMap_,D=[],y=0;y<w.length;){var U=z[w.charAt(y++)],$=y<w.length,_=$?z[w.charAt(y)]:0;++y;var ha=y<w.length,da=ha?z[w.charAt(y)]:64;++y;var sa=y<w.length,la=sa?z[w.charAt(y)]:64;++y;if(U==null||_==null||da==null||la==null)throw Error();var za=U<<2|_>>4;D.push(za);if(da!==64){var Ue=_<<4&240|da>>2;D.push(Ue);if(la!==64){var kq=da<<6&192|la;D.push(kq)}}}return D},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var w=0;w<this.ENCODED_VALS.length;w++)this.byteToCharMap_[w]=this.ENCODED_VALS.charAt(w),this.charToByteMap_[this.byteToCharMap_[w]]=w,this.byteToCharMapWebSafe_[w]=this.ENCODED_VALS_WEBSAFE.charAt(w),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[w]]=w,w>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(w)]=w,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(w)]=w)}}},j=function(w){var s=e(w);return g.encodeByteArray(s,!0)},i=function(w){try{return g.decodeString(w,!0)}catch(s){console.error("base64Decode failed: ",s)}return null};function k(w){return n(void 0,w)}function n(w,s){if(!(s instanceof Object))return s;switch(s.constructor){case Date:var z=s;return new Date(z.getTime());case Object:w===void 0&&(w={});break;case Array:w=[];break;default:return s}for(var D in s){if(!s.hasOwnProperty(D))continue;w[D]=n(w[D],s[D])}return w}var t=function(){function w(){var s=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(z,D){s.resolve=z,s.reject=D})}return w.prototype.wrapCallback=function(s){var z=this;return function(D,y){D?z.reject(D):z.resolve(y),typeof s==="function"&&(z.promise.catch(function(){}),s.length===1?s(D):s(D,y))}},w}();function v(){return typeof navigator!=="undefined"&&typeof navigator.userAgent==="string"?navigator.userAgent:""}function x(){return typeof window!=="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(v())}function C(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(w){return!1}}function F(){return typeof self==="object"&&self.self===self}function H(){var w=typeof chrome==="object"?chrome.runtime:typeof browser==="object"?browser.runtime:void 0;return typeof w==="object"&&w.id!==void 0}function Q(){return typeof navigator==="object"&&navigator.product==="ReactNative"}function L(){return v().indexOf("Electron/")>=0}function R(){var w=v();return w.indexOf("MSIE ")>=0||w.indexOf("Trident/")>=0}function I(){return v().indexOf("MSAppHost/")>=0}function V(){return b.NODE_CLIENT===!0||b.NODE_ADMIN===!0}function W(){return!C()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}var K="FirebaseError",q=function(w){a.__extends(s,w);function s(z,D){var y=w.call(this,D)||this;return y.code=z,y.name=K,Object.setPrototypeOf(y,s.prototype),Error.captureStackTrace&&Error.captureStackTrace(y,r.prototype.create),y}return s}(Error),r=function(){function w(s,z,D){this.service=s,this.serviceName=z,this.errors=D}return w.prototype.create=function(s){for(var z=[],D=1;D<arguments.length;D++)z[D-1]=arguments[D];for(var y=z[0]||{},U=this.service+"/"+s,$=this.errors[s],_=$?h($,y):"Error",ha=this.serviceName+": "+_+" ("+U+").",da=new q(U,ha),sa=0,la=Object.keys(y);sa<la.length;sa++){var za=la[sa];za.slice(-1)!=="_"&&(za in da&&console.warn('Overwriting FirebaseError base field "'+za+'" can cause unexpected behavior.'),da[za]=y[za])}return da},w}();function h(w,s){return w.replace(m,function(z,D){var y=s[D];return y!=null?String(y):"<"+D+"?>"})}var m=/\{\$([^}]+)}/g;function l(w){return JSON.parse(w)}function p(w){return JSON.stringify(w)}var u=function(w){var s={},z={},D={},y="";try{var U=w.split(".");s=l(i(U[0])||""),z=l(i(U[1])||""),y=U[2],D=z.d||{},delete z.d}catch($){}return{header:s,claims:z,data:D,signature:y}},o=function(w){var s=u(w).claims,z=Math.floor(new Date().getTime()/1e3),D=0,y=0;return typeof s==="object"&&(s.hasOwnProperty("nbf")?D=s.nbf:s.hasOwnProperty("iat")&&(D=s.iat),s.hasOwnProperty("exp")?y=s.exp:y=D+86400),!!z&&!!D&&!!y&&z>=D&&z<=y},E=function(w){var s=u(w).claims;return typeof s==="object"&&s.hasOwnProperty("iat")?s.iat:null},G=function(w){var s=u(w),z=s.claims;return!!z&&typeof z==="object"&&z.hasOwnProperty("iat")},X=function(w){var s=u(w).claims;return typeof s==="object"&&s.admin===!0};function A(w,s){return Object.prototype.hasOwnProperty.call(w,s)}function Y(w,s){return Object.prototype.hasOwnProperty.call(w,s)?w[s]:void 0}function M(w){for(var s in w)if(Object.prototype.hasOwnProperty.call(w,s))return!1;return!0}function B(w,s,z){var D={};for(var y in w)Object.prototype.hasOwnProperty.call(w,y)&&(D[y]=s.call(z,w[y],y,w));return D}function J(w){for(var s=[],z=function(ha,da){Array.isArray(da)?da.forEach(function(sa){s.push(encodeURIComponent(ha)+"="+encodeURIComponent(sa))}):s.push(encodeURIComponent(ha)+"="+encodeURIComponent(da))},D=0,y=Object.entries(w);D<y.length;D++){var U=y[D],$=U[0],_=U[1];z($,_)}return s.length?"&"+s.join("&"):""}function Z(w){var s={},z=w.replace(/^\?/,"").split("&");return z.forEach(function(D){if(D){var y=D.split("=");s[y[0]]=y[1]}}),s}var ia=function(){function w(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(var s=1;s<this.blockSize;++s)this.pad_[s]=0;this.reset()}return w.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},w.prototype.compress_=function(s,z){z||(z=0);var D=this.W_;if(typeof s==="string")for(var y=0;y<16;y++)D[y]=s.charCodeAt(z)<<24|s.charCodeAt(z+1)<<16|s.charCodeAt(z+2)<<8|s.charCodeAt(z+3),z+=4;else for(var y=0;y<16;y++)D[y]=s[z]<<24|s[z+1]<<16|s[z+2]<<8|s[z+3],z+=4;for(var y=16;y<80;y++){var U=D[y-3]^D[y-8]^D[y-14]^D[y-16];D[y]=(U<<1|U>>>31)&4294967295}for(var $=this.chain_[0],_=this.chain_[1],ha=this.chain_[2],da=this.chain_[3],sa=this.chain_[4],la,za,y=0;y<80;y++){y<40?y<20?(la=da^_&(ha^da),za=1518500249):(la=_^ha^da,za=1859775393):y<60?(la=_&ha|da&(_|ha),za=2400959708):(la=_^ha^da,za=3395469782);var U=($<<5|$>>>27)+la+sa+za+D[y]&4294967295;sa=da,da=ha,ha=(_<<30|_>>>2)&4294967295,_=$,$=U}this.chain_[0]=this.chain_[0]+$&4294967295,this.chain_[1]=this.chain_[1]+_&4294967295,this.chain_[2]=this.chain_[2]+ha&4294967295,this.chain_[3]=this.chain_[3]+da&4294967295,this.chain_[4]=this.chain_[4]+sa&4294967295},w.prototype.update=function(s,z){if(s==null)return;z===void 0&&(z=s.length);for(var D=z-this.blockSize,y=0,U=this.buf_,$=this.inbuf_;y<z;){if($===0)for(;y<=D;)this.compress_(s,y),y+=this.blockSize;if(typeof s==="string")for(;y<z;){U[$]=s.charCodeAt(y),++$,++y;if($===this.blockSize){this.compress_(U),$=0;break}}else for(;y<z;){U[$]=s[y],++$,++y;if($===this.blockSize){this.compress_(U),$=0;break}}}this.inbuf_=$,this.total_+=z},w.prototype.digest=function(){var s=[],z=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var D=this.blockSize-1;D>=56;D--)this.buf_[D]=z&255,z/=256;this.compress_(this.buf_);for(var y=0,D=0;D<5;D++)for(var U=24;U>=0;U-=8)s[y]=this.chain_[D]>>U&255,++y;return s},w}();function na(w,s){var z=new pa(w,s);return z.subscribe.bind(z)}var pa=function(){function w(s,z){var D=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=z,this.task.then(function(){s(D)}).catch(function(y){D.error(y)})}return w.prototype.next=function(s){this.forEachObserver(function(z){z.next(s)})},w.prototype.error=function(s){this.forEachObserver(function(z){z.error(s)}),this.close(s)},w.prototype.complete=function(){this.forEachObserver(function(s){s.complete()}),this.close()},w.prototype.subscribe=function(s,z,D){var y=this,U;if(s===void 0&&z===void 0&&D===void 0)throw new Error("Missing Observer.");T(s,["next","error","complete"])?U=s:U={next:s,error:z,complete:D},U.next===void 0&&(U.next=ea),U.error===void 0&&(U.error=ea),U.complete===void 0&&(U.complete=ea);var $=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{y.finalError?U.error(y.finalError):U.complete()}catch(_){}return}),this.observers.push(U),$},w.prototype.unsubscribeOne=function(s){if(this.observers===void 0||this.observers[s]===void 0)return;delete this.observers[s],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this)},w.prototype.forEachObserver=function(s){if(this.finalized)return;for(var z=0;z<this.observers.length;z++)this.sendOne(z,s)},w.prototype.sendOne=function(s,z){var D=this;this.task.then(function(){if(D.observers!==void 0&&D.observers[s]!==void 0)try{z(D.observers[s])}catch(y){typeof console!=="undefined"&&console.error&&console.error(y)}})},w.prototype.close=function(s){var z=this;if(this.finalized)return;this.finalized=!0,s!==void 0&&(this.finalError=s),this.task.then(function(){z.observers=void 0,z.onNoObservers=void 0})},w}();function ma(w,s){return function(){for(var z=[],D=0;D<arguments.length;D++)z[D]=arguments[D];Promise.resolve(!0).then(function(){w.apply(void 0,z)}).catch(function(y){s&&s(y)})}}function T(w,s){if(typeof w!=="object"||w===null)return!1;for(var z=0,D=s;z<D.length;z++){var y=D[z];if(y in w&&typeof w[y]==="function")return!0}return!1}function ea(){}var ja=function(w,s,z,D){var y;D<s?y="at least "+s:D>z&&(y=z===0?"none":"no more than "+z);if(y){var U=w+" failed: Was called with "+D+(D===1?" argument.":" arguments.")+" Expects "+y+".";throw new Error(U)}};function ka(w,s,z){var D="";switch(s){case 1:D=z?"first":"First";break;case 2:D=z?"second":"Second";break;case 3:D=z?"third":"Third";break;case 4:D=z?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var y=w+" failed: ";return y+=D+" argument ",y}function P(w,s,z,D){if(D&&!z)return;if(typeof z!=="string")throw new Error(ka(w,s,D)+"must be a valid firebase namespace.")}function S(w,s,z,D){if(D&&!z)return;if(typeof z!=="function")throw new Error(ka(w,s,D)+"must be a valid function.")}function ga(w,s,z,D){if(D&&!z)return;if(typeof z!=="object"||z===null)throw new Error(ka(w,s,D)+"must be a valid context object.")}var N=function(w){for(var s=[],z=0,D=0;D<w.length;D++){var y=w.charCodeAt(D);if(y>=55296&&y<=56319){var U=y-55296;D++,c(D<w.length,"Surrogate pair missing trail surrogate.");var $=w.charCodeAt(D)-56320;y=65536+(U<<10)+$}y<128?s[z++]=y:y<2048?(s[z++]=y>>6|192,s[z++]=y&63|128):y<65536?(s[z++]=y>>12|224,s[z++]=y>>6&63|128,s[z++]=y&63|128):(s[z++]=y>>18|240,s[z++]=y>>12&63|128,s[z++]=y>>6&63|128,s[z++]=y&63|128)}return s},fa=function(w){for(var s=0,z=0;z<w.length;z++){var D=w.charCodeAt(z);D<128?s++:D<2048?s+=2:D>=55296&&D<=56319?(s+=4,z++):s+=3}return s};O.CONSTANTS=b;O.Deferred=t;O.ErrorFactory=r;O.FirebaseError=q;O.Sha1=ia;O.assert=c;O.assertionError=d;O.async=ma;O.base64=g;O.base64Decode=i;O.base64Encode=j;O.contains=A;O.createSubscribe=na;O.decode=u;O.deepCopy=k;O.deepExtend=n;O.errorPrefix=ka;O.getUA=v;O.isAdmin=X;O.isBrowser=F;O.isBrowserExtension=H;O.isElectron=L;O.isEmpty=M;O.isIE=R;O.isMobileCordova=x;O.isNode=C;O.isNodeSdk=V;O.isReactNative=Q;O.isSafari=W;O.isUWP=I;O.isValidFormat=G;O.isValidTimestamp=o;O.issuedAtTime=E;O.jsonEval=l;O.map=B;O.querystring=J;O.querystringDecode=Z;O.safeGet=Y;O.stringLength=fa;O.stringToByteArray=N;O.stringify=p;O.validateArgCount=ja;O.validateCallback=S;O.validateContextObject=ga;O.validateNamespace=P});var li=jb(q=>{$b(q,{__assign:()=>c,__asyncDelegator:()=>Q,__asyncGenerator:()=>H,__asyncValues:()=>L,__await:()=>F,__awaiter:()=>j,__classPrivateFieldGet:()=>W,__classPrivateFieldSet:()=>K,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>V,__importStar:()=>I,__makeTemplateObject:()=>R,__metadata:()=>g,__param:()=>f,__read:()=>v,__rest:()=>d,__spread:()=>x,__spreadArrays:()=>C,__values:()=>t});var a=function(h,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,p){l.__proto__=p}||function(l,p){for(var u in p)p.hasOwnProperty(u)&&(l[u]=p[u])},a(h,m)};function b(h,m){a(h,m);function l(){this.constructor=h}h.prototype=m===null?Object.create(m):(l.prototype=m.prototype,new l())}var c=function(){return c=Object.assign||function h(m){for(var l,p=1,u=arguments.length;p<u;p++){l=arguments[p];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(m[o]=l[o])}return m},c.apply(this,arguments)};function d(h,m){var l={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&m.indexOf(p)<0&&(l[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var u=0,p=Object.getOwnPropertySymbols(h);u<p.length;u++)m.indexOf(p[u])<0&&Object.prototype.propertyIsEnumerable.call(h,p[u])&&(l[p[u]]=h[p[u]]);return l}function e(h,m,l,p){var u=arguments.length,o=u<3?m:p===null?p=Object.getOwnPropertyDescriptor(m,l):p,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(h,m,l,p);else for(var G=h.length-1;G>=0;G--)(E=h[G])&&(o=(u<3?E(o):u>3?E(m,l,o):E(m,l))||o);return u>3&&o&&Object.defineProperty(m,l,o),o}function f(h,m){return function(l,p){m(l,p,h)}}function g(h,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,m)}function j(h,m,l,p){function u(o){return o instanceof l?o:new l(function(E){E(o)})}return new(l||(l=Promise))(function(o,E){function G(Y){try{A(p.next(Y))}catch(M){E(M)}}function X(Y){try{A(p.throw(Y))}catch(M){E(M)}}function A(Y){Y.done?o(Y.value):u(Y.value).then(G,X)}A((p=p.apply(h,m||[])).next())})}function i(h,m){var l={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},p,u,o,E;return E={next:G(0),throw:G(1),return:G(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function G(A){return function(Y){return X([A,Y])}}function X(A){if(p)throw new TypeError("Generator is already executing.");for(;l;)try{if(p=1,u&&(o=A[0]&2?u.return:A[0]?u.throw||((o=u.return)&&o.call(u),0):u.next)&&!(o=o.call(u,A[1])).done)return o;(u=0,o)&&(A=[A[0]&2,o.value]);switch(A[0]){case 0:case 1:o=A;break;case 4:return l.label++,{value:A[1],done:!1};case 5:l.label++,u=A[1],A=[0];continue;case 7:A=l.ops.pop(),l.trys.pop();continue;default:if(!(o=l.trys,o=o.length>0&&o[o.length-1])&&(A[0]===6||A[0]===2)){l=0;continue}if(A[0]===3&&(!o||A[1]>o[0]&&A[1]<o[3])){l.label=A[1];break}if(A[0]===6&&l.label<o[1]){l.label=o[1],o=A;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(A);break}o[2]&&l.ops.pop(),l.trys.pop();continue}A=m.call(h,l)}catch(Y){A=[6,Y],u=0}finally{p=o=0}if(A[0]&5)throw A[1];return{value:A[0]?A[1]:void 0,done:!0}}}function k(h,m,l,p){p===void 0&&(p=l),h[p]=m[l]}function n(h,m){for(var l in h)l!=="default"&&!m.hasOwnProperty(l)&&(m[l]=h[l])}function t(h){var m=typeof Symbol==="function"&&Symbol.iterator,l=m&&h[m],p=0;if(l)return l.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function v(h,m){var l=typeof Symbol==="function"&&h[Symbol.iterator];if(!l)return h;var p=l.call(h),u,o=[],E;try{for(;(m===void 0||m-- >0)&&!(u=p.next()).done;)o.push(u.value)}catch(G){E={error:G}}finally{try{u&&!u.done&&(l=p.return)&&l.call(p)}finally{if(E)throw E.error}}return o}function x(){for(var h=[],m=0;m<arguments.length;m++)h=h.concat(v(arguments[m]));return h}function C(){for(var h=0,m=0,l=arguments.length;m<l;m++)h+=arguments[m].length;for(var p=Array(h),u=0,m=0;m<l;m++)for(var o=arguments[m],E=0,G=o.length;E<G;E++,u++)p[u]=o[E];return p}function F(h){return this instanceof F?(this.v=h,this):new F(h)}function H(h,m,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=l.apply(h,m||[]),u,o=[];return u={},E("next"),E("throw"),E("return"),u[Symbol.asyncIterator]=function(){return this},u;function E(B){p[B]&&(u[B]=function(J){return new Promise(function(Z,ia){o.push([B,J,Z,ia])>1||G(B,J)})})}function G(B,J){try{X(p[B](J))}catch(Z){M(o[0][3],Z)}}function X(B){B.value instanceof F?Promise.resolve(B.value.v).then(A,Y):M(o[0][2],B)}function A(B){G("next",B)}function Y(B){G("throw",B)}function M(B,J){(B(J),o.shift(),o.length)&&G(o[0][0],o[0][1])}}function Q(h){var m,l;return m={},p("next"),p("throw",function(u){throw u}),p("return"),m[Symbol.iterator]=function(){return this},m;function p(u,o){m[u]=h[u]?function(E){return(l=!l)?{value:F(h[u](E)),done:u==="return"}:o?o(E):E}:o}}function L(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=h[Symbol.asyncIterator],l;return m?m.call(h):(h=typeof t==="function"?t(h):h[Symbol.iterator](),l={},p("next"),p("throw"),p("return"),l[Symbol.asyncIterator]=function(){return this},l);function p(o){l[o]=h[o]&&function(E){return new Promise(function(G,X){E=h[o](E),u(G,X,E.done,E.value)})}}function u(o,E,G,X){Promise.resolve(X).then(function(A){o({value:A,done:G})},E)}}function R(h,m){return Object.defineProperty?Object.defineProperty(h,"raw",{value:m}):h.raw=m,h}function I(h){if(h&&h.__esModule)return h;var m={};if(h!=null)for(var l in h)Object.hasOwnProperty.call(h,l)&&(m[l]=h[l]);return m.default=h,m}function V(h){return h&&h.__esModule?h:{default:h}}function W(h,m){if(!m.has(h))throw new TypeError("attempted to get private field on non-instance");return m.get(h)}function K(h,m,l){if(!m.has(h))throw new TypeError("attempted to set private field on non-instance");return m.set(h,l),l}});var ki=jb(i=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=li(),b=$e(),c=function(){function n(t,v,x){this.name=t,this.instanceFactory=v,this.type=x,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return n.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},n.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},n.prototype.setServiceProps=function(t){return this.serviceProps=t,this},n}();var d="[DEFAULT]";var e=function(){function n(t,v){this.name=t,this.container=v,this.component=null,this.instances=new Map(),this.instancesDeferred=new Map()}return n.prototype.get=function(t){t===void 0&&(t=d);var v=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(v)){var x=new b.Deferred();this.instancesDeferred.set(v,x);try{var C=this.getOrInitializeService(v);C&&x.resolve(C)}catch(F){}}return this.instancesDeferred.get(v).promise},n.prototype.getImmediate=function(t){var v=a.__assign({identifier:d,optional:!1},t),x=v.identifier,C=v.optional,F=this.normalizeInstanceIdentifier(x);try{var H=this.getOrInitializeService(F);if(!H){if(C)return null;throw Error("Service "+this.name+" is not available")}return H}catch(Q){if(C)return null;throw Q}},n.prototype.getComponent=function(){return this.component},n.prototype.setComponent=function(t){var v,x;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");this.component=t;if(g(t))try{this.getOrInitializeService(d)}catch(V){}try{for(var C=a.__values(this.instancesDeferred.entries()),F=C.next();!F.done;F=C.next()){var H=a.__read(F.value,2),Q=H[0],L=H[1],R=this.normalizeInstanceIdentifier(Q);try{var I=this.getOrInitializeService(R);L.resolve(I)}catch(V){}}}catch(V){v={error:V}}finally{try{F&&!F.done&&(x=C.return)&&x.call(C)}finally{if(v)throw v.error}}},n.prototype.clearInstance=function(t){t===void 0&&(t=d),this.instancesDeferred.delete(t),this.instances.delete(t)},n.prototype.delete=function(){return a.__awaiter(this,void 0,void 0,function(){var t;return a.__generator(this,function(v){switch(v.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(t.filter(function(x){return"INTERNAL"in x}).map(function(x){return x.INTERNAL.delete()}))];case 1:return v.sent(),[2]}})})},n.prototype.isComponentSet=function(){return this.component!=null},n.prototype.getOrInitializeService=function(t){var v=this.instances.get(t);return!v&&this.component&&(v=this.component.instanceFactory(this.container,f(t)),this.instances.set(t,v)),v||null},n.prototype.normalizeInstanceIdentifier=function(t){return this.component?this.component.multipleInstances?t:d:t},n}();function f(n){return n===d?void 0:n}function g(n){return n.instantiationMode==="EAGER"}var j=function(){function n(t){this.name=t,this.providers=new Map()}return n.prototype.addComponent=function(t){var v=this.getProvider(t.name);if(v.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);v.setComponent(t)},n.prototype.addOrOverwriteComponent=function(t){var v=this.getProvider(t.name);v.isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},n.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var v=new e(t,this);return this.providers.set(t,v),v},n.prototype.getProviders=function(){return Array.from(this.providers.values())},n}();i.Component=c;i.ComponentContainer=j;i.Provider=e});var mi=jb(t=>{$b(t,{LogLevel:()=>d,Logger:()=>i,setLogLevel:()=>k,setUserLogHandler:()=>n});function a(){for(var x=0,C=0,F=arguments.length;C<F;C++)x+=arguments[C].length;for(var H=Array(x),Q=0,C=0;C<F;C++)for(var L=arguments[C],R=0,I=L.length;R<I;R++,Q++)H[Q]=L[R];return H}var b,c=[],d;(function(x){x[x.DEBUG=0]="DEBUG",x[x.VERBOSE=1]="VERBOSE",x[x.INFO=2]="INFO",x[x.WARN=3]="WARN",x[x.ERROR=4]="ERROR",x[x.SILENT=5]="SILENT"})(d||(d={}));var e={debug:d.DEBUG,verbose:d.VERBOSE,info:d.INFO,warn:d.WARN,error:d.ERROR,silent:d.SILENT},f=d.INFO,g=(b={},b[d.DEBUG]="log",b[d.VERBOSE]="log",b[d.INFO]="info",b[d.WARN]="warn",b[d.ERROR]="error",b),j=function(x,C){for(var F=[],H=2;H<arguments.length;H++)F[H-2]=arguments[H];if(C<x.logLevel)return;var Q=new Date().toISOString(),L=g[C];if(L)console[L].apply(console,a(["["+Q+"]  "+x.name+":"],F));else throw new Error("Attempted to log a message with an invalid logType (value: "+C+")")},i=function(){function x(C){this.name=C,this._logLevel=f,this._logHandler=j,this._userLogHandler=null,c.push(this)}return Object.defineProperty(x.prototype,"logLevel",{get:function(){return this._logLevel},set:function(C){if(!(C in d))throw new TypeError('Invalid value "'+C+'" assigned to `logLevel`');this._logLevel=C},enumerable:!1,configurable:!0}),x.prototype.setLogLevel=function(C){this._logLevel=typeof C==="string"?e[C]:C},Object.defineProperty(x.prototype,"logHandler",{get:function(){return this._logHandler},set:function(C){if(typeof C!=="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=C},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(C){this._userLogHandler=C},enumerable:!1,configurable:!0}),x.prototype.debug=function(){for(var C=[],F=0;F<arguments.length;F++)C[F]=arguments[F];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.DEBUG],C)),this._logHandler.apply(this,a([this,d.DEBUG],C))},x.prototype.log=function(){for(var C=[],F=0;F<arguments.length;F++)C[F]=arguments[F];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.VERBOSE],C)),this._logHandler.apply(this,a([this,d.VERBOSE],C))},x.prototype.info=function(){for(var C=[],F=0;F<arguments.length;F++)C[F]=arguments[F];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.INFO],C)),this._logHandler.apply(this,a([this,d.INFO],C))},x.prototype.warn=function(){for(var C=[],F=0;F<arguments.length;F++)C[F]=arguments[F];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.WARN],C)),this._logHandler.apply(this,a([this,d.WARN],C))},x.prototype.error=function(){for(var C=[],F=0;F<arguments.length;F++)C[F]=arguments[F];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.ERROR],C)),this._logHandler.apply(this,a([this,d.ERROR],C))},x}();function k(x){c.forEach(function(C){C.setLogLevel(x)})}function n(x,C){for(var F=function(R){var I=null;C&&C.level&&(I=e[C.level]),x===null?R.userLogHandler=null:R.userLogHandler=function(V,W){for(var K=[],q=2;q<arguments.length;q++)K[q-2]=arguments[q];var r=K.map(function(h){if(h==null)return null;{if(typeof h==="string")return h;{if(typeof h==="number"||typeof h==="boolean")return h.toString();{if(h instanceof Error)return h.message;try{return JSON.stringify(h)}catch(m){return null}}}}}).filter(function(h){return h}).join(" ");W>=(I!==null&&I!==void 0?I:V.logLevel)&&x({level:d[W].toLowerCase(),message:r,args:K,type:V.name})}},H=0,Q=c;H<Q.length;H++){var L=Q[H];F(L)}}});var ii=jb(A=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});var a=ji(),b=$e(),c=ki(),d=mi();var e,f=(e={},e["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",e["bad-app-name"]="Illegal App name: '{$appName}",e["duplicate-app"]="Firebase App named '{$appName}' already exists",e["app-deleted"]="Firebase App named '{$appName}' already deleted",e["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",e["invalid-log-argument"]="First argument to `onLog` must be null or a function.",e),g=new b.ErrorFactory("app","Firebase",f),j="@firebase/app",i="0.6.8",k="@firebase/analytics",n="@firebase/auth",t="@firebase/database",v="@firebase/functions",x="@firebase/installations",C="@firebase/messaging",F="@firebase/performance",H="@firebase/remote-config",Q="@firebase/storage",L="@firebase/firestore",R="firebase-wrapper";var I,V="[DEFAULT]",W=(I={},I[j]="fire-core",I[k]="fire-analytics",I[n]="fire-auth",I[t]="fire-rtdb",I[v]="fire-fn",I[x]="fire-iid",I[C]="fire-fcm",I[F]="fire-perf",I[H]="fire-rc",I[Q]="fire-gcs",I[L]="fire-fst",I["fire-js"]="fire-js",I[R]="fire-js-all",I);var K=new d.Logger("@firebase/app");var q=function(){function M(B,J,Z){var ia,na,pa=this;this.firebase_=Z,this.isDeleted_=!1,this.name_=J.name,this.automaticDataCollectionEnabled_=J.automaticDataCollectionEnabled||!1,this.options_=b.deepCopy(B),this.container=new c.ComponentContainer(J.name),this._addComponent(new c.Component("app",function(){return pa},"PUBLIC"));try{for(var ma=a.__values(this.firebase_.INTERNAL.components.values()),T=ma.next();!T.done;T=ma.next()){var ea=T.value;this._addComponent(ea)}}catch(ja){ia={error:ja}}finally{try{T&&!T.done&&(na=ma.return)&&na.call(ma)}finally{if(ia)throw ia.error}}}return Object.defineProperty(M.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(B){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=B},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),M.prototype.delete=function(){var B=this;return new Promise(function(J){B.checkDestroyed_(),J()}).then(function(){return B.firebase_.INTERNAL.removeApp(B.name_),Promise.all(B.container.getProviders().map(function(J){return J.delete()}))}).then(function(){B.isDeleted_=!0})},M.prototype._getService=function(B,J){return J===void 0&&(J=V),this.checkDestroyed_(),this.container.getProvider(B).getImmediate({identifier:J})},M.prototype._removeServiceInstance=function(B,J){J===void 0&&(J=V),this.container.getProvider(B).clearInstance(J)},M.prototype._addComponent=function(B){try{this.container.addComponent(B)}catch(J){K.debug("Component "+B.name+" failed to register with FirebaseApp "+this.name,J)}},M.prototype._addOrOverwriteComponent=function(B){this.container.addOrOverwriteComponent(B)},M.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw g.create("app-deleted",{appName:this.name_})},M}();q.prototype.name&&q.prototype.options||q.prototype.delete||console.log("dc");var r="7.16.0";function h(M){var B={},J=new Map(),Z={__esModule:!0,initializeApp:pa,app:na,registerVersion:ea,setLogLevel:d.setLogLevel,onLog:ja,apps:null,SDK_VERSION:r,INTERNAL:{registerComponent:T,removeApp:ia,components:J,useAsService:ka}};Z.default=Z,Object.defineProperty(Z,"apps",{get:ma});function ia(P){delete B[P]}function na(P){P=P||V;if(!b.contains(B,P))throw g.create("no-app",{appName:P});return B[P]}na.App=M;function pa(P,S){S===void 0&&(S={});if(typeof S!=="object"||S===null){var ga=S;S={name:ga}}var N=S;N.name===void 0&&(N.name=V);var fa=N.name;if(typeof fa!=="string"||!fa)throw g.create("bad-app-name",{appName:String(fa)});if(b.contains(B,fa))throw g.create("duplicate-app",{appName:fa});var O=new M(P,N,Z);return B[fa]=O,O}function ma(){return Object.keys(B).map(function(P){return B[P]})}function T(P){var S,ga,N=P.name;if(J.has(N))return K.debug("There were multiple attempts to register component "+N+"."),P.type==="PUBLIC"?Z[N]:null;J.set(N,P);if(P.type==="PUBLIC"){var fa=function(s){s===void 0&&(s=na());if(typeof s[N]!=="function")throw g.create("invalid-app-argument",{appName:N});return s[N]()};P.serviceProps!==void 0&&b.deepExtend(fa,P.serviceProps),Z[N]=fa,M.prototype[N]=function(){for(var s=[],z=0;z<arguments.length;z++)s[z]=arguments[z];var D=this._getService.bind(this,N);return D.apply(this,P.multipleInstances?s:[])}}try{for(var O=a.__values(Object.keys(B)),va=O.next();!va.done;va=O.next()){var w=va.value;B[w]._addComponent(P)}}catch(s){S={error:s}}finally{try{va&&!va.done&&(ga=O.return)&&ga.call(O)}finally{if(S)throw S.error}}return P.type==="PUBLIC"?Z[N]:null}function ea(P,S,ga){var N,fa=(N=W[P])!==null&&N!==void 0?N:P;ga&&(fa+="-"+ga);var O=fa.match(/\s|\//),va=S.match(/\s|\//);if(O||va){var w=['Unable to register library "'+fa+'" with version "'+S+'":'];O&&w.push('library name "'+fa+'" contains illegal characters (whitespace or "/")'),O&&va&&w.push("and"),va&&w.push('version name "'+S+'" contains illegal characters (whitespace or "/")'),K.warn(w.join(" "));return}T(new c.Component(fa+"-version",function(){return{library:fa,version:S}},"VERSION"))}function ja(P,S){if(P!==null&&typeof P!=="function")throw g.create("invalid-log-argument",{appName:name});d.setUserLogHandler(P,S)}function ka(P,S){if(S==="serverAuth")return null;var ga=S;return ga}return Z}function m(){var M=h(q);M.INTERNAL=a.__assign(a.__assign({},M.INTERNAL),{createFirebaseNamespace:m,extendNamespace:B,createSubscribe:b.createSubscribe,ErrorFactory:b.ErrorFactory,deepExtend:b.deepExtend});function B(J){b.deepExtend(M,J)}return M}var l=m();var p=function(){function M(B){this.container=B}return M.prototype.getPlatformInfoString=function(){var B=this.container.getProviders();return B.map(function(J){if(u(J)){var Z=J.getImmediate();return Z.library+"/"+Z.version}else return null}).filter(function(J){return J}).join(" ")},M}();function u(M){var B=M.getComponent();return(B===null||B===void 0?void 0:B.type)==="VERSION"}function o(M,B){M.INTERNAL.registerComponent(new c.Component("platform-logger",function(J){return new p(J)},"PRIVATE")),M.registerVersion(j,i,B),M.registerVersion("fire-js","")}if(b.isBrowser()&&self.firebase!==void 0){K.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);var E=self.firebase.SDK_VERSION;E&&E.indexOf("LITE")>=0&&K.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}var G=l.initializeApp;l.initializeApp=function(){for(var M=[],B=0;B<arguments.length;B++)M[B]=arguments[B];return b.isNode()&&K.warn(`
      Warning: This is a browser-targeted Firebase bundle but it appears it is being
      run in a Node environment.  If running in a Node environment, make sure you
      are using the bundle specified by the "main" field in package.json.
      
      If you are using Webpack, you can specify "main" as the first item in
      "resolve.mainFields":
      https://webpack.js.org/configuration/resolve/#resolvemainfields
      
      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"
      as the first item in "mainFields", e.g. ['main', 'module'].
      https://github.com/rollup/rollup-plugin-node-resolve
      `),G.apply(void 0,M)};var X=l;o(X);A.default=X;A.firebase=X});var Na=jb((e,f)=>{"use strict";function a(g){return g&&typeof g==="object"&&"default"in g?g.default:g}var b=a(ii()),c="firebase",d="7.16.0";b.registerVersion(c,d,"app");f.exports=b});var wn=jb((b,c)=>{var a=function(){function d(k,n){if(!j[k]){j[k]={};for(var t=0;t<k.length;t++)j[k][k.charAt(t)]=t}return j[k][n]}var e=String.fromCharCode,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",j={},i={compressToBase64:function(k){if(null==k)return"";var n=i._compress(k,6,function(t){return f.charAt(t)});switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(k){return null==k?"":""==k?null:i._decompress(k.length,32,function(n){return d(f,k.charAt(n))})},compressToUTF16:function(k){return null==k?"":i._compress(k,15,function(n){return e(n+32)})+" "},decompressFromUTF16:function(k){return null==k?"":""==k?null:i._decompress(k.length,16384,function(n){return k.charCodeAt(n)-32})},compressToUint8Array:function(k){for(var n=i.compress(k),t=new Uint8Array(2*n.length),v=0,x=n.length;x>v;v++){var C=n.charCodeAt(v);t[2*v]=C>>>8,t[2*v+1]=C%256}return t},decompressFromUint8Array:function(k){if(null===k||void 0===k)return i.decompress(k);for(var n=new Array(k.length/2),t=0,v=n.length;v>t;t++)n[t]=256*k[2*t]+k[2*t+1];var x=[];return n.forEach(function(C){x.push(e(C))}),i.decompress(x.join(""))},compressToEncodedURIComponent:function(k){return null==k?"":i._compress(k,6,function(n){return g.charAt(n)})},decompressFromEncodedURIComponent:function(k){return null==k?"":""==k?null:(k=k.replace(/ /g,"+"),i._decompress(k.length,32,function(n){return d(g,k.charAt(n))}))},compress:function(k){return i._compress(k,16,function(n){return e(n)})},_compress:function(k,n,t){if(null==k)return"";var v,x,C,F={},H={},Q="",L="",R="",I=2,V=3,W=2,K=[],q=0,r=0;for(C=0;C<k.length;C+=1)if(Q=k.charAt(C),Object.prototype.hasOwnProperty.call(F,Q)||(F[Q]=V++,H[Q]=!0),L=R+Q,Object.prototype.hasOwnProperty.call(F,L))R=L;else{if(Object.prototype.hasOwnProperty.call(H,R)){if(R.charCodeAt(0)<256){for(v=0;W>v;v++)q<<=1,r==n-1?(r=0,K.push(t(q)),q=0):r++;for(x=R.charCodeAt(0),v=0;8>v;v++)q=q<<1|1&x,r==n-1?(r=0,K.push(t(q)),q=0):r++,x>>=1}else{for(x=1,v=0;W>v;v++)q=q<<1|x,r==n-1?(r=0,K.push(t(q)),q=0):r++,x=0;for(x=R.charCodeAt(0),v=0;16>v;v++)q=q<<1|1&x,r==n-1?(r=0,K.push(t(q)),q=0):r++,x>>=1}I--,0==I&&(I=Math.pow(2,W),W++),delete H[R]}else for(x=F[R],v=0;W>v;v++)q=q<<1|1&x,r==n-1?(r=0,K.push(t(q)),q=0):r++,x>>=1;I--,0==I&&(I=Math.pow(2,W),W++),F[L]=V++,R=String(Q)}if(""!==R){if(Object.prototype.hasOwnProperty.call(H,R)){if(R.charCodeAt(0)<256){for(v=0;W>v;v++)q<<=1,r==n-1?(r=0,K.push(t(q)),q=0):r++;for(x=R.charCodeAt(0),v=0;8>v;v++)q=q<<1|1&x,r==n-1?(r=0,K.push(t(q)),q=0):r++,x>>=1}else{for(x=1,v=0;W>v;v++)q=q<<1|x,r==n-1?(r=0,K.push(t(q)),q=0):r++,x=0;for(x=R.charCodeAt(0),v=0;16>v;v++)q=q<<1|1&x,r==n-1?(r=0,K.push(t(q)),q=0):r++,x>>=1}I--,0==I&&(I=Math.pow(2,W),W++),delete H[R]}else for(x=F[R],v=0;W>v;v++)q=q<<1|1&x,r==n-1?(r=0,K.push(t(q)),q=0):r++,x>>=1;I--,0==I&&(I=Math.pow(2,W),W++)}for(x=2,v=0;W>v;v++)q=q<<1|1&x,r==n-1?(r=0,K.push(t(q)),q=0):r++,x>>=1;for(;;){if(q<<=1,r==n-1){K.push(t(q));break}r++}return K.join("")},decompress:function(k){return null==k?"":""==k?null:i._decompress(k.length,32768,function(n){return k.charCodeAt(n)})},_decompress:function(k,n,t){var v,x,C,F,H,Q,L,R,I=[],V=4,W=4,K=3,q="",r=[],h={val:t(0),position:n,index:1};for(x=0;3>x;x+=1)I[x]=x;for(F=0,Q=Math.pow(2,2),L=1;L!=Q;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=t(h.index++)),F|=(H>0?1:0)*L,L<<=1;switch(v=F){case 0:for(F=0,Q=Math.pow(2,8),L=1;L!=Q;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=t(h.index++)),F|=(H>0?1:0)*L,L<<=1;R=e(F);break;case 1:for(F=0,Q=Math.pow(2,16),L=1;L!=Q;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=t(h.index++)),F|=(H>0?1:0)*L,L<<=1;R=e(F);break;case 2:return""}for(I[3]=R,C=R,r.push(R);;){if(h.index>k)return"";for(F=0,Q=Math.pow(2,K),L=1;L!=Q;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=t(h.index++)),F|=(H>0?1:0)*L,L<<=1;switch(R=F){case 0:for(F=0,Q=Math.pow(2,8),L=1;L!=Q;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=t(h.index++)),F|=(H>0?1:0)*L,L<<=1;I[W++]=e(F),R=W-1,V--;break;case 1:for(F=0,Q=Math.pow(2,16),L=1;L!=Q;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=t(h.index++)),F|=(H>0?1:0)*L,L<<=1;I[W++]=e(F),R=W-1,V--;break;case 2:return r.join("")}if(0==V&&(V=Math.pow(2,K),K++),I[R])q=I[R];else{if(R!==W)return null;q=C+C.charAt(0)}r.push(q),I[W++]=C+q.charAt(0),V--,C=q,0==V&&(V=Math.pow(2,K),K++)}}};return i}();"function"==typeof define&&define.amd?define(function(){return a}):"undefined"!=typeof c&&null!=c&&(c.exports=a)});let si,ti=0,ui=0;const xa={get:()=>si,set:a=>{si=a},getFrame:()=>ti,setFrame:a=>{ti=a},getElapsed:()=>ui,setElapsed:a=>{ui=a}};let yi=0;function Ve(a=0){return()=>{yi=a}}function fd(){return yi}let ef="Phaser",An="https://phaser4.io",Bn="#fff",Cn="linear-gradient(#3e0081 40%, #00bcc3)";function af(){if(ef!==""){const a=xa.get(),b=ef==="Phaser"?" v"+a.VERSION:"";console.log(`%c${ef}${b}%c ${An}`,`padding: 4px 16px; color: ${Bn}; background: ${Cn}`,"")}}let Di=800,Ei=600,Fi=1;function Ye(a=800,b=600,c=1){return c===0&&(c=window.devicePixelRatio),()=>{Di=a,Ei=b,Fi=c}}function ac(){return Di}function bc(){return Ei}function cc(){return Fi}const tf=[],ec={add:a=>{tf.push(a)},get:()=>tf,clear:()=>{tf.length=0}};let Ci;function gd(a){Ci=a}function bf(){return Ci}let ff=.5,gf=.5;let zi=0;function hf(a){zi=a}function xc(){return zi}function hd(a){let b;return a&&(typeof a==="string"?b=document.getElementById(a):typeof a==="object"&&a.nodeType===1&&(b=a)),b||(b=document.body),b}let Ai;function We(a){return()=>{a&&(Ai=hd(a))}}function cf(){return Ai}let Bi=[];function Xe(a){return()=>{Bi=[].concat(a)}}function jf(){return Bi}let En={alpha:!1,antialias:!1,depth:!1,premultipliedAlpha:!1};function kf(){return En}class cj{constructor(a){this.stack=[],this.current=null,this.renderer=a}reset(){this.stack=[],this.current=null;const a=this.renderer,b=a.gl;b.bindFramebuffer(b.FRAMEBUFFER,null),b.viewport(0,0,a.width,a.height)}add(a,b=!0,c=0,d=0){this.stack.push({framebuffer:a,width:c,height:d}),this.set(a,b,c,d)}set(a,b=!0,c=0,d=0){const e=this.renderer,f=e.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),b&&(f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),c>0&&f.viewport(0,0,c,d),this.current=a}pop(){this.stack.pop();const a=this.stack.length;if(a>0){const b=this.stack[a-1];this.set(b.framebuffer,!1,b.width,b.height)}else this.reset()}rebind(){const a=this.renderer.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.current)}destroy(){this.stack=[]}}let bj;const Ba={get:()=>bj,set:a=>{bj=a}};function dj(a,b=[]){const c=a>>16&255,d=a>>8&255,e=a&255,f=a>16777215?a>>>24:255;return b[0]=c/255,b[1]=d/255,b[2]=e/255,b[3]=f/255,b}function _i(a,b){return a.a===b.a&&a.b===b.b&&a.c===b.c&&a.d===b.d&&a.tx===b.tx&&a.ty===b.ty}function kj(a,b){const c=Ba.get();b||(b=c.COLOR_ATTACHMENT0);const d=c.createFramebuffer();return c.bindFramebuffer(c.FRAMEBUFFER,d),c.framebufferTexture2D(c.FRAMEBUFFER,b,c.TEXTURE_2D,a,0),c.bindFramebuffer(c.FRAMEBUFFER,null),d}function sd(a){const b=Ba.get();if(!b)return;const{parent:c,flipY:d,unpackPremultiplyAlpha:e,minFilter:f,magFilter:g,wrapS:j,wrapT:i,generateMipmap:k,isPOT:n}=a,t=c.image;let v=c.width,x=c.height;const C=b.createTexture();return b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,C),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,d),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),t?(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,t),v=t.width,x=t.height):b.texImage2D(b.TEXTURE_2D,0,b.RGBA,v,x,0,b.RGBA,b.UNSIGNED_BYTE,null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,g),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,j),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,i),k&&n&&b.generateMipmap(b.TEXTURE_2D),a.texture=C,C}function lj(a){const b=Ba.get();b&&b.isFramebuffer(a)&&b.deleteFramebuffer(a)}function uf(a){const b=Ba.get();if(!b)return;b.isTexture(a)&&b.deleteTexture(a)}function $i(a,b){return a<1||b<1?!1:(a&a-1)===0&&(b&b-1)===0}function oj(a,b=!0){const c=Ba.get();c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,a);const d=b?c.LINEAR:c.NEAREST;c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,d),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,d)}function pj(a){const b=Ba.get(),c=a.parent.image,d=c.width,e=c.height;return d>0&&e>0&&(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,a.texture),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,a.flipY),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,c)),a.texture}class rd{constructor(a,b={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1;const c=Ba.get();this.parent=a,this.isPOT=$i(a.width,a.height);const{texture:d=null,framebuffer:e=null,unpackPremultiplyAlpha:f=!0,minFilter:g=c.LINEAR,magFilter:j=c.LINEAR,wrapS:i=c.CLAMP_TO_EDGE,wrapT:k=c.CLAMP_TO_EDGE,generateMipmap:n=this.isPOT,flipY:t=!1}=b;this.minFilter=g,this.magFilter=j,this.wrapS=i,this.wrapT=k,this.generateMipmap=n,this.flipY=t,this.unpackPremultiplyAlpha=f,e&&(this.framebuffer=e),d?this.texture=d:sd(this)}setFilter(a){this.texture&&oj(this.texture,a)}create(){const a=this.texture;return a&&uf(a),sd(this)}update(){const a=this.texture;return a?pj(this):sd(this)}setIndex(a){this.dirtyIndex=a!==this.index,this.index=a}destroy(){uf(this.texture),lj(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}}class jj{constructor(a,b,c,d,e){this.batchSize=a,this.dataSize=b,this.indexSize=c,this.vertexElementSize=d,this.quadIndexSize=e,this.vertexByteSize=d*b,this.quadByteSize=this.vertexByteSize*4,this.quadElementSize=d*4,this.bufferByteSize=a*this.quadByteSize,this.create()}create(){let a=[];for(let c=0;c<this.batchSize*this.indexSize;c+=this.indexSize)a.push(c+0,c+1,c+2,c+2,c+3,c+0);this.data=new ArrayBuffer(this.bufferByteSize),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const b=Ba.get();this.vertexBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.data,b.DYNAMIC_DRAW),this.indexBuffer=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.index,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,null),a=[]}destroy(){}}class vf{constructor(a,b,c,d,e,f){this.trimmed=!1,this.texture=a,this.key=b,this.x=c,this.y=d,this.width=e,this.height=f,this.sourceSizeWidth=e,this.sourceSizeHeight=f,this.updateUVs()}setPivot(a,b){this.pivot={x:a,y:b}}setSize(a,b){this.width=a,this.height=b,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.updateUVs()}setSourceSize(a,b){this.sourceSizeWidth=a,this.sourceSizeHeight=b}setTrim(a,b,c,d,e,f){this.trimmed=!0,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.spriteSourceSizeX=c,this.spriteSourceSizeY=d,this.spriteSourceSizeWidth=e,this.spriteSourceSizeHeight=f}getExtent(a,b){const c=this.sourceSizeWidth,d=this.sourceSizeHeight;let e,f,g,j;return this.trimmed?(e=this.spriteSourceSizeX-a*c,f=e+this.spriteSourceSizeWidth,g=this.spriteSourceSizeY-b*d,j=g+this.spriteSourceSizeHeight):(e=-a*c,f=e+c,g=-b*d,j=g+d),{left:e,right:f,top:g,bottom:j}}setExtent(a){const b=a.transform,c=b.origin.x,d=b.origin.y,e=this.sourceSizeWidth,f=this.sourceSizeHeight;let g,j,i,k;this.trimmed?(g=this.spriteSourceSizeX-c*e,j=this.spriteSourceSizeY-d*f,i=this.spriteSourceSizeWidth,k=this.spriteSourceSizeHeight):(g=-c*e,j=-d*f,i=e,k=f),b.setExtent(g,j,i,k)}updateUVs(){const{x:a,y:b,width:c,height:d}=this,e=this.texture.width,f=this.texture.height;this.u0=a/e,this.v0=b/f,this.u1=(a+c)/e,this.v1=(b+d)/f}}class bb{constructor(a,b,c){this.key="",a&&(b=a.width,c=a.height),this.image=a,this.width=b,this.height=c,this.frames=new Map(),this.data={},this.addFrame("__BASE",0,0,b,c),ec.add(this)}addFrame(a,b,c,d,e){if(this.frames.has(a))return null;const f=new vf(this,a,b,c,d,e);return this.frames.set(a,f),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=f),f}getFrame(a){if(!a)return this.firstFrame;a instanceof vf&&(a=a.key);let b=this.frames.get(a);return b||(console.warn(`Frame missing: ${a}`),b=this.firstFrame),b}setSize(a,b){this.width=a,this.height=b;const c=this.frames.get("__BASE");c.setSize(a,b)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}}let ij;const Dc={get:()=>ij,set:a=>{ij=a}};const nj={fragmentShader:`\r
#define SHADER_NAME SINGLE_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture;\r
\r
void main (void)\r
{\r
    vec4 color = texture2D(uTexture, vTextureCoord);\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`,vertexShader:`\r
#define SHADER_NAME SINGLE_QUAD_VERT\r
\r
precision highp float;\r
\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
attribute float aTextureId;\r
attribute vec4 aTintColor;\r
\r
uniform mat4 uProjectionMatrix;\r
uniform mat4 uCameraMatrix;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
void main (void)\r
{\r
    vTextureCoord = aTextureCoord;\r
    vTextureId = aTextureId;\r
    vTintColor = aTintColor;\r
\r
    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\r
}`};class qd{constructor(a={}){this.attribs={aVertexPosition:0,aTextureCoord:0,aTextureId:0,aTintColor:0},this.uniforms={uProjectionMatrix:0,uCameraMatrix:0,uTexture:0,uTime:0,uResolution:0},this.renderToFBO=!1,this.renderer=Dc.get();const{batchSize:b=4096,dataSize:c=4,indexSize:d=4,vertexElementSize:e=6,quadIndexSize:f=6,fragmentShader:g=nj.fragmentShader,vertexShader:j=nj.vertexShader,width:i=ac(),height:k=bc(),resolution:n=cc(),renderToFBO:t=!1}=a;this.buffer=new jj(b,c,d,e,f),this.createShaders(g,j),this.count=0,this.renderToFBO=t;const v=new bb(null,i*n,k*n),x=new rd(v);v.binding=x,x.framebuffer=kj(x.texture),this.texture=v,this.framebuffer=x.framebuffer}createShaders(a,b){const c=this.renderer.gl,d=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(d,a),c.compileShader(d);let e=!1,f=c.getShaderInfoLog(d);f.length>0&&(e=!0,console.error(f));const g=c.createShader(c.VERTEX_SHADER);c.shaderSource(g,b),c.compileShader(g),f=c.getShaderInfoLog(d),f.length>0&&(e=!0,console.error(f));if(e)return;const j=c.createProgram();c.attachShader(j,g),c.attachShader(j,d),c.linkProgram(j),c.useProgram(j),this.program=j;for(const i of Object.keys(this.attribs)){const k=c.getAttribLocation(j,i);c.enableVertexAttribArray(k),this.attribs[i]=k}for(const i of Object.keys(this.uniforms))this.uniforms[i]=c.getUniformLocation(j,i)}bind(a,b,c){if(!this.program)return!1;const d=this.renderer,e=d.gl,f=this.uniforms;return e.useProgram(this.program),e.uniformMatrix4fv(f.uProjectionMatrix,!1,a),e.uniformMatrix4fv(f.uCameraMatrix,!1,b),e.uniform1i(f.uTexture,d.textures.textureIndex[c]),e.uniform1f(f.uTime,performance.now()),e.uniform2f(f.uResolution,d.width,d.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}bindBuffers(a,b){const c=this.renderer.gl,d=this.buffer.vertexByteSize,e=this.attribs;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a),c.bindBuffer(c.ARRAY_BUFFER,b),c.vertexAttribPointer(e.aVertexPosition,2,c.FLOAT,!1,d,0),c.vertexAttribPointer(e.aTextureCoord,2,c.FLOAT,!1,d,8),c.vertexAttribPointer(e.aTextureId,1,c.FLOAT,!1,d,16),c.vertexAttribPointer(e.aTintColor,4,c.UNSIGNED_BYTE,!0,d,20),this.count=0}draw(a){const b=this.renderer,c=b.gl,d=this.buffer;if(a===d.batchSize)c.bufferData(c.ARRAY_BUFFER,d.data,c.DYNAMIC_DRAW);else{const e=d.vertexViewF32.subarray(0,a*d.quadElementSize);c.bufferSubData(c.ARRAY_BUFFER,0,e)}this.renderToFBO&&b.fbo.add(this.framebuffer,!0),c.drawElements(c.TRIANGLES,a*d.quadIndexSize,c.UNSIGNED_SHORT,0),this.renderToFBO&&b.fbo.pop()}flush(){const a=this.count;return a===0?!1:(this.draw(a),this.prevCount=a,this.count=0,!0)}}const On=`\r
#define SHADER_NAME MULTI_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture[%count%];\r
\r
void main (void)\r
{\r
    vec4 color;\r
\r
    %forloop%\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`;class ej extends qd{constructor(a={fragmentShader:On}){super(a)}createShaders(a,b){const c=xc();let d="";for(let e=1;e<c;e++)e>1&&(d+=`
	else `),e<c-1&&(d+=`if (vTextureId < ${e}.5)`),d+=`
	{`,d+=`
		color = texture2D(uTexture[${e}], vTextureCoord);`,d+=`
	}`;a=a.replace(/%count%/gi,`${c}`),a=a.replace(/%forloop%/gi,d),super.createShaders(a,b)}bind(a,b){if(!this.program)return!1;const c=this.renderer,d=c.gl,e=this.uniforms;return d.useProgram(this.program),d.uniformMatrix4fv(e.uProjectionMatrix,!1,a),d.uniformMatrix4fv(e.uCameraMatrix,!1,b),d.uniform1iv(e.uTexture,c.textures.textureIndex),d.uniform1f(e.uTime,performance.now()),d.uniform2f(e.uResolution,c.width,c.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}}function fj(a,b,c=-1,d=1){const e=-2*(1/-a),f=-2*(1/b),g=2*(1/(c-d));return new Float32Array([e,0,0,0,0,f,0,0,0,0,g,0,-1,1,0,1])}class gj{constructor(a,b){this.renderer=a;const c={shader:new b()};this.stack=[c],this.currentEntry=c,this.current=c.shader,this.singleQuadShader=new qd()}add(a,b){const c={shader:a,textureID:b};return this.stack.push(c),c}set(a,b){this.flush();const c=this.renderer,d=c.projectionMatrix,e=c.currentCamera.matrix,f=a.bind(d,e,b);if(f){const g=this.add(a,b);this.currentEntry=g,this.current=a}return f}setDefault(a){this.set(this.singleQuadShader,a)}pop(){this.flush();const a=this.stack;a.length>1&&a.pop(),this.currentEntry=a[a.length-1],this.current=this.currentEntry.shader}reset(){this.pop(),this.rebind()}flush(){return this.current.flush()?(this.renderer.flushTotal++,!0):!1}rebind(){const a=this.renderer,b=a.projectionMatrix,c=a.currentCamera.matrix,d=this.currentEntry;d.shader.bind(b,c,d.textureID)}popAndRebind(){this.pop(),this.rebind()}clear(){}destroy(){}}const Mn=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Nn(a){let b="";for(let c=0;c<a;++c)c>0&&(b+=`
else `),c<a-1&&(b+=`if(test == ${c}.0){}`);return b}function mj(a,b){const c=b.createShader(b.FRAGMENT_SHADER);for(;;){const d=Mn.replace(/%forloop%/gi,Nn(a));b.shaderSource(c,d),b.compileShader(c);if(!b.getShaderParameter(c,b.COMPILE_STATUS))a=a/2|0;else break}return a}class hj{constructor(a){this.startActiveTexture=0,this.renderer=a,this.tempTextures=[],this.textureIndex=[]}init(){const a=this.renderer.gl;let b=mj(a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),a);const c=xc();c===0||c>0&&c>b?hf(b):c>0&&c<b&&(b=Math.max(8,c));const d=this.tempTextures;d.length&&d.forEach(f=>{a.deleteTexture(f)});const e=[];for(let f=0;f<b;f++){const g=a.createTexture();a.activeTexture(a.TEXTURE0+f),a.bindTexture(a.TEXTURE_2D,g),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),d[f]=g,e.push(f)}this.maxTextures=b,this.textureIndex=e,this.currentActiveTexture=1}update(){const a=ec.get();for(let b=0;b<a.length;b++){const c=a[b];c.binding||(c.binding=new rd(c))}ec.clear()}reset(){const a=this.renderer.gl,b=this.tempTextures;for(let c=0;c<b.length;c++)a.activeTexture(a.TEXTURE0+c),a.bindTexture(a.TEXTURE_2D,b[c]);this.currentActiveTexture=1,this.startActiveTexture++}bind(a,b=0){const c=this.renderer.gl,d=a.binding;d.setIndex(b),c.activeTexture(c.TEXTURE0+b),c.bindTexture(c.TEXTURE_2D,d.texture)}unbind(a=0){const b=this.renderer.gl;b.activeTexture(b.TEXTURE0+a),b.bindTexture(b.TEXTURE_2D,this.tempTextures[a]),a>0&&this.startActiveTexture++}request(a){const b=this.renderer.gl,c=a.binding,d=this.currentActiveTexture;return c.indexCounter>=this.startActiveTexture?!1:(c.indexCounter=this.startActiveTexture,d<this.maxTextures?(c.setIndex(d),b.activeTexture(b.TEXTURE0+d),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture++):(this.renderer.flush(),this.startActiveTexture++,c.indexCounter=this.startActiveTexture,c.setIndex(1),b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture=2),!0)}}class Gi{constructor(){this.clearColor=[0,0,0,1],this.flushTotal=0,this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.currentCamera=null,this.width=ac(),this.height=bc(),this.resolution=cc(),this.setBackgroundColor(fd());const a=document.createElement("canvas");a.addEventListener("webglcontextlost",b=>this.onContextLost(b),!1),a.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=a,this.fbo=new cj(this),this.textures=new hj(this),this.initContext(),Dc.set(this),this.shaders=new gj(this,ej)}initContext(){const a=this.canvas.getContext("webgl",kf());Ba.set(a),this.gl=a,a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE),this.resize(this.width,this.height,this.resolution),this.textures.init()}resize(a,b,c=1){this.width=a*c,this.height=b*c,this.resolution=c;const d=this.canvas;d.width=this.width,d.height=this.height,this.autoResize&&(d.style.width=(this.width/c).toString()+"px",d.style.height=(this.height/c).toString()+"px"),this.gl.viewport(0,0,this.width,this.height),this.projectionMatrix=fj(a,b)}onContextLost(a){a.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(a){return dj(a,this.clearColor),this}reset(a=null,b=this.width,c=this.height){const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),d.viewport(0,0,b,c),d.enable(d.BLEND),d.blendFunc(d.ONE,d.ONE_MINUS_SRC_ALPHA),this.flushTotal=0,this.currentCamera=null,this.textures.update()}render(a){if(this.contextLost)return;this.reset();if(this.optimizeRedraw&&a.numDirtyFrames===0&&a.numDirtyCameras===0)return;const b=this.gl;if(this.clearBeforeRender){const d=this.clearColor;b.clearColor(d[0],d[1],d[2],d[3]),b.clear(b.COLOR_BUFFER_BIT)}const c=a.worldData;for(let d=0;d<c.length;d++){const{camera:e,renderList:f}=c[d];(!this.currentCamera||!_i(e.worldTransform,this.currentCamera.worldTransform))&&(this.flush(),this.currentCamera=e,this.shaders.rebind()),f.forEach(g=>{g.children.length?this.renderNode(g):g.node.renderGL(this)})}this.flush()}renderNode(a){a.node.renderGL(this),a.children.forEach(b=>{b.children.length>0?this.renderNode(b):b.node.renderGL(this)}),a.node.postRenderGL(this)}flush(){this.shaders.flush()}destroy(){Dc.set(void 0)}}function Ze(){return()=>{gd(Gi)}}function ya(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);for(const e of d)e.callback.apply(e.context,c),e.once&&d.delete(e);return d.size===0&&a.events.delete(b),!0}function oi(a,b){const c=hd(b);return c.appendChild(a),a}function pi(a){const b=document.readyState;if(b==="complete"||b==="interactive"){a();return}const c=()=>{document.removeEventListener("deviceready",c,!0),document.removeEventListener("DOMContentLoaded",c,!0),window.removeEventListener("load",c,!0),a()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",c,!0):(document.addEventListener("DOMContentLoaded",c,!0),window.addEventListener("load",c,!0)):window.setTimeout(c,20)}class df{constructor(){this.events=new Map()}}class Ac{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function Ma(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new Ac(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function Ib(a,b,c,d=a){return Ma(a,b,c,d,!0)}function qj(){return{gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]}}function tj(a,b=0){a.gameFrame=b,a.numTotalFrames=0,a.numDirtyFrames=0,a.numDirtyCameras=0,a.worldData.length=0}let uj;const td={get:()=>uj,set:a=>{uj=a}};class qi{constructor(){this.scenes=new Map(),this.sceneIndex=0,this.flush=!1,this.renderResult=qj(),this.game=xa.get(),td.set(this),Ib(this.game,"boot",()=>this.boot())}boot(){jf().forEach(a=>new a())}update(a,b){for(const c of this.scenes.values())ya(c,"update",a,b)}render(a){const b=this.renderResult;tj(b,a);for(const c of this.scenes.values())ya(c,"render",b);return this.flush&&(b.numDirtyFrames++,this.flush=!1),b}}function Fc(a,b){const c=document.createElement("canvas");return c.width=a,c.height=b,c.getContext("2d")}let vj;const Fa={get:()=>vj,set:a=>{vj=a}};class ri{constructor(){this.textures=new Map(),this.createDefaultTextures(),Fa.set(this)}createDefaultTextures(){this.add("__BLANK",new bb(Fc(32,32).canvas));const a=Fc(32,32);a.strokeStyle="#0f0",a.moveTo(0,0),a.lineTo(32,32),a.stroke(),a.strokeRect(.5,.5,31,31),this.add("__MISSING",new bb(a.canvas))}get(a){const b=this.textures;return b.has(a)?b.get(a):b.get("__MISSING")}has(a){return this.textures.has(a)}add(a,b){let c;const d=this.textures;return d.has(a)||(b instanceof bb?c=b:c=new bb(b),c.key=a,d.set(a,c)),c}}class gi extends df{constructor(...a){super();this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,xa.set(this),pi(()=>this.boot(a))}boot(a){a.forEach(d=>d());const b=bf();this.renderer=new b(),this.textureManager=new ri(),this.sceneManager=new qi();const c=cf();c&&oi(this.renderer.canvas,c),this.isBooted=!0,af(),ya(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(a){const b=a-this.lastTick;this.lastTick=a,this.elapsed+=b,this.isPaused||(this.willUpdate&&(this.sceneManager.update(b,a),ya(this,"update",b,a)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,xa.setFrame(this.frame),xa.setElapsed(this.elapsed),requestAnimationFrame(c=>this.step(c))}destroy(){}}function rj(a,b,c){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:c}function sj(a,b={}){const c=td.get(),d=c.scenes.size,e=c.sceneIndex,f=d===0;typeof b==="string"?a.key=b:(b||!b&&f)&&(a.key=rj(b,"key","scene"+e.toString())),c.scenes.has(a.key)?console.warn("Scene key already in use: "+a.key):(c.scenes.set(a.key,a),c.flush=!0,c.sceneIndex++)}class cd{constructor(a){this.game=xa.get(),this.events=new Map(),sj(this,a)}}class Fb{constructor(a=1,b=0,c=0,d=1,e=0,f=0){this.set(a,b,c,d,e,f)}set(a=1,b=0,c=0,d=1,e=0,f=0){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=e,this.ty=f,this}identity(){return this.set()}toArray(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]}fromArray(a){return this.set(a[0],a[1],a[2],a[3],a[4],a[5])}}function nd(a,b,c){return a.width<=0||a.height<=0?!1:a.x<=b&&a.x+a.width>=b&&a.y<=c&&a.y+a.height>=c}class Ja{constructor(a=0,b=0,c=0,d=0){this.set(a,b,c,d)}set(a=0,b=0,c=0,d=0){return this.x=a,this.y=b,this.width=c,this.height=d,this}contains(a,b){return nd(this,a,b)}set right(a){a<=this.x?this.width=0:this.width=a-this.x}get right(){return this.x+this.width}set bottom(a){a<=this.y?this.height=0:this.height=a-this.y}get bottom(){return this.y+this.height}}function aj(){}class kb{constructor(a,b=0,c=0,d=!1){this.compareValue=!1,this._x=b,this._y=c,this.callback=a,this.compareValue=d}set(a=0,b=0){return this._x=a,this._y=b,this.callback(this),this}destroy(){this.callback=aj}set x(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._x=a,this.callback(this))}get x(){return this._x}set y(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._y=a,this.callback(this))}get y(){return this._y}}function Zi(a,b,c){const d=c-b;return b+((a-b)%d+d)%d}function vi(a){return Zi(a,-Math.PI,Math.PI)}class wi{constructor(){this._rotation=0,this.type="Camera",this.dirtyRender=!0;const a=xa.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1]),this.bounds=new Ja(),this.worldTransform=new Fb(),this.position=new kb(()=>this.updateTransform(),0,0),this.scale=new kb(()=>this.updateTransform(),1,1),this.origin=new kb(()=>this.updateTransform(),.5,.5),this.reset()}updateTransform(){const a=this.matrix,b=this.position.x,c=this.position.y,d=this.scale.x,e=this.scale.y,f=-b+this.width*this.origin.x,g=-c+this.height*this.origin.y,j=Math.sin(this.rotation),i=Math.cos(this.rotation),k=j+j,n=j*k,t=i*k,v=(1-n)*d,x=t*d,C=-t*e,F=(1-n)*e;a[0]=v,a[1]=x,a[4]=C,a[5]=F,a[12]=b+f-(v*f+C*g),a[13]=c+g-(x*f+F*g),this.worldTransform.set(i*d,j*d,-j*e,i*e,-b,-c);const H=this.width*(1/d),Q=this.height*(1/e);this.bounds.set(f-H/2,g-Q/2,H,Q),this.dirtyRender=!0}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}set rotation(a){a!==this._rotation&&(this._rotation=vi(a),this.updateTransform())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.origin.destroy(),this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}class xi{constructor(){this.type="StaticCamera",this.dirtyRender=!0;const a=xa.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.bounds=new Ja(),this.worldTransform=new Fb(),this.reset()}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}function Hb(a){const b=[a],c=[];for(;b.length>0;){const d=b.shift();c.push(d);const e=d.numChildren;if(e>0)for(let f=e-1;f>=0;f--)b.unshift(d.children[f])}return c.shift(),c}function lb(a,b){return a.children.indexOf(b)}function id(a,b){const c=a.children;let d;if(b>=0&&b<c.length){const e=c.splice(b,1);e[0]&&(d=e[0],d.parent=null)}return d}function zc(a,b){const c=lb(a,b);return c>-1&&id(a,c),b}const pf="addedtoworld";const jd="destroy";const Ni="postupdate";const qf="removedfromworld";const Oi="update";function of(a,...b){return b.forEach(c=>{c.world&&(ya(c.world,qf,c,c.world),ya(c,qf,c,c.world)),c.world=a,ya(a,pf,c,a),ya(c,pf,c,a)}),b}function Gb(a,...b){b.forEach(d=>{d.parent&&zc(d.parent,d),d.parent=a});const c=a.world;return c&&of(c,...Hb(a)),b}const aa={CLEAR:0,TRANSFORM:1,UPDATE:2,CHILD_CACHE:4,POST_RENDER:8,COLORS:16,BOUNDS:32,TEXTURE:64,FRAME:128,ALPHA:256,CHILD:512,DEFAULT:1+2+16+32,USER1:536870912,USER2:1073741824,USER3:2147483648,USER4:4294967296};function yc(a,b=0,c){const d=a.children;c===void 0&&(c=d.length);const e=c-b;if(e>0&&e<=c){const f=d.splice(b,e);return f.forEach(g=>{g.parent=null}),f}else return[]}function lf(a,b=0,c){const d=yc(a,b,c);d.forEach(e=>{e.destroy()})}function mf(a,...b){return b.forEach(c=>{zc(a,c)}),b}function nf(a,b,c=0,d){const e=yc(a,c,d);return Gb(b,...e),e.forEach(f=>{f.transform.updateWorld()}),e}function mb(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof Ac)g.delete(c);else{const j=!d,i=e!==void 0;for(const k of g)k.callback===c&&(j&&k.context===d)&&(i&&k.once===e)&&g.delete(k)}return g.size===0&&f.delete(b),a}function kd(a){const{a:b,b:c,c:d,d:e,tx:f,ty:g}=a.world,{x:j,y:i,right:k,bottom:n}=a.extent,t=j*b+i*d+f,v=j*c+i*e+g,x=j*b+n*d+f,C=j*c+n*e+g,F=k*b+n*d+f,H=k*c+n*e+g,Q=k*b+i*d+f,L=k*c+i*e+g;return{x0:t,y0:v,x1:x,y1:C,x2:F,y2:H,x3:Q,y3:L}}class Hi{constructor(a){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=a,this.area=new Ja()}set(a,b,c,d){this.area.set(a,b,c,d)}get(){return this.entity.isDirty(aa.BOUNDS)&&!this.fixed&&this.update(),this.area}updateLocal(){const{x0:a,y0:b,x1:c,y1:d,x2:e,y2:f,x3:g,y3:j}=kd(this.entity.transform),i=Math.min(a,c,e,g),k=Math.min(b,d,f,j),n=Math.max(a,c,e,g),t=Math.max(b,d,f,j);return this.area.set(i,k,n-i,t-k)}update(){const a=this.updateLocal();this.entity.clearDirty(aa.BOUNDS);if(!this.includeChildren||!this.entity.numChildren)return a;const b=this.visibleOnly,c=this.entity.children;let d=a.x,e=a.y,f=a.right,g=a.bottom;for(let j=0;j<c.length;j++){const i=c[j];if(!i||b&&!i.visible)continue;const k=i.bounds.get();k.x<d&&(d=k.x),k.y<e&&(e=k.y),k.right>f&&(f=k.right),k.bottom>g&&(g=k.bottom)}return a.set(d,e,f-d,g-e)}destroy(){this.entity=null,this.area=null}}class Ii{constructor(a){this.enabled=!1,this.enabledChildren=!0,this.entity=a}destroy(){this.entity=null,this.hitArea=null}}class ab{constructor(a=0,b=0){this.set(a,b)}set(a=0,b=0){return this.x=a,this.y=b,this}getArray(){return[this.x,this.y]}fromArray(a){return this.set(a[0],a[1])}toString(){return`[x=${this.x}, y=${this.y}]`}}function Ki(a){const b=a.local,c=a.position.x,d=a.position.y,e=a.rotation,f=a.scale.x,g=a.scale.y,j=a.skew.x,i=a.skew.y;b.set(Math.cos(e+i)*f,Math.sin(e+i)*f,-Math.sin(e-j)*g,Math.cos(e-j)*g,c,d)}function rf(a,b){return b.set(a.a,a.b,a.c,a.d,a.tx,a.ty)}function Li(a){const b=a.parent,c=a.transform,d=c.local,e=c.world;if(!b)rf(d,e);else if(c.passthru)rf(b.transform.world,e);else{const{a:f,b:g,c:j,d:i,tx:k,ty:n}=d,{a:t,b:v,c:x,d:C,tx:F,ty:H}=b.transform.world;e.set(f*t+g*x,f*v+g*C,j*t+i*x,j*v+i*C,k*t+n*x+F,k*v+n*C+H)}}class Ji{constructor(a,b=0,c=0){this.passthru=!1,this._rotation=0,this.entity=a,this.local=new Fb(),this.world=new Fb(),this.position=new kb(()=>this.update(),b,c),this.scale=new kb(()=>this.update(),1,1,!0),this.skew=new kb(()=>this.update(),0,0,!0),this.origin=new kb(()=>this.updateExtent(),ff,gf),this.extent=new Ja()}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(aa.TRANSFORM,aa.BOUNDS),Ki(this)}updateWorld(){const a=this.entity;a.setDirty(aa.TRANSFORM,aa.BOUNDS),Li(a),a.numChildren&&this.updateChildren()}updateChildren(){const a=this.entity.children;for(let b=0;b<a.length;b++){const c=a[b];c.transform.updateWorld()}}globalToLocal(a,b,c=new ab()){const{a:d,b:e,c:f,d:g,tx:j,ty:i}=this.world,k=1/(d*g+f*-e);return c.x=g*k*a+-f*k*b+(i*f-j*g)*k,c.y=d*k*b+-e*k*a+(-i*d+j*e)*k,c}localToGlobal(a,b,c=new ab()){const{a:d,b:e,c:f,d:g,tx:j,ty:i}=this.world;return c.x=d*a+f*b+j,c.y=e*a+g*b+i,c}setExtent(a,b,c,d){this.extent.set(a,b,c,d),this.entity.setDirty(aa.TRANSFORM,aa.BOUNDS)}updateExtent(a,b){const c=this.extent,d=this.entity;a!==void 0&&(c.width=a),b!==void 0&&(c.height=b),c.x=-this.origin.x*c.width,c.y=-this.origin.y*c.height,d.setDirty(aa.TRANSFORM,aa.BOUNDS)}set rotation(a){a!==this._rotation&&(this._rotation=a,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}}class dc{constructor(a=0,b=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.events=new Map(),this.transform=new Ji(this,a,b),this.bounds=new Hi(this),this.input=new Ii(this),this.dirty=aa.DEFAULT,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(a){return(this.dirty&a)!==0}clearDirty(a){return this.isDirty(a)&&(this.dirty^=a),this}setDirty(a,b){return this.isDirty(a)||(this.dirty^=a,this.dirtyFrame=xa.getFrame()),this.isDirty(b)||(this.dirty^=b),this}update(a,b){if(this.willUpdateChildren){const c=this.children;for(let d=0;d<c.length;d++){const e=c[d];e&&e.willUpdate&&e.update(a,b)}}this.postUpdate(a,b)}postUpdate(a,b){}renderGL(a){}renderCanvas(a){}postRenderGL(a){}postRenderCanvas(a){}get numChildren(){return this.children.length}destroy(a){a?nf(this,a):lf(this),ya(this,jd,this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}}const od="worldrender";const pd="worldshutdown";var Ln=Object.freeze({__proto__:null,WorldRenderEvent:od,WorldShutdownEvent:pd});function ud(a,b){b.numRendered++,b.numRenderable++,a.node.dirtyFrame>=b.gameFrame&&b.dirtyFrame++,a.children.forEach(c=>{c.children.length>0&&ud(c,b)})}function zf(a){if(a.node.isDirty(aa.CHILD_CACHE))return!0;const b=[a];for(;b.length>0;){const c=b.pop();if(c.node.isDirty(aa.TRANSFORM))return!0;const d=c.children.length;if(d>0)for(let e=0;e<d;e++)b.push(c.children[e])}return b.length=0,!1}function yf(a,b){a.forEach(c=>{b||zf(c)?c.node.setDirty(aa.CHILD_CACHE):c.children.length=0})}function vd(a,b,c=[]){for(let d=0;d<b.numChildren;d++){const e=b.children[d];if(e.isRenderable()){const f=[],g={node:e,children:f};c.push(g),e.willRenderChildren&&e.numChildren>0&&(e.willCacheChildren&&a.push(g),vd(a,e,f))}}return c}function wf(a){const b=[],c=[],d=vd(b,a,c),e=a.renderData;b.length>0&&yf(b,a.camera.dirtyRender),d.forEach(f=>{f.children.length?ud(f,e):(e.numRendered++,e.numRenderable++,f.node.dirtyFrame>=e.gameFrame&&e.dirtyFrame++)}),e.renderList=d,a.forceRefresh&&(e.dirtyFrame++,a.forceRefresh=!1)}function xf(a,b){a.numDirtyFrames+=b.dirtyFrame,a.numTotalFrames+=b.numRendered,b.camera.dirtyRender&&a.numDirtyCameras++,a.worldData.push(b)}function Gc(a,b){a.gameFrame=b,a.dirtyFrame=0,a.numRendered=0,a.numRenderable=0,a.renderList.length=0}class Jb extends dc{constructor(a){super();this.forceRefresh=!1,this.type="BaseWorld",this.scene=a,this.world=this,this.events=new Map(),this._updateListener=Ma(a,"update",(b,c)=>this.update(b,c)),this._renderListener=Ma(a,"render",b=>this.render(b)),this._shutdownListener=Ma(a,"shutdown",()=>this.shutdown()),Ib(a,"destroy",()=>this.destroy())}update(a,b){if(!this.willUpdate)return;ya(this,Oi,a,b,this),super.update(a,b)}postUpdate(a,b){ya(this,Ni,a,b,this)}render(a){const b=this.renderData;Gc(b,a.gameFrame);if(!this.willRender||!this.visible)return;wf(this),ya(this,od,b,this),xf(a,b),this.camera&&(this.camera.dirtyRender=!1)}shutdown(){const a=this.scene;mb(a,"update",this._updateListener),mb(a,"render",this._renderListener),mb(a,"shutdown",this._shutdownListener),mf(this),ya(this,pd,this),Gc(this.renderData,0),this.camera&&this.camera.reset()}destroy(a){super.destroy(a),ya(this,jd,this),Gc(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}}function Hc(a){return{camera:a,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0,renderList:[]}}class _e extends Jb{constructor(a){super(a);this.type="StaticWorld",this.camera=new xi(),this.renderData=Hc(this.camera)}}class Pn extends Jb{constructor(a){super(a);this.enableCameraCull=!0,this.type="World",this.camera=new wi(),this.renderData=Hc(this.camera)}}function dd(a,b){return a.children.push(b),Gb(a,b),b.transform.updateWorld(),b}class Wi{constructor(a,b,c){this.responseType="text",this.crossOrigin=void 0,this.skipCache=!1,this.hasLoaded=!1,this.key=a,this.url=b,this.config=c}}function Xi(a,b,c,d){return b||(b=a+c),/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/.exec(b)?b:d?d.baseURL+d.path+b:b}function Yi(a){return a.data=new Image(),a.crossOrigin&&(a.data.crossOrigin=a.crossOrigin),new Promise((b,c)=>{a.data.onload=()=>{a.data.onload&&(a.data.onload=null,a.data.onerror=null,b(a))},a.data.onerror=d=>{a.data.onload&&(a.data.onload=null,a.data.onerror=null,a.error=d,c(a))},a.data.src=a.url,a.data.complete&&a.data.width&&a.data.height&&(a.data.onload=null,a.data.onerror=null,b(a))})}function hi(a,b){const c=new Wi(a,b);return c.load=()=>(c.url=Xi(c.key,c.url,".png",c.loader),c.loader&&(c.crossOrigin=c.loader.crossOrigin),new Promise((d,e)=>{const f=Fa.get();f.has(c.key)?d(c):Yi(c).then(g=>{f.add(g.key,g.data),d(g)}).catch(g=>{e(g)})})),c}var Xh;(function(a){a[a.IDLE=0]="IDLE",a[a.UPDATING=1]="UPDATING"})(Xh||(Xh={}));function fc(a=32,b=32){const c=Fc(a,b);return new bb(c.canvas)}function Qi(a,b){const c=a.texture,d=b.shaders.current,e=d.buffer,f=c.binding;d.count===e.batchSize&&b.flush();const g=a.vertexData;b.textures.request(c);const j=f.index;g[4]=j,g[10]=j,g[16]=j,g[22]=j;const i=d.count*e.quadElementSize;e.vertexViewF32.set(g,i);const k=a.vertexColor,n=e.vertexViewU32;n[i+5]=k[0],n[i+11]=k[2],n[i+17]=k[3],n[i+23]=k[1],d.count++}class Mi extends dc{constructor(a=0,b=0){super(a,b);this._alpha=1,this.type="Container"}setSize(a,b=a){return this.transform.updateExtent(a,b),this}setPosition(a,b){return this.transform.position.set(a,b),this}setOrigin(a,b=a){return this.transform.origin.set(a,b),this}setSkew(a,b=a){return this.transform.skew.set(a,b),this}setScale(a,b=a){return this.transform.scale.set(a,b),this}setRotation(a){return this.transform.rotation=a,this}set width(a){this.transform.updateExtent(a)}get width(){return this.transform.extent.width}set height(a){this.transform.updateExtent(void 0,a)}get height(){return this.transform.extent.height}set x(a){this.transform.position.x=a}get x(){return this.transform.position.x}set y(a){this.transform.position.y=a}get y(){return this.transform.position.y}set originX(a){this.transform.origin.x=a}get originX(){return this.transform.origin.x}set originY(a){this.transform.origin.y=a}get originY(){return this.transform.origin.y}set skewX(a){this.transform.skew.x=a}get skewX(){return this.transform.skew.x}set skewY(a){this.transform.skew.y=a}get skewY(){return this.transform.skew.y}set scaleX(a){this.transform.scale.x=a}get scaleX(){return this.transform.scale.x}set scaleY(a){this.transform.scale.y=a}get scaleY(){return this.transform.scale.y}set rotation(a){this.transform.rotation=a}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(a){a!==this._alpha&&(this._alpha=a,this.setDirty(aa.TRANSFORM))}}function Ri(a,b){const c=a.frame;if(!c)return;const d=b.ctx,e=a.transform,{a:f,b:g,c:j,d:i,tx:k,ty:n}=e.world,{x:t,y:v}=e.extent;d.save(),d.setTransform(f,g,j,i,k,n),d.globalAlpha=a.alpha,d.drawImage(c.texture.image,c.x,c.y,c.width,c.height,t,v,c.width,c.height),d.restore()}function Ec(a,b){const c=(b*255|0)&255;return(c<<24|a)>>>0}function Si(a){const b=a.vertexAlpha,c=a.vertexTint,d=a.vertexColor;return d[0]=Ec(c[0],b[0]),d[1]=Ec(c[1],b[1]),d[2]=Ec(c[2],b[2]),d[3]=Ec(c[3],b[3]),a}function ld(a,b,...c){const d=a.getFrame(b),{u0:e,u1:f,v0:g,v1:j,pivot:i}=d;return c.forEach(k=>{if(!k||d===k.frame)return;k.frame=d,i&&k.setOrigin(i.x,i.y),k.frame.setExtent(k),k.hasTexture=!0;const n=k.vertexData;n[2]=e,n[3]=g,n[8]=e,n[9]=j,n[14]=f,n[15]=j,n[20]=f,n[21]=g}),c}function Pi(a,b,...c){if(!a)c.forEach(d=>{d.texture=null,d.frame=null,d.hasTexture=!1});else{let d;a instanceof bb?d=a:d=Fa.get().get(a),d?(c.forEach(e=>{e.texture=d}),ld(d,b,...c)):console.warn(`Invalid Texture key: ${a}`)}return c}function Ti(a){const b=a.vertexData,{x0:c,y0:d,x1:e,y1:f,x2:g,y2:j,x3:i,y3:k}=kd(a.transform);return b[0]=c,b[1]=d,b[6]=e,b[7]=f,b[12]=g,b[13]=j,b[18]=i,b[19]=k,a}class md extends Mi{constructor(a,b,c,d){super(a,b);this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertexData=new Float32Array(24).fill(0),this.vertexColor=new Uint32Array(4).fill(4294967295),this.vertexAlpha=new Float32Array(4).fill(1),this.vertexTint=new Uint32Array(4).fill(16777215),this.setTexture(c,d)}setTexture(a,b){return Pi(a,b,this),this}setFrame(a){return ld(this.texture,a,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}preRender(){this.isDirty(aa.COLORS)&&(Si(this),this.clearDirty(aa.COLORS)),this.isDirty(aa.TRANSFORM)&&(Ti(this),this.clearDirty(aa.TRANSFORM))}renderGL(a){this.preRender(),Qi(this,a)}renderCanvas(a){this.preRender(),Ri(this,a)}get alpha(){return this._alpha}set alpha(a){if(a!==this._alpha){this._alpha=a;const b=this.vertexAlpha;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(aa.ALPHA)}}get tint(){return this._tint}set tint(a){if(a!==this._tint){this._tint=a;const b=this.vertexTint;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(aa.COLORS)}}destroy(a){super.destroy(a),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertexData=null,this.vertexColor=null,this.vertexAlpha=null,this.vertexTint=null}}var Da;(function(a){a[a.none=0]="none",a[a.word=1]="word",a[a.char=2]="char"})(Da||(Da={}));var wa;(function(a){a[a.none=0]="none",a[a.raw=1]="raw",a[a.wrapped=2]="wrapped"})(wa||(wa={}));const Gh=/(?:\r\n|\r|\n)/;function Hm(a,b,c,d,e,f=0){e<=0&&(d=0);let g=[];if(!a||!a.length)return g;let j=a.split(Gh),i=j.length-1;a.slice(-1)===`
`&&(j.length-=1);let k;for(let n=0,t=j.length;n<t;n++){let v=j[n],x=n===i?0:1;if(d===0){g.push(bd(v,b(v,c),x));continue}n===0?k=e-f:k=e;if(v.length<=100){let L=b(v,c);if(L<=k){g.push(bd(v,L,x));continue}}let C;d===1?C=v.split(" "):C=v;let F="",H="",Q=0;for(let L=0,R=C.length;L<R;L++){let I=C[L];d===1?(F+=I,L<R-1&&(F+=" ")):F+=I;let V=b(F,c);V>k&&(L===0?g.push(bd("",0,2)):(g.push(bd(H,Q,2)),F=I,d===1&&(L<R-1&&(F+=" ")),V=b(F,c)),k=e),H=F,Q=V}g.push(bd(H,Q,x))}return g}let bd=function(a,b,c){return{text:a,width:b,newLineMode:c}};var Ta;(function(a){a[a.left=0]="left",a[a.center=1]="center",a[a.right=2]="right"})(Ta||(Ta={}));var Ua;(function(a){a[a.top=0]="top",a[a.center=1]="center",a[a.bottom=2]="bottom"})(Ua||(Ua={}));var Ea;(function(a){a[a.LEFT_TOP=0]="LEFT_TOP",a[a.TOP_LEFT=0]="TOP_LEFT",a[a.CENTER_TOP=1]="CENTER_TOP",a[a.TOP_CENTER=1]="TOP_CENTER",a[a.RIGHT_TOP=2]="RIGHT_TOP",a[a.TOP_RIGHT=2]="TOP_RIGHT",a[a.LEFT_CENTER=3]="LEFT_CENTER",a[a.CENTER_LEFT=3]="CENTER_LEFT",a[a.CENTER=4]="CENTER",a[a.CENTER_CENTER=4]="CENTER_CENTER",a[a.RIGHT_CENTER=5]="RIGHT_CENTER",a[a.CENTER_RIGHT=5]="CENTER_RIGHT",a[a.LEFT_BOTTOM=6]="LEFT_BOTTOM",a[a.BOTTOM_LEFT=6]="BOTTOM_LEFT",a[a.CENTER_BOTTOM=7]="CENTER_BOTTOM",a[a.BOTTOM_CENTER=7]="BOTTOM_CENTER",a[a.RIGHT_BOTTOM=8]="RIGHT_BOTTOM",a[a.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(Ea||(Ea={}));class Yb{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(a){return this.items.push(a),this}pushMultiple(a){return this.items.push.apply(this.items,a),a.length=0,this}clear(){return this.items.length=0,this}}class Jh{constructor(){this.pens=[]}destroy(){this.pens.length=0}addPen(a){return this.pens.push(a),this}get firstPen(){return this.pens[0]}get lastPen(){return this.pens[this.pens.length-1]}hasPen(){return this.pens.length>0}get pensCount(){return this.pens.length}get startIndex(){let a=this.pens[0];return a?a.startIndex:0}get width(){let a=this.lastPen;return a?a.lastX:0}}function Se(a){if(Array.isArray(a))a.length=0;else for(let b in a)delete a[b]}function Zb(a,b=Array.isArray(a)?[]:{}){Se(b);if(Array.isArray(a)){b.length=a.length;for(let c=0,d=a.length;c<d;c++)b[c]=a[c]}else for(let c in a)b[c]=a[c];return b}class Kh{constructor(){this.text="";this.x=0;this.y=0;this.width=0;this.height=0;this.ascent=0;this.descent=0;this.prop={};this.newLineMode=wa.none;this.startIndex=0}set(a="",b=0,c=0,d=0,e=0,f=0,g=0,j={},i=wa.none,k=0){return this.text=a,this.x=b,this.y=c,this.width=d,this.height=e,this.ascent=f,this.descent=g,this.prop=j,this.newLineMode=i,this.startIndex=k,this}clone(){let a=new Kh();return a.set(this.text,this.x,this.y,this.width,this.height,this.ascent,this.descent,Zb(this.prop),this.newLineMode,this.startIndex),a}get plainText(){return this.newLineMode===wa.raw?`${this.text}
`:this.text}get wrapText(){return this.newLineMode!==wa.none?`${this.text}
`:this.text}get plainTextLength(){let a=this.text.length;return this.newLineMode===wa.raw&&(a+=1),a}get endIndex(){return this.startIndex+this.plainTextLength}get lastX(){return this.x+this.width}get isTextPen(){return this.text!==""}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}}class _c{constructor({penPool:a}){this.pens=[];this.lines=[];this.pens=[],this.lines=[],this.penPool=a}destroy(){this.freePens()}freePens(){return this.penPool.pushMultiple(this.pens),this.lines.forEach(a=>{a.destroy()}),this.lines.length=0,this.maxLineWidth=0,this.totalLineHeight=0,this}addTextPen(a,b,c,d,e,f,g,j,i=wa.none){let k=this.penPool.pop();return k==null&&(k=new Kh()),k.set(a,b,c,d,e,f,g,j,i),this.addPen(k),this}addImagePen(a,b,c,d,e){return this.addTextPen("",a,b,c,d,d,0,e,wa.none),this}addNewLinePen(a){let b=this.lastPen;return b&&b.newLineMode===wa.none&&(b.newLineMode=a),this}addPen(a){let b=this.lastPen;b==null?a.startIndex=0:a.startIndex=b.endIndex,this.pens.push(a);let c=this.lastLine;return c==null&&(c=new Jh(),this.lines.push(c)),c.addPen(a),a.newLineMode!==wa.none&&(c=new Jh(),this.lines.push(c)),this}clone(a){a==null&&(a=new _c({penPool:this.penPool})),a.freePens();const b=this.pens;for(let e=0,f=b.length;e<f;e++)a.addPen(b[e].clone());const c=this.lines,d=a.lines;for(let e=0,f=c.length;e<f;e++){const g=c[e],j=d[e];j.y=g.y,j.height=g.height}return a}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(a){if(a>=this.lines.length)return this.getLineEndIndex(a);{let b=this.lines[a];if(!b)return 0;let c=b.firstPen;return c?c.startIndex:0}}getLineEndIndex(a){let b=this.lines.length;a>=b&&(a=b-1);for(let c=a;c>=0;c--){let d=this.lines[c];if(d&&d.hasPen())return d.lastPen.endIndex}return 0}getLineWidth(a){let b=this.lines[a];return b?b.width:0}getLineHeights(a=[]){return this.lines.forEach(function(b){a.push(b.height)}),a}get lineCount(){return this.lines.length}get plainText(){let a=[],b=this.pens;for(let c=0,d=b.length;c<d;c++)a.push(b[c].plainText);return a.join()}get plainTextLength(){let a=0;for(let b=0,c=this.pens.length;b<c;b++)a+=this.pens[b].plainTextLength;return a}getSliceTagText(a,b,c=0,d,e=!1){if(d===void 0){let k=this.lastPen;if(!k)return"";d=k.endIndex}let f=[],g;for(var j=0,i=this.pens.length;j<i;j++){let k=this.pens[j],n=k.endIndex;if(n<=c)continue;let t=e?k.wrapText:k.plainText,v=k.prop,x=k.startIndex,C=x>=c&&n<=d;C||(t=t.substring(c-x,d-x)),b?f.push(a.call(b,t,v,g)):f.push(a(t,v,g)),g=v;if(n>=d)break}return f.join()}}function Em(a,b,c){let d=Zb(a,c);for(let e in b)d.hasOwnProperty(e)&&(d[e]=b[e]);return d}function Ge(a,b,c={key:b}){c=Em(Bp,c);let d=Fa.get(),e=d.get(c.key);if(!e)return;let f=e.getFrame(c.frame);if(!f)return;let g=c.width,j=c.height;(g===void 0||j===void 0)&&(g===void 0&&j===void 0?(c.width=f.width,c.height=f.height):g===void 0?c.width=f.width*(j/f.height):j===void 0&&(c.height=f.height*(g/f.width))),a.images.set(b,c)}const Bp={key:void 0,frame:void 0,width:void 0,height:void 0,y:0,left:0,right:0,top:0,bottom:0};class Am{constructor(){this.images=new Map()}destroy(){this.images.clear()}add(a,b){if(typeof a==="string")Ge(this,a,b);else if(Array.isArray(a)){let c=a;for(let d=0,e=c.length;d<e;d++)Ge(this,c[d])}else{let c=a;for(a in c)Ge(this,a,c[a])}return this}remove(a){return this.images.delete(a),this}get(a){return this.images.get(a)}getOuterWidth(a){let b=this.images.get(a);return b?b.width+b.left+b.right:0}getOuterHeight(a){let b=this.images.get(a);return b?b.height+b.top+b.bottom:0}getFrame(a){let b=this.images.get(a);if(!b)return;let c=Fa.get(),d=c.get(b.key);if(!d)return;let e=d.getFrame(b.frame);return e}hasTexture(a){return!!this.getFrame(a)}}function Ee(a,b){a.font=b.font}function Fe(a,b){a.textBaseline="alphabetic",a.textAlign="start",a.fillStyle=b.fillStyle,a.strokeStyle=b.strokeStyle,a.lineWidth=b.strokeThickness,a.lineCap="round",a.lineJoin="round",a.imageSmoothingEnabled=b.antialias}function Hh(a,b,c){c?(a.shadowColor=b.shadowColor,a.shadowBlur=b.shadowBlur,a.shadowOffsetX=b.shadowOffsetX,a.shadowOffsetY=b.shadowOffsetY):(a.shadowColor="#000",a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0)}function Fm(a,b){return b.measureText(a).width}function Gm(a,b,c=0){let d=b.measureText(a),e=d.actualBoundingBoxAscent,f=d.actualBoundingBoxDescent;return(!e&&!f||a==="")&&(e=c,f=0),Ke.ascent=e,Ke.descent=f,Ke.height=Math.ceil(Math.abs(e)+Math.abs(f)),Ke}let Ke={ascent:0,descent:0,height:0};function Bm(a,b,c,d,e){a.freePens();if(b==="")return a;let f=c.canvas,g=c.context,j=c.parent,i=c.parser.splitText(b),k,n,t=0;for(var v=0,x=i.length;v<x;v++){let L=c.parser.tagTextToProp(i[v],k),R=L.text;k=L.prop;if(k.img){let I,V;c.imageManager?(I=c.imageManager.getOuterWidth(k.img),V=c.imageManager.getOuterHeight(k.img)):(I=0,V=0),e>0&&d!==Da.none&&(e<t+I&&(a.addNewLinePen(wa.wrapped),t=0)),a.addImagePen(t,0,I,V,Zb(k)),t+=I}else if(R!==""){g.save();let I=c.parser.propToStyle(j,k);Ee(g,I),Fe(g,I);let V=I.strokeThickness,W=V/2;n=Hm(R,Fm,g,d,e,t);let K=Gm("|MÃq",g);for(let q=0,r=n.length;q<r;q++){const h=n[q],m=K.height+V,l=K.ascent+W,p=K.descent+W;a.addTextPen(h.text,t,0,h.width,m,l,p,Zb(k),h.newLineMode),h.newLineMode!==wa.none?t=0:t+=h.width}g.restore()}}let C=a.lines,F=c.parent.lineSpacing,H=0,Q=0;for(let L=0,R=C.length;L<R;L++){const I=C[L],V=I.pens,W=V.length;let K=0,q=0;for(let m=0;m<W;m++){const l=V[m];K=Math.max(K,l.ascent),q=Math.max(q,l.descent)}const r=K+q,h=Q+K;for(let m=0;m<W;m++)V[m].y+=h;I.y=h,I.height=r,H=Math.max(H,I.width),Q+=r+F}return a.maxLineWidth=H,a.totalLineHeight=Q-F,a}const Vi={PI2:Math.PI*2,HALF_PI:Math.PI*.5,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};class Ap extends Ja{constructor(a,b,c,d,e){super(a,b,c,d);this.name=e}}class Dm{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return this.hitAreas.length=0,this}add(a,b,c,d,e){let f=new Ap(b,c,d,e,a);return this.hitAreas.push(f),this}getFirstHitArea(a,b){for(let c=0,d=this.hitAreas.length;c<d;c++){let e=this.hitAreas[c];if(e.contains(a,b))return e}return null}}class kn{constructor(a=0,b=a,c=0,d=c,e=0){this._width=0;this._height=0;this.cornerRadius={tl:$a(0),tr:$a(0),bl:$a(0),br:$a(0)};this.setTo(a,b,c,d,e)}setTo(a=0,b=a,c=0,d=c,e=0){return this.setPosition(a,b),this.setRadius(e),this.setSize(c,d),this}setPosition(a=0,b=a){return this.x=a,this.y=b,this}setRadius(a=0){let b=this.cornerRadius;if(typeof a==="number"){const c=a,d=a;b.tl=$a(void 0,c,d),b.tr=$a(void 0,c,d),b.bl=$a(void 0,c,d),b.br=$a(void 0,c,d)}else{const c=a.x??0,d=a.y??0;b.tl=$a(a.tl,c,d),b.tr=$a(a.tr,c,d),b.bl=$a(a.bl,c,d),b.br=$a(a.br,c,d)}return this}setSize(a=0,b=a){return this.width=a,this.height=b,this}get minWidth(){let a=this.cornerRadius;return Math.max(a.tl.x+a.tr.x,a.bl.x+a.br.x)}get minHeight(){let a=this.cornerRadius;return Math.max(a.tl.y+a.bl.y,a.tr.y+a.br.y)}get width(){return this._width}set width(a){a==null&&(a=0),this._width=Math.max(a,this.minWidth)}get height(){return this._height}set height(a){a==null&&(a=0),this._height=Math.max(a,this.minHeight)}get radius(){let a=this.cornerRadius,b=Math.max(a.tl.x,a.tl.y,a.tr.x,a.tr.y,a.bl.x,a.bl.y,a.br.x,a.br.y);return b}}function $a(a,b,c){return a===void 0?{x:b,y:c}:typeof a==="number"?{x:a,y:a}:a}const eq=Math.PI/180;function vb(a){return a*eq}const ln=vb(0),mn=vb(90),nn=vb(180),on=vb(270);function Ae(a,b,c,d,e,f){const g=new kn(b,c,d,e,f),j=g.minWidth,i=g.minHeight,k=d>=j?1:d/j,n=e>=i?1:e/i,t=g.cornerRadius;let v,x,C,F,H;a.beginPath(),a.translate(b,c),v=t.br,x=v.x*k,C=v.y*n,F=g.width-x,H=g.height-C,Qe(v)?a.ellipse(F,H,x,C,0,ln,mn):(a.moveTo(g.width,H),a.lineTo(g.width,g.height),a.lineTo(F,g.height)),v=t.bl,x=v.x*k,C=v.y*n,F=x,H=g.height-C,a.lineTo(x,g.height),Qe(v)?a.ellipse(F,H,x,C,0,mn,nn):(a.lineTo(0,g.height),a.lineTo(0,H)),v=t.tl,x=v.x*k,C=v.y*n,F=x,H=C,a.lineTo(0,H),Qe(v)?a.ellipse(F,H,x,C,0,nn,on):(a.lineTo(0,0),a.lineTo(F,0)),v=t.tr,x=v.x*k,C=v.y*n,F=g.width-x,H=C,a.lineTo(F,0),Qe(v)?a.ellipse(F,H,x,C,0,on,ln):(a.lineTo(g.width,0),a.lineTo(g.width,H)),a.closePath()}function Qe(a){return a.x!==0&&a.y!==0}function Ih(a,b,c,d,e,f,g,j,i,k){Ae(b,c,d,e,f,g),j&&(b.fillStyle=j,b.fill()),i&&(b.strokeStyle=i,b.lineWidth=k,b.stroke())}function Cm(a,b,c,d,e,f=0,g=0,j=a.penManager){a.hitAreaManager&&a.hitAreaManager.clear();let i=j.totalLineHeight;if(i===0)return;const k=d<a.textWidth||e<a.textHeight;let n=a.context;n.save();let t=a.parent;vp(a,t),wp(a,t),k&&(n.beginPath(),n.rect(b,c,d,e),n.clip());let v,x;switch(t.align){case Ea.TOP_LEFT:v=Ta.left,x=Ua.top;break;case Ea.TOP_CENTER:v=Ta.center,x=Ua.top;break;case Ea.TOP_RIGHT:v=Ta.right,x=Ua.top;break;case Ea.CENTER_LEFT:v=Ta.left,x=Ua.center;break;case Ea.CENTER:v=Ta.center,x=Ua.center;break;case Ea.CENTER_RIGHT:v=Ta.right,x=Ua.center;break;case Ea.BOTTOM_LEFT:v=Ta.left,x=Ua.bottom;break;case Ea.BOTTOM_CENTER:v=Ta.center,x=Ua.bottom;break;case Ea.BOTTOM_RIGHT:v=Ta.right,x=Ua.bottom;break}let C=c-g;switch(x){case Ua.center:C+=(e-i)/2;break;case Ua.bottom:C+=e-i-2;break}let F=j.lines,H=C;const Q=b+e;for(let L=0,R=F.length;L<R;L++){let I=F[L];if(H>Q)break;const V=H+I.height;if(V<c){H=V;continue}let W=I.width;if(W===0){H=V;continue}let K=b-f;switch(v){case Ta.center:K+=(d-W)/2;break;case Ta.right:K+=d-W;break}let q=I.pens;for(let r=0,h=q.length;r<h;r++)up(a,q[r],K,C);H=V}n.restore()}function up(a,b,c,d){c+=b.x,d+=b.y;let e=a.canvas,f=a.context,g=a.parent;f.save();let j=a.parser.propToStyle(g,b.prop);Ee(f,j),Fe(f,j),j.underlineThickness>0&&b.width>0&&xp(a,c,d,b.width,j),b.isTextPen&&yp(a,c,d,b.text,j),b.isImagePen&&zp(a,c,d,b.prop.img,j),f.restore(),b.hasAreaMarker&&b.width>0&&(a.hitAreaManager||(a.hitAreaManager=new Dm()),a.hitAreaManager.add(b.prop.area,c,d,b.width,b.height))}function vp(a,b){let c=a.canvas,d=a.context;d.clearRect(0,0,c.width,c.height)}function wp(a,b){let c=a.canvas,d=a.context;d.clearRect(0,0,c.width,c.height);const e=b.backgroundFillStyle,f=b.backgroundStrokeStyle;if(e||f){const g=b.backgroundStrokeThickness,j=g/2,i=b.cornerRadius,k=j,n=j,t=c.width-g,v=c.height-g;Ih(c,d,k,n,t,v,i,e,f,g)}else d.clearRect(0,0,c.width,c.height)}function xp(a,b,c,d,e){c+=e.underlineOffsetY-e.underlineThickness/2;let f=a.context,g=f.lineCap;f.lineCap="butt",f.beginPath(),f.strokeStyle=e.underlineStyle,f.lineWidth=e.underlineThickness,f.moveTo(b,c),f.lineTo(b+d,c),f.stroke(),f.lineCap=g}function yp(a,b,c,d,e){let f=a.context;e.strokeStyle&&e.strokeStyle!=="none"&&e.strokeThickness>0&&(Hh(f,e,e.shadowStroke),f.strokeText(d,b,c)),e.fillStyle&&e.fillStyle!=="none"&&(Hh(f,e,e.shadowFill),f.fillText(d,b,c))}function zp(a,b,c,d,e){let f=a.imageManager;if(!f)return;let g=f.get(d),j=f.getFrame(d);b+=g.left,c+=g.y-g.height;let i=a.context;i.drawImage(j.texture.image,j.x,j.y,j.width,j.height,b,c,g.width,g.height)}class rm{constructor({canvas:a,context:b,parent:c,parser:d,penPool:e=new Yb()}){this.textScrollX=0;this.textScrollY=0;this.canvas=a,this.context=b,this.parser=d,this.parent=c,this.penPool=e,this.penManager=new _c({penPool:e})}destroy(){this.parser.destroy(),this.canvas=null,this.context=null,this.parser=null,this.parent=null,this.penManager&&(this.penManager.destroy(),this.penManager=null),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=null),this.imageManager&&(this.imageManager.destroy(),this.imageManager=null),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=null)}get textWidth(){return this.penManager.maxLineWidth}get textHeight(){return this.penManager.totalLineHeight}updatePenManager(a,b,c,d=this.penManager){return Bm(d,a,this,b,c)}draw(a,b,c,d,e=0,f=0){return Cm(this,a,b,c,d,e,f,this.penManager),this}get lines(){return this.penManager.lines}get tmpPenManager(){return this._tmpPenManager===null&&(this._tmpPenManager=new _c({penPool:this.penPool})),this._tmpPenManager}getPlainText(a,b,c){let d;return a==null?d=this.penManager.plainText:d=this.parser.splitText(a,!0).join(""),(b!=null||c!=null)&&(b==null&&(b=0),c==null&&(c=d.length),d=d.substring(b,c)),d}getPenManager(a,b){return a===void 0?this.clonePenManager(b,this.penManager):(b===void 0&&(b=new _c({penPool:this.penPool})),this.updatePenManager(a,this.parent.wrapMode,this.parent.wrapWidth,b),b)}getText(a,b,c,d){if(a==null)return this.penManager.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d);let e=this.tmpPenManager;return this.updatePenManager(a,this.parent.wrapMode,this.parent.wrapWidth,e),e.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d)}clonePenManager(a,b=this.penManager){return b.clone(a)}getLastPen(a=this.penManager){return a.lastPen}addImageInfo(a,b){return this.imageManager===void 0&&(this.imageManager=new Am()),this.imageManager.add(a,b),this}}function uh(a,b=!0,c=!0){let d=a.canvasText;b&&d.updatePenManager(a.text,a.wrapMode,a.wrapWidth);if(c){let e=a.padding,f,g,j,i;a.fixedWidth===0?(f=d.textWidth,j=f+e.left+e.right):(j=a.fixedWidth,f=j-e.left-e.right,f>d.textWidth&&(f=d.textWidth)),a.fixedHeight===0?(g=d.textHeight,i=g+e.top+e.bottom):(i=a.fixedHeight,g=i-e.top-e.bottom,g>d.textHeight&&(g=d.textHeight));let k=a.resolution,n=Math.ceil(j*k),t=Math.ceil(i*k),v=a.canvas;(v.width!==n||v.height!==t)&&(v.width=n,v.height=t,a.texture.setSize(j,i),a.setSize(j,i));let x=a.context;x.save(),x.scale(k,k),d.draw(e.left,e.top,f,g,0,a.textScrollY),x.restore(),a.texture.binding&&a.texture.binding.update(),a.setDirty(aa.TEXTURE)}}function Be(a,b=0,c=0){a.fixedWidth=b,a.fixedHeight=c,De(a)}function vh(a,b,c,d,e){const f=a.padding;if(typeof b==="number")f.left=b,f.right=c===void 0?b:c,f.top=d===void 0?b:d,f.bottom=e===void 0?b:e;else{let g=b;f.left=g.left??0,f.right=g.right??0,f.top=g.top??0,f.bottom=g.bottom??0}De(a)}function De(a){const b=a.fixedWidth;if(a.wrapMode!==Da.none){const c=a.padding,d=b-c.left-c.right;a.wrapWidth=Math.max(d,0)}else a.wrapWidth=0}function sm(a,b,c=!1){c?a.textScrollYPercentage=b:a.textScrollY=b}function wh(a,b){typeof b==="string"&&(b=Ea[b]),a.align=b}function xh(a,b=0){a.lineSpacing=b}function yh(a,b,c,d=0,e=0){c||(d=0),a.backgroundFillStyle=b,a.backgroundStrokeStyle=c,a.backgroundStrokeThickness=d,a.cornerRadius=e}function tm(a,b,c){b&&zh(a,b),c&&Ah(a,c)}function zh(a,b){a.fontFamily=b}function Ah(a,b){typeof b==="number"&&(b=`${b}px`),a.fontSize=b}function Bh(a,b){a.fillStyle=b}function Ch(a,b,c=2){a.strokeStyle=b,a.strokeThickness=c}function Dh(a,b="#000",c=5,d=0,e=0,f=!1,g=!1){a.shadowColor=b,a.shadowBlur=c,a.shadowOffsetX=d,a.shadowOffsetY=e,a.shadowFill=f,a.shadowStroke=g}function Eh(a,b,c){typeof b==="string"&&(b=Da[b]),a.wrapMode=b,c===void 0?De(a):a.wrapWidth=c}function Fh(a,b,c=2,d=0){a.underlineStyle=b,a.underlineThickness=c,a.underlineOffsetY=d}function th(a,b,c){a.canvasText.addImageInfo(b,c)}function um(a,b,c,d){return b=a.canvasText.getText(b,c,d,!0),b.split(Gh)}function vm(a,b,c,d){return a.canvasText.getPlainText(b,c,d)}function wm(a,b,c,d){return a.canvasText.getText(b,c,d,!1)}function xm(a,b,c,d){return a.canvasText.getText(b,c,d,!1)}function ym(a,b){return a.canvasText.clonePenManager(b)}function zm(a,b,c){return a.canvasText.getPenManager(b,c)}class Ce extends md{constructor(a,b,c="",{width:d=0,height:e=0,padding:f,wrapMode:g=Da.none,backgroundFillStyle:j,backgroundStrokeStyle:i,backgroundStrokeThickness:k,cornerRadius:n=0,align:t=Ea.TOP_LEFT,lineSpacing:v=0,fontFamily:x="monospace",fontSize:C="16px",fillStyle:F="#fff",strokeStyle:H,strokeThickness:Q=1,shadowColor:L="#000",shadowBlur:R=4,shadowOffsetX:I=0,shadowOffsetY:V=0,shadowFill:W=!1,shadowStroke:K=!1,underlineStyle:q="#fff",underlineThickness:r=1,underlineOffsetY:h=0,images:m}={},l){super(a,b,fc());this.antialias=!1;this.fontFamily="monospace";this.fontSize="16px";this.fillStyle="#fff";this.strokeThickness=1;this.shadowStroke=!1;this.shadowFill=!1;this.shadowColor="#000";this.shadowBlur=4;this.shadowOffsetX=0;this.shadowOffsetY=0;this.underlineStyle="#fff";this.underlineThickness=1;this.underlineOffsetY=0;this.align=Ea.TOP_LEFT;this.lineSpacing=0;this.wrapMode=Da.none;this.wrapWidth=0;this.fixedWidth=0;this.fixedHeight=0;this.padding={left:0,right:0,top:0,bottom:0};this._textScrollY=0;this.type="rexText";const p=xa.get();this.resolution=p.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.canvasText=new rm({canvas:this.canvas,context:this.context,parent:this,parser:l}),Be(this,d,e),f&&vh(this,f),Eh(this,g),wh(this,t),xh(this,v),yh(this,j,i,k,n),zh(this,x),Ah(this,C),Bh(this,F),H&&Ch(this,H,Q),Dh(this,L,R,I,V,W,K),Fh(this,q,r,h),m&&th(this,m),this.setText(c)}destroy(a){this.canvasText.destroy(),this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}updateText(a=!0,b=!0){return uh(this,a,b),this}get text(){return this._text}set text(a){this.setText(a)}setText(a="",b=!0){return Array.isArray(a)&&(a=a.join(`
`)),a!==this._text&&(this._text=a.toString(),b&&this.updateText()),this}setBackgroundStyle(a,b,c=2,d=0){return yh(this,a,b,c,d),this}setFixedSize(a,b){return Be(this,a,b),this}setPadding(a,b,c,d){return vh(this,a,b,c,d),this}setTextScrollY(a,b=!1){return sm(this,a,b),this}setAlign(a){return wh(this,a),this}setLineSpacing(a=0){return xh(this,a),this}setFont(a,b){return tm(this,a,b),this}setFillStyle(a){return Bh(this,a),this}setStrokeStyle(a,b=2){return Ch(this,a,b),this}setShadow(a="#000",b=5,c=0,d=0,e=!1,f=!1){return Dh(this,a,b,c,d,e,f),this}resize(a,b){return Be(this,a,b),uh(this),this}setWrapMode(a,b=0){return Eh(this,a,b),this}setUnderline(a,b=2,c=0){return Fh(this,a,b,c),this}addImageInfo(a,b){return th(this,a,b),this}getWrappedText(a,b,c){return um(this,a,b,c)}getPlainText(a,b,c){return vm(this,a,b,c)}getText(a,b,c){return wm(this,a,b,c)}getSubString(a,b,c){return xm(this,a,b,c)}clonePenManager(a){return ym(this,a)}getPenManager(a,b){return zm(this,a,b)}get textScrollY(){return this._textScrollY}set textScrollY(a){this._textScrollY=a}get textScrollYPercentage(){return this._textScrollY/(this.totalTextHeight-this.displayTextHeight)}set textScrollYPercentage(a){const b=this.displayTextHeight,c=this.totalTextHeight;c<=b?this._textScrollY=0:this._textScrollY=(c-b)*a}get totalTextHeight(){return this.canvasText.textHeight}get displayTextHeight(){const a=this.padding;return this.height-a.top-a.bottom}}class He{destroy(){}}const Ie={text:null,prop:null},Je={font:void 0,fontFamily:void 0,fontStyle:void 0,fontSize:void 0,fillStyle:void 0,strokeStyle:void 0,strokeThickness:void 0,shadowColor:void 0,shadowOffsetX:void 0,shadowOffsetY:void 0,shadowBlur:void 0,shadowStroke:void 0,shadowFill:void 0,underlineStyle:void 0,underlineThickness:void 0,underlineOffsetY:void 0,image:void 0};class Im extends He{splitText(a,b=!1){const c=[];let d=0;for(;;){const f=Lh.exec(a);if(!f)break;const g=f[0],j=Lh.lastIndex-g.length;d<j&&c.push(a.substring(d,j)),b||c.push(g),d=Lh.lastIndex}const e=a.length;return d<e&&c.push(a.substring(d,e)),c}tagTextToProp(a,b){let c,d;b==null&&(b={}),b.img&&ua(b,hb,"img"),Ep.test(a)?(ua(b,Wa,"b",!0),c=""):Fp.test(a)?(ua(b,hb,"b"),c=""):Gp.test(a)?(ua(b,Wa,"i",!0),c=""):Hp.test(a)?(ua(b,hb,"i"),c=""):Jm.test(a)?(d=a.match(Jm),ua(b,Wa,"size",d[1]+"px"),c=""):Ip.test(a)?(ua(b,hb,"size"),c=""):Km.test(a)?(d=a.match(Km),ua(b,Wa,"color",d[1]),c=""):Jp.test(a)?(ua(b,hb,"color"),c=""):Lm.test(a)?(d=a.match(Lm),ua(b,Wa,"u",!0),c=""):Mm.test(a)?(d=a.match(Mm),ua(b,Wa,"u",d[1]),c=""):Kp.test(a)?(ua(b,hb,"u"),c=""):Lp.test(a)?(ua(b,Wa,"shadow",!0),c=""):Nm.test(a)?(d=a.match(Nm),ua(b,Wa,"shadow",d[1]),c=""):Mp.test(a)?(ua(b,hb,"shadow"),c=""):Np.test(a)?(ua(b,Wa,"stroke",!0),c=""):Om.test(a)?(d=a.match(Om),ua(b,Wa,"stroke",d[1]),c=""):Op.test(a)?(ua(b,hb,"stroke"),c=""):Pm.test(a)?(d=a.match(Pm),ua(b,Wa,"img",d[1]),c=""):Pp.test(a)?(ua(b,hb,"img"),c=""):Qm.test(a)?(d=a.match(Qm),ua(b,Wa,"area",d[1]),c=""):Qp.test(a)?(ua(b,hb,"area"),c=""):c=a;const e=Ie;return e.text=c,e.prop=b,e}propToStyle(a,b){const c=Je;return b.hasOwnProperty("img")?c.image=b.img:(c.image=null,c.fontFamily=a.fontFamily,c.fontSize=b.size??a.fontSize,c.fontStyle=Cp(b.b,b.i),c.font=`${c.fontStyle} ${c.fontSize} ${c.fontFamily}`,c.fillStyle=b.color??a.fillStyle,b.hasOwnProperty("stroke")?b.stroke===!0?(c.strokeStyle=a.strokeStyle,c.strokeThickness=a.strokeThickness):(c.strokeStyle=b.stroke,c.strokeThickness=a.strokeThickness):(c.strokeStyle=a.strokeStyle,c.strokeThickness=0)),b.hasOwnProperty("shadow")?b.shadow===!0?(c.shadowColor=a.shadowColor,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor=b.shadow,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor="#000",c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=0,c.shadowStroke=!1,c.shadowFill=!1),b.hasOwnProperty("u")?b.u===!0?(c.underlineStyle=a.underlineStyle,c.underlineThickness=a.underlineThickness,c.underlineOffsetY=a.underlineOffsetY):(c.underlineStyle=b.u,c.underlineThickness=a.underlineThickness,c.underlineOffsetY=a.underlineOffsetY):(c.underlineStyle="#000",c.underlineThickness=0,c.underlineOffsetY=0),c}propToTagText(a,b,c){c==null&&(c=Dp);let d=[];for(const f in c){if(b.hasOwnProperty(f))continue;d.push(`[/${f}]`)}a=`${d.join()}${a}`;let e=[];for(const f in b){if(c[f]===b[f])continue;switch(f){case"size":const g=b.size.replace("px","");e.push(`[size=${g}]`);break;case"color":case"img":case"area":e.push(`[${f}=${b[f]}]`);break;case"stroke":case"u":b[f]===!0?e.push(`[${f}]`):e.push(`[${f}=${b[f]}]`);break;default:e.push(`[${f}]`);break}}return a=`${a}${e.join()}`,a}}const ua=function(a,b,c,d){return b===Wa?a[c]=d:a.hasOwnProperty(c)&&delete a[c],a};var Cp=function(a,b){return a&&b?"bold italic":a?"bold":b?"italic":""};const Dp={},Lh=/\[b\]|\[\/b\]|\[i\]|\[\/i\]|\[size=(\d+)\]|\[\/size\]|\[color=([a-z]+|#[0-9abcdef]+)\]|\[\/color\]|\[u\]|\[u=([a-z]+|#[0-9abcdef]+)\]|\[\/u\]|\[shadow\]|\[shadow=([a-z]+|#[0-9abcdef]+)\]|\[\/shadow\]|\[stroke\]|\[stroke=([a-z]+|#[0-9abcdef]+)\]|\[\/stroke\]|\[img=([^\]]+)\]|\[\/img\]|\[area=([^\]]+)\]|\[\/area\]/ig;var Ep=/\[b\]/i,Fp=/\[\/b\]/i,Gp=/\[i\]/i,Hp=/\[\/i\]/i,Jm=/\[size=(\d+)\]/i,Ip=/\[\/size\]/i,Km=/\[color=([a-z]+|#[0-9abcdef]+)\]/i,Jp=/\[\/color\]/i,Lm=/\[u\]/i,Mm=/\[u=([a-z]+|#[0-9abcdef]+)\]/i,Kp=/\[\/u\]/i,Lp=/\[shadow\]/i,Nm=/\[shadow=([a-z]+|#[0-9abcdef]+)\]/i,Mp=/\[\/shadow\]/i,Np=/\[stroke\]/i,Om=/\[stroke=([a-z]+|#[0-9abcdef]+)\]/i,Op=/\[\/stroke\]/i,Pm=/\[img=([^\]]+)\]/i,Pp=/\[\/img\]/i,Qm=/\[area=([^\]]+)\]/i,Qp=/\[\/area\]/i;const hb=!1,Wa=!0;class ed extends Ce{constructor(a,b,c="",d){super(a,b,c,d,new Im());this.type="rexBBcodeText"}}class Sm extends He{constructor(a){super();this.tags=new Map();if(a)for(const b in a)this.addTag(b,a[b])}destroy(){this.tags.clear()}addTag(a,b){return this.tags.set(a,b),this}isTextTag(a){const b=this.tags.get(a);return b?b.img==null:!1}splitText(a,b=!1){const c=[];let d=0;for(;;){const f=Mh.exec(a);if(!f)break;const g=f[0],j=Mh.lastIndex-g.length;d<j&&c.push(a.substring(d,j));if(!b)c.push(g);else if(Um.test(g)){const i=g.match(Vm);c.push(i[2])}else if(Wm.test(g)){const i=g.match(Xm);c.push(i[2])}d=Mh.lastIndex}const e=a.length;return d<e&&c.push(a.substring(d,e)),c}tagTextToProp(a,b){let c,d;if(Um.test(a)){const f=a.match(Vm);if(f!=null){const g=f[1],j=this.tags;d=j.get(g)??{},d._class=g,c=f[2]}}else if(Wm.test(a)){const f=a.match(Xm);if(f!=null){const g=f[1];d=Rp(g),d._style=g,c=f[2]}}c===void 0&&(c=a),d===void 0&&(d={});const e=Ie;return e.text=c,e.prop=d,e}propToStyle(a,b){const c=Je;if(b.hasOwnProperty("img"))c.image=b.img;else{c.image=null,c.fontFamily=b.family??b.fontFamily??b["font-family"]??a.fontFamily;let d=b.size??b.fontSize??b["font-size"]??a.fontSize;typeof d==="number"&&(d=`${d}px`),c.fontSize=d,c.fontStyle=b.style??b.fontStyle??b["font-style"]??"",c.font=`${c.fontStyle} ${c.fontSize} ${c.fontFamily}`,c.fillStyle=b.color??b["font-color"]??a.fillStyle;if(b.hasOwnProperty("stroke")){const e=b.stroke;c.strokeStyle=e.color??a.strokeStyle,c.strokeThickness=e.thinkness??a.strokeThickness}else c.strokeStyle=a.strokeStyle,c.strokeThickness=a.strokeThickness}if(b.hasOwnProperty("shadow")){const d=b.shadow;c.shadowColor=d.color??a.shadowColor,c.shadowOffsetX=d.offsetX??a.shadowOffsetX,c.shadowOffsetY=d.offsetY??a.shadowOffsetY,c.shadowBlur=d.blur??a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0}else c.shadowColor=a.shadowColor,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=a.shadowStroke,c.shadowFill=a.shadowFill;if(b.hasOwnProperty("u")||b.hasOwnProperty("underline")){const d=b.u??b.underline;c.underlineStyle=d.color??a.underlineStyle,c.underlineThickness=d.thinkness??a.underlineThickness,c.underlineOffsetY=d.offset??a.underlineOffsetY}else c.underlineStyle="#000",c.underlineThickness=0,c.underlineOffsetY=0;return c}propToTagText(a,b,c){if(b.hasOwnProperty("_class")){if(a===""){if(this.isTextTag(b._class))return""}return`<class=${b._class}>${a}</class>`}else if(b.hasOwnProperty("_style"))return`<style=${b._style}>${a}</style>`}}function Rp(a){const b=a.split(";"),c={};for(var d=0,e=b.length;d<e;d++){const[f,g]=b[d].split(":");if(Tm(f)||Tm(g))continue;if(f==="stroke"){const j=g.split(" "),i={},k=j.length;k>=1&&(i.color=j[0]),k>=2&&(i.thinkness=parseInt(j[1].replace("px",""))),c.stroke=i}else if(f==="shadow"){const j=g.split(" "),i={},k=j.length;k>=1&&(i.color=j[0]),k>=2&&(i.offsetX=parseInt(j[1].replace("px",""))),k>=3&&(i.offsetY=parseInt(j[2].replace("px",""))),k>=4&&(i.blur=parseInt(j[3].replace("px",""))),c.shadow=i}else if(f==="u"||f==="underline"){const j=g.split(" "),i={},k=j.length;k>=1&&(i.color=j[0]),k>=2&&(i.thinkness=parseInt(j[1].replace("px",""))),k>=3&&(i.offset=parseInt(j[2].replace("px",""))),c[f]=i}else c[f]=g}return c}function Tm(a){return a=a.replace(Sp,""),a.length===0}const Mh=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,Um=/<\s*class=/i,Vm=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,Wm=/<\s*style=/i,Xm=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,Sp=/^\s+|\s+$/;class Rm extends Ce{constructor(a,b,c="",d){const e=d?d.tags:void 0;super(a,b,c,d,new Sm(e));this.type="rexTagText"}get parser(){return this.canvasText.parser}addTag(a,b){return this.parser.addTag(a,b),this}addTags(a){for(const b in a)this.parser.addTag(b,a[b]);return this}}function Va(a,b){return a===void 0||b===void 0?void 0:`${a}|${b}`}function xk(a,b){let c=a.split("|");return b===void 0&&(b=No),b.x=parseInt(c[0]),b.y=parseInt(c[1]),b}let No={x:0,y:0};let un=new Yb();function Fj(){let a=un.pop();return a===null&&(a=new Map()),a}function Od(a){un.push(a)}function Dj(a,b,c,d,e,f,g,j){if(c===f&&d===g&&e===j)return;let i=Va(c,d),k=Va(f,g);if(i){let n=b.get(i);n.delete(e);if(i===k){n.set(j,a);return}else n.size===0&&(Od(n),b.delete(i))}if(k){let n=b.get(k);n?n.set(j,a):(n=Fj(),n.set(j,a),b.set(k,n))}}function Tf(a,b,c,d){let e=Va(b,c),f=a.get(e);f&&(d!==void 0?(f.delete(d),f.size===0&&(Od(f),a.delete(e))):(f.clear(),Od(f),a.delete(e)))}let vn=new Yb();function Ej(){let a=vn.pop();return a===null&&(a=new Set()),a}function Sf(a){vn.push(a)}function Nd(a,b,c,d){if(c===d)return;if(c!==void 0){let e=b.get(c);e&&(e.delete(a),e.size===0&&(Sf(e),b.delete(c)))}if(d!==void 0){let e=b.get(d);e?e.add(a):(e=Ej(),e.add(a),b.set(d,e))}}function Nb(a,b,c){let d=a.get(b);d&&(d.delete(c),d.size===0&&(Sf(d),a.delete(b)))}function yj(a,b,c,d,e){let f=a.chessToXYZ.get(b),g=f?f.x:void 0,j=f?f.y:void 0,i=f?f.y:void 0;f?(f.x=c,f.y=d,f.z=e):a.chessToXYZ.set(b,{x:c,y:d,z:e}),Dj(b,a.XYToZMap,g,j,i,c,d,e),Nd(b,a.XToChessSet,g,c),Nd(b,a.YToChessSet,j,d),Nd(b,a.ZToChessSet,i,e)}function Mb(a,b,c,d){let e=a.XYToZMap.get(Va(b,c));return e===void 0?null:d!==void 0?e.has(d)?e.get(d):null:e}function zj(a,b,c,d){if(d!==void 0){let e=Mb(a,b,c,d);if(e===void 0)return;a.chessToXYZ.delete(e),Tf(a.XYToZMap,b,c,d),Nb(a.XToChessSet,b,e),Nb(a.YToChessSet,c,e),Nb(a.ZToChessSet,d,e)}else{let e=Mb(a,b,c);if(e){for(const[f,g]of e)a.chessToXYZ.delete(g),Nb(a.XToChessSet,b,g),Nb(a.YToChessSet,c,g),Nb(a.ZToChessSet,f,g);Tf(a.XYToZMap,b,c)}}}function Aj(a,b){return a.chessToXYZ.has(b)}function Bj(a,b,c,d){return Mb(a,b,c,d)!==null}function Cj(a,b){return a.chessToXYZ.get(b)||null}function Qf(a){let b=-Infinity;for(const[c,d]of a)b<c&&(b=c);return b}function Rf(a){let b=Infinity;for(const[c,d]of a)b>c&&(b=c);return b}class Bf{constructor(){this.chessToXYZ=new Map(),this.XYToZMap=new Map(),this.XToChessSet=new Map(),this.YToChessSet=new Map(),this.ZToChessSet=new Map(),this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0}destroy(){this.clear()}clear(){return this.chessToXYZ.clear(),this.XYToZMap.clear(),this.XToChessSet.clear(),this.YToChessSet.clear(),this.ZToChessSet.clear(),this.clearBounds(),this}clearBounds(){return this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0,this}addChess(a,b,c,d){return yj(this,a,b,c,d),this.clearBounds(),this}getChess(a,b,c){return Mb(this,a,b,c)}removeChess(a,b,c){return zj(this,a,b,c),this.clearBounds(),this}hasChess(a){return Aj(this,a)}contains(a,b,c){return Bj(this,a,b,c)}getXYZ(a){return Cj(this,a)}get xMax(){return this._xMax===void 0&&(this._xMax=Qf(this.XToChessSet)),this._xMax}get xMin(){return this._xMin===void 0&&(this._xMin=Rf(this.XToChessSet)),this._xMin}get yMax(){return this._yMax===void 0&&(this._yMax=Qf(this.YToChessSet)),this._yMax}get yMin(){return this._yMin===void 0&&(this._yMin=Rf(this.YToChessSet)),this._yMin}}function cb(a,b=[]){let c=a.boardData.chessToXYZ;for(const[d,e]of c)b.push(d);return b}function be(a){if(typeof a!=="object"||a.nodeType||a===a.window)return!1;try{if(a.constructor&&!{}.hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0}function Mc(a){return be(a)?!0:typeof a==="object"?a.isTileXYZ:!1}function ba(a,b){let c=a.boardData.getXYZ(b);return c?c:Mc(b)?b:null}function qa(a,b,c,d){return a.boardData.getChess(b,c,d)}class Gj{constructor(a){this.parent=a,this.board=null,this.blocker=!1,this.boot()}boot(){typeof this.parent==="object"&&this.parent.on&&this.parent.on("destroy",this.destroy,this)}destroy(){if(this.board){let a=this.tileXYZ;this.board.boardData.removeChess(a.x,a.y,a.z)}this.parent=void 0,this.board=null}setBoard(a){return this.board=a,this}get tileXYZ(){return this.board==null?null:this.board.boardData.getXYZ(this.parent)}setBlocker(a=!0){return this.blocker=a,this}setBlockEdge(a,b=!0){typeof this.blocker==="boolean"&&(this.blocker={});let c=this.blocker;if(typeof a==="object"){let d=a;for(let e in d)c[e]=d[e]}else c[a]=b;return this}getBlockEdge(a){return typeof this.blocker==="boolean"?!1:this.blocker.hasOwnProperty(a)?this.blocker[a]:!1}}function Ya(a){return a.hasOwnProperty("rexChess")||(a.rexChess=new Gj(a)),a.rexChess}function Pa(a,b,c,d,e,f=!1,g=!1){if(b){let j=ba(a,b);if(j)c=j.x,d=j.y,e=j.z;else return}else{b=qa(a,c,d,e);if(!b)return}g||a.boardData.removeChess(c,d,e),a._isBoard&&Ya(b).setBoard(null),f&&b.destroy&&b.destroy()}function Lb(a,b){if(a.infinityMode)return;if(a.height===void 0||a.height<=b){a.height=b;return}let c=cb(a);c.forEach(d=>{let e=ba(a,d);e.y>b&&Pa(a,d)}),a.height=b}function Kb(a,b){if(a.infinityMode)return;if(a.width===void 0||a.width<=b){a.width=b;return}let c=cb(a);c.forEach(d=>{let e=ba(a,d);e.x>b&&Pa(a,d)}),a.width=b}class wd{constructor({grid:a=void 0,wrap:b=!1,inifinity:c=!1,width:d=0,height:e=0}={}){this.boardData=new Bf(),this._isBoard=!0,this.setGrid(a),this.setWrapMode(b),this.setInfinityMode(c),this.setBoardSize(d,e)}destroy(){}setGrid(a){return this.grid=a,this}setWrapMode(a=!0){return this.wrapMode=a,this}setInfinityMode(a=!0){return this.infinityMode=a,this}setBoardSize(a=0,b=0){return Kb(this,a),Lb(this,b),this}}function Xa(a,b,c,d){let e;return a.infinityMode?e=!0:e=b>=0&&b<a.width&&c>=0&&c<a.height,e&&d!==void 0&&(e=a.boardData.contains(b,c,d)),e}function Ga(a,b,c,d){return a.grid.getWorldXY(b,c,d)}function lc(a,b,c,d){if(b===void 0){let e=cb(a);for(let f=0,g=e.length;f<g;f++){let j=e[f],i=ba(a,j);Ga(a,i.x,i.y,j)}}else{if(c===void 0){let e=ba(a,b);c=e.x,d=e.y}Ga(a,c,d,b)}}function sb(a,b,c,d,e,f=!0){if(!Xa(a,c,d))return;let g=ba(a,b);e===void 0&&(g?e=g.z:e=0);if(g&&g.x===c&&g.y===d&&g.z===e)return;let j=qa(a,c,d,e);j&&(Pa(a,null,c,d,e),console.warn(`Chess at (${c},${d},${e}) has been removed because of overlapped`)),a.boardData.addChess(b,c,d,e),a._isBoard&&Ya(b).setBoard(a),f&&lc(a,b,c,d)}function Rb(a,b,c,d){return Math.atan2(d-b,c-a)}function tb(a,b,c){let d=ba(a,b),e=ba(a,c),f=Ga(a,d.x,d.y,!0),g=f.x,j=f.y;f=Ga(a,e.x,e.y,!0);let i=f.x,k=f.y;return Rb(g,j,i,k)}function nb(a,b,c){let d=c-b;return b+((a-b)%d+d)%d}function kc(a,b,c,d={x:0,y:0}){return d===!0&&(d=Vn),a.wrapMode?b=nb(b,0,a.width):!a.infinityMode&&(b<0||b>=a.width)&&(b=null),a.wrapMode?c=nb(c,0,a.height):!a.infinityMode&&(c<0||c>=a.height)&&(c=null),d.x=b,d.y=c,d}let Vn={x:0,y:0};function Oa(a,b,c,d,e){let f=ba(a,b);if(f===null)return null;typeof c==="string"&&(c.indexOf(",")===-1?c=parseInt(c):c=c.split(".").map(k=>parseInt(k,10)));let g=typeof c==="number",j=typeof d==="number";if(g&&j){let k=a.grid.getTileXYAtDirection(f,c,d,e);return kc(a,k.x,k.y,k),(k.x===null||k.y===null)&&(k=null),k}Array.isArray(e)||(e=[]),c===null&&(c=a.grid.allDirections);let i;if(g)if(Array.isArray(d))for(let k=0,n=d.length;k<n;k++)i=Oa(a,f,c,d[k]),i!==null&&e.push(i);else{let k,n,t;({end:k=1,start:n=k>0?1:-1,step:t=k>=n?1:-1}=d);if(n===k)i=Oa(a,f,c,k),i!==null&&e.push(i);else if(n<k)for(let v=n;v<=k;v+=t)i=Oa(a,f,c,v),i!==null&&e.push(i);else for(let v=n;v>=k;v+=t)i=Oa(a,f,c,v),i!==null&&e.push(i)}else for(let k=0,n=c.length;k<n;k++)j?(i=Oa(a,f,c[k],d),i!==null&&e.push(i)):Oa(a,f,c[k],d,e);return e}function gb(a,b,c=null,d={x:0,y:0}){return Oa(a,b,c,1,d)}function hc(a,b,c){b===void 0&&(b=Zn);let d=a.wrapMode,e=a.infinityMode;a.wrapMode=!1,a.infinityMode=!0;let f=gb(a,b,c,!0);return a.wrapMode=d,a.infinityMode=e,tb(a,b,f)}let Zn={x:0,y:0};const fq=180/Math.PI;function oc(a){return a*fq}function Kj(a,b){let c=b-a;if(c===0)return 0;let d=Math.floor((c- -180)/360);return c-d*360}function gc(a,b,c){c=oc(c);let d=a.grid.allDirections,e=Infinity,f;for(let g=0,j=d.length;g<j;g++){let i=oc(hc(a,b,d[g])),k=Math.abs(Kj(c,i));k<e&&(e=k,f=g)}return f}function jc(a,b,c){if(b===null||c===null)return null;if(b.x===c.x&&b.y===c.y)return null;let d=a.grid.getNeighborTileDirection(b,c);if(a.wrapMode&&d===null){let e=gb(a,b,null);for(let f=0,g=e.length;f<g;f++){let j=e[f];if(c.x===j.x&&c.y===j.y){d=f;break}}}return d}function ic(a,b,c){let d=ba(a,b),e=ba(a,c);return jc(a,d,e)}function yd(a,b,c){return ic(a,b,c)!==null}function zd(a,b,c,d=!0){let e=ba(a,b),f=ba(a,c);return e===null||f===null?null:a.grid.directionBetween(e,f,d)}function Jc(a,b,c=1,d=[]){let e=a.grid.ringToTileXYArray(b,c);for(let f=0,g=e.length;f<g;f++){let j=e[f];Xa(a,j.x,j.y)&&d.push(j)}return d}function Cf(a,b,c,d=!0,e=[]){for(let f=0;f<=c;f++){let g=d?f:c-f;Jc(a,b,g,e)}return e}function db(a,b,c,d,e={x:0,y:0}){return e===!0&&(e=Xn),c===0&&d===0?(e.x=b.x,e.y=b.y):a.grid.offset(b,c,d,e),e}let Xn={x:0,y:0};function Df(a,b){let c=Infinity,d=Infinity,e;for(let j=0,i=b.length;j<i;j++)e=b[j],c=Math.min(c,e.x),d=Math.min(d,e.y);if(c!==0||d!==0)for(let j=0,i=b.length;j<i;j++)e=b[j],db(a,e,-c,-d,e);let f=-Infinity,g=-Infinity;for(let j=0,i=b.length;j<i;j++)e=b[j],f=Math.max(f,e.x),g=Math.max(g,e.y);return Kb(a,f+1),Lb(a,g+1),b}var Pb;(function(a){a[a["x+,y+"]=0]="x+,y+",a[a["x-,y+"]=1]="x-,y+",a[a["y+,x+"]=2]="y+,x+",a[a["y-,x+"]=3]="y-,x+"})(Pb||(Pb={}));function Ad(a,b,c,d=0){let e={x:0,y:0};switch(d){case 0:for(let f=0;f<a.height;f++)for(let g=0;g<a.width;g++)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 1:for(let f=0;f<a.height;f++)for(let g=a.width-1;g>=0;g--)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 2:for(let f=0;f<a.width;f++)for(let g=0;g<a.height;g++)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a);break;case 3:for(let f=0;f<a.width;f++)for(let g=a.height-1;g>=0;g--)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a)}}function Bd(a,b,c,d){return a.grid.getDistance(b,c,d)}function Ic(a,b=0,c=[]){if(Array.isArray(b)){let d=b;for(let e=0;e<a.height;e++)for(let f=0;f<a.width;f++){let g=!0;for(let j=0,i=d.length;j<i;j++)if(qa(a,f,e,d[j])!==null){g=!1;break}g&&c.push({x:f,y:e})}}else for(let d=0;d<a.height;d++)for(let e=0;e<a.width;e++)qa(a,e,d,b)===null&&c.push({x:e,y:d});return c}function Cd(a,b,c,d){return a.grid.getGridPoints(b,c,d)}function Qa(a,b,c,d=[]){let e=a.boardData.getChess(b,c);for(const[f,g]of e)d.push(g);return d}function mc(a,b,c,d=[]){let e=c!=null,f,g;for(let j=0,i=b.length;j<i;j++)f=b[j],e?(g=qa(a,f.x,f.y,c),g!==null&&d.push(g)):Qa(a,f.x,f.y,d);return d}function Dd(a,b,c,d,e){let f=ba(a,b);if(f===null)return null;d==null&&(d=f.hasOwnProperty("z")?f.z:null);let g=gb(a,f,c,!0);return g===null?null:Array.isArray(g)?(e===void 0&&(e=[]),mc(a,g,d,e)):d==null?(e===void 0&&(e=[]),Qa(a,g.x,g.y,e)):qa(a,g.x,g.y,d)}function Ed(a,b,c,d={x:0,y:0}){let e=gc(a,b,c);return Oa(a,b,e,1,d)}function Fd(a,b,c,d){return a.grid.getOppositeDirection(b,c,d)}function Kc(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function nc(a,b=0,c=a.length){let d=b+Math.floor(Math.random()*c);return a[d]===void 0?null:a[d]}function Ef(a,b=0,c={x:0,y:0}){c===!0&&(c=Sn);let d=Math.floor(a.width*a.height*.3);for(let f=0;f<d;f++){let g=Kc(0,a.width-1),j=Kc(0,a.height-1);if(qa(a,g,j,b)===null)return c.x=g,c.y=j,c}let e=Ic(a,b);if(e.length===0)return null;{let f=nc(e);return c.x=f.x,c.y=f.y,c}}let Sn={x:0,y:0};function Ff(a,b,c,d){if(d===void 0){let e=Qa(a,b,c);for(let f=0,g=e.length;f<g;f++){let j=Ya(e[f]).blocker;if(j===!0)return!0}return!1}else{let e=qa(a,b,c,d);if(e===null)return!1;let f=Ya(e).blocker;return f===!0}}function Gf(a,b){return a.boardData.chessToXYZ.has(b)}function Hf(a,b,c,d,e){if(d===void 0){let f=Qa(a,b,c);for(let g=0,j=f.length;g<j;g++)if(xj(Ya(f[g]).blocker,e))return!0;return!1}else{let f=qa(a,b,c,d);return f===null?!1:xj(Ya(f).blocker,e)}}function xj(a,b){return a===!1||a===!0?a:a[b]===!0}function Vf(a){return a=a%qn,a>=0?a:a+qn}const qn=Math.PI*2;function Lj(a,b,c=1e-4){return Math.abs(a-b)<c}function Gd(a,b,c,d,e){let f=ba(a,b),g=ba(a,c),j=tb(a,f,g);j=Vf(j);let i=Math.abs(j-d);i=Math.min(i,_n-i);let k=e/2;return Lj(i,k)||i<k}const _n=Math.PI*2;function Hd(a,b,c,d,e){let f=ba(a,b),g=ba(a,c),j=a.grid.directions;a.grid.directions=a.grid.sides;let i=a.grid.directionBetween(f,g,!1);a.grid.directions=j;let k=Math.abs(i-d);return k=Math.min(k,a.grid.directions-k),k<=e/2}function Ka(a,b,c,d={x:0,y:0}){return a.grid.getTileXY(b,c,d)}function Id(a,b,c,d){if(a.infinityMode&&d===void 0)return!0;let e=Ka(a,b,c,!0);return Xa(a,e.x,e.y,d)}function Jj(a,b,c,d){let e=a-c,f=b-d;return Math.sqrt(e*e+f*f)}function Uf(a,b,c){return(b-a)*c+a}function If(a,b,c,d,e,f=[]){let g=Jj(b,c,d,e),j=Math.min(a.grid.width,a.grid.height),i=Math.ceil(g/(j/4)),k;for(let n=0;n<=i;n++){let t=n/i,v=Uf(b,d,t),x=Uf(c,e,t),C=Ka(a,v,x);if(!Xa(a,C.x,C.y))continue;if(k&&k.x===C.x&&k.y===C.y)continue;f.push(C),k=C}return f}var Qb;(function(a){a[a.x=1]="x",a[a.horizontal=1]="horizontal",a[a.h=1]="h",a[a.y=2]="y",a[a.vertical=2]="vertical",a[a.v=2]="v",a[a.xy=3]="xy"})(Qb||(Qb={}));function Jf(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=Wn),d!==null?db(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.mirror(e,c,e),d!==null&&db(a,e,d.x,d.y,e),e}let Wn={x:0,y:0};function Kf(a,b=!1,c=!1){let d=cb(a);for(let e=0,f=d.length;e<f;e++)Pa(a,d[e],void 0,void 0,void 0,b,c)}function Lf(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=Yn),d!==null?db(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.rotate(e,c,e),d!==null&&db(a,e,d.x,d.y,e),e}let Yn={x:0,y:0};function Mf(a,b,c){let d=ba(a,b);if(d===null)return;sb(a,b,d.x,d.y,c)}function Lc(a,b,c){return Math.max(b,Math.min(c,a))}function Nf(a,b,c,d=[]){let e=Ka(a,b.left,b.top,!0),f=e.x-1,g=e.y-1,j=Ka(a,b.right,b.bottom,!0),i=j.x+1,k=j.y+1;a.infinityMode||(f=Lc(f,0,a.width-1),g=Lc(g,0,a.height-1),i=Lc(i,0,a.width-1),k=Lc(k,0,a.height-1));for(let n=f;n<=i;n++)for(let t=g;t<=k;t++){let v=Ga(a,n,t,!0);c(b,v.x,v.y)&&d.push({x:n,y:t})}return d}function Of(a,b,c,d=!0){let e=ba(a,b),f=ba(a,c);if(e==null||f==null)return;Pa(a,b),Pa(a,c),sb(a,b,f.x,f.y,f.z,d),sb(a,c,e.x,e.y,e.z,d)}function Jd(a,b,c=[]){let d=a.boardData.ZToChessSet.get(b);if(d)for(const e of d)c.push(e);return c}function Kd(a,b,c=[]){for(let d=0,e=b.length;d<e;d++){let f=b[d];c.push(Ga(a,f.x,f.y))}return c}function Ld(a,b,c,d={x:0,y:0}){return d===!0&&(d=$n),Ka(a,b,c,d),Ga(a,d.x,d.y,d),d}let $n={x:0,y:0};function Md(a,b,c,d,e){let f=Ka(a,b,c,!0);return d!==void 0?qa(a,f.x,f.y,d):Qa(a,f.x,f.y,e)}class xd extends wd{addChess(a,b,c,d,e=!0){return sb(this,a,b,c,d,e),this}angleBetween(a,b){return tb(this,a,b)}angleSnapToDirection(a,b){return gc(this,a,b)}angleToward(a,b){return hc(this,a,b)}areNeighbors(a,b){return yd(this,a,b)}chessToTileXYZ(a){return ba(this,a)}contains(a,b,c){return Xa(this,a,b,c)}directionBetween(a,b,c=!0){return zd(this,a,b,c)}filledRingToTileXYArray(a,b,c=!0,d=[]){return Cf(this,a,b,c,d)}fit(a){return Df(this,a)}forEachTileXY(a,b,c=0){return Ad(this,a,b,c),this}getAllChess(a=[]){return cb(this,a)}getChessData(a){return Ya(a)}getDistance(a,b,c=!1){return Bd(this,a,b,c)}getEmptyTileXYArray(a=0,b=[]){return Ic(this,a,b)}getGridPoints(a,b,c){return Cd(this,a,b,c)}getNeighborChess(a,b,c,d){return Dd(this,a,b,c,d)}getNeighborChessDirection(a,b){return ic(this,a,b)}getNeighborTileDirection(a,b){return jc(this,a,b)}getNeighborTileXY(a,b=null,c={x:0,y:0}){return gb(this,a,b,c)}getNeighborTileXYAtAngle(a,b,c={x:0,y:0}){return Ed(this,a,b,c)}getOppositeDirection(a,b,c){return Fd(this,a,b,c)}getRandomEmptyTileXY(a=0,b={x:0,y:0}){return Ef(this,a,b)}getTileXYAtDirection(a,b,c,d){return Oa(this,a,b,c,d)}getWrapTileXY(a,b,c={x:0,y:0}){return kc(this,a,b,c)}gridAlign(a,b,c){return lc(this,a,b,c),this}hasBlocker(a,b,c){return Ff(this,a,b,c)}hasChess(a){return Gf(this,a)}hasEdgeBlocker(a,b,c,d){return Hf(this,a,b,c,d)}isAngleInCone(a,b,c,d){return Gd(this,a,b,c,d)}isDirectionInCone(a,b,c,d){return Hd(this,a,b,c,d)}isOverlappingPoint(a,b,c){return Id(this,a,b,c)}lineToTileXYArray(a,b,c,d,e=[]){return If(this,a,b,c,d,e)}mirror(a,b,c=null,d={x:0,y:0}){return Jf(this,a,b,c,d)}offset(a,b,c,d){return db(this,a,b,c,d)}removeAllChess(a=!1,b=!1){return Kf(this,a,b),this}removeChess(a,b,c,d,e=!1,f=!1){return Pa(this,a,b,c,d,e,f),this}ringToTileXYArray(a,b=1,c=[]){return Jc(this,a,b,c)}rotate(a,b,c=null,d={x:0,y:0}){return Lf(this,a,b,c,d)}setBoardWidth(a=0){return Kb(this,a),this}setBoardHeight(a=0){return Lb(this,a),this}setTileZ(a,b){return Mf(this,a,b),this}shapeToTileXYArray(a,b,c=[]){return Nf(this,a,b,c)}swapChess(a,b,c=!0){return Of(this,a,b,c),this}tileXYArrayToChessArray(a,b,c=[]){return mc(this,a,b,c)}tileXYToChessArray(a,b,c=[]){return Qa(this,a,b,c)}tileXYZToChess(a,b,c){return qa(this,a,b,c)}tileZToChessArray(a,b=[]){return Jd(this,a,b)}tileXYArrayToWorldXYArray(a,b=[]){return Kd(this,a,b)}tileXYToWorldXY(a,b,c={x:0,y:0}){return Ga(this,a,b,c)}worldXYSnapToGrid(a,b,c={x:0,y:0}){return Ld(this,a,b,c)}worldXYToChess(a,b,c,d){return Md(this,a,b,c,d)}worldXYToTileXY(a,b,c){return Ka(this,a,b,c)}}class wj extends xd{}const Za={};$b(Za,{ChessToTileXYZ:()=>ba,Contains:()=>Xa,DirectionBetween:()=>zd,ForEachTileXY:()=>Ad,GetDistance:()=>Bd,GetOppositeDirection:()=>Fd,GetTileXYAtDirection:()=>Oa,GetWrapTileXY:()=>kc,IsDirectionInCone:()=>Hd,TileXYArrayToChessArray:()=>mc,TileXYToChessArray:()=>Qa,TileXYZToChess:()=>qa,TileZToChessArray:()=>Jd});const ub={};$b(ub,{AngleBetween:()=>tb,AngleSnapToDirection:()=>gc,AngleToward:()=>hc,GetGridPoints:()=>Cd,GridAlign:()=>lc,IsAngleInCone:()=>Gd,IsOverlappingPoint:()=>Id,TileXYArrayToWorldXYArray:()=>Kd,TileXYToWorldXY:()=>Ga,WorldXYSnapToGrid:()=>Ld,WorldXYToChess:()=>Md,WorldXYToTileXY:()=>Ka});const Ob={};$b(Ob,{AreNeighbors:()=>yd,GetNeighborChess:()=>Dd,GetNeighborChessDirection:()=>ic,GetNeighborTileDirection:()=>jc,GetNeighborTileXY:()=>gb,GetNeighborTileXYAtAngle:()=>Ed});var oa;(function(a){a[a.orthogonal=0]="orthogonal",a[a.isometric=1]="isometric"})(oa||(oa={}));var ob;(function(a){a[a["4dir"]=4]="4dir",a[a["8dir"]=8]="8dir"})(ob||(ob={}));class rk{constructor({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=oa.orthogonal,dir:f=ob["4dir"]}={}){this.setOriginPosition(a,b),this.setCellSize(c,d),this.setType(e),this.setDirectionMode(f)}fromJSON({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=oa.orthogonal,dir:f=ob["4dir"]}={}){return this.setType(e),this.setDirectionMode(f),this.setOriginPosition(a,b),this.setCellSize(c,d),this}toJSON(){return{x:this.x,y:this.y,cellWidth:this.cellWidth,cellHeight:this.cellHeight,type:this.mode,dir:this.directions}}setOriginPosition(a=0,b=0){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setType(a=oa.orthogonal){return typeof a==="string"&&(a=oa[a]),this.mode=a,this}setDirectionMode(a=ob["4dir"]){return typeof a==="string"&&(a=ob[a]),this.directions=a,this}}function jk(a,b,c,d=!0){let e;switch(a.mode){case oa.orthogonal:case oa.isometric:if(b.y===c.y)e=c.x>=b.x?0:2;else if(b.x===c.x)e=c.y>=b.y?1:3;else if(a.directions===ob["4dir"]){let f=oc(Rb(b.x,b.y,c.x,c.y));f<0&&(f+=360),e=f/90,d&&(e=Math.round(e))}else{let f=c.x-b.x,g=c.y-b.y;if(f===g)e=f>0?4:6;else if(f===-g)e=f>0?7:5;else{let j=oc(Math.atan2(g,f));j<0&&(j+=360);let i=j/45;d&&(i=Math.round(i)),i>=0&&i<1?e=i:i>=1&&i<2?e=i+3:i>=2&&i<3?e=i-1:i>=3&&i<4?e=i+2:i>=4&&i<5?e=i-2:i>=5&&i<6?e=i+1:i>=6&&i<7?e=i-3:e=i}}break}return e===a.directions&&(e=0),e}function Yd(a,b){return nb(b,0,a.directions)}function kk(a,b,c,d=!1){let e=c.x-b.x,f=c.y-b.y,g;return d?g=Math.abs(e)+Math.abs(f):g=Math.sqrt(e*e+f*f),g}function Ud(a,b=[]){if(!(b.length===a))if(b.length<a)for(let c=b.length;c<a;c++)b.push({x:0,y:0});else b.length=a;return b}function $d(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=vo);let e,f;switch(a.mode){case oa.orthogonal:e=b*a.width,f=c*a.height;break;case oa.isometric:e=(b-c)*a._halfWidth,f=(b+c)*a._halfHeight;break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let vo={x:0,y:0};function lk(a,b=0,c=0,d=[]){if(typeof b==="object"){let i=b;c=i.y,b=i.x}d===!0&&(d=ro),Ud(4,d);let e,f;({x:e,y:f}=$d(a,b,c));let g=a._halfWidth,j=a._halfHeight;switch(a.mode){case oa.orthogonal:d[0].x=e+g,d[0].y=f-j,d[1].x=e+g,d[1].y=f+j,d[2].x=e-g,d[2].y=f+j,d[3].x=e-g,d[3].y=f-j;break;case oa.isometric:d[0].x=e+g,d[0].y=f,d[1].x=e,d[1].y=f+j,d[2].x=e-g,d[2].y=f,d[3].x=e,d[3].y=f-j;break}return d}let ro=[];const pc=[[1,0],[0,1],[-1,0],[0,-1],[1,1],[-1,1],[-1,-1],[1,-1]],Nc=pc;function gk(a){let b={},c,d,e;for(let f in a)c=a[f],d=c[0],e=c[1],b.hasOwnProperty(d)||(b[d]={}),b[d][e]=parseInt(f);return b}const hk=gk(pc),ik=gk(Nc);function mk(a,b,c){let d;switch(a.mode){case oa.orthogonal:d=hk;break;case oa.isometric:d=ik;break}let e=c.x-b.x,f=c.y-b.y;if(d.hasOwnProperty(e)){let g=d[e];if(g.hasOwnProperty(f))return g[f]}return null}function ae(a,b,c,d,e={x:0,y:0}){e===!0&&(e=uo);let f,g;switch(a.mode){case oa.orthogonal:f=pc[c][0],g=pc[c][1];break;case oa.isometric:f=Nc[c][0],g=Nc[c][1];break}return d===1?(e.x=b.x+f,e.y=b.y+g):(e.x=b.x+d*f,e.y=b.y+d*g),e}let uo={x:0,y:0};function nk(a,b,c,d={x:0,y:0}){return ae(a,b,c,1,d)}function ok(a,b,c,d){return so[d]}const so={0:2,1:3,2:0,3:1,4:6,5:7,6:4,7:5};function pk(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=to),b-=a.x,c-=a.y;let e=b/a.width,f=c/a.height;switch(a.mode){case oa.orthogonal:d.x=Math.round(e),d.y=Math.round(f);break;case oa.isometric:d.x=Math.round(+e+f),d.y=Math.round(-e+f);break}return d}let to={x:0,y:0};function qk(a,b,c,d={x:0,y:0}){return typeof c==="string"&&(c=Qb[c]),d===!0&&(d=wo),d.x=c&1?-b.x:b.x,d.y=c&2?-b.y:b.y,d}let wo={x:0,y:0};function Sb(a,b,c,d,e={x:0,y:0}){e===!0&&(e=xo);let f=b.x+c,g=b.y+d;return e.x=f,e.y=g,e}let xo={x:0,y:0};function sk(a,b,c,d=[]){let e,f;for(e=c,f=-c;f<=c;f++)d.push(Sb(a,b,e,f));for(f=c,e=c-1;e>=-c;e--)d.push(Sb(a,b,e,f));for(e=-c,f=c-1;f>=-c;f--)d.push(Sb(a,b,e,f));for(f=-c,e=-c+1;e<=c-1;e++)d.push(Sb(a,b,e,f));return d}function tk(a,b,c,d={x:0,y:0}){d===!0&&(d=Co),c=nb(c,0,3);let e,f;switch(c){case 1:e=-b.y,f=b.x;break;case 2:e=-b.x,f=-b.y;break;case 3:e=b.y,f=-b.x;break;default:e=b.x,f=b.y;break}return d.x=e,d.y=f,d}let Co={x:0,y:0};function Zd(a){a._savedOriginX=a.x,a._savedOriginY=a.y}function _d(a){a.x=a._savedOriginX,a.y=a._savedOriginY}class fk extends rk{get sides(){return 4}get allDirections(){return this.directions===4?yo:zo}get halfDirections(){return this.directions===4?Ao:Bo}directionBetween(a,b,c=!0){return jk(this,a,b,c)}directionNormalize(a){return Yd(this,a)}getDistance(a,b,c=!1){return kk(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return lk(this,a,b,c)}getNeighborTileDirection(a,b){return mk(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return nk(this,a,b,c)}getOppositeDirection(a,b,c){return ok(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return pk(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return ae(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return $d(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return qk(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return Sb(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return sk(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return tk(this,a,b,c)}restoreOrigin(){return _d(this),this}saveOrigin(){return Zd(this),this}}const yo=[0,1,2,3],zo=[0,1,2,3,4,5,6,7],Ao=[0,1],Bo=[0,1,4,5];var ca;(function(a){a[a.ODD_R=0]="ODD_R",a[a.EVEN_R=1]="EVEN_R",a[a.ODD_Q=2]="ODD_Q",a[a.EVEN_Q=3]="EVEN_Q"})(ca||(ca={}));var eb;(function(a){a[a.y=0]="y",a[a.flat=0]="flat",a[a.x=1]="x",a[a.pointy=1]="pointy"})(eb||(eb={}));var xb;(function(a){a[a.even=0]="even",a[a.odd=1]="odd"})(xb||(xb={}));class _j{constructor({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=eb.x,staggerIndex:g=xb.odd}={}){this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e)}fromJSON({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=eb.x,staggerIndex:g=xb.odd}={}){return this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e),this}toJSON(){return{x:this.x,y:this.y,radius:this.radius,cellWidth:this.cellWidth,cellHeight:this.cellHeight,staggerAxis:this.staggerAxis,staggerIndex:this.staggerIndex}}setOriginPosition(a,b){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this.radius=void 0,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setRadius(a=0){let b,c;return this.staggerAxis===eb.y?(b=2*a,c=ek*a):(b=ek*a,c=2*a),this.setCellSize(b,c),this.radius=a,this}setDirectionMode(){return this.directions=6,this}setType(a=1,b=1){return typeof a==="string"&&(a=eb[a]),typeof b==="string"&&(b=xb[b]),this.staggerAxis=a,this.staggerIndex=b,a===eb.y?this.mode=b===xb.even?ca.EVEN_Q:ca.ODD_Q:this.mode=b===xb.even?ca.EVEN_R:ca.ODD_R,this}}const ek=Math.sqrt(3);function Ra(a,b,c,d={x:0,y:0,z:0}){d===!0&&(d=Wf);switch(a){case ca.ODD_R:d.x=b-(c-(c&1))/2,d.z=c;break;case ca.EVEN_R:d.x=b-(c+(c&1))/2,d.z=c;break;case ca.ODD_Q:d.x=b,d.z=c-(b-(b&1))/2;break;case ca.EVEN_Q:d.x=b,d.z=c-(b+(b&1))/2;break}return d.y=-d.x-d.z,d}function Oj(a,b,c,d={x:0,y:0,z:0}){typeof a!=="number"&&(d=a,a=d.x,b=d.y,c=d.z),d===!0&&(d=Wf);let e=Math.round(a),f=Math.round(b),g=Math.round(c),j=Math.abs(e-a),i=Math.abs(f-b),k=Math.abs(g-c);return j>i&&j>k?e=-f-g:i>k?f=-e-g:g=-e-f,d.x=e,d.y=f,d.z=g,d}function Ca(a,b,c,d,e={x:0,y:0}){e===!0&&(e=bo);switch(a){case ca.ODD_R:e.x=b+(d-(d&1))/2,e.y=d;break;case ca.EVEN_R:e.x=b+(d+(d&1))/2,e.y=d;break;case ca.ODD_Q:e.x=b,e.y=d+(b-(b&1))/2;break;case ca.EVEN_Q:e.x=b,e.y=d+(b+(b&1))/2;break}return e}function Pj(a,b,c={x:0,y:0,z:0}){return c===!0&&(c=Wf),c.x=a,c.y=-a-b,c.z=b,c}let Wf={x:0,y:0,z:0},bo={x:0,y:0};function Rj(a,b,c,d=!0){let e;Ra(a.mode,b.x,b.y,Qd),Ra(a.mode,c.x,c.y,Rd);let f=Rd.x-Qd.x,g=Rd.y-Qd.y,j=Rd.z-Qd.z;return j===0?e=f>0?0:3:f===0?e=j>0?1:4:g===0?e=j>0?2:5:f>0&&g<0&&j>0?e=0+j/-g:f<0&&g<0&&j>0?e=1+-g/j:f<0&&g>0&&j>0?e=2+g/-f:f<0&&g>0&&j<0?e=3+-j/g:f>0&&g>0&&j<0?e=4+f/-j:e=5+-g/f,d&&(e=Math.round(e)),e}let Qd={x:0,y:0,z:0},Rd={x:0,y:0,z:0};function Sj(a,b,c,d=!1){Ra(a.mode,b.x,b.y,Sd),Ra(a.mode,c.x,c.y,Td);let e=Td.x-Sd.x,f=Td.y-Sd.y,g=Td.z-Sd.z;return(Math.abs(e)+Math.abs(f)+Math.abs(g))/2}let Sd={x:0,y:0,z:0},Td={x:0,y:0,z:0};function Vd(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=lo);let e=b*a.width,f=c*a.height;switch(a.mode){case ca.ODD_R:c&1&&(e+=a._halfWidth),f*=.75;break;case ca.EVEN_R:c&1&&(e-=a._halfWidth),f*=.75;break;case ca.ODD_Q:e*=.75,b&1&&(f+=a._halfHeight);break;case ca.EVEN_Q:e*=.75,b&1&&(f-=a._halfHeight);break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let lo={x:0,y:0};function Tj(a,b=0,c=0,d=[]){if(typeof b==="object"){let g=b;c=g.y,b=g.x}d===!0&&(d=ho),Ud(6,d);let e,f;({x:e,y:f}=Vd(a,b,c));if(a.radius!==void 0){let g=a.radius,j=a.staggerAxis===eb.flat?0:-30;for(let i=0;i<6;i++){let k=60*i+j,n=vb(k);d[i].x=e+g*Math.cos(n),d[i].y=f+g*Math.sin(n)}}else{let g=a._halfWidth,j=g/2,i=a._halfHeight,k=i/2;a.staggerAxis===eb.flat?(d[0].x=e+g,d[0].y=f,d[1].x=e+j,d[1].y=f+i,d[2].x=e-j,d[2].y=f+i,d[3].x=e-g,d[3].y=f,d[4].x=e-j,d[4].y=f-i,d[5].x=e+j,d[5].y=f-i):(d[0].x=e+g,d[0].y=f-k,d[1].x=e+g,d[1].y=f+k,d[2].x=e,d[2].y=f+i,d[3].x=e-g,d[3].y=f+k,d[4].x=e-g,d[4].y=f-k,d[5].x=e,d[5].y=f-i)}return d}let ho=[];const co=[[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]]],eo=[[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]],[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]]],fo=[[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]],[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]]],go=[[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]],[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]]],_a=[co,eo,fo,go];function wb(a){let b={},c,d;for(let e in a)[c,d]=a[e],b.hasOwnProperty(c)||(b[c]={}),b[c][d]=parseInt(e);return b}const Qj=[[wb(_a[0][0]),wb(_a[0][1])],[wb(_a[1][0]),wb(_a[1][1])],[wb(_a[2][0]),wb(_a[2][1])],[wb(_a[3][0]),wb(_a[3][1])]];function Wd(a,b,c){let d;switch(a){case ca.ODD_R:case ca.EVEN_R:d=c&1;break;case ca.ODD_Q:case ca.EVEN_Q:d=b&1;break}return d}function Uj(a,b,c){let d=a.mode,e=Wd(d,b.x,b.y),f=Qj[d][e],g=c.x-b.x,j=c.y-b.y;if(f.hasOwnProperty(g)){let i=f[g];if(i.hasOwnProperty(j))return i[j]}return null}function Xd(a,b,c,d,e={x:0,y:0}){e===!0&&(e=ko);let f=a.mode,g=b.x,j=b.y;if(d===1){let i=Wd(f,g,j);e.x=g+_a[f][i][c][0],e.y=j+_a[f][i][c][1]}else if(d===0)e.x=g,e.y=j;else{let i=Ra(f,g,j,!0),k,n,t;switch(c){case 1:k=i.x,n=i.y-d,t=i.z+d;break;case 2:k=i.x-d,n=i.y,t=i.z+d;break;case 3:k=i.x-d,n=i.y+d,t=i.z;break;case 4:k=i.x,n=i.y+d,t=i.z-d;break;case 5:k=i.x+d,n=i.y,t=i.z-d;break;default:k=i.x+d,n=i.y-d,t=i.z;break}Ca(f,k,n,t,e)}return e}let ko={x:0,y:0};function Vj(a,b,c,d={x:0,y:0}){return Xd(a,b,c,1,d)}function Wj(a,b,c,d){return(d+3)%6}const Xj=4/3,Yj=2/3;function Zj(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=jo),b-=a.x,c-=a.y;let e,f;switch(a.mode){case ca.ODD_R:case ca.EVEN_R:f=c*Xj/a.height,e=b/a.width-Yj*(c/a.height);break;case ca.ODD_Q:case ca.EVEN_Q:f=c/a.height-Yj*(b/a.width),e=b*Xj/a.width;break}let g=Pj(e,f,io);return Oj(g),Ca(a.mode,g.x,g.y,g.z,d),d}let io={x:0,y:0,z:0},jo={x:0,y:0};function $j(a,b,c,d={x:0,y:0}){typeof c==="string"&&(c=Qb[c]),d===!0&&(d=oo);let e=Ra(a.mode,b.x,b.y,!0),f=a.mode===ca.ODD_R||a.mode===ca.EVEN_R,g,j,i;return c&1&&(f?(g=e.y,j=e.x,i=e.z):(g=-e.x,j=-e.z,i=-e.y),e.x=g,e.y=j,e.z=i),c&2&&(f?(g=-e.y,j=-e.x,i=-e.z):(g=e.x,j=e.z,i=e.y)),Ca(a.mode,g,j,i,d),d}let oo={x:0,y:0};function ak(a,b,c,d,e={x:0,y:0}){e===!0&&(e=po);let f=b.x+c,g=b.y+d;switch(a.mode){case ca.ODD_R:(d&1)!==0&&((g&1)===0&&(f+=1));break;case ca.EVEN_R:(d&1)!==0&&((g&1)===0&&(f-=1));break;case ca.ODD_Q:(c&1)!==0&&((f&1)==0&&(g+=1));break;case ca.EVEN_Q:(c&1)!==0&&((f&1)==0&&(g-=1));break}return e.x=f,e.y=g,e}let po={x:0,y:0};function bk(a,b,c,d=[]){let e=Ra(a.mode,b.x,b.y,!0),f=e.x,g=e.y,j=e.z,i,k,n;for(n=c,i=0;i>=-c;i--)k=-i-n,d.push(Ca(a.mode,f+i,g+k,j+n));for(i=-c,k=1;k<=c;k++)n=-i-k,d.push(Ca(a.mode,f+i,g+k,j+n));for(k=c,n=-1;n>=-c;n--)i=-k-n,d.push(Ca(a.mode,f+i,g+k,j+n));for(n=-c,i=1;i<=c;i++)k=-i-n,d.push(Ca(a.mode,f+i,g+k,j+n));for(i=c,k=-1;k>=-c;k--)n=-i-k,d.push(Ca(a.mode,f+i,g+k,j+n));for(k=-c,n=1;n<=c-1;n++)i=-k-n,d.push(Ca(a.mode,f+i,g+k,j+n));return d}function ck(a,b,c,d={x:0,y:0}){d===!0&&(d=qo),c=nb(c,0,5);let e=Ra(a.mode,b.x,b.y,!0),f,g,j;switch(c){case 1:f=-e.z,g=-e.x,j=-e.y;break;case 2:f=e.y,g=e.z,j=e.x;break;case 3:f=-e.x,g=-e.y,j=-e.z;break;case 4:f=e.z,g=e.x,j=e.y;break;case 5:f=-e.y,g=-e.z,j=-e.x;break;default:f=e.x,g=e.y,j=e.z;break}return Ca(a.mode,f,g,j,d),d}let qo={x:0,y:0};class dk extends _j{get sides(){return 6}get allDirections(){return mo}get halfDirections(){return no}directionBetween(a,b,c=!0){return Rj(this,a,b,c)}directionNormalize(a){return Yd(this,a)}getDistance(a,b,c=!1){return Sj(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return Tj(this,a,b,c)}getNeighborTileDirection(a,b){return Uj(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return Vj(this,a,b,c)}getOppositeDirection(a,b,c){return Wj(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return Zj(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return Xd(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return Vd(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return $j(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return ak(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return bk(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return ck(this,a,b,c)}restoreOrigin(){return _d(this),this}saveOrigin(){return Zd(this),this}}const mo=[0,1,2,3,4,5],no=[0,1,2];var Aa;(function(a){a[a.random=0]="random",a[a.diagonal=1]="diagonal",a[a.straight=2]="straight",a[a.line=3]="line",a[a.astar=10]="astar",a[a["astar-random"]=11]="astar-random",a[a["astar-line"]=12]="astar-line"})(Aa||(Aa={}));const Tb=null;class en{constructor(a){this.content=[],this.scoreFunction=a}clear(){this.content.length=0}push(a){this.content.push(a),this.sinkDown(this.content.length-1)}pop(){let a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.bubbleUp(0)),a}remove(a){let b=this.content.indexOf(a),c=this.content.pop();b!==this.content.length-1&&(this.content[b]=c,this.scoreFunction(c)<this.scoreFunction(a)?this.sinkDown(b):this.bubbleUp(b))}get size(){return this.content.length}rescoreElement(a){this.sinkDown(this.content.indexOf(a))}sinkDown(a){let b=this.content[a];for(;a>0;){let c=(a+1>>1)-1,d=this.content[c];if(this.scoreFunction(b)<this.scoreFunction(d))this.content[c]=b,this.content[a]=d,a=c;else break}}bubbleUp(a){let b=this.content.length,c=this.content[a],d=this.scoreFunction(c);for(;;){let e=a+1<<1,f=e-1,g=null,j;if(f<b){let i=this.content[f];j=this.scoreFunction(i),j<d&&(g=f)}if(e<b){let i=this.content[e],k=this.scoreFunction(i);k<(g===null?d:j)&&(g=e)}if(g!==null)this.content[a]=this.content[g],this.content[g]=c,a=g;else break}}}let uda=new en(a=>a.f);const Pe=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d=d.prevNodes[0];return c.reverse()};const hn=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d.prevNodes.length===1?d=d.prevNodes[0]:d=nc(d.prevNodes);return c.reverse()};const gn=function(a,b,c=[]){let d=b,e=b.angleTo(a);for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1)d=d.prevNodes[0];else{let f=Infinity;for(let g=1,j=d.prevNodes.length;g<j;g++){let i=d.prevNodes[g],k=Math.abs(b.angleTo(i)-e);k<f&&(f=k,d=i)}}}return c.reverse()};const fn=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let j=0,i=d.prevNodes.length;j<i;j++){f=d.prevNodes[j],g=f.logicDirTo(d);if(g!==e)break}e=g,d=f}}return c.reverse()};const jn=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let j=0,i=d.prevNodes.length;j<i;j++){f=d.prevNodes[j],g=f.logicDirTo(d);if(g===e)break}e=g,d=f}}return c.reverse()};let _b={};_b[Aa.astar]=Pe;_b[Aa["astar-line"]]=Pe;_b[Aa["astar-random"]]=Pe;_b[Aa.random]=hn;_b[Aa.line]=gn;_b[Aa.diagonal]=fn;_b[Aa.straight]=jn;class wk{constructor(){this.prevNodes=[]}shutdown(){this.key=void 0,this.prevNodes.length=0}destroy(){this.shutdown()}reset(a){this.key=a,this.f=0,this.g=0,this.h=void 0,this.closerH=void 0,this.visited=!1,this.closed=!1}heuristic(a,b,c){if(b===null)return 0;let d,e=this.distanceTo(a)*this.manager.weight;switch(b){case Aa.astar:d=e;break;case Aa["astar-line"]:if(c!==void 0){let f=a.angleTo(c)-this.angleTo(c);d=e+Math.abs(f)}else d=e;case Aa["astar-random"]:d=e+Math.random();break;default:d=e;break}return d}getNextNodes(){return[]}getCost(a){return Tb}distanceTo(a){return 0}angleTo(a){return 0}logicDirTo(a){return 0}getNode(a,b=!1){return this.manager.getNode(a,b)}}function Ub(a){for(let b=a.length-1;b>0;b--){let c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a}class Mo extends wk{constructor(a){super();this.isTileXYZ=!0;this.pathFinder=a}reset(a){super.reset(a),this.key=a,xk(a,this),this._px=void 0,this._py=void 0,this.cost=void 0}getNextNodes(){let a=Ob.GetNeighborTileXY(this.board,this);this.pathFinder.shuffleNeighbors&&Ub(a);let b=[];return a.forEach(c=>{let d=this.getNode(Va(c.x,c.y),!0);b.push(d)}),b}getCost(a){return this.pathFinder.cacheCost?this.cost===void 0&&(this.cost=this.pathFinder.getCost(this,a)):this.cost=this.pathFinder.getCost(this,a),this.cost}distanceTo(a){return Za.GetDistance(this.board,this,a,!0)}angleTo(a){return Rb(this.worldX,this.wroldY,a.worldX,a.worldX)}logicDirTo(a){return Ob.GetNeighborTileDirection(this.board,this,a)}get board(){return this.pathFinder.board}get worldX(){if(this._px===void 0){let a=ub.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._px}get wroldY(){if(this._py===void 0){let a=ub.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._py}}class Ho{constructor(){this.data=[];this.visited=new Set()}push(a,b){if(Array.isArray(a)){let d=a;for(let e=0,f=d.length;e<f;e++)this.push(d[e]);return this}if(typeof a==="object"){let d=a;a=d.x,b=d.y}let c=`${a},${b}`;return this.visited.has(c)?this:(this.data.push({x:a,y:b}),this.visited.add(c),this)}pop(){return this.data.pop()}get length(){return this.data.length}clear(){return this.data.length=0,this.visited.clear(),this}}let pV=new Ho();var Pd;(function(a){a[a.direction=0]="direction",a[a.angle=1]="angle"})(Pd||(Pd={}));function xe(a,b,c){const d=Math.ceil(b*a.resolution),e=Math.ceil(c*a.resolution),f=a.canvas;if(f.width===d||f.height===e){ye(a);return}f.width=d,f.height=e,a.texture.setSize(b,c),a.setSize(b,c),a.updateTexture()}function ye(a){a.context.clearRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function mh(a,b="#fff"){let c=a.context;c.fillStyle=b,c.fillRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function ze(a,b,c){const d=new Image();d.onload=function(){const e=a.resolution,f=d.width/e,g=d.height/e;xe(a,f,g),a.context.drawImage(d,0,0),a.updateTexture(),c&&c(),d.onload=null,d.src="",d.remove()},d.src=b}function nh(a,b){return new Promise(function(c,d){ze(a,b,c)})}function oh(a,b,c){return a.canvas.toDataURL(b,c)}function ph(a,b,c,d=[0,0,0,0]){const e=a.context.getImageData(b,c,1,1).data;return d[0]=e[0],d[1]=e[1],d[2]=e[2],d[3]=e[3],d}function qh(a,b,c,d,e,f,g){g===void 0&&(g=d!==0||e!==0||f!==0?255:0);const j=a.context.createImageData(1,1);j.data[0]=d,j.data[1]=e,j.data[2]=f,j.data[3]=g,a.context.putImageData(j,b,c),a.updateTexture()}class Zc extends md{constructor(a=0,b=0,c=32,d=32){super(a,b,fc());this.type="rexCanvas";const e=xa.get();this.resolution=e.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.resize(c,d)}updateTexture(){return this.texture.binding&&this.texture.binding.update(),this.setDirty(aa.TEXTURE),this}destroy(a){this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}resize(a,b){return xe(this,a,b),this}clear(){return ye(this),this}}function Db(a,b,c,d=1){let e;if(typeof a==="string"){let j=Fa.get();j.has(a)||j.add(a,fc()),e=j.get(a)}else e=a;let f=e.image,g=f.getContext("2d");return c?b.call(c,f,g):b(f,g),e.setSize(f.width/d,f.height/d),e.binding&&e.binding.update(),e}var dn;(function(a){a[a.right=0]="right",a[a.down=1]="down",a[a.left=2]="left",a[a.up=3]="up"})(dn||(dn={}));function pm(a,b){b.width!==a.width&&(b.width=a.width),b.height!==a.height&&(b.height=a.height);let c=b.getContext("2d");return c.drawImage(a.texture.image,a.x,a.y,a.width,a.height),b}function rh(a,b,c=0,d=0,e=a.width,f=a.height){const g=a.resolution,j=a.canvas,i=Math.ceil(e*g),k=Math.ceil(f*g);Db(b,function(n,t){n.width!==i&&(n.width=i),n.height!==k&&(n.height=k),t.clearRect(0,0,i,k),t.drawImage(j,c,d,i,k)},void 0,a.resolution)}function sh(a,b,c){const d=Fa.get();if(!d.has(b))return;pm(d.get(b).getFrame(c),a.canvas);const e=a.canvas.width,f=a.canvas.height,g=a.resolution,j=e/g,i=f/g;a.texture.setSize(j,i),a.setSize(j,i),a.updateTexture()}class om extends Zc{fill(a="#fff"){return mh(this,a),this}getCanvas(){return this.canvas}getContext(){return this.context}getDataURL(a,b){return oh(this,a,b)}getPixel(a,b,c=[0,0,0,0]){return ph(this,a,b,c)}generateTexture(a,b=0,c=0,d=this.width,e=this.height){return rh(this,a,b,c,d,e),this}loadFromURL(a,b){return ze(this,a,b),this}loadFromURLPromise(a){return nh(this,a)}loadTexture(a,b){return sh(this,a,b),this}setPixel(a,b,c,d,e,f){return qh(this,a,b,c,d,e,f),this}}function ai(a,b){return a.events.delete(b),a}function $h(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);let e=d.size;for(const f of d){f.callback.apply(f.context,c),f.once&&d.delete(f),e--;if(e===0)break}return d.size===0&&a.events.delete(b),!0}class ad{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function ci(a){return[...a.events.keys()]}function bi(a,b){const c=a.events.get(b);return c?c.size:0}function di(a,b){const c=[],d=a.events.get(b);return d.forEach(e=>{c.push(e.callback)}),c}function _h(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof ad)g.delete(c);else{const j=!d,i=e!==void 0;for(const k of g)k.callback===c&&(j&&k.context===d)&&(i&&k.once===e)&&g.delete(k)}return g.size===0&&f.delete(b),a}function $c(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new ad(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function Zh(a,b,c,d=a){return $c(a,b,c,d,!0)}function Re(a,b){b?a.events.delete(b):a.events.clear()}function pn(a){return class extends a{constructor(){super(...arguments);this.events=null}setEventEmitter(b){return this.destroyEventEmitter(),this.privateEE=b===void 0,this.privateEE?this.events=new Map():b?this.events=b.events:this.events=null,this.lastEventInstance=null,this}getEventEmitter(){return this}clearEventEmitter(){return this.setEventEmitter(null),this}destroyEventEmitter(){return this.lastEventInstance=null,this.events&&this.privateEE&&(Re(this),this.events=null),this}on(b,c,d=this,e=!1){return this.lastEventInstance=null,this.events&&(this.lastEventInstance=$c(this,b,c,d,e)),this}once(b,c,d=this){return this.lastEventInstance=null,this.events&&(this.lastEventInstance=Zh(this,b,c,d)),this}off(b,c,d,e){return this.lastEventInstance=null,this.events&&_h(this,b,c,d,e),this}emit(b,...c){return this.lastEventInstance=null,this.events&&$h(this,b,...c),this}removeAllListeners(b){return this.lastEventInstance=null,this.events&&Re(this,b),this}clearEvent(b){return this.lastEventInstance=null,this.events&&ai(this,b),this}getListenerCount(b){return this.lastEventInstance=null,this.events?bi(this,b):0}getEventNames(){return this.lastEventInstance=null,this.events?ci(this):[]}getListeners(b){return this.lastEventInstance=null,this.events?di(this,b):[]}}}const ta=pn(class{});var ib;(function(a){a[a.no=0]="no",a[a.lazy=1]="lazy",a[a.always=2]="always"})(ib||(ib={}));const fi="complete";class Ne extends ta{constructor(a,{eventEmitter:b,tickingMode:c=ib.lazy}={}){super();this._isRunning=!1;this.tickingState=!1;this.parent=a,this.setEventEmitter(b),this.setTickingMode(c)}boot(){this.tickingMode===ib.always&&!this.tickingState&&this.startTicking()}shutdown(){this.destroyEventEmitter(),this.tickingState&&this.stopTicking()}setTickingMode(a){typeof a==="string"&&(a=ib[a]),this.tickingMode=a}startTicking(){this.tickingState=!0}stopTicking(){this.tickingState=!1}get isRunning(){return this._isRunning}set isRunning(a){if(this._isRunning===a)return;this._isRunning=a,this.tickingMode===ib.lazy&&a!=this.tickingState&&(a?this.startTicking():this.stopTicking())}start(){return this.isRunning=!0,this}pause(){return this.isRunning=!1,this}resume(){return this.isRunning=!0,this}stop(){return this.isRunning=!1,this}complete(a=fi){this.isRunning=!1,this.emit(a,this.parent,this)}}class Le extends Ne{constructor(a,{updater:b=a,isRunning:c=!1,timeScale:d=1,now:e=0,tickingMode:f=ib.lazy}={}){super(a,arguments[1]);this.updater=null;this.timeScale=1;this.now=0;this.parent=a,this.setUpdater(b),this.isRunning=c,this.timeScale=d,this.now=e,this.setTickingMode(f),this.boot()}resetFromJSON({isRunning:a=!1,timeScale:b=1,now:c=0,tickingMode:d=ib.lazy}={}){return this.isRunning=a,this.timeScale=b,this.now=c,this.setTickingMode(d),this}toJSON(){return{isRunning:this.isRunning,timeScale:this.timeScale,now:this.now,tickingMode:this.tickingMode}}boot(){super.boot(),Ma(this.parent,"destroy",this.destroy,this)}shutdown(){super.shutdown(),this.parent=void 0,this.updater=void 0}destroy(){this.shutdown()}setUpdater(a){return a instanceof dc&&(a=a.world),a instanceof cd||a instanceof Jb?this.updater=a:this.updater=null,this}startTicking(){this.update===null&&this.setUpdater(this.parent);if(this.update===null)return;super.startTicking(),this.updater&&Ma(this.updater,"update",this.update,this)}stopTicking(){super.stopTicking(),this.updater&&mb(this.updater,"update",this.update,this)}start(a=0){return this.now=a,super.start(),this}seek(a){return this.now=a,this}update(a){return!this.isRunning||this.timeScale===0?this:(this.now+=a*this.timeScale,this)}}const dfa=Ia(Af());const Zf="receive";const zk={receive:Zf};function Ak(a,b){(!a.sendToRef||a.sendToRef.key!==a.receiverID)&&(a.sendToRef=a.database.ref(a.rootPath).child(a.receiverID));if(b===void 0)return a.sendToRef.remove();let c={message:b,senderID:a.userID,stamp:a.stamp};return a.userName!==void 0&&(c.senderName=a.userName),a.skipFirst=!1,a.stamp=!a.stamp,a.sendToRef.set(c)}function Bk(a){if(a.isReceiving&&a.receiverRef.key===a.receiverID)return;Yf(a),a.isReceiving=!0,a.skipFirst=!0,a.receiverRef=a.database.ref(a.rootPath).child(a.receiverID),a.receiverRef.on("value",Dk,a),a.receiverRef.onDisconnect().remove()}function Yf(a){if(!a.isReceiving)return;a.isReceiving=!1,a.receiverRef.off("value",Dk,a),a.receiverRef.remove(),a.receiverRef.onDisconnect().cancel()}function Dk(a){if(this.skipFirst){this.skipFirst=!1;return}let b=a.val();if(b==null)return;delete b.stamp,this.history.add(b),this.emit(this.eventNames.receive,b)}class Ck{constructor({maxLength:a=-1}={}){this.maxLength=a,this.records=[]}add(a){return this.maxLength===0?this:(this.records.push(a),this.maxLength>0&&this.records.length>this.maxLength&&this.records.shift(),this)}clear(){return this.records.length=0,this}changeUserName(a,b){return this.maxLength===0?this:(this.records.forEach(c=>{c.senderID===a&&(c.senderName=b)}),this)}}const uY=Ia(Na());class rc extends ta{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d,receiverID:e="",history:f=0,eventNames:g=zk}={}){super();this.setEventEmitter(a),this.eventNames=g,this.database=uY.database(),this.setRootPath(b),this.skipFirst=!0,this.stamp=!1,this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.isReceiving=!1,f===!0?f=-1:f===!1&&(f=0),this.history=new Ck({maxLength:f})}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.sendToRef=void 0,this.receiverRef=void 0,this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.receiverID=a,this}changeUserName(a,b){return a===this.userID&&(this.userName=b),this.history.changeUserName(a,b),this}getHistory(){return this.history.records}clearHistory(){return this.history.clear(),this}send(a){return Ak(this,a)}startReceiving(){return Bk(this),this}stopReceiving(){return Yf(this),this}}const hq="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function ie(a,b,c=hq){let d=b===void 0?a:Kc(a,b),e="";for(let f=0;f<d;f++)e+=nc(Array.from(c));return e}const G4=Ia(Na());var ra;(function(a){a[a["1d"]=1]="1d",a[a["2d"]=2]="2d",a[a["3d"]=3]="3d"})(ra||(ra={}));const eg="init";const fg="update";const _f="addkey0";const $f="addkey1";const ag="addkey2";const gg="removekey0";const hg="removekey1";const ig="removekey2";const bg="changekey0";const cg="changekey1";const dg="changekey2";const Ek={init:eg,update:fg,addkey0:_f,removekey0:gg,changekey0:bg,addkey1:$f,removekey1:hg,changekey1:cg,addkey2:ag,removekey2:ig,changekey2:dg};function sn(a){return a==null||a===""||a.length===0}function gq(a,b,c={}){let d=a;if(!sn(b)){typeof b==="string"&&(b=b.split("."));let e;for(let f=0,g=b.length;f<g;f++){e=b[f];if(d[e]==null||typeof d[e]!=="object"){let j;f===g-1?j=c:j={},d[e]=j}d=d[e]}}return d}function tn(a,b,c){if(typeof a!=="object")return;if(sn(b)){if(c==null)return;typeof c==="object"&&(a=c)}else{typeof b==="string"&&(b=b.split("."));let d=b.pop(),e=gq(a,b);e[d]=c}return a}function rn(a){return JSON.parse(JSON.stringify(a))}class Fk{constructor(){this.data={}}setValue(a,b){return a==null?this.clear():typeof a==="object"?this.data=a:tn(this.data,a,b),this}getValue(a){if(a==null)return this.data;{typeof a==="string"&&(a=a.split("."));let b=this.data;for(let c=0,d=a.length;c<d;c++){if(!ei(b))return;b=b[a[c]]}return b}}cloneValue(a){return rn(this.getValue(a))}removeKey(a){if(a==null)this.clear();else{typeof a==="string"&&(a=a.split("."));let b=a.pop(),c=this.data;for(let d=0,e=a.length;d<e;d++){if(!ei(c))return this;c=c[a[d]]}ei(c)&&delete c[b]}return this}clear(){return Se(this.data),this}incValue(a,b=1){let c=this.getValue(a);return typeof c!=="number"&&(c=0),this.setValue(a,c+b),this}mulValue(a,b){let c=this.getValue(a);return typeof c!=="number"&&(c=1),this.setValue(a,c*b),this}}function ei(a){return a!=null&&typeof a==="object"}const LZ=Ia(Na());class Vb extends ta{constructor({eventEmitter:a,parent:b,key:c,type:d,eventNames:e,table:f}={}){super();this.setEventEmitter(a),this.parent=b,this.children=new Map(),this.key=c,this.parent?this.fullKeyPath=Pk(this.parent.fullKeyPath,this.key):this.fullKeyPath="",this.type=d,this.eventNames=e,this.table=f,this.database=LZ.database(),this.setRootPath()}destroy(){this.stopUpdate().clear().destroyEventEmitter()}setRootPath(a){if(a===void 0){let b=this.parent?this.parent.rootPath:"";a=`${b}/${this.key}`}this.rootPath=a,this.rootRef=a!==""?this.database.ref(a):void 0;for(const[b,c]of this.children)c instanceof Vb&&c.setRootPath();return this}setData(a,b){if(arguments.length===0)this.clear();else if(typeof a=="string")this.setChildData(a,b);else{let c=a;for(const[d,e]of this.children)c.hasOwnProperty(d)||this.removeChild(d);for(let d in c)this.setChildData(d,c[d])}return this}clear(){this.table.removeKey(this.fullKeyPath);for(const[a,b]of this.children)this.removeChild(a);return this}get childClass(){return null}setChildData(a,b){const c=Pk(this.fullKeyPath,a);this.table.setValue(c,b);if(!(typeof b!=="object")){if(this.children.has(a))this.children.get(a).setData(b);else if(this.childClass){let d=new this.childClass({parent:this,key:a,type:this.type,eventEmitter:this.eventEmitter,eventNames:this.eventNames,table:this.table});d.startUpdate(),this.children.set(a,d)}}return this}removeChild(a){return this.children.has(a)&&(this.children.get(a).destroy(),this.children.delete(a)),this}startUpdate(){return this}stopUpdate(){return this}}function Pk(a,b){return a==null||a===""?b:b==null||b===""?a:`${a}.${b}`}class Oc extends Vb{startUpdate(){return this.rootRef.on("child_added",this.addCol,this),this.rootRef.on("child_removed",this.removeCol,this),this.rootRef.on("child_changed",this.changeColValue,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addCol,this),this.rootRef.off("child_removed",this.removeCol,this),this.rootRef.off("child_changed",this.changeColValue,this),this}addCol(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["1d"]:this.emit(this.eventNames.addkey0,b,c);break;case ra["2d"]:this.emit(this.eventNames.addkey1,this.key,b,c);break;default:this.emit(this.eventNames.addkey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}removeCol(a){const b=a.key;this.removeChild(b);switch(this.type){case ra["1d"]:this.emit(this.eventNames.removekey0,b);break;case ra["2d"]:this.emit(this.eventNames.removekey1,this.key,b);break;default:this.emit(this.eventNames.removekey2,this.pageKey,this.key,b);break}this.emit(this.eventNames.update,this.table.data)}changeColValue(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["1d"]:this.emit(this.eventNames.changekey0,b,c);break;case ra["2d"]:this.emit(this.eventNames.changekey1,this.key,b,c);break;default:this.emit(this.eventNames.changekey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}get pageKey(){return this.parent.key}}class Pc extends Vb{startUpdate(){return this.rootRef.on("child_added",this.addRow,this),this.rootRef.on("child_removed",this.removeRow,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addRow,this),this.rootRef.off("child_removed",this.removeRow,this),this}addRow(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["2d"]:this.emit(this.eventNames.addkey0,b,c);break;default:this.emit(this.eventNames.addkey1,this.key,b,c);break}}removeRow(a){const b=a.key;this.removeChild(b);switch(this.type){case ra["2d"]:this.emit(this.eventNames.removekey0,b);break;default:this.emit(this.eventNames.removekey1,this.key,b);break}}get childClass(){return Oc}}class jg extends Vb{startUpdate(){return this.rootRef.on("child_added",this.addPage,this),this.rootRef.on("child_removed",this.removePage,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addPage,this),this.rootRef.off("child_removed",this.removePage,this),this}addPage(a){const b=a.key,c=a.val();this.setData(b,c),this.emit(this.eventNames.addkey0,b,c)}removePage(a){const b=a.key;this.removeChild(b),this.emit(this.eventNames.removekey0,b)}get childClass(){return Pc}}const ee={};ee[ra["1d"]]=Oc;ee[ra["2d"]]=Pc;ee[ra["3d"]]=jg;function Gk(a){return new ee[a.tableType]({type:a.tableType,eventEmitter:a.eventEmitter,eventNames:a.eventNames,table:a.table})}function Hk(a){return a.updater.clear(),a.initialFlag=!1,a.rootRef.once("value").then(function(b){let c=b.val()??{};return a.table.setValue(c),a.emit(a.eventNames.init,c),a.initialFlag=!0,Promise.resolve(c)})}function Ha(a,b,c,d){let e=a.rootRef;return e=b?e.child(b):e,e=c?e.child(c):e,e=d?e.child(d):e,e}function Ik(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ha(a,c,d,e).set(f)}function Jk(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;default:c=b[0];break}return Ha(a,c,d,e).remove()}function Kk(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ha(a,c,d,e).transaction(function(g){return g===null&&(g=0),g+f})}function Lk(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ha(a,c,d,e).transaction(f)}function Mk(a,b){return Ha(a).update(b)}function Nk(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;case 1:c=b[0];break}return Ha(a,c,d,e).onDisconnect().remove()}function Ok(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ha(a,c,d,e).onDisconnect().set(f)}const OY=Ia(Na());class sc extends ta{constructor({eventEmitter:a,root:b="",type:c=ra["3d"],eventNames:d=Ek}={}){super();this.setEventEmitter(a),this.eventNames=d,this.database=OY.database(),this.table=new Fk(),this.setTableType(c),this.setRootPath(b),this.initialFlag=!1}destroy(){this.updater.destroy(),this.destroyEventEmitter().stopUpdate()}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):null,this.updater.setRootPath(a),this}setTableType(a){return typeof a==="string"&&(a=ra[a]),this.tableType=a,this.updater&&this.updater.destroy(),this.updater=Gk(this),this}startUpdate(){return Hk(this),this.updater.startUpdate(),this}stopUpdate(){return this.updater.stopUpdate(),this}clear(){return this.updater.clear(),this}getData(){return this.table.getValue(...arguments)}cloneData(){return this.table.cloneValue(...arguments)}getItemRef(a,b,c){return Ha(this,a,b,c)}setData(...a){return Ik(this,...a)}removeData(...a){return Jk(this,...a)}incValue(...a){return Kk(this,...a)}transaction(...a){return Lk(this,...a)}updateData(a){return Mk(this,a)}removeDataOnDisconnect(...a){return Nk(this,...a)}setDataOnDisconnect(...a){return Ok(this,...a)}}const Q3=Ia(Na());var hh;(function(a){a.d="d",a.w="w",a.m="m",a.y="y",a.day="d",a.week="w",a.month="m",a.year="y"})(hh||(hh={}));var Xc;(function(a){a.d="tagD",a.w="tagW",a.m="tagM",a.y="tagY"})(Xc||(Xc={}));var Yc;(function(a){a.d="scoreD",a.w="scoreW",a.m="scoreM",a.y="scoreY"})(Yc||(Yc={}));var Xl;(function(a){a.d="day",a.w="week",a.m="month",a.y="year"})(Xl||(Xl={}));function lh({query:a,totalLines:b=Infinity,linesPerPage:c=1e3,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g}){return nm({query:a,remainderLines:b,linesPerPage:c,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g})}function nm(a){let b=a.query;a.startDocRef&&(b=b[a.startMode](a.startDocRef));let c=Math.min(a.remainderLines,a.linesPerPage);return a.remainderLines-=c,b.limit(c).get().then(function(d){let e=a.remainderLines===0||d.size<c,f=!1;a.forEachPageCallback&&(f=a.forEachPageCallback(d)||!1),e=e||f;if(e){let g;return a.resolveCallback&&(g=a.resolveCallback()),Promise.resolve(g)}else return a.startDocRef=d.docs[d.size-1],a.startMode="startAfter",nm(a)})}function La(a,b=Infinity,c=0,d,e){let f=[],g=0;return lh({query:a,totalLines:c+b,startDocRef:d,startMode:e,forEachPageCallback:function(j){let i,k=j.size,n=c-g;n<=0?i=j.docs:n<k&&(i=j.docs.slice(n,k)),i&&f.push(...i),g+=k},resolveCallback:function(){return f}})}const V6=Ia(Na());function em(a,b,c=0){return La(a.nextQuery,b,c,a.baselineDocRef,a.baselineMode).then(function(d){let e=d.length;return a.cacheItems=d,a.pageIndex=void 0,a.startItemIndex=c,a.endItemIndex=a.startItemIndex+e-1,a.isFullPage=b===void 0?!0:e===b,Promise.resolve(a.cacheItems)})}const t6=Ia(Na());class we{constructor({query:a={next:void 0,previous:void 0},itemCount:b=100,baselineDoc:c,baselineMode:d="startAt"}={}){this.setQuery(a),this.setItemCount(b),this.setBaselineDoc(c,d),this.pageIndex=void 0,this.baselineDocRef=void 0,this.baselineMode="startAt",this.startItemIndex=void 0,this.endItemIndex=void 0,this.cacheItems=void 0,this.isFullPage=void 0}setQuery(a,b){if(a instanceof t6.firestore.Query)this.nextQuery=a,this.prevQuery=b;else{var c=a;this.nextQuery=c.next,this.prevQuery=c.previous}return this.pageIndex=null,this.isFullPage=!0,this}setItemCount(a){return this.itemCount=a,this}setBaselineDoc(a,b){return a?(this.baselineDocRef=a.ref,this.baselineMode=b):this.baselineDocRef=void 0,this}load(a,b=0){return em(this,a,b)}loadFirstPage(){return this._loadFirstPage()}loadNextPage(){return this.pageIndex==null?this._loadFirstPage():this._loadNextPage()}loadPreviousPage(){return this.pageIndex==null||this.pageIndex===1?this._loadFirstPage():this._loadPreviousPage()}loadCurrentPage(){return this.pageIndex==null||this.pageIndex===0?this._loadFirstPage():this._loadCurrentPage()}}function km(a){return La(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=null,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function fm(a){return La(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,Promise.resolve(a.cacheItems)})}function lm(a){return La(a.nextQuery,a.itemCount,0,a.currPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=a.currPageEndDocRef,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function gm(a){let b=(a.pageIndex+1)*a.itemCount;return La(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function mm(a){return La(a.prevQuery,a.itemCount+1,0,a.currPageStartDocRef,"startAfter").then(function(b){let c=b.length-1;return a.cacheItems=b,a.cacheItems.pop(),a.cacheItems.reverse(),a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-c+1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=b[c].ref,a.currPageStartDocRef=b[c-1].ref,a.currPageEndDocRef=b[0].ref,Promise.resolve(a.cacheItems)})}function hm(a){let b=(a.pageIndex-1)*a.itemCount;return La(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-d+1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function jm(a){return La(a.nextQuery,a.itemCount,0,a.prevPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function im(a){let b=a.pageIndex*a.itemCount;return La(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}class ih extends we{_loadFirstPage(){return fm(this)}_loadNextPage(){return gm(this)}_loadPreviousPage(){return hm(this)}_loadCurrentPage(){return im(this)}}const t5=Ia(Na());class ve extends we{_loadFirstPage(){return km(this)}_loadNextPage(){return lm(this)}_loadPreviousPage(){return mm(this)}_loadCurrentPage(){return jm(this)}}const m6=Ia(Na());function Zl(a,b){let c={senderID:a.userID,message:b,timestamp:m6.firestore.FieldValue.serverTimestamp()};return a.userName!==void 0&&(c.senderName=a.userName),a.receiverID!==void 0&&(c.receiverID=a.receiverID),a.rootRef.add(c)}function jh(a,b=a.receiverID){let c=a.rootRef;return c=b!==void 0?c.where("receiverID","==",b):c,c}function Yl(a,b=a.receiverID){let c=jh(a,b),d=c.orderBy("timestamp"),e=c.orderBy("timestamp","desc");return{next:d,previous:e}}const kh="receive";function _l(a){let b=jh(a).orderBy("timestamp","desc").limit(1);a.unsubscribe=b.onSnapshot({includeMetadataChanges:!0},function(c){if(c.size>0){let d=c.docs[0];if(d.metadata.hasPendingWrites){a.skipFirst&&(a.skipFirst=!1);return}cm(a,a.receiverID,d);if(a.skipFirst)a.skipFirst=!1;else{let e=dm(d);a.cacheMessages.push(e),a.emit(kh,e)}}else a.skipFirst&&(a.skipFirst=!1)},function(c){debugger})}function $l(a){a.unsubscribe&&a.unsubscribe(),a.resetQueryFlag=!0,a.cacheMessages.length=0}function am(a){return cm(a),a.page.loadNextPage().then(function(b){let c=[];for(let d=0,e=b.length;d<e;d++)c.push(dm(b[d]));return a.cacheMessages.splice(0,0,...c),Promise.resolve(c)})}function cm(a,b=a.receiverID,c){if(!a.resetQueryFlag)return;a.resetQueryFlag=!1;let d=a.skipFirst?"startAt":"startAfter";a.page.setBaselineDoc(c,d).setQuery(Yl(a,b));return}function dm(a){let b=a.data();return b.timestamp=b.timestamp.toDate(),b}const d6=Ia(Na());class bm extends ta{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d="",receiverID:e,pageItemCount:f=100}={}){super();this.setEventEmitter(a),this.database=d6.firestore(),this.setRootPath(b),this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.skipFirst=!0,this.unsubscribe=void 0,this.page=new ve(),this.setPageItemCount(f),this.resetQueryFlag=!0,this.cacheMessages=[]}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.resetQueryFlag=this.resetQueryFlag||this.rootPath!==a,this.rootPath=a,this.rootRef=this.database.collection(a),this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.resetQueryFlag=this.resetQueryFlag||this.receiverID!==a,this.receiverID=a,this}setPageItemCount(a){return this.page.setItemCount(a),this}get hasPreviousMessage(){return this.page.isFullPage!==!1}send(a){return Zl(this,a)}startReceiving(){return _l(this),this}stopReceiving(){return $l(this),this}loadPreviousMessages(){return am(this)}}const ng="join";const og="leave";const qg="init";const pg="update";const mg="changename";const lg="change";const Uk={join:ng,leave:og,update:pg,change:lg,init:qg,changename:mg};var rb;(function(a){a[a.once=0]="once",a[a.child=1]="child",a[a.all=2]="all"})(rb||(rb={}));const _g="add";const ah="remove";const $g="change";const bh="update";const Ml={add:_g,remove:ah,update:bh,change:$g};function te(a){a.items.length=0,a.itemID2Index.clear()}function Nl(a){return a.items}function Ol(a,b){return a.itemID2Index.has(b)}function Zg(a,b){return b==null?null:a.itemID2Index.get(b)}function Pl(a,b){if(b==null)return null;let c=Zg(a,b);return c==null?null:a.items[c]}function Ql(a,b,c){a.items.forEach(b,c)}function Cb(a){a.itemID2Index.clear();let b=a.items;for(var c=0,d=b.length;c<d;c++){let e=b[c][a.keyItemID];a.itemID2Index.set(e,c)}}function Rl(a,b){if(b>=a.length)return;let c=a.length-1,d=a[b];for(let e=b;e<c;e++)a[e]=a[e+1];return a.length=c,d}function ch(a,b){let c=eh.call(this,a,b);Cb(this),this.emit(this.eventNames.add,c),this.emit(this.eventNames.update,this.items)}function Vc(a,b){let c=Sl.call(this,a);Cb(this);let d=eh.call(this,a,b);Cb(this),this.emit(this.eventNames.change,d,c),this.emit(this.eventNames.update,this.items)}function dh(a){let b=Sl.call(this,a);Cb(this),this.emit(this.eventNames.remove,b),this.emit(this.eventNames.update,this.items)}function Wc(a){te(this),a.forEach(function(b){eh.call(this,b,null,!0)}.bind(this)),Cb(this),this.emit(this.eventNames.update,this.items)}function eh(a,b,c=!1){let d,e=this.getItemCallback,f=this.getItemCallbackScope;f?d=e.call(f,a):d=e(a);if(c)return this.items.push(d),d;if(b==null)this.items.unshift(d);else{let g=this.itemID2Index.get(b);g===this.items.length-1?this.items.push(d):this.items.splice(g+1,0,d)}return d}function Sl(a){let b=this.itemID2Index.get(a.key),c=Rl(this.items,b);return c}const Vl={start(a,b){a.isUpdating=!1,b.once("value",Wc,a)},stop(a){}};const Ul={start(a,b){b.on("child_added",ch,a),b.on("child_removed",dh,a),b.on("child_moved",Vc,a),b.on("child_changed",Vc,a)},stop(a){a.query.off("child_added",ch,a),a.query.off("child_removed",dh,a),a.query.off("child_moved",Vc,a),a.query.off("child_changed",Vc,a)}};const Tl={start(a,b){b.on("value",Wc,a)},stop(a){a.query.off("value",Wc,a)}};const Uc={};Uc[rb.all]=Tl;Uc[rb.child]=Ul;Uc[rb.once]=Vl;class Wb extends ta{constructor({eventEmitter:a,itemIDKey:b="__itemID__",mode:c=rb.child,getItemCallback:d=gp,getItemCallbackScope:e,query:f,eventNames:g=Ml}={}){super();this.setEventEmitter(a),this.eventNames=g,this.isUpdating=!1,this.items=[],this.itemID2Index=new Map(),this.setItemIDKey(b),this.setMode(c),e===void 0&&(e=this),this.setGetitemCallback(d,e),this.setQuery(f)}destroy(){this.stopUpdate().clear()}setItemIDKey(a){return this.keyItemID=a,this}setMode(a){return typeof a==="string"&&(a=rb[a]),this.mode=a,this.updater=Uc[a],this}setGetitemCallback(a,b){return this.getItemCallback=a,this.getItemCallbackScope=b,this}setQuery(a){return this.query=a,this}startUpdate(a){if(a)this.setQuery(a);else if(this.query)a=this.query;else return this;return this.stopUpdate().clear(),this.isUpdating=!0,this.updater.start(this,a),this}stopUpdate(){return!this.query||!this.isUpdating?this:(this.isUpdating=!1,this.updater.stop(this),this)}clear(){return te(this),this}getItems(){return Nl(this)}hasItem(a){return Ol(this,a)}getItemIndexFromItemID(a){return Zg(this,a)}getItemFromItemID(a){return Pl(this,a)}forEach(a,b){return Ql(this,a,b),this}updateItemID2Index(){return Cb(this),this}}const gp=function(a){let b=a.val();return b[this.keyItemID]=a.key,b};function yb(a,b=a.userID){return a.userID2ItemID.has(b)}function fe(a,b=a.userID){if(!yb(a,b))return null;let c=a.userID2ItemID.get(b);return a.rootRef.child(c)}function Vk(a,b=a.userID){if(!yb(a,b))return null;let c=a.userID2ItemID.get(b);return a.userList.getItemFromItemID(c)}function kg(a){return a.userList.getItems()}function Wk(a){a.userList.clear()}function Xk(a,b,c){a.userList.forEach(b,c)}function Yk(a,b=a.userID){let c=a.userList.getItems()[0];return c&&c.userID===b}function Zk(a){return a.maxUsers===0?!1:a.userList.getItems().length>=a.maxUsers}function Rk(a=0,b){return new Promise(function(c,d){setTimeout(function(){c(b)},a)})}function Sk(a,b=a.userID,c=a.userName){if(yb(a,b))return Promise.resolve();let d={userID:b,userName:c},e=a.maxUsers,f=a.database.ref(a.rootPath),g=f.push();return g.onDisconnect().remove().then(function(){return g.set(d)}).then(function(){return Rk(0)}).then(function(){return e===0?(a.isInList=!0,Promise.resolve()):f.limitToFirst(e).once("value").then(function(j){return Wo(j,b)?(a.isInList=!0,Promise.resolve()):(a.isInList=!1,g.remove().then(function(){return g.onDisconnect().cancel()}).then(function(){return Promise.reject()}))})})}function Wo(a,b){let c=!1;return a.forEach(function(d){let e=d.val();if(e.userID===b)return c=!0,!0}),c}function Tk(a,b=a.userID){if(!yb(a,b))return Promise.resolve();let c=a.userID2ItemID.get(b),d=a.database.ref(a.rootPath).child(c);return d.remove()}function Qk(a,b){return new Promise(function(c,d){let e=fe(a);if(e)return c(e);{let f=a.rootRef.orderByChild("userID").equalTo(a.userID);f.once("child_added").then(function(g){return c(g.ref)})}}).then(function(c){return c.child("userName").set(b)}).then(function(){return a.userName=b,Promise.resolve()})}const v_=Ia(Na());class tc extends ta{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,eventNames:f=Uk}={}){super();this.setEventEmitter(a),this.eventNames=f,this.database=v_.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.setMaxUsers(e),this.userList=new Wb({eventEmitter:this.eventEmitter,itemIDKey:"joinAt",eventNames:{add:f.join,remove:f.leave,update:f.update,change:f.change}}),this.isInList=!1,this.userID2ItemID=new Map(),this.userList.on(this.eventNames.join,function(g){this.userID2ItemID.set(g.userID,g.joinAt),g.userID===this.userInfo.userID&&this.emit(this.eventNames.init,kg(this))},this).on(this.eventNames.leave,function(g){this.userID2ItemID.delete(g.userID),g.userID===this.userID&&(this.isInList=!1)},this).on(this.eventNames.change,function(g,j){let i=g.userID,k=g.userName,n=j.userName;k!==n&&this.emit(this.eventNames.changename,i,k,n)},this)}destroy(){this.stopUpdate().destroyEventEmitter().leave(),this.userList.destroy()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setMaxUsers(a){return this.maxUsers=a,this}clear(){return Wk(this),this}forEach(a,b){return Xk(this,a,b),this}isFull(){return Zk(this)}isFirstUser(a=this.userID){return Yk(this,a)}getUser(a=this.userID){return Vk(this,a)}getUsers(){return kg(this)}getUserRef(a=this.userID){return fe(this,a)}contains(a=this.userID){return yb(this,a)}join(a=this.userID,b=this.userName){return Sk(this,a,b)}leave(a=this.userID){return Tk(this,a)}changeUserName(a){return Qk(this,a)}startUpdate(){let a=this.rootRef;return this.maxUsers>0&&(a=a.limitToFirst(this.maxUsers)),this.userList.startUpdate(a),this}stopUpdate(){return this.userList.stopUpdate(),this}}const Xb="room.join";const Ab="room.leave";const Gg="userlist.join";const Hg="userlist.leave";const Jg="userlist.init";const Ig="userlist.update";const Rc="userlist.changename";const rg="broadcast.receive";function vg(a){return`tables.${a}.init`}function wg(a){return`tables.${a}.update`}function xg(a){return`tables.${a}.addkey0`}function yg(a){return`tables.${a}.addkey1`}function zg(a){return`tables.${a}.addkey2`}function Ag(a){return`tables.${a}.removekey0`}function Bg(a){return`tables.${a}.removekey1`}function Cg(a){return`tables.${a}.removekey2`}function Dg(a){return`tables.${a}.changekey0`}function Eg(a){return`tables.${a}.changekey1`}function Fg(a){return`tables.${a}.changekey2`}const sg="roomlist.add";const tg="roomlist.remove";const ug="roomlist.update";function kl(a){const b=new tc({eventEmitter:a.eventEmitter,eventNames:{join:Gg,leave:Hg,update:Ig,change:"userlist.change",init:Jg,changename:Rc},userID:a.userInfo});return b.on("userlist.leave",function(c){c.userID===a.userID&&$o(a)}),a.on(Xb,function(){b.startUpdate()}).on(Ab,function(){b.stopUpdate().clear()}),b}function $o(a){a.emit(Ab),setTimeout(function(){a.roomID=void 0,a.roomName=void 0,a.doorState=void 0,a.leftRoomFlag=!1},0)}function hl(a){const b=new Wb({eventEmitter:a.eventEmitter,itemIDKey:"roomID",eventNames:{update:ug,add:sg,remove:tg,change:"roomlist.change"},mode:"once"});return b}function rl(a){return a.split("|")[0]}function ql(a){return a.split("|")[1]}function uc(a,b=""){return`${a}|${b}`}function fb(a,b){let c=a.rootRef;return b&&(c=c.child(b)),c}function Sc(a,b,c){let d=fb(a,"rooms");return b!==void 0&&(d=d.child(b),c!==void 0&&(d=d.child(c))),d}function gl(a,b){return Sc(a,b,"alive")}function ll(a,b){return Sc(a,b,"users")}function Qc(a,b){let c=fb(a,"room-filters");return b!==void 0&&(c=c.child(b)),c}function vc(a,b){let c=fb(a,"room-metadata");return b!==void 0&&(c=c.child(b)),c}function he(a,b,c){let d=`${a.rootPath}/rooms/${b}`;return c&&(d+=`/${c}`),d}function ke(a,b){return he(a,b,"users")}function il(a,b,c){let d=he(a,b,"tables");return c&&(d+=`/${c}`),d}function ml(a,b,c="open"){let d=Qc(a);return d=d.orderByChild("filter"),b===void 0?d=d.startAt(c).endAt(`${c}~`):d=d.equalTo(uc(c,b)),d}function dl(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new rc({eventEmitter:a.eventEmitter,eventNames:{receive:rg},receiverID:"boradcast",senderID:a.userInfo,history:b.history});return a.on(Xb,function(d){c.setRootPath(he(a,d.roomID)).startReceiving()}).on(Ab,function(){c.stopReceiving()}).on(Rc,function(d,e){c.changeUserName(d,e)}),c}function jl(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,_o(a,d))}),a.on(Xb,function(d){for(const[e,f]of c)f.setRootPath(il(a,d.roomID,e)).startUpdate()}).on(Ab,function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function _o(a,{key:b,type:c=ra["1d"]}){const d=new sc({eventEmitter:a.eventEmitter,type:c,eventNames:{init:vg(b),update:wg(b),addkey0:xg(b),removekey0:Ag(b),changekey0:Dg(b),addkey1:yg(b),removekey1:Bg(b),changekey1:Eg(b),addkey2:zg(b),removekey2:Cg(b),changekey2:Fg(b)}});return d}function Sa(a,b=a.roomID,c=a.roomName){return{roomID:b,roomName:c}}function oe(a,b){return b===void 0?a.roomID!==void 0:a.roomID===b}function ul(a){return a.userList.isFull()}function vl(a,b=a.userID){return a.userList.isFirstUser(b)}function wl(a){return a.userList.getUsers()}function le(a,b,c,d){a.roomID=b,a.roomName=c,a.roomType=d,a.emit("room.join",Sa(a))}function je(a,b={}){return b.roomID==null&&(b.roomID=Sc(a).push().key),Yo(a,b.roomID).then(function(){return Zo(a,b)})}function Yo(a,b){return gl(a,b).transaction(function(c){return c===null?!0:void 0})}function Zo(a,{roomID:b,roomName:c="",roomType:d="",maxUsers:e=0,presisted:f=!1,door:g="open",join:j=!0,filterData:i}){let k=Sc(a,b),n=Qc(a,b),t=vc(a,b);a.isRemoveRoomWhenLeft=!f,a.isRemoveRoomWhenLeft&&(k.onDisconnect().remove(),n.onDisconnect().remove(),t.onDisconnect().remove());const v=uc(g,d),x={},C={filter:v,name:c};i&&(C.data=i),x[`room-filters/${b}`]=C;const F={name:c,filter:v,maxUsers:e,moderators:{}};return F.moderators[a.userID]=a.userName,x[`room-metadata/${b}`]=F,new Promise(function(H,Q){if(j){const L=a.userList.setRootPath(ke(a,b)).setMaxUsers(0).join();return a.userList.setMaxUsers(e),L.then(H,Q)}else return H()}).then(function(){return fb(a).update(x)}).then(function(){return a.isRoomCreator=!0,j&&le(a,b,c,d),Promise.resolve(Sa(a))})}function el(a,{digits:b=10,candidates:c="0123456789",retry:d=1e3}){let e=arguments[1];return fl(a,b,c,d,e)}function fl(a,b,c,d,e){return e.roomID=ie(b,b,c),d<=0?Promise.reject(e):(d--,je(a,e).catch(function(){return fl(a,b,c,d,e)}))}function pe(a,b=a.roomID){const c={};c[`room-filter/${b}`]=null,c[`room-metadata/${b}`]=null,c[`rooms/${b}`]=null;const d=Sa(a);return fb(a).update(c).then(function(){return Promise.resolve(d)})}function wc(a){if(!oe(a))return Promise.resolve(Sa(a));a.leftRoomFlag=!0;if(a.isRemoveRoomWhenLeft)return pe(a);{const b=Sa(a);return a.userList.leave().then(function(){return Promise.resolve(b)})}}function ne(a,{leftThenJoin:b=!0,roomID:c}){return b?wc(a).then(function(){return sl(a,c)}):sl(a,c)}function sl(a,b){return b==null?Promise.reject(Sa(a,b,"")):(a.isRemoveRoomWhenLeft=!1,ap(a,b).then(function(c){return a.userList.setRootPath(ke(a,b)).setMaxUsers(c.maxUsers).join().then(function(){return Promise.resolve(c)})}).then(function(c){return le(a,b,c.name,ql(c.filter)),Promise.resolve(Sa(a))}))}function ap(a,b){return vc(a,b).once("value").then(function(c){let d=c.val();return bp(a,d)?Promise.resolve(d):Promise.reject()})}function bp(a,b){if(b==null)return!1;if(rl(b.filter)==="closed")return!1;const c=a.userID;if(b.moderators[c])return!0;switch(b.permission){case"blocklist":const d=b.blocklist;return!(d&&d[c]);case"allowlist":const e=b.allowlist;return e&&e[c];default:return!0}}function me(a,b,c){return new Promise(function(d,e){a.roomList.once("roomlist.update",function(f){d(f)}).startUpdate(ml(a,b,c))})}function ol(a,{roomType:b="",leftThenJoin:c=!0}={}){return me(a,b,"open").then(function(d){if(d.length===0)return Promise.reject("No filtered room");Ub(d);const e={leftThenJoin:c,roomID:""};return pl(a,e,d)})}function pl(a,b,c,d=0){return d===c.length?Promise.reject("Can't join any room"):(b.roomID=c[d].roomID,d++,ne(a,b).catch(function(){return pl(a,b,c,d)}))}function tl(a,b){return a.userList.contains(b)?b===a.userID?wc(a):a.userList.leave(b):Promise.resolve()}function zb(a,b){return b===a.roomID?Promise.resolve(!0):vc(a,b).once("value").then(function(c){const d=c.val()!==null;return Promise.resolve(d)})}function ge(a,b,c=a.roomID){return zb(a,c).then(function(d){if(!d)return Promise.resolve();const e=uc(b,a.roomType),f={};return f[`room-filters/${c}/filter`]=e,f[`room-metadata/${c}/filter`]=e,fb(a).update(f)})}function al(a,b=a.roomID){return ge(a,"open",b)}function bl(a,b=a.roomID){return ge(a,"closed",b)}function _k(a,b,c=a.roomID){return zb(a,c).then(function(d){return d?Qc(a,c).child("data").update(b):Promise.resolve()})}function cl(a,b){return a.userList.changeUserName(b)}function $k(a,b,c=a.roomID){return zb(a,c).then(function(d){if(!d)return Promise.resolve();const e={};return e[`room-filters/${c}/name`]=b,e[`room-metadata/${c}/name`]=b,fb(a).update(e)})}function nl(a,b=a.roomID){return b===a.roomID?a.userList.getUsers():new Promise(function(c,d){const e=new Wb({itemIDKey:"joinAt",mode:"once"});e.once("update",function(f){c(f)}).startUpdate(ll(a,b))})}const g0=Ia(Na());class xl extends ta{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",broadcast:e=!0,tables:f=!1}={}){super();this.setEventEmitter(a),this.database=g0.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.isRoomCreator=!1,this.roomID=void 0,this.roomName=void 0,this.roomType=void 0,this.doorState=void 0,this.leftRoomFlag=!1,this.isRemoveRoomWhenLeft=void 0,this.userList=kl(this),this.roomList=hl(this),this.broadcast=dl(this,e),this.tables=jl(this,f)}destroy(){var a=this;this.destroyEventEmitter().leaveRoom().then(function(){a.userList.destroy(),a.userList=void 0,a.roomList.destroy(),a.roomList=void 0,a.broadcast.destroy(),a.broadcast=void 0})}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}getRoomInfo(a,b){return Sa(this,a,b)}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(a){return oe(this,a)}isFull(){return ul(this)}isFirstUser(a=this.userID){return vl(this,a)}getUsers(){return wl(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}createRoom(a){return je(this,a)}createRandomRoom(a={}){return el(this,a)}joinRoom(a){return ne(this,a)}joinRandomRoom(a={}){return ol(this,a)}leaveRoom(){return wc(this)}removeRoom(a=this.roomID){return pe(this,a)}kickUser(a){return tl(this,a)}changeRoomState(a,b=this.roomID){return ge(this,a,b)}openRoom(a=this.roomID){return al(this,a)}closeRoom(a=this.roomID){return bl(this,a)}changeUserName(a){return cl(this,a)}changeFilterData(a,b=this.roomID){return _k(this,a,b)}changeRoomName(a,b,c=a.roomID){return $k(this,b,c)}getUserList(a=this.roomID){return nl(this,a)}getRoomList(a,b){return me(this,a,b)}HasRoom(a){return zb(this,a)}}function El(a,b){let c=a.rootPath;return b&&(c+=`/${b}`),c}function Cl(a){return El(a,"users")}function Al(a,b){return`${El(a,"tables")}/${b}`}const qb="room.join";const Bb="room.leave";const Wg="userlist.join";const qe="userlist.leave";const Yg="userlist.init";const Xg="userlist.update";const Tc="userlist.changename";const Kg="broadcast.receive";function Lg(a){return`tables.${a}.init`}function Mg(a){return`tables.${a}.update`}function Ng(a){return`tables.${a}.addkey0`}function Og(a){return`tables.${a}.addkey1`}function Pg(a){return`tables.${a}.addkey2`}function Qg(a){return`tables.${a}.removekey0`}function Rg(a){return`tables.${a}.removekey1`}function Sg(a){return`tables.${a}.removekey2`}function Tg(a){return`tables.${a}.changekey0`}function Ug(a){return`tables.${a}.changekey1`}function Vg(a){return`tables.${a}.changekey2`}function Dl(a,b=0){const c=new tc({eventEmitter:a.eventEmitter,eventNames:{join:Wg,leave:qe,update:Xg,change:"userlist.change",init:Yg,changename:Tc},root:Cl(a),userID:a.userInfo,maxUsers:b});return c.on(qe,function(d){d.userID===a.userID&&ep(a)}),a.on(qb,function(){c.startUpdate()}).on(Bb,function(){c.stopUpdate().clear()}),c}function ep(a){a.emit(Bb),setTimeout(function(){a.leftRoomFlag=!1},0)}function zl(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new rc({eventEmitter:a.eventEmitter,eventNames:{receive:Kg},receiverID:"broadcast",senderID:a.userInfo,history:b.history});return a.on(qb,function(){c.setRootPath(a.rootPath).startReceiving()}).on(Bb,function(){c.stopReceiving()}).on(Tc,function(d,e){c.changeUserName(d,e)}),c}function Bl(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,dp(a,d))}),a.on(qb,function(){for(const[d,e]of c)e.setRootPath(Al(a,d)).startUpdate()}).on(Bb,function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function dp(a,{key:b,type:c=ra["1d"]}){const d=new sc({eventEmitter:a.eventEmitter,type:c,eventNames:{init:Lg(b),update:Mg(b),addkey0:Ng(b),removekey0:Qg(b),changekey0:Tg(b),addkey1:Og(b),removekey1:Rg(b),changekey1:Ug(b),addkey2:Pg(b),removekey2:Sg(b),changekey2:Vg(b)}});return d}function se(a){return a.userList.isInList}function Il(a){return a.userList.isFull()}function Jl(a,b=a.userID){return a.userList.isFirstUser(b)}function Kl(a){return a.userList.getUsers()}function Gl(a){return a.userList.join().then(function(){return a.emit(qb),Promise.resolve()})}function re(a){return se(a)?(a.leftRoomFlag=!0,a.userList.leave()):Promise.resolve()}function Fl(a){return a.userList.getUsers()}function Hl(a,b){return a.userList.contains(b)?b===a.userID?re(a):a.userList.leave(b):Promise.resolve()}function yl(a,b){return a.userList.changeUserName(b)}const U1=Ia(Na());class Ll extends ta{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,broadcast:f=!0,tables:g=!1}={}){const j=arguments[0];super();this.setEventEmitter(a),this.database=U1.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.leftRoomFlag=!1,this.userList=Dl(this,e),this.broadcast=zl(this,f),this.tables=Bl(this,g)}shutdown(){}destroy(){this.shutdown()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(){return se(this)}isFull(){return Il(this)}isFirstUser(a=this.userID){return Jl(this,a)}getUsers(){return Kl(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}joinRoom(){return Gl(this)}leaveRoom(){return re(this)}getUserList(){return Fl(this)}kickUser(a){return Hl(this,a)}changeUserName(a){return yl(this,a)}}const Rh="statechange";function Sh(a){return`exit_${a.toString()}`}function Th(a){return`enter_${a.toString()}`}class Ym extends ta{constructor({eventEmitter:a}={}){super();this._states=new Map();this.enable=!0;this.setEventEmitter(a)}destroy(){this.destroyEventEmitter()}toJSON(){return{curState:this.state,prevState:this.prevState,enable:this.enable,start:this._start}}setEnable(a=!0){return this.enable=a,this}getState(a){return this._states.get(a)}addState(a){return this._states.set(a.name,a),this}addStates(a){for(let b=0,c=a.length;b<c;b++)this.addState(a[b]);return this}removeState(a){return this._states.delete(a),this}removeAllStates(){return this._states.clear(),this}set state(a){if(!this.enable||this._stateLock)return;if(this._state===a)return;this._prevState=this._state,this._state=a,this._stateLock=!0,this.emit(Rh,this);if(this._prevState!=null){const b=this.getState(this._prevState);b&&b.exit&&b.exit(this),this.emit(Sh(this._prevState),this)}this._stateLock=!1;if(this._state!=null){const b=this.getState(this._state);b&&b.enter&&b.enter(this),this.emit(Th(this._state),this)}}get state(){return this._state}get prevState(){return this._prevState}get stateList(){return Array.from(this._states.keys())}start(a){return this._start=a,this._prevState=void 0,this._state=a,this}goto(a){return a!=null&&(this.state=a),this}next(){const a=this.getState(this.state);if(!a||!a.next)return this;let b;return typeof a.next==="string"?b=a.next:b=a.next(this),this.goto(b),this}update(a,b,c="update"){const d=this.getState(this.state);d&&d[c]&&d[c](this,a,b)}preupdate(a,b){this.update(b,a,"preupdate")}postupdate(a,b){this.update(b,a,"postupdate")}}var Uh;(function(a){a[a.shuffle=0]="shuffle",a[a.random=1]="random"})(Uh||(Uh={}));const Yh="die";class Zm extends Le{constructor(a,{lifeTime:b=1e3,destroy:c=!0}={}){super(a,arguments[1]);this.setLifeTime(b),this.setDestroyMode(c)}resetFromJSON({lifeTime:a=1e3,destroy:b=!0}={}){return super.resetFromJSON(arguments[0]),this.setLifeTime(a),this.setDestroyMode(b),this}toJSON(){const a=super.toJSON();return a.lifeTime=this.lifeTime,a.destroy=this.destroyMode,a}setLifeTime(a){return this.lifeTime=a,this}addToLifeTime(a){return this.lifeTime+=a,this}setDestroyMode(a=!0){return this.destroyMode=a,this}get isAlive(){return this.now<this.lifeTime}get remainder(){let a=this.lifeTime-this.now;return a<0&&(a=0),a}update(a){return this.isRunning?(super.update(a),this.isAlive||(this.complete(Yh),this.destroyMode&&this.gameObject.destroy&&this.gameObject.destroy()),this):this}get gameObject(){return this.parent}}class Me{constructor(a,b,c,d,e){this.key=a,this.start=b,this.end=c,this.step=d,this.items=e,this._current=b}reset(){this._current=this.start}get isEnd(){return this.step>=0?this._current>=this.end:this._current<=this.end}get length(){return this.step>=0&&this.start>this.end||this.step<0&&this.start<this.end?0:Math.floor(this.end-this.start)+1}next(){return this.isEnd?this._current=this.start:this._current+=this.step,this}get current(){return this.items?this.items[this._current]:this._current}}class $m{constructor(){this.indexes=[];this.length=0;this.firstPass=!0;this.currentCount=0}reset(){for(let a=0,b=this.indexes.length;a<b;a++)this.indexes[a].reset();return this.firstPass=!0,this.currentCount=0,this}addNumberLoop(a,b,c,d=c>=b?1:-1){return this.indexes.push(new Me(a,b,c,d)),this.length=this._getLength(),this}addItemsLoop(a,b,c=!1){const d=b.length-1,e=c?d:0,f=c?0:d,g=c?-1:1;return this.indexes.push(new Me(a,e,f,g,b)),this.length=this._getLength(),this}addLoop({key:a,start:b,end:c,step:d,items:e}){return this.indexes.push(new Me(a,b,c,d,e)),this.length=this._getLength(),this}removeLoops(){return this.indexes.length=0,this.length=0,this}_getLength(){let a=this.indexes[0]?.length;for(let b=1,c=this.indexes.length;b<c;b++)a*=this.indexes[b].length;return a??0}get progress(){return this.currentCount/this.length}get isEnd(){for(let a=this.indexes.length-1;a>=0;a--)if(!this.indexes[a].isEnd)return!1;return!0}next(){for(let a=this.indexes.length-1;a>=0;a--){const b=this.indexes[a],c=b.isEnd;b.next();if(!c)break}return this}getCurrent(a={}){for(let b=this.indexes.length-1;b>=0;b--){const c=this.indexes[b];a[c.key]=c.current}return a}getNext(a={}){return this.firstPass?this.firstPass=!1:this.next(),this.getCurrent(a),this.currentCount++,a}}const Nh="tickstart";const Oh="tickend";const _p=1e3/60;class _m extends Ne{constructor(a,{callback:b,scope:c,deltaPercentage:d=1}={}){super(a,arguments[1]);this.deltaPercentage=1;this.loopIndexGenerator=new $m();this.currentIndexes={};this.scene=a,this.setCallback(b,c),this.setDeltaPercentage(d),this.boot()}boot(){super.boot(),Ib(this.scene,"shutdown",this.destroy,this)}shutdown(){super.shutdown(),this.scene=void 0}destroy(){this.shutdown()}startTicking(){super.startTicking(),Ma(this.scene,"update",this.preupdate,this)}stopTicking(){super.stopTicking(),this.scene&&mb(this.scene,"update",this.preupdate,this)}setCallback(a,b){return this.callback=a,this.scope=b,this}setDeltaPercentage(a){return this.deltaPercentage=a,this}addNumberLoop(a,b,c,d){return this.loopIndexGenerator.addNumberLoop(a,b,c,d),this}addItemsLoop(a,b,c=!1){return this.loopIndexGenerator.addItemsLoop(a,b,c),this}addLoop(a){return this.loopIndexGenerator.addLoop(a),this}get curTime(){return new Date().getTime()}get progress(){return this.loopIndexGenerator.progress}preupdate(){if(!this.callback)return;const a=this.curTime,b=_p*this.deltaPercentage;let c;this.emit(Nh);do{if(this.loopIndexGenerator.isEnd){this.complete();return}this.currentIndexes=this.loopIndexGenerator.getNext(this.currentIndexes),this.scope?this.callback.call(this.scope,this.currentIndexes,this):this.callback(this.currentIndexes,this),c=this.curTime-a>=b}while(!c);this.emit(Oh)}}const bfa=Ia(wn());var Vh;(function(a){a[a.none=0]="none",a[a.base64=1]="base64",a[a.utf16=2]="utf16",a[a.uri=3]="uri"})(Vh||(Vh={}));var Eb;(function(a){a[a.circle=0]="circle",a[a.ellipse=1]="ellipse",a[a.roundRectangle=2]="roundRectangle"})(Eb||(Eb={}));class qm extends Zc{constructor(a,b,c,d,e=Eb.circle){super(a,b);this.type="rexMaskedImage",this.maskImage(c,d,e)}maskImage(a,b,c=Eb.circle){let d,e,f;typeof c==="object"?{maskType:d,backgroundStyle:e,radius:f}=c:d=c,typeof d==="string"&&(d=Eb[d]);const g=this.canvas,j=this.context,i=Fa.get();if(!i.has(a))return;const k=i.get(a).getFrame(b),n=k.width,t=k.height;g.width!==n&&(g.width=n),g.height!==t&&(g.height=t),j.clearRect(0,0,n,t),e&&(j.fillStyle=e,j.fillRect(0,0,n,t)),j.beginPath();switch(d){case Eb.roundRectangle:Ae(j,0,0,n,t,f);break;default:const v=Math.floor(n/2),x=Math.floor(t/2);d===Eb.circle?j.arc(v,x,Math.min(v,x),0,2*Math.PI):j.ellipse(v,x,v,x,0,0,2*Math.PI);break}j.clip(),j.drawImage(k.texture.image,k.x,k.y,k.width,k.height),this.texture.setSize(n,t),this.setSize(n,t),this.updateTexture()}}let iq=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i;function qc(a){let b;return a===""?b=null:iq.test(a)?b=parseFloat(a):a==="false"?b=!1:a==="true"?b=!0:b=a,b}const Eaa=Ia(Af());function an(a,{delimiter:b=",",convert:c=!0,types:d={}}={}){const e=Eaa.default.parse(a,{header:!0,delimiter:b}).data,f=d.question??"q",g=d.option??"",j=c===!0?qc:c,i=[];let k,n;for(let t=0,v=e.length;t<v;t++){let x=e[t],C=x.type;delete x.type,C===f?(k=x,k.key===""&&delete k.key,cn(k,j),k.options=[],i.push(k)):C===g&&(k&&(n=x,n.key===""&&delete n.key,cn(n,j),k.options.push(n)))}return i}function cn(a,b){const c=a;if(!b)return c;for(const d in a)c[d]=b(a[d],d);return c}function Qh(a,b,c){typeof b==="string"&&(b=an(b,c));if(Array.isArray(b))for(let d=0,e=b.length;d<e;d++)bn(a,b[d]);else bn(a,b)}function bn(a,b){const c=b.options;if(c)for(let d=0,e=c.length;d<e;d++){let f=c[d];f.hasOwnProperty("key")||(f.key=`_${d}`)}b.hasOwnProperty("key")||(b.key=`_${a.questions.size}`),a.questions.set(b.key,b)}class Ph{constructor({questions:a}={}){this.questions=new Map();a&&Qh(this,a,arguments[0])}add(a,b){return Qh(this,a,b),this}remove(a){return this.questions.delete(a),this}removeAll(){return this.questions.clear(),this}has(a){return this.questions.has(a)}get(a){return this.questions.get(a)}getKeys(a=[]){const b=this.questions.keys();for(const c of b)a.push(c);return a}getOption(a,b){typeof a==="string"&&(a=this.get(a));if(!a)return null;const c=a.options;if(c)for(let d=0,e=c.length;d<e;d++){let f=c[d];if(f.key===b)return f}return null}}const Oe="quest";class $p extends ta{constructor(a,{eventEmitter:b,shuffleQuestions:c=!1,shuffleOptions:d=!1}={}){super();this.questionKeys=[];this.setEventEmitter(b),be(a)&&(a=new Ph(a)),this.questionsManager=a,this.setShuffleQuestionsEnable(c),this.setShuffleOptionsEnable(d),this.init()}setShuffleQuestionsEnable(a=!0){return this.shuffleQuestionsEnable=a,this}setShuffleOptionsEnable(a=!0){return this.shuffleOptionsEnable=a,this}init(){return this.questionKeys.length=0,this.questionsManager.getKeys(this.questionKeys),this.shuffleQuestionsEnable&&Ub(this.questionKeys),this.nextIndex=-1,this.nextKey=void 0,this}setNextKey(a){return a===void 0?(this.nextIndex++,this.nextKey=this.questionKeys[this.nextIndex]):this.questionsManager.has(a)&&(this.nextKey=a,this.nextIndex=this.questionKeys.indexOf(a)),this}setPrevKey(){return this.nextIndex--,this.nextKey=this.questionKeys[this.nextIndex],this}getQuestion(){const a=this.questionsManager.get(this.nextKey);if(a&&this.shuffleOptionsEnable){const b=a.options;b&&Ub(b)}return a}getNextQuestion(a){return this.setNextKey(a).getQuestion()}getPrevQuestion(){return this.setPrevKey().getQuestion()}getOption(a,b){return b===void 0&&(b=a,a=this.getQuestion()),this.questionsManager.getOption(a,b)}next(a){const b=this.getNextQuestion(a);return b&&this.emit(Oe,b,this,this.questionsManager),this}prev(){const a=this.getPrevQuestion();return a&&this.emit(Oe,a,this,this.questionsManager),this}restart(a){return this.init(),this.next(a),this}get isLastQuestion(){return this.nextIndex===this.questionKeys.length-1}}var Xf;(function(a){a[a.ascending=0]="ascending",a[a.descending=1]="descending",a[a.logical_ascending=2]="logical_ascending",a[a.logical_descending=3]="logical_descending"})(Xf||(Xf={}));class zn extends cd{constructor(){super();hi("dude","../assets/phaser-dude.png").load().then(()=>{this.create()})}create(){const a=new _e(this),b=new ed(400,300,"",{width:140,height:240,padding:20,wrapMode:"char",backgroundStrokeStyle:"BurlyWood",backgroundStrokeThickness:4,cornerRadius:20,images:["dude"]});dd(a,b);const c=[];for(let g=0;g<100;g++){let j=g%5===0?`[size=30][color=red]${g}[img=dude]`:`[size=20][color=green]${g}`;c.push(j)}b.setText(c);let d=20*1e3,e=!1,f=0;Ma(a,"update",function(g){f+=e?-g:g,f<0?(f=0,e=!1):f>d&&(f=d,e=!0),b.setTextScrollY(f/d,!0).updateText(!1)})}}new gi(Ze(),Ye(800,600),We("game"),Ve(2960685),Xe(zn));})();
/* @license
Papa Parse
v5.2.0
https://github.com/mholt/PapaParse
License: MIT
*/
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

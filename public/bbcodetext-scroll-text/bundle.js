(()=>{var Xf=Object.defineProperty,Lp=Object.prototype.hasOwnProperty,xb=(a,b)=>()=>(b||(b={exports:{}},a(b.exports,b)),b.exports),Mp=a=>Xf(a,"__esModule",{value:!0}),Fc=(a,b)=>{Mp(a);for(var c in b)Xf(a,c,{get:b[c],enumerable:!0})},Es=(a,b)=>{Mp(a);if(typeof b==="object"||typeof b==="function")for(let c in b)Lp.call(b,c)&&!Lp.call(a,c)&&c!=="default"&&Xf(a,c,{get:()=>b[c],enumerable:!0});return a},La=a=>a&&a.__esModule?a:Es(Xf({},"default",{value:a,enumerable:!0}),a);var Fg=xb((a,b)=>{!function(c,d){"function"==typeof define&&define.amd?define([],d):"object"==typeof b&&"undefined"!=typeof a?b.exports=d():c.Papa=d()}(a,function c(){"use strict";var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==d?d:{},e=!d.document&&!!d.postMessage,f=e&&/blob:/i.test((d.location||{}).protocol),g={},i=0,h={parse:function(q,t){var j=(t=t||{}).dynamicTyping||!1;L(j)&&(t.dynamicTypingFunction=j,j={});if(t.dynamicTyping=j,t.transform=!!L(t.transform)&&t.transform,t.worker&&h.WORKERS_SUPPORTED){var n=function(){if(!h.WORKERS_SUPPORTED)return!1;var r=(p=d.URL||d.webkitURL||null,F=c.toString(),h.BLOB_URL||(h.BLOB_URL=p.createObjectURL(new Blob(["(",F,")();"],{type:"text/javascript"})))),w=new d.Worker(r),p,F;return w.onmessage=I,w.id=i++,g[w.id]=w}();return n.userStep=t.step,n.userChunk=t.chunk,n.userComplete=t.complete,n.userError=t.error,t.step=L(t.step),t.chunk=L(t.chunk),t.complete=L(t.complete),t.error=L(t.error),delete t.worker,void n.postMessage({input:q,config:t,workerId:n.id})}var l=null;return h.NODE_STREAM_INPUT,"string"==typeof q?l=t.download?new o(t):new u(t):!0===q.readable&&L(q.read)&&L(q.on)?l=new v(t):(d.File&&q instanceof File||q instanceof Object)&&(l=new s(t)),l.stream(q)},unparse:function(q,t){var j=!1,n=!0,l=",",r=`\r
`,w='"',p=w+w,F=!1,H=null,Y=!1;!function(){if("object"!=typeof t)return;"string"!=typeof t.delimiter||h.BAD_DELIMITERS.filter(function(N){return-1!==t.delimiter.indexOf(N)}).length||(l=t.delimiter),("boolean"==typeof t.quotes||"function"==typeof t.quotes||Array.isArray(t.quotes))&&(j=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(F=t.skipEmptyLines),"string"==typeof t.newline&&(r=t.newline),"string"==typeof t.quoteChar&&(w=t.quoteChar),"boolean"==typeof t.header&&(n=t.header);if(Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");H=t.columns}void 0!==t.escapeChar&&(p=t.escapeChar+w),"boolean"==typeof t.escapeFormulae&&(Y=t.escapeFormulae)}();var B=new RegExp(D(w),"g");"string"==typeof q&&(q=JSON.parse(q));if(Array.isArray(q)){if(!q.length||Array.isArray(q[0]))return Q(null,q,F);if("object"==typeof q[0])return Q(H||Z(q[0]),q,F)}else if("object"==typeof q)return"string"==typeof q.data&&(q.data=JSON.parse(q.data)),Array.isArray(q.data)&&(q.fields||(q.fields=q.meta&&q.meta.fields),q.fields||(q.fields=Array.isArray(q.data[0])?q.fields:Z(q.data[0])),Array.isArray(q.data[0])||"object"==typeof q.data[0]||(q.data=[q.data])),Q(q.fields||[],q.data||[],F);throw new Error("Unable to serialize unrecognized input");function Z(N){if("object"!=typeof N)return[];var W=[];for(var ha in N)W.push(ha);return W}function Q(N,W,ha){var na="";"string"==typeof N&&(N=JSON.parse(N)),"string"==typeof W&&(W=JSON.parse(W));var oa=Array.isArray(N)&&0<N.length,ua=!Array.isArray(W[0]);if(oa&&n){for(var X=0;X<N.length;X++)0<X&&(na+=l),na+=G(N[X],X);0<W.length&&(na+=r)}for(var ba=0;ba<W.length;ba++){var ka=oa?N.length:W[ba].length,la=!1,R=oa?0===Object.keys(W[ba]).length:0===W[ba].length;if(ha&&!oa&&(la="greedy"===ha?""===W[ba].join("").trim():1===W[ba].length&&0===W[ba][0].length),"greedy"===ha&&oa){for(var V=[],ga=0;ga<ka;ga++){var U=ua?N[ga]:ga;V.push(W[ba][U])}la=""===V.join("").trim()}if(!la){for(var ca=0;ca<ka;ca++){0<ca&&!R&&(na+=l);var pa=oa&&ua?N[ca]:ca;na+=G(W[ba][pa],ca)}ba<W.length-1&&(!ha||0<ka&&!R)&&(na+=r)}}return na}function G(N,W){if(null==N)return"";if(N.constructor===Date)return JSON.stringify(N).slice(1,25);!0===Y&&"string"==typeof N&&null!==N.match(/^[=+\-@].*$/)&&(N="'"+N);var ha=N.toString().replace(B,p),na="boolean"==typeof j&&j||"function"==typeof j&&j(N,W)||Array.isArray(j)&&j[W]||function(oa,ua){for(var X=0;X<ua.length;X++)if(-1<oa.indexOf(ua[X]))return!0;return!1}(ha,h.BAD_DELIMITERS)||-1<ha.indexOf(l)||" "===ha.charAt(0)||" "===ha.charAt(ha.length-1);return na?w+ha+w:ha}}};if(h.RECORD_SEP=String.fromCharCode(30),h.UNIT_SEP=String.fromCharCode(31),h.BYTE_ORDER_MARK="ï»¿",h.BAD_DELIMITERS=["\r",`
`,'"',h.BYTE_ORDER_MARK],h.WORKERS_SUPPORTED=!e&&!!d.Worker,h.NODE_STREAM_INPUT=1,h.LocalChunkSize=10485760,h.RemoteChunkSize=5242880,h.DefaultDelimiter=",",h.Parser=J,h.ParserHandle=y,h.NetworkStreamer=o,h.FileStreamer=s,h.StringStreamer=u,h.ReadableStreamStreamer=v,d.jQuery){var k=d.jQuery;k.fn.parse=function(q){var t=q.config||{},j=[];return this.each(function(r){if(!("INPUT"===k(this).prop("tagName").toUpperCase()&&"file"===k(this).attr("type").toLowerCase()&&d.FileReader)||!this.files||0===this.files.length)return!0;for(var w=0;w<this.files.length;w++)j.push({file:this.files[w],inputElem:this,instanceConfig:k.extend({},t)})}),n(),this;function n(){if(0!==j.length){var r,w,p,F,H=j[0];if(L(q.before)){var Y=q.before(H.file,H.inputElem);if("object"==typeof Y){if("abort"===Y.action)return r="AbortError",w=H.file,p=H.inputElem,F=Y.reason,void(L(q.error)&&q.error({name:r},w,p,F));if("skip"===Y.action)return void l();"object"==typeof Y.config&&(H.instanceConfig=k.extend(H.instanceConfig,Y.config))}else if("skip"===Y)return void l()}var B=H.instanceConfig.complete;H.instanceConfig.complete=function(Z){L(B)&&B(Z,H.file,H.inputElem),l()},h.parse(H.file,H.instanceConfig)}else L(q.complete)&&q.complete()}function l(){j.splice(0,1),n()}}}function m(q){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(t){var j=O(t);j.chunkSize=parseInt(j.chunkSize),t.step||t.chunk||(j.chunkSize=null),this._handle=new y(j),(this._handle.streamer=this)._config=j}.call(this,q),this.parseChunk=function(t,j){if(this.isFirstChunk&&L(this._config.beforeFirstChunk)){var n=this._config.beforeFirstChunk(t);void 0!==n&&(t=n)}this.isFirstChunk=!1,this._halted=!1;var l=this._partialLine+t;this._partialLine="";var r=this._handle.parse(l,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var w=r.meta.cursor;this._finished||(this._partialLine=l.substring(w-this._baseIndex),this._baseIndex=w),r&&r.data&&(this._rowCount+=r.data.length);var p=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(f)d.postMessage({results:r,workerId:h.WORKER_ID,finished:p});else if(L(this._config.chunk)&&!j){if(this._config.chunk(r,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);r=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(r.data),this._completeResults.errors=this._completeResults.errors.concat(r.errors),this._completeResults.meta=r.meta),this._completed||!p||!L(this._config.complete)||r&&r.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),p||r&&r.meta.paused||this._nextChunk(),r}this._halted=!0},this._sendError=function(t){L(this._config.error)?this._config.error(t):f&&this._config.error&&d.postMessage({workerId:h.WORKER_ID,error:t,finished:!1})}}function o(q){var t;(q=q||{}).chunkSize||(q.chunkSize=h.RemoteChunkSize),m.call(this,q),this._nextChunk=e?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(j){this._input=j,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest(),this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),e||(t.onload=P(this._chunkLoaded,this),t.onerror=P(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!e),this._config.downloadRequestHeaders){var j=this._config.downloadRequestHeaders;for(var n in j)t.setRequestHeader(n,j[n])}if(this._config.chunkSize){var l=this._start+this._config.chunkSize-1;t.setRequestHeader("Range","bytes="+this._start+"-"+l)}try{t.send(this._config.downloadRequestBody)}catch(r){this._chunkError(r.message)}e&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:t.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(j){var n=j.getResponseHeader("Content-Range");return null===n?-1:parseInt(n.substring(n.lastIndexOf("/")+1))}(t),this.parseChunk(t.responseText)))},this._chunkError=function(j){var n=t.statusText||j;this._sendError(new Error(n))}}function s(q){var t,j;(q=q||{}).chunkSize||(q.chunkSize=h.LocalChunkSize),m.call(this,q);var n="undefined"!=typeof FileReader;this.stream=function(l){this._input=l,j=l.slice||l.webkitSlice||l.mozSlice,n?((t=new FileReader()).onload=P(this._chunkLoaded,this),t.onerror=P(this._chunkError,this)):t=new FileReaderSync(),this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var l=this._input;if(this._config.chunkSize){var r=Math.min(this._start+this._config.chunkSize,this._input.size);l=j.call(l,this._start,r)}var w=t.readAsText(l,this._config.encoding);n||this._chunkLoaded({target:{result:w}})},this._chunkLoaded=function(l){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(l.target.result)},this._chunkError=function(){this._sendError(t.error)}}function u(q){var t;m.call(this,q=q||{}),this.stream=function(j){return t=j,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var j,n=this._config.chunkSize;return n?(j=t.substring(0,n),t=t.substring(n)):(j=t,t=""),this._finished=!t,this.parseChunk(j)}}}function v(q){m.call(this,q=q||{});var t=[],j=!0,n=!1;this.pause=function(){m.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){m.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(l){this._input=l,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){n&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):j=!0},this._streamData=P(function(l){try{t.push("string"==typeof l?l:l.toString(this._config.encoding)),j&&(j=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(r){this._streamError(r)}},this),this._streamError=P(function(l){this._streamCleanUp(),this._sendError(l)},this),this._streamEnd=P(function(){this._streamCleanUp(),n=!0,this._streamData("")},this),this._streamCleanUp=P(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function y(q){var t,j,n,l=Math.pow(2,53),r=-l,w=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)(e[-+]?\d+)?\s*$/,p=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,F=this,H=0,Y=0,B=!1,Z=!1,Q=[],G={data:[],errors:[],meta:{}};if(L(q.step)){var N=q.step;q.step=function(X){if(G=X,na())ha();else{if(ha(),0===G.data.length)return;H+=X.data.length,q.preview&&H>q.preview?j.abort():(G.data=G.data[0],N(G,F))}}}function W(X){return"greedy"===q.skipEmptyLines?""===X.join("").trim():1===X.length&&0===X[0].length}function ha(){if(G&&n&&(ua("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+h.DefaultDelimiter+"'"),n=!1),q.skipEmptyLines)for(var X=0;X<G.data.length;X++)W(G.data[X])&&G.data.splice(X--,1);return na()&&function(){if(!G)return;function ba(la,R){L(q.transformHeader)&&(la=q.transformHeader(la,R)),Q.push(la)}if(Array.isArray(G.data[0])){for(var ka=0;na()&&ka<G.data.length;ka++)G.data[ka].forEach(ba);G.data.splice(0,1)}else G.data.forEach(ba)}(),function(){if(!G||!q.header&&!q.dynamicTyping&&!q.transform)return G;function ba(la,R){var V,ga=q.header?{}:[];for(V=0;V<la.length;V++){var U=V,ca=la[V];q.header&&(U=V>=Q.length?"__parsed_extra":Q[V]),q.transform&&(ca=q.transform(ca,U)),ca=oa(U,ca),"__parsed_extra"===U?(ga[U]=ga[U]||[],ga[U].push(ca)):ga[U]=ca}return q.header&&(V>Q.length?ua("FieldMismatch","TooManyFields","Too many fields: expected "+Q.length+" fields but parsed "+V,Y+R):V<Q.length&&ua("FieldMismatch","TooFewFields","Too few fields: expected "+Q.length+" fields but parsed "+V,Y+R)),ga}var ka=1;return!G.data.length||Array.isArray(G.data[0])?(G.data=G.data.map(ba),ka=G.data.length):G.data=ba(G.data,0),q.header&&G.meta&&(G.meta.fields=Q),Y+=ka,G}()}function na(){return q.header&&0===Q.length}function oa(X,ba){return ka=X,q.dynamicTypingFunction&&void 0===q.dynamicTyping[ka]&&(q.dynamicTyping[ka]=q.dynamicTypingFunction(ka)),!0===(q.dynamicTyping[ka]||q.dynamicTyping)?"true"===ba||"TRUE"===ba||"false"!==ba&&"FALSE"!==ba&&(function(la){if(w.test(la)){var R=parseFloat(la);if(r<R&&R<l)return!0}return!1}(ba)?parseFloat(ba):p.test(ba)?new Date(ba):""===ba?null:ba):ba;var ka}function ua(X,ba,ka,la){var R={type:X,code:ba,message:ka};void 0!==la&&(R.row=la),G.errors.push(R)}this.parse=function(X,ba,ka){var la=q.quoteChar||'"';if(q.newline||(q.newline=function(ga,U){ga=ga.substring(0,1048576);var ca=new RegExp(D(U)+"([^]*?)"+D(U),"gm"),pa=(ga=ga.replace(ca,"")).split("\r"),va=ga.split(`
`),Da=1<va.length&&va[0].length<pa[0].length;if(1===pa.length||Da)return`
`;for(var S=0,Ea=0;Ea<pa.length;Ea++)`
`===pa[Ea][0]&&S++;return S>=pa.length/2?`\r
`:"\r"}(X,la)),n=!1,q.delimiter)L(q.delimiter)&&(q.delimiter=q.delimiter(X),G.meta.delimiter=q.delimiter);else{var R=function(ga,U,ca,pa,va){var Da,S,Ea,A;va=va||[",","	","|",";",h.RECORD_SEP,h.UNIT_SEP];for(var x=0;x<va.length;x++){var C=va[x],E=0,z=0,T=0;Ea=void 0;for(var $=new J({comments:pa,delimiter:C,newline:U,preview:10}).parse(ga),ja=0;ja<$.data.length;ja++)if(ca&&W($.data[ja]))T++;else{var ia=$.data[ja].length;z+=ia,void 0!==Ea?0<ia&&(E+=Math.abs(ia-Ea),Ea=ia):Ea=ia}0<$.data.length&&(z/=$.data.length-T),(void 0===S||E<=S)&&(void 0===A||A<z)&&1.99<z&&(S=E,Da=C,A=z)}return{successful:!!(q.delimiter=Da),bestDelimiter:Da}}(X,q.newline,q.skipEmptyLines,q.comments,q.delimitersToGuess);R.successful?q.delimiter=R.bestDelimiter:(n=!0,q.delimiter=h.DefaultDelimiter),G.meta.delimiter=q.delimiter}var V=O(q);return q.preview&&q.header&&V.preview++,t=X,j=new J(V),G=j.parse(t,ba,ka),ha(),B?{meta:{paused:!0}}:G||{meta:{paused:!1}}},this.paused=function(){return B},this.pause=function(){B=!0,j.abort(),t=L(q.chunk)?"":t.substring(j.getCharIndex())},this.resume=function(){F.streamer._halted?(B=!1,F.streamer.parseChunk(t,!0)):setTimeout(F.resume,3)},this.aborted=function(){return Z},this.abort=function(){Z=!0,j.abort(),G.meta.aborted=!0,L(q.complete)&&q.complete(G),t=""}}function D(q){return q.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function J(q){var t,j=(q=q||{}).delimiter,n=q.newline,l=q.comments,r=q.step,w=q.preview,p=q.fastMode,F=t=void 0===q.quoteChar?'"':q.quoteChar;if(void 0!==q.escapeChar&&(F=q.escapeChar),("string"!=typeof j||-1<h.BAD_DELIMITERS.indexOf(j))&&(j=","),l===j)throw new Error("Comment character same as delimiter");!0===l?l="#":("string"!=typeof l||-1<h.BAD_DELIMITERS.indexOf(l))&&(l=!1),`
`!==n&&"\r"!==n&&`\r
`!==n&&(n=`
`);var H=0,Y=!1;this.parse=function(B,Z,Q){if("string"!=typeof B)throw new Error("Input must be a string");var G=B.length,N=j.length,W=n.length,ha=l.length,na=L(r),oa=[],ua=[],X=[],ba=H=0;if(!B)return x();if(p||!1!==p&&-1===B.indexOf(t)){for(var ka=B.split(n),la=0;la<ka.length;la++){if(X=ka[la],H+=X.length,la!==ka.length-1)H+=n.length;else if(Q)return x();if(!l||X.substring(0,ha)!==l){if(na){if(oa=[],Da(X.split(j)),C(),Y)return x()}else Da(X.split(j));if(w&&w<=la)return oa=oa.slice(0,w),x(!0)}}return x()}for(var R=B.indexOf(j,H),V=B.indexOf(n,H),ga=new RegExp(D(F)+D(t),"g"),U=B.indexOf(t,H);;)if(B[H]!==t)if(l&&0===X.length&&B.substring(H,H+ha)===l){if(-1===V)return x();H=V+W,V=B.indexOf(n,H),R=B.indexOf(j,H)}else{if(-1!==R&&(R<V||-1===V)){if(!(R<U)){X.push(B.substring(H,R)),H=R+N,R=B.indexOf(j,H);continue}var ca=E(R,U,V);if(ca&&void 0!==ca.nextDelim){R=ca.nextDelim,U=ca.quoteSearch,X.push(B.substring(H,R)),H=R+N,R=B.indexOf(j,H);continue}}if(-1===V)break;if(X.push(B.substring(H,V)),A(V+W),na&&(C(),Y))return x();if(w&&oa.length>=w)return x(!0)}else for(U=H,H++;;){if(-1===(U=B.indexOf(t,U+1)))return Q||ua.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:oa.length,index:H}),Ea();if(U===G-1)return Ea(B.substring(H,U).replace(ga,t));if(t!==F||B[U+1]!==F){if(t===F||0===U||B[U-1]!==F){-1!==R&&R<U+1&&(R=B.indexOf(j,U+1)),-1!==V&&V<U+1&&(V=B.indexOf(n,U+1));var pa=S(-1===V?R:Math.min(R,V));if(B[U+1+pa]===j){X.push(B.substring(H,U).replace(ga,t)),B[H=U+1+pa+N]!==t&&(U=B.indexOf(t,H)),R=B.indexOf(j,H),V=B.indexOf(n,H);break}var va=S(V);if(B.substring(U+1+va,U+1+va+W)===n){if(X.push(B.substring(H,U).replace(ga,t)),A(U+1+va+W),R=B.indexOf(j,H),U=B.indexOf(t,H),na&&(C(),Y))return x();if(w&&oa.length>=w)return x(!0);break}ua.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:oa.length,index:H}),U++}}else U++}return Ea();function Da(z){oa.push(z),ba=H}function S(z){var T=0;if(-1!==z){var $=B.substring(U+1,z);$&&""===$.trim()&&(T=$.length)}return T}function Ea(z){return Q||(void 0===z&&(z=B.substring(H)),X.push(z),H=G,Da(X),na&&C()),x()}function A(z){H=z,Da(X),X=[],V=B.indexOf(n,H)}function x(z){return{data:oa,errors:ua,meta:{delimiter:j,linebreak:n,aborted:Y,truncated:!!z,cursor:ba+(Z||0)}}}function C(){r(x()),oa=[],ua=[]}function E(z,T,$){var ja={nextDelim:void 0,quoteSearch:void 0},ia=B.indexOf(t,T+1);if(T<z&&z<ia&&(ia<$||-1===$)){var ma=B.indexOf(j,ia);if(-1===ma)return ja;ia<ma&&(ia=B.indexOf(t,ia+1)),ja=E(ma,ia,$)}else ja={nextDelim:z,quoteSearch:T};return ja}},this.abort=function(){Y=!0},this.getCharIndex=function(){return H}}function I(q){var t=q.data,j=g[t.workerId],n=!1;if(t.error)j.userError(t.error,t.file);else if(t.results&&t.results.data){var l={abort:function(){n=!0,M(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:K,resume:K};if(L(j.userStep)){for(var r=0;r<t.results.data.length&&(j.userStep({data:t.results.data[r],errors:t.results.errors,meta:t.results.meta},l),!n);r++);delete t.results}else L(j.userChunk)&&(j.userChunk(t.results,l,t.file),delete t.results)}t.finished&&!n&&M(t.workerId,t.results)}function M(q,t){var j=g[q];L(j.userComplete)&&j.userComplete(t),j.terminate(),delete g[q]}function K(){throw new Error("Not implemented.")}function O(q){if("object"!=typeof q||null===q)return q;var t=Array.isArray(q)?[]:{};for(var j in q)t[j]=O(q[j]);return t}function P(q,t){return function(){q.apply(t,arguments)}}function L(q){return"function"==typeof q}return f&&(d.onmessage=function(q){var t=q.data;void 0===h.WORKER_ID&&t&&(h.WORKER_ID=t.workerId);if("string"==typeof t.input)d.postMessage({workerId:h.WORKER_ID,results:h.parse(t.input,t.config),finished:!0});else if(d.File&&t.input instanceof File||t.input instanceof Object){var j=h.parse(t.input,t.config);j&&d.postMessage({workerId:h.WORKER_ID,results:j,finished:!0})}}),(o.prototype=Object.create(m.prototype)).constructor=o,(s.prototype=Object.create(m.prototype)).constructor=s,(u.prototype=Object.create(u.prototype)).constructor=u,(v.prototype=Object.create(m.prototype)).constructor=v,h})});var wj=xb(q=>{Fc(q,{__assign:()=>c,__asyncDelegator:()=>J,__asyncGenerator:()=>D,__asyncValues:()=>I,__await:()=>y,__awaiter:()=>i,__classPrivateFieldGet:()=>P,__classPrivateFieldSet:()=>L,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>m,__extends:()=>b,__generator:()=>h,__importDefault:()=>O,__importStar:()=>K,__makeTemplateObject:()=>M,__metadata:()=>g,__param:()=>f,__read:()=>s,__rest:()=>d,__spread:()=>u,__spreadArrays:()=>v,__values:()=>o});var a=function(j,n){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,r){l.__proto__=r}||function(l,r){for(var w in r)r.hasOwnProperty(w)&&(l[w]=r[w])},a(j,n)};function b(j,n){a(j,n);function l(){this.constructor=j}j.prototype=n===null?Object.create(n):(l.prototype=n.prototype,new l())}var c=function(){return c=Object.assign||function j(n){for(var l,r=1,w=arguments.length;r<w;r++){l=arguments[r];for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(n[p]=l[p])}return n},c.apply(this,arguments)};function d(j,n){var l={};for(var r in j)Object.prototype.hasOwnProperty.call(j,r)&&n.indexOf(r)<0&&(l[r]=j[r]);if(j!=null&&typeof Object.getOwnPropertySymbols==="function")for(var w=0,r=Object.getOwnPropertySymbols(j);w<r.length;w++)n.indexOf(r[w])<0&&Object.prototype.propertyIsEnumerable.call(j,r[w])&&(l[r[w]]=j[r[w]]);return l}function e(j,n,l,r){var w=arguments.length,p=w<3?n:r===null?r=Object.getOwnPropertyDescriptor(n,l):r,F;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")p=Reflect.decorate(j,n,l,r);else for(var H=j.length-1;H>=0;H--)(F=j[H])&&(p=(w<3?F(p):w>3?F(n,l,p):F(n,l))||p);return w>3&&p&&Object.defineProperty(n,l,p),p}function f(j,n){return function(l,r){n(l,r,j)}}function g(j,n){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(j,n)}function i(j,n,l,r){function w(p){return p instanceof l?p:new l(function(F){F(p)})}return new(l||(l=Promise))(function(p,F){function H(Z){try{B(r.next(Z))}catch(Q){F(Q)}}function Y(Z){try{B(r.throw(Z))}catch(Q){F(Q)}}function B(Z){Z.done?p(Z.value):w(Z.value).then(H,Y)}B((r=r.apply(j,n||[])).next())})}function h(j,n){var l={label:0,sent:function(){if(p[0]&1)throw p[1];return p[1]},trys:[],ops:[]},r,w,p,F;return F={next:H(0),throw:H(1),return:H(2)},typeof Symbol==="function"&&(F[Symbol.iterator]=function(){return this}),F;function H(B){return function(Z){return Y([B,Z])}}function Y(B){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,w&&(p=B[0]&2?w.return:B[0]?w.throw||((p=w.return)&&p.call(w),0):w.next)&&!(p=p.call(w,B[1])).done)return p;(w=0,p)&&(B=[B[0]&2,p.value]);switch(B[0]){case 0:case 1:p=B;break;case 4:return l.label++,{value:B[1],done:!1};case 5:l.label++,w=B[1],B=[0];continue;case 7:B=l.ops.pop(),l.trys.pop();continue;default:if(!(p=l.trys,p=p.length>0&&p[p.length-1])&&(B[0]===6||B[0]===2)){l=0;continue}if(B[0]===3&&(!p||B[1]>p[0]&&B[1]<p[3])){l.label=B[1];break}if(B[0]===6&&l.label<p[1]){l.label=p[1],p=B;break}if(p&&l.label<p[2]){l.label=p[2],l.ops.push(B);break}p[2]&&l.ops.pop(),l.trys.pop();continue}B=n.call(j,l)}catch(Z){B=[6,Z],w=0}finally{r=p=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}}function k(j,n,l,r){r===void 0&&(r=l),j[r]=n[l]}function m(j,n){for(var l in j)l!=="default"&&!n.hasOwnProperty(l)&&(n[l]=j[l])}function o(j){var n=typeof Symbol==="function"&&Symbol.iterator,l=n&&j[n],r=0;if(l)return l.call(j);if(j&&typeof j.length==="number")return{next:function(){return j&&r>=j.length&&(j=void 0),{value:j&&j[r++],done:!j}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(j,n){var l=typeof Symbol==="function"&&j[Symbol.iterator];if(!l)return j;var r=l.call(j),w,p=[],F;try{for(;(n===void 0||n-- >0)&&!(w=r.next()).done;)p.push(w.value)}catch(H){F={error:H}}finally{try{w&&!w.done&&(l=r.return)&&l.call(r)}finally{if(F)throw F.error}}return p}function u(){for(var j=[],n=0;n<arguments.length;n++)j=j.concat(s(arguments[n]));return j}function v(){for(var j=0,n=0,l=arguments.length;n<l;n++)j+=arguments[n].length;for(var r=Array(j),w=0,n=0;n<l;n++)for(var p=arguments[n],F=0,H=p.length;F<H;F++,w++)r[w]=p[F];return r}function y(j){return this instanceof y?(this.v=j,this):new y(j)}function D(j,n,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=l.apply(j,n||[]),w,p=[];return w={},F("next"),F("throw"),F("return"),w[Symbol.asyncIterator]=function(){return this},w;function F(G){r[G]&&(w[G]=function(N){return new Promise(function(W,ha){p.push([G,N,W,ha])>1||H(G,N)})})}function H(G,N){try{Y(r[G](N))}catch(W){Q(p[0][3],W)}}function Y(G){G.value instanceof y?Promise.resolve(G.value.v).then(B,Z):Q(p[0][2],G)}function B(G){H("next",G)}function Z(G){H("throw",G)}function Q(G,N){(G(N),p.shift(),p.length)&&H(p[0][0],p[0][1])}}function J(j){var n,l;return n={},r("next"),r("throw",function(w){throw w}),r("return"),n[Symbol.iterator]=function(){return this},n;function r(w,p){n[w]=j[w]?function(F){return(l=!l)?{value:y(j[w](F)),done:w==="return"}:p?p(F):F}:p}}function I(j){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=j[Symbol.asyncIterator],l;return n?n.call(j):(j=typeof o==="function"?o(j):j[Symbol.iterator](),l={},r("next"),r("throw"),r("return"),l[Symbol.asyncIterator]=function(){return this},l);function r(p){l[p]=j[p]&&function(F){return new Promise(function(H,Y){F=j[p](F),w(H,Y,F.done,F.value)})}}function w(p,F,H,Y){Promise.resolve(Y).then(function(B){p({value:B,done:H})},F)}}function M(j,n){return Object.defineProperty?Object.defineProperty(j,"raw",{value:n}):j.raw=n,j}function K(j){if(j&&j.__esModule)return j;var n={};if(j!=null)for(var l in j)Object.hasOwnProperty.call(j,l)&&(n[l]=j[l]);return n.default=j,n}function O(j){return j&&j.__esModule?j:{default:j}}function P(j,n){if(!n.has(j))throw new TypeError("attempted to get private field on non-instance");return n.get(j)}function L(j,n,l){if(!n.has(j))throw new TypeError("attempted to set private field on non-instance");return n.set(j,l),l}});var Aj=xb(q=>{Fc(q,{__assign:()=>c,__asyncDelegator:()=>J,__asyncGenerator:()=>D,__asyncValues:()=>I,__await:()=>y,__awaiter:()=>i,__classPrivateFieldGet:()=>P,__classPrivateFieldSet:()=>L,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>m,__extends:()=>b,__generator:()=>h,__importDefault:()=>O,__importStar:()=>K,__makeTemplateObject:()=>M,__metadata:()=>g,__param:()=>f,__read:()=>s,__rest:()=>d,__spread:()=>u,__spreadArrays:()=>v,__values:()=>o});var a=function(j,n){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,r){l.__proto__=r}||function(l,r){for(var w in r)r.hasOwnProperty(w)&&(l[w]=r[w])},a(j,n)};function b(j,n){a(j,n);function l(){this.constructor=j}j.prototype=n===null?Object.create(n):(l.prototype=n.prototype,new l())}var c=function(){return c=Object.assign||function j(n){for(var l,r=1,w=arguments.length;r<w;r++){l=arguments[r];for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(n[p]=l[p])}return n},c.apply(this,arguments)};function d(j,n){var l={};for(var r in j)Object.prototype.hasOwnProperty.call(j,r)&&n.indexOf(r)<0&&(l[r]=j[r]);if(j!=null&&typeof Object.getOwnPropertySymbols==="function")for(var w=0,r=Object.getOwnPropertySymbols(j);w<r.length;w++)n.indexOf(r[w])<0&&Object.prototype.propertyIsEnumerable.call(j,r[w])&&(l[r[w]]=j[r[w]]);return l}function e(j,n,l,r){var w=arguments.length,p=w<3?n:r===null?r=Object.getOwnPropertyDescriptor(n,l):r,F;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")p=Reflect.decorate(j,n,l,r);else for(var H=j.length-1;H>=0;H--)(F=j[H])&&(p=(w<3?F(p):w>3?F(n,l,p):F(n,l))||p);return w>3&&p&&Object.defineProperty(n,l,p),p}function f(j,n){return function(l,r){n(l,r,j)}}function g(j,n){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(j,n)}function i(j,n,l,r){function w(p){return p instanceof l?p:new l(function(F){F(p)})}return new(l||(l=Promise))(function(p,F){function H(Z){try{B(r.next(Z))}catch(Q){F(Q)}}function Y(Z){try{B(r.throw(Z))}catch(Q){F(Q)}}function B(Z){Z.done?p(Z.value):w(Z.value).then(H,Y)}B((r=r.apply(j,n||[])).next())})}function h(j,n){var l={label:0,sent:function(){if(p[0]&1)throw p[1];return p[1]},trys:[],ops:[]},r,w,p,F;return F={next:H(0),throw:H(1),return:H(2)},typeof Symbol==="function"&&(F[Symbol.iterator]=function(){return this}),F;function H(B){return function(Z){return Y([B,Z])}}function Y(B){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,w&&(p=B[0]&2?w.return:B[0]?w.throw||((p=w.return)&&p.call(w),0):w.next)&&!(p=p.call(w,B[1])).done)return p;(w=0,p)&&(B=[B[0]&2,p.value]);switch(B[0]){case 0:case 1:p=B;break;case 4:return l.label++,{value:B[1],done:!1};case 5:l.label++,w=B[1],B=[0];continue;case 7:B=l.ops.pop(),l.trys.pop();continue;default:if(!(p=l.trys,p=p.length>0&&p[p.length-1])&&(B[0]===6||B[0]===2)){l=0;continue}if(B[0]===3&&(!p||B[1]>p[0]&&B[1]<p[3])){l.label=B[1];break}if(B[0]===6&&l.label<p[1]){l.label=p[1],p=B;break}if(p&&l.label<p[2]){l.label=p[2],l.ops.push(B);break}p[2]&&l.ops.pop(),l.trys.pop();continue}B=n.call(j,l)}catch(Z){B=[6,Z],w=0}finally{r=p=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}}function k(j,n,l,r){r===void 0&&(r=l),j[r]=n[l]}function m(j,n){for(var l in j)l!=="default"&&!n.hasOwnProperty(l)&&(n[l]=j[l])}function o(j){var n=typeof Symbol==="function"&&Symbol.iterator,l=n&&j[n],r=0;if(l)return l.call(j);if(j&&typeof j.length==="number")return{next:function(){return j&&r>=j.length&&(j=void 0),{value:j&&j[r++],done:!j}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(j,n){var l=typeof Symbol==="function"&&j[Symbol.iterator];if(!l)return j;var r=l.call(j),w,p=[],F;try{for(;(n===void 0||n-- >0)&&!(w=r.next()).done;)p.push(w.value)}catch(H){F={error:H}}finally{try{w&&!w.done&&(l=r.return)&&l.call(r)}finally{if(F)throw F.error}}return p}function u(){for(var j=[],n=0;n<arguments.length;n++)j=j.concat(s(arguments[n]));return j}function v(){for(var j=0,n=0,l=arguments.length;n<l;n++)j+=arguments[n].length;for(var r=Array(j),w=0,n=0;n<l;n++)for(var p=arguments[n],F=0,H=p.length;F<H;F++,w++)r[w]=p[F];return r}function y(j){return this instanceof y?(this.v=j,this):new y(j)}function D(j,n,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=l.apply(j,n||[]),w,p=[];return w={},F("next"),F("throw"),F("return"),w[Symbol.asyncIterator]=function(){return this},w;function F(G){r[G]&&(w[G]=function(N){return new Promise(function(W,ha){p.push([G,N,W,ha])>1||H(G,N)})})}function H(G,N){try{Y(r[G](N))}catch(W){Q(p[0][3],W)}}function Y(G){G.value instanceof y?Promise.resolve(G.value.v).then(B,Z):Q(p[0][2],G)}function B(G){H("next",G)}function Z(G){H("throw",G)}function Q(G,N){(G(N),p.shift(),p.length)&&H(p[0][0],p[0][1])}}function J(j){var n,l;return n={},r("next"),r("throw",function(w){throw w}),r("return"),n[Symbol.iterator]=function(){return this},n;function r(w,p){n[w]=j[w]?function(F){return(l=!l)?{value:y(j[w](F)),done:w==="return"}:p?p(F):F}:p}}function I(j){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=j[Symbol.asyncIterator],l;return n?n.call(j):(j=typeof o==="function"?o(j):j[Symbol.iterator](),l={},r("next"),r("throw"),r("return"),l[Symbol.asyncIterator]=function(){return this},l);function r(p){l[p]=j[p]&&function(F){return new Promise(function(H,Y){F=j[p](F),w(H,Y,F.done,F.value)})}}function w(p,F,H,Y){Promise.resolve(Y).then(function(B){p({value:B,done:H})},F)}}function M(j,n){return Object.defineProperty?Object.defineProperty(j,"raw",{value:n}):j.raw=n,j}function K(j){if(j&&j.__esModule)return j;var n={};if(j!=null)for(var l in j)Object.hasOwnProperty.call(j,l)&&(n[l]=j[l]);return n.default=j,n}function O(j){return j&&j.__esModule?j:{default:j}}function P(j,n){if(!n.has(j))throw new TypeError("attempted to get private field on non-instance");return n.get(j)}function L(j,n,l){if(!n.has(j))throw new TypeError("attempted to set private field on non-instance");return n.set(j,l),l}});var dg=xb(S=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0});var a=Aj();var b={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};var c=function(A,x){if(!A)throw d(x)},d=function(A){return new Error("Firebase Database ("+b.SDK_VERSION+") INTERNAL ASSERT FAILED: "+A)};var e=function(A){for(var x=[],C=0,E=0;E<A.length;E++){var z=A.charCodeAt(E);z<128?x[C++]=z:z<2048?(x[C++]=z>>6|192,x[C++]=z&63|128):(z&64512)===55296&&E+1<A.length&&(A.charCodeAt(E+1)&64512)===56320?(z=65536+((z&1023)<<10)+(A.charCodeAt(++E)&1023),x[C++]=z>>18|240,x[C++]=z>>12&63|128,x[C++]=z>>6&63|128,x[C++]=z&63|128):(x[C++]=z>>12|224,x[C++]=z>>6&63|128,x[C++]=z&63|128)}return x},f=function(A){for(var x=[],C=0,E=0;C<A.length;){var z=A[C++];if(z<128)x[E++]=String.fromCharCode(z);else if(z>191&&z<224){var T=A[C++];x[E++]=String.fromCharCode((z&31)<<6|T&63)}else if(z>239&&z<365){var T=A[C++],$=A[C++],ja=A[C++],ia=((z&7)<<18|(T&63)<<12|($&63)<<6|ja&63)-65536;x[E++]=String.fromCharCode(55296+(ia>>10)),x[E++]=String.fromCharCode(56320+(ia&1023))}else{var T=A[C++],$=A[C++];x[E++]=String.fromCharCode((z&15)<<12|(T&63)<<6|$&63)}}return x.join("")},g={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob==="function",encodeByteArray:function(A,x){if(!Array.isArray(A))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var C=x?this.byteToCharMapWebSafe_:this.byteToCharMap_,E=[],z=0;z<A.length;z+=3){var T=A[z],$=z+1<A.length,ja=$?A[z+1]:0,ia=z+2<A.length,ma=ia?A[z+2]:0,ab=T>>2,Za=(T&3)<<4|ja>>4,Ma=(ja&15)<<2|ma>>6,Yf=ma&63;ia||(Yf=64,$||(Ma=64)),E.push(C[ab],C[Za],C[Ma],C[Yf])}return E.join("")},encodeString:function(A,x){return this.HAS_NATIVE_SUPPORT&&!x?btoa(A):this.encodeByteArray(e(A),x)},decodeString:function(A,x){return this.HAS_NATIVE_SUPPORT&&!x?atob(A):f(this.decodeStringToByteArray(A,x))},decodeStringToByteArray:function(A,x){this.init_();for(var C=x?this.charToByteMapWebSafe_:this.charToByteMap_,E=[],z=0;z<A.length;){var T=C[A.charAt(z++)],$=z<A.length,ja=$?C[A.charAt(z)]:0;++z;var ia=z<A.length,ma=ia?C[A.charAt(z)]:64;++z;var ab=z<A.length,Za=ab?C[A.charAt(z)]:64;++z;if(T==null||ja==null||ma==null||Za==null)throw Error();var Ma=T<<2|ja>>4;E.push(Ma);if(ma!==64){var Yf=ja<<4&240|ma>>2;E.push(Yf);if(Za!==64){var Fs=ma<<6&192|Za;E.push(Fs)}}}return E},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var A=0;A<this.ENCODED_VALS.length;A++)this.byteToCharMap_[A]=this.ENCODED_VALS.charAt(A),this.charToByteMap_[this.byteToCharMap_[A]]=A,this.byteToCharMapWebSafe_[A]=this.ENCODED_VALS_WEBSAFE.charAt(A),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[A]]=A,A>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(A)]=A,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(A)]=A)}}},i=function(A){var x=e(A);return g.encodeByteArray(x,!0)},h=function(A){try{return g.decodeString(A,!0)}catch(x){console.error("base64Decode failed: ",x)}return null};function k(A){return m(void 0,A)}function m(A,x){if(!(x instanceof Object))return x;switch(x.constructor){case Date:var C=x;return new Date(C.getTime());case Object:A===void 0&&(A={});break;case Array:A=[];break;default:return x}for(var E in x){if(!x.hasOwnProperty(E))continue;A[E]=m(A[E],x[E])}return A}var o=function(){function A(){var x=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(C,E){x.resolve=C,x.reject=E})}return A.prototype.wrapCallback=function(x){var C=this;return function(E,z){E?C.reject(E):C.resolve(z),typeof x==="function"&&(C.promise.catch(function(){}),x.length===1?x(E):x(E,z))}},A}();function s(){return typeof navigator!=="undefined"&&typeof navigator.userAgent==="string"?navigator.userAgent:""}function u(){return typeof window!=="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(s())}function v(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(A){return!1}}function y(){return typeof self==="object"&&self.self===self}function D(){var A=typeof chrome==="object"?chrome.runtime:typeof browser==="object"?browser.runtime:void 0;return typeof A==="object"&&A.id!==void 0}function J(){return typeof navigator==="object"&&navigator.product==="ReactNative"}function I(){return s().indexOf("Electron/")>=0}function M(){var A=s();return A.indexOf("MSIE ")>=0||A.indexOf("Trident/")>=0}function K(){return s().indexOf("MSAppHost/")>=0}function O(){return b.NODE_CLIENT===!0||b.NODE_ADMIN===!0}function P(){return!v()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function L(){return"indexedDB"in self&&indexedDB!==null}function q(){return new Promise(function(A,x){try{var C=!0,E="validate-browser-context-for-indexeddb-analytics-module",z=window.indexedDB.open(E);z.onsuccess=function(){z.result.close(),C||window.indexedDB.deleteDatabase(E),A(!0)},z.onupgradeneeded=function(){C=!1},z.onerror=function(){var T;x(((T=z.error)===null||T===void 0?void 0:T.message)||"")}}catch(T){x(T)}})}function t(){return!navigator||!navigator.cookieEnabled?!1:!0}var j="FirebaseError",n=function(A){a.__extends(x,A);function x(C,E){var z=A.call(this,E)||this;return z.code=C,z.name=j,Object.setPrototypeOf(z,x.prototype),Error.captureStackTrace&&Error.captureStackTrace(z,l.prototype.create),z}return x}(Error),l=function(){function A(x,C,E){this.service=x,this.serviceName=C,this.errors=E}return A.prototype.create=function(x){for(var C=[],E=1;E<arguments.length;E++)C[E-1]=arguments[E];for(var z=C[0]||{},T=this.service+"/"+x,$=this.errors[x],ja=$?r($,z):"Error",ia=this.serviceName+": "+ja+" ("+T+").",ma=new n(T,ia),ab=0,Za=Object.keys(z);ab<Za.length;ab++){var Ma=Za[ab];Ma.slice(-1)!=="_"&&(Ma in ma&&console.warn('Overwriting FirebaseError base field "'+Ma+'" can cause unexpected behavior.'),ma[Ma]=z[Ma])}return ma},A}();function r(A,x){return A.replace(w,function(C,E){var z=x[E];return z!=null?String(z):"<"+E+"?>"})}var w=/\{\$([^}]+)}/g;function p(A){return JSON.parse(A)}function F(A){return JSON.stringify(A)}var H=function(A){var x={},C={},E={},z="";try{var T=A.split(".");x=p(h(T[0])||""),C=p(h(T[1])||""),z=T[2],E=C.d||{},delete C.d}catch($){}return{header:x,claims:C,data:E,signature:z}},Y=function(A){var x=H(A).claims,C=Math.floor(new Date().getTime()/1e3),E=0,z=0;return typeof x==="object"&&(x.hasOwnProperty("nbf")?E=x.nbf:x.hasOwnProperty("iat")&&(E=x.iat),x.hasOwnProperty("exp")?z=x.exp:z=E+86400),!!C&&!!E&&!!z&&C>=E&&C<=z},B=function(A){var x=H(A).claims;return typeof x==="object"&&x.hasOwnProperty("iat")?x.iat:null},Z=function(A){var x=H(A),C=x.claims;return!!C&&typeof C==="object"&&C.hasOwnProperty("iat")},Q=function(A){var x=H(A).claims;return typeof x==="object"&&x.admin===!0};function G(A,x){return Object.prototype.hasOwnProperty.call(A,x)}function N(A,x){return Object.prototype.hasOwnProperty.call(A,x)?A[x]:void 0}function W(A){for(var x in A)if(Object.prototype.hasOwnProperty.call(A,x))return!1;return!0}function ha(A,x,C){var E={};for(var z in A)Object.prototype.hasOwnProperty.call(A,z)&&(E[z]=x.call(C,A[z],z,A));return E}function na(A){for(var x=[],C=function(ia,ma){Array.isArray(ma)?ma.forEach(function(ab){x.push(encodeURIComponent(ia)+"="+encodeURIComponent(ab))}):x.push(encodeURIComponent(ia)+"="+encodeURIComponent(ma))},E=0,z=Object.entries(A);E<z.length;E++){var T=z[E],$=T[0],ja=T[1];C($,ja)}return x.length?"&"+x.join("&"):""}function oa(A){var x={},C=A.replace(/^\?/,"").split("&");return C.forEach(function(E){if(E){var z=E.split("=");x[z[0]]=z[1]}}),x}var ua=function(){function A(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(var x=1;x<this.blockSize;++x)this.pad_[x]=0;this.reset()}return A.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},A.prototype.compress_=function(x,C){C||(C=0);var E=this.W_;if(typeof x==="string")for(var z=0;z<16;z++)E[z]=x.charCodeAt(C)<<24|x.charCodeAt(C+1)<<16|x.charCodeAt(C+2)<<8|x.charCodeAt(C+3),C+=4;else for(var z=0;z<16;z++)E[z]=x[C]<<24|x[C+1]<<16|x[C+2]<<8|x[C+3],C+=4;for(var z=16;z<80;z++){var T=E[z-3]^E[z-8]^E[z-14]^E[z-16];E[z]=(T<<1|T>>>31)&4294967295}for(var $=this.chain_[0],ja=this.chain_[1],ia=this.chain_[2],ma=this.chain_[3],ab=this.chain_[4],Za,Ma,z=0;z<80;z++){z<40?z<20?(Za=ma^ja&(ia^ma),Ma=1518500249):(Za=ja^ia^ma,Ma=1859775393):z<60?(Za=ja&ia|ma&(ja|ia),Ma=2400959708):(Za=ja^ia^ma,Ma=3395469782);var T=($<<5|$>>>27)+Za+ab+Ma+E[z]&4294967295;ab=ma,ma=ia,ia=(ja<<30|ja>>>2)&4294967295,ja=$,$=T}this.chain_[0]=this.chain_[0]+$&4294967295,this.chain_[1]=this.chain_[1]+ja&4294967295,this.chain_[2]=this.chain_[2]+ia&4294967295,this.chain_[3]=this.chain_[3]+ma&4294967295,this.chain_[4]=this.chain_[4]+ab&4294967295},A.prototype.update=function(x,C){if(x==null)return;C===void 0&&(C=x.length);for(var E=C-this.blockSize,z=0,T=this.buf_,$=this.inbuf_;z<C;){if($===0)for(;z<=E;)this.compress_(x,z),z+=this.blockSize;if(typeof x==="string")for(;z<C;){T[$]=x.charCodeAt(z),++$,++z;if($===this.blockSize){this.compress_(T),$=0;break}}else for(;z<C;){T[$]=x[z],++$,++z;if($===this.blockSize){this.compress_(T),$=0;break}}}this.inbuf_=$,this.total_+=C},A.prototype.digest=function(){var x=[],C=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var E=this.blockSize-1;E>=56;E--)this.buf_[E]=C&255,C/=256;this.compress_(this.buf_);for(var z=0,E=0;E<5;E++)for(var T=24;T>=0;T-=8)x[z]=this.chain_[E]>>T&255,++z;return x},A}();function X(A,x){var C=new ba(A,x);return C.subscribe.bind(C)}var ba=function(){function A(x,C){var E=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=C,this.task.then(function(){x(E)}).catch(function(z){E.error(z)})}return A.prototype.next=function(x){this.forEachObserver(function(C){C.next(x)})},A.prototype.error=function(x){this.forEachObserver(function(C){C.error(x)}),this.close(x)},A.prototype.complete=function(){this.forEachObserver(function(x){x.complete()}),this.close()},A.prototype.subscribe=function(x,C,E){var z=this,T;if(x===void 0&&C===void 0&&E===void 0)throw new Error("Missing Observer.");la(x,["next","error","complete"])?T=x:T={next:x,error:C,complete:E},T.next===void 0&&(T.next=R),T.error===void 0&&(T.error=R),T.complete===void 0&&(T.complete=R);var $=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{z.finalError?T.error(z.finalError):T.complete()}catch(ja){}return}),this.observers.push(T),$},A.prototype.unsubscribeOne=function(x){if(this.observers===void 0||this.observers[x]===void 0)return;delete this.observers[x],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this)},A.prototype.forEachObserver=function(x){if(this.finalized)return;for(var C=0;C<this.observers.length;C++)this.sendOne(C,x)},A.prototype.sendOne=function(x,C){var E=this;this.task.then(function(){if(E.observers!==void 0&&E.observers[x]!==void 0)try{C(E.observers[x])}catch(z){typeof console!=="undefined"&&console.error&&console.error(z)}})},A.prototype.close=function(x){var C=this;if(this.finalized)return;this.finalized=!0,x!==void 0&&(this.finalError=x),this.task.then(function(){C.observers=void 0,C.onNoObservers=void 0})},A}();function ka(A,x){return function(){for(var C=[],E=0;E<arguments.length;E++)C[E]=arguments[E];Promise.resolve(!0).then(function(){A.apply(void 0,C)}).catch(function(z){x&&x(z)})}}function la(A,x){if(typeof A!=="object"||A===null)return!1;for(var C=0,E=x;C<E.length;C++){var z=E[C];if(z in A&&typeof A[z]==="function")return!0}return!1}function R(){}var V=function(A,x,C,E){var z;E<x?z="at least "+x:E>C&&(z=C===0?"none":"no more than "+C);if(z){var T=A+" failed: Was called with "+E+(E===1?" argument.":" arguments.")+" Expects "+z+".";throw new Error(T)}};function ga(A,x,C){var E="";switch(x){case 1:E=C?"first":"First";break;case 2:E=C?"second":"Second";break;case 3:E=C?"third":"Third";break;case 4:E=C?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var z=A+" failed: ";return z+=E+" argument ",z}function U(A,x,C,E){if(E&&!C)return;if(typeof C!=="string")throw new Error(ga(A,x,E)+"must be a valid firebase namespace.")}function ca(A,x,C,E){if(E&&!C)return;if(typeof C!=="function")throw new Error(ga(A,x,E)+"must be a valid function.")}function pa(A,x,C,E){if(E&&!C)return;if(typeof C!=="object"||C===null)throw new Error(ga(A,x,E)+"must be a valid context object.")}var va=function(A){for(var x=[],C=0,E=0;E<A.length;E++){var z=A.charCodeAt(E);if(z>=55296&&z<=56319){var T=z-55296;E++,c(E<A.length,"Surrogate pair missing trail surrogate.");var $=A.charCodeAt(E)-56320;z=65536+(T<<10)+$}z<128?x[C++]=z:z<2048?(x[C++]=z>>6|192,x[C++]=z&63|128):z<65536?(x[C++]=z>>12|224,x[C++]=z>>6&63|128,x[C++]=z&63|128):(x[C++]=z>>18|240,x[C++]=z>>12&63|128,x[C++]=z>>6&63|128,x[C++]=z&63|128)}return x},Da=function(A){for(var x=0,C=0;C<A.length;C++){var E=A.charCodeAt(C);E<128?x++:E<2048?x+=2:E>=55296&&E<=56319?(x+=4,C++):x+=3}return x};S.CONSTANTS=b;S.Deferred=o;S.ErrorFactory=l;S.FirebaseError=n;S.Sha1=ua;S.areCookiesEnabled=t;S.assert=c;S.assertionError=d;S.async=ka;S.base64=g;S.base64Decode=h;S.base64Encode=i;S.contains=G;S.createSubscribe=X;S.decode=H;S.deepCopy=k;S.deepExtend=m;S.errorPrefix=ga;S.getUA=s;S.isAdmin=Q;S.isBrowser=y;S.isBrowserExtension=D;S.isElectron=I;S.isEmpty=W;S.isIE=M;S.isIndexedDBAvailable=L;S.isMobileCordova=u;S.isNode=v;S.isNodeSdk=O;S.isReactNative=J;S.isSafari=P;S.isUWP=K;S.isValidFormat=Z;S.isValidTimestamp=Y;S.issuedAtTime=B;S.jsonEval=p;S.map=ha;S.querystring=na;S.querystringDecode=oa;S.safeGet=N;S.stringLength=Da;S.stringToByteArray=va;S.stringify=F;S.validateArgCount=V;S.validateCallback=ca;S.validateContextObject=pa;S.validateIndexedDBOpenable=q;S.validateNamespace=U});var yj=xb(q=>{Fc(q,{__assign:()=>c,__asyncDelegator:()=>J,__asyncGenerator:()=>D,__asyncValues:()=>I,__await:()=>y,__awaiter:()=>i,__classPrivateFieldGet:()=>P,__classPrivateFieldSet:()=>L,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>m,__extends:()=>b,__generator:()=>h,__importDefault:()=>O,__importStar:()=>K,__makeTemplateObject:()=>M,__metadata:()=>g,__param:()=>f,__read:()=>s,__rest:()=>d,__spread:()=>u,__spreadArrays:()=>v,__values:()=>o});var a=function(j,n){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,r){l.__proto__=r}||function(l,r){for(var w in r)r.hasOwnProperty(w)&&(l[w]=r[w])},a(j,n)};function b(j,n){a(j,n);function l(){this.constructor=j}j.prototype=n===null?Object.create(n):(l.prototype=n.prototype,new l())}var c=function(){return c=Object.assign||function j(n){for(var l,r=1,w=arguments.length;r<w;r++){l=arguments[r];for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(n[p]=l[p])}return n},c.apply(this,arguments)};function d(j,n){var l={};for(var r in j)Object.prototype.hasOwnProperty.call(j,r)&&n.indexOf(r)<0&&(l[r]=j[r]);if(j!=null&&typeof Object.getOwnPropertySymbols==="function")for(var w=0,r=Object.getOwnPropertySymbols(j);w<r.length;w++)n.indexOf(r[w])<0&&Object.prototype.propertyIsEnumerable.call(j,r[w])&&(l[r[w]]=j[r[w]]);return l}function e(j,n,l,r){var w=arguments.length,p=w<3?n:r===null?r=Object.getOwnPropertyDescriptor(n,l):r,F;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")p=Reflect.decorate(j,n,l,r);else for(var H=j.length-1;H>=0;H--)(F=j[H])&&(p=(w<3?F(p):w>3?F(n,l,p):F(n,l))||p);return w>3&&p&&Object.defineProperty(n,l,p),p}function f(j,n){return function(l,r){n(l,r,j)}}function g(j,n){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(j,n)}function i(j,n,l,r){function w(p){return p instanceof l?p:new l(function(F){F(p)})}return new(l||(l=Promise))(function(p,F){function H(Z){try{B(r.next(Z))}catch(Q){F(Q)}}function Y(Z){try{B(r.throw(Z))}catch(Q){F(Q)}}function B(Z){Z.done?p(Z.value):w(Z.value).then(H,Y)}B((r=r.apply(j,n||[])).next())})}function h(j,n){var l={label:0,sent:function(){if(p[0]&1)throw p[1];return p[1]},trys:[],ops:[]},r,w,p,F;return F={next:H(0),throw:H(1),return:H(2)},typeof Symbol==="function"&&(F[Symbol.iterator]=function(){return this}),F;function H(B){return function(Z){return Y([B,Z])}}function Y(B){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,w&&(p=B[0]&2?w.return:B[0]?w.throw||((p=w.return)&&p.call(w),0):w.next)&&!(p=p.call(w,B[1])).done)return p;(w=0,p)&&(B=[B[0]&2,p.value]);switch(B[0]){case 0:case 1:p=B;break;case 4:return l.label++,{value:B[1],done:!1};case 5:l.label++,w=B[1],B=[0];continue;case 7:B=l.ops.pop(),l.trys.pop();continue;default:if(!(p=l.trys,p=p.length>0&&p[p.length-1])&&(B[0]===6||B[0]===2)){l=0;continue}if(B[0]===3&&(!p||B[1]>p[0]&&B[1]<p[3])){l.label=B[1];break}if(B[0]===6&&l.label<p[1]){l.label=p[1],p=B;break}if(p&&l.label<p[2]){l.label=p[2],l.ops.push(B);break}p[2]&&l.ops.pop(),l.trys.pop();continue}B=n.call(j,l)}catch(Z){B=[6,Z],w=0}finally{r=p=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}}function k(j,n,l,r){r===void 0&&(r=l),j[r]=n[l]}function m(j,n){for(var l in j)l!=="default"&&!n.hasOwnProperty(l)&&(n[l]=j[l])}function o(j){var n=typeof Symbol==="function"&&Symbol.iterator,l=n&&j[n],r=0;if(l)return l.call(j);if(j&&typeof j.length==="number")return{next:function(){return j&&r>=j.length&&(j=void 0),{value:j&&j[r++],done:!j}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(j,n){var l=typeof Symbol==="function"&&j[Symbol.iterator];if(!l)return j;var r=l.call(j),w,p=[],F;try{for(;(n===void 0||n-- >0)&&!(w=r.next()).done;)p.push(w.value)}catch(H){F={error:H}}finally{try{w&&!w.done&&(l=r.return)&&l.call(r)}finally{if(F)throw F.error}}return p}function u(){for(var j=[],n=0;n<arguments.length;n++)j=j.concat(s(arguments[n]));return j}function v(){for(var j=0,n=0,l=arguments.length;n<l;n++)j+=arguments[n].length;for(var r=Array(j),w=0,n=0;n<l;n++)for(var p=arguments[n],F=0,H=p.length;F<H;F++,w++)r[w]=p[F];return r}function y(j){return this instanceof y?(this.v=j,this):new y(j)}function D(j,n,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=l.apply(j,n||[]),w,p=[];return w={},F("next"),F("throw"),F("return"),w[Symbol.asyncIterator]=function(){return this},w;function F(G){r[G]&&(w[G]=function(N){return new Promise(function(W,ha){p.push([G,N,W,ha])>1||H(G,N)})})}function H(G,N){try{Y(r[G](N))}catch(W){Q(p[0][3],W)}}function Y(G){G.value instanceof y?Promise.resolve(G.value.v).then(B,Z):Q(p[0][2],G)}function B(G){H("next",G)}function Z(G){H("throw",G)}function Q(G,N){(G(N),p.shift(),p.length)&&H(p[0][0],p[0][1])}}function J(j){var n,l;return n={},r("next"),r("throw",function(w){throw w}),r("return"),n[Symbol.iterator]=function(){return this},n;function r(w,p){n[w]=j[w]?function(F){return(l=!l)?{value:y(j[w](F)),done:w==="return"}:p?p(F):F}:p}}function I(j){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=j[Symbol.asyncIterator],l;return n?n.call(j):(j=typeof o==="function"?o(j):j[Symbol.iterator](),l={},r("next"),r("throw"),r("return"),l[Symbol.asyncIterator]=function(){return this},l);function r(p){l[p]=j[p]&&function(F){return new Promise(function(H,Y){F=j[p](F),w(H,Y,F.done,F.value)})}}function w(p,F,H,Y){Promise.resolve(Y).then(function(B){p({value:B,done:H})},F)}}function M(j,n){return Object.defineProperty?Object.defineProperty(j,"raw",{value:n}):j.raw=n,j}function K(j){if(j&&j.__esModule)return j;var n={};if(j!=null)for(var l in j)Object.hasOwnProperty.call(j,l)&&(n[l]=j[l]);return n.default=j,n}function O(j){return j&&j.__esModule?j:{default:j}}function P(j,n){if(!n.has(j))throw new TypeError("attempted to get private field on non-instance");return n.get(j)}function L(j,n,l){if(!n.has(j))throw new TypeError("attempted to set private field on non-instance");return n.set(j,l),l}});var xj=xb(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0});var a=yj(),b=dg(),c=function(){function m(o,s,u){this.name=o,this.instanceFactory=s,this.type=u,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return m.prototype.setInstantiationMode=function(o){return this.instantiationMode=o,this},m.prototype.setMultipleInstances=function(o){return this.multipleInstances=o,this},m.prototype.setServiceProps=function(o){return this.serviceProps=o,this},m}();var d="[DEFAULT]";var e=function(){function m(o,s){this.name=o,this.container=s,this.component=null,this.instances=new Map(),this.instancesDeferred=new Map()}return m.prototype.get=function(o){o===void 0&&(o=d);var s=this.normalizeInstanceIdentifier(o);if(!this.instancesDeferred.has(s)){var u=new b.Deferred();this.instancesDeferred.set(s,u);try{var v=this.getOrInitializeService(s);v&&u.resolve(v)}catch(y){}}return this.instancesDeferred.get(s).promise},m.prototype.getImmediate=function(o){var s=a.__assign({identifier:d,optional:!1},o),u=s.identifier,v=s.optional,y=this.normalizeInstanceIdentifier(u);try{var D=this.getOrInitializeService(y);if(!D){if(v)return null;throw Error("Service "+this.name+" is not available")}return D}catch(J){if(v)return null;throw J}},m.prototype.getComponent=function(){return this.component},m.prototype.setComponent=function(o){var s,u;if(o.name!==this.name)throw Error("Mismatching Component "+o.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");this.component=o;if(g(o))try{this.getOrInitializeService(d)}catch(O){}try{for(var v=a.__values(this.instancesDeferred.entries()),y=v.next();!y.done;y=v.next()){var D=a.__read(y.value,2),J=D[0],I=D[1],M=this.normalizeInstanceIdentifier(J);try{var K=this.getOrInitializeService(M);I.resolve(K)}catch(O){}}}catch(O){s={error:O}}finally{try{y&&!y.done&&(u=v.return)&&u.call(v)}finally{if(s)throw s.error}}},m.prototype.clearInstance=function(o){o===void 0&&(o=d),this.instancesDeferred.delete(o),this.instances.delete(o)},m.prototype.delete=function(){return a.__awaiter(this,void 0,void 0,function(){var o;return a.__generator(this,function(s){switch(s.label){case 0:return o=Array.from(this.instances.values()),[4,Promise.all(o.filter(function(u){return"INTERNAL"in u}).map(function(u){return u.INTERNAL.delete()}))];case 1:return s.sent(),[2]}})})},m.prototype.isComponentSet=function(){return this.component!=null},m.prototype.getOrInitializeService=function(o){var s=this.instances.get(o);return!s&&this.component&&(s=this.component.instanceFactory(this.container,f(o)),this.instances.set(o,s)),s||null},m.prototype.normalizeInstanceIdentifier=function(o){return this.component?this.component.multipleInstances?o:d:o},m}();function f(m){return m===d?void 0:m}function g(m){return m.instantiationMode==="EAGER"}var i=function(){function m(o){this.name=o,this.providers=new Map()}return m.prototype.addComponent=function(o){var s=this.getProvider(o.name);if(s.isComponentSet())throw new Error("Component "+o.name+" has already been registered with "+this.name);s.setComponent(o)},m.prototype.addOrOverwriteComponent=function(o){var s=this.getProvider(o.name);s.isComponentSet()&&this.providers.delete(o.name),this.addComponent(o)},m.prototype.getProvider=function(o){if(this.providers.has(o))return this.providers.get(o);var s=new e(o,this);return this.providers.set(o,s),s},m.prototype.getProviders=function(){return Array.from(this.providers.values())},m}();h.Component=c;h.ComponentContainer=i;h.Provider=e});var zj=xb(o=>{Fc(o,{LogLevel:()=>d,Logger:()=>h,setLogLevel:()=>k,setUserLogHandler:()=>m});function a(){for(var u=0,v=0,y=arguments.length;v<y;v++)u+=arguments[v].length;for(var D=Array(u),J=0,v=0;v<y;v++)for(var I=arguments[v],M=0,K=I.length;M<K;M++,J++)D[J]=I[M];return D}var b,c=[],d;(function(u){u[u.DEBUG=0]="DEBUG",u[u.VERBOSE=1]="VERBOSE",u[u.INFO=2]="INFO",u[u.WARN=3]="WARN",u[u.ERROR=4]="ERROR",u[u.SILENT=5]="SILENT"})(d||(d={}));var e={debug:d.DEBUG,verbose:d.VERBOSE,info:d.INFO,warn:d.WARN,error:d.ERROR,silent:d.SILENT},f=d.INFO,g=(b={},b[d.DEBUG]="log",b[d.VERBOSE]="log",b[d.INFO]="info",b[d.WARN]="warn",b[d.ERROR]="error",b),i=function(u,v){for(var y=[],D=2;D<arguments.length;D++)y[D-2]=arguments[D];if(v<u.logLevel)return;var J=new Date().toISOString(),I=g[v];if(I)console[I].apply(console,a(["["+J+"]  "+u.name+":"],y));else throw new Error("Attempted to log a message with an invalid logType (value: "+v+")")},h=function(){function u(v){this.name=v,this._logLevel=f,this._logHandler=i,this._userLogHandler=null,c.push(this)}return Object.defineProperty(u.prototype,"logLevel",{get:function(){return this._logLevel},set:function(v){if(!(v in d))throw new TypeError('Invalid value "'+v+'" assigned to `logLevel`');this._logLevel=v},enumerable:!1,configurable:!0}),u.prototype.setLogLevel=function(v){this._logLevel=typeof v==="string"?e[v]:v},Object.defineProperty(u.prototype,"logHandler",{get:function(){return this._logHandler},set:function(v){if(typeof v!=="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=v},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(v){this._userLogHandler=v},enumerable:!1,configurable:!0}),u.prototype.debug=function(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.DEBUG],v)),this._logHandler.apply(this,a([this,d.DEBUG],v))},u.prototype.log=function(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.VERBOSE],v)),this._logHandler.apply(this,a([this,d.VERBOSE],v))},u.prototype.info=function(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.INFO],v)),this._logHandler.apply(this,a([this,d.INFO],v))},u.prototype.warn=function(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.WARN],v)),this._logHandler.apply(this,a([this,d.WARN],v))},u.prototype.error=function(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.ERROR],v)),this._logHandler.apply(this,a([this,d.ERROR],v))},u}();function k(u){c.forEach(function(v){v.setLogLevel(u)})}function m(u,v){for(var y=function(M){var K=null;v&&v.level&&(K=e[v.level]),u===null?M.userLogHandler=null:M.userLogHandler=function(O,P){for(var L=[],q=2;q<arguments.length;q++)L[q-2]=arguments[q];var t=L.map(function(j){if(j==null)return null;{if(typeof j==="string")return j;{if(typeof j==="number"||typeof j==="boolean")return j.toString();{if(j instanceof Error)return j.message;try{return JSON.stringify(j)}catch(n){return null}}}}}).filter(function(j){return j}).join(" ");P>=(K!==null&&K!==void 0?K:O.logLevel)&&u({level:d[P].toLowerCase(),message:t,args:L,type:O.name})}},D=0,J=c;D<J.length;D++){var I=J[D];y(I)}}});var vj=xb(B=>{"use strict";Object.defineProperty(B,"__esModule",{value:!0});var a=wj(),b=dg(),c=xj(),d=zj();var e,f=(e={},e["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",e["bad-app-name"]="Illegal App name: '{$appName}",e["duplicate-app"]="Firebase App named '{$appName}' already exists",e["app-deleted"]="Firebase App named '{$appName}' already deleted",e["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",e["invalid-log-argument"]="First argument to `onLog` must be null or a function.",e),g=new b.ErrorFactory("app","Firebase",f),i="@firebase/app",h="0.6.10",k="@firebase/analytics",m="@firebase/auth",o="@firebase/database",s="@firebase/functions",u="@firebase/installations",v="@firebase/messaging",y="@firebase/performance",D="@firebase/remote-config",J="@firebase/storage",I="@firebase/firestore",M="firebase-wrapper";var K,O="[DEFAULT]",P=(K={},K[i]="fire-core",K[k]="fire-analytics",K[m]="fire-auth",K[o]="fire-rtdb",K[s]="fire-fn",K[u]="fire-iid",K[v]="fire-fcm",K[y]="fire-perf",K[D]="fire-rc",K[J]="fire-gcs",K[I]="fire-fst",K["fire-js"]="fire-js",K[M]="fire-js-all",K);var L=new d.Logger("@firebase/app");var q=function(){function Q(G,N,W){var ha,na,oa=this;this.firebase_=W,this.isDeleted_=!1,this.name_=N.name,this.automaticDataCollectionEnabled_=N.automaticDataCollectionEnabled||!1,this.options_=b.deepCopy(G),this.container=new c.ComponentContainer(N.name),this._addComponent(new c.Component("app",function(){return oa},"PUBLIC"));try{for(var ua=a.__values(this.firebase_.INTERNAL.components.values()),X=ua.next();!X.done;X=ua.next()){var ba=X.value;this._addComponent(ba)}}catch(ka){ha={error:ka}}finally{try{X&&!X.done&&(na=ua.return)&&na.call(ua)}finally{if(ha)throw ha.error}}}return Object.defineProperty(Q.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(G){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=G},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),Q.prototype.delete=function(){var G=this;return new Promise(function(N){G.checkDestroyed_(),N()}).then(function(){return G.firebase_.INTERNAL.removeApp(G.name_),Promise.all(G.container.getProviders().map(function(N){return N.delete()}))}).then(function(){G.isDeleted_=!0})},Q.prototype._getService=function(G,N){return N===void 0&&(N=O),this.checkDestroyed_(),this.container.getProvider(G).getImmediate({identifier:N})},Q.prototype._removeServiceInstance=function(G,N){N===void 0&&(N=O),this.container.getProvider(G).clearInstance(N)},Q.prototype._addComponent=function(G){try{this.container.addComponent(G)}catch(N){L.debug("Component "+G.name+" failed to register with FirebaseApp "+this.name,N)}},Q.prototype._addOrOverwriteComponent=function(G){this.container.addOrOverwriteComponent(G)},Q.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw g.create("app-deleted",{appName:this.name_})},Q}();q.prototype.name&&q.prototype.options||q.prototype.delete||console.log("dc");var t="7.18.0";function j(Q){var G={},N=new Map(),W={__esModule:!0,initializeApp:oa,app:na,registerVersion:ba,setLogLevel:d.setLogLevel,onLog:ka,apps:null,SDK_VERSION:t,INTERNAL:{registerComponent:X,removeApp:ha,components:N,useAsService:la}};W.default=W,Object.defineProperty(W,"apps",{get:ua});function ha(R){delete G[R]}function na(R){R=R||O;if(!b.contains(G,R))throw g.create("no-app",{appName:R});return G[R]}na.App=Q;function oa(R,V){V===void 0&&(V={});if(typeof V!=="object"||V===null){var ga=V;V={name:ga}}var U=V;U.name===void 0&&(U.name=O);var ca=U.name;if(typeof ca!=="string"||!ca)throw g.create("bad-app-name",{appName:String(ca)});if(b.contains(G,ca))throw g.create("duplicate-app",{appName:ca});var pa=new Q(R,U,W);return G[ca]=pa,pa}function ua(){return Object.keys(G).map(function(R){return G[R]})}function X(R){var V,ga,U=R.name;if(N.has(U))return L.debug("There were multiple attempts to register component "+U+"."),R.type==="PUBLIC"?W[U]:null;N.set(U,R);if(R.type==="PUBLIC"){var ca=function(S){S===void 0&&(S=na());if(typeof S[U]!=="function")throw g.create("invalid-app-argument",{appName:U});return S[U]()};R.serviceProps!==void 0&&b.deepExtend(ca,R.serviceProps),W[U]=ca,Q.prototype[U]=function(){for(var S=[],Ea=0;Ea<arguments.length;Ea++)S[Ea]=arguments[Ea];var A=this._getService.bind(this,U);return A.apply(this,R.multipleInstances?S:[])}}try{for(var pa=a.__values(Object.keys(G)),va=pa.next();!va.done;va=pa.next()){var Da=va.value;G[Da]._addComponent(R)}}catch(S){V={error:S}}finally{try{va&&!va.done&&(ga=pa.return)&&ga.call(pa)}finally{if(V)throw V.error}}return R.type==="PUBLIC"?W[U]:null}function ba(R,V,ga){var U,ca=(U=P[R])!==null&&U!==void 0?U:R;ga&&(ca+="-"+ga);var pa=ca.match(/\s|\//),va=V.match(/\s|\//);if(pa||va){var Da=['Unable to register library "'+ca+'" with version "'+V+'":'];pa&&Da.push('library name "'+ca+'" contains illegal characters (whitespace or "/")'),pa&&va&&Da.push("and"),va&&Da.push('version name "'+V+'" contains illegal characters (whitespace or "/")'),L.warn(Da.join(" "));return}X(new c.Component(ca+"-version",function(){return{library:ca,version:V}},"VERSION"))}function ka(R,V){if(R!==null&&typeof R!=="function")throw g.create("invalid-log-argument",{appName:name});d.setUserLogHandler(R,V)}function la(R,V){if(V==="serverAuth")return null;var ga=V;return ga}return W}function n(){var Q=j(q);Q.INTERNAL=a.__assign(a.__assign({},Q.INTERNAL),{createFirebaseNamespace:n,extendNamespace:G,createSubscribe:b.createSubscribe,ErrorFactory:b.ErrorFactory,deepExtend:b.deepExtend});function G(N){b.deepExtend(Q,N)}return Q}var l=n();var r=function(){function Q(G){this.container=G}return Q.prototype.getPlatformInfoString=function(){var G=this.container.getProviders();return G.map(function(N){if(w(N)){var W=N.getImmediate();return W.library+"/"+W.version}else return null}).filter(function(N){return N}).join(" ")},Q}();function w(Q){var G=Q.getComponent();return(G===null||G===void 0?void 0:G.type)==="VERSION"}function p(Q,G){Q.INTERNAL.registerComponent(new c.Component("platform-logger",function(N){return new r(N)},"PRIVATE")),Q.registerVersion(i,h,G),Q.registerVersion("fire-js","")}if(b.isBrowser()&&self.firebase!==void 0){L.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);var F=self.firebase.SDK_VERSION;F&&F.indexOf("LITE")>=0&&L.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}var H=l.initializeApp;l.initializeApp=function(){for(var Q=[],G=0;G<arguments.length;G++)Q[G]=arguments[G];return b.isNode()&&L.warn(`
      Warning: This is a browser-targeted Firebase bundle but it appears it is being
      run in a Node environment.  If running in a Node environment, make sure you
      are using the bundle specified by the "main" field in package.json.
      
      If you are using Webpack, you can specify "main" as the first item in
      "resolve.mainFields":
      https://webpack.js.org/configuration/resolve/#resolvemainfields
      
      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"
      as the first item in "mainFields", e.g. ['main', 'module'].
      https://github.com/rollup/rollup-plugin-node-resolve
      `),H.apply(void 0,Q)};var Y=l;p(Y);B.default=Y;B.firebase=Y});var Sa=xb((e,f)=>{"use strict";function a(g){return g&&typeof g==="object"&&"default"in g?g.default:g}var b=a(vj()),c="firebase",d="7.19.0";b.registerVersion(c,d,"app");f.exports=b});var Kp=xb((b,c)=>{var a=function(){function d(k,m){if(!i[k]){i[k]={};for(var o=0;o<k.length;o++)i[k][k.charAt(o)]=o}return i[k][m]}var e=String.fromCharCode,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",i={},h={compressToBase64:function(k){if(null==k)return"";var m=h._compress(k,6,function(o){return f.charAt(o)});switch(m.length%4){default:case 0:return m;case 1:return m+"===";case 2:return m+"==";case 3:return m+"="}},decompressFromBase64:function(k){return null==k?"":""==k?null:h._decompress(k.length,32,function(m){return d(f,k.charAt(m))})},compressToUTF16:function(k){return null==k?"":h._compress(k,15,function(m){return e(m+32)})+" "},decompressFromUTF16:function(k){return null==k?"":""==k?null:h._decompress(k.length,16384,function(m){return k.charCodeAt(m)-32})},compressToUint8Array:function(k){for(var m=h.compress(k),o=new Uint8Array(2*m.length),s=0,u=m.length;u>s;s++){var v=m.charCodeAt(s);o[2*s]=v>>>8,o[2*s+1]=v%256}return o},decompressFromUint8Array:function(k){if(null===k||void 0===k)return h.decompress(k);for(var m=new Array(k.length/2),o=0,s=m.length;s>o;o++)m[o]=256*k[2*o]+k[2*o+1];var u=[];return m.forEach(function(v){u.push(e(v))}),h.decompress(u.join(""))},compressToEncodedURIComponent:function(k){return null==k?"":h._compress(k,6,function(m){return g.charAt(m)})},decompressFromEncodedURIComponent:function(k){return null==k?"":""==k?null:(k=k.replace(/ /g,"+"),h._decompress(k.length,32,function(m){return d(g,k.charAt(m))}))},compress:function(k){return h._compress(k,16,function(m){return e(m)})},_compress:function(k,m,o){if(null==k)return"";var s,u,v,y={},D={},J="",I="",M="",K=2,O=3,P=2,L=[],q=0,t=0;for(v=0;v<k.length;v+=1)if(J=k.charAt(v),Object.prototype.hasOwnProperty.call(y,J)||(y[J]=O++,D[J]=!0),I=M+J,Object.prototype.hasOwnProperty.call(y,I))M=I;else{if(Object.prototype.hasOwnProperty.call(D,M)){if(M.charCodeAt(0)<256){for(s=0;P>s;s++)q<<=1,t==m-1?(t=0,L.push(o(q)),q=0):t++;for(u=M.charCodeAt(0),s=0;8>s;s++)q=q<<1|1&u,t==m-1?(t=0,L.push(o(q)),q=0):t++,u>>=1}else{for(u=1,s=0;P>s;s++)q=q<<1|u,t==m-1?(t=0,L.push(o(q)),q=0):t++,u=0;for(u=M.charCodeAt(0),s=0;16>s;s++)q=q<<1|1&u,t==m-1?(t=0,L.push(o(q)),q=0):t++,u>>=1}K--,0==K&&(K=Math.pow(2,P),P++),delete D[M]}else for(u=y[M],s=0;P>s;s++)q=q<<1|1&u,t==m-1?(t=0,L.push(o(q)),q=0):t++,u>>=1;K--,0==K&&(K=Math.pow(2,P),P++),y[I]=O++,M=String(J)}if(""!==M){if(Object.prototype.hasOwnProperty.call(D,M)){if(M.charCodeAt(0)<256){for(s=0;P>s;s++)q<<=1,t==m-1?(t=0,L.push(o(q)),q=0):t++;for(u=M.charCodeAt(0),s=0;8>s;s++)q=q<<1|1&u,t==m-1?(t=0,L.push(o(q)),q=0):t++,u>>=1}else{for(u=1,s=0;P>s;s++)q=q<<1|u,t==m-1?(t=0,L.push(o(q)),q=0):t++,u=0;for(u=M.charCodeAt(0),s=0;16>s;s++)q=q<<1|1&u,t==m-1?(t=0,L.push(o(q)),q=0):t++,u>>=1}K--,0==K&&(K=Math.pow(2,P),P++),delete D[M]}else for(u=y[M],s=0;P>s;s++)q=q<<1|1&u,t==m-1?(t=0,L.push(o(q)),q=0):t++,u>>=1;K--,0==K&&(K=Math.pow(2,P),P++)}for(u=2,s=0;P>s;s++)q=q<<1|1&u,t==m-1?(t=0,L.push(o(q)),q=0):t++,u>>=1;for(;;){if(q<<=1,t==m-1){L.push(o(q));break}t++}return L.join("")},decompress:function(k){return null==k?"":""==k?null:h._decompress(k.length,32768,function(m){return k.charCodeAt(m)})},_decompress:function(k,m,o){var s,u,v,y,D,J,I,M,K=[],O=4,P=4,L=3,q="",t=[],j={val:o(0),position:m,index:1};for(u=0;3>u;u+=1)K[u]=u;for(y=0,J=Math.pow(2,2),I=1;I!=J;)D=j.val&j.position,j.position>>=1,0==j.position&&(j.position=m,j.val=o(j.index++)),y|=(D>0?1:0)*I,I<<=1;switch(s=y){case 0:for(y=0,J=Math.pow(2,8),I=1;I!=J;)D=j.val&j.position,j.position>>=1,0==j.position&&(j.position=m,j.val=o(j.index++)),y|=(D>0?1:0)*I,I<<=1;M=e(y);break;case 1:for(y=0,J=Math.pow(2,16),I=1;I!=J;)D=j.val&j.position,j.position>>=1,0==j.position&&(j.position=m,j.val=o(j.index++)),y|=(D>0?1:0)*I,I<<=1;M=e(y);break;case 2:return""}for(K[3]=M,v=M,t.push(M);;){if(j.index>k)return"";for(y=0,J=Math.pow(2,L),I=1;I!=J;)D=j.val&j.position,j.position>>=1,0==j.position&&(j.position=m,j.val=o(j.index++)),y|=(D>0?1:0)*I,I<<=1;switch(M=y){case 0:for(y=0,J=Math.pow(2,8),I=1;I!=J;)D=j.val&j.position,j.position>>=1,0==j.position&&(j.position=m,j.val=o(j.index++)),y|=(D>0?1:0)*I,I<<=1;K[P++]=e(y),M=P-1,O--;break;case 1:for(y=0,J=Math.pow(2,16),I=1;I!=J;)D=j.val&j.position,j.position>>=1,0==j.position&&(j.position=m,j.val=o(j.index++)),y|=(D>0?1:0)*I,I<<=1;K[P++]=e(y),M=P-1,O--;break;case 2:return t.join("")}if(0==O&&(O=Math.pow(2,L),L++),K[M])q=K[M];else{if(M!==P)return null;q=v+v.charAt(0)}t.push(q),K[P++]=v+q.charAt(0),O--,v=q,0==O&&(O=Math.pow(2,L),L++)}}};return h}();"function"==typeof define&&define.amd?define(function(){return a}):"undefined"!=typeof c&&null!=c&&(c.exports=a)});let Fj,Gj=0,Hj=0;const wa={get:()=>Fj,set:a=>{Fj=a},getFrame:()=>Gj,setFrame:a=>{Gj=a},getElapsed:()=>Hj,setElapsed:a=>{Hj=a}};let Lj=0;function Zf(a=0){return()=>{Lj=a}}function Ud(){return Lj}let ig="Phaser",Op="https://phaser4.io",Pp="#fff",Qp="linear-gradient(#3e0081 40%, #00bcc3)";function eg(){if(ig!==""){const a=wa.get(),b=ig==="Phaser"?" v"+a.VERSION:"";console.log(`%c${ig}${b}%c ${Op}`,`padding: 4px 16px; color: ${Pp}; background: ${Qp}`,"")}}let Qj=800,Rj=600,Sj=1;function ag(a=800,b=600,c=1){return c===0&&(c=window.devicePixelRatio),()=>{Qj=a,Rj=b,Sj=c}}function Hb(){return Qj}function Ib(){return Rj}function Jb(){return Sj}const yg=[],Jc={add:a=>{yg.push(a)},get:()=>yg,clear:()=>{yg.length=0}};let Pj;function Vd(a){Pj=a}function fg(){return Pj}let jg=.5,kg=.5;let Mj=0;function lg(a){Mj=a}function ad(){return Mj}function Wd(a){let b;return a&&(typeof a==="string"?b=document.getElementById(a):typeof a==="object"&&a.nodeType===1&&(b=a)),b||(b=document.body),b}let Nj;function _f(a){return()=>{a&&(Nj=Wd(a))}}function gg(){return Nj}let Oj=[];function $f(a){return()=>{Oj=[].concat(a)}}function mg(){return Oj}let Sp={alpha:!1,antialias:!1,depth:!1,premultipliedAlpha:!1};function ng(){return Sp}class lk{constructor(a){this.stack=[],this.current=null,this.renderer=a}reset(){this.stack=[],this.current=null;const a=this.renderer,b=a.gl;b.bindFramebuffer(b.FRAMEBUFFER,null),b.viewport(0,0,a.width,a.height)}add(a,b=!0,c=0,d=0){this.stack.push({framebuffer:a,width:c,height:d}),this.set(a,b,c,d)}set(a,b=!0,c=0,d=0){const e=this.renderer,f=e.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),b&&(f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),c>0&&f.viewport(0,0,c,d),this.current=a}pop(){this.stack.pop();const a=this.stack.length;if(a>0){const b=this.stack[a-1];this.set(b.framebuffer,!1,b.width,b.height)}else this.reset()}rebind(){const a=this.renderer.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.current)}destroy(){this.stack=[]}}let kk;const Ba={get:()=>kk,set:a=>{kk=a}};function mk(a,b=[]){const c=a>>16&255,d=a>>8&255,e=a&255,f=a>16777215?a>>>24:255;return b[0]=c/255,b[1]=d/255,b[2]=e/255,b[3]=f/255,b}function hk(a,b){return a.a===b.a&&a.b===b.b&&a.c===b.c&&a.d===b.d&&a.tx===b.tx&&a.ty===b.ty}function de(a,b){const c=Ba.get();b||(b=c.COLOR_ATTACHMENT0);const d=c.createFramebuffer();return c.bindFramebuffer(c.FRAMEBUFFER,d),c.framebufferTexture2D(c.FRAMEBUFFER,b,c.TEXTURE_2D,a,0),c.bindFramebuffer(c.FRAMEBUFFER,null),d}function je(a){const b=Ba.get();if(!b)return;const{parent:c,flipY:d,unpackPremultiplyAlpha:e,minFilter:f,magFilter:g,wrapS:i,wrapT:h,generateMipmap:k,isPOT:m}=a,o=c.image;let s=c.width,u=c.height;const v=b.createTexture();return b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,v),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,d),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),o?(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,o),s=o.width,u=o.height):b.texImage2D(b.TEXTURE_2D,0,b.RGBA,s,u,0,b.RGBA,b.UNSIGNED_BYTE,null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,g),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,i),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,h),k&&m&&b.generateMipmap(b.TEXTURE_2D),a.texture=v,v}function fc(a){const b=Ba.get();b&&b.isFramebuffer(a)&&b.deleteFramebuffer(a)}function zg(a){const b=Ba.get();if(!b)return;b.isTexture(a)&&b.deleteTexture(a)}function ik(a,b){return a<1||b<1?!1:(a&a-1)===0&&(b&b-1)===0}function vk(a,b=!0){const c=Ba.get();c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,a);const d=b?c.LINEAR:c.NEAREST;c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,d),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,d)}function wk(a){const b=Ba.get(),c=a.parent.image,d=c.width,e=c.height;return d>0&&e>0&&(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,a.texture),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,a.flipY),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,c)),a.texture}class Ic{constructor(a,b={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1;const c=Ba.get();this.parent=a,this.isPOT=ik(a.width,a.height);const{texture:d=null,framebuffer:e=null,unpackPremultiplyAlpha:f=!0,minFilter:g=c.LINEAR,magFilter:i=c.LINEAR,wrapS:h=c.CLAMP_TO_EDGE,wrapT:k=c.CLAMP_TO_EDGE,generateMipmap:m=this.isPOT,flipY:o=!1}=b;this.minFilter=g,this.magFilter=i,this.wrapS=h,this.wrapT=k,this.generateMipmap=m,this.flipY=o,this.unpackPremultiplyAlpha=f,e&&(this.framebuffer=e),d?this.texture=d:je(this)}setFilter(a){this.texture&&vk(this.texture,a)}create(){const a=this.texture;return a&&zg(a),je(this)}update(){const a=this.texture;return a?wk(this):je(this)}setIndex(a){this.dirtyIndex=a!==this.index,this.index=a}destroy(){zg(this.texture),fc(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}}class sk{constructor(a,b,c,d,e){this.batchSize=a,this.dataSize=b,this.indexSize=c,this.vertexElementSize=d,this.quadIndexSize=e,this.vertexByteSize=d*b,this.quadByteSize=this.vertexByteSize*4,this.quadElementSize=d*4,this.bufferByteSize=a*this.quadByteSize,this.create()}create(){let a=[];for(let c=0;c<this.batchSize*this.indexSize;c+=this.indexSize)a.push(c+0,c+1,c+2,c+2,c+3,c+0);this.data=new ArrayBuffer(this.bufferByteSize),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const b=Ba.get();this.vertexBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.data,b.DYNAMIC_DRAW),this.indexBuffer=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.index,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,null),a=[]}destroy(){}}class Ag{constructor(a,b,c,d,e,f){this.trimmed=!1,this.texture=a,this.key=b,this.x=c,this.y=d,this.width=e,this.height=f,this.sourceSizeWidth=e,this.sourceSizeHeight=f,this.updateUVs()}setPivot(a,b){this.pivot={x:a,y:b}}setSize(a,b){this.width=a,this.height=b,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.updateUVs()}setSourceSize(a,b){this.sourceSizeWidth=a,this.sourceSizeHeight=b}setTrim(a,b,c,d,e,f){this.trimmed=!0,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.spriteSourceSizeX=c,this.spriteSourceSizeY=d,this.spriteSourceSizeWidth=e,this.spriteSourceSizeHeight=f}getExtent(a,b){const c=this.sourceSizeWidth,d=this.sourceSizeHeight;let e,f,g,i;return this.trimmed?(e=this.spriteSourceSizeX-a*c,f=e+this.spriteSourceSizeWidth,g=this.spriteSourceSizeY-b*d,i=g+this.spriteSourceSizeHeight):(e=-a*c,f=e+c,g=-b*d,i=g+d),{left:e,right:f,top:g,bottom:i}}setExtent(a){const b=a.transform,c=b.origin.x,d=b.origin.y,e=this.sourceSizeWidth,f=this.sourceSizeHeight;let g,i,h,k;this.trimmed?(g=this.spriteSourceSizeX-c*e,i=this.spriteSourceSizeY-d*f,h=this.spriteSourceSizeWidth,k=this.spriteSourceSizeHeight):(g=-c*e,i=-d*f,h=e,k=f),b.setExtent(g,i,h,k)}updateUVs(){const{x:a,y:b,width:c,height:d}=this,e=this.texture.width,f=this.texture.height;this.u0=a/e,this.v0=b/f,this.u1=(a+c)/e,this.v1=(b+d)/f}}class Oa{constructor(a,b,c){this.key="",a&&(b=a.width,c=a.height),this.image=a,this.width=b,this.height=c,this.frames=new Map(),this.data={},this.addFrame("__BASE",0,0,b,c),Jc.add(this)}addFrame(a,b,c,d,e){if(this.frames.has(a))return null;const f=new Ag(this,a,b,c,d,e);return this.frames.set(a,f),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=f),f}getFrame(a){if(!a)return this.firstFrame;a instanceof Ag&&(a=a.key);let b=this.frames.get(a);return b||(console.warn(`Frame missing: ${a}`),b=this.firstFrame),b}setSize(a,b){this.width=a,this.height=b;const c=this.frames.get("__BASE");c.setSize(a,b)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}}let rk;const id={get:()=>rk,set:a=>{rk=a}};const uk={fragmentShader:`\r
#define SHADER_NAME SINGLE_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture;\r
\r
void main (void)\r
{\r
    vec4 color = texture2D(uTexture, vTextureCoord);\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`,vertexShader:`\r
#define SHADER_NAME SINGLE_QUAD_VERT\r
\r
precision highp float;\r
\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
attribute float aTextureId;\r
attribute vec4 aTintColor;\r
\r
uniform mat4 uProjectionMatrix;\r
uniform mat4 uCameraMatrix;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
void main (void)\r
{\r
    vTextureCoord = aTextureCoord;\r
    vTextureId = aTextureId;\r
    vTintColor = aTintColor;\r
\r
    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\r
}`};class ie{constructor(a={}){this.attribs={aVertexPosition:0,aTextureCoord:0,aTextureId:0,aTintColor:0},this.uniforms={uProjectionMatrix:0,uCameraMatrix:0,uTexture:0,uTime:0,uResolution:0},this.renderToFBO=!1,this.renderer=id.get();const{batchSize:b=4096,dataSize:c=4,indexSize:d=4,vertexElementSize:e=6,quadIndexSize:f=6,fragmentShader:g=uk.fragmentShader,vertexShader:i=uk.vertexShader,width:h=Hb(),height:k=Ib(),resolution:m=Jb(),renderToFBO:o=!1}=a;this.buffer=new sk(b,c,d,e,f),this.createShaders(g,i),this.count=0,this.renderToFBO=o;const s=new Oa(null,h*m,k*m),u=new Ic(s);s.binding=u,u.framebuffer=de(u.texture),this.texture=s,this.framebuffer=u.framebuffer}createShaders(a,b){const c=this.renderer.gl,d=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(d,a),c.compileShader(d);let e=!1,f=c.getShaderInfoLog(d);f.length>0&&(e=!0,console.error(f));const g=c.createShader(c.VERTEX_SHADER);c.shaderSource(g,b),c.compileShader(g),f=c.getShaderInfoLog(d),f.length>0&&(e=!0,console.error(f));if(e)return;const i=c.createProgram();c.attachShader(i,g),c.attachShader(i,d),c.linkProgram(i),c.useProgram(i),this.program=i;for(const h of Object.keys(this.attribs)){const k=c.getAttribLocation(i,h);c.enableVertexAttribArray(k),this.attribs[h]=k}for(const h of Object.keys(this.uniforms))this.uniforms[h]=c.getUniformLocation(i,h)}bind(a,b,c){if(!this.program)return!1;const d=this.renderer,e=d.gl,f=this.uniforms;return e.useProgram(this.program),e.uniformMatrix4fv(f.uProjectionMatrix,!1,a),e.uniformMatrix4fv(f.uCameraMatrix,!1,b),e.uniform1i(f.uTexture,d.textures.textureIndex[c]),e.uniform1f(f.uTime,performance.now()),e.uniform2f(f.uResolution,d.width,d.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}bindBuffers(a,b){const c=this.renderer.gl,d=this.buffer.vertexByteSize,e=this.attribs;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a),c.bindBuffer(c.ARRAY_BUFFER,b),c.vertexAttribPointer(e.aVertexPosition,2,c.FLOAT,!1,d,0),c.vertexAttribPointer(e.aTextureCoord,2,c.FLOAT,!1,d,8),c.vertexAttribPointer(e.aTextureId,1,c.FLOAT,!1,d,16),c.vertexAttribPointer(e.aTintColor,4,c.UNSIGNED_BYTE,!0,d,20),this.count=0}draw(a){const b=this.renderer,c=b.gl,d=this.buffer;if(a===d.batchSize)c.bufferData(c.ARRAY_BUFFER,d.data,c.DYNAMIC_DRAW);else{const e=d.vertexViewF32.subarray(0,a*d.quadElementSize);c.bufferSubData(c.ARRAY_BUFFER,0,e)}this.renderToFBO&&b.fbo.add(this.framebuffer,!0),c.drawElements(c.TRIANGLES,a*d.quadIndexSize,c.UNSIGNED_SHORT,0),this.renderToFBO&&b.fbo.pop()}flush(){const a=this.count;return a===0?!1:(this.draw(a),this.prevCount=a,this.count=0,!0)}}const fq=`\r
#define SHADER_NAME MULTI_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture[%count%];\r
\r
void main (void)\r
{\r
    vec4 color;\r
\r
    %forloop%\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`;class nk extends ie{constructor(a={fragmentShader:fq}){super(a)}createShaders(a,b){const c=ad();let d="";for(let e=1;e<c;e++)e>1&&(d+=`
	else `),e<c-1&&(d+=`if (vTextureId < ${e}.5)`),d+=`
	{`,d+=`
		color = texture2D(uTexture[${e}], vTextureCoord);`,d+=`
	}`;a=a.replace(/%count%/gi,`${c}`),a=a.replace(/%forloop%/gi,d),super.createShaders(a,b)}bind(a,b){if(!this.program)return!1;const c=this.renderer,d=c.gl,e=this.uniforms;return d.useProgram(this.program),d.uniformMatrix4fv(e.uProjectionMatrix,!1,a),d.uniformMatrix4fv(e.uCameraMatrix,!1,b),d.uniform1iv(e.uTexture,c.textures.textureIndex),d.uniform1f(e.uTime,performance.now()),d.uniform2f(e.uResolution,c.width,c.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}}function ok(a,b,c=-1,d=1){const e=-2*(1/-a),f=-2*(1/b),g=2*(1/(c-d));return new Float32Array([e,0,0,0,0,f,0,0,0,0,g,0,-1,1,0,1])}class pk{constructor(a,b){this.renderer=a;const c={shader:new b()};this.stack=[c],this.currentEntry=c,this.current=c.shader,this.singleQuadShader=new ie()}add(a,b){const c={shader:a,textureID:b};return this.stack.push(c),c}set(a,b){this.flush();const c=this.renderer,d=c.projectionMatrix,e=c.currentCamera.matrix,f=a.bind(d,e,b);if(f){const g=this.add(a,b);this.currentEntry=g,this.current=a}return f}setDefault(a){this.set(this.singleQuadShader,a)}pop(){this.flush();const a=this.stack;a.length>1&&a.pop(),this.currentEntry=a[a.length-1],this.current=this.currentEntry.shader}reset(){this.pop(),this.rebind()}flush(){return this.current.flush()?(this.renderer.flushTotal++,!0):!1}rebind(){const a=this.renderer,b=a.projectionMatrix,c=a.currentCamera.matrix,d=this.currentEntry;d.shader.bind(b,c,d.textureID)}popAndRebind(){this.pop(),this.rebind()}clear(){}destroy(){}}const dq=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function eq(a){let b="";for(let c=0;c<a;++c)c>0&&(b+=`
else `),c<a-1&&(b+=`if(test == ${c}.0){}`);return b}function tk(a,b){const c=b.createShader(b.FRAGMENT_SHADER);for(;;){const d=dq.replace(/%forloop%/gi,eq(a));b.shaderSource(c,d),b.compileShader(c);if(!b.getShaderParameter(c,b.COMPILE_STATUS))a=a/2|0;else break}return a}class qk{constructor(a){this.startActiveTexture=0,this.renderer=a,this.tempTextures=[],this.textureIndex=[]}init(){const a=this.renderer.gl;let b=tk(a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),a);const c=ad();c===0||c>0&&c>b?lg(b):c>0&&c<b&&(b=Math.max(8,c));const d=this.tempTextures;d.length&&d.forEach(f=>{a.deleteTexture(f)});const e=[];for(let f=0;f<b;f++){const g=a.createTexture();a.activeTexture(a.TEXTURE0+f),a.bindTexture(a.TEXTURE_2D,g),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),d[f]=g,e.push(f)}this.maxTextures=b,this.textureIndex=e,this.currentActiveTexture=1}update(){const a=Jc.get();for(let b=0;b<a.length;b++){const c=a[b];c.binding||(c.binding=new Ic(c))}Jc.clear()}reset(){const a=this.renderer.gl,b=this.tempTextures;for(let c=0;c<b.length;c++)a.activeTexture(a.TEXTURE0+c),a.bindTexture(a.TEXTURE_2D,b[c]);this.currentActiveTexture=1,this.startActiveTexture++}bind(a,b=0){const c=this.renderer.gl,d=a.binding;d.setIndex(b),c.activeTexture(c.TEXTURE0+b),c.bindTexture(c.TEXTURE_2D,d.texture)}unbind(a=0){const b=this.renderer.gl;b.activeTexture(b.TEXTURE0+a),b.bindTexture(b.TEXTURE_2D,this.tempTextures[a]),a>0&&this.startActiveTexture++}request(a){const b=this.renderer.gl,c=a.binding,d=this.currentActiveTexture;return c.indexCounter>=this.startActiveTexture?!1:(c.indexCounter=this.startActiveTexture,d<this.maxTextures?(c.setIndex(d),b.activeTexture(b.TEXTURE0+d),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture++):(this.renderer.flush(),this.startActiveTexture++,c.indexCounter=this.startActiveTexture,c.setIndex(1),b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture=2),!0)}}class Tj{constructor(){this.clearColor=[0,0,0,1],this.flushTotal=0,this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.currentCamera=null,this.width=Hb(),this.height=Ib(),this.resolution=Jb(),this.setBackgroundColor(Ud());const a=document.createElement("canvas");a.addEventListener("webglcontextlost",b=>this.onContextLost(b),!1),a.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=a,this.fbo=new lk(this),this.textures=new qk(this),this.initContext(),id.set(this),this.shaders=new pk(this,nk)}initContext(){const a=this.canvas.getContext("webgl",ng());Ba.set(a),this.gl=a,a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE),this.resize(this.width,this.height,this.resolution),this.textures.init()}resize(a,b,c=1){this.width=a*c,this.height=b*c,this.resolution=c;const d=this.canvas;d.width=this.width,d.height=this.height,this.autoResize&&(d.style.width=(this.width/c).toString()+"px",d.style.height=(this.height/c).toString()+"px"),this.gl.viewport(0,0,this.width,this.height),this.projectionMatrix=ok(a,b)}onContextLost(a){a.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(a){return mk(a,this.clearColor),this}reset(a=null,b=this.width,c=this.height){const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),d.viewport(0,0,b,c),d.enable(d.BLEND),d.blendFunc(d.ONE,d.ONE_MINUS_SRC_ALPHA),this.flushTotal=0,this.currentCamera=null,this.textures.update()}render(a){if(this.contextLost)return;this.reset();if(this.optimizeRedraw&&a.numDirtyFrames===0&&a.numDirtyCameras===0)return;const b=this.gl;if(this.clearBeforeRender){const d=this.clearColor;b.clearColor(d[0],d[1],d[2],d[3]),b.clear(b.COLOR_BUFFER_BIT)}const c=a.worldData;for(let d=0;d<c.length;d++){const{camera:e,renderList:f}=c[d];(!this.currentCamera||!hk(e.worldTransform,this.currentCamera.worldTransform))&&(this.flush(),this.currentCamera=e,this.shaders.rebind()),f.forEach(g=>{g.children.length?this.renderNode(g):g.node.renderGL(this)})}this.flush()}renderNode(a){a.node.renderGL(this),a.children.forEach(b=>{b.children.length>0?this.renderNode(b):b.node.renderGL(this)}),a.node.postRenderGL(this)}flush(){this.shaders.flush()}destroy(){id.set(void 0)}}function bg(){return()=>{Vd(Tj)}}function Aa(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);for(const e of d)e.callback.apply(e.context,c),e.once&&d.delete(e);return d.size===0&&a.events.delete(b),!0}function Bj(a,b){const c=Wd(b);return c.appendChild(a),a}function Cj(a){const b=document.readyState;if(b==="complete"||b==="interactive"){a();return}const c=()=>{document.removeEventListener("deviceready",c,!0),document.removeEventListener("DOMContentLoaded",c,!0),window.removeEventListener("load",c,!0),a()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",c,!0):(document.addEventListener("DOMContentLoaded",c,!0),window.addEventListener("load",c,!0)):window.setTimeout(c,20)}class hg{constructor(){this.events=new Map()}}class dd{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function Ra(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new dd(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function dc(a,b,c,d=a){return Ra(a,b,c,d,!0)}function xk(){return{gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]}}function Ak(a,b=0){a.gameFrame=b,a.numTotalFrames=0,a.numDirtyFrames=0,a.numDirtyCameras=0,a.worldData.length=0}let Bk;const ke={get:()=>Bk,set:a=>{Bk=a}};class Dj{constructor(){this.scenes=new Map(),this.sceneIndex=0,this.flush=!1,this.renderResult=xk(),this.game=wa.get(),ke.set(this),dc(this.game,"boot",()=>this.boot())}boot(){mg().forEach(a=>new a())}update(a,b){for(const c of this.scenes.values())Aa(c,"update",a,b)}render(a){const b=this.renderResult;Ak(b,a);for(const c of this.scenes.values())Aa(c,"render",b);return this.flush&&(b.numDirtyFrames++,this.flush=!1),b}}function jd(a,b){const c=document.createElement("canvas");return c.width=a,c.height=b,c.getContext("2d")}let Ck;const Fa={get:()=>Ck,set:a=>{Ck=a}};class Ej{constructor(){this.textures=new Map(),this.createDefaultTextures(),Fa.set(this)}createDefaultTextures(){this.add("__BLANK",new Oa(jd(32,32).canvas));const a=jd(32,32);a.strokeStyle="#0f0",a.moveTo(0,0),a.lineTo(32,32),a.stroke(),a.strokeRect(.5,.5,31,31),this.add("__MISSING",new Oa(a.canvas))}get(a){const b=this.textures;return b.has(a)?b.get(a):b.get("__MISSING")}has(a){return this.textures.has(a)}add(a,b){let c;const d=this.textures;return d.has(a)||(b instanceof Oa?c=b:c=new Oa(b),c.key=a,d.set(a,c)),c}}class tj extends hg{constructor(...a){super();this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,wa.set(this),Cj(()=>this.boot(a))}boot(a){a.forEach(d=>d());const b=fg();this.renderer=new b(),this.textureManager=new Ej(),this.sceneManager=new Dj();const c=gg();c&&Bj(this.renderer.canvas,c),this.isBooted=!0,eg(),Aa(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(a){const b=a-this.lastTick;this.lastTick=a,this.elapsed+=b,this.isPaused||(this.willUpdate&&(this.sceneManager.update(b,a),Aa(this,"update",b,a)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,wa.setFrame(this.frame),wa.setElapsed(this.elapsed),requestAnimationFrame(c=>this.step(c))}destroy(){}}function yk(a,b,c){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:c}function zk(a,b={}){const c=ke.get(),d=c.scenes.size,e=c.sceneIndex,f=d===0;typeof b==="string"?a.key=b:(b||!b&&f)&&(a.key=yk(b,"key","scene"+e.toString())),c.scenes.has(a.key)?console.warn("Scene key already in use: "+a.key):(c.scenes.set(a.key,a),c.flush=!0,c.sceneIndex++)}class Td{constructor(a){this.game=wa.get(),this.events=new Map(),zk(this,a)}}class $b{constructor(a=1,b=0,c=0,d=1,e=0,f=0){this.set(a,b,c,d,e,f)}set(a=1,b=0,c=0,d=1,e=0,f=0){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=e,this.ty=f,this}identity(){return this.set()}toArray(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]}fromArray(a){return this.set(a[0],a[1],a[2],a[3],a[4],a[5])}}function fe(a,b,c){return a.width<=0||a.height<=0?!1:a.x<=b&&a.x+a.width>=b&&a.y<=c&&a.y+a.height>=c}class Na{constructor(a=0,b=0,c=0,d=0){this.set(a,b,c,d)}set(a=0,b=0,c=0,d=0){return this.x=a,this.y=b,this.width=c,this.height=d,this}contains(a,b){return fe(this,a,b)}set right(a){a<=this.x?this.width=0:this.width=a-this.x}get right(){return this.x+this.width}set bottom(a){a<=this.y?this.height=0:this.height=a-this.y}get bottom(){return this.y+this.height}}function jk(){}class yb{constructor(a,b=0,c=0,d=!1){this.compareValue=!1,this._x=b,this._y=c,this.callback=a,this.compareValue=d}set(a=0,b=0){return this._x=a,this._y=b,this.callback(this),this}destroy(){this.callback=jk}set x(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._x=a,this.callback(this))}get x(){return this._x}set y(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._y=a,this.callback(this))}get y(){return this._y}}function gk(a,b,c){const d=c-b;return b+((a-b)%d+d)%d}function Ij(a){return gk(a,-Math.PI,Math.PI)}class Jj{constructor(){this._rotation=0,this.type="Camera",this.dirtyRender=!0;const a=wa.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1]),this.bounds=new Na(),this.worldTransform=new $b(),this.position=new yb(()=>this.updateTransform(),0,0),this.scale=new yb(()=>this.updateTransform(),1,1),this.origin=new yb(()=>this.updateTransform(),.5,.5),this.reset()}updateTransform(){const a=this.matrix,b=this.position.x,c=this.position.y,d=this.scale.x,e=this.scale.y,f=-b+this.width*this.origin.x,g=-c+this.height*this.origin.y,i=Math.sin(this.rotation),h=Math.cos(this.rotation),k=i+i,m=i*k,o=h*k,s=(1-m)*d,u=o*d,v=-o*e,y=(1-m)*e;a[0]=s,a[1]=u,a[4]=v,a[5]=y,a[12]=b+f-(s*f+v*g),a[13]=c+g-(u*f+y*g),this.worldTransform.set(h*d,i*d,-i*e,h*e,-b,-c);const D=this.width*(1/d),J=this.height*(1/e);this.bounds.set(f-D/2,g-J/2,D,J),this.dirtyRender=!0}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}set rotation(a){a!==this._rotation&&(this._rotation=Ij(a),this.updateTransform())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.origin.destroy(),this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}class Kj{constructor(){this.type="StaticCamera",this.dirtyRender=!0;const a=wa.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.bounds=new Na(),this.worldTransform=new $b(),this.reset()}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}function bc(a){const b=[a],c=[];for(;b.length>0;){const d=b.shift();c.push(d);const e=d.numChildren;if(e>0)for(let f=e-1;f>=0;f--)b.unshift(d.children[f])}return c.shift(),c}function zb(a,b){return a.children.indexOf(b)}function Xd(a,b){const c=a.children;let d;if(b>=0&&b<c.length){const e=c.splice(b,1);e[0]&&(d=e[0],d.parent=null)}return d}function cc(a,b){const c=zb(a,b);return c>-1&&Xd(a,c),b}const sg="addedtoworld";const Yd="destroy";const Uj="postupdate";const tg="removedfromworld";const Vj="update";function rg(a,...b){return b.forEach(c=>{c.world&&(Aa(c.world,tg,c,c.world),Aa(c,tg,c,c.world)),c.world=a,Aa(a,sg,c,a),Aa(c,sg,c,a)}),b}function ac(a,...b){b.forEach(d=>{d.parent&&cc(d.parent,d),d.parent=a});const c=a.world;return c&&rg(c,...bc(a)),b}const _={CLEAR:0,TRANSFORM:1,UPDATE:2,CHILD_CACHE:4,POST_RENDER:8,COLORS:16,BOUNDS:32,TEXTURE:64,FRAME:128,ALPHA:256,CHILD:512,DEFAULT:1+2+16+32,USER1:536870912,USER2:1073741824,USER3:2147483648,USER4:4294967296};function bd(a,b=0,c){const d=a.children;c===void 0&&(c=d.length);const e=c-b;if(e>0&&e<=c){const f=d.splice(b,e);return f.forEach(g=>{g.parent=null}),f}else return[]}function pg(a,b=0,c){const d=bd(a,b,c);d.forEach(e=>{e.destroy()})}function cd(a,...b){return b.forEach(c=>{cc(a,c)}),b}function qg(a,b,c=0,d){const e=bd(a,c,d);return ac(b,...e),e.forEach(f=>{f.transform.updateWorld()}),e}function Ab(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof dd)g.delete(c);else{const i=!d,h=e!==void 0;for(const k of g)k.callback===c&&(i&&k.context===d)&&(h&&k.once===e)&&g.delete(k)}return g.size===0&&f.delete(b),a}function Hc(a){const{a:b,b:c,c:d,d:e,tx:f,ty:g}=a.world,{x:i,y:h,right:k,bottom:m}=a.extent,o=i*b+h*d+f,s=i*c+h*e+g,u=i*b+m*d+f,v=i*c+m*e+g,y=k*b+m*d+f,D=k*c+m*e+g,J=k*b+h*d+f,I=k*c+h*e+g;return{x0:o,y0:s,x1:u,y1:v,x2:y,y2:D,x3:J,y3:I}}class Zd{constructor(a){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=a,this.area=new Na()}set(a,b,c,d){this.area.set(a,b,c,d)}get(){return this.entity.isDirty(_.BOUNDS)&&!this.fixed&&this.update(),this.area}updateLocal(){const{x0:a,y0:b,x1:c,y1:d,x2:e,y2:f,x3:g,y3:i}=Hc(this.entity.transform),h=Math.min(a,c,e,g),k=Math.min(b,d,f,i),m=Math.max(a,c,e,g),o=Math.max(b,d,f,i);return this.area.set(h,k,m-h,o-k)}update(){const a=this.updateLocal();this.entity.clearDirty(_.BOUNDS);if(!this.includeChildren||!this.entity.numChildren)return a;const b=this.visibleOnly,c=this.entity.children;let d=a.x,e=a.y,f=a.right,g=a.bottom;for(let i=0;i<c.length;i++){const h=c[i];if(!h||b&&!h.visible)continue;const k=h.bounds.get();k.x<d&&(d=k.x),k.y<e&&(e=k.y),k.right>f&&(f=k.right),k.bottom>g&&(g=k.bottom)}return a.set(d,e,f-d,g-e)}destroy(){this.entity=null,this.area=null}}class _d{constructor(a){this.enabled=!1,this.enabledChildren=!0,this.entity=a}destroy(){this.entity=null,this.hitArea=null}}class kb{constructor(a=0,b=0){this.set(a,b)}set(a=0,b=0){return this.x=a,this.y=b,this}getArray(){return[this.x,this.y]}fromArray(a){return this.set(a[0],a[1])}toString(){return`[x=${this.x}, y=${this.y}]`}}function ae(a){const b=a.local,c=a.position.x,d=a.position.y,e=a.rotation,f=a.scale.x,g=a.scale.y,i=a.skew.x,h=a.skew.y;b.set(Math.cos(e+h)*f,Math.sin(e+h)*f,-Math.sin(e-i)*g,Math.cos(e-i)*g,c,d)}function vg(a,b){return b.set(a.a,a.b,a.c,a.d,a.tx,a.ty)}function be(a){const b=a.parent,c=a.transform,d=c.local,e=c.world;if(!b)vg(d,e);else if(c.passthru)vg(b.transform.world,e);else{const{a:f,b:g,c:i,d:h,tx:k,ty:m}=d,{a:o,b:s,c:u,d:v,tx:y,ty:D}=b.transform.world;e.set(f*o+g*u,f*s+g*v,i*o+h*u,i*s+h*v,k*o+m*u+y,k*s+m*v+D)}}class $d{constructor(a,b=0,c=0){this.passthru=!1,this._rotation=0,this.entity=a,this.local=new $b(),this.world=new $b(),this.position=new yb(()=>this.update(),b,c),this.scale=new yb(()=>this.update(),1,1,!0),this.skew=new yb(()=>this.update(),0,0,!0),this.origin=new yb(()=>this.updateExtent(),jg,kg),this.extent=new Na()}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(_.TRANSFORM,_.BOUNDS),ae(this)}updateWorld(){const a=this.entity;a.setDirty(_.TRANSFORM,_.BOUNDS),be(a),a.numChildren&&this.updateChildren()}updateChildren(){const a=this.entity.children;for(let b=0;b<a.length;b++){const c=a[b];c.transform.updateWorld()}}globalToLocal(a,b,c=new kb()){const{a:d,b:e,c:f,d:g,tx:i,ty:h}=this.world,k=1/(d*g+f*-e);return c.x=g*k*a+-f*k*b+(h*f-i*g)*k,c.y=d*k*b+-e*k*a+(-h*d+i*e)*k,c}localToGlobal(a,b,c=new kb()){const{a:d,b:e,c:f,d:g,tx:i,ty:h}=this.world;return c.x=d*a+f*b+i,c.y=e*a+g*b+h,c}setExtent(a,b,c,d){this.extent.set(a,b,c,d),this.entity.setDirty(_.TRANSFORM,_.BOUNDS)}updateExtent(a,b){const c=this.extent,d=this.entity;a!==void 0&&(c.width=a),b!==void 0&&(c.height=b),c.x=-this.origin.x*c.width,c.y=-this.origin.y*c.height,d.setDirty(_.TRANSFORM,_.BOUNDS)}set rotation(a){a!==this._rotation&&(this._rotation=a,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}}class jb{constructor(a=0,b=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.events=new Map(),this.transform=new $d(this,a,b),this.bounds=new Zd(this),this.input=new _d(this),this.dirty=_.DEFAULT,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(a){return(this.dirty&a)!==0}clearDirty(a){return this.isDirty(a)&&(this.dirty^=a),this}setDirty(a,b){return this.isDirty(a)||(this.dirty^=a,this.dirtyFrame=wa.getFrame()),this.isDirty(b)||(this.dirty^=b),this}update(a,b){if(this.willUpdateChildren){const c=this.children;for(let d=0;d<c.length;d++){const e=c[d];e&&e.willUpdate&&e.update(a,b)}}this.postUpdate(a,b)}postUpdate(a,b){}renderGL(a){}renderCanvas(a){}postRenderGL(a){}postRenderCanvas(a){}get numChildren(){return this.children.length}destroy(a){a?qg(this,a):pg(this),Aa(this,Yd,this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}}const ge="worldrender";const he="worldshutdown";var cq=Object.freeze({__proto__:null,WorldRenderEvent:ge,WorldShutdownEvent:he});function le(a,b){b.numRendered++,b.numRenderable++,a.node.dirtyFrame>=b.gameFrame&&b.dirtyFrame++,a.children.forEach(c=>{c.children.length>0&&le(c,b)})}function Eg(a){if(a.node.isDirty(_.CHILD_CACHE))return!0;const b=[a];for(;b.length>0;){const c=b.pop();if(c.node.isDirty(_.TRANSFORM))return!0;const d=c.children.length;if(d>0)for(let e=0;e<d;e++)b.push(c.children[e])}return b.length=0,!1}function Dg(a,b){a.forEach(c=>{b||Eg(c)?c.node.setDirty(_.CHILD_CACHE):c.children.length=0})}function me(a,b,c=[]){for(let d=0;d<b.numChildren;d++){const e=b.children[d];if(e.isRenderable()){const f=[],g={node:e,children:f};c.push(g),e.willRenderChildren&&e.numChildren>0&&(e.willCacheChildren&&a.push(g),me(a,e,f))}}return c}function Bg(a){const b=[],c=[],d=me(b,a,c),e=a.renderData;b.length>0&&Dg(b,a.camera.dirtyRender),d.forEach(f=>{f.children.length?le(f,e):(e.numRendered++,e.numRenderable++,f.node.dirtyFrame>=e.gameFrame&&e.dirtyFrame++)}),e.renderList=d,a.forceRefresh&&(e.dirtyFrame++,a.forceRefresh=!1)}function Cg(a,b){a.numDirtyFrames+=b.dirtyFrame,a.numTotalFrames+=b.numRendered,b.camera.dirtyRender&&a.numDirtyCameras++,a.worldData.push(b)}function kd(a,b){a.gameFrame=b,a.dirtyFrame=0,a.numRendered=0,a.numRenderable=0,a.renderList.length=0}class hc extends jb{constructor(a){super();this.forceRefresh=!1,this.type="BaseWorld",this.scene=a,this.world=this,this.events=new Map(),this._updateListener=Ra(a,"update",(b,c)=>this.update(b,c)),this._renderListener=Ra(a,"render",b=>this.render(b)),this._shutdownListener=Ra(a,"shutdown",()=>this.shutdown()),dc(a,"destroy",()=>this.destroy())}update(a,b){if(!this.willUpdate)return;Aa(this,Vj,a,b,this),super.update(a,b)}postUpdate(a,b){Aa(this,Uj,a,b,this)}render(a){const b=this.renderData;kd(b,a.gameFrame);if(!this.willRender||!this.visible)return;Bg(this),Aa(this,ge,b,this),Cg(a,b),this.camera&&(this.camera.dirtyRender=!1)}shutdown(){const a=this.scene;Ab(a,"update",this._updateListener),Ab(a,"render",this._renderListener),Ab(a,"shutdown",this._shutdownListener),cd(this),Aa(this,he,this),kd(this.renderData,0),this.camera&&this.camera.reset()}destroy(a){super.destroy(a),Aa(this,Yd,this),kd(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}}function ld(a){return{camera:a,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0,renderList:[]}}class cg extends hc{constructor(a){super(a);this.type="StaticWorld",this.camera=new Kj(),this.renderData=ld(this.camera)}}class gq extends hc{constructor(a){super(a);this.enableCameraCull=!0,this.type="World",this.camera=new Jj(),this.renderData=ld(this.camera)}}function _b(a,b){return a.children.push(b),ac(a,b),b.transform.updateWorld(),b}function og(a,...b){return b.forEach(c=>{_b(a,c)}),b}class dk{constructor(a,b,c){this.responseType="text",this.crossOrigin=void 0,this.skipCache=!1,this.hasLoaded=!1,this.key=a,this.url=b,this.config=c}}function ek(a,b,c,d){return b||(b=a+c),/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/.exec(b)?b:d?d.baseURL+d.path+b:b}function fk(a){return a.data=new Image(),a.crossOrigin&&(a.data.crossOrigin=a.crossOrigin),new Promise((b,c)=>{a.data.onload=()=>{a.data.onload&&(a.data.onload=null,a.data.onerror=null,b(a))},a.data.onerror=d=>{a.data.onload&&(a.data.onload=null,a.data.onerror=null,a.error=d,c(a))},a.data.src=a.url,a.data.complete&&a.data.width&&a.data.height&&(a.data.onload=null,a.data.onerror=null,b(a))})}function uj(a,b){const c=new dk(a,b);return c.load=()=>(c.url=ek(c.key,c.url,".png",c.loader),c.loader&&(c.crossOrigin=c.loader.crossOrigin),new Promise((d,e)=>{const f=Fa.get();f.has(c.key)?d(c):fk(c).then(g=>{f.add(g.key,g.data),d(g)}).catch(g=>{e(g)})})),c}var ij;(function(a){a[a.IDLE=0]="IDLE",a[a.UPDATING=1]="UPDATING"})(ij||(ij={}));function Kb(a=32,b=32){const c=jd(a,b);return new Oa(c.canvas)}function Xj(a,b){const c=a.texture,d=b.shaders.current,e=d.buffer,f=c.binding;d.count===e.batchSize&&b.flush();const g=a.vertexData;b.textures.request(c);const i=f.index;g[4]=i,g[10]=i,g[16]=i,g[22]=i;const h=d.count*e.quadElementSize;e.vertexViewF32.set(g,h);const k=a.vertexColor,m=e.vertexViewU32;m[h+5]=k[0],m[h+11]=k[2],m[h+17]=k[3],m[h+23]=k[1],d.count++}class ec extends jb{constructor(a=0,b=0){super(a,b);this._alpha=1,this.type="Container"}setSize(a,b=a){return this.transform.updateExtent(a,b),this}setPosition(a,b){return this.transform.position.set(a,b),this}setOrigin(a,b=a){return this.transform.origin.set(a,b),this}setSkew(a,b=a){return this.transform.skew.set(a,b),this}setScale(a,b=a){return this.transform.scale.set(a,b),this}setRotation(a){return this.transform.rotation=a,this}set width(a){this.transform.updateExtent(a)}get width(){return this.transform.extent.width}set height(a){this.transform.updateExtent(void 0,a)}get height(){return this.transform.extent.height}set x(a){this.transform.position.x=a}get x(){return this.transform.position.x}set y(a){this.transform.position.y=a}get y(){return this.transform.position.y}set originX(a){this.transform.origin.x=a}get originX(){return this.transform.origin.x}set originY(a){this.transform.origin.y=a}get originY(){return this.transform.origin.y}set skewX(a){this.transform.skew.x=a}get skewX(){return this.transform.skew.x}set skewY(a){this.transform.skew.y=a}get skewY(){return this.transform.skew.y}set scaleX(a){this.transform.scale.x=a}get scaleX(){return this.transform.scale.x}set scaleY(a){this.transform.scale.y=a}get scaleY(){return this.transform.scale.y}set rotation(a){this.transform.rotation=a}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(a){a!==this._alpha&&(this._alpha=a,this.setDirty(_.TRANSFORM))}}function Yj(a,b){const c=a.frame;if(!c)return;const d=b.ctx,e=a.transform,{a:f,b:g,c:i,d:h,tx:k,ty:m}=e.world,{x:o,y:s}=e.extent;d.save(),d.setTransform(f,g,i,h,k,m),d.globalAlpha=a.alpha,d.drawImage(c.texture.image,c.x,c.y,c.width,c.height,o,s,c.width,c.height),d.restore()}function gc(a,b){const c=(b*255|0)&255;return(c<<24|a)>>>0}function Zj(a){const b=a.vertexAlpha,c=a.vertexTint,d=a.vertexColor;return d[0]=gc(c[0],b[0]),d[1]=gc(c[1],b[1]),d[2]=gc(c[2],b[2]),d[3]=gc(c[3],b[3]),a}function ee(a,b,...c){const d=a.getFrame(b),{u0:e,u1:f,v0:g,v1:i,pivot:h}=d;return c.forEach(k=>{if(!k||d===k.frame)return;k.frame=d,h&&k.setOrigin(h.x,h.y),k.frame.setExtent(k),k.hasTexture=!0;const m=k.vertexData;m[2]=e,m[3]=g,m[8]=e,m[9]=i,m[14]=f,m[15]=i,m[20]=f,m[21]=g}),c}function Wj(a,b,...c){if(!a)c.forEach(d=>{d.texture=null,d.frame=null,d.hasTexture=!1});else{let d;a instanceof Oa?d=a:d=Fa.get().get(a),d?(c.forEach(e=>{e.texture=d}),ee(d,b,...c)):console.warn(`Invalid Texture key: ${a}`)}return c}function _j(a){const b=a.vertexData,{x0:c,y0:d,x1:e,y1:f,x2:g,y2:i,x3:h,y3:k}=Hc(a.transform);return b[0]=c,b[1]=d,b[6]=e,b[7]=f,b[12]=g,b[13]=i,b[18]=h,b[19]=k,a}class Bb extends ec{constructor(a,b,c,d){super(a,b);this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertexData=new Float32Array(24).fill(0),this.vertexColor=new Uint32Array(4).fill(4294967295),this.vertexAlpha=new Float32Array(4).fill(1),this.vertexTint=new Uint32Array(4).fill(16777215),this.setTexture(c,d)}setTexture(a,b){return Wj(a,b,this),this}setFrame(a){return ee(this.texture,a,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}preRender(){this.isDirty(_.COLORS)&&(Zj(this),this.clearDirty(_.COLORS)),this.isDirty(_.TRANSFORM)&&(_j(this),this.clearDirty(_.TRANSFORM))}renderGL(a){this.preRender(),Xj(this,a)}renderCanvas(a){this.preRender(),Yj(this,a)}get alpha(){return this._alpha}set alpha(a){if(a!==this._alpha){this._alpha=a;const b=this.vertexAlpha;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(_.ALPHA)}}get tint(){return this._tint}set tint(a){if(a!==this._tint){this._tint=a;const b=this.vertexTint;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(_.COLORS)}}destroy(a){super.destroy(a),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertexData=null,this.vertexColor=null,this.vertexAlpha=null,this.vertexTint=null}}function pf(a,b,c){const d=Math.ceil(b*a.resolution),e=Math.ceil(c*a.resolution),f=a.canvas;if(f.width===d&&f.height===e){qf(a);return}f.width=d,f.height=e,a.texture.setSize(b,c),a.setSize(b,c),a.updateTexture()}function qf(a){a.context.clearRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function ri(a,b="#fff"){let c=a.context;c.fillStyle=b,c.fillRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function rf(a,b,c){const d=new Image();d.onload=function(){const e=a.resolution,f=d.width/e,g=d.height/e;pf(a,f,g),a.context.drawImage(d,0,0),a.updateTexture(),c&&c(),d.onload=null,d.src="",d.remove()},d.src=b}function si(a,b){return new Promise(function(c,d){rf(a,b,c)})}function ti(a,b,c){return a.canvas.toDataURL(b,c)}function ui(a,b,c,d=[0,0,0,0]){const e=a.context.getImageData(b,c,1,1).data;return d[0]=e[0],d[1]=e[1],d[2]=e[2],d[3]=e[3],d}function vi(a,b,c,d,e,f,g){g===void 0&&(g=d!==0||e!==0||f!==0?255:0);const i=a.context.createImageData(1,1);i.data[0]=d,i.data[1]=e,i.data[2]=f,i.data[3]=g,a.context.putImageData(i,b,c),a.updateTexture()}class qb extends Bb{constructor(a=0,b=0,c=32,d=32){super(a,b,Kb());this.type="rexCanvas";const e=wa.get();this.resolution=e.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.resize(c,d)}updateTexture(){return this.texture.binding&&this.texture.binding.update(),this.setDirty(_.TEXTURE),this}destroy(a){this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}resize(a,b){return pf(this,a,b),this}clear(){return qf(this),this}}function Wb(a,b,c,d=1){let e;if(typeof a==="string"){let i=Fa.get();i.has(a)||i.add(a,Kb()),e=i.get(a)}else e=a;let f=e.image,g=f.getContext("2d");return c?b.call(c,f,g):b(f,g),e.setSize(f.width/d,f.height/d),e.binding&&e.binding.update(),e}function fb(a,b,c){switch(typeof a){case"number":return`#${a.toString(16)}`;case"function":return a(b,c);default:return a}}function Ai(a,b,c,d,e,f,g,i,h,k,m=!0){b.beginPath(),b.rect(c,d,e,f);if(g){if(k){let o;m?o=b.createLinearGradient(0,0,e,0):o=b.createLinearGradient(0,0,0,f),o.addColorStop(0,g),o.addColorStop(1,k),g=o}b.fillStyle=g,b.fill()}i&&(b.strokeStyle=i,b.lineWidth=h,b.stroke())}class yp{constructor(a=0,b=a,c=0,d=c,e=0){this._width=0;this._height=0;this.cornerRadius={tl:ib(0),tr:ib(0),bl:ib(0),br:ib(0)};this.setTo(a,b,c,d,e)}setTo(a=0,b=a,c=0,d=c,e=0){return this.setPosition(a,b),this.setRadius(e),this.setSize(c,d),this}setPosition(a=0,b=a){return this.x=a,this.y=b,this}setRadius(a=0){let b=this.cornerRadius;if(typeof a==="number"){const c=a,d=a;b.tl=ib(void 0,c,d),b.tr=ib(void 0,c,d),b.bl=ib(void 0,c,d),b.br=ib(void 0,c,d)}else{const c=a.x??0,d=a.y??0;b.tl=ib(a.tl,c,d),b.tr=ib(a.tr,c,d),b.bl=ib(a.bl,c,d),b.br=ib(a.br,c,d)}return this}setSize(a=0,b=a){return this.width=a,this.height=b,this}get minWidth(){let a=this.cornerRadius;return Math.max(a.tl.x+a.tr.x,a.bl.x+a.br.x)}get minHeight(){let a=this.cornerRadius;return Math.max(a.tl.y+a.bl.y,a.tr.y+a.br.y)}get width(){return this._width}set width(a){a==null&&(a=0),this._width=Math.max(a,this.minWidth)}get height(){return this._height}set height(a){a==null&&(a=0),this._height=Math.max(a,this.minHeight)}get radius(){let a=this.cornerRadius,b=Math.max(a.tl.x,a.tl.y,a.tr.x,a.tr.y,a.bl.x,a.bl.y,a.br.x,a.br.y);return b}}function ib(a,b,c){return a===void 0?{x:b,y:c}:typeof a==="number"?{x:a,y:a}:a}const zs=Math.PI/180;function Ob(a){return a*zs}const zp=Ob(0),Ap=Ob(90),Bp=Ob(180),Cp=Ob(270);function wf(a,b,c,d,e,f){const g=new yp(b,c,d,e,f),i=g.minWidth,h=g.minHeight,k=d>=i?1:d/i,m=e>=h?1:e/h,o=g.cornerRadius;let s,u,v,y,D;a.beginPath(),a.translate(b,c),s=o.br,u=s.x*k,v=s.y*m,y=g.width-u,D=g.height-v,Uf(s)&&u>=0&&v>=0?a.ellipse(y,D,u,v,0,zp,Ap):(a.moveTo(g.width,D),a.lineTo(g.width,g.height),a.lineTo(y,g.height)),s=o.bl,u=s.x*k,v=s.y*m,y=u,D=g.height-v,a.lineTo(u,g.height),Uf(s)&&u>=0&&v>=0?a.ellipse(y,D,u,v,0,Ap,Bp):(a.lineTo(0,g.height),a.lineTo(0,D)),s=o.tl,u=s.x*k,v=s.y*m,y=u,D=v,a.lineTo(0,D),Uf(s)&&u>=0&&v>=0?a.ellipse(y,D,u,v,0,Bp,Cp):(a.lineTo(0,0),a.lineTo(y,0)),s=o.tr,u=s.x*k,v=s.y*m,y=g.width-u,D=v,a.lineTo(y,0),Uf(s)&&u>=0&&v>=0?a.ellipse(y,D,u,v,0,Cp,zp):(a.lineTo(g.width,0),a.lineTo(g.width,D)),a.closePath()}function Uf(a){return a.x!==0&&a.y!==0}function Ed(a,b,c,d,e,f,g,i,h,k,m,o=!0){wf(b,c,d,e,f,g);if(i){if(m){let s;o?s=b.createLinearGradient(0,0,e,0):s=b.createLinearGradient(0,0,0,f),s.addColorStop(0,i),s.addColorStop(1,m),i=s}b.fillStyle=i,b.fill()}h&&(b.strokeStyle=h,b.lineWidth=k,b.stroke())}var sp;(function(a){a[a.right=0]="right",a[a.down=1]="down",a[a.left=2]="left",a[a.up=3]="up"})(sp||(sp={}));function vn(a,b){b.width!==a.width&&(b.width=a.width),b.height!==a.height&&(b.height=a.height);let c=b.getContext("2d");return c.drawImage(a.texture.image,a.x,a.y,a.width,a.height),b}function wi(a,b,c=0,d=0,e=a.width,f=a.height){const g=a.resolution,i=a.canvas,h=Math.ceil(e*g),k=Math.ceil(f*g);Wb(b,function(m,o){m.width!==h&&(m.width=h),m.height!==k&&(m.height=k),o.clearRect(0,0,h,k),o.drawImage(i,c,d,h,k)},void 0,a.resolution)}function xi(a,b,c){const d=Fa.get();if(!d.has(b))return;vn(d.get(b).getFrame(c),a.canvas);const e=a.canvas.width,f=a.canvas.height,g=a.resolution,i=e/g,h=f/g;a.texture.setSize(i,h),a.setSize(i,h),a.updateTexture()}class yi extends qb{fill(a="#fff"){return ri(this,a),this}getCanvas(){return this.canvas}getContext(){return this.context}getDataURL(a,b){return ti(this,a,b)}getPixel(a,b,c=[0,0,0,0]){return ui(this,a,b,c)}generateTexture(a,b=0,c=0,d=this.width,e=this.height){return wi(this,a,b,c,d,e),this}loadFromURL(a,b){return rf(this,a,b),this}loadFromURLPromise(a){return si(this,a)}loadTexture(a,b){return xi(this,a,b),this}setPixel(a,b,c,d,e,f){return vi(this,a,b,c,d,e,f),this}}var Xb;(function(a){a[a.circle=0]="circle",a[a.ellipse=1]="ellipse",a[a.roundRectangle=2]="roundRectangle"})(Xb||(Xb={}));class sf extends qb{constructor(a,b,c,d,e=Xb.circle){super(a,b);this.type="rexMaskedImage",this.maskImage(c,d,e)}maskImage(a,b,c=Xb.circle){let d,e,f;typeof c==="object"?{maskType:d,backgroundStyle:e,radius:f}=c:d=c,typeof d==="string"&&(d=Xb[d]);const g=this.canvas,i=this.context,h=Fa.get();if(!h.has(a))return;const k=h.get(a).getFrame(b),m=k.width,o=k.height;g.width!==m&&(g.width=m),g.height!==o&&(g.height=o),i.clearRect(0,0,m,o),e&&(i.fillStyle=e,i.fillRect(0,0,m,o)),i.beginPath();switch(d){case Xb.roundRectangle:wf(i,0,0,m,o,f);break;default:const s=Math.floor(m/2),u=Math.floor(o/2);d===Xb.circle?i.arc(s,u,Math.min(s,u),0,2*Math.PI):i.ellipse(s,u,s,u,0,0,2*Math.PI);break}i.clip(),i.drawImage(k.texture.image,k.x,k.y,k.width,k.height),this.texture.setSize(m,o),this.setSize(m,o),this.updateTexture()}}class tf extends qb{constructor({x:a=0,y:b=0,width:c=1,height:d=1,fillStyle:e,fillColor2:f,isHorizontalGradient:g=!0,strokeStyle:i,lineWidth:h=2}={}){super(a,b);this.type="rexCanvasRoundRectangle",this.setFillStyle(e,f,g),this.setStrokeStyle(i,h),this.resize(c,d)}setFillStyle(a,b,c=!0){return this.fillStyle=a,this.fillColor2=b,this.isHorizontalGradient=c,this}setStrokeStyle(a,b){return this.strokeStyle=a,this.lineWidth=b,this}resize(a,b){return super.resize(a,b),this.refresh(),this}refresh(){let a=this.lineWidth;this.strokeStyle||(a=0);const b=a/2,c=b,d=b,e=this.width-a,f=this.height-a;return Ai(this.canvas,this.context,c,d,e,f,fb(this.fillStyle,this.canvas,this.context),fb(this.strokeStyle,this.canvas,this.context),a,fb(this.fillColor2,this.canvas,this.context),this.isHorizontalGradient),this}}class uf extends qb{constructor({x:a=0,y:b=0,width:c=1,height:d=1,radius:e=0,fillStyle:f,fillColor2:g,isHorizontalGradient:i=!0,strokeStyle:h,lineWidth:k=2}={}){super(a,b);this.type="rexCanvasRoundRectangle",this.setRadius(e),this.setFillStyle(f,g,i),this.setStrokeStyle(h,k),this.resize(c,d)}setRadius(a){return this.radius=a,this}setFillStyle(a,b,c=!0){return this.fillStyle=a,this.fillColor2=b,this.isHorizontalGradient=c,this}setStrokeStyle(a,b){return this.strokeStyle=a,this.lineWidth=b,this}resize(a,b){return super.resize(a,b),this.refresh(),this}refresh(){let a=this.lineWidth;this.strokeStyle||(a=0);const b=a/2,c=b,d=b,e=this.width-a,f=this.height-a;return Ed(this.canvas,this.context,c,d,e,f,this.radius,fb(this.fillStyle,this.canvas,this.context),fb(this.strokeStyle,this.canvas,this.context),a,fb(this.fillColor2,this.canvas,this.context),this.isHorizontalGradient),this}}var Yp=Object.freeze({__proto__:null,BoundsComponent:Zd,InputComponent:_d,GetVertices:Hc,TransformComponent:$d,UpdateLocalTransform:ae,UpdateWorldTransform:be});class Wp extends Bb{constructor(a,b,c,d){super(a,b,c,d);this.type="AnimatedSprite",this.anims=new Map(),this.animData={currentAnim:"",currentFrames:[],frameIndex:0,animSpeed:0,nextFrameTime:0,repeatCount:0,isPlaying:!1,yoyo:!1,pendingStart:!1,playingForward:!0,delay:0,repeatDelay:0,onStart:null,onRepeat:null,onComplete:null}}stop(){const a=this.animData;a.isPlaying=!1,a.currentAnim="",a.onComplete&&a.onComplete(this,a.currentAnim)}nextFrame(){const a=this.animData;a.frameIndex++;if(a.frameIndex===a.currentFrames.length)if(a.yoyo)a.frameIndex--,a.playingForward=!1;else if(a.repeatCount===-1||a.repeatCount>0)a.frameIndex=0,a.repeatCount!==-1&&a.repeatCount--,a.onRepeat&&a.onRepeat(this,a.currentAnim),a.nextFrameTime+=a.repeatDelay;else return a.frameIndex--,this.stop();this.setFrame(a.currentFrames[a.frameIndex]),a.nextFrameTime+=a.animSpeed}prevFrame(){const a=this.animData;a.frameIndex--;if(a.frameIndex===-1)if(a.repeatCount===-1||a.repeatCount>0)a.frameIndex=0,a.playingForward=!0,a.repeatCount!==-1&&a.repeatCount--,a.onRepeat&&a.onRepeat(this,a.currentAnim),a.nextFrameTime+=a.repeatDelay;else return a.frameIndex=0,this.stop();this.setFrame(a.currentFrames[a.frameIndex]),a.nextFrameTime+=a.animSpeed}update(a,b){super.update(a,b);const c=this.animData;if(!c.isPlaying)return;c.nextFrameTime-=a*1e3,c.nextFrameTime=Math.max(c.nextFrameTime,0),c.nextFrameTime===0&&(c.pendingStart?(c.onStart&&c.onStart(this,c.currentAnim),c.pendingStart=!1,c.nextFrameTime=c.animSpeed):c.playingForward?this.nextFrame():this.prevFrame())}get isPlaying(){return this.animData.isPlaying}get isPlayingForward(){return this.animData.isPlaying&&this.animData.playingForward}get currentAnimation(){return this.animData.currentAnim}destroy(a){super.destroy(a),this.anims.clear(),this.animData=null}}function ug(a,b,c,d,e,f,g=0,i=1,h=1,k=0,m=0){const o=Math.cos(g+m)*i,s=Math.sin(g+m)*i,u=-Math.sin(g-k)*h,v=Math.cos(g-k)*h,y=a*o+c*u+e,D=a*s+c*v+f,J=a*o+d*u+e,I=a*s+d*v+f,M=b*o+d*u+e,K=b*s+d*v+f,O=b*o+c*u+e,P=b*s+c*v+f;return{x0:y,y0:D,x1:J,y1:I,x2:M,y2:K,x3:O,y3:P}}function ce(a,b,c,d,e,f,g,i,h,k=0,m=4294967295){const o=a.shaders.current,s=o.buffer,u=s.vertexViewF32,v=s.vertexViewU32,y=o.count*s.quadElementSize;u[y+0]=b,u[y+1]=c,u[y+2]=f,u[y+3]=h,u[y+4]=k,v[y+5]=m,u[y+6]=b,u[y+7]=c+e,u[y+8]=f,u[y+9]=g,u[y+10]=k,v[y+11]=m,u[y+12]=b+d,u[y+13]=c+e,u[y+14]=i,u[y+15]=g,u[y+16]=k,v[y+17]=m,u[y+18]=b+d,u[y+19]=c,u[y+20]=i,u[y+21]=h,u[y+22]=k,v[y+23]=m,o.count++}function ed(a,b,c,d,e,f,g,i,h,k=0,m=4294967295){a.shaders.setDefault(k),ce(a,b,c,d,e,f,g,i,h,k,m),a.shaders.popAndRebind()}class fd extends jb{constructor(){super();this.type="Layer",this.transform.passthru=!0,this.willRender=!1}}class wg extends fd{constructor(){super();this.type="RenderLayer",this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!0,this.setDirty(_.CHILD_CACHE);const a=Hb(),b=Ib(),c=Jb(),d=new Oa(null,a*c,b*c);d.binding=new Ic(d),d.binding.framebuffer=de(d.binding.texture),this.texture=d,this.framebuffer=d.binding.framebuffer}renderGL(a){this.numChildren>0&&(a.flush(),this.isDirty(_.CHILD_CACHE)?(a.fbo.add(this.framebuffer,!0),this.clearDirty(_.CHILD_CACHE)):(a.fbo.add(this.framebuffer,!1),this.postRenderGL(a)))}postRenderGL(a){const b=this.texture;a.flush(),a.fbo.pop();const{u0:c,v0:d,u1:e,v1:f}=b.firstFrame;a.textures.bind(b),ed(a,0,0,b.width,b.height,c,d,e,f),a.textures.unbind(),this.clearDirty(_.TRANSFORM)}}class Xp extends wg{constructor(){super();this.shaders=[],this.type="EffectLayer"}postRenderGL(a){const b=this.shaders,c=this.texture;a.flush(),a.fbo.pop();if(b.length===0){const{u0:d,v0:e,u1:f,v1:g}=c.firstFrame;a.textures.bind(c),ed(a,0,0,c.width,c.height,d,e,f,g),a.textures.unbind()}else{let d=c;for(let h=0;h<b.length;h++){const k=b[h],{u0:m,v0:o,u1:s,v1:u}=d.firstFrame;a.shaders.set(k,0)&&(k.renderToFBO=!0,a.textures.bind(d),ce(a,0,0,d.width,d.height,m,o,s,u),a.shaders.pop(),a.textures.unbind(),d=k.texture)}const{u0:e,v0:f,u1:g,v1:i}=d.firstFrame;a.textures.bind(d),ed(a,0,0,d.width,d.height,e,f,g,i),a.textures.unbind()}this.clearDirty(_.TRANSFORM)}}function $j(a,b){const c=a.texture,d=b.shaders.current,e=d.buffer;b.flush(),b.textures.request(c),a.updateTextureIndex();const f=b.gl;d.bindBuffers(a.indexBuffer,a.vertexBuffer),f.bufferData(f.ARRAY_BUFFER,a.data,f.STATIC_DRAW),f.drawElements(f.TRIANGLES,a.count*e.quadIndexSize,f.UNSIGNED_SHORT,0),d.prevCount=a.count,b.flushTotal++,d.bindBuffers(e.indexBuffer,e.vertexBuffer)}function ak(a,b,c){return Math.max(b,Math.min(c,a))}class Zp extends fd{constructor(a,b){super();this.glTextureIndex=0,this.hasTexture=!1,this.type="SpriteBatch",this.willRender=!0,this.setTexture(b),this.setMaxSize(a)}resetBuffers(){let a=[];for(let c=0;c<this.maxSize*4;c+=4)a.push(c+0,c+1,c+2,c+2,c+3,c+0);this.data=new ArrayBuffer(this.maxSize*96),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const b=Ba.get();b&&(fc(this.vertexBuffer),fc(this.indexBuffer),this.vertexBuffer=b.createBuffer(),this.indexBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.data,b.STATIC_DRAW),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.index,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,null)),a=[],this.count=0}setMaxSize(a){return this.maxSize=ak(a,0,65535),this.resetBuffers(),this}setTexture(a){let b;return a instanceof Oa?b=a:b=Fa.get().get(a),b?(this.texture=b,this.hasTexture=!0,this.glTextureIndex=-1):console.warn(`Invalid Texture key: ${a}`),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.count>0}clear(){return this.count=0,this}addToBatch(a,b,c,d,e,f,g,i,h,k){if(this.count>=this.maxSize)return console.warn("SpriteBatch full"),this;const{u0:m,u1:o,v0:s,v1:u}=a,v=this.vertexViewF32,y=this.vertexViewU32,D=this.count*24,J=this.texture.binding?this.texture.binding.index:0;return v[D+0]=c,v[D+1]=d,v[D+2]=m,v[D+3]=s,v[D+4]=J,y[D+5]=b,v[D+6]=e,v[D+7]=f,v[D+8]=m,v[D+9]=u,v[D+10]=J,y[D+11]=b,v[D+12]=g,v[D+13]=i,v[D+14]=o,v[D+15]=u,v[D+16]=J,y[D+17]=b,v[D+18]=h,v[D+19]=k,v[D+20]=o,v[D+21]=s,v[D+22]=J,y[D+23]=b,this.setDirty(_.TRANSFORM),this.count++,this}add(a){const{frame:b=null,x:c=0,y:d=0,rotation:e=0,scaleX:f=1,scaleY:g=1,skewX:i=0,skewY:h=0,originX:k=0,originY:m=0,alpha:o=1,tint:s=16777215}=a,u=this.texture.getFrame(b),{left:v,right:y,top:D,bottom:J}=u.getExtent(k,m),{x0:I,y0:M,x1:K,y1:O,x2:P,y2:L,x3:q,y3:t}=ug(v,y,D,J,c,d,e,f,g,i,h),j=gc(s,o);return this.addToBatch(u,j,I,M,K,O,P,L,q,t)}addXY(a,b,c){const d=this.texture.getFrame(c),{left:e,right:f,top:g,bottom:i}=d.getExtent(0,0),{x0:h,y0:k,x1:m,y1:o,x2:s,y2:u,x3:v,y3:y}=ug(e,f,g,i,a,b);return this.addToBatch(d,4294967295,h,k,m,o,s,u,v,y)}updateTextureIndex(){const a=this.texture.binding.index;if(a===this.glTextureIndex)return;const b=this.vertexViewF32;this.glTextureIndex=a;for(let c=0;c<this.count;c++)b[c*24+4]=a,b[c*24+10]=a,b[c*24+16]=a,b[c*24+22]=a}renderGL(a){$j(this,a)}destroy(){super.destroy(),fc(this.vertexBuffer),fc(this.indexBuffer),this.data=null,this.vertexViewF32=null,this.vertexViewU32=null,this.index=null,this.texture=null,this.hasTexture=!1}}class _p extends Bb{constructor(a,b,c="",d,e){super(a,b,Kb());this.splitRegExp=/(?:\r\n|\r|\n)/,this.padding={left:0,right:0,top:0,bottom:0},this.verticalAlign="ascent",this.lineSpacing=0,this.font="16px monospace",this.fillStyle="#fff",this.strokeStyle="",this.backgroundStyle="",this.cornerRadius=0,this.textAlign="left",this.textBaseline="alphabetic",this.lineWidth=0,this.lineDash=[],this.antialias=!1,this.type="Text";const f=wa.get();this.resolution=f.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),d&&(this.font=d),e&&(this.fillStyle=e),this.setText(c)}syncContext(a,b){this.preRenderCallback&&this.preRenderCallback(a,b),b.font=this.font,b.textBaseline=this.textBaseline,b.textAlign=this.textAlign,b.fillStyle=this.fillStyle,b.strokeStyle=this.strokeStyle,b.lineWidth=this.lineWidth,b.lineCap="round",b.lineJoin="round",b.setLineDash(this.lineDash),b.imageSmoothingEnabled=this.antialias}updateText(){const a=this.canvas,b=this.context,c=this.resolution,d=this._text.split(this.splitRegExp),e=this.padding,f=this.fillStyle,g=this.strokeStyle,i=this.lineWidth,h=this.lineSpacing,k=i>0?i/2:0;b.clearRect(0,0,a.width,a.height),this.syncContext(a,b),b.textAlign="start";let m=0,o=0,s=0;const u=[],v=this.verticalAlign==="ascent",y=b.measureText("|MÃq"),D=Math.ceil(Math.abs(y.actualBoundingBoxAscent)+Math.abs(y.actualBoundingBoxDescent))+i;for(let j=0;j<d.length;j++){const n=b.measureText(d[j]),l=n.actualBoundingBoxLeft,r=n.actualBoundingBoxRight;let w=n.actualBoundingBoxAscent,p=n.actualBoundingBoxDescent;(!w&&!p||d[j]==="")&&(w=D,p=0);const F=Math.ceil(Math.abs(l)+Math.abs(r))+i,H=Math.ceil(Math.abs(w)+Math.abs(p))+i;v?(s+=w+k,j>0&&(s+=h+k),o=s+p+k):(s=o+(H-p-k),o+=H,j<d.length-1&&(o+=h)),m=Math.max(m,F),u.push({lineWidth:F,lineHeight:H,ascent:w,descent:p,left:l,right:r,y:s})}m+=e.left+e.right,o+=e.top+e.bottom;const J=this.fixedWidth?this.fixedWidth:m,I=this.fixedHeight?this.fixedHeight:o,M=Math.ceil(J*c),K=Math.ceil(I*c);(a.width!==M||a.height!==K)&&(a.width=M,a.height=K,this.texture.setSize(J,I),this.setSize(J,I)),b.save(),b.scale(c,c),this.syncContext(a,b);const O=this.backgroundStyle;if(O){b.save(),b.fillStyle=O,b.strokeStyle=O;const j=this.cornerRadius,n=j>0?j/2:0;j&&(b.lineWidth=j,b.strokeRect(n,n,J-j,I-j)),b.fillRect(n,n,J-j,I-j),b.restore()}const P=this.textAlign,L=P==="center",q=P==="right"||P==="end",t=(I-o)/2+e.top;for(let j=0;j<d.length;j++){const n=d[j],l=u[j];let r=e.left+l.left+k;const w=t+l.y;L?r=J/2:q&&(r=J-k),g&&b.strokeText(n,r,w),f&&b.fillText(n,r,w)}return b.restore(),this.texture.binding&&this.texture.binding.update(),this.setDirty(_.TEXTURE),this}get text(){return this._text}set text(a){this.setText(a)}setText(a=""){return Array.isArray(a)&&(a=a.join(`
`)),a!==this._text&&(this._text=a.toString(),this.updateText()),this}destroy(a){this.texture.destroy(),this.fillStyle=null,this.strokeStyle=null,this.backgroundStyle=null,this.canvas=null,this.context=null,super.destroy(a)}}function Ya(a,b){Array.isArray(b)?og(a,...b):_b(a,b)}function Ha(a,b,c=!0){if(Array.isArray(b)){cd(a,...b);for(let d=0,e=b.length;d<e;d++)b[d].destroy()}else{const d=b;cc(a,d),c&&d.destroy()}}function rb(a,b=!0){const c=a.children;for(let d=0,e=c.length;d<e;d++){const f=c[d];f.parent=null,b&&f.destroy()}c.length=0}class zi extends ec{add(a){return Ya(this,a),this}remove(a,b=!0){return Ha(this,a,b),this}clear(a=!0){return rb(this,a),this}}function gb(a=0,b={left:0,right:0,top:0,bottom:0}){if(typeof a==="number")b.left=a,b.right=a,b.top=a,b.bottom=a;else{let c,d,e,f;({left:c=0,right:d=0,top:e=0,bottom:f=0}=a),b.left=c,b.right=d,b.top=e,b.bottom=f}return b}function wc(a){return a.x-a.originX*a.width}function yc(a){return a.x+(.5-a.originX)*a.width}function xc(a){return a.x+(1-a.originX)*a.width}function zc(a){return a.y-a.originY*a.height}function Bc(a){return a.y+(.5-a.originY)*a.height}function Ac(a){return a.y+(1-a.originY)*a.height}function Fd(a,b){a.x+=b-wc(a)}function Hd(a,b){a.x+=b-yc(a)}function Gd(a,b){a.x+=b-xc(a)}function Id(a,b){a.y+=b-zc(a)}function Kd(a,b){a.y+=b-Bc(a)}function Jd(a,b){a.y+=b-Ac(a)}function xn(a,b,c,d){if(a.rexSizer.hidden||!a.needLayout)return a;a.preLayout(b,c,d),c===void 0&&(c=Math.max(a.childrenWidth,a.minWidth)),d===void 0&&(d=Math.max(a.childrenHeight,a.minHeight)),a.resize(c,d),a.layoutBackgrounds(),a.postLayout(b,c,d)}function Bi(a,b,c,d){if(b)return;a.layoutInit();const e=a.getChildrenSizers();for(var f=0,g=e.length;f<g;f++){const i=e[f];if(i.rexSizer.hidden||!i.needLayout)continue;Bi(i)}}function $c(a){a._childrenWidth=void 0,a._childrenHeight=void 0}function Yb(a,b,c){if(!a||b===void 0&&c===void 0)return;a.resize?(b===void 0&&(b=a.width),c===void 0&&(c=a.height),a.resize(b,c)):(b!==void 0&&(a.width=b),c!==void 0&&(a.height=c))}var ra;(function(a){a[a.left_top=0]="left_top",a[a.top_left=0]="top_left",a[a.center_top=1]="center_top",a[a.top_center=1]="top_center",a[a.right_top=2]="right_top",a[a.top_right=2]="top_right",a[a.left_center=3]="left_center",a[a.center_left=3]="center_left",a[a.center=4]="center",a[a.center_center=4]="center_center",a[a.right_center=5]="right_center",a[a.center_right=5]="center_right",a[a.left_bottom=6]="left_bottom",a[a.bottom_left=6]="bottom_left",a[a.center_bottom=7]="center_bottom",a[a.bottom_center=7]="bottom_center",a[a.right_bottom=8]="right_bottom",a[a.bottom_right=8]="bottom_right"})(ra||(ra={}));function Go(a,b,c=ra.center,d=0,e=0){const f=c%3;switch(f){case 0:Fd(a,wc(b));break;case 1:Hd(a,yc(b));break;default:Gd(a,xc(b));break}const g=Math.floor(c/3);switch(g){case 0:Id(a,zc(b));break;case 1:Kd(a,Bc(b));break;default:Jd(a,Ac(b));break}a.x-=d,a.y-=e}class Nr{constructor(){this.x=0;this.y=0;this.width=0;this.height=0;this.originX=0;this.originY=0}setTo(a=0,b=0,c=0,d=0){return this.x=a,this.y=b,this.width=c,this.height=d,this}alignIn(a,b=ra.center,c=0,d=0){return Go(a,this,b,c,d),this}}const sb=new Nr();function yn(a){if(a.backgroundChildren===void 0)return;const b=a.left,c=a.top,d=a.width,e=a.height,f=a.backgroundChildren;for(let g=0,i=f.length;g<i;g++){const h=f[g],k=h.rexSizer;if(k.hidden)continue;const m=k.padding,o=b+m.left,s=c+m.top,u=d-m.left-m.right,v=e-m.top-m.bottom;Yb(h,u,v),sb.setTo(o,s,u,v).alignIn(h)}}function zn(a,b,c,d){}function An(a,b){Ya(a,b)}function Bn(a){return a.hasOwnProperty("rexSizer")||(a.rexSizer={}),a.rexSizer}function Cn(a,b,{padding:c=0,childKey:d}={}){a.backgroundChildren===void 0&&(a.backgroundChildren=[]),Ya(a,b),a.backgroundChildren.push(b);const e=a.getSizerState(b);e.padding=gb(c),d!==void 0&&a.addChildrenMap(d,b)}function Dn(a,b){return a.backgroundChildren===void 0?!1:a.backgroundChildren.indexOf(b)!==-1}function En(a,b,c){a.childrenMap===void 0&&(a.childrenMap={}),a.childrenMap[b]=c}function In(a,b,c=!1){if(c){const d=[a];for(;d.length;){a=d.shift();for(let e=0,f=a.children.length;e<f;e++){const g=a.children[e];if(g.name===b)return g;d.push(g)}}}else for(let d=0,e=a.children.length;d<e;d++){const f=a.children[d];if(f.name===b)return f}return null}function Ci(a,b,c){typeof b==="string"&&(b=b.split("."));if(b.length===0)return null;let d=b.shift(),e=null;if(d.charAt(0)==="#")d=d.substring(1),e=In(a,d,c);else if(d.indexOf("[")===-1)a.childrenMap&&(e=a.childrenMap[d]);else{const f=d.match(Mr);if(f!=null){if(a.childrenMap){let g=a.childrenMap[f[1]];g&&(e=g[f[2]])}}}return b.length===0?e:e&&e.childrenMap?Ci(e,b,c):null}const Mr=/(\S+)\[(\d+)\]/i;function Ld(a){let b=a.parent;for(;b;){if(b instanceof aa)return b;b=b.parent}return null}function Fn(a,b){return Ld(b)===a}function Gn(a,b){return a.backgroundChildren?a.backgroundChildren.indexOf(b)>=0:!1}function Hn(a){let b,c=Ld(a);for(;c;)b=c,c=Ld(c);return b}class aa extends zi{constructor({x:a=0,y:b=0,width:c=0,height:d=0,space:e=0,name:f=""}={}){super(a,b);this.type="rexBaseSizer";this.rexSizer={};this.needLayout=!0;this.setMinSize(c,d),this.space=gb(e),this.name=f}destroy(a){this.sizerChildren=null,this.backgroundChildren=null,super.destroy(a)}get left(){return wc(this)}set left(a){Fd(this,a)}alignLeft(a){return this.left=a,this}get right(){return xc(this)}set right(a){Gd(this,a)}alignRight(a){return this.right=a,this}get innerLeft(){return this.left+this.space.left}get innerRight(){return this.right-this.space.right}get centerX(){return yc(this)}set centerX(a){Hd(this,a)}alignCenterX(a){return this.centerX=a,this}get top(){return zc(this)}set top(a){Id(this,a)}alignTop(a){return this.top=a,this}get bottom(){return Ac(this)}set bottom(a){Jd(this,a)}alignBottom(a){return this.bottom=a,this}get innerTop(){return this.top+this.space.top}get innerBottom(){return this.bottom-this.space.bottom}get centerY(){return Bc(this)}set centerY(a){Kd(this,a)}alignCenterY(a){return this.centerY=a,this}get innerWidth(){return this.width-this.space.left-this.space.right}get innerHeight(){return this.height-this.space.top-this.space.bottom}setMinSize(a,b){return this.setMinWidth(a).setMinHeight(b),this}setMinWidth(a=0){return this.minWidth=a,this}setMinHeight(a=0){return this.minHeight=a,this}getChildrenWidth(){return 0}getChildrenHeight(){return 0}getChildrenSizers(a=[]){return a}get childrenWidth(){return this._childrenWidth===void 0&&(this._childrenWidth=this.getChildrenWidth()),this._childrenWidth}get childrenHeight(){return this._childrenHeight===void 0&&(this._childrenHeight=this.getChildrenHeight()),this._childrenHeight}resize(a=this.width,b=this.height){return this.setSize(a,b),this}getSizerState(a){return Bn(a)}layout(){const a=this.x,b=this.y;return this.setPosition(0,0)._layout().setPosition(a,b),this}_layout(a,b,c){return xn(this,a,b,c),this}preLayout(a,b,c){return Bi(this,a,b,c),this}layoutInit(){return $c(this),this}layoutBackgrounds(){return yn(this),this}postLayout(a,b,c){return zn(this,a,b,c),this}pin(a){return An(this,a),this}addBackground(a,b){return Cn(this,a,b),this}isBackground(a){return Dn(this,a)}addChildrenMap(a,b){return En(this,a,b),this}getElement(a,b=!1){return Ci(this,a,b)}isChild(a){return Fn(this,a)}isBackgroundChild(a){return Gn(this,a)}getTopmostParentSizer(a=this){return Hn(a)}}var hb;(function(a){a[a.left=0]="left",a[a.top=0]="top",a[a.right=1]="right",a[a.bottom=1]="bottom",a[a.center=2]="center",a[a.justify=3]="justify",a[a["justify-left"]=3]="justify-left",a[a["justify-top"]=3]="justify-top",a[a["justify-right"]=4]="justify-right",a[a["justify-bottom"]=4]="justify-bottom",a[a["justify-center"]=5]="justify-center"})(hb||(hb={}));var da;(function(a){a[a.x=0]="x",a[a.h=0]="h",a[a.horizontal=0]="horizontal",a[a["left-to-right"]=0]="left-to-right",a[a.y=1]="y",a[a.v=1]="v",a[a.vertical=1]="vertical",a[a["top-to-bottom"]=1]="top-to-bottom"})(da||(da={}));function Jn(a,b=a.sizerChildren){let c=0;for(let d=0,e=b.length;d<e;d++){const f=b[d];if(f===`
`)continue;const g=f instanceof aa?Math.max(f.minWidth,f.childrenWidth):f.width;c=Math.max(g,c)}return c}function Kn(a,b=a.sizerChildren){let c=0;for(let d=0,e=b.length;d<e;d++){const f=b[d];if(f===`
`)continue;const g=f instanceof aa?Math.max(f.minHeight,f.childrenHeight):f.height;c=Math.max(g,c)}return c}function Ln(a,b=[]){const c=a.sizerChildren;for(var d=0,e=c.length;d<e;d++){const f=c[d];if(f===`
`)continue;f instanceof aa&&b.push(f)}return b}function Mn(a){if(a.rexSizer.hidden)return 0;let b;return a.orientation===da.x?b=a.maxChildWidth:b=0,b+a.space.left+a.space.right}function Nn(a){if(a.rexSizer.hidden)return 0;let b;return a.orientation===da.x?b=0:b=a.maxChildHeight,b+a.space.top+a.space.bottom}function Vn(a,b){const c={lines:[],width:0,height:0},d=c.lines,e=a.sizerChildren;let f=0,g;for(let i=0,h=e.length;i<h;i++){let k=e[i],m,o;if(k===`
`)k=void 0,m=0,o=!0;else{if(k.rexSizer.hidden)continue;k instanceof aa&&k.layout(),m=a.orientation===da.x?Wn(k):Xn(k),o=f<m}o&&(g&&(g.width=b-(f+a.space.item),c.width=Math.max(c.width,g.width),c.height+=g.height+a.space.line),g={children:[],width:0,height:0},d.push(g),f=b),f-=m+a.space.item;if(k){g.children.push(k);const s=a.orientation===da.x?Xn(k):Wn(k);g.height=Math.max(g.height,s)}}return g&&(g.width=b-(f+a.space.item),c.width=Math.max(c.width,g.width),c.height+=g.height),c}function Wn(a){const b=a.rexSizer.padding;return a.width+b.left+b.right}function Xn(a){const b=a.rexSizer.padding;return a.height+b.top+b.bottom}function On(a,b,c,d){if(a.rexSizer.hidden||!a.needLayout)return;a.preLayout(b),c===void 0&&(c=Math.max(a.maxChildWidth+a.space.left+a.space.right,a.minWidth)),d===void 0&&(d=Math.max(a.maxChildHeight+a.space.top+a.space.bottom,a.minHeight));let e;a.orientation===da.x?e=c-a.space.left-a.space.right:e=d-a.space.top-a.space.bottom;const f=Vn(a,e);a.orientation===da.x?d=Math.max(d,f.height+a.space.top+a.space.bottom):c=Math.max(c,f.height+a.space.left+a.space.right),a.resize(c,d);const g=a.innerLeft,i=a.innerTop;let h=g,k=i;const m=f.lines;for(let u=0,v=m.length;u<v;u++){const y=m[u],D=y.children;a.rtl&&D.reverse();const J=e-y.width;let I=0;switch(a.align){case hb.left:break;case hb.right:a.orientation===da.x?h+=J:k+=J;break;case hb.center:a.orientation===da.x?h+=J/2:k+=J/2;break;case hb["justify-left"]:I=Ei(e,J,D.length);break;case hb["justify-right"]:I=Ei(e,J,D.length),I===0&&(a.orientation===da.x?h+=J:k+=J);break;case hb["justify-center"]:I=Ei(e,J,D.length),I===0&&(a.orientation===da.x?h+=J/2:k+=J/2);break}for(var o=0,s=D.length;o<s;o++){const M=D[o],K=M.rexSizer,O=K.padding;let P,L,q,t;a.orientation===da.x?(P=h+O.left,o>0&&(P+=a.space.item),L=k+O.top,q=M.width,t=M.height,h=P+q+O.right+I):(P=h+O.left,L=k+O.top,o>0&&(L+=a.space.item),q=M.width,t=M.height,k=L+t+O.bottom+I),sb.setTo(P,L,q,t).alignIn(M,ra.center)}a.orientation===da.x?(h=g,k+=y.height+a.space.line):(h+=y.height+a.space.line,k=i)}a.layoutBackgrounds(),a.postLayout()}function Ei(a,b,c){return b/a<=.25?b/(c-1):0}function Pn(a){$c(a),a._maxChildWidth=void 0,a._maxChildHeight=void 0}function Qn(a,b,{padding:c=0,childKey:d,index:e}={}){Ya(a,b);const f=a.getSizerState(b);f.padding=gb(c),e===void 0||e>=a.sizerChildren.length?a.sizerChildren.push(b):a.sizerChildren.splice(e,0,b),d!==void 0&&a.addChildrenMap(d,b)}function Rn(a){a.sizerChildren.push(`
`)}function zd(a,b){if(b>=a.length)return;let c=a.length-1,d=a[b];for(let e=b;e<c;e++)a[e]=a[e+1];return a.length=c,d}function tb(a,b,c,d=a){if(!Array.isArray(b)){const f=a.indexOf(b);return f!==-1?(zd(a,f),c&&c.call(d,b),b):null}let e=b.length-1;for(;e>=0;){const f=b[e],g=a.indexOf(f);g!==-1?(zd(a,g),c&&c.call(d,f)):b.pop(),e--}return b}function Sn(a,b,c=!0){Ha(a,b,c);const d=tb(a.sizerChildren,b);!d&&a.backgroundChildren&&tb(a.backgroundChildren,b)}function Tn(a,b=!0){const c=a.sizerChildren;for(let d=0,e=c.length;d<e;d++){const f=c[d];if(f===`
`)continue;Ha(a,f,b)}a.sizerChildren.length=0}function Un(a,b=!0){rb(a,b),a.sizerChildren.length=0,a.backgroundChildren&&(a.backgroundChildren.length=0)}class Di extends aa{constructor({space:a={item:0,line:0},orientation:b=da.x,align:c=hb.left,rtl:d=!1}={}){super(arguments[0]);this.type="rexFixedWidthSizer";this.sizerChildren=[];this.setOrientation(b),this.setItemSpacing(a.item),this.setLineSpacing(a.line),this.setAlign(c),this.setRTL(d)}setOrientation(a){return typeof a==="string"&&(a=da[a]),this.orientation=a,this}setItemSpacing(a=0){return this.space.item=a,this}setLineSpacing(a=0){return this.space.line=a,this}setAlign(a){return typeof a==="string"&&(a=hb[a]),this.align=a,this}setRTL(a=!0){return this.rtl=a,this}get maxChildWidth(){return this._maxChildWidth===void 0&&(this._maxChildWidth=Jn(this)),this._maxChildWidth}get maxChildHeight(){return this._maxChildHeight===void 0&&(this._maxChildHeight=Kn(this)),this._maxChildHeight}getChildrenSizers(a=[]){return Ln(this,a)}getChildrenWidth(){return Mn(this)}getChildrenHeight(){return Nn(this)}_layout(a,b,c){return On(this,a,b,c),this}layoutInit(){return Pn(this),this}add(a,b){return Qn(this,a,b),this}addNewLine(){return Rn(this),this}remove(a,b=!0){return Sn(this,a,b),this}removeAll(a=!0){return Tn(this,a),this}clear(a=!0){return Un(this,a),this}}function ub(a,b,c=0,d=a.length-1){for(let e=c;e<=d;e++)a[e]=b;return a}function Yn(a,{column:b=0,row:c=0,columnProportions:d=0,rowProportions:e=0,space:f}={}){a.columnCount=b,a.rowCount=c,a.sizerChildren.length=b*c,ub(a.sizerChildren,null),a.columnProportions.length=b;if(typeof d==="number")ub(a.columnProportions,d);else for(let h=0;h<b;h++)a.columnProportions[h]=d[h]??0;a.rowProportions.length=c;if(typeof e==="number")ub(a.rowProportions,e);else for(let h=0;h<c;h++)a.rowProportions[h]=e[h]??0;a.columnWidth.length=b,a.rowHeight.length=c,a.space.column=[],a.space.column.length=b-1;const g=f.column??0;if(typeof g==="number")ub(a.space.column,g);else for(let h=0,k=a.space.column.length;h<k;h++)a.space.column[h]=g[h]??0;a.space.row=[],a.space.row.length=c-1;const i=f.row??0;if(typeof i==="number")ub(a.space.row,i);else for(let h=0,k=a.space.row.length;h<k;h++)a.space.row[h]=i[h]??0}function Zn(a,b=[]){const c=a.sizerChildren;for(var d=0,e=c.length;d<e;d++){const f=c[d];f&&f instanceof aa&&b.push(f)}return b}function yf(...a){return Array.prototype.reduce.call(a,ys,0)}function ys(a,b){return a+b}function _n(a){if(a.rexSizer.hidden)return 0;let b=0;const c=a.sizerChildren;for(let d=0;d<a.columnCount;d++){const e=a.columnProportions[d];let f=0;if(e===0){for(let g=0;g<a.rowCount;g++){const i=c[g*a.columnCount+d];if(!i)continue;if(i.rexSizer.hidden)continue;let h=i instanceof aa?Math.max(i.minWidth,i.childrenWidth):i.width;const k=i.rexSizer.padding;h+=k.left+k.right,f=Math.max(f,h)}b+=f}a.columnWidth[d]=f}return b+yf(a.space.left,...a.space.column,a.space.right)}function $n(a){if(a.rexSizer.hidden)return 0;let b=0;const c=a.sizerChildren;for(let e=0;e<a.rowCount;e++){const f=a.rowProportions[e];let g=0;if(f===0){for(var d=0;d<a.columnCount;d++){const i=c[e*a.columnCount+d];if(!i)continue;if(i.rexSizer.hidden)continue;let h=i instanceof aa?Math.max(i.minHeight,i.childrenHeight):i.height;const k=i.rexSizer.padding;h+=k.top+k.bottom,g=Math.max(g,h)}b+=g}a.rowHeight[e]=g}return b+yf(a.space.top,...a.space.row,a.space.bottom)}function lo(a,b){let c;const d=a.rexSizer;if(d.expand){const e=d.padding;c=b-e.left-e.right}return c}function ko(a,b){let c;const d=a.rexSizer;if(d.expand){const e=d.padding;c=b-e.top-e.bottom}return c}function Zb(a,b,c){return a.sizerChildren[c*a.columnCount+b]}function ao(a,b,c,d){if(a.rexSizer.hidden||!a.needLayout)return;a.preLayout(b);const e=a.totalColumnProportions,f=a.totalRowProportions;if(c===void 0)if(b&&e>0){const y=a.rexSizer.padding;c=b.width-y.left-y.right}else c=Math.max(a.childrenWidth,a.minWidth);if(d===void 0)if(b&&f>0){const y=a.rexSizer.padding;d=b.height-y.top-y.bottom}else d=Math.max(a.childrenHeight,a.minHeight);a.resize(c,d);let g;e>0?g=(a.width-a.childrenWidth)/e:g=0;let i;f>0?i=(a.height-a.childrenHeight)/f:i=0;const h=a.innerLeft,k=a.innerTop,m=a.space.column,o=a.space.row;let s=h,u=k;for(let y=0;y<a.rowCount;y++){const D=a.rowProportions[y],J=D===0?a.rowHeight[y]:D*i;s=h;for(var v=0;v<a.columnCount;v++){const I=a.columnProportions[v],M=I===0?a.columnWidth[v]:I*g,K=Zb(a,v,y);if(!K||K.rexSizer.hidden){s+=M+m[v];continue}const O=lo(K,M),P=ko(K,J);K instanceof aa?K._layout(a,O,P):Yb(K,O,P);const L=K.rexSizer,q=L.padding,t=s+q.left,j=M-q.left-q.right,n=u+q.top,l=J-q.top-q.bottom;sb.setTo(t,n,j,l).alignIn(K,L.align),s+=M+m[v]}u+=J+o[y]}return a.layoutBackgrounds(),a.postLayout()}function jo(a,b,c,d,e){if(typeof a==="number"&&typeof b==="number"){let f=b*d+a;if(!c[f])return f}else if(b===void 0&&typeof a==="number")for(let f=0;f<e;f++){let g=f*d+a;if(!c[g])return g}else if(a===void 0&&typeof b==="number")for(let f=0;f<d;f++){let g=b*d+f;if(!c[g])return g}else if(b===!0)for(let f=0;f<d;f++)for(let g=0;g<e;g++){let i=g*d+f;if(!c[i])return i}else for(let f=0,g=c.length;f<g;f++)if(!c[f])return f;return null}function bo(a,b,{column:c,row:d,align:e=ra.center,padding:f=0,expand:g=!0,childKey:i}={}){const h=jo(c,d,a.sizerChildren,a.columnCount,a.rowCount);if(h===null)return;Ya(a,b),typeof e==="string"&&(e=ra[e]);const k=a.getSizerState(b);k.align=e,k.padding=gb(f),k.expand=g,a.sizerChildren[h]=b,i!==void 0&&a.addChildrenMap(i,b)}function xf(a,b,c=!0){Ha(a,b,c);const d=a.sizerChildren.indexOf(b);d>=0?a.sizerChildren[d]=null:a.backgroundChildren&&tb(a.backgroundChildren,b)}function co(a,b,c,d=!0){const e=Zb(a,b,c);e&&xf(a,e,d)}function eo(a,b=!0){Ha(a,a.sizerChildren,b),ub(a.sizerChildren,null)}function fo(a,b=!0){rb(a,b),ub(a.sizerChildren,null),a.backgroundChildren&&(a.backgroundChildren.length=0)}function go(a,b,c){if(!b)return null;const d=a.sizerChildren.indexOf(b);return d===-1?null:(c===void 0&&(c={x:0,y:0}),c.x=d%a.columnCount,c.y=Math.floor(d/a.columnCount),c)}function ho(a,b,c){for(let d=0,e=a.rowCount;d<e;d++)for(let f=0,g=a.columnCount;f<g;f++){if(Zb(a,f,d))continue;let i;c?i=b.call(c,f,d,a):i=b(f,d,a);if(i)return}}function io(a){const b=a.sizerChildren;let c=0;for(let d=0,e=b.length;d<e;d++)b[d]||c++;return c}class Fi extends aa{constructor(a={}){super(a);this.type="rexGridSizer";this.sizerChildren=[];this.columnProportions=[];this.rowProportions=[];this.columnWidth=[];this.rowHeight=[];Yn(this,a)}setColumnProportion(a,b){return a<this.columnProportions.length&&(this.columnProportions[a]=b),this}setRowProportion(a,b){return a<this.rowProportions.length&&(this.rowProportions[a]=b),this}get totalColumnProportions(){return this.columnProportions.reduce((a,b)=>a+b)}get totalRowProportions(){return this.rowProportions.reduce((a,b)=>a+b)}getChildrenSizers(a=[]){return Zn(this,a)}getChildrenWidth(){return _n(this)}getChildrenHeight(){return $n(this)}_layout(a,b,c){return ao(this,a,b,c),this}add(a,b){return bo(this,a,b),this}remove(a,b=!0){return xf(this,a,b),this}removeAt(a,b,c=!0){return co(this,a,b,c),this}removeAll(a=!0){return eo(this,a),this}clear(a=!0){return fo(this,a),this}getChildAt(a,b){return Zb(this,a,b)}childToGridIndex(a,b){return go(this,a,b)}forEachEmptyGrid(a,b){return ho(this,a,b),this}get gridCount(){return this.sizerChildren.length}get emptyGridCount(){return io(this)}}function wo(a,b=[]){const c=a.sizerChildren;for(var d=0,e=c.length;d<e;d++){const f=c[d];f instanceof aa&&b.push(f)}return b}function xo(a){const b=a.sizerChildren;let c=0;for(let d=0,e=b.length;d<e;d++){const f=b[d];if(f.rexSizer.hidden)continue;const g=f.rexSizer,i=g.proportion;i>0&&(c+=i)}return c}class Df extends ec{}function Ef(a){return a instanceof Df}function Af(a,b=!0){if(a.rexSizer.hidden)return 0;b===void 0&&(b=!0);const c=a.sizerChildren;let d=0;if(a.orientation===da.x)for(var e=0,f=c.length;e<f;e++){const g=c[e],i=g.rexSizer;if(i.hidden)continue;let h;i.proportion===0||b&&!Ef(g)&&i.proportion>0?h=g instanceof aa?Math.max(g.minWidth,g.childrenWidth):g.width:h=0;const k=i.padding;h+=k.left+k.right,e>0&&(h+=a.space.item),d+=h}else for(var e=0,f=c.length;e<f;e++){const g=c[e];if(!g.hasOwnProperty("rexSizer"))continue;const i=g.rexSizer;if(i.hidden)continue;let h=g instanceof aa?Math.max(g.minWidth,g.childrenWidth):g.width;const k=i.padding;h+=k.left+k.right,d=Math.max(h,d)}return d+a.space.left+a.space.right}function Bf(a,b=!0){if(a.rexSizer.hidden)return 0;const c=a.sizerChildren;let d=0;if(a.orientation===da.x)for(var e=0,f=c.length;e<f;e++){const g=c[e],i=g.rexSizer;if(i.hidden)continue;let h=g instanceof aa?Math.max(g.minHeight,g.childrenHeight):g.height;const k=i.padding;h+=k.top+k.bottom,d=Math.max(h,d)}else for(var e=0,f=c.length;e<f;e++){const g=c[e];if(!g.hasOwnProperty("rexSizer"))continue;const i=g.rexSizer;if(i.hidden)continue;let h;i.proportion===0||b&&!Ef(g)&&i.proportion>0?h=g instanceof aa?Math.max(g.minHeight,g.childrenHeight):g.height:h=0;const k=i.padding;h+=k.top+k.bottom,e>0&&(h+=a.space.item),d+=h}return d+a.space.top+a.space.bottom}function Fo(a,b){let c;const d=b.rexSizer,e=d.padding;return a.orientation===da.x?d.proportion>0&&a.proportionLength>0&&(c=d.proportion*a.proportionLength):d.expand&&(c=a.innerWidth-e.left-e.right),c}function Eo(a,b){let c;const d=b.rexSizer,e=d.padding;return a.orientation===da.x?d.expand&&(c=a.innerHeight-e.top-e.bottom):d.proportion>0&&a.proportionLength>0&&(c=d.proportion*a.proportionLength),c}function yo(a,b,c,d){if(a.rexSizer.hidden||!a.needLayout)return;a.preLayout(b),c===void 0&&(c=Math.max(a.childrenWidth,a.minWidth)),d===void 0&&(d=Math.max(a.childrenHeight,a.minHeight)),a.resize(c,d);let e;if(a.childrenProportion>0){let s=a.orientation===da.x?a.width-a.childrenWidth:a.height-a.childrenHeight;s>0?(s=a.orientation===da.x?a.width-Af(a,!1):a.height-Bf(a,!1),e=s/a.childrenProportion):e=0}else e=0;a.proportionLength=e;const f=a.sizerChildren,g=a.innerLeft,i=a.innerTop,h=a.innerWidth,k=a.innerHeight;let m=g,o=i;for(let s=0,u=f.length;s<u;s++){const v=f[s];if(v.rexSizer.hidden)continue;const y=v.rexSizer,D=y.padding;let J=Fo(a,v),I=Eo(a,v);v instanceof aa?v._layout(a,J,I):Yb(v,J,I),J===void 0&&(J=v.width),I===void 0&&(I=v.height);let M,K,O,P;a.orientation===da.x?(M=m+D.left,y.proportion===0||e===0?O=J:O=y.proportion*e,K=o+D.top,P=k-D.top-D.bottom):(M=m+D.left,O=h-D.left-D.right,K=o+D.top,y.proportion===0||e===0?P=I:P=y.proportion*e),sb.setTo(M,K,O,P).alignIn(v,y.align),a.orientation===da.x?m+=O+D.left+D.right+a.space.item:o+=P+D.top+D.bottom+a.space.item}a.layoutBackgrounds(),a.postLayout()}function zo(a){$c(a),a._childrenProportion=void 0}function Cf(a,b,{proportion:c=0,align:d=ra.center,padding:e=0,expand:f=!1,childKey:g,index:i}={}){Ya(a,b),typeof d==="string"&&(d=ra[d]);const h=a.getSizerState(b);h.proportion=c,h.align=d,h.padding=gb(e),h.expand=f,i===void 0||i>=a.sizerChildren.length?a.sizerChildren.push(b):a.sizerChildren.splice(i,0,b),g!==void 0&&a.addChildrenMap(g,b)}function Ao(a,b=1){const c=new Df();Cf(a,c,{proportion:b})}function Bo(a,b,c=!0){Ha(a,b,c);const d=tb(a.sizerChildren,b);!d&&a.backgroundChildren&&tb(a.backgroundChildren,b)}function Co(a,b=!0){Ha(a,a.sizerChildren,b),a.sizerChildren.length=0}function Do(a,b=!0){rb(a,b),a.sizerChildren.length=0,a.backgroundChildren&&(a.backgroundChildren.length=0)}class Md extends aa{constructor({space:a={item:0},orientation:b=da.x}={}){super(arguments[0]);this.type="rexSizer";this.sizerChildren=[];this.setOrientation(b),this.setItemSpacing(a.item)}setOrientation(a){return typeof a==="string"&&(a=da[a]),this.orientation=a,this}setItemSpacing(a=0){return this.space.item=a,this}get childrenProportion(){return this._childrenProportion===void 0&&(this._childrenProportion=xo(this)),this._childrenProportion}getChildrenSizers(a=[]){return wo(this,a)}getChildrenWidth(a=!0){return Af(this,a)}getChildrenHeight(a=!0){return Bf(this,a)}_layout(a,b,c){return yo(this,a,b,c),this}layoutInit(){return zo(this),this}add(a,b){return Cf(this,a,b),this}addSpace(a=1){return Ao(this,a),this}remove(a,b=!0){return Bo(this,a,b),this}removeAll(a=!0){return Co(this,a),this}clear(a=!0){return Do(this,a),this}}class Gi extends Md{constructor({background:a,icon:b,text:c,expandTextWidth:d=!1,expandTextHeight:e=!1,action:f,align:g,space:i={}}={}){super(arguments[0]);this.type="rexLabel";a&&this.addBackground(a),(g==="right"||g==="bottom"||g==="center")&&this.addSpace();if(b){let h;const k=i.icon??0;this.orientation===da.x?(c||f)&&(h={right:k}):(c||f)&&(h={bottom:k}),this.add(b,{padding:h})}if(c){let h,k,m;const o=i.text??0;this.orientation===da.x?(h=d?1:0,f&&(k={right:o}),m=e):(h=e?1:0,f&&(k={bottom:o}),m=d),this.add(c,{proportion:h,align:ra.center,padding:k,expand:m})}f&&this.add(f),g==="center"&&this.addSpace(),this.addChildrenMap("background",a),this.addChildrenMap("icon",b),this.addChildrenMap("text",c),this.addChildrenMap("action",f)}get text(){const a=this.childrenMap.text;if(a===void 0)return"";let b;return a.text?(b=a.text,typeof b!=="string"&&(b=b.join(`
`))):b="",b}set text(a){const b=this.childrenMap.text;b!==void 0&&(b.text=a)}setText(a){return typeof a!=="string"&&(a=a.join(`
`)),this.text=a,this}appendText(a){return typeof a!=="string"&&(a=a.join(`
`)),this.text+=a,this}}function mo(a,b=[]){for(const[c,d]of a.sizerChildren)d instanceof aa&&b.push(d);return b}function no(a){if(a.rexSizer.hidden)return 0;let b=0;for(const[c,d]of a.sizerChildren){let e=d instanceof aa?Math.max(d.minWidth,d.childrenWidth):d.width;const f=d.rexSizer.padding;e+=f.left+f.right,b=Math.max(e,b)}return b+a.space.left+a.space.right}function oo(a){if(a.rexSizer.hidden)return 0;let b=0;for(const[c,d]of a.sizerChildren){let e=d instanceof aa?Math.max(d.minHeight,d.childrenHeight):d.height;const f=d.rexSizer.padding;e+=f.top+f.bottom,b=Math.max(e,b)}return b+a.space.top+a.space.bottom}function vo(a,b){let c;const d=b.rexSizer;if(d.expandWidth){const e=d.padding;c=a.innerWidth-e.left-e.right}return c}function uo(a,b){let c;const d=b.rexSizer;if(d.expandHeight){const e=d.padding;c=a.innerHeight-e.top-e.bottom}return c}function po(a,b,c,d){if(a.rexSizer.hidden||!a.needLayout)return;a.preLayout(b),c===void 0&&(c=Math.max(a.childrenWidth,a.minWidth)),d===void 0&&(d=Math.max(a.childrenHeight,a.minHeight)),a.resize(c,d);const e=a.innerLeft,f=a.innerTop,g=a.innerWidth,i=a.innerHeight;for(let[h,k]of a.sizerChildren){const m=k.rexSizer,o=m.padding;if(k instanceof aa)k._layout(a,vo(a,k),uo(a,k));else{let D,J;m.expandWidth&&(D=g-o.left-o.right),m.expandHeight&&(J=i-o.top-o.bottom),Yb(k,D,J)}const s=e+o.left,u=g-o.left-o.right,v=f+o.top,y=i-o.top-o.bottom;sb.setTo(s,v,u,y).alignIn(k,m.align)}a.layoutBackgrounds(),a.postLayout()}function qo(a,b,{key:c=Date.now(),padding:d=0,align:e=ra.center,expand:f=!0}={}){Ya(a,b),typeof e==="string"&&(e=ra[e]);const g=a.getSizerState(b);g.key=c,g.align=e,g.padding=gb(d);if(typeof f==="boolean")g.expandWidth=f,g.expandHeight=f;else{let{width:i=!1,height:h=!1}=f;g.expandWidth=i,g.expandHeight=h}a.sizerChildren.has(c)&&a.sizerChildren.get(c).destroy(),a.sizerChildren.set(c,b)}function zf(a,b){if(b instanceof jb)if(b.parent===a&&b.hasOwnProperty("rexSizer")){const c=b.rexSizer;return c.key}else return null;else{const c=b;return a.sizerChildren.has(c)?c:null}}function ro(a,b,c=!0){Ha(a,b,c);const d=zf(a,b);d?a.sizerChildren.delete(d):tb(a.backgroundChildren,b)}function so(a,b=!0){Ha(a,Array.from(a.sizerChildren.values()),b),a.sizerChildren.clear()}function to(a,b=!0){rb(a,b),a.sizerChildren.clear(),a.backgroundChildren&&(a.backgroundChildren.length=0)}class Hi extends aa{constructor(a={}){super(a);this.type="rexOverlapSizer";this.sizerChildren=new Map()}getChildrenSizers(a=[]){return mo(this,a)}getChildrenWidth(){return no(this)}getChildrenHeight(){return oo(this)}_layout(a,b,c){return po(this,a,b,c),this}add(a,b){return qo(this,a,b),this}getChildKey(a){return zf(this,a)}remove(a,b=!0){return ro(this,a,b),this}removeAll(a=!0){return so(this,a),this}clear(a=!0){return to(this,a),this}}var Ia;(function(a){a[a.none=0]="none",a[a.word=1]="word",a[a.char=2]="char"})(Ia||(Ia={}));var za;(function(a){a[a.none=0]="none",a[a.raw=1]="raw",a[a.wrapped=2]="wrapped"})(za||(za={}));const Vi=/(?:\r\n|\r|\n)/;function Xo(a,b,c,d,e,f=0){e<=0&&(d=0);let g=[];if(!a||!a.length)return g;let i=a.split(Vi),h=i.length-1;a.slice(-1)===`
`&&(i.length-=1);let k;for(let m=0,o=i.length;m<o;m++){let s=i[m],u=m===h?0:1;if(d===0){g.push(Sd(s,b(s,c),u));continue}m===0?k=e-f:k=e;if(s.length<=100){let I=b(s,c);if(I<=k){g.push(Sd(s,I,u));continue}}let v;d===1?v=s.split(" "):v=s;let y="",D="",J=0;for(let I=0,M=v.length;I<M;I++){let K=v[I];d===1?(y+=K,I<M-1&&(y+=" ")):y+=K;let O=b(y,c);O>k&&(I===0?g.push(Sd("",0,2)):(g.push(Sd(D,J,2)),y=K,d===1&&(I<M-1&&(y+=" ")),O=b(y,c)),k=e),D=y,J=O}g.push(Sd(D,J,u))}return g}let Sd=function(a,b,c){return{text:a,width:b,newLineMode:c}};var Nd;(function(a){a[a.left=0]="left",a[a.center=1]="center",a[a.right=2]="right"})(Nd||(Nd={}));var Od;(function(a){a[a.top=0]="top",a[a.center=1]="center",a[a.bottom=2]="bottom"})(Od||(Od={}));class Cc{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(a){return this.items.push(a),this}pushMultiple(a){return this.items.push.apply(this.items,a),a.length=0,this}clear(){return this.items.length=0,this}}class Xi{constructor(){this.pens=[]}destroy(){this.pens.length=0}addPen(a){return this.pens.push(a),this}get firstPen(){return this.pens[0]}get lastPen(){return this.pens[this.pens.length-1]}hasPen(){return this.pens.length>0}get pensCount(){return this.pens.length}get startIndex(){let a=this.pens[0];return a?a.startIndex:0}get width(){let a=this.lastPen;return a?a.lastX:0}}function Wf(a){if(Array.isArray(a))a.length=0;else for(let b in a)delete a[b]}function Dc(a,b=Array.isArray(a)?[]:{}){Wf(b);if(Array.isArray(a)){b.length=a.length;for(let c=0,d=a.length;c<d;c++)b[c]=a[c]}else for(let c in a)b[c]=a[c];return b}class Yi{constructor(){this.text="";this.x=0;this.y=0;this.width=0;this.height=0;this.ascent=0;this.descent=0;this.prop={};this.newLineMode=za.none;this.startIndex=0}set(a="",b=0,c=0,d=0,e=0,f=0,g=0,i={},h=za.none,k=0){return this.text=a,this.x=b,this.y=c,this.width=d,this.height=e,this.ascent=f,this.descent=g,this.prop=i,this.newLineMode=h,this.startIndex=k,this}clone(){let a=new Yi();return a.set(this.text,this.x,this.y,this.width,this.height,this.ascent,this.descent,Dc(this.prop),this.newLineMode,this.startIndex),a}get plainText(){return this.newLineMode===za.raw?`${this.text}
`:this.text}get wrapText(){return this.newLineMode!==za.none?`${this.text}
`:this.text}get plainTextLength(){let a=this.text.length;return this.newLineMode===za.raw&&(a+=1),a}get endIndex(){return this.startIndex+this.plainTextLength}get lastX(){return this.x+this.width}get isTextPen(){return this.text!==""}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}}class Pd{constructor({penPool:a}){this.pens=[];this.lines=[];this.pens=[],this.lines=[],this.penPool=a}destroy(){this.freePens()}freePens(){return this.penPool.pushMultiple(this.pens),this.lines.forEach(a=>{a.destroy()}),this.lines.length=0,this.maxLineWidth=0,this.totalLineHeight=0,this}addTextPen(a,b,c,d,e,f,g,i,h=za.none){let k=this.penPool.pop();return k==null&&(k=new Yi()),k.set(a,b,c,d,e,f,g,i,h),this.addPen(k),this}addImagePen(a,b,c,d,e){return this.addTextPen("",a,b,c,d,d,0,e,za.none),this}addNewLinePen(a){let b=this.lastPen;return b&&b.newLineMode===za.none&&(b.newLineMode=a),this}addPen(a){let b=this.lastPen;b==null?a.startIndex=0:a.startIndex=b.endIndex,this.pens.push(a);let c=this.lastLine;return c==null&&(c=new Xi(),this.lines.push(c)),c.addPen(a),a.newLineMode!==za.none&&(c=new Xi(),this.lines.push(c)),this}clone(a){a==null&&(a=new Pd({penPool:this.penPool})),a.freePens();const b=this.pens;for(let e=0,f=b.length;e<f;e++)a.addPen(b[e].clone());const c=this.lines,d=a.lines;for(let e=0,f=c.length;e<f;e++){const g=c[e],i=d[e];i.y=g.y,i.height=g.height}return a}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(a){if(a>=this.lines.length)return this.getLineEndIndex(a);{let b=this.lines[a];if(!b)return 0;let c=b.firstPen;return c?c.startIndex:0}}getLineEndIndex(a){let b=this.lines.length;a>=b&&(a=b-1);for(let c=a;c>=0;c--){let d=this.lines[c];if(d&&d.hasPen())return d.lastPen.endIndex}return 0}getLineWidth(a){let b=this.lines[a];return b?b.width:0}getLineHeights(a=[]){return this.lines.forEach(function(b){a.push(b.height)}),a}get lineCount(){return this.lines.length}get plainText(){let a=[],b=this.pens;for(let c=0,d=b.length;c<d;c++)a.push(b[c].plainText);return a.join()}get plainTextLength(){let a=0;for(let b=0,c=this.pens.length;b<c;b++)a+=this.pens[b].plainTextLength;return a}getSliceTagText(a,b,c=0,d,e=!1){if(d===void 0){let k=this.lastPen;if(!k)return"";d=k.endIndex}let f=[],g;for(var i=0,h=this.pens.length;i<h;i++){let k=this.pens[i],m=k.endIndex;if(m<=c)continue;let o=e?k.wrapText:k.plainText,s=k.prop,u=k.startIndex,v=u>=c&&m<=d;v||(o=o.substring(c-u,d-u)),b?f.push(a.call(b,o,s,g)):f.push(a(o,s,g)),g=s;if(m>=d)break}return f.join()}}function Uo(a,b,c){let d=Dc(a,c);for(let e in b)d.hasOwnProperty(e)&&(d[e]=b[e]);return d}function Kf(a,b,c={key:b}){c=Uo(Vr,c);let d=Fa.get(),e=d.get(c.key);if(!e)return;let f=e.getFrame(c.frame);if(!f)return;let g=c.width,i=c.height;(g===void 0||i===void 0)&&(g===void 0&&i===void 0?(c.width=f.width,c.height=f.height):g===void 0?c.width=f.width*(i/f.height):i===void 0&&(c.height=f.height*(g/f.width))),a.images.set(b,c)}const Vr={key:void 0,frame:void 0,width:void 0,height:void 0,y:0,left:0,right:0,top:0,bottom:0};class Qo{constructor(){this.images=new Map()}destroy(){this.images.clear()}add(a,b){if(typeof a==="string")Kf(this,a,b);else if(Array.isArray(a)){let c=a;for(let d=0,e=c.length;d<e;d++)Kf(this,c[d])}else{let c=a;for(a in c)Kf(this,a,c[a])}return this}remove(a){return this.images.delete(a),this}get(a){return this.images.get(a)}getOuterWidth(a){let b=this.images.get(a);return b?b.width+b.left+b.right:0}getOuterHeight(a){let b=this.images.get(a);return b?b.height+b.top+b.bottom:0}getFrame(a){let b=this.images.get(a);if(!b)return;let c=Fa.get(),d=c.get(b.key);if(!d)return;let e=d.getFrame(b.frame);return e}hasTexture(a){return!!this.getFrame(a)}}function If(a,b){a.font=b.font}function Jf(a,b){a.textBaseline="alphabetic",a.textAlign="start",a.fillStyle=b.fillStyle,a.strokeStyle=b.strokeStyle,a.lineWidth=b.strokeThickness,a.lineCap="round",a.lineJoin="round",a.imageSmoothingEnabled=b.antialias}function Wi(a,b,c){c?(a.shadowColor=b.shadowColor,a.shadowBlur=b.shadowBlur,a.shadowOffsetX=b.shadowOffsetX,a.shadowOffsetY=b.shadowOffsetY):(a.shadowColor="#000",a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0)}function Vo(a,b){return b.measureText(a).width}function Wo(a,b,c=0){let d=b.measureText(a),e=d.actualBoundingBoxAscent,f=d.actualBoundingBoxDescent;return(!e&&!f||a==="")&&(e=c,f=0),Of.ascent=e,Of.descent=f,Of.height=Math.ceil(Math.abs(e)+Math.abs(f)),Of}let Of={ascent:0,descent:0,height:0};function Ro(a,b,c,d,e){a.freePens();if(b==="")return a;let f=c.canvas,g=c.context,i=c.parent,h=c.parser.splitText(b),k,m,o=0;for(var s=0,u=h.length;s<u;s++){let I=c.parser.tagTextToProp(h[s],k),M=I.text;k=I.prop;if(k.img){let K,O;c.imageManager?(K=c.imageManager.getOuterWidth(k.img),O=c.imageManager.getOuterHeight(k.img)):(K=0,O=0),e>0&&d!==Ia.none&&(e<o+K&&(a.addNewLinePen(za.wrapped),o=0)),a.addImagePen(o,0,K,O,Dc(k)),o+=K}else if(M!==""){g.save();let K=c.parser.propToStyle(i,k);If(g,K),Jf(g,K);let O=K.strokeThickness,P=O/2;m=Xo(M,Vo,g,d,e,o);let L=Wo("|MÃq",g);for(let q=0,t=m.length;q<t;q++){const j=m[q],n=L.height+O,l=L.ascent+P,r=L.descent+P;a.addTextPen(j.text,o,0,j.width,n,l,r,Dc(k),j.newLineMode),j.newLineMode!==za.none?o=0:o+=j.width}g.restore()}}let v=a.lines,y=c.parent.lineSpacing,D=0,J=0;for(let I=0,M=v.length;I<M;I++){const K=v[I],O=K.pens,P=O.length;let L=0,q=0;for(let n=0;n<P;n++){const l=O[n];L=Math.max(L,l.ascent),q=Math.max(q,l.descent)}const t=L+q,j=J+L;for(let n=0;n<P;n++)O[n].y+=j;K.y=j,K.height=t,D=Math.max(D,K.width),J+=t+y}return a.maxLineWidth=D,a.totalLineHeight=J-y,a}const ck={PI2:Math.PI*2,HALF_PI:Math.PI*.5,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};class Ur extends Na{constructor(a,b,c,d,e){super(a,b,c,d);this.name=e}}class To{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return this.hitAreas.length=0,this}add(a,b,c,d,e){let f=new Ur(b,c,d,e,a);return this.hitAreas.push(f),this}getFirstHitArea(a,b){for(let c=0,d=this.hitAreas.length;c<d;c++){let e=this.hitAreas[c];if(e.contains(a,b))return e}return null}}function So(a,b,c,d,e,f=0,g=0,i=a.penManager){a.hitAreaManager&&a.hitAreaManager.clear();let h=i.totalLineHeight;if(h===0)return;const k=d<a.textWidth||e<a.textHeight;let m=a.context;m.save();let o=a.parent;Pr(a,o),Qr(a,o),k&&(m.beginPath(),m.rect(b,c,d,e),m.clip());let s=o.align%3,u=Math.floor(o.align/3),v=c-g;switch(u){case Od.center:v+=(e-h)/2;break;case Od.bottom:v+=e-h-2;break}let y=i.lines,D=v;const J=b+e;for(let I=0,M=y.length;I<M;I++){let K=y[I];if(D>J)break;const O=D+K.height;if(O<c){D=O;continue}let P=K.width;if(P===0){D=O;continue}let L=b-f;switch(s){case Nd.center:L+=(d-P)/2;break;case Nd.right:L+=d-P;break}let q=K.pens;for(let t=0,j=q.length;t<j;t++)Or(a,q[t],L,v);D=O}m.restore()}function Or(a,b,c,d){c+=b.x,d+=b.y;let e=a.canvas,f=a.context,g=a.parent;f.save();let i=a.parser.propToStyle(g,b.prop);If(f,i),Jf(f,i),i.underlineThickness>0&&b.width>0&&Rr(a,c,d,b.width,i),b.isTextPen&&Sr(a,c,d,b.text,i),b.isImagePen&&Tr(a,c,d,b.prop.img,i),f.restore(),b.hasAreaMarker&&b.width>0&&(a.hitAreaManager||(a.hitAreaManager=new To()),a.hitAreaManager.add(b.prop.area,c,d,b.width,b.height))}function Pr(a,b){let c=a.canvas,d=a.context;d.clearRect(0,0,c.width,c.height)}function Qr(a,b){let c=a.canvas,d=a.context;d.clearRect(0,0,c.width,c.height);const e=b.backgroundFillStyle,f=b.backgroundStrokeStyle;if(e||f){const g=b.backgroundStrokeThickness,i=g/2,h=b.cornerRadius,k=i,m=i,o=c.width-g,s=c.height-g;Ed(c,d,k,m,o,s,h,e,f,g,b.backgroundFillColor2,b.backgroundIsHorizontalGradient)}else d.clearRect(0,0,c.width,c.height)}function Rr(a,b,c,d,e){c+=e.underlineOffsetY-e.underlineThickness/2;let f=a.context,g=f.lineCap;f.lineCap="butt",f.beginPath(),f.strokeStyle=e.underlineStyle,f.lineWidth=e.underlineThickness,f.moveTo(b,c),f.lineTo(b+d,c),f.stroke(),f.lineCap=g}function Sr(a,b,c,d,e){let f=a.context;e.strokeStyle&&e.strokeStyle!=="none"&&e.strokeThickness>0&&(Wi(f,e,e.shadowStroke),f.strokeText(d,b,c)),e.fillStyle&&e.fillStyle!=="none"&&(Wi(f,e,e.shadowFill),f.fillText(d,b,c))}function Tr(a,b,c,d,e){let f=a.imageManager;if(!f)return;let g=f.get(d),i=f.getFrame(d);b+=g.left,c+=g.y-g.height;let h=a.context;h.drawImage(i.texture.image,i.x,i.y,i.width,i.height,b,c,g.width,g.height)}class Ho{constructor({canvas:a,context:b,parent:c,parser:d,penPool:e=new Cc()}){this.textScrollX=0;this.textScrollY=0;this.canvas=a,this.context=b,this.parser=d,this.parent=c,this.penPool=e,this.penManager=new Pd({penPool:e})}destroy(){this.parser.destroy(),this.canvas=null,this.context=null,this.parser=null,this.parent=null,this.penManager&&(this.penManager.destroy(),this.penManager=null),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=null),this.imageManager&&(this.imageManager.destroy(),this.imageManager=null),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=null)}get textWidth(){return this.penManager.maxLineWidth}get textHeight(){return this.penManager.totalLineHeight}updatePenManager(a,b,c,d=this.penManager){return Ro(d,a,this,b,c)}draw(a,b,c,d,e=0,f=0){return So(this,a,b,c,d,e,f,this.penManager),this}get lines(){return this.penManager.lines}get tmpPenManager(){return this._tmpPenManager===null&&(this._tmpPenManager=new Pd({penPool:this.penPool})),this._tmpPenManager}getPlainText(a,b,c){let d;return a==null?d=this.penManager.plainText:d=this.parser.splitText(a,!0).join(""),(b!=null||c!=null)&&(b==null&&(b=0),c==null&&(c=d.length),d=d.substring(b,c)),d}getPenManager(a,b){return a===void 0?this.clonePenManager(b,this.penManager):(b===void 0&&(b=new Pd({penPool:this.penPool})),this.updatePenManager(a,this.parent.wrapMode,this.parent.wrapWidth,b),b)}getText(a,b,c,d){if(a==null)return this.penManager.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d);let e=this.tmpPenManager;return this.updatePenManager(a,this.parent.wrapMode,this.parent.wrapWidth,e),e.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d)}clonePenManager(a,b=this.penManager){return b.clone(a)}getLastPen(a=this.penManager){return a.lastPen}addImageInfo(a,b){return this.imageManager===void 0&&(this.imageManager=new Qo()),this.imageManager.add(a,b),this}}function Ji(a,b=!0,c=!0){let d=a.canvasText;b&&d.updatePenManager(a.text,a.wrapMode,a.wrapWidth);if(c){let e=a.padding,f,g,i,h;a.fixedWidth===0?(f=d.textWidth,i=f+e.left+e.right):(i=a.fixedWidth,f=i-e.left-e.right,f>d.textWidth&&(f=d.textWidth)),a.fixedHeight===0?(g=d.textHeight,h=g+e.top+e.bottom):(h=a.fixedHeight,g=h-e.top-e.bottom,g>d.textHeight&&(g=d.textHeight));let k=a.resolution,m=Math.ceil(i*k),o=Math.ceil(h*k),s=a.canvas;(s.width!==m||s.height!==o)&&(s.width=m,s.height=o,a.texture.setSize(i,h),a.setSize(i,h));let u=a.context;u.save(),u.scale(k,k),d.draw(e.left,e.top,f,g,0,a.textScrollY),u.restore(),a.texture.binding&&a.texture.binding.update(),a.setDirty(_.TEXTURE)}}function Ff(a,b=0,c=0){a.fixedWidth=b,a.fixedHeight=c,Hf(a)}function Ki(a,b,c,d,e){const f=a.padding;if(typeof b==="number")f.left=b,f.right=c===void 0?b:c,f.top=d===void 0?b:d,f.bottom=e===void 0?b:e;else{let g=b;f.left=g.left??0,f.right=g.right??0,f.top=g.top??0,f.bottom=g.bottom??0}Hf(a)}function Hf(a){const b=a.fixedWidth;if(a.wrapMode!==Ia.none){const c=a.padding,d=b-c.left-c.right;a.wrapWidth=Math.max(d,0)}else a.wrapWidth=0}function Io(a,b,c=!1){c?a.textScrollYPercentage=b:a.textScrollY=b}function Li(a,b){typeof b==="string"&&(b=ra[b]),a.align=b}function Mi(a,b=0){a.lineSpacing=b}function Ni(a,b,c,d=0,e=0,f,g=!0){c||(d=0),a.backgroundFillStyle=b,a.backgroundFillColor2=f,a.backgroundIsHorizontalGradient=g,a.backgroundStrokeStyle=c,a.backgroundStrokeThickness=d,a.cornerRadius=e}function Jo(a,b,c){b&&Oi(a,b),c&&Pi(a,c)}function Oi(a,b){a.fontFamily=b}function Pi(a,b){typeof b==="number"&&(b=`${b}px`),a.fontSize=b}function Qi(a,b){a.fillStyle=b}function Ri(a,b,c=2){a.strokeStyle=b,a.strokeThickness=c}function Si(a,b="#000",c=5,d=0,e=0,f=!1,g=!1){a.shadowColor=b,a.shadowBlur=c,a.shadowOffsetX=d,a.shadowOffsetY=e,a.shadowFill=f,a.shadowStroke=g}function Ti(a,b,c){typeof b==="string"&&(b=Ia[b]),a.wrapMode=b,c===void 0?Hf(a):a.wrapWidth=c}function Ui(a,b,c=2,d=0){a.underlineStyle=b,a.underlineThickness=c,a.underlineOffsetY=d}function Ii(a,b,c){a.canvasText.addImageInfo(b,c)}function Ko(a,b,c,d){return b=a.canvasText.getText(b,c,d,!0),b.split(Vi)}function Lo(a,b,c,d){return a.canvasText.getPlainText(b,c,d)}function Mo(a,b,c,d){return a.canvasText.getText(b,c,d,!1)}function No(a,b,c,d){return a.canvasText.getText(b,c,d,!1)}function Oo(a,b){return a.canvasText.clonePenManager(b)}function Po(a,b,c){return a.canvasText.getPenManager(b,c)}class Gf extends Bb{constructor(a,b,c="",{width:d=0,height:e=0,padding:f,wrapMode:g=Ia.none,backgroundFillStyle:i,backgroundFillColor2:h,backgroundIsHorizontalGradient:k,backgroundStrokeStyle:m,backgroundStrokeThickness:o,cornerRadius:s=0,align:u=ra.top_left,lineSpacing:v=0,fontFamily:y="monospace",fontSize:D="16px",fillStyle:J="#fff",strokeStyle:I,strokeThickness:M=1,shadowColor:K="#000",shadowBlur:O=4,shadowOffsetX:P=0,shadowOffsetY:L=0,shadowFill:q=!1,shadowStroke:t=!1,underlineStyle:j="#fff",underlineThickness:n=1,underlineOffsetY:l=0,images:r}={},w){super(a,b,Kb());this.antialias=!1;this.fontFamily="monospace";this.fontSize="16px";this.fillStyle="#fff";this.strokeThickness=1;this.shadowStroke=!1;this.shadowFill=!1;this.shadowColor="#000";this.shadowBlur=4;this.shadowOffsetX=0;this.shadowOffsetY=0;this.underlineStyle="#fff";this.underlineThickness=1;this.underlineOffsetY=0;this.align=ra.top_left;this.lineSpacing=0;this.wrapMode=Ia.none;this.wrapWidth=0;this.fixedWidth=0;this.fixedHeight=0;this.padding={left:0,right:0,top:0,bottom:0};this._textScrollY=0;this.type="rexText";const p=wa.get();this.resolution=p.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.canvasText=new Ho({canvas:this.canvas,context:this.context,parent:this,parser:w}),Ff(this,d,e),f&&Ki(this,f),Ti(this,g),Li(this,u),Mi(this,v),Ni(this,i,m,o,s,h,k),Oi(this,y),Pi(this,D),Qi(this,J),I&&Ri(this,I,M),Si(this,K,O,P,L,q,t),Ui(this,j,n,l),r&&Ii(this,r),this.setText(c)}destroy(a){this.canvasText.destroy(),this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}updateText(a=!0,b=!0){return Ji(this,a,b),this}get text(){return this._text}set text(a){this.setText(a)}setText(a="",b=!0){return Array.isArray(a)&&(a=a.join(`
`)),a!==this._text&&(this._text=a.toString(),b&&this.updateText()),this}setBackgroundStyle(a,b,c=2,d=0,e,f=!0){return Ni(this,a,b,c,d,e,f),this}setFixedSize(a,b){return Ff(this,a,b),this}setPadding(a,b,c,d){return Ki(this,a,b,c,d),this}setTextScrollY(a,b=!1){return Io(this,a,b),this}setAlign(a){return Li(this,a),this}setLineSpacing(a=0){return Mi(this,a),this}setFont(a,b){return Jo(this,a,b),this}setFillStyle(a){return Qi(this,a),this}setStrokeStyle(a,b=2){return Ri(this,a,b),this}setShadow(a="#000",b=5,c=0,d=0,e=!1,f=!1){return Si(this,a,b,c,d,e,f),this}resize(a,b){return Ff(this,a,b),Ji(this),this}setWrapMode(a,b=0){return Ti(this,a,b),this}setUnderline(a,b=2,c=0){return Ui(this,a,b,c),this}addImageInfo(a,b){return Ii(this,a,b),this}getWrappedText(a,b,c){return Ko(this,a,b,c)}getPlainText(a,b,c){return Lo(this,a,b,c)}getText(a,b,c){return Mo(this,a,b,c)}getSubString(a,b,c){return No(this,a,b,c)}clonePenManager(a){return Oo(this,a)}getPenManager(a,b){return Po(this,a,b)}get textScrollY(){return this._textScrollY}set textScrollY(a){this._textScrollY=a}get textScrollYPercentage(){return this._textScrollY/(this.totalTextHeight-this.displayTextHeight)}set textScrollYPercentage(a){const b=this.displayTextHeight,c=this.totalTextHeight;c<=b?this._textScrollY=0:this._textScrollY=(c-b)*a}get totalTextHeight(){return this.canvasText.textHeight}get displayTextHeight(){const a=this.padding;return this.height-a.top-a.bottom}}class Lf{destroy(){}}const Mf={text:null,prop:null},Nf={font:void 0,fontFamily:void 0,fontStyle:void 0,fontSize:void 0,fillStyle:void 0,strokeStyle:void 0,strokeThickness:void 0,shadowColor:void 0,shadowOffsetX:void 0,shadowOffsetY:void 0,shadowBlur:void 0,shadowStroke:void 0,shadowFill:void 0,underlineStyle:void 0,underlineThickness:void 0,underlineOffsetY:void 0,image:void 0};class Yo extends Lf{splitText(a,b=!1){const c=[];let d=0;for(;;){const f=Zi.exec(a);if(!f)break;const g=f[0],i=Zi.lastIndex-g.length;d<i&&c.push(a.substring(d,i)),b||c.push(g),d=Zi.lastIndex}const e=a.length;return d<e&&c.push(a.substring(d,e)),c}tagTextToProp(a,b){let c,d;b==null&&(b={}),b.img&&ya(b,vb,"img"),Yr.test(a)?(ya(b,$a,"b",!0),c=""):Zr.test(a)?(ya(b,vb,"b"),c=""):_r.test(a)?(ya(b,$a,"i",!0),c=""):$r.test(a)?(ya(b,vb,"i"),c=""):Zo.test(a)?(d=a.match(Zo),ya(b,$a,"size",d[1]+"px"),c=""):as.test(a)?(ya(b,vb,"size"),c=""):_o.test(a)?(d=a.match(_o),ya(b,$a,"color",d[1]),c=""):bs.test(a)?(ya(b,vb,"color"),c=""):$o.test(a)?(d=a.match($o),ya(b,$a,"u",!0),c=""):ap.test(a)?(d=a.match(ap),ya(b,$a,"u",d[1]),c=""):cs.test(a)?(ya(b,vb,"u"),c=""):ds.test(a)?(ya(b,$a,"shadow",!0),c=""):bp.test(a)?(d=a.match(bp),ya(b,$a,"shadow",d[1]),c=""):es.test(a)?(ya(b,vb,"shadow"),c=""):fs.test(a)?(ya(b,$a,"stroke",!0),c=""):cp.test(a)?(d=a.match(cp),ya(b,$a,"stroke",d[1]),c=""):gs.test(a)?(ya(b,vb,"stroke"),c=""):dp.test(a)?(d=a.match(dp),ya(b,$a,"img",d[1]),c=""):hs.test(a)?(ya(b,vb,"img"),c=""):ep.test(a)?(d=a.match(ep),ya(b,$a,"area",d[1]),c=""):is.test(a)?(ya(b,vb,"area"),c=""):c=a;const e=Mf;return e.text=c,e.prop=b,e}propToStyle(a,b){const c=Nf;return b.hasOwnProperty("img")?c.image=b.img:(c.image=null,c.fontFamily=a.fontFamily,c.fontSize=b.size??a.fontSize,c.fontStyle=Wr(b.b,b.i),c.font=`${c.fontStyle} ${c.fontSize} ${c.fontFamily}`,c.fillStyle=b.color??a.fillStyle,b.hasOwnProperty("stroke")?b.stroke===!0?(c.strokeStyle=a.strokeStyle,c.strokeThickness=a.strokeThickness):(c.strokeStyle=b.stroke,c.strokeThickness=a.strokeThickness):(c.strokeStyle=a.strokeStyle,c.strokeThickness=0)),b.hasOwnProperty("shadow")?b.shadow===!0?(c.shadowColor=a.shadowColor,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor=b.shadow,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor="#000",c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=0,c.shadowStroke=!1,c.shadowFill=!1),b.hasOwnProperty("u")?b.u===!0?(c.underlineStyle=a.underlineStyle,c.underlineThickness=a.underlineThickness,c.underlineOffsetY=a.underlineOffsetY):(c.underlineStyle=b.u,c.underlineThickness=a.underlineThickness,c.underlineOffsetY=a.underlineOffsetY):(c.underlineStyle="#000",c.underlineThickness=0,c.underlineOffsetY=0),c}propToTagText(a,b,c){c==null&&(c=Xr);let d=[];for(const f in c){if(b.hasOwnProperty(f))continue;d.push(`[/${f}]`)}a=`${d.join()}${a}`;let e=[];for(const f in b){if(c[f]===b[f])continue;switch(f){case"size":const g=b.size.replace("px","");e.push(`[size=${g}]`);break;case"color":case"img":case"area":e.push(`[${f}=${b[f]}]`);break;case"stroke":case"u":b[f]===!0?e.push(`[${f}]`):e.push(`[${f}=${b[f]}]`);break;default:e.push(`[${f}]`);break}}return a=`${a}${e.join()}`,a}}const ya=function(a,b,c,d){return b===$a?a[c]=d:a.hasOwnProperty(c)&&delete a[c],a};var Wr=function(a,b){return a&&b?"bold italic":a?"bold":b?"italic":""};const Xr={},Zi=/\[b\]|\[\/b\]|\[i\]|\[\/i\]|\[size=(\d+)\]|\[\/size\]|\[color=([a-z]+|#[0-9abcdef]+)\]|\[\/color\]|\[u\]|\[u=([a-z]+|#[0-9abcdef]+)\]|\[\/u\]|\[shadow\]|\[shadow=([a-z]+|#[0-9abcdef]+)\]|\[\/shadow\]|\[stroke\]|\[stroke=([a-z]+|#[0-9abcdef]+)\]|\[\/stroke\]|\[img=([^\]]+)\]|\[\/img\]|\[area=([^\]]+)\]|\[\/area\]/ig;var Yr=/\[b\]/i,Zr=/\[\/b\]/i,_r=/\[i\]/i,$r=/\[\/i\]/i,Zo=/\[size=(\d+)\]/i,as=/\[\/size\]/i,_o=/\[color=([a-z]+|#[0-9abcdef]+)\]/i,bs=/\[\/color\]/i,$o=/\[u\]/i,ap=/\[u=([a-z]+|#[0-9abcdef]+)\]/i,cs=/\[\/u\]/i,ds=/\[shadow\]/i,bp=/\[shadow=([a-z]+|#[0-9abcdef]+)\]/i,es=/\[\/shadow\]/i,fs=/\[stroke\]/i,cp=/\[stroke=([a-z]+|#[0-9abcdef]+)\]/i,gs=/\[\/stroke\]/i,dp=/\[img=([^\]]+)\]/i,hs=/\[\/img\]/i,ep=/\[area=([^\]]+)\]/i,is=/\[\/area\]/i;const vb=!1,$a=!0;class Gc extends Gf{constructor(a,b,c="",d){super(a,b,c,d,new Yo());this.type="rexBBcodeText"}}class fp extends Lf{constructor(a){super();this.tags=new Map();if(a)for(const b in a)this.addTag(b,a[b])}destroy(){this.tags.clear()}addTag(a,b){return this.tags.set(a,b),this}isTextTag(a){const b=this.tags.get(a);return b?b.img==null:!1}splitText(a,b=!1){const c=[];let d=0;for(;;){const f=_i.exec(a);if(!f)break;const g=f[0],i=_i.lastIndex-g.length;d<i&&c.push(a.substring(d,i));if(!b)c.push(g);else if(hp.test(g)){const h=g.match(ip);c.push(h[2])}else if(jp.test(g)){const h=g.match(kp);c.push(h[2])}d=_i.lastIndex}const e=a.length;return d<e&&c.push(a.substring(d,e)),c}tagTextToProp(a,b){let c,d;if(hp.test(a)){const f=a.match(ip);if(f!=null){const g=f[1],i=this.tags;d=i.get(g)??{},d._class=g,c=f[2]}}else if(jp.test(a)){const f=a.match(kp);if(f!=null){const g=f[1];d=js(g),d._style=g,c=f[2]}}c===void 0&&(c=a),d===void 0&&(d={});const e=Mf;return e.text=c,e.prop=d,e}propToStyle(a,b){const c=Nf;if(b.hasOwnProperty("img"))c.image=b.img;else{c.image=null,c.fontFamily=b.family??b.fontFamily??b["font-family"]??a.fontFamily;let d=b.size??b.fontSize??b["font-size"]??a.fontSize;typeof d==="number"&&(d=`${d}px`),c.fontSize=d,c.fontStyle=b.style??b.fontStyle??b["font-style"]??"",c.font=`${c.fontStyle} ${c.fontSize} ${c.fontFamily}`,c.fillStyle=b.color??b["font-color"]??a.fillStyle;if(b.hasOwnProperty("stroke")){const e=b.stroke;c.strokeStyle=e.color??a.strokeStyle,c.strokeThickness=e.thinkness??a.strokeThickness}else c.strokeStyle=a.strokeStyle,c.strokeThickness=a.strokeThickness}if(b.hasOwnProperty("shadow")){const d=b.shadow;c.shadowColor=d.color??a.shadowColor,c.shadowOffsetX=d.offsetX??a.shadowOffsetX,c.shadowOffsetY=d.offsetY??a.shadowOffsetY,c.shadowBlur=d.blur??a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0}else c.shadowColor=a.shadowColor,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=a.shadowStroke,c.shadowFill=a.shadowFill;if(b.hasOwnProperty("u")||b.hasOwnProperty("underline")){const d=b.u??b.underline;c.underlineStyle=d.color??a.underlineStyle,c.underlineThickness=d.thinkness??a.underlineThickness,c.underlineOffsetY=d.offset??a.underlineOffsetY}else c.underlineStyle="#000",c.underlineThickness=0,c.underlineOffsetY=0;return c}propToTagText(a,b,c){if(b.hasOwnProperty("_class")){if(a===""){if(this.isTextTag(b._class))return""}return`<class=${b._class}>${a}</class>`}else if(b.hasOwnProperty("_style"))return`<style=${b._style}>${a}</style>`}}function js(a){const b=a.split(";"),c={};for(var d=0,e=b.length;d<e;d++){const[f,g]=b[d].split(":");if(gp(f)||gp(g))continue;if(f==="stroke"){const i=g.split(" "),h={},k=i.length;k>=1&&(h.color=i[0]),k>=2&&(h.thinkness=parseInt(i[1].replace("px",""))),c.stroke=h}else if(f==="shadow"){const i=g.split(" "),h={},k=i.length;k>=1&&(h.color=i[0]),k>=2&&(h.offsetX=parseInt(i[1].replace("px",""))),k>=3&&(h.offsetY=parseInt(i[2].replace("px",""))),k>=4&&(h.blur=parseInt(i[3].replace("px",""))),c.shadow=h}else if(f==="u"||f==="underline"){const i=g.split(" "),h={},k=i.length;k>=1&&(h.color=i[0]),k>=2&&(h.thinkness=parseInt(i[1].replace("px",""))),k>=3&&(h.offset=parseInt(i[2].replace("px",""))),c[f]=h}else c[f]=g}return c}function gp(a){return a=a.replace(ks,""),a.length===0}const _i=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,hp=/<\s*class=/i,ip=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,jp=/<\s*style=/i,kp=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,ks=/^\s+|\s+$/;class vf extends Gf{constructor(a,b,c="",d){const e=d?d.tags:void 0;super(a,b,c,d,new fp(e));this.type="rexTagText"}get parser(){return this.canvasText.parser}addTag(a,b){return this.parser.addTag(a,b),this}addTags(a){for(const b in a)this.parser.addTag(b,a[b]);return this}}function _a(a,b){return a===void 0||b===void 0?void 0:`${a}|${b}`}function El(a,b){let c=a.split("|");return b===void 0&&(b=dr),b.x=parseInt(c[0]),b.y=parseInt(c[1]),b}let dr={x:0,y:0};let Ip=new Cc();function Mk(){let a=Ip.pop();return a===null&&(a=new Map()),a}function Fe(a){Ip.push(a)}function Kk(a,b,c,d,e,f,g,i){if(c===f&&d===g&&e===i)return;let h=_a(c,d),k=_a(f,g);if(h){let m=b.get(h);m.delete(e);if(h===k){m.set(i,a);return}else m.size===0&&(Fe(m),b.delete(h))}if(k){let m=b.get(k);m?m.set(i,a):(m=Mk(),m.set(i,a),b.set(k,m))}}function Yg(a,b,c,d){let e=_a(b,c),f=a.get(e);f&&(d!==void 0?(f.delete(d),f.size===0&&(Fe(f),a.delete(e))):(f.clear(),Fe(f),a.delete(e)))}let Jp=new Cc();function Lk(){let a=Jp.pop();return a===null&&(a=new Set()),a}function Xg(a){Jp.push(a)}function Ee(a,b,c,d){if(c===d)return;if(c!==void 0){let e=b.get(c);e&&(e.delete(a),e.size===0&&(Xg(e),b.delete(c)))}if(d!==void 0){let e=b.get(d);e?e.add(a):(e=Lk(),e.add(a),b.set(d,e))}}function lc(a,b,c){let d=a.get(b);d&&(d.delete(c),d.size===0&&(Xg(d),a.delete(b)))}function Fk(a,b,c,d,e){let f=a.chessToXYZ.get(b),g=f?f.x:void 0,i=f?f.y:void 0,h=f?f.y:void 0;f?(f.x=c,f.y=d,f.z=e):a.chessToXYZ.set(b,{x:c,y:d,z:e}),Kk(b,a.XYToZMap,g,i,h,c,d,e),Ee(b,a.XToChessSet,g,c),Ee(b,a.YToChessSet,i,d),Ee(b,a.ZToChessSet,h,e)}function kc(a,b,c,d){let e=a.XYToZMap.get(_a(b,c));return e===void 0?null:d!==void 0?e.has(d)?e.get(d):null:e}function Gk(a,b,c,d){if(d!==void 0){let e=kc(a,b,c,d);if(e===void 0)return;a.chessToXYZ.delete(e),Yg(a.XYToZMap,b,c,d),lc(a.XToChessSet,b,e),lc(a.YToChessSet,c,e),lc(a.ZToChessSet,d,e)}else{let e=kc(a,b,c);if(e){for(const[f,g]of e)a.chessToXYZ.delete(g),lc(a.XToChessSet,b,g),lc(a.YToChessSet,c,g),lc(a.ZToChessSet,f,g);Yg(a.XYToZMap,b,c)}}}function Hk(a,b){return a.chessToXYZ.has(b)}function Ik(a,b,c,d){return kc(a,b,c,d)!==null}function Jk(a,b){return a.chessToXYZ.get(b)||null}function Vg(a){let b=-Infinity;for(const[c,d]of a)b<c&&(b=c);return b}function Wg(a){let b=Infinity;for(const[c,d]of a)b>c&&(b=c);return b}class Gg{constructor(){this.chessToXYZ=new Map(),this.XYToZMap=new Map(),this.XToChessSet=new Map(),this.YToChessSet=new Map(),this.ZToChessSet=new Map(),this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0}destroy(){this.clear()}clear(){return this.chessToXYZ.clear(),this.XYToZMap.clear(),this.XToChessSet.clear(),this.YToChessSet.clear(),this.ZToChessSet.clear(),this.clearBounds(),this}clearBounds(){return this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0,this}addChess(a,b,c,d){return Fk(this,a,b,c,d),this.clearBounds(),this}getChess(a,b,c){return kc(this,a,b,c)}removeChess(a,b,c){return Gk(this,a,b,c),this.clearBounds(),this}hasChess(a){return Hk(this,a)}contains(a,b,c){return Ik(this,a,b,c)}getXYZ(a){return Jk(this,a)}get xMax(){return this._xMax===void 0&&(this._xMax=Vg(this.XToChessSet)),this._xMax}get xMin(){return this._xMin===void 0&&(this._xMin=Wg(this.XToChessSet)),this._xMin}get yMax(){return this._yMax===void 0&&(this._yMax=Vg(this.YToChessSet)),this._yMax}get yMin(){return this._yMin===void 0&&(this._yMin=Wg(this.YToChessSet)),this._yMin}}function lb(a,b=[]){let c=a.boardData.chessToXYZ;for(const[d,e]of c)b.push(d);return b}function Ue(a){if(typeof a!=="object"||a.nodeType||a===a.window)return!1;try{if(a.constructor&&!{}.hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0}function qd(a){return Ue(a)?!0:typeof a==="object"?a.isTileXYZ:!1}function ea(a,b){let c=a.boardData.getXYZ(b);return c?c:qd(b)?b:null}function sa(a,b,c,d){return a.boardData.getChess(b,c,d)}class Nk{constructor(a){this.parent=a,this.board=null,this.blocker=!1,this.boot()}boot(){typeof this.parent==="object"&&this.parent.on&&this.parent.on("destroy",this.destroy,this)}destroy(){if(this.board){let a=this.tileXYZ;this.board.boardData.removeChess(a.x,a.y,a.z)}this.parent=void 0,this.board=null}setBoard(a){return this.board=a,this}get tileXYZ(){return this.board==null?null:this.board.boardData.getXYZ(this.parent)}setBlocker(a=!0){return this.blocker=a,this}setBlockEdge(a,b=!0){typeof this.blocker==="boolean"&&(this.blocker={});let c=this.blocker;if(typeof a==="object"){let d=a;for(let e in d)c[e]=d[e]}else c[a]=b;return this}getBlockEdge(a){return typeof this.blocker==="boolean"?!1:this.blocker.hasOwnProperty(a)?this.blocker[a]:!1}}function cb(a){return a.hasOwnProperty("rexChess")||(a.rexChess=new Nk(a)),a.rexChess}function Ua(a,b,c,d,e,f=!1,g=!1){if(b){let i=ea(a,b);if(i)c=i.x,d=i.y,e=i.z;else return}else{b=sa(a,c,d,e);if(!b)return}g||a.boardData.removeChess(c,d,e),a._isBoard&&cb(b).setBoard(null),f&&b.destroy&&b.destroy()}function jc(a,b){if(a.infinityMode)return;if(a.height===void 0||a.height<=b){a.height=b;return}let c=lb(a);c.forEach(d=>{let e=ea(a,d);e.y>b&&Ua(a,d)}),a.height=b}function ic(a,b){if(a.infinityMode)return;if(a.width===void 0||a.width<=b){a.width=b;return}let c=lb(a);c.forEach(d=>{let e=ea(a,d);e.x>b&&Ua(a,d)}),a.width=b}class ne{constructor({grid:a=void 0,wrap:b=!1,inifinity:c=!1,width:d=0,height:e=0}={}){this.boardData=new Gg(),this._isBoard=!0,this.setGrid(a),this.setWrapMode(b),this.setInfinityMode(c),this.setBoardSize(d,e)}destroy(){}setGrid(a){return this.grid=a,this}setWrapMode(a=!0){return this.wrapMode=a,this}setInfinityMode(a=!0){return this.infinityMode=a,this}setBoardSize(a=0,b=0){return ic(this,a),jc(this,b),this}}function bb(a,b,c,d){let e;return a.infinityMode?e=!0:e=b>=0&&b<a.width&&c>=0&&c<a.height,e&&d!==void 0&&(e=a.boardData.contains(b,c,d)),e}function Ja(a,b,c,d){return a.grid.getWorldXY(b,c,d)}function Pc(a,b,c,d){if(b===void 0){let e=lb(a);for(let f=0,g=e.length;f<g;f++){let i=e[f],h=ea(a,i);Ja(a,h.x,h.y,i)}}else{if(c===void 0){let e=ea(a,b);c=e.x,d=e.y}Ja(a,c,d,b)}}function Lb(a,b,c,d,e,f=!0){if(!bb(a,c,d))return;let g=ea(a,b);e===void 0&&(g?e=g.z:e=0);if(g&&g.x===c&&g.y===d&&g.z===e)return;let i=sa(a,c,d,e);i&&(Ua(a,null,c,d,e),console.warn(`Chess at (${c},${d},${e}) has been removed because of overlapped`)),a.boardData.addChess(b,c,d,e),a._isBoard&&cb(b).setBoard(a),f&&Pc(a,b,c,d)}function pc(a,b,c,d){return Math.atan2(d-b,c-a)}function Mb(a,b,c){let d=ea(a,b),e=ea(a,c),f=Ja(a,d.x,d.y,!0),g=f.x,i=f.y;f=Ja(a,e.x,e.y,!0);let h=f.x,k=f.y;return pc(g,i,h,k)}function Cb(a,b,c){let d=c-b;return b+((a-b)%d+d)%d}function Oc(a,b,c,d={x:0,y:0}){return d===!0&&(d=mq),a.wrapMode?b=Cb(b,0,a.width):!a.infinityMode&&(b<0||b>=a.width)&&(b=null),a.wrapMode?c=Cb(c,0,a.height):!a.infinityMode&&(c<0||c>=a.height)&&(c=null),d.x=b,d.y=c,d}let mq={x:0,y:0};function Ta(a,b,c,d,e){let f=ea(a,b);if(f===null)return null;typeof c==="string"&&(c.indexOf(",")===-1?c=parseInt(c):c=c.split(".").map(k=>parseInt(k,10)));let g=typeof c==="number",i=typeof d==="number";if(g&&i){let k=a.grid.getTileXYAtDirection(f,c,d,e);return Oc(a,k.x,k.y,k),(k.x===null||k.y===null)&&(k=null),k}Array.isArray(e)||(e=[]),c===null&&(c=a.grid.allDirections);let h;if(g)if(Array.isArray(d))for(let k=0,m=d.length;k<m;k++)h=Ta(a,f,c,d[k]),h!==null&&e.push(h);else{let k,m,o;({end:k=1,start:m=k>0?1:-1,step:o=k>=m?1:-1}=d);if(m===k)h=Ta(a,f,c,k),h!==null&&e.push(h);else if(m<k)for(let s=m;s<=k;s+=o)h=Ta(a,f,c,s),h!==null&&e.push(h);else for(let s=m;s>=k;s+=o)h=Ta(a,f,c,s),h!==null&&e.push(h)}else for(let k=0,m=c.length;k<m;k++)i?(h=Ta(a,f,c[k],d),h!==null&&e.push(h)):Ta(a,f,c[k],d,e);return e}function pb(a,b,c=null,d={x:0,y:0}){return Ta(a,b,c,1,d)}function Lc(a,b,c){b===void 0&&(b=qq);let d=a.wrapMode,e=a.infinityMode;a.wrapMode=!1,a.infinityMode=!0;let f=pb(a,b,c,!0);return a.wrapMode=d,a.infinityMode=e,Mb(a,b,f)}let qq={x:0,y:0};const As=180/Math.PI;function Sc(a){return a*As}function Rk(a,b){let c=b-a;if(c===0)return 0;let d=Math.floor((c- -180)/360);return c-d*360}function Kc(a,b,c){c=Sc(c);let d=a.grid.allDirections,e=Infinity,f;for(let g=0,i=d.length;g<i;g++){let h=Sc(Lc(a,b,d[g])),k=Math.abs(Rk(c,h));k<e&&(e=k,f=g)}return f}function Nc(a,b,c){if(b===null||c===null)return null;if(b.x===c.x&&b.y===c.y)return null;let d=a.grid.getNeighborTileDirection(b,c);if(a.wrapMode&&d===null){let e=pb(a,b,null);for(let f=0,g=e.length;f<g;f++){let i=e[f];if(c.x===i.x&&c.y===i.y){d=f;break}}}return d}function Mc(a,b,c){let d=ea(a,b),e=ea(a,c);return Nc(a,d,e)}function pe(a,b,c){return Mc(a,b,c)!==null}function qe(a,b,c,d=!0){let e=ea(a,b),f=ea(a,c);return e===null||f===null?null:a.grid.directionBetween(e,f,d)}function nd(a,b,c=1,d=[]){let e=a.grid.ringToTileXYArray(b,c);for(let f=0,g=e.length;f<g;f++){let i=e[f];bb(a,i.x,i.y)&&d.push(i)}return d}function Hg(a,b,c,d=!0,e=[]){for(let f=0;f<=c;f++){let g=d?f:c-f;nd(a,b,g,e)}return e}function mb(a,b,c,d,e={x:0,y:0}){return e===!0&&(e=oq),c===0&&d===0?(e.x=b.x,e.y=b.y):a.grid.offset(b,c,d,e),e}let oq={x:0,y:0};function Ig(a,b){let c=Infinity,d=Infinity,e;for(let i=0,h=b.length;i<h;i++)e=b[i],c=Math.min(c,e.x),d=Math.min(d,e.y);if(c!==0||d!==0)for(let i=0,h=b.length;i<h;i++)e=b[i],mb(a,e,-c,-d,e);let f=-Infinity,g=-Infinity;for(let i=0,h=b.length;i<h;i++)e=b[i],f=Math.max(f,e.x),g=Math.max(g,e.y);return ic(a,f+1),jc(a,g+1),b}var nc;(function(a){a[a["x+,y+"]=0]="x+,y+",a[a["x-,y+"]=1]="x-,y+",a[a["y+,x+"]=2]="y+,x+",a[a["y-,x+"]=3]="y-,x+"})(nc||(nc={}));function re(a,b,c,d=0){let e={x:0,y:0};switch(d){case 0:for(let f=0;f<a.height;f++)for(let g=0;g<a.width;g++)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 1:for(let f=0;f<a.height;f++)for(let g=a.width-1;g>=0;g--)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 2:for(let f=0;f<a.width;f++)for(let g=0;g<a.height;g++)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a);break;case 3:for(let f=0;f<a.width;f++)for(let g=a.height-1;g>=0;g--)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a)}}function se(a,b,c,d){return a.grid.getDistance(b,c,d)}function md(a,b=0,c=[]){if(Array.isArray(b)){let d=b;for(let e=0;e<a.height;e++)for(let f=0;f<a.width;f++){let g=!0;for(let i=0,h=d.length;i<h;i++)if(sa(a,f,e,d[i])!==null){g=!1;break}g&&c.push({x:f,y:e})}}else for(let d=0;d<a.height;d++)for(let e=0;e<a.width;e++)sa(a,e,d,b)===null&&c.push({x:e,y:d});return c}function te(a,b,c,d){return a.grid.getGridPoints(b,c,d)}function Va(a,b,c,d=[]){let e=a.boardData.getChess(b,c);for(const[f,g]of e)d.push(g);return d}function Qc(a,b,c,d=[]){let e=c!=null,f,g;for(let i=0,h=b.length;i<h;i++)f=b[i],e?(g=sa(a,f.x,f.y,c),g!==null&&d.push(g)):Va(a,f.x,f.y,d);return d}function ue(a,b,c,d,e){let f=ea(a,b);if(f===null)return null;d==null&&(d=f.hasOwnProperty("z")?f.z:null);let g=pb(a,f,c,!0);return g===null?null:Array.isArray(g)?(e===void 0&&(e=[]),Qc(a,g,d,e)):d==null?(e===void 0&&(e=[]),Va(a,g.x,g.y,e)):sa(a,g.x,g.y,d)}function ve(a,b,c,d={x:0,y:0}){let e=Kc(a,b,c);return Ta(a,b,e,1,d)}function we(a,b,c,d){return a.grid.getOppositeDirection(b,c,d)}function od(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function Rc(a,b=0,c=a.length){let d=b+Math.floor(Math.random()*c);return a[d]===void 0?null:a[d]}function Jg(a,b=0,c={x:0,y:0}){c===!0&&(c=jq);let d=Math.floor(a.width*a.height*.3);for(let f=0;f<d;f++){let g=od(0,a.width-1),i=od(0,a.height-1);if(sa(a,g,i,b)===null)return c.x=g,c.y=i,c}let e=md(a,b);if(e.length===0)return null;{let f=Rc(e);return c.x=f.x,c.y=f.y,c}}let jq={x:0,y:0};function Kg(a,b,c,d){if(d===void 0){let e=Va(a,b,c);for(let f=0,g=e.length;f<g;f++){let i=cb(e[f]).blocker;if(i===!0)return!0}return!1}else{let e=sa(a,b,c,d);if(e===null)return!1;let f=cb(e).blocker;return f===!0}}function Lg(a,b){return a.boardData.chessToXYZ.has(b)}function Mg(a,b,c,d,e){if(d===void 0){let f=Va(a,b,c);for(let g=0,i=f.length;g<i;g++)if(Ek(cb(f[g]).blocker,e))return!0;return!1}else{let f=sa(a,b,c,d);return f===null?!1:Ek(cb(f).blocker,e)}}function Ek(a,b){return a===!1||a===!0?a:a[b]===!0}function _g(a){return a=a%Ep,a>=0?a:a+Ep}const Ep=Math.PI*2;function Sk(a,b,c=1e-4){return Math.abs(a-b)<c}function xe(a,b,c,d,e){let f=ea(a,b),g=ea(a,c),i=Mb(a,f,g);i=_g(i);let h=Math.abs(i-d);h=Math.min(h,rq-h);let k=e/2;return Sk(h,k)||h<k}const rq=Math.PI*2;function ye(a,b,c,d,e){let f=ea(a,b),g=ea(a,c),i=a.grid.directions;a.grid.directions=a.grid.sides;let h=a.grid.directionBetween(f,g,!1);a.grid.directions=i;let k=Math.abs(h-d);return k=Math.min(k,a.grid.directions-k),k<=e/2}function Pa(a,b,c,d={x:0,y:0}){return a.grid.getTileXY(b,c,d)}function ze(a,b,c,d){if(a.infinityMode&&d===void 0)return!0;let e=Pa(a,b,c,!0);return bb(a,e.x,e.y,d)}function Qk(a,b,c,d){let e=a-c,f=b-d;return Math.sqrt(e*e+f*f)}function Zg(a,b,c){return(b-a)*c+a}function Ng(a,b,c,d,e,f=[]){let g=Qk(b,c,d,e),i=Math.min(a.grid.width,a.grid.height),h=Math.ceil(g/(i/4)),k;for(let m=0;m<=h;m++){let o=m/h,s=Zg(b,d,o),u=Zg(c,e,o),v=Pa(a,s,u);if(!bb(a,v.x,v.y))continue;if(k&&k.x===v.x&&k.y===v.y)continue;f.push(v),k=v}return f}var oc;(function(a){a[a.x=1]="x",a[a.horizontal=1]="horizontal",a[a.h=1]="h",a[a.y=2]="y",a[a.vertical=2]="vertical",a[a.v=2]="v",a[a.xy=3]="xy"})(oc||(oc={}));function Og(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=nq),d!==null?mb(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.mirror(e,c,e),d!==null&&mb(a,e,d.x,d.y,e),e}let nq={x:0,y:0};function Pg(a,b=!1,c=!1){let d=lb(a);for(let e=0,f=d.length;e<f;e++)Ua(a,d[e],void 0,void 0,void 0,b,c)}function Qg(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=pq),d!==null?mb(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.rotate(e,c,e),d!==null&&mb(a,e,d.x,d.y,e),e}let pq={x:0,y:0};function Rg(a,b,c){let d=ea(a,b);if(d===null)return;Lb(a,b,d.x,d.y,c)}function pd(a,b,c){return Math.max(b,Math.min(c,a))}function Sg(a,b,c,d=[]){let e=Pa(a,b.left,b.top,!0),f=e.x-1,g=e.y-1,i=Pa(a,b.right,b.bottom,!0),h=i.x+1,k=i.y+1;a.infinityMode||(f=pd(f,0,a.width-1),g=pd(g,0,a.height-1),h=pd(h,0,a.width-1),k=pd(k,0,a.height-1));for(let m=f;m<=h;m++)for(let o=g;o<=k;o++){let s=Ja(a,m,o,!0);c(b,s.x,s.y)&&d.push({x:m,y:o})}return d}function Tg(a,b,c,d=!0){let e=ea(a,b),f=ea(a,c);if(e==null||f==null)return;Ua(a,b),Ua(a,c),Lb(a,b,f.x,f.y,f.z,d),Lb(a,c,e.x,e.y,e.z,d)}function Ae(a,b,c=[]){let d=a.boardData.ZToChessSet.get(b);if(d)for(const e of d)c.push(e);return c}function Be(a,b,c=[]){for(let d=0,e=b.length;d<e;d++){let f=b[d];c.push(Ja(a,f.x,f.y))}return c}function Ce(a,b,c,d={x:0,y:0}){return d===!0&&(d=sq),Pa(a,b,c,d),Ja(a,d.x,d.y,d),d}let sq={x:0,y:0};function De(a,b,c,d,e){let f=Pa(a,b,c,!0);return d!==void 0?sa(a,f.x,f.y,d):Va(a,f.x,f.y,e)}class oe extends ne{addChess(a,b,c,d,e=!0){return Lb(this,a,b,c,d,e),this}angleBetween(a,b){return Mb(this,a,b)}angleSnapToDirection(a,b){return Kc(this,a,b)}angleToward(a,b){return Lc(this,a,b)}areNeighbors(a,b){return pe(this,a,b)}chessToTileXYZ(a){return ea(this,a)}contains(a,b,c){return bb(this,a,b,c)}directionBetween(a,b,c=!0){return qe(this,a,b,c)}filledRingToTileXYArray(a,b,c=!0,d=[]){return Hg(this,a,b,c,d)}fit(a){return Ig(this,a)}forEachTileXY(a,b,c=0){return re(this,a,b,c),this}getAllChess(a=[]){return lb(this,a)}getChessData(a){return cb(a)}getDistance(a,b,c=!1){return se(this,a,b,c)}getEmptyTileXYArray(a=0,b=[]){return md(this,a,b)}getGridPoints(a,b,c){return te(this,a,b,c)}getNeighborChess(a,b,c,d){return ue(this,a,b,c,d)}getNeighborChessDirection(a,b){return Mc(this,a,b)}getNeighborTileDirection(a,b){return Nc(this,a,b)}getNeighborTileXY(a,b=null,c={x:0,y:0}){return pb(this,a,b,c)}getNeighborTileXYAtAngle(a,b,c={x:0,y:0}){return ve(this,a,b,c)}getOppositeDirection(a,b,c){return we(this,a,b,c)}getRandomEmptyTileXY(a=0,b={x:0,y:0}){return Jg(this,a,b)}getTileXYAtDirection(a,b,c,d){return Ta(this,a,b,c,d)}getWrapTileXY(a,b,c={x:0,y:0}){return Oc(this,a,b,c)}gridAlign(a,b,c){return Pc(this,a,b,c),this}hasBlocker(a,b,c){return Kg(this,a,b,c)}hasChess(a){return Lg(this,a)}hasEdgeBlocker(a,b,c,d){return Mg(this,a,b,c,d)}isAngleInCone(a,b,c,d){return xe(this,a,b,c,d)}isDirectionInCone(a,b,c,d){return ye(this,a,b,c,d)}isOverlappingPoint(a,b,c){return ze(this,a,b,c)}lineToTileXYArray(a,b,c,d,e=[]){return Ng(this,a,b,c,d,e)}mirror(a,b,c=null,d={x:0,y:0}){return Og(this,a,b,c,d)}offset(a,b,c,d){return mb(this,a,b,c,d)}removeAllChess(a=!1,b=!1){return Pg(this,a,b),this}removeChess(a,b,c,d,e=!1,f=!1){return Ua(this,a,b,c,d,e,f),this}ringToTileXYArray(a,b=1,c=[]){return nd(this,a,b,c)}rotate(a,b,c=null,d={x:0,y:0}){return Qg(this,a,b,c,d)}setBoardWidth(a=0){return ic(this,a),this}setBoardHeight(a=0){return jc(this,a),this}setTileZ(a,b){return Rg(this,a,b),this}shapeToTileXYArray(a,b,c=[]){return Sg(this,a,b,c)}swapChess(a,b,c=!0){return Tg(this,a,b,c),this}tileXYArrayToChessArray(a,b,c=[]){return Qc(this,a,b,c)}tileXYToChessArray(a,b,c=[]){return Va(this,a,b,c)}tileXYZToChess(a,b,c){return sa(this,a,b,c)}tileZToChessArray(a,b=[]){return Ae(this,a,b)}tileXYArrayToWorldXYArray(a,b=[]){return Be(this,a,b)}tileXYToWorldXY(a,b,c={x:0,y:0}){return Ja(this,a,b,c)}worldXYSnapToGrid(a,b,c={x:0,y:0}){return Ce(this,a,b,c)}worldXYToChess(a,b,c,d){return De(this,a,b,c,d)}worldXYToTileXY(a,b,c){return Pa(this,a,b,c)}}class Dk extends oe{}const db={};Fc(db,{ChessToTileXYZ:()=>ea,Contains:()=>bb,DirectionBetween:()=>qe,ForEachTileXY:()=>re,GetDistance:()=>se,GetOppositeDirection:()=>we,GetTileXYAtDirection:()=>Ta,GetWrapTileXY:()=>Oc,IsDirectionInCone:()=>ye,TileXYArrayToChessArray:()=>Qc,TileXYToChessArray:()=>Va,TileXYZToChess:()=>sa,TileZToChessArray:()=>Ae});const Nb={};Fc(Nb,{AngleBetween:()=>Mb,AngleSnapToDirection:()=>Kc,AngleToward:()=>Lc,GetGridPoints:()=>te,GridAlign:()=>Pc,IsAngleInCone:()=>xe,IsOverlappingPoint:()=>ze,TileXYArrayToWorldXYArray:()=>Be,TileXYToWorldXY:()=>Ja,WorldXYSnapToGrid:()=>Ce,WorldXYToChess:()=>De,WorldXYToTileXY:()=>Pa});const mc={};Fc(mc,{AreNeighbors:()=>pe,GetNeighborChess:()=>ue,GetNeighborChessDirection:()=>Mc,GetNeighborTileDirection:()=>Nc,GetNeighborTileXY:()=>pb,GetNeighborTileXYAtAngle:()=>ve});var qa;(function(a){a[a.orthogonal=0]="orthogonal",a[a.isometric=1]="isometric"})(qa||(qa={}));var Db;(function(a){a[a["4dir"]=4]="4dir",a[a["8dir"]=8]="8dir"})(Db||(Db={}));class yl{constructor({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=qa.orthogonal,dir:f=Db["4dir"]}={}){this.setOriginPosition(a,b),this.setCellSize(c,d),this.setType(e),this.setDirectionMode(f)}fromJSON({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=qa.orthogonal,dir:f=Db["4dir"]}={}){return this.setType(e),this.setDirectionMode(f),this.setOriginPosition(a,b),this.setCellSize(c,d),this}toJSON(){return{x:this.x,y:this.y,cellWidth:this.cellWidth,cellHeight:this.cellHeight,type:this.mode,dir:this.directions}}setOriginPosition(a=0,b=0){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setType(a=qa.orthogonal){return typeof a==="string"&&(a=qa[a]),this.mode=a,this}setDirectionMode(a=Db["4dir"]){return typeof a==="string"&&(a=Db[a]),this.directions=a,this}}function ql(a,b,c,d=!0){let e;switch(a.mode){case qa.orthogonal:case qa.isometric:if(b.y===c.y)e=c.x>=b.x?0:2;else if(b.x===c.x)e=c.y>=b.y?1:3;else if(a.directions===Db["4dir"]){let f=Sc(pc(b.x,b.y,c.x,c.y));f<0&&(f+=360),e=f/90,d&&(e=Math.round(e))}else{let f=c.x-b.x,g=c.y-b.y;if(f===g)e=f>0?4:6;else if(f===-g)e=f>0?7:5;else{let i=Sc(Math.atan2(g,f));i<0&&(i+=360);let h=i/45;d&&(h=Math.round(h)),h>=0&&h<1?e=h:h>=1&&h<2?e=h+3:h>=2&&h<3?e=h-1:h>=3&&h<4?e=h+2:h>=4&&h<5?e=h-2:h>=5&&h<6?e=h+1:h>=6&&h<7?e=h-3:e=h}}break}return e===a.directions&&(e=0),e}function Pe(a,b){return Cb(b,0,a.directions)}function rl(a,b,c,d=!1){let e=c.x-b.x,f=c.y-b.y,g;return d?g=Math.abs(e)+Math.abs(f):g=Math.sqrt(e*e+f*f),g}function Le(a,b=[]){if(!(b.length===a))if(b.length<a)for(let c=b.length;c<a;c++)b.push({x:0,y:0});else b.length=a;return b}function Se(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Nq);let e,f;switch(a.mode){case qa.orthogonal:e=b*a.width,f=c*a.height;break;case qa.isometric:e=(b-c)*a._halfWidth,f=(b+c)*a._halfHeight;break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let Nq={x:0,y:0};function sl(a,b=0,c=0,d=[]){if(typeof b==="object"){let h=b;c=h.y,b=h.x}d===!0&&(d=Jq),Le(4,d);let e,f;({x:e,y:f}=Se(a,b,c));let g=a._halfWidth,i=a._halfHeight;switch(a.mode){case qa.orthogonal:d[0].x=e+g,d[0].y=f-i,d[1].x=e+g,d[1].y=f+i,d[2].x=e-g,d[2].y=f+i,d[3].x=e-g,d[3].y=f-i;break;case qa.isometric:d[0].x=e+g,d[0].y=f,d[1].x=e,d[1].y=f+i,d[2].x=e-g,d[2].y=f,d[3].x=e,d[3].y=f-i;break}return d}let Jq=[];const Tc=[[1,0],[0,1],[-1,0],[0,-1],[1,1],[-1,1],[-1,-1],[1,-1]],rd=Tc;function nl(a){let b={},c,d,e;for(let f in a)c=a[f],d=c[0],e=c[1],b.hasOwnProperty(d)||(b[d]={}),b[d][e]=parseInt(f);return b}const ol=nl(Tc),pl=nl(rd);function tl(a,b,c){let d;switch(a.mode){case qa.orthogonal:d=ol;break;case qa.isometric:d=pl;break}let e=c.x-b.x,f=c.y-b.y;if(d.hasOwnProperty(e)){let g=d[e];if(g.hasOwnProperty(f))return g[f]}return null}function Te(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Mq);let f,g;switch(a.mode){case qa.orthogonal:f=Tc[c][0],g=Tc[c][1];break;case qa.isometric:f=rd[c][0],g=rd[c][1];break}return d===1?(e.x=b.x+f,e.y=b.y+g):(e.x=b.x+d*f,e.y=b.y+d*g),e}let Mq={x:0,y:0};function ul(a,b,c,d={x:0,y:0}){return Te(a,b,c,1,d)}function vl(a,b,c,d){return Kq[d]}const Kq={0:2,1:3,2:0,3:1,4:6,5:7,6:4,7:5};function wl(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Lq),b-=a.x,c-=a.y;let e=b/a.width,f=c/a.height;switch(a.mode){case qa.orthogonal:d.x=Math.round(e),d.y=Math.round(f);break;case qa.isometric:d.x=Math.round(+e+f),d.y=Math.round(-e+f);break}return d}let Lq={x:0,y:0};function xl(a,b,c,d={x:0,y:0}){return typeof c==="string"&&(c=oc[c]),d===!0&&(d=Oq),d.x=c&1?-b.x:b.x,d.y=c&2?-b.y:b.y,d}let Oq={x:0,y:0};function qc(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Pq);let f=b.x+c,g=b.y+d;return e.x=f,e.y=g,e}let Pq={x:0,y:0};function zl(a,b,c,d=[]){let e,f;for(e=c,f=-c;f<=c;f++)d.push(qc(a,b,e,f));for(f=c,e=c-1;e>=-c;e--)d.push(qc(a,b,e,f));for(e=-c,f=c-1;f>=-c;f--)d.push(qc(a,b,e,f));for(f=-c,e=-c+1;e<=c-1;e++)d.push(qc(a,b,e,f));return d}function Al(a,b,c,d={x:0,y:0}){d===!0&&(d=Uq),c=Cb(c,0,3);let e,f;switch(c){case 1:e=-b.y,f=b.x;break;case 2:e=-b.x,f=-b.y;break;case 3:e=b.y,f=-b.x;break;default:e=b.x,f=b.y;break}return d.x=e,d.y=f,d}let Uq={x:0,y:0};function Qe(a){a._savedOriginX=a.x,a._savedOriginY=a.y}function Re(a){a.x=a._savedOriginX,a.y=a._savedOriginY}class ml extends yl{get sides(){return 4}get allDirections(){return this.directions===4?Qq:Rq}get halfDirections(){return this.directions===4?Sq:Tq}directionBetween(a,b,c=!0){return ql(this,a,b,c)}directionNormalize(a){return Pe(this,a)}getDistance(a,b,c=!1){return rl(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return sl(this,a,b,c)}getNeighborTileDirection(a,b){return tl(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return ul(this,a,b,c)}getOppositeDirection(a,b,c){return vl(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return wl(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return Te(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return Se(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return xl(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return qc(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return zl(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return Al(this,a,b,c)}restoreOrigin(){return Re(this),this}saveOrigin(){return Qe(this),this}}const Qq=[0,1,2,3],Rq=[0,1,2,3,4,5,6,7],Sq=[0,1],Tq=[0,1,4,5];var fa;(function(a){a[a.ODD_R=0]="ODD_R",a[a.EVEN_R=1]="EVEN_R",a[a.ODD_Q=2]="ODD_Q",a[a.EVEN_Q=3]="EVEN_Q"})(fa||(fa={}));var nb;(function(a){a[a.y=0]="y",a[a.flat=0]="flat",a[a.x=1]="x",a[a.pointy=1]="pointy"})(nb||(nb={}));var Qb;(function(a){a[a.even=0]="even",a[a.odd=1]="odd"})(Qb||(Qb={}));class fl{constructor({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=nb.x,staggerIndex:g=Qb.odd}={}){this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e)}fromJSON({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=nb.x,staggerIndex:g=Qb.odd}={}){return this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e),this}toJSON(){return{x:this.x,y:this.y,radius:this.radius,cellWidth:this.cellWidth,cellHeight:this.cellHeight,staggerAxis:this.staggerAxis,staggerIndex:this.staggerIndex}}setOriginPosition(a,b){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this.radius=void 0,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setRadius(a=0){let b,c;return this.staggerAxis===nb.y?(b=2*a,c=ll*a):(b=ll*a,c=2*a),this.setCellSize(b,c),this.radius=a,this}setDirectionMode(){return this.directions=6,this}setType(a=1,b=1){return typeof a==="string"&&(a=nb[a]),typeof b==="string"&&(b=Qb[b]),this.staggerAxis=a,this.staggerIndex=b,a===nb.y?this.mode=b===Qb.even?fa.EVEN_Q:fa.ODD_Q:this.mode=b===Qb.even?fa.EVEN_R:fa.ODD_R,this}}const ll=Math.sqrt(3);function Wa(a,b,c,d={x:0,y:0,z:0}){d===!0&&(d=$g);switch(a){case fa.ODD_R:d.x=b-(c-(c&1))/2,d.z=c;break;case fa.EVEN_R:d.x=b-(c+(c&1))/2,d.z=c;break;case fa.ODD_Q:d.x=b,d.z=c-(b-(b&1))/2;break;case fa.EVEN_Q:d.x=b,d.z=c-(b+(b&1))/2;break}return d.y=-d.x-d.z,d}function Vk(a,b,c,d={x:0,y:0,z:0}){typeof a!=="number"&&(d=a,a=d.x,b=d.y,c=d.z),d===!0&&(d=$g);let e=Math.round(a),f=Math.round(b),g=Math.round(c),i=Math.abs(e-a),h=Math.abs(f-b),k=Math.abs(g-c);return i>h&&i>k?e=-f-g:h>k?f=-e-g:g=-e-f,d.x=e,d.y=f,d.z=g,d}function Ga(a,b,c,d,e={x:0,y:0}){e===!0&&(e=uq);switch(a){case fa.ODD_R:e.x=b+(d-(d&1))/2,e.y=d;break;case fa.EVEN_R:e.x=b+(d+(d&1))/2,e.y=d;break;case fa.ODD_Q:e.x=b,e.y=d+(b-(b&1))/2;break;case fa.EVEN_Q:e.x=b,e.y=d+(b+(b&1))/2;break}return e}function Wk(a,b,c={x:0,y:0,z:0}){return c===!0&&(c=$g),c.x=a,c.y=-a-b,c.z=b,c}let $g={x:0,y:0,z:0},uq={x:0,y:0};function Yk(a,b,c,d=!0){let e;Wa(a.mode,b.x,b.y,He),Wa(a.mode,c.x,c.y,Ie);let f=Ie.x-He.x,g=Ie.y-He.y,i=Ie.z-He.z;return i===0?e=f>0?0:3:f===0?e=i>0?1:4:g===0?e=i>0?2:5:f>0&&g<0&&i>0?e=0+i/-g:f<0&&g<0&&i>0?e=1+-g/i:f<0&&g>0&&i>0?e=2+g/-f:f<0&&g>0&&i<0?e=3+-i/g:f>0&&g>0&&i<0?e=4+f/-i:e=5+-g/f,d&&(e=Math.round(e)),e}let He={x:0,y:0,z:0},Ie={x:0,y:0,z:0};function Zk(a,b,c,d=!1){Wa(a.mode,b.x,b.y,Je),Wa(a.mode,c.x,c.y,Ke);let e=Ke.x-Je.x,f=Ke.y-Je.y,g=Ke.z-Je.z;return(Math.abs(e)+Math.abs(f)+Math.abs(g))/2}let Je={x:0,y:0,z:0},Ke={x:0,y:0,z:0};function Me(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Dq);let e=b*a.width,f=c*a.height;switch(a.mode){case fa.ODD_R:c&1&&(e+=a._halfWidth),f*=.75;break;case fa.EVEN_R:c&1&&(e-=a._halfWidth),f*=.75;break;case fa.ODD_Q:e*=.75,b&1&&(f+=a._halfHeight);break;case fa.EVEN_Q:e*=.75,b&1&&(f-=a._halfHeight);break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let Dq={x:0,y:0};function _k(a,b=0,c=0,d=[]){if(typeof b==="object"){let g=b;c=g.y,b=g.x}d===!0&&(d=zq),Le(6,d);let e,f;({x:e,y:f}=Me(a,b,c));if(a.radius!==void 0){let g=a.radius,i=a.staggerAxis===nb.flat?0:-30;for(let h=0;h<6;h++){let k=60*h+i,m=Ob(k);d[h].x=e+g*Math.cos(m),d[h].y=f+g*Math.sin(m)}}else{let g=a._halfWidth,i=g/2,h=a._halfHeight,k=h/2;a.staggerAxis===nb.flat?(d[0].x=e+g,d[0].y=f,d[1].x=e+i,d[1].y=f+h,d[2].x=e-i,d[2].y=f+h,d[3].x=e-g,d[3].y=f,d[4].x=e-i,d[4].y=f-h,d[5].x=e+i,d[5].y=f-h):(d[0].x=e+g,d[0].y=f-k,d[1].x=e+g,d[1].y=f+k,d[2].x=e,d[2].y=f+h,d[3].x=e-g,d[3].y=f+k,d[4].x=e-g,d[4].y=f-k,d[5].x=e,d[5].y=f-h)}return d}let zq=[];const vq=[[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]]],wq=[[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]],[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]]],xq=[[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]],[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]]],yq=[[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]],[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]]],eb=[vq,wq,xq,yq];function Pb(a){let b={},c,d;for(let e in a)[c,d]=a[e],b.hasOwnProperty(c)||(b[c]={}),b[c][d]=parseInt(e);return b}const Xk=[[Pb(eb[0][0]),Pb(eb[0][1])],[Pb(eb[1][0]),Pb(eb[1][1])],[Pb(eb[2][0]),Pb(eb[2][1])],[Pb(eb[3][0]),Pb(eb[3][1])]];function Ne(a,b,c){let d;switch(a){case fa.ODD_R:case fa.EVEN_R:d=c&1;break;case fa.ODD_Q:case fa.EVEN_Q:d=b&1;break}return d}function $k(a,b,c){let d=a.mode,e=Ne(d,b.x,b.y),f=Xk[d][e],g=c.x-b.x,i=c.y-b.y;if(f.hasOwnProperty(g)){let h=f[g];if(h.hasOwnProperty(i))return h[i]}return null}function Oe(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Cq);let f=a.mode,g=b.x,i=b.y;if(d===1){let h=Ne(f,g,i);e.x=g+eb[f][h][c][0],e.y=i+eb[f][h][c][1]}else if(d===0)e.x=g,e.y=i;else{let h=Wa(f,g,i,!0),k,m,o;switch(c){case 1:k=h.x,m=h.y-d,o=h.z+d;break;case 2:k=h.x-d,m=h.y,o=h.z+d;break;case 3:k=h.x-d,m=h.y+d,o=h.z;break;case 4:k=h.x,m=h.y+d,o=h.z-d;break;case 5:k=h.x+d,m=h.y,o=h.z-d;break;default:k=h.x+d,m=h.y-d,o=h.z;break}Ga(f,k,m,o,e)}return e}let Cq={x:0,y:0};function al(a,b,c,d={x:0,y:0}){return Oe(a,b,c,1,d)}function bl(a,b,c,d){return(d+3)%6}const cl=4/3,dl=2/3;function el(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Bq),b-=a.x,c-=a.y;let e,f;switch(a.mode){case fa.ODD_R:case fa.EVEN_R:f=c*cl/a.height,e=b/a.width-dl*(c/a.height);break;case fa.ODD_Q:case fa.EVEN_Q:f=c/a.height-dl*(b/a.width),e=b*cl/a.width;break}let g=Wk(e,f,Aq);return Vk(g),Ga(a.mode,g.x,g.y,g.z,d),d}let Aq={x:0,y:0,z:0},Bq={x:0,y:0};function gl(a,b,c,d={x:0,y:0}){typeof c==="string"&&(c=oc[c]),d===!0&&(d=Gq);let e=Wa(a.mode,b.x,b.y,!0),f=a.mode===fa.ODD_R||a.mode===fa.EVEN_R,g,i,h;return c&1&&(f?(g=e.y,i=e.x,h=e.z):(g=-e.x,i=-e.z,h=-e.y),e.x=g,e.y=i,e.z=h),c&2&&(f?(g=-e.y,i=-e.x,h=-e.z):(g=e.x,i=e.z,h=e.y)),Ga(a.mode,g,i,h,d),d}let Gq={x:0,y:0};function hl(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Hq);let f=b.x+c,g=b.y+d;switch(a.mode){case fa.ODD_R:(d&1)!==0&&((g&1)===0&&(f+=1));break;case fa.EVEN_R:(d&1)!==0&&((g&1)===0&&(f-=1));break;case fa.ODD_Q:(c&1)!==0&&((f&1)==0&&(g+=1));break;case fa.EVEN_Q:(c&1)!==0&&((f&1)==0&&(g-=1));break}return e.x=f,e.y=g,e}let Hq={x:0,y:0};function il(a,b,c,d=[]){let e=Wa(a.mode,b.x,b.y,!0),f=e.x,g=e.y,i=e.z,h,k,m;for(m=c,h=0;h>=-c;h--)k=-h-m,d.push(Ga(a.mode,f+h,g+k,i+m));for(h=-c,k=1;k<=c;k++)m=-h-k,d.push(Ga(a.mode,f+h,g+k,i+m));for(k=c,m=-1;m>=-c;m--)h=-k-m,d.push(Ga(a.mode,f+h,g+k,i+m));for(m=-c,h=1;h<=c;h++)k=-h-m,d.push(Ga(a.mode,f+h,g+k,i+m));for(h=c,k=-1;k>=-c;k--)m=-h-k,d.push(Ga(a.mode,f+h,g+k,i+m));for(k=-c,m=1;m<=c-1;m++)h=-k-m,d.push(Ga(a.mode,f+h,g+k,i+m));return d}function jl(a,b,c,d={x:0,y:0}){d===!0&&(d=Iq),c=Cb(c,0,5);let e=Wa(a.mode,b.x,b.y,!0),f,g,i;switch(c){case 1:f=-e.z,g=-e.x,i=-e.y;break;case 2:f=e.y,g=e.z,i=e.x;break;case 3:f=-e.x,g=-e.y,i=-e.z;break;case 4:f=e.z,g=e.x,i=e.y;break;case 5:f=-e.y,g=-e.z,i=-e.x;break;default:f=e.x,g=e.y,i=e.z;break}return Ga(a.mode,f,g,i,d),d}let Iq={x:0,y:0};class kl extends fl{get sides(){return 6}get allDirections(){return Eq}get halfDirections(){return Fq}directionBetween(a,b,c=!0){return Yk(this,a,b,c)}directionNormalize(a){return Pe(this,a)}getDistance(a,b,c=!1){return Zk(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return _k(this,a,b,c)}getNeighborTileDirection(a,b){return $k(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return al(this,a,b,c)}getOppositeDirection(a,b,c){return bl(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return el(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return Oe(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return Me(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return gl(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return hl(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return il(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return jl(this,a,b,c)}restoreOrigin(){return Re(this),this}saveOrigin(){return Qe(this),this}}const Eq=[0,1,2,3,4,5],Fq=[0,1,2];var Ca;(function(a){a[a.random=0]="random",a[a.diagonal=1]="diagonal",a[a.straight=2]="straight",a[a.line=3]="line",a[a.astar=10]="astar",a[a["astar-random"]=11]="astar-random",a[a["astar-line"]=12]="astar-line"})(Ca||(Ca={}));const rc=null;class tp{constructor(a){this.content=[],this.scoreFunction=a}clear(){this.content.length=0}push(a){this.content.push(a),this.sinkDown(this.content.length-1)}pop(){let a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.bubbleUp(0)),a}remove(a){let b=this.content.indexOf(a),c=this.content.pop();b!==this.content.length-1&&(this.content[b]=c,this.scoreFunction(c)<this.scoreFunction(a)?this.sinkDown(b):this.bubbleUp(b))}get size(){return this.content.length}rescoreElement(a){this.sinkDown(this.content.indexOf(a))}sinkDown(a){let b=this.content[a];for(;a>0;){let c=(a+1>>1)-1,d=this.content[c];if(this.scoreFunction(b)<this.scoreFunction(d))this.content[c]=b,this.content[a]=d,a=c;else break}}bubbleUp(a){let b=this.content.length,c=this.content[a],d=this.scoreFunction(c);for(;;){let e=a+1<<1,f=e-1,g=null,i;if(f<b){let h=this.content[f];i=this.scoreFunction(h),i<d&&(g=f)}if(e<b){let h=this.content[e],k=this.scoreFunction(h);k<(g===null?d:i)&&(g=e)}if(g!==null)this.content[a]=this.content[g],this.content[g]=c,a=g;else break}}}let Csa=new tp(a=>a.f);const Tf=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d=d.prevNodes[0];return c.reverse()};const wp=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d.prevNodes.length===1?d=d.prevNodes[0]:d=Rc(d.prevNodes);return c.reverse()};const vp=function(a,b,c=[]){let d=b,e=b.angleTo(a);for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1)d=d.prevNodes[0];else{let f=Infinity;for(let g=1,i=d.prevNodes.length;g<i;g++){let h=d.prevNodes[g],k=Math.abs(b.angleTo(h)-e);k<f&&(f=k,d=h)}}}return c.reverse()};const up=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let i=0,h=d.prevNodes.length;i<h;i++){f=d.prevNodes[i],g=f.logicDirTo(d);if(g!==e)break}e=g,d=f}}return c.reverse()};const xp=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let i=0,h=d.prevNodes.length;i<h;i++){f=d.prevNodes[i],g=f.logicDirTo(d);if(g===e)break}e=g,d=f}}return c.reverse()};let Ec={};Ec[Ca.astar]=Tf;Ec[Ca["astar-line"]]=Tf;Ec[Ca["astar-random"]]=Tf;Ec[Ca.random]=wp;Ec[Ca.line]=vp;Ec[Ca.diagonal]=up;Ec[Ca.straight]=xp;class Dl{constructor(){this.prevNodes=[]}shutdown(){this.key=void 0,this.prevNodes.length=0}destroy(){this.shutdown()}reset(a){this.key=a,this.f=0,this.g=0,this.h=void 0,this.closerH=void 0,this.visited=!1,this.closed=!1}heuristic(a,b,c){if(b===null)return 0;let d,e=this.distanceTo(a)*this.manager.weight;switch(b){case Ca.astar:d=e;break;case Ca["astar-line"]:if(c!==void 0){let f=a.angleTo(c)-this.angleTo(c);d=e+Math.abs(f)}else d=e;case Ca["astar-random"]:d=e+Math.random();break;default:d=e;break}return d}getNextNodes(){return[]}getCost(a){return rc}distanceTo(a){return 0}angleTo(a){return 0}logicDirTo(a){return 0}getNode(a,b=!1){return this.manager.getNode(a,b)}}function sc(a){for(let b=a.length-1;b>0;b--){let c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a}class cr extends Dl{constructor(a){super();this.isTileXYZ=!0;this.pathFinder=a}reset(a){super.reset(a),this.key=a,El(a,this),this._px=void 0,this._py=void 0,this.cost=void 0}getNextNodes(){let a=mc.GetNeighborTileXY(this.board,this);this.pathFinder.shuffleNeighbors&&sc(a);let b=[];return a.forEach(c=>{let d=this.getNode(_a(c.x,c.y),!0);b.push(d)}),b}getCost(a){return this.pathFinder.cacheCost?this.cost===void 0&&(this.cost=this.pathFinder.getCost(this,a)):this.cost=this.pathFinder.getCost(this,a),this.cost}distanceTo(a){return db.GetDistance(this.board,this,a,!0)}angleTo(a){return pc(this.worldX,this.wroldY,a.worldX,a.worldX)}logicDirTo(a){return mc.GetNeighborTileDirection(this.board,this,a)}get board(){return this.pathFinder.board}get worldX(){if(this._px===void 0){let a=Nb.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._px}get wroldY(){if(this._py===void 0){let a=Nb.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._py}}class Zq{constructor(){this.data=[];this.visited=new Set()}push(a,b){if(Array.isArray(a)){let d=a;for(let e=0,f=d.length;e<f;e++)this.push(d[e]);return this}if(typeof a==="object"){let d=a;a=d.x,b=d.y}let c=`${a},${b}`;return this.visited.has(c)?this:(this.data.push({x:a,y:b}),this.visited.add(c),this)}pop(){return this.data.pop()}get length(){return this.data.length}clear(){return this.data.length=0,this.visited.clear(),this}}let Y1=new Zq();var Ge;(function(a){a[a.direction=0]="direction",a[a.angle=1]="angle"})(Ge||(Ge={}));function nj(a,b){return a.events.delete(b),a}function mj(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);let e=d.size;for(const f of d){f.callback.apply(f.context,c),f.once&&d.delete(f),e--;if(e===0)break}return d.size===0&&a.events.delete(b),!0}class Rd{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function pj(a){return[...a.events.keys()]}function oj(a,b){const c=a.events.get(b);return c?c.size:0}function qj(a,b){const c=[],d=a.events.get(b);return d.forEach(e=>{c.push(e.callback)}),c}function lj(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof Rd)g.delete(c);else{const i=!d,h=e!==void 0;for(const k of g)k.callback===c&&(i&&k.context===d)&&(h&&k.once===e)&&g.delete(k)}return g.size===0&&f.delete(b),a}function Qd(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new Rd(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function kj(a,b,c,d=a){return Qd(a,b,c,d,!0)}function Vf(a,b){b?a.events.delete(b):a.events.clear()}function Dp(a){return class extends a{constructor(){super(...arguments);this.events=null}setEventEmitter(b){return this.destroyEventEmitter(),this.privateEE=b===void 0,this.privateEE?this.events=new Map():b?this.events=b.events:this.events=null,this.lastEventInstance=null,this}getEventEmitter(){return this}clearEventEmitter(){return this.setEventEmitter(null),this}destroyEventEmitter(){return this.lastEventInstance=null,this.events&&this.privateEE&&(Vf(this),this.events=null),this}on(b,c,d=this,e=!1){return this.lastEventInstance=null,this.events&&(this.lastEventInstance=Qd(this,b,c,d,e)),this}once(b,c,d=this){return this.lastEventInstance=null,this.events&&(this.lastEventInstance=kj(this,b,c,d)),this}off(b,c,d,e){return this.lastEventInstance=null,this.events&&lj(this,b,c,d,e),this}emit(b,...c){return this.lastEventInstance=null,this.events&&mj(this,b,...c),this}removeAllListeners(b){return this.lastEventInstance=null,this.events&&Vf(this,b),this}clearEvent(b){return this.lastEventInstance=null,this.events&&nj(this,b),this}getListenerCount(b){return this.lastEventInstance=null,this.events?oj(this,b):0}getEventNames(){return this.lastEventInstance=null,this.events?pj(this):[]}getListeners(b){return this.lastEventInstance=null,this.events?qj(this,b):[]}}}const xa=Dp(class{});var wb;(function(a){a[a.no=0]="no",a[a.lazy=1]="lazy",a[a.always=2]="always"})(wb||(wb={}));const sj="complete";class Rf extends xa{constructor(a,{eventEmitter:b,tickingMode:c=wb.lazy}={}){super();this._isRunning=!1;this.tickingState=!1;this.parent=a,this.setEventEmitter(b),this.setTickingMode(c)}boot(){this.tickingMode===wb.always&&!this.tickingState&&this.startTicking()}shutdown(){this.destroyEventEmitter(),this.tickingState&&this.stopTicking()}setTickingMode(a){typeof a==="string"&&(a=wb[a]),this.tickingMode=a}startTicking(){this.tickingState=!0}stopTicking(){this.tickingState=!1}get isRunning(){return this._isRunning}set isRunning(a){if(this._isRunning===a)return;this._isRunning=a,this.tickingMode===wb.lazy&&a!=this.tickingState&&(a?this.startTicking():this.stopTicking())}start(){return this.isRunning=!0,this}pause(){return this.isRunning=!1,this}resume(){return this.isRunning=!0,this}stop(){return this.isRunning=!1,this}complete(a=sj){this.isRunning=!1,this.emit(a,this.parent,this)}}class Pf extends Rf{constructor(a,{updater:b=a,isRunning:c=!1,timeScale:d=1,now:e=0,tickingMode:f=wb.lazy}={}){super(a,arguments[1]);this.updater=null;this.timeScale=1;this.now=0;this.parent=a,this.setUpdater(b),this.isRunning=c,this.timeScale=d,this.now=e,this.setTickingMode(f),this.boot()}resetFromJSON({isRunning:a=!1,timeScale:b=1,now:c=0,tickingMode:d=wb.lazy}={}){return this.isRunning=a,this.timeScale=b,this.now=c,this.setTickingMode(d),this}toJSON(){return{isRunning:this.isRunning,timeScale:this.timeScale,now:this.now,tickingMode:this.tickingMode}}boot(){super.boot(),Ra(this.parent,"destroy",this.destroy,this)}shutdown(){super.shutdown(),this.parent=void 0,this.updater=void 0}destroy(){this.shutdown()}setUpdater(a){return a instanceof jb&&(a=a.world),a instanceof Td||a instanceof hc?this.updater=a:this.updater=null,this}startTicking(){this.update===null&&this.setUpdater(this.parent);if(this.update===null)return;super.startTicking(),this.updater&&Ra(this.updater,"update",this.update,this)}stopTicking(){super.stopTicking(),this.updater&&Ab(this.updater,"update",this.update,this)}start(a=0){return this.now=a,super.start(),this}seek(a){return this.now=a,this}update(a){return!this.isRunning||this.timeScale===0?this:(this.now+=a*this.timeScale,this)}}const qua=La(Fg());const ch="receive";const Gl={receive:ch};function Hl(a,b){(!a.sendToRef||a.sendToRef.key!==a.receiverID)&&(a.sendToRef=a.database.ref(a.rootPath).child(a.receiverID));if(b===void 0)return a.sendToRef.remove();let c={message:b,senderID:a.userID,stamp:a.stamp};return a.userName!==void 0&&(c.senderName=a.userName),a.skipFirst=!1,a.stamp=!a.stamp,a.sendToRef.set(c)}function Il(a){if(a.isReceiving&&a.receiverRef.key===a.receiverID)return;bh(a),a.isReceiving=!0,a.skipFirst=!0,a.receiverRef=a.database.ref(a.rootPath).child(a.receiverID),a.receiverRef.on("value",Kl,a),a.receiverRef.onDisconnect().remove()}function bh(a){if(!a.isReceiving)return;a.isReceiving=!1,a.receiverRef.off("value",Kl,a),a.receiverRef.remove(),a.receiverRef.onDisconnect().cancel()}function Kl(a){if(this.skipFirst){this.skipFirst=!1;return}let b=a.val();if(b==null)return;delete b.stamp,this.history.add(b),this.emit(this.eventNames.receive,b)}class Jl{constructor({maxLength:a=-1}={}){this.maxLength=a,this.records=[]}add(a){return this.maxLength===0?this:(this.records.push(a),this.maxLength>0&&this.records.length>this.maxLength&&this.records.shift(),this)}clear(){return this.records.length=0,this}changeUserName(a,b){return this.maxLength===0?this:(this.records.forEach(c=>{c.senderID===a&&(c.senderName=b)}),this)}}const b5=La(Sa());class Vc extends xa{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d,receiverID:e="",history:f=0,eventNames:g=Gl}={}){super();this.setEventEmitter(a),this.eventNames=g,this.database=b5.database(),this.setRootPath(b),this.skipFirst=!0,this.stamp=!1,this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.isReceiving=!1,f===!0?f=-1:f===!1&&(f=0),this.history=new Jl({maxLength:f})}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.sendToRef=void 0,this.receiverRef=void 0,this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.receiverID=a,this}changeUserName(a,b){return a===this.userID&&(this.userName=b),this.history.changeUserName(a,b),this}getHistory(){return this.history.records}clearHistory(){return this.history.clear(),this}send(a){return Hl(this,a)}startReceiving(){return Il(this),this}stopReceiving(){return bh(this),this}}const Cs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function $e(a,b,c=Cs){let d=b===void 0?a:od(a,b),e="";for(let f=0;f<d;f++)e+=Rc(Array.from(c));return e}const nda=La(Sa());var ta;(function(a){a[a["1d"]=1]="1d",a[a["2d"]=2]="2d",a[a["3d"]=3]="3d"})(ta||(ta={}));const jh="init";const kh="update";const dh="addkey0";const eh="addkey1";const fh="addkey2";const lh="removekey0";const mh="removekey1";const nh="removekey2";const gh="changekey0";const hh="changekey1";const ih="changekey2";const Ll={init:jh,update:kh,addkey0:dh,removekey0:lh,changekey0:gh,addkey1:eh,removekey1:mh,changekey1:hh,addkey2:fh,removekey2:nh,changekey2:ih};function Gp(a){return a==null||a===""||a.length===0}function Bs(a,b,c={}){let d=a;if(!Gp(b)){typeof b==="string"&&(b=b.split("."));let e;for(let f=0,g=b.length;f<g;f++){e=b[f];if(d[e]==null||typeof d[e]!=="object"){let i;f===g-1?i=c:i={},d[e]=i}d=d[e]}}return d}function Hp(a,b,c){if(typeof a!=="object")return;if(Gp(b)){if(c==null)return;typeof c==="object"&&(a=c)}else{typeof b==="string"&&(b=b.split("."));let d=b.pop(),e=Bs(a,b);e[d]=c}return a}function Fp(a){return JSON.parse(JSON.stringify(a))}class Ml{constructor(){this.data={}}setValue(a,b){return a==null?this.clear():typeof a==="object"?this.data=a:Hp(this.data,a,b),this}getValue(a){if(a==null)return this.data;{typeof a==="string"&&(a=a.split("."));let b=this.data;for(let c=0,d=a.length;c<d;c++){if(!rj(b))return;b=b[a[c]]}return b}}cloneValue(a){return Fp(this.getValue(a))}removeKey(a){if(a==null)this.clear();else{typeof a==="string"&&(a=a.split("."));let b=a.pop(),c=this.data;for(let d=0,e=a.length;d<e;d++){if(!rj(c))return this;c=c[a[d]]}rj(c)&&delete c[b]}return this}clear(){return Wf(this.data),this}incValue(a,b=1){let c=this.getValue(a);return typeof c!=="number"&&(c=0),this.setValue(a,c+b),this}mulValue(a,b){let c=this.getValue(a);return typeof c!=="number"&&(c=1),this.setValue(a,c*b),this}}function rj(a){return a!=null&&typeof a==="object"}const s6=La(Sa());class tc extends xa{constructor({eventEmitter:a,parent:b,key:c,type:d,eventNames:e,table:f}={}){super();this.setEventEmitter(a),this.parent=b,this.children=new Map(),this.key=c,this.parent?this.fullKeyPath=Wl(this.parent.fullKeyPath,this.key):this.fullKeyPath="",this.type=d,this.eventNames=e,this.table=f,this.database=s6.database(),this.setRootPath()}destroy(){this.stopUpdate().clear().destroyEventEmitter()}setRootPath(a){if(a===void 0){let b=this.parent?this.parent.rootPath:"";a=`${b}/${this.key}`}this.rootPath=a,this.rootRef=a!==""?this.database.ref(a):void 0;for(const[b,c]of this.children)c instanceof tc&&c.setRootPath();return this}setData(a,b){if(arguments.length===0)this.clear();else if(typeof a=="string")this.setChildData(a,b);else{let c=a;for(const[d,e]of this.children)c.hasOwnProperty(d)||this.removeChild(d);for(let d in c)this.setChildData(d,c[d])}return this}clear(){this.table.removeKey(this.fullKeyPath);for(const[a,b]of this.children)this.removeChild(a);return this}get childClass(){return null}setChildData(a,b){const c=Wl(this.fullKeyPath,a);this.table.setValue(c,b);if(!(typeof b!=="object")){if(this.children.has(a))this.children.get(a).setData(b);else if(this.childClass){let d=new this.childClass({parent:this,key:a,type:this.type,eventEmitter:this.eventEmitter,eventNames:this.eventNames,table:this.table});d.startUpdate(),this.children.set(a,d)}}return this}removeChild(a){return this.children.has(a)&&(this.children.get(a).destroy(),this.children.delete(a)),this}startUpdate(){return this}stopUpdate(){return this}}function Wl(a,b){return a==null||a===""?b:b==null||b===""?a:`${a}.${b}`}class sd extends tc{startUpdate(){return this.rootRef.on("child_added",this.addCol,this),this.rootRef.on("child_removed",this.removeCol,this),this.rootRef.on("child_changed",this.changeColValue,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addCol,this),this.rootRef.off("child_removed",this.removeCol,this),this.rootRef.off("child_changed",this.changeColValue,this),this}addCol(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ta["1d"]:this.emit(this.eventNames.addkey0,b,c);break;case ta["2d"]:this.emit(this.eventNames.addkey1,this.key,b,c);break;default:this.emit(this.eventNames.addkey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}removeCol(a){const b=a.key;this.removeChild(b);switch(this.type){case ta["1d"]:this.emit(this.eventNames.removekey0,b);break;case ta["2d"]:this.emit(this.eventNames.removekey1,this.key,b);break;default:this.emit(this.eventNames.removekey2,this.pageKey,this.key,b);break}this.emit(this.eventNames.update,this.table.data)}changeColValue(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ta["1d"]:this.emit(this.eventNames.changekey0,b,c);break;case ta["2d"]:this.emit(this.eventNames.changekey1,this.key,b,c);break;default:this.emit(this.eventNames.changekey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}get pageKey(){return this.parent.key}}class td extends tc{startUpdate(){return this.rootRef.on("child_added",this.addRow,this),this.rootRef.on("child_removed",this.removeRow,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addRow,this),this.rootRef.off("child_removed",this.removeRow,this),this}addRow(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ta["2d"]:this.emit(this.eventNames.addkey0,b,c);break;default:this.emit(this.eventNames.addkey1,this.key,b,c);break}}removeRow(a){const b=a.key;this.removeChild(b);switch(this.type){case ta["2d"]:this.emit(this.eventNames.removekey0,b);break;default:this.emit(this.eventNames.removekey1,this.key,b);break}}get childClass(){return sd}}class oh extends tc{startUpdate(){return this.rootRef.on("child_added",this.addPage,this),this.rootRef.on("child_removed",this.removePage,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addPage,this),this.rootRef.off("child_removed",this.removePage,this),this}addPage(a){const b=a.key,c=a.val();this.setData(b,c),this.emit(this.eventNames.addkey0,b,c)}removePage(a){const b=a.key;this.removeChild(b),this.emit(this.eventNames.removekey0,b)}get childClass(){return td}}const Xe={};Xe[ta["1d"]]=sd;Xe[ta["2d"]]=td;Xe[ta["3d"]]=oh;function Nl(a){return new Xe[a.tableType]({type:a.tableType,eventEmitter:a.eventEmitter,eventNames:a.eventNames,table:a.table})}function Ol(a){return a.updater.clear(),a.initialFlag=!1,a.rootRef.once("value").then(function(b){let c=b.val()??{};return a.table.setValue(c),a.emit(a.eventNames.init,c),a.initialFlag=!0,Promise.resolve(c)})}function Ka(a,b,c,d){let e=a.rootRef;return e=b?e.child(b):e,e=c?e.child(c):e,e=d?e.child(d):e,e}function Pl(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ka(a,c,d,e).set(f)}function Ql(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;default:c=b[0];break}return Ka(a,c,d,e).remove()}function Rl(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ka(a,c,d,e).transaction(function(g){return g===null&&(g=0),g+f})}function Sl(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ka(a,c,d,e).transaction(f)}function Tl(a,b){return Ka(a).update(b)}function Ul(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;case 1:c=b[0];break}return Ka(a,c,d,e).onDisconnect().remove()}function Vl(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ka(a,c,d,e).onDisconnect().set(f)}const v5=La(Sa());class Wc extends xa{constructor({eventEmitter:a,root:b="",type:c=ta["3d"],eventNames:d=Ll}={}){super();this.setEventEmitter(a),this.eventNames=d,this.database=v5.database(),this.table=new Ml(),this.setTableType(c),this.setRootPath(b),this.initialFlag=!1}destroy(){this.updater.destroy(),this.destroyEventEmitter().stopUpdate()}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):null,this.updater.setRootPath(a),this}setTableType(a){return typeof a==="string"&&(a=ta[a]),this.tableType=a,this.updater&&this.updater.destroy(),this.updater=Nl(this),this}startUpdate(){return Ol(this),this.updater.startUpdate(),this}stopUpdate(){return this.updater.stopUpdate(),this}clear(){return this.updater.clear(),this}getData(){return this.table.getValue(...arguments)}cloneData(){return this.table.cloneValue(...arguments)}getItemRef(a,b,c){return Ka(this,a,b,c)}setData(...a){return Pl(this,...a)}removeData(...a){return Ql(this,...a)}incValue(...a){return Rl(this,...a)}transaction(...a){return Sl(this,...a)}updateData(a){return Tl(this,a)}removeDataOnDisconnect(...a){return Ul(this,...a)}setDataOnDisconnect(...a){return Vl(this,...a)}}const xca=La(Sa());var mi;(function(a){a.d="d",a.w="w",a.m="m",a.y="y",a.day="d",a.week="w",a.month="m",a.year="y"})(mi||(mi={}));var Cd;(function(a){a.d="tagD",a.w="tagW",a.m="tagM",a.y="tagY"})(Cd||(Cd={}));var Dd;(function(a){a.d="scoreD",a.w="scoreW",a.m="scoreM",a.y="scoreY"})(Dd||(Dd={}));var bn;(function(a){a.d="day",a.w="week",a.m="month",a.y="year"})(bn||(bn={}));function qi({query:a,totalLines:b=Infinity,linesPerPage:c=1e3,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g}){return un({query:a,remainderLines:b,linesPerPage:c,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g})}function un(a){let b=a.query;a.startDocRef&&(b=b[a.startMode](a.startDocRef));let c=Math.min(a.remainderLines,a.linesPerPage);return a.remainderLines-=c,b.limit(c).get().then(function(d){let e=a.remainderLines===0||d.size<c,f=!1;a.forEachPageCallback&&(f=a.forEachPageCallback(d)||!1),e=e||f;if(e){let g;return a.resolveCallback&&(g=a.resolveCallback()),Promise.resolve(g)}else return a.startDocRef=d.docs[d.size-1],a.startMode="startAfter",un(a)})}function Qa(a,b=Infinity,c=0,d,e){let f=[],g=0;return qi({query:a,totalLines:c+b,startDocRef:d,startMode:e,forEachPageCallback:function(i){let h,k=i.size,m=c-g;m<=0?h=i.docs:m<k&&(h=i.docs.slice(m,k)),h&&f.push(...h),g+=k},resolveCallback:function(){return f}})}const Cfa=La(Sa());function ln(a,b,c=0){return Qa(a.nextQuery,b,c,a.baselineDocRef,a.baselineMode).then(function(d){let e=d.length;return a.cacheItems=d,a.pageIndex=void 0,a.startItemIndex=c,a.endItemIndex=a.startItemIndex+e-1,a.isFullPage=b===void 0?!0:e===b,Promise.resolve(a.cacheItems)})}const afa=La(Sa());class of{constructor({query:a={next:void 0,previous:void 0},itemCount:b=100,baselineDoc:c,baselineMode:d="startAt"}={}){this.setQuery(a),this.setItemCount(b),this.setBaselineDoc(c,d),this.pageIndex=void 0,this.baselineDocRef=void 0,this.baselineMode="startAt",this.startItemIndex=void 0,this.endItemIndex=void 0,this.cacheItems=void 0,this.isFullPage=void 0}setQuery(a,b){if(a instanceof afa.firestore.Query)this.nextQuery=a,this.prevQuery=b;else{var c=a;this.nextQuery=c.next,this.prevQuery=c.previous}return this.pageIndex=null,this.isFullPage=!0,this}setItemCount(a){return this.itemCount=a,this}setBaselineDoc(a,b){return a?(this.baselineDocRef=a.ref,this.baselineMode=b):this.baselineDocRef=void 0,this}load(a,b=0){return ln(this,a,b)}loadFirstPage(){return this._loadFirstPage()}loadNextPage(){return this.pageIndex==null?this._loadFirstPage():this._loadNextPage()}loadPreviousPage(){return this.pageIndex==null||this.pageIndex===1?this._loadFirstPage():this._loadPreviousPage()}loadCurrentPage(){return this.pageIndex==null||this.pageIndex===0?this._loadFirstPage():this._loadCurrentPage()}}function rn(a){return Qa(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=null,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function mn(a){return Qa(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,Promise.resolve(a.cacheItems)})}function sn(a){return Qa(a.nextQuery,a.itemCount,0,a.currPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=a.currPageEndDocRef,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function nn(a){let b=(a.pageIndex+1)*a.itemCount;return Qa(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function tn(a){return Qa(a.prevQuery,a.itemCount+1,0,a.currPageStartDocRef,"startAfter").then(function(b){let c=b.length-1;return a.cacheItems=b,a.cacheItems.pop(),a.cacheItems.reverse(),a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-c+1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=b[c].ref,a.currPageStartDocRef=b[c-1].ref,a.currPageEndDocRef=b[0].ref,Promise.resolve(a.cacheItems)})}function on(a){let b=(a.pageIndex-1)*a.itemCount;return Qa(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-d+1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function qn(a){return Qa(a.nextQuery,a.itemCount,0,a.prevPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function pn(a){let b=a.pageIndex*a.itemCount;return Qa(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}class ni extends of{_loadFirstPage(){return mn(this)}_loadNextPage(){return nn(this)}_loadPreviousPage(){return on(this)}_loadCurrentPage(){return pn(this)}}const aea=La(Sa());class nf extends of{_loadFirstPage(){return rn(this)}_loadNextPage(){return sn(this)}_loadPreviousPage(){return tn(this)}_loadCurrentPage(){return qn(this)}}const Vea=La(Sa());function dn(a,b){let c={senderID:a.userID,message:b,timestamp:Vea.firestore.FieldValue.serverTimestamp()};return a.userName!==void 0&&(c.senderName=a.userName),a.receiverID!==void 0&&(c.receiverID=a.receiverID),a.rootRef.add(c)}function oi(a,b=a.receiverID){let c=a.rootRef;return c=b!==void 0?c.where("receiverID","==",b):c,c}function cn(a,b=a.receiverID){let c=oi(a,b),d=c.orderBy("timestamp"),e=c.orderBy("timestamp","desc");return{next:d,previous:e}}const pi="receive";function en(a){let b=oi(a).orderBy("timestamp","desc").limit(1);a.unsubscribe=b.onSnapshot({includeMetadataChanges:!0},function(c){if(c.size>0){let d=c.docs[0];if(d.metadata.hasPendingWrites){a.skipFirst&&(a.skipFirst=!1);return}jn(a,a.receiverID,d);if(a.skipFirst)a.skipFirst=!1;else{let e=kn(d);a.cacheMessages.push(e),a.emit(pi,e)}}else a.skipFirst&&(a.skipFirst=!1)},function(c){debugger})}function fn(a){a.unsubscribe&&a.unsubscribe(),a.resetQueryFlag=!0,a.cacheMessages.length=0}function gn(a){return jn(a),a.page.loadNextPage().then(function(b){let c=[];for(let d=0,e=b.length;d<e;d++)c.push(kn(b[d]));return a.cacheMessages.splice(0,0,...c),Promise.resolve(c)})}function jn(a,b=a.receiverID,c){if(!a.resetQueryFlag)return;a.resetQueryFlag=!1;let d=a.skipFirst?"startAt":"startAfter";a.page.setBaselineDoc(c,d).setQuery(cn(a,b));return}function kn(a){let b=a.data();return b.timestamp=b.timestamp.toDate(),b}const Mea=La(Sa());class hn extends xa{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d="",receiverID:e,pageItemCount:f=100}={}){super();this.setEventEmitter(a),this.database=Mea.firestore(),this.setRootPath(b),this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.skipFirst=!0,this.unsubscribe=void 0,this.page=new nf(),this.setPageItemCount(f),this.resetQueryFlag=!0,this.cacheMessages=[]}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.resetQueryFlag=this.resetQueryFlag||this.rootPath!==a,this.rootPath=a,this.rootRef=this.database.collection(a),this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.resetQueryFlag=this.resetQueryFlag||this.receiverID!==a,this.receiverID=a,this}setPageItemCount(a){return this.page.setItemCount(a),this}get hasPreviousMessage(){return this.page.isFullPage!==!1}send(a){return dn(this,a)}startReceiving(){return en(this),this}stopReceiving(){return fn(this),this}loadPreviousMessages(){return gn(this)}}const sh="join";const th="leave";const vh="init";const uh="update";const rh="changename";const qh="change";const $l={join:sh,leave:th,update:uh,change:qh,init:vh,changename:rh};var Gb;(function(a){a[a.once=0]="once",a[a.child=1]="child",a[a.all=2]="all"})(Gb||(Gb={}));const di="add";const fi="remove";const ei="change";const gi="update";const Tm={add:di,remove:fi,update:gi,change:ei};function lf(a){a.items.length=0,a.itemID2Index.clear()}function Um(a){return a.items}function Vm(a,b){return a.itemID2Index.has(b)}function ci(a,b){return b==null?null:a.itemID2Index.get(b)}function Wm(a,b){if(b==null)return null;let c=ci(a,b);return c==null?null:a.items[c]}function Xm(a,b,c){a.items.forEach(b,c)}function Vb(a){a.itemID2Index.clear();let b=a.items;for(var c=0,d=b.length;c<d;c++){let e=b[c][a.keyItemID];a.itemID2Index.set(e,c)}}function hi(a,b){let c=ji.call(this,a,b);Vb(this),this.emit(this.eventNames.add,c),this.emit(this.eventNames.update,this.items)}function Ad(a,b){let c=Ym.call(this,a);Vb(this);let d=ji.call(this,a,b);Vb(this),this.emit(this.eventNames.change,d,c),this.emit(this.eventNames.update,this.items)}function ii(a){let b=Ym.call(this,a);Vb(this),this.emit(this.eventNames.remove,b),this.emit(this.eventNames.update,this.items)}function Bd(a){lf(this),a.forEach(function(b){ji.call(this,b,null,!0)}.bind(this)),Vb(this),this.emit(this.eventNames.update,this.items)}function ji(a,b,c=!1){let d,e=this.getItemCallback,f=this.getItemCallbackScope;f?d=e.call(f,a):d=e(a);if(c)return this.items.push(d),d;if(b==null)this.items.unshift(d);else{let g=this.itemID2Index.get(b);g===this.items.length-1?this.items.push(d):this.items.splice(g+1,0,d)}return d}function Ym(a){let b=this.itemID2Index.get(a.key),c=zd(this.items,b);return c}const $m={start(a,b){a.isUpdating=!1,b.once("value",Bd,a)},stop(a){}};const _m={start(a,b){b.on("child_added",hi,a),b.on("child_removed",ii,a),b.on("child_moved",Ad,a),b.on("child_changed",Ad,a)},stop(a){a.query.off("child_added",hi,a),a.query.off("child_removed",ii,a),a.query.off("child_moved",Ad,a),a.query.off("child_changed",Ad,a)}};const Zm={start(a,b){b.on("value",Bd,a)},stop(a){a.query.off("value",Bd,a)}};const yd={};yd[Gb.all]=Zm;yd[Gb.child]=_m;yd[Gb.once]=$m;class uc extends xa{constructor({eventEmitter:a,itemIDKey:b="__itemID__",mode:c=Gb.child,getItemCallback:d=yr,getItemCallbackScope:e,query:f,eventNames:g=Tm}={}){super();this.setEventEmitter(a),this.eventNames=g,this.isUpdating=!1,this.items=[],this.itemID2Index=new Map(),this.setItemIDKey(b),this.setMode(c),e===void 0&&(e=this),this.setGetitemCallback(d,e),this.setQuery(f)}destroy(){this.stopUpdate().clear()}setItemIDKey(a){return this.keyItemID=a,this}setMode(a){return typeof a==="string"&&(a=Gb[a]),this.mode=a,this.updater=yd[a],this}setGetitemCallback(a,b){return this.getItemCallback=a,this.getItemCallbackScope=b,this}setQuery(a){return this.query=a,this}startUpdate(a){if(a)this.setQuery(a);else if(this.query)a=this.query;else return this;return this.stopUpdate().clear(),this.isUpdating=!0,this.updater.start(this,a),this}stopUpdate(){return!this.query||!this.isUpdating?this:(this.isUpdating=!1,this.updater.stop(this),this)}clear(){return lf(this),this}getItems(){return Um(this)}hasItem(a){return Vm(this,a)}getItemIndexFromItemID(a){return ci(this,a)}getItemFromItemID(a){return Wm(this,a)}forEach(a,b){return Xm(this,a,b),this}updateItemID2Index(){return Vb(this),this}}const yr=function(a){let b=a.val();return b[this.keyItemID]=a.key,b};function Rb(a,b=a.userID){return a.userID2ItemID.has(b)}function Ye(a,b=a.userID){if(!Rb(a,b))return null;let c=a.userID2ItemID.get(b);return a.rootRef.child(c)}function am(a,b=a.userID){if(!Rb(a,b))return null;let c=a.userID2ItemID.get(b);return a.userList.getItemFromItemID(c)}function ph(a){return a.userList.getItems()}function bm(a){a.userList.clear()}function cm(a,b,c){a.userList.forEach(b,c)}function dm(a,b=a.userID){let c=a.userList.getItems()[0];return c&&c.userID===b}function em(a){return a.maxUsers===0?!1:a.userList.getItems().length>=a.maxUsers}function Yl(a=0,b){return new Promise(function(c,d){setTimeout(function(){c(b)},a)})}function Zl(a,b=a.userID,c=a.userName){if(Rb(a,b))return Promise.resolve();let d={userID:b,userName:c},e=a.maxUsers,f=a.database.ref(a.rootPath),g=f.push();return g.onDisconnect().remove().then(function(){return g.set(d)}).then(function(){return Yl(0)}).then(function(){return e===0?(a.isInList=!0,Promise.resolve()):f.limitToFirst(e).once("value").then(function(i){return mr(i,b)?(a.isInList=!0,Promise.resolve()):(a.isInList=!1,g.remove().then(function(){return g.onDisconnect().cancel()}).then(function(){return Promise.reject()}))})})}function mr(a,b){let c=!1;return a.forEach(function(d){let e=d.val();if(e.userID===b)return c=!0,!0}),c}function _l(a,b=a.userID){if(!Rb(a,b))return Promise.resolve();let c=a.userID2ItemID.get(b),d=a.database.ref(a.rootPath).child(c);return d.remove()}function Xl(a,b){return new Promise(function(c,d){let e=Ye(a);if(e)return c(e);{let f=a.rootRef.orderByChild("userID").equalTo(a.userID);f.once("child_added").then(function(g){return c(g.ref)})}}).then(function(c){return c.child("userName").set(b)}).then(function(){return a.userName=b,Promise.resolve()})}const c7=La(Sa());class Xc extends xa{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,eventNames:f=$l}={}){super();this.setEventEmitter(a),this.eventNames=f,this.database=c7.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.setMaxUsers(e),this.userList=new uc({eventEmitter:this.eventEmitter,itemIDKey:"joinAt",eventNames:{add:f.join,remove:f.leave,update:f.update,change:f.change}}),this.isInList=!1,this.userID2ItemID=new Map(),this.userList.on(this.eventNames.join,function(g){this.userID2ItemID.set(g.userID,g.joinAt),g.userID===this.userInfo.userID&&this.emit(this.eventNames.init,ph(this))},this).on(this.eventNames.leave,function(g){this.userID2ItemID.delete(g.userID),g.userID===this.userID&&(this.isInList=!1)},this).on(this.eventNames.change,function(g,i){let h=g.userID,k=g.userName,m=i.userName;k!==m&&this.emit(this.eventNames.changename,h,k,m)},this)}destroy(){this.stopUpdate().destroyEventEmitter().leave(),this.userList.destroy()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setMaxUsers(a){return this.maxUsers=a,this}clear(){return bm(this),this}forEach(a,b){return cm(this,a,b),this}isFull(){return em(this)}isFirstUser(a=this.userID){return dm(this,a)}getUser(a=this.userID){return am(this,a)}getUsers(){return ph(this)}getUserRef(a=this.userID){return Ye(this,a)}contains(a=this.userID){return Rb(this,a)}join(a=this.userID,b=this.userName){return Zl(this,a,b)}leave(a=this.userID){return _l(this,a)}changeUserName(a){return Xl(this,a)}startUpdate(){let a=this.rootRef;return this.maxUsers>0&&(a=a.limitToFirst(this.maxUsers)),this.userList.startUpdate(a),this}stopUpdate(){return this.userList.stopUpdate(),this}}const vc="room.join";const Tb="room.leave";const Lh="userlist.join";const Mh="userlist.leave";const Oh="userlist.init";const Nh="userlist.update";const vd="userlist.changename";const wh="broadcast.receive";function Ah(a){return`tables.${a}.init`}function Bh(a){return`tables.${a}.update`}function Ch(a){return`tables.${a}.addkey0`}function Dh(a){return`tables.${a}.addkey1`}function Eh(a){return`tables.${a}.addkey2`}function Fh(a){return`tables.${a}.removekey0`}function Gh(a){return`tables.${a}.removekey1`}function Hh(a){return`tables.${a}.removekey2`}function Ih(a){return`tables.${a}.changekey0`}function Jh(a){return`tables.${a}.changekey1`}function Kh(a){return`tables.${a}.changekey2`}const xh="roomlist.add";const yh="roomlist.remove";const zh="roomlist.update";function rm(a){const b=new Xc({eventEmitter:a.eventEmitter,eventNames:{join:Lh,leave:Mh,update:Nh,change:"userlist.change",init:Oh,changename:vd},userID:a.userInfo});return b.on("userlist.leave",function(c){c.userID===a.userID&&rr(a)}),a.on(vc,function(){b.startUpdate()}).on(Tb,function(){b.stopUpdate().clear()}),b}function rr(a){a.emit(Tb),setTimeout(function(){a.roomID=void 0,a.roomName=void 0,a.doorState=void 0,a.leftRoomFlag=!1},0)}function om(a){const b=new uc({eventEmitter:a.eventEmitter,itemIDKey:"roomID",eventNames:{update:zh,add:xh,remove:yh,change:"roomlist.change"},mode:"once"});return b}function ym(a){return a.split("|")[0]}function xm(a){return a.split("|")[1]}function Yc(a,b=""){return`${a}|${b}`}function ob(a,b){let c=a.rootRef;return b&&(c=c.child(b)),c}function wd(a,b,c){let d=ob(a,"rooms");return b!==void 0&&(d=d.child(b),c!==void 0&&(d=d.child(c))),d}function nm(a,b){return wd(a,b,"alive")}function sm(a,b){return wd(a,b,"users")}function ud(a,b){let c=ob(a,"room-filters");return b!==void 0&&(c=c.child(b)),c}function Zc(a,b){let c=ob(a,"room-metadata");return b!==void 0&&(c=c.child(b)),c}function _e(a,b,c){let d=`${a.rootPath}/rooms/${b}`;return c&&(d+=`/${c}`),d}function bf(a,b){return _e(a,b,"users")}function pm(a,b,c){let d=_e(a,b,"tables");return c&&(d+=`/${c}`),d}function tm(a,b,c="open"){let d=ud(a);return d=d.orderByChild("filter"),b===void 0?d=d.startAt(c).endAt(`${c}~`):d=d.equalTo(Yc(c,b)),d}function km(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new Vc({eventEmitter:a.eventEmitter,eventNames:{receive:wh},receiverID:"boradcast",senderID:a.userInfo,history:b.history});return a.on(vc,function(d){c.setRootPath(_e(a,d.roomID)).startReceiving()}).on(Tb,function(){c.stopReceiving()}).on(vd,function(d,e){c.changeUserName(d,e)}),c}function qm(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,qr(a,d))}),a.on(vc,function(d){for(const[e,f]of c)f.setRootPath(pm(a,d.roomID,e)).startUpdate()}).on(Tb,function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function qr(a,{key:b,type:c=ta["1d"]}){const d=new Wc({eventEmitter:a.eventEmitter,type:c,eventNames:{init:Ah(b),update:Bh(b),addkey0:Ch(b),removekey0:Fh(b),changekey0:Ih(b),addkey1:Dh(b),removekey1:Gh(b),changekey1:Jh(b),addkey2:Eh(b),removekey2:Hh(b),changekey2:Kh(b)}});return d}function Xa(a,b=a.roomID,c=a.roomName){return{roomID:b,roomName:c}}function ff(a,b){return b===void 0?a.roomID!==void 0:a.roomID===b}function Bm(a){return a.userList.isFull()}function Cm(a,b=a.userID){return a.userList.isFirstUser(b)}function Dm(a){return a.userList.getUsers()}function cf(a,b,c,d){a.roomID=b,a.roomName=c,a.roomType=d,a.emit("room.join",Xa(a))}function af(a,b={}){return b.roomID==null&&(b.roomID=wd(a).push().key),or(a,b.roomID).then(function(){return pr(a,b)})}function or(a,b){return nm(a,b).transaction(function(c){return c===null?!0:void 0})}function pr(a,{roomID:b,roomName:c="",roomType:d="",maxUsers:e=0,presisted:f=!1,door:g="open",join:i=!0,filterData:h}){let k=wd(a,b),m=ud(a,b),o=Zc(a,b);a.isRemoveRoomWhenLeft=!f,a.isRemoveRoomWhenLeft&&(k.onDisconnect().remove(),m.onDisconnect().remove(),o.onDisconnect().remove());const s=Yc(g,d),u={},v={filter:s,name:c};h&&(v.data=h),u[`room-filters/${b}`]=v;const y={name:c,filter:s,maxUsers:e,moderators:{}};return y.moderators[a.userID]=a.userName,u[`room-metadata/${b}`]=y,new Promise(function(D,J){if(i){const I=a.userList.setRootPath(bf(a,b)).setMaxUsers(0).join();return a.userList.setMaxUsers(e),I.then(D,J)}else return D()}).then(function(){return ob(a).update(u)}).then(function(){return a.isRoomCreator=!0,i&&cf(a,b,c,d),Promise.resolve(Xa(a))})}function lm(a,{digits:b=10,candidates:c="0123456789",retry:d=1e3}){let e=arguments[1];return mm(a,b,c,d,e)}function mm(a,b,c,d,e){return e.roomID=$e(b,b,c),d<=0?Promise.reject(e):(d--,af(a,e).catch(function(){return mm(a,b,c,d,e)}))}function gf(a,b=a.roomID){const c={};c[`room-filter/${b}`]=null,c[`room-metadata/${b}`]=null,c[`rooms/${b}`]=null;const d=Xa(a);return ob(a).update(c).then(function(){return Promise.resolve(d)})}function _c(a){if(!ff(a))return Promise.resolve(Xa(a));a.leftRoomFlag=!0;if(a.isRemoveRoomWhenLeft)return gf(a);{const b=Xa(a);return a.userList.leave().then(function(){return Promise.resolve(b)})}}function ef(a,{leftThenJoin:b=!0,roomID:c}){return b?_c(a).then(function(){return zm(a,c)}):zm(a,c)}function zm(a,b){return b==null?Promise.reject(Xa(a,b,"")):(a.isRemoveRoomWhenLeft=!1,sr(a,b).then(function(c){return a.userList.setRootPath(bf(a,b)).setMaxUsers(c.maxUsers).join().then(function(){return Promise.resolve(c)})}).then(function(c){return cf(a,b,c.name,xm(c.filter)),Promise.resolve(Xa(a))}))}function sr(a,b){return Zc(a,b).once("value").then(function(c){let d=c.val();return tr(a,d)?Promise.resolve(d):Promise.reject()})}function tr(a,b){if(b==null)return!1;if(ym(b.filter)==="closed")return!1;const c=a.userID;if(b.moderators[c])return!0;switch(b.permission){case"blocklist":const d=b.blocklist;return!(d&&d[c]);case"allowlist":const e=b.allowlist;return e&&e[c];default:return!0}}function df(a,b,c){return new Promise(function(d,e){a.roomList.once("roomlist.update",function(f){d(f)}).startUpdate(tm(a,b,c))})}function vm(a,{roomType:b="",leftThenJoin:c=!0}={}){return df(a,b,"open").then(function(d){if(d.length===0)return Promise.reject("No filtered room");sc(d);const e={leftThenJoin:c,roomID:""};return wm(a,e,d)})}function wm(a,b,c,d=0){return d===c.length?Promise.reject("Can't join any room"):(b.roomID=c[d].roomID,d++,ef(a,b).catch(function(){return wm(a,b,c,d)}))}function Am(a,b){return a.userList.contains(b)?b===a.userID?_c(a):a.userList.leave(b):Promise.resolve()}function Sb(a,b){return b===a.roomID?Promise.resolve(!0):Zc(a,b).once("value").then(function(c){const d=c.val()!==null;return Promise.resolve(d)})}function Ze(a,b,c=a.roomID){return Sb(a,c).then(function(d){if(!d)return Promise.resolve();const e=Yc(b,a.roomType),f={};return f[`room-filters/${c}/filter`]=e,f[`room-metadata/${c}/filter`]=e,ob(a).update(f)})}function hm(a,b=a.roomID){return Ze(a,"open",b)}function im(a,b=a.roomID){return Ze(a,"closed",b)}function fm(a,b,c=a.roomID){return Sb(a,c).then(function(d){return d?ud(a,c).child("data").update(b):Promise.resolve()})}function jm(a,b){return a.userList.changeUserName(b)}function gm(a,b,c=a.roomID){return Sb(a,c).then(function(d){if(!d)return Promise.resolve();const e={};return e[`room-filters/${c}/name`]=b,e[`room-metadata/${c}/name`]=b,ob(a).update(e)})}function um(a,b=a.roomID){return b===a.roomID?a.userList.getUsers():new Promise(function(c,d){const e=new uc({itemIDKey:"joinAt",mode:"once"});e.once("update",function(f){c(f)}).startUpdate(sm(a,b))})}const P8=La(Sa());class Em extends xa{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",broadcast:e=!0,tables:f=!1}={}){super();this.setEventEmitter(a),this.database=P8.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.isRoomCreator=!1,this.roomID=void 0,this.roomName=void 0,this.roomType=void 0,this.doorState=void 0,this.leftRoomFlag=!1,this.isRemoveRoomWhenLeft=void 0,this.userList=rm(this),this.roomList=om(this),this.broadcast=km(this,e),this.tables=qm(this,f)}destroy(){var a=this;this.destroyEventEmitter().leaveRoom().then(function(){a.userList.destroy(),a.userList=void 0,a.roomList.destroy(),a.roomList=void 0,a.broadcast.destroy(),a.broadcast=void 0})}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}getRoomInfo(a,b){return Xa(this,a,b)}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(a){return ff(this,a)}isFull(){return Bm(this)}isFirstUser(a=this.userID){return Cm(this,a)}getUsers(){return Dm(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}createRoom(a){return af(this,a)}createRandomRoom(a={}){return lm(this,a)}joinRoom(a){return ef(this,a)}joinRandomRoom(a={}){return vm(this,a)}leaveRoom(){return _c(this)}removeRoom(a=this.roomID){return gf(this,a)}kickUser(a){return Am(this,a)}changeRoomState(a,b=this.roomID){return Ze(this,a,b)}openRoom(a=this.roomID){return hm(this,a)}closeRoom(a=this.roomID){return im(this,a)}changeUserName(a){return jm(this,a)}changeFilterData(a,b=this.roomID){return fm(this,a,b)}changeRoomName(a,b,c=a.roomID){return gm(this,b,c)}getUserList(a=this.roomID){return um(this,a)}getRoomList(a,b){return df(this,a,b)}HasRoom(a){return Sb(this,a)}}function Lm(a,b){let c=a.rootPath;return b&&(c+=`/${b}`),c}function Jm(a){return Lm(a,"users")}function Hm(a,b){return`${Lm(a,"tables")}/${b}`}const Fb="room.join";const Ub="room.leave";const $h="userlist.join";const hf="userlist.leave";const bi="userlist.init";const ai="userlist.update";const xd="userlist.changename";const Ph="broadcast.receive";function Qh(a){return`tables.${a}.init`}function Rh(a){return`tables.${a}.update`}function Sh(a){return`tables.${a}.addkey0`}function Th(a){return`tables.${a}.addkey1`}function Uh(a){return`tables.${a}.addkey2`}function Vh(a){return`tables.${a}.removekey0`}function Wh(a){return`tables.${a}.removekey1`}function Xh(a){return`tables.${a}.removekey2`}function Yh(a){return`tables.${a}.changekey0`}function Zh(a){return`tables.${a}.changekey1`}function _h(a){return`tables.${a}.changekey2`}function Km(a,b=0){const c=new Xc({eventEmitter:a.eventEmitter,eventNames:{join:$h,leave:hf,update:ai,change:"userlist.change",init:bi,changename:xd},root:Jm(a),userID:a.userInfo,maxUsers:b});return c.on(hf,function(d){d.userID===a.userID&&wr(a)}),a.on(Fb,function(){c.startUpdate()}).on(Ub,function(){c.stopUpdate().clear()}),c}function wr(a){a.emit(Ub),setTimeout(function(){a.leftRoomFlag=!1},0)}function Gm(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new Vc({eventEmitter:a.eventEmitter,eventNames:{receive:Ph},receiverID:"broadcast",senderID:a.userInfo,history:b.history});return a.on(Fb,function(){c.setRootPath(a.rootPath).startReceiving()}).on(Ub,function(){c.stopReceiving()}).on(xd,function(d,e){c.changeUserName(d,e)}),c}function Im(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,vr(a,d))}),a.on(Fb,function(){for(const[d,e]of c)e.setRootPath(Hm(a,d)).startUpdate()}).on(Ub,function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function vr(a,{key:b,type:c=ta["1d"]}){const d=new Wc({eventEmitter:a.eventEmitter,type:c,eventNames:{init:Qh(b),update:Rh(b),addkey0:Sh(b),removekey0:Vh(b),changekey0:Yh(b),addkey1:Th(b),removekey1:Wh(b),changekey1:Zh(b),addkey2:Uh(b),removekey2:Xh(b),changekey2:_h(b)}});return d}function kf(a){return a.userList.isInList}function Pm(a){return a.userList.isFull()}function Qm(a,b=a.userID){return a.userList.isFirstUser(b)}function Rm(a){return a.userList.getUsers()}function Nm(a){return a.userList.join().then(function(){return a.emit(Fb),Promise.resolve()})}function jf(a){return kf(a)?(a.leftRoomFlag=!0,a.userList.leave()):Promise.resolve()}function Mm(a){return a.userList.getUsers()}function Om(a,b){return a.userList.contains(b)?b===a.userID?jf(a):a.userList.leave(b):Promise.resolve()}function Fm(a,b){return a.userList.changeUserName(b)}const Baa=La(Sa());class Sm extends xa{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,broadcast:f=!0,tables:g=!1}={}){const i=arguments[0];super();this.setEventEmitter(a),this.database=Baa.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.leftRoomFlag=!1,this.userList=Km(this,e),this.broadcast=Gm(this,f),this.tables=Im(this,g)}shutdown(){}destroy(){this.shutdown()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(){return kf(this)}isFull(){return Pm(this)}isFirstUser(a=this.userID){return Qm(this,a)}getUsers(){return Rm(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}joinRoom(){return Nm(this)}leaveRoom(){return jf(this)}getUserList(){return Mm(this)}kickUser(a){return Om(this,a)}changeUserName(a){return Fm(this,a)}}const dj="statechange";function ej(a){return`exit_${a.toString()}`}function fj(a){return`enter_${a.toString()}`}class lp extends xa{constructor({eventEmitter:a}={}){super();this._states=new Map();this.enable=!0;this.setEventEmitter(a)}destroy(){this.destroyEventEmitter()}toJSON(){return{curState:this.state,prevState:this.prevState,enable:this.enable,start:this._start}}setEnable(a=!0){return this.enable=a,this}getState(a){return this._states.get(a)}addState(a){return this._states.set(a.name,a),this}addStates(a){for(let b=0,c=a.length;b<c;b++)this.addState(a[b]);return this}removeState(a){return this._states.delete(a),this}removeAllStates(){return this._states.clear(),this}set state(a){if(!this.enable||this._stateLock)return;if(this._state===a)return;this._prevState=this._state,this._state=a,this._stateLock=!0,this.emit(dj,this);if(this._prevState!=null){const b=this.getState(this._prevState);b&&b.exit&&b.exit(this),this.emit(ej(this._prevState),this)}this._stateLock=!1;if(this._state!=null){const b=this.getState(this._state);b&&b.enter&&b.enter(this),this.emit(fj(this._state),this)}}get state(){return this._state}get prevState(){return this._prevState}get stateList(){return Array.from(this._states.keys())}start(a){return this._start=a,this._prevState=void 0,this._state=a,this}goto(a){return a!=null&&(this.state=a),this}next(){const a=this.getState(this.state);if(!a||!a.next)return this;let b;return typeof a.next==="string"?b=a.next:b=a.next(this),this.goto(b),this}update(a,b,c="update"){const d=this.getState(this.state);d&&d[c]&&d[c](this,a,b)}preupdate(a,b){this.update(b,a,"preupdate")}postupdate(a,b){this.update(b,a,"postupdate")}}var gj;(function(a){a[a.shuffle=0]="shuffle",a[a.random=1]="random"})(gj||(gj={}));const jj="die";class mp extends Pf{constructor(a,{lifeTime:b=1e3,destroy:c=!0}={}){super(a,arguments[1]);this.setLifeTime(b),this.setDestroyMode(c)}resetFromJSON({lifeTime:a=1e3,destroy:b=!0}={}){return super.resetFromJSON(arguments[0]),this.setLifeTime(a),this.setDestroyMode(b),this}toJSON(){const a=super.toJSON();return a.lifeTime=this.lifeTime,a.destroy=this.destroyMode,a}setLifeTime(a){return this.lifeTime=a,this}addToLifeTime(a){return this.lifeTime+=a,this}setDestroyMode(a=!0){return this.destroyMode=a,this}get isAlive(){return this.now<this.lifeTime}get remainder(){let a=this.lifeTime-this.now;return a<0&&(a=0),a}update(a){return this.isRunning?(super.update(a),this.isAlive||(this.complete(jj),this.destroyMode&&this.gameObject.destroy&&this.gameObject.destroy()),this):this}get gameObject(){return this.parent}}class Qf{constructor(a,b,c,d,e){this.key=a,this.start=b,this.end=c,this.step=d,this.items=e,this._current=b}reset(){this._current=this.start}get isEnd(){return this.step>=0?this._current>=this.end:this._current<=this.end}get length(){return this.step>=0&&this.start>this.end||this.step<0&&this.start<this.end?0:Math.floor(this.end-this.start)+1}next(){return this.isEnd?this._current=this.start:this._current+=this.step,this}get current(){return this.items?this.items[this._current]:this._current}}class op{constructor(){this.indexes=[];this.length=0;this.firstPass=!0;this.currentCount=0}reset(){for(let a=0,b=this.indexes.length;a<b;a++)this.indexes[a].reset();return this.firstPass=!0,this.currentCount=0,this}addNumberLoop(a,b,c,d=c>=b?1:-1){return this.indexes.push(new Qf(a,b,c,d)),this.length=this._getLength(),this}addItemsLoop(a,b,c=!1){const d=b.length-1,e=c?d:0,f=c?0:d,g=c?-1:1;return this.indexes.push(new Qf(a,e,f,g,b)),this.length=this._getLength(),this}addLoop({key:a,start:b,end:c,step:d,items:e}){return this.indexes.push(new Qf(a,b,c,d,e)),this.length=this._getLength(),this}removeLoops(){return this.indexes.length=0,this.length=0,this}_getLength(){let a=this.indexes[0]?.length;for(let b=1,c=this.indexes.length;b<c;b++)a*=this.indexes[b].length;return a??0}get progress(){return this.currentCount/this.length}get isEnd(){for(let a=this.indexes.length-1;a>=0;a--)if(!this.indexes[a].isEnd)return!1;return!0}next(){for(let a=this.indexes.length-1;a>=0;a--){const b=this.indexes[a],c=b.isEnd;b.next();if(!c)break}return this}getCurrent(a={}){for(let b=this.indexes.length-1;b>=0;b--){const c=this.indexes[b];a[c.key]=c.current}return a}getNext(a={}){return this.firstPass?this.firstPass=!1:this.next(),this.getCurrent(a),this.currentCount++,a}}const $i="tickstart";const aj="tickend";const ss=1e3/60;class np extends Rf{constructor(a,{callback:b,scope:c,deltaPercentage:d=1}={}){super(a,arguments[1]);this.deltaPercentage=1;this.loopIndexGenerator=new op();this.currentIndexes={};this.scene=a,this.setCallback(b,c),this.setDeltaPercentage(d),this.boot()}boot(){super.boot(),dc(this.scene,"shutdown",this.destroy,this)}shutdown(){super.shutdown(),this.scene=void 0}destroy(){this.shutdown()}startTicking(){super.startTicking(),Ra(this.scene,"update",this.preupdate,this)}stopTicking(){super.stopTicking(),this.scene&&Ab(this.scene,"update",this.preupdate,this)}setCallback(a,b){return this.callback=a,this.scope=b,this}setDeltaPercentage(a){return this.deltaPercentage=a,this}addNumberLoop(a,b,c,d){return this.loopIndexGenerator.addNumberLoop(a,b,c,d),this}addItemsLoop(a,b,c=!1){return this.loopIndexGenerator.addItemsLoop(a,b,c),this}addLoop(a){return this.loopIndexGenerator.addLoop(a),this}get curTime(){return new Date().getTime()}get progress(){return this.loopIndexGenerator.progress}preupdate(){if(!this.callback)return;const a=this.curTime,b=ss*this.deltaPercentage;let c;this.emit($i);do{if(this.loopIndexGenerator.isEnd){this.complete();return}this.currentIndexes=this.loopIndexGenerator.getNext(this.currentIndexes),this.scope?this.callback.call(this.scope,this.currentIndexes,this):this.callback(this.currentIndexes,this),c=this.curTime-a>=b}while(!c);this.emit(aj)}}const oua=La(Kp());var hj;(function(a){a[a.none=0]="none",a[a.base64=1]="base64",a[a.utf16=2]="utf16",a[a.uri=3]="uri"})(hj||(hj={}));let Ds=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i;function Uc(a){let b;return a===""?b=null:Ds.test(a)?b=parseFloat(a):a==="false"?b=!1:a==="true"?b=!0:b=a,b}const Kpa=La(Fg());function pp(a,{delimiter:b=",",convert:c=!0,types:d={}}={}){const e=Kpa.default.parse(a,{header:!0,delimiter:b}).data,f=d.question??"q",g=d.option??"",i=c===!0?Uc:c,h=[];let k,m;for(let o=0,s=e.length;o<s;o++){let u=e[o],v=u.type;delete u.type,v===f?(k=u,k.key===""&&delete k.key,rp(k,i),k.options=[],h.push(k)):v===g&&(k&&(m=u,m.key===""&&delete m.key,rp(m,i),k.options.push(m)))}return h}function rp(a,b){const c=a;if(!b)return c;for(const d in a)c[d]=b(a[d],d);return c}function cj(a,b,c){typeof b==="string"&&(b=pp(b,c));if(Array.isArray(b))for(let d=0,e=b.length;d<e;d++)qp(a,b[d]);else qp(a,b)}function qp(a,b){const c=b.options;if(c)for(let d=0,e=c.length;d<e;d++){let f=c[d];f.hasOwnProperty("key")||(f.key=`_${d}`)}b.hasOwnProperty("key")||(b.key=`_${a.questions.size}`),a.questions.set(b.key,b)}class bj{constructor({questions:a}={}){this.questions=new Map();a&&cj(this,a,arguments[0])}add(a,b){return cj(this,a,b),this}remove(a){return this.questions.delete(a),this}removeAll(){return this.questions.clear(),this}has(a){return this.questions.has(a)}get(a){return this.questions.get(a)}getKeys(a=[]){const b=this.questions.keys();for(const c of b)a.push(c);return a}getOption(a,b){typeof a==="string"&&(a=this.get(a));if(!a)return null;const c=a.options;if(c)for(let d=0,e=c.length;d<e;d++){let f=c[d];if(f.key===b)return f}return null}}const Sf="quest";class ts extends xa{constructor(a,{eventEmitter:b,shuffleQuestions:c=!1,shuffleOptions:d=!1}={}){super();this.questionKeys=[];this.setEventEmitter(b),Ue(a)&&(a=new bj(a)),this.questionsManager=a,this.setShuffleQuestionsEnable(c),this.setShuffleOptionsEnable(d),this.init()}setShuffleQuestionsEnable(a=!0){return this.shuffleQuestionsEnable=a,this}setShuffleOptionsEnable(a=!0){return this.shuffleOptionsEnable=a,this}init(){return this.questionKeys.length=0,this.questionsManager.getKeys(this.questionKeys),this.shuffleQuestionsEnable&&sc(this.questionKeys),this.nextIndex=-1,this.nextKey=void 0,this}setNextKey(a){return a===void 0?(this.nextIndex++,this.nextKey=this.questionKeys[this.nextIndex]):this.questionsManager.has(a)&&(this.nextKey=a,this.nextIndex=this.questionKeys.indexOf(a)),this}setPrevKey(){return this.nextIndex--,this.nextKey=this.questionKeys[this.nextIndex],this}getQuestion(){const a=this.questionsManager.get(this.nextKey);if(a&&this.shuffleOptionsEnable){const b=a.options;b&&sc(b)}return a}getNextQuestion(a){return this.setNextKey(a).getQuestion()}getPrevQuestion(){return this.setPrevKey().getQuestion()}getOption(a,b){return b===void 0&&(b=a,a=this.getQuestion()),this.questionsManager.getOption(a,b)}next(a){const b=this.getNextQuestion(a);return b&&this.emit(Sf,b,this,this.questionsManager),this}prev(){const a=this.getPrevQuestion();return a&&this.emit(Sf,a,this,this.questionsManager),this}restart(a){return this.init(),this.next(a),this}get isLastQuestion(){return this.nextIndex===this.questionKeys.length-1}}var ah;(function(a){a[a.ascending=0]="ascending",a[a.descending=1]="descending",a[a.logical_ascending=2]="logical_ascending",a[a.logical_descending=3]="logical_descending"})(ah||(ah={}));class Np extends Td{constructor(){super();uj("dude","../assets/phaser-dude.png").load().then(()=>{this.create()})}create(){const a=new cg(this),b=new Gc(400,300,"",{width:140,height:240,padding:20,wrapMode:"char",backgroundStrokeStyle:"BurlyWood",backgroundStrokeThickness:4,cornerRadius:20,images:["dude"]});_b(a,b);const c=[];for(let g=0;g<100;g++){let i=g%5===0?`[size=30][color=red]${g}[img=dude]`:`[size=20][color=green]${g}`;c.push(i)}b.setText(c);let d=20*1e3,e=!1,f=0;Ra(a,"update",function(g){f+=e?-g:g,f<0?(f=0,e=!1):f>d&&(f=d,e=!0),b.setTextScrollY(f/d,!0).updateText(!1)})}}new tj(bg(),ag(800,600),_f("game"),Zf(2960685),$f(Np));})();
/* @license
Papa Parse
v5.3.0
https://github.com/mholt/PapaParse
License: MIT
*/
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

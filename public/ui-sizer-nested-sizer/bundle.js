(()=>{var Cf=Object.defineProperty,to=Object.prototype.hasOwnProperty,kb=(a,b)=>()=>(b||(b={exports:{}},a(b.exports,b)),b.exports),uo=a=>Cf(a,"__esModule",{value:!0}),qc=(a,b)=>{uo(a);for(var c in b)Cf(a,c,{get:b[c],enumerable:!0})},mr=(a,b)=>{uo(a);if(typeof b==="object"||typeof b==="function")for(let c in b)to.call(b,c)&&!to.call(a,c)&&c!=="default"&&Cf(a,c,{get:()=>b[c],enumerable:!0});return a},Ha=a=>a&&a.__esModule?a:mr(Cf({},"default",{value:a,enumerable:!0}),a);var pg=kb((a,b)=>{!function(c,d){"function"==typeof define&&define.amd?define([],d):"object"==typeof b&&"undefined"!=typeof a?b.exports=d():c.Papa=d()}(a,function c(){"use strict";var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==d?d:{},e=!d.document&&!!d.postMessage,f=e&&/blob:/i.test((d.location||{}).protocol),g={},j=0,i={parse:function(r,t){var h=(t=t||{}).dynamicTyping||!1;L(h)&&(t.dynamicTypingFunction=h,h={});if(t.dynamicTyping=h,t.transform=!!L(t.transform)&&t.transform,t.worker&&i.WORKERS_SUPPORTED){var m=function(){if(!i.WORKERS_SUPPORTED)return!1;var q=(p=d.URL||d.webkitURL||null,E=c.toString(),i.BLOB_URL||(i.BLOB_URL=p.createObjectURL(new Blob(["(",E,")();"],{type:"text/javascript"})))),v=new d.Worker(q),p,E;return v.onmessage=I,v.id=j++,g[v.id]=v}();return m.userStep=t.step,m.userChunk=t.chunk,m.userComplete=t.complete,m.userError=t.error,t.step=L(t.step),t.chunk=L(t.chunk),t.complete=L(t.complete),t.error=L(t.error),delete t.worker,void m.postMessage({input:r,config:t,workerId:m.id})}var l=null;return i.NODE_STREAM_INPUT,"string"==typeof r?l=t.download?new o(t):new u(t):!0===r.readable&&L(r.read)&&L(r.on)?l=new w(t):(d.File&&r instanceof File||r instanceof Object)&&(l=new s(t)),l.stream(r)},unparse:function(r,t){var h=!1,m=!0,l=",",q=`\r
`,v='"',p=v+v,E=!1,H=null;!function(){if("object"!=typeof t)return;"string"!=typeof t.delimiter||i.BAD_DELIMITERS.filter(function(D){return-1!==t.delimiter.indexOf(D)}).length||(l=t.delimiter),("boolean"==typeof t.quotes||"function"==typeof t.quotes||Array.isArray(t.quotes))&&(h=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(E=t.skipEmptyLines),"string"==typeof t.newline&&(q=t.newline),"string"==typeof t.quoteChar&&(v=t.quoteChar),"boolean"==typeof t.header&&(m=t.header);if(Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");H=t.columns}void 0!==t.escapeChar&&(p=t.escapeChar+v)}();var X=new RegExp(G(v),"g");"string"==typeof r&&(r=JSON.parse(r));if(Array.isArray(r)){if(!r.length||Array.isArray(r[0]))return Y(null,r,E);if("object"==typeof r[0])return Y(H||C(r[0]),r,E)}else if("object"==typeof r)return"string"==typeof r.data&&(r.data=JSON.parse(r.data)),Array.isArray(r.data)&&(r.fields||(r.fields=r.meta&&r.meta.fields),r.fields||(r.fields=Array.isArray(r.data[0])?r.fields:C(r.data[0])),Array.isArray(r.data[0])||"object"==typeof r.data[0]||(r.data=[r.data])),Y(r.fields||[],r.data||[],E);throw new Error("Unable to serialize unrecognized input");function C(D){if("object"!=typeof D)return[];var M=[];for(var _ in D)M.push(_);return M}function Y(D,M,_){var ia="";"string"==typeof D&&(D=JSON.parse(D)),"string"==typeof M&&(M=JSON.parse(M));var na=Array.isArray(D)&&0<D.length,pa=!Array.isArray(M[0]);if(na&&m){for(var ma=0;ma<D.length;ma++)0<ma&&(ia+=l),ia+=O(D[ma],ma);0<M.length&&(ia+=q)}for(var V=0;V<M.length;V++){var ea=na?D.length:M[V].length,ja=!1,ka=na?0===Object.keys(M[V]).length:0===M[V].length;if(_&&!na&&(ja="greedy"===_?""===M[V].join("").trim():1===M[V].length&&0===M[V][0].length),"greedy"===_&&na){for(var T=[],U=0;U<ea;U++){var ga=pa?D[U]:U;T.push(M[V][ga])}ja=""===T.join("").trim()}if(!ja){for(var P=0;P<ea;P++){0<P&&!ka&&(ia+=l);var fa=na&&pa?D[P]:P;ia+=O(M[V][fa],P)}V<M.length-1&&(!_||0<ea&&!ka)&&(ia+=q)}}return ia}function O(D,M){if(null==D)return"";if(D.constructor===Date)return JSON.stringify(D).slice(1,25);var _=D.toString().replace(X,p),ia="boolean"==typeof h&&h||"function"==typeof h&&h(D,M)||Array.isArray(h)&&h[M]||function(na,pa){for(var ma=0;ma<pa.length;ma++)if(-1<na.indexOf(pa[ma]))return!0;return!1}(_,i.BAD_DELIMITERS)||-1<_.indexOf(l)||" "===_.charAt(0)||" "===_.charAt(_.length-1);return ia?v+_+v:_}}};if(i.RECORD_SEP=String.fromCharCode(30),i.UNIT_SEP=String.fromCharCode(31),i.BYTE_ORDER_MARK="ï»¿",i.BAD_DELIMITERS=["\r",`
`,'"',i.BYTE_ORDER_MARK],i.WORKERS_SUPPORTED=!e&&!!d.Worker,i.NODE_STREAM_INPUT=1,i.LocalChunkSize=10485760,i.RemoteChunkSize=5242880,i.DefaultDelimiter=",",i.Parser=K,i.ParserHandle=z,i.NetworkStreamer=o,i.FileStreamer=s,i.StringStreamer=u,i.ReadableStreamStreamer=w,d.jQuery){var k=d.jQuery;k.fn.parse=function(r){var t=r.config||{},h=[];return this.each(function(q){if(!("INPUT"===k(this).prop("tagName").toUpperCase()&&"file"===k(this).attr("type").toLowerCase()&&d.FileReader)||!this.files||0===this.files.length)return!0;for(var v=0;v<this.files.length;v++)h.push({file:this.files[v],inputElem:this,instanceConfig:k.extend({},t)})}),m(),this;function m(){if(0!==h.length){var q,v,p,E,H=h[0];if(L(r.before)){var X=r.before(H.file,H.inputElem);if("object"==typeof X){if("abort"===X.action)return q="AbortError",v=H.file,p=H.inputElem,E=X.reason,void(L(r.error)&&r.error({name:q},v,p,E));if("skip"===X.action)return void l();"object"==typeof X.config&&(H.instanceConfig=k.extend(H.instanceConfig,X.config))}else if("skip"===X)return void l()}var C=H.instanceConfig.complete;H.instanceConfig.complete=function(Y){L(C)&&C(Y,H.file,H.inputElem),l()},i.parse(H.file,H.instanceConfig)}else L(r.complete)&&r.complete()}function l(){h.splice(0,1),m()}}}function n(r){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(t){var h=Q(t);h.chunkSize=parseInt(h.chunkSize),t.step||t.chunk||(h.chunkSize=null),this._handle=new z(h),(this._handle.streamer=this)._config=h}.call(this,r),this.parseChunk=function(t,h){if(this.isFirstChunk&&L(this._config.beforeFirstChunk)){var m=this._config.beforeFirstChunk(t);void 0!==m&&(t=m)}this.isFirstChunk=!1,this._halted=!1;var l=this._partialLine+t;this._partialLine="";var q=this._handle.parse(l,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var v=q.meta.cursor;this._finished||(this._partialLine=l.substring(v-this._baseIndex),this._baseIndex=v),q&&q.data&&(this._rowCount+=q.data.length);var p=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(f)d.postMessage({results:q,workerId:i.WORKER_ID,finished:p});else if(L(this._config.chunk)&&!h){if(this._config.chunk(q,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);q=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(q.data),this._completeResults.errors=this._completeResults.errors.concat(q.errors),this._completeResults.meta=q.meta),this._completed||!p||!L(this._config.complete)||q&&q.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),p||q&&q.meta.paused||this._nextChunk(),q}this._halted=!0},this._sendError=function(t){L(this._config.error)?this._config.error(t):f&&this._config.error&&d.postMessage({workerId:i.WORKER_ID,error:t,finished:!1})}}function o(r){var t;(r=r||{}).chunkSize||(r.chunkSize=i.RemoteChunkSize),n.call(this,r),this._nextChunk=e?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(h){this._input=h,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest(),this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),e||(t.onload=R(this._chunkLoaded,this),t.onerror=R(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!e),this._config.downloadRequestHeaders){var h=this._config.downloadRequestHeaders;for(var m in h)t.setRequestHeader(m,h[m])}if(this._config.chunkSize){var l=this._start+this._config.chunkSize-1;t.setRequestHeader("Range","bytes="+this._start+"-"+l)}try{t.send(this._config.downloadRequestBody)}catch(q){this._chunkError(q.message)}e&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:t.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(h){var m=h.getResponseHeader("Content-Range");return null===m?-1:parseInt(m.substring(m.lastIndexOf("/")+1))}(t),this.parseChunk(t.responseText)))},this._chunkError=function(h){var m=t.statusText||h;this._sendError(new Error(m))}}function s(r){var t,h;(r=r||{}).chunkSize||(r.chunkSize=i.LocalChunkSize),n.call(this,r);var m="undefined"!=typeof FileReader;this.stream=function(l){this._input=l,h=l.slice||l.webkitSlice||l.mozSlice,m?((t=new FileReader()).onload=R(this._chunkLoaded,this),t.onerror=R(this._chunkError,this)):t=new FileReaderSync(),this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var l=this._input;if(this._config.chunkSize){var q=Math.min(this._start+this._config.chunkSize,this._input.size);l=h.call(l,this._start,q)}var v=t.readAsText(l,this._config.encoding);m||this._chunkLoaded({target:{result:v}})},this._chunkLoaded=function(l){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(l.target.result)},this._chunkError=function(){this._sendError(t.error)}}function u(r){var t;n.call(this,r=r||{}),this.stream=function(h){return t=h,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var h,m=this._config.chunkSize;return m?(h=t.substring(0,m),t=t.substring(m)):(h=t,t=""),this._finished=!t,this.parseChunk(h)}}}function w(r){n.call(this,r=r||{});var t=[],h=!0,m=!1;this.pause=function(){n.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){n.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(l){this._input=l,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){m&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):h=!0},this._streamData=R(function(l){try{t.push("string"==typeof l?l:l.toString(this._config.encoding)),h&&(h=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(q){this._streamError(q)}},this),this._streamError=R(function(l){this._streamCleanUp(),this._sendError(l)},this),this._streamEnd=R(function(){this._streamCleanUp(),m=!0,this._streamData("")},this),this._streamCleanUp=R(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function z(r){var t,h,m,l=Math.pow(2,53),q=-l,v=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)(e[-+]?\d+)?\s*$/,p=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,E=this,H=0,X=0,C=!1,Y=!1,O=[],D={data:[],errors:[],meta:{}};if(L(r.step)){var M=r.step;r.step=function(V){if(D=V,na())ia();else{if(ia(),0===D.data.length)return;H+=V.data.length,r.preview&&H>r.preview?h.abort():(D.data=D.data[0],M(D,E))}}}function _(V){return"greedy"===r.skipEmptyLines?""===V.join("").trim():1===V.length&&0===V[0].length}function ia(){if(D&&m&&(ma("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+i.DefaultDelimiter+"'"),m=!1),r.skipEmptyLines)for(var V=0;V<D.data.length;V++)_(D.data[V])&&D.data.splice(V--,1);return na()&&function(){if(!D)return;function ea(ka){L(r.transformHeader)&&(ka=r.transformHeader(ka)),O.push(ka)}if(Array.isArray(D.data[0])){for(var ja=0;na()&&ja<D.data.length;ja++)D.data[ja].forEach(ea);D.data.splice(0,1)}else D.data.forEach(ea)}(),function(){if(!D||!r.header&&!r.dynamicTyping&&!r.transform)return D;function ea(ka,T){var U,ga=r.header?{}:[];for(U=0;U<ka.length;U++){var P=U,fa=ka[U];r.header&&(P=U>=O.length?"__parsed_extra":O[U]),r.transform&&(fa=r.transform(fa,P)),fa=pa(P,fa),"__parsed_extra"===P?(ga[P]=ga[P]||[],ga[P].push(fa)):ga[P]=fa}return r.header&&(U>O.length?ma("FieldMismatch","TooManyFields","Too many fields: expected "+O.length+" fields but parsed "+U,X+T):U<O.length&&ma("FieldMismatch","TooFewFields","Too few fields: expected "+O.length+" fields but parsed "+U,X+T)),ga}var ja=1;return!D.data.length||Array.isArray(D.data[0])?(D.data=D.data.map(ea),ja=D.data.length):D.data=ea(D.data,0),r.header&&D.meta&&(D.meta.fields=O),X+=ja,D}()}function na(){return r.header&&0===O.length}function pa(V,ea){return ja=V,r.dynamicTypingFunction&&void 0===r.dynamicTyping[ja]&&(r.dynamicTyping[ja]=r.dynamicTypingFunction(ja)),!0===(r.dynamicTyping[ja]||r.dynamicTyping)?"true"===ea||"TRUE"===ea||"false"!==ea&&"FALSE"!==ea&&(function(ka){if(v.test(ka)){var T=parseFloat(ka);if(q<T&&T<l)return!0}return!1}(ea)?parseFloat(ea):p.test(ea)?new Date(ea):""===ea?null:ea):ea;var ja}function ma(V,ea,ja,ka){var T={type:V,code:ea,message:ja};void 0!==ka&&(T.row=ka),D.errors.push(T)}this.parse=function(V,ea,ja){var ka=r.quoteChar||'"';if(r.newline||(r.newline=function(ga,P){ga=ga.substring(0,1048576);var fa=new RegExp(G(P)+"([^]*?)"+G(P),"gm"),S=(ga=ga.replace(fa,"")).split("\r"),wa=ga.split(`
`),y=1<wa.length&&wa[0].length<S[0].length;if(1===S.length||y)return`
`;for(var x=0,B=0;B<S.length;B++)`
`===S[B][0]&&x++;return x>=S.length/2?`\r
`:"\r"}(V,ka)),m=!1,r.delimiter)L(r.delimiter)&&(r.delimiter=r.delimiter(V),D.meta.delimiter=r.delimiter);else{var T=function(ga,P,fa,S,wa){var y,x,B,F;wa=wa||[",","	","|",";",i.RECORD_SEP,i.UNIT_SEP];for(var A=0;A<wa.length;A++){var W=wa[A],aa=0,$=0,ha=0;B=void 0;for(var da=new K({comments:S,delimiter:W,newline:P,preview:10}).parse(ga),sa=0;sa<da.data.length;sa++)if(fa&&_(da.data[sa]))ha++;else{var la=da.data[sa].length;$+=la,void 0!==B?0<la&&(aa+=Math.abs(la-B),B=la):B=la}0<da.data.length&&($/=da.data.length-ha),(void 0===x||aa<=x)&&(void 0===F||F<$)&&1.99<$&&(x=aa,y=W,F=$)}return{successful:!!(r.delimiter=y),bestDelimiter:y}}(V,r.newline,r.skipEmptyLines,r.comments,r.delimitersToGuess);T.successful?r.delimiter=T.bestDelimiter:(m=!0,r.delimiter=i.DefaultDelimiter),D.meta.delimiter=r.delimiter}var U=Q(r);return r.preview&&r.header&&U.preview++,t=V,h=new K(U),D=h.parse(t,ea,ja),ia(),C?{meta:{paused:!0}}:D||{meta:{paused:!1}}},this.paused=function(){return C},this.pause=function(){C=!0,h.abort(),t=L(r.chunk)?"":t.substring(h.getCharIndex())},this.resume=function(){E.streamer._halted?(C=!1,E.streamer.parseChunk(t,!0)):setTimeout(E.resume,3)},this.aborted=function(){return Y},this.abort=function(){Y=!0,h.abort(),D.meta.aborted=!0,L(r.complete)&&r.complete(D),t=""}}function G(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function K(r){var t,h=(r=r||{}).delimiter,m=r.newline,l=r.comments,q=r.step,v=r.preview,p=r.fastMode,E=t=void 0===r.quoteChar?'"':r.quoteChar;if(void 0!==r.escapeChar&&(E=r.escapeChar),("string"!=typeof h||-1<i.BAD_DELIMITERS.indexOf(h))&&(h=","),l===h)throw new Error("Comment character same as delimiter");!0===l?l="#":("string"!=typeof l||-1<i.BAD_DELIMITERS.indexOf(l))&&(l=!1),`
`!==m&&"\r"!==m&&`\r
`!==m&&(m=`
`);var H=0,X=!1;this.parse=function(C,Y,O){if("string"!=typeof C)throw new Error("Input must be a string");var D=C.length,M=h.length,_=m.length,ia=l.length,na=L(q),pa=[],ma=[],V=[],ea=H=0;if(!C)return A();if(p||!1!==p&&-1===C.indexOf(t)){for(var ja=C.split(m),ka=0;ka<ja.length;ka++){if(V=ja[ka],H+=V.length,ka!==ja.length-1)H+=m.length;else if(O)return A();if(!l||V.substring(0,ia)!==l){if(na){if(pa=[],y(V.split(h)),W(),X)return A()}else y(V.split(h));if(v&&v<=ka)return pa=pa.slice(0,v),A(!0)}}return A()}for(var T=C.indexOf(h,H),U=C.indexOf(m,H),ga=new RegExp(G(E)+G(t),"g"),P=C.indexOf(t,H);;)if(C[H]!==t)if(l&&0===V.length&&C.substring(H,H+ia)===l){if(-1===U)return A();H=U+_,U=C.indexOf(m,H),T=C.indexOf(h,H)}else{if(-1!==T&&(T<U||-1===U)){if(!(T<P)){V.push(C.substring(H,T)),H=T+M,T=C.indexOf(h,H);continue}var fa=aa(T,P,U);if(fa&&void 0!==fa.nextDelim){T=fa.nextDelim,P=fa.quoteSearch,V.push(C.substring(H,T)),H=T+M,T=C.indexOf(h,H);continue}}if(-1===U)break;if(V.push(C.substring(H,U)),F(U+_),na&&(W(),X))return A();if(v&&pa.length>=v)return A(!0)}else for(P=H,H++;;){if(-1===(P=C.indexOf(t,P+1)))return O||ma.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:pa.length,index:H}),B();if(P===D-1)return B(C.substring(H,P).replace(ga,t));if(t!==E||C[P+1]!==E){if(t===E||0===P||C[P-1]!==E){-1!==T&&T<P+1&&(T=C.indexOf(h,P+1)),-1!==U&&U<P+1&&(U=C.indexOf(m,P+1));var S=x(-1===U?T:Math.min(T,U));if(C[P+1+S]===h){V.push(C.substring(H,P).replace(ga,t)),C[H=P+1+S+M]!==t&&(P=C.indexOf(t,H)),T=C.indexOf(h,H),U=C.indexOf(m,H);break}var wa=x(U);if(C.substring(P+1+wa,P+1+wa+_)===m){if(V.push(C.substring(H,P).replace(ga,t)),F(P+1+wa+_),T=C.indexOf(h,H),P=C.indexOf(t,H),na&&(W(),X))return A();if(v&&pa.length>=v)return A(!0);break}ma.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:pa.length,index:H}),P++}}else P++}return B();function y($){pa.push($),ea=H}function x($){var ha=0;if(-1!==$){var da=C.substring(P+1,$);da&&""===da.trim()&&(ha=da.length)}return ha}function B($){return O||(void 0===$&&($=C.substring(H)),V.push($),H=D,y(V),na&&W()),A()}function F($){H=$,y(V),V=[],U=C.indexOf(m,H)}function A($){return{data:pa,errors:ma,meta:{delimiter:h,linebreak:m,aborted:X,truncated:!!$,cursor:ea+(Y||0)}}}function W(){q(A()),pa=[],ma=[]}function aa($,ha,da){var sa={nextDelim:void 0,quoteSearch:void 0},la=C.indexOf(t,ha+1);if(ha<$&&$<la&&(la<da||-1===da)){var Aa=C.indexOf(h,la);if(-1===Aa)return sa;la<Aa&&(la=C.indexOf(t,la+1)),sa=aa(Aa,la,da)}else sa={nextDelim:$,quoteSearch:ha};return sa}},this.abort=function(){X=!0},this.getCharIndex=function(){return H}}function I(r){var t=r.data,h=g[t.workerId],m=!1;if(t.error)h.userError(t.error,t.file);else if(t.results&&t.results.data){var l={abort:function(){m=!0,N(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:J,resume:J};if(L(h.userStep)){for(var q=0;q<t.results.data.length&&(h.userStep({data:t.results.data[q],errors:t.results.errors,meta:t.results.meta},l),!m);q++);delete t.results}else L(h.userChunk)&&(h.userChunk(t.results,l,t.file),delete t.results)}t.finished&&!m&&N(t.workerId,t.results)}function N(r,t){var h=g[r];L(h.userComplete)&&h.userComplete(t),h.terminate(),delete g[r]}function J(){throw new Error("Not implemented.")}function Q(r){if("object"!=typeof r||null===r)return r;var t=Array.isArray(r)?[]:{};for(var h in r)t[h]=Q(r[h]);return t}function R(r,t){return function(){r.apply(t,arguments)}}function L(r){return"function"==typeof r}return f&&(d.onmessage=function(r){var t=r.data;void 0===i.WORKER_ID&&t&&(i.WORKER_ID=t.workerId);if("string"==typeof t.input)d.postMessage({workerId:i.WORKER_ID,results:i.parse(t.input,t.config),finished:!0});else if(d.File&&t.input instanceof File||t.input instanceof Object){var h=i.parse(t.input,t.config);h&&d.postMessage({workerId:i.WORKER_ID,results:h,finished:!0})}}),(o.prototype=Object.create(n.prototype)).constructor=o,(s.prototype=Object.create(n.prototype)).constructor=s,(u.prototype=Object.create(u.prototype)).constructor=u,(w.prototype=Object.create(n.prototype)).constructor=w,i})});var Yi=kb(r=>{qc(r,{__assign:()=>c,__asyncDelegator:()=>K,__asyncGenerator:()=>G,__asyncValues:()=>I,__await:()=>z,__awaiter:()=>j,__classPrivateFieldGet:()=>R,__classPrivateFieldSet:()=>L,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>Q,__importStar:()=>J,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>s,__rest:()=>d,__spread:()=>u,__spreadArrays:()=>w,__values:()=>o});var a=function(h,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,q){l.__proto__=q}||function(l,q){for(var v in q)q.hasOwnProperty(v)&&(l[v]=q[v])},a(h,m)};function b(h,m){a(h,m);function l(){this.constructor=h}h.prototype=m===null?Object.create(m):(l.prototype=m.prototype,new l())}var c=function(){return c=Object.assign||function h(m){for(var l,q=1,v=arguments.length;q<v;q++){l=arguments[q];for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(m[p]=l[p])}return m},c.apply(this,arguments)};function d(h,m){var l={};for(var q in h)Object.prototype.hasOwnProperty.call(h,q)&&m.indexOf(q)<0&&(l[q]=h[q]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var v=0,q=Object.getOwnPropertySymbols(h);v<q.length;v++)m.indexOf(q[v])<0&&Object.prototype.propertyIsEnumerable.call(h,q[v])&&(l[q[v]]=h[q[v]]);return l}function e(h,m,l,q){var v=arguments.length,p=v<3?m:q===null?q=Object.getOwnPropertyDescriptor(m,l):q,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")p=Reflect.decorate(h,m,l,q);else for(var H=h.length-1;H>=0;H--)(E=h[H])&&(p=(v<3?E(p):v>3?E(m,l,p):E(m,l))||p);return v>3&&p&&Object.defineProperty(m,l,p),p}function f(h,m){return function(l,q){m(l,q,h)}}function g(h,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,m)}function j(h,m,l,q){function v(p){return p instanceof l?p:new l(function(E){E(p)})}return new(l||(l=Promise))(function(p,E){function H(Y){try{C(q.next(Y))}catch(O){E(O)}}function X(Y){try{C(q.throw(Y))}catch(O){E(O)}}function C(Y){Y.done?p(Y.value):v(Y.value).then(H,X)}C((q=q.apply(h,m||[])).next())})}function i(h,m){var l={label:0,sent:function(){if(p[0]&1)throw p[1];return p[1]},trys:[],ops:[]},q,v,p,E;return E={next:H(0),throw:H(1),return:H(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function H(C){return function(Y){return X([C,Y])}}function X(C){if(q)throw new TypeError("Generator is already executing.");for(;l;)try{if(q=1,v&&(p=C[0]&2?v.return:C[0]?v.throw||((p=v.return)&&p.call(v),0):v.next)&&!(p=p.call(v,C[1])).done)return p;(v=0,p)&&(C=[C[0]&2,p.value]);switch(C[0]){case 0:case 1:p=C;break;case 4:return l.label++,{value:C[1],done:!1};case 5:l.label++,v=C[1],C=[0];continue;case 7:C=l.ops.pop(),l.trys.pop();continue;default:if(!(p=l.trys,p=p.length>0&&p[p.length-1])&&(C[0]===6||C[0]===2)){l=0;continue}if(C[0]===3&&(!p||C[1]>p[0]&&C[1]<p[3])){l.label=C[1];break}if(C[0]===6&&l.label<p[1]){l.label=p[1],p=C;break}if(p&&l.label<p[2]){l.label=p[2],l.ops.push(C);break}p[2]&&l.ops.pop(),l.trys.pop();continue}C=m.call(h,l)}catch(Y){C=[6,Y],v=0}finally{q=p=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}}function k(h,m,l,q){q===void 0&&(q=l),h[q]=m[l]}function n(h,m){for(var l in h)l!=="default"&&!m.hasOwnProperty(l)&&(m[l]=h[l])}function o(h){var m=typeof Symbol==="function"&&Symbol.iterator,l=m&&h[m],q=0;if(l)return l.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&q>=h.length&&(h=void 0),{value:h&&h[q++],done:!h}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(h,m){var l=typeof Symbol==="function"&&h[Symbol.iterator];if(!l)return h;var q=l.call(h),v,p=[],E;try{for(;(m===void 0||m-- >0)&&!(v=q.next()).done;)p.push(v.value)}catch(H){E={error:H}}finally{try{v&&!v.done&&(l=q.return)&&l.call(q)}finally{if(E)throw E.error}}return p}function u(){for(var h=[],m=0;m<arguments.length;m++)h=h.concat(s(arguments[m]));return h}function w(){for(var h=0,m=0,l=arguments.length;m<l;m++)h+=arguments[m].length;for(var q=Array(h),v=0,m=0;m<l;m++)for(var p=arguments[m],E=0,H=p.length;E<H;E++,v++)q[v]=p[E];return q}function z(h){return this instanceof z?(this.v=h,this):new z(h)}function G(h,m,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var q=l.apply(h,m||[]),v,p=[];return v={},E("next"),E("throw"),E("return"),v[Symbol.asyncIterator]=function(){return this},v;function E(D){q[D]&&(v[D]=function(M){return new Promise(function(_,ia){p.push([D,M,_,ia])>1||H(D,M)})})}function H(D,M){try{X(q[D](M))}catch(_){O(p[0][3],_)}}function X(D){D.value instanceof z?Promise.resolve(D.value.v).then(C,Y):O(p[0][2],D)}function C(D){H("next",D)}function Y(D){H("throw",D)}function O(D,M){(D(M),p.shift(),p.length)&&H(p[0][0],p[0][1])}}function K(h){var m,l;return m={},q("next"),q("throw",function(v){throw v}),q("return"),m[Symbol.iterator]=function(){return this},m;function q(v,p){m[v]=h[v]?function(E){return(l=!l)?{value:z(h[v](E)),done:v==="return"}:p?p(E):E}:p}}function I(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=h[Symbol.asyncIterator],l;return m?m.call(h):(h=typeof o==="function"?o(h):h[Symbol.iterator](),l={},q("next"),q("throw"),q("return"),l[Symbol.asyncIterator]=function(){return this},l);function q(p){l[p]=h[p]&&function(E){return new Promise(function(H,X){E=h[p](E),v(H,X,E.done,E.value)})}}function v(p,E,H,X){Promise.resolve(X).then(function(C){p({value:C,done:H})},E)}}function N(h,m){return Object.defineProperty?Object.defineProperty(h,"raw",{value:m}):h.raw=m,h}function J(h){if(h&&h.__esModule)return h;var m={};if(h!=null)for(var l in h)Object.hasOwnProperty.call(h,l)&&(m[l]=h[l]);return m.default=h,m}function Q(h){return h&&h.__esModule?h:{default:h}}function R(h,m){if(!m.has(h))throw new TypeError("attempted to get private field on non-instance");return m.get(h)}function L(h,m,l){if(!m.has(h))throw new TypeError("attempted to set private field on non-instance");return m.set(h,l),l}});var aj=kb(r=>{qc(r,{__assign:()=>c,__asyncDelegator:()=>K,__asyncGenerator:()=>G,__asyncValues:()=>I,__await:()=>z,__awaiter:()=>j,__classPrivateFieldGet:()=>R,__classPrivateFieldSet:()=>L,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>Q,__importStar:()=>J,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>s,__rest:()=>d,__spread:()=>u,__spreadArrays:()=>w,__values:()=>o});var a=function(h,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,q){l.__proto__=q}||function(l,q){for(var v in q)q.hasOwnProperty(v)&&(l[v]=q[v])},a(h,m)};function b(h,m){a(h,m);function l(){this.constructor=h}h.prototype=m===null?Object.create(m):(l.prototype=m.prototype,new l())}var c=function(){return c=Object.assign||function h(m){for(var l,q=1,v=arguments.length;q<v;q++){l=arguments[q];for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(m[p]=l[p])}return m},c.apply(this,arguments)};function d(h,m){var l={};for(var q in h)Object.prototype.hasOwnProperty.call(h,q)&&m.indexOf(q)<0&&(l[q]=h[q]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var v=0,q=Object.getOwnPropertySymbols(h);v<q.length;v++)m.indexOf(q[v])<0&&Object.prototype.propertyIsEnumerable.call(h,q[v])&&(l[q[v]]=h[q[v]]);return l}function e(h,m,l,q){var v=arguments.length,p=v<3?m:q===null?q=Object.getOwnPropertyDescriptor(m,l):q,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")p=Reflect.decorate(h,m,l,q);else for(var H=h.length-1;H>=0;H--)(E=h[H])&&(p=(v<3?E(p):v>3?E(m,l,p):E(m,l))||p);return v>3&&p&&Object.defineProperty(m,l,p),p}function f(h,m){return function(l,q){m(l,q,h)}}function g(h,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,m)}function j(h,m,l,q){function v(p){return p instanceof l?p:new l(function(E){E(p)})}return new(l||(l=Promise))(function(p,E){function H(Y){try{C(q.next(Y))}catch(O){E(O)}}function X(Y){try{C(q.throw(Y))}catch(O){E(O)}}function C(Y){Y.done?p(Y.value):v(Y.value).then(H,X)}C((q=q.apply(h,m||[])).next())})}function i(h,m){var l={label:0,sent:function(){if(p[0]&1)throw p[1];return p[1]},trys:[],ops:[]},q,v,p,E;return E={next:H(0),throw:H(1),return:H(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function H(C){return function(Y){return X([C,Y])}}function X(C){if(q)throw new TypeError("Generator is already executing.");for(;l;)try{if(q=1,v&&(p=C[0]&2?v.return:C[0]?v.throw||((p=v.return)&&p.call(v),0):v.next)&&!(p=p.call(v,C[1])).done)return p;(v=0,p)&&(C=[C[0]&2,p.value]);switch(C[0]){case 0:case 1:p=C;break;case 4:return l.label++,{value:C[1],done:!1};case 5:l.label++,v=C[1],C=[0];continue;case 7:C=l.ops.pop(),l.trys.pop();continue;default:if(!(p=l.trys,p=p.length>0&&p[p.length-1])&&(C[0]===6||C[0]===2)){l=0;continue}if(C[0]===3&&(!p||C[1]>p[0]&&C[1]<p[3])){l.label=C[1];break}if(C[0]===6&&l.label<p[1]){l.label=p[1],p=C;break}if(p&&l.label<p[2]){l.label=p[2],l.ops.push(C);break}p[2]&&l.ops.pop(),l.trys.pop();continue}C=m.call(h,l)}catch(Y){C=[6,Y],v=0}finally{q=p=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}}function k(h,m,l,q){q===void 0&&(q=l),h[q]=m[l]}function n(h,m){for(var l in h)l!=="default"&&!m.hasOwnProperty(l)&&(m[l]=h[l])}function o(h){var m=typeof Symbol==="function"&&Symbol.iterator,l=m&&h[m],q=0;if(l)return l.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&q>=h.length&&(h=void 0),{value:h&&h[q++],done:!h}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(h,m){var l=typeof Symbol==="function"&&h[Symbol.iterator];if(!l)return h;var q=l.call(h),v,p=[],E;try{for(;(m===void 0||m-- >0)&&!(v=q.next()).done;)p.push(v.value)}catch(H){E={error:H}}finally{try{v&&!v.done&&(l=q.return)&&l.call(q)}finally{if(E)throw E.error}}return p}function u(){for(var h=[],m=0;m<arguments.length;m++)h=h.concat(s(arguments[m]));return h}function w(){for(var h=0,m=0,l=arguments.length;m<l;m++)h+=arguments[m].length;for(var q=Array(h),v=0,m=0;m<l;m++)for(var p=arguments[m],E=0,H=p.length;E<H;E++,v++)q[v]=p[E];return q}function z(h){return this instanceof z?(this.v=h,this):new z(h)}function G(h,m,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var q=l.apply(h,m||[]),v,p=[];return v={},E("next"),E("throw"),E("return"),v[Symbol.asyncIterator]=function(){return this},v;function E(D){q[D]&&(v[D]=function(M){return new Promise(function(_,ia){p.push([D,M,_,ia])>1||H(D,M)})})}function H(D,M){try{X(q[D](M))}catch(_){O(p[0][3],_)}}function X(D){D.value instanceof z?Promise.resolve(D.value.v).then(C,Y):O(p[0][2],D)}function C(D){H("next",D)}function Y(D){H("throw",D)}function O(D,M){(D(M),p.shift(),p.length)&&H(p[0][0],p[0][1])}}function K(h){var m,l;return m={},q("next"),q("throw",function(v){throw v}),q("return"),m[Symbol.iterator]=function(){return this},m;function q(v,p){m[v]=h[v]?function(E){return(l=!l)?{value:z(h[v](E)),done:v==="return"}:p?p(E):E}:p}}function I(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=h[Symbol.asyncIterator],l;return m?m.call(h):(h=typeof o==="function"?o(h):h[Symbol.iterator](),l={},q("next"),q("throw"),q("return"),l[Symbol.asyncIterator]=function(){return this},l);function q(p){l[p]=h[p]&&function(E){return new Promise(function(H,X){E=h[p](E),v(H,X,E.done,E.value)})}}function v(p,E,H,X){Promise.resolve(X).then(function(C){p({value:C,done:H})},E)}}function N(h,m){return Object.defineProperty?Object.defineProperty(h,"raw",{value:m}):h.raw=m,h}function J(h){if(h&&h.__esModule)return h;var m={};if(h!=null)for(var l in h)Object.hasOwnProperty.call(h,l)&&(m[l]=h[l]);return m.default=h,m}function Q(h){return h&&h.__esModule?h:{default:h}}function R(h,m){if(!m.has(h))throw new TypeError("attempted to get private field on non-instance");return m.get(h)}function L(h,m,l){if(!m.has(h))throw new TypeError("attempted to set private field on non-instance");return m.set(h,l),l}});var Nf=kb(S=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0});var a=aj();var b={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};var c=function(y,x){if(!y)throw d(x)},d=function(y){return new Error("Firebase Database ("+b.SDK_VERSION+") INTERNAL ASSERT FAILED: "+y)};var e=function(y){for(var x=[],B=0,F=0;F<y.length;F++){var A=y.charCodeAt(F);A<128?x[B++]=A:A<2048?(x[B++]=A>>6|192,x[B++]=A&63|128):(A&64512)===55296&&F+1<y.length&&(y.charCodeAt(F+1)&64512)===56320?(A=65536+((A&1023)<<10)+(y.charCodeAt(++F)&1023),x[B++]=A>>18|240,x[B++]=A>>12&63|128,x[B++]=A>>6&63|128,x[B++]=A&63|128):(x[B++]=A>>12|224,x[B++]=A>>6&63|128,x[B++]=A&63|128)}return x},f=function(y){for(var x=[],B=0,F=0;B<y.length;){var A=y[B++];if(A<128)x[F++]=String.fromCharCode(A);else if(A>191&&A<224){var W=y[B++];x[F++]=String.fromCharCode((A&31)<<6|W&63)}else if(A>239&&A<365){var W=y[B++],aa=y[B++],$=y[B++],ha=((A&7)<<18|(W&63)<<12|(aa&63)<<6|$&63)-65536;x[F++]=String.fromCharCode(55296+(ha>>10)),x[F++]=String.fromCharCode(56320+(ha&1023))}else{var W=y[B++],aa=y[B++];x[F++]=String.fromCharCode((A&15)<<12|(W&63)<<6|aa&63)}}return x.join("")},g={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob==="function",encodeByteArray:function(y,x){if(!Array.isArray(y))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var B=x?this.byteToCharMapWebSafe_:this.byteToCharMap_,F=[],A=0;A<y.length;A+=3){var W=y[A],aa=A+1<y.length,$=aa?y[A+1]:0,ha=A+2<y.length,da=ha?y[A+2]:0,sa=W>>2,la=(W&3)<<4|$>>4,Aa=($&15)<<2|da>>6,Df=da&63;ha||(Df=64,aa||(Aa=64)),F.push(B[sa],B[la],B[Aa],B[Df])}return F.join("")},encodeString:function(y,x){return this.HAS_NATIVE_SUPPORT&&!x?btoa(y):this.encodeByteArray(e(y),x)},decodeString:function(y,x){return this.HAS_NATIVE_SUPPORT&&!x?atob(y):f(this.decodeStringToByteArray(y,x))},decodeStringToByteArray:function(y,x){this.init_();for(var B=x?this.charToByteMapWebSafe_:this.charToByteMap_,F=[],A=0;A<y.length;){var W=B[y.charAt(A++)],aa=A<y.length,$=aa?B[y.charAt(A)]:0;++A;var ha=A<y.length,da=ha?B[y.charAt(A)]:64;++A;var sa=A<y.length,la=sa?B[y.charAt(A)]:64;++A;if(W==null||$==null||da==null||la==null)throw Error();var Aa=W<<2|$>>4;F.push(Aa);if(da!==64){var Df=$<<4&240|da>>2;F.push(Df);if(la!==64){var nr=da<<6&192|la;F.push(nr)}}}return F},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var y=0;y<this.ENCODED_VALS.length;y++)this.byteToCharMap_[y]=this.ENCODED_VALS.charAt(y),this.charToByteMap_[this.byteToCharMap_[y]]=y,this.byteToCharMapWebSafe_[y]=this.ENCODED_VALS_WEBSAFE.charAt(y),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[y]]=y,y>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(y)]=y,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(y)]=y)}}},j=function(y){var x=e(y);return g.encodeByteArray(x,!0)},i=function(y){try{return g.decodeString(y,!0)}catch(x){console.error("base64Decode failed: ",x)}return null};function k(y){return n(void 0,y)}function n(y,x){if(!(x instanceof Object))return x;switch(x.constructor){case Date:var B=x;return new Date(B.getTime());case Object:y===void 0&&(y={});break;case Array:y=[];break;default:return x}for(var F in x){if(!x.hasOwnProperty(F))continue;y[F]=n(y[F],x[F])}return y}var o=function(){function y(){var x=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(B,F){x.resolve=B,x.reject=F})}return y.prototype.wrapCallback=function(x){var B=this;return function(F,A){F?B.reject(F):B.resolve(A),typeof x==="function"&&(B.promise.catch(function(){}),x.length===1?x(F):x(F,A))}},y}();function s(){return typeof navigator!=="undefined"&&typeof navigator.userAgent==="string"?navigator.userAgent:""}function u(){return typeof window!=="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(s())}function w(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(y){return!1}}function z(){return typeof self==="object"&&self.self===self}function G(){var y=typeof chrome==="object"?chrome.runtime:typeof browser==="object"?browser.runtime:void 0;return typeof y==="object"&&y.id!==void 0}function K(){return typeof navigator==="object"&&navigator.product==="ReactNative"}function I(){return s().indexOf("Electron/")>=0}function N(){var y=s();return y.indexOf("MSIE ")>=0||y.indexOf("Trident/")>=0}function J(){return s().indexOf("MSAppHost/")>=0}function Q(){return b.NODE_CLIENT===!0||b.NODE_ADMIN===!0}function R(){return!w()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}var L="FirebaseError",r=function(y){a.__extends(x,y);function x(B,F){var A=y.call(this,F)||this;return A.code=B,A.name=L,Object.setPrototypeOf(A,x.prototype),Error.captureStackTrace&&Error.captureStackTrace(A,t.prototype.create),A}return x}(Error),t=function(){function y(x,B,F){this.service=x,this.serviceName=B,this.errors=F}return y.prototype.create=function(x){for(var B=[],F=1;F<arguments.length;F++)B[F-1]=arguments[F];for(var A=B[0]||{},W=this.service+"/"+x,aa=this.errors[x],$=aa?h(aa,A):"Error",ha=this.serviceName+": "+$+" ("+W+").",da=new r(W,ha),sa=0,la=Object.keys(A);sa<la.length;sa++){var Aa=la[sa];Aa.slice(-1)!=="_"&&(Aa in da&&console.warn('Overwriting FirebaseError base field "'+Aa+'" can cause unexpected behavior.'),da[Aa]=A[Aa])}return da},y}();function h(y,x){return y.replace(m,function(B,F){var A=x[F];return A!=null?String(A):"<"+F+"?>"})}var m=/\{\$([^}]+)}/g;function l(y){return JSON.parse(y)}function q(y){return JSON.stringify(y)}var v=function(y){var x={},B={},F={},A="";try{var W=y.split(".");x=l(i(W[0])||""),B=l(i(W[1])||""),A=W[2],F=B.d||{},delete B.d}catch(aa){}return{header:x,claims:B,data:F,signature:A}},p=function(y){var x=v(y).claims,B=Math.floor(new Date().getTime()/1e3),F=0,A=0;return typeof x==="object"&&(x.hasOwnProperty("nbf")?F=x.nbf:x.hasOwnProperty("iat")&&(F=x.iat),x.hasOwnProperty("exp")?A=x.exp:A=F+86400),!!B&&!!F&&!!A&&B>=F&&B<=A},E=function(y){var x=v(y).claims;return typeof x==="object"&&x.hasOwnProperty("iat")?x.iat:null},H=function(y){var x=v(y),B=x.claims;return!!B&&typeof B==="object"&&B.hasOwnProperty("iat")},X=function(y){var x=v(y).claims;return typeof x==="object"&&x.admin===!0};function C(y,x){return Object.prototype.hasOwnProperty.call(y,x)}function Y(y,x){return Object.prototype.hasOwnProperty.call(y,x)?y[x]:void 0}function O(y){for(var x in y)if(Object.prototype.hasOwnProperty.call(y,x))return!1;return!0}function D(y,x,B){var F={};for(var A in y)Object.prototype.hasOwnProperty.call(y,A)&&(F[A]=x.call(B,y[A],A,y));return F}function M(y){for(var x=[],B=function(ha,da){Array.isArray(da)?da.forEach(function(sa){x.push(encodeURIComponent(ha)+"="+encodeURIComponent(sa))}):x.push(encodeURIComponent(ha)+"="+encodeURIComponent(da))},F=0,A=Object.entries(y);F<A.length;F++){var W=A[F],aa=W[0],$=W[1];B(aa,$)}return x.length?"&"+x.join("&"):""}function _(y){var x={},B=y.replace(/^\?/,"").split("&");return B.forEach(function(F){if(F){var A=F.split("=");x[A[0]]=A[1]}}),x}var ia=function(){function y(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(var x=1;x<this.blockSize;++x)this.pad_[x]=0;this.reset()}return y.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},y.prototype.compress_=function(x,B){B||(B=0);var F=this.W_;if(typeof x==="string")for(var A=0;A<16;A++)F[A]=x.charCodeAt(B)<<24|x.charCodeAt(B+1)<<16|x.charCodeAt(B+2)<<8|x.charCodeAt(B+3),B+=4;else for(var A=0;A<16;A++)F[A]=x[B]<<24|x[B+1]<<16|x[B+2]<<8|x[B+3],B+=4;for(var A=16;A<80;A++){var W=F[A-3]^F[A-8]^F[A-14]^F[A-16];F[A]=(W<<1|W>>>31)&4294967295}for(var aa=this.chain_[0],$=this.chain_[1],ha=this.chain_[2],da=this.chain_[3],sa=this.chain_[4],la,Aa,A=0;A<80;A++){A<40?A<20?(la=da^$&(ha^da),Aa=1518500249):(la=$^ha^da,Aa=1859775393):A<60?(la=$&ha|da&($|ha),Aa=2400959708):(la=$^ha^da,Aa=3395469782);var W=(aa<<5|aa>>>27)+la+sa+Aa+F[A]&4294967295;sa=da,da=ha,ha=($<<30|$>>>2)&4294967295,$=aa,aa=W}this.chain_[0]=this.chain_[0]+aa&4294967295,this.chain_[1]=this.chain_[1]+$&4294967295,this.chain_[2]=this.chain_[2]+ha&4294967295,this.chain_[3]=this.chain_[3]+da&4294967295,this.chain_[4]=this.chain_[4]+sa&4294967295},y.prototype.update=function(x,B){if(x==null)return;B===void 0&&(B=x.length);for(var F=B-this.blockSize,A=0,W=this.buf_,aa=this.inbuf_;A<B;){if(aa===0)for(;A<=F;)this.compress_(x,A),A+=this.blockSize;if(typeof x==="string")for(;A<B;){W[aa]=x.charCodeAt(A),++aa,++A;if(aa===this.blockSize){this.compress_(W),aa=0;break}}else for(;A<B;){W[aa]=x[A],++aa,++A;if(aa===this.blockSize){this.compress_(W),aa=0;break}}}this.inbuf_=aa,this.total_+=B},y.prototype.digest=function(){var x=[],B=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var F=this.blockSize-1;F>=56;F--)this.buf_[F]=B&255,B/=256;this.compress_(this.buf_);for(var A=0,F=0;F<5;F++)for(var W=24;W>=0;W-=8)x[A]=this.chain_[F]>>W&255,++A;return x},y}();function na(y,x){var B=new pa(y,x);return B.subscribe.bind(B)}var pa=function(){function y(x,B){var F=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=B,this.task.then(function(){x(F)}).catch(function(A){F.error(A)})}return y.prototype.next=function(x){this.forEachObserver(function(B){B.next(x)})},y.prototype.error=function(x){this.forEachObserver(function(B){B.error(x)}),this.close(x)},y.prototype.complete=function(){this.forEachObserver(function(x){x.complete()}),this.close()},y.prototype.subscribe=function(x,B,F){var A=this,W;if(x===void 0&&B===void 0&&F===void 0)throw new Error("Missing Observer.");V(x,["next","error","complete"])?W=x:W={next:x,error:B,complete:F},W.next===void 0&&(W.next=ea),W.error===void 0&&(W.error=ea),W.complete===void 0&&(W.complete=ea);var aa=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{A.finalError?W.error(A.finalError):W.complete()}catch($){}return}),this.observers.push(W),aa},y.prototype.unsubscribeOne=function(x){if(this.observers===void 0||this.observers[x]===void 0)return;delete this.observers[x],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this)},y.prototype.forEachObserver=function(x){if(this.finalized)return;for(var B=0;B<this.observers.length;B++)this.sendOne(B,x)},y.prototype.sendOne=function(x,B){var F=this;this.task.then(function(){if(F.observers!==void 0&&F.observers[x]!==void 0)try{B(F.observers[x])}catch(A){typeof console!=="undefined"&&console.error&&console.error(A)}})},y.prototype.close=function(x){var B=this;if(this.finalized)return;this.finalized=!0,x!==void 0&&(this.finalError=x),this.task.then(function(){B.observers=void 0,B.onNoObservers=void 0})},y}();function ma(y,x){return function(){for(var B=[],F=0;F<arguments.length;F++)B[F]=arguments[F];Promise.resolve(!0).then(function(){y.apply(void 0,B)}).catch(function(A){x&&x(A)})}}function V(y,x){if(typeof y!=="object"||y===null)return!1;for(var B=0,F=x;B<F.length;B++){var A=F[B];if(A in y&&typeof y[A]==="function")return!0}return!1}function ea(){}var ja=function(y,x,B,F){var A;F<x?A="at least "+x:F>B&&(A=B===0?"none":"no more than "+B);if(A){var W=y+" failed: Was called with "+F+(F===1?" argument.":" arguments.")+" Expects "+A+".";throw new Error(W)}};function ka(y,x,B){var F="";switch(x){case 1:F=B?"first":"First";break;case 2:F=B?"second":"Second";break;case 3:F=B?"third":"Third";break;case 4:F=B?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var A=y+" failed: ";return A+=F+" argument ",A}function T(y,x,B,F){if(F&&!B)return;if(typeof B!=="string")throw new Error(ka(y,x,F)+"must be a valid firebase namespace.")}function U(y,x,B,F){if(F&&!B)return;if(typeof B!=="function")throw new Error(ka(y,x,F)+"must be a valid function.")}function ga(y,x,B,F){if(F&&!B)return;if(typeof B!=="object"||B===null)throw new Error(ka(y,x,F)+"must be a valid context object.")}var P=function(y){for(var x=[],B=0,F=0;F<y.length;F++){var A=y.charCodeAt(F);if(A>=55296&&A<=56319){var W=A-55296;F++,c(F<y.length,"Surrogate pair missing trail surrogate.");var aa=y.charCodeAt(F)-56320;A=65536+(W<<10)+aa}A<128?x[B++]=A:A<2048?(x[B++]=A>>6|192,x[B++]=A&63|128):A<65536?(x[B++]=A>>12|224,x[B++]=A>>6&63|128,x[B++]=A&63|128):(x[B++]=A>>18|240,x[B++]=A>>12&63|128,x[B++]=A>>6&63|128,x[B++]=A&63|128)}return x},fa=function(y){for(var x=0,B=0;B<y.length;B++){var F=y.charCodeAt(B);F<128?x++:F<2048?x+=2:F>=55296&&F<=56319?(x+=4,B++):x+=3}return x};S.CONSTANTS=b;S.Deferred=o;S.ErrorFactory=t;S.FirebaseError=r;S.Sha1=ia;S.assert=c;S.assertionError=d;S.async=ma;S.base64=g;S.base64Decode=i;S.base64Encode=j;S.contains=C;S.createSubscribe=na;S.decode=v;S.deepCopy=k;S.deepExtend=n;S.errorPrefix=ka;S.getUA=s;S.isAdmin=X;S.isBrowser=z;S.isBrowserExtension=G;S.isElectron=I;S.isEmpty=O;S.isIE=N;S.isMobileCordova=u;S.isNode=w;S.isNodeSdk=Q;S.isReactNative=K;S.isSafari=R;S.isUWP=J;S.isValidFormat=H;S.isValidTimestamp=p;S.issuedAtTime=E;S.jsonEval=l;S.map=D;S.querystring=M;S.querystringDecode=_;S.safeGet=Y;S.stringLength=fa;S.stringToByteArray=P;S.stringify=q;S.validateArgCount=ja;S.validateCallback=U;S.validateContextObject=ga;S.validateNamespace=T});var _i=kb(r=>{qc(r,{__assign:()=>c,__asyncDelegator:()=>K,__asyncGenerator:()=>G,__asyncValues:()=>I,__await:()=>z,__awaiter:()=>j,__classPrivateFieldGet:()=>R,__classPrivateFieldSet:()=>L,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>Q,__importStar:()=>J,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>s,__rest:()=>d,__spread:()=>u,__spreadArrays:()=>w,__values:()=>o});var a=function(h,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,q){l.__proto__=q}||function(l,q){for(var v in q)q.hasOwnProperty(v)&&(l[v]=q[v])},a(h,m)};function b(h,m){a(h,m);function l(){this.constructor=h}h.prototype=m===null?Object.create(m):(l.prototype=m.prototype,new l())}var c=function(){return c=Object.assign||function h(m){for(var l,q=1,v=arguments.length;q<v;q++){l=arguments[q];for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(m[p]=l[p])}return m},c.apply(this,arguments)};function d(h,m){var l={};for(var q in h)Object.prototype.hasOwnProperty.call(h,q)&&m.indexOf(q)<0&&(l[q]=h[q]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var v=0,q=Object.getOwnPropertySymbols(h);v<q.length;v++)m.indexOf(q[v])<0&&Object.prototype.propertyIsEnumerable.call(h,q[v])&&(l[q[v]]=h[q[v]]);return l}function e(h,m,l,q){var v=arguments.length,p=v<3?m:q===null?q=Object.getOwnPropertyDescriptor(m,l):q,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")p=Reflect.decorate(h,m,l,q);else for(var H=h.length-1;H>=0;H--)(E=h[H])&&(p=(v<3?E(p):v>3?E(m,l,p):E(m,l))||p);return v>3&&p&&Object.defineProperty(m,l,p),p}function f(h,m){return function(l,q){m(l,q,h)}}function g(h,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,m)}function j(h,m,l,q){function v(p){return p instanceof l?p:new l(function(E){E(p)})}return new(l||(l=Promise))(function(p,E){function H(Y){try{C(q.next(Y))}catch(O){E(O)}}function X(Y){try{C(q.throw(Y))}catch(O){E(O)}}function C(Y){Y.done?p(Y.value):v(Y.value).then(H,X)}C((q=q.apply(h,m||[])).next())})}function i(h,m){var l={label:0,sent:function(){if(p[0]&1)throw p[1];return p[1]},trys:[],ops:[]},q,v,p,E;return E={next:H(0),throw:H(1),return:H(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function H(C){return function(Y){return X([C,Y])}}function X(C){if(q)throw new TypeError("Generator is already executing.");for(;l;)try{if(q=1,v&&(p=C[0]&2?v.return:C[0]?v.throw||((p=v.return)&&p.call(v),0):v.next)&&!(p=p.call(v,C[1])).done)return p;(v=0,p)&&(C=[C[0]&2,p.value]);switch(C[0]){case 0:case 1:p=C;break;case 4:return l.label++,{value:C[1],done:!1};case 5:l.label++,v=C[1],C=[0];continue;case 7:C=l.ops.pop(),l.trys.pop();continue;default:if(!(p=l.trys,p=p.length>0&&p[p.length-1])&&(C[0]===6||C[0]===2)){l=0;continue}if(C[0]===3&&(!p||C[1]>p[0]&&C[1]<p[3])){l.label=C[1];break}if(C[0]===6&&l.label<p[1]){l.label=p[1],p=C;break}if(p&&l.label<p[2]){l.label=p[2],l.ops.push(C);break}p[2]&&l.ops.pop(),l.trys.pop();continue}C=m.call(h,l)}catch(Y){C=[6,Y],v=0}finally{q=p=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}}function k(h,m,l,q){q===void 0&&(q=l),h[q]=m[l]}function n(h,m){for(var l in h)l!=="default"&&!m.hasOwnProperty(l)&&(m[l]=h[l])}function o(h){var m=typeof Symbol==="function"&&Symbol.iterator,l=m&&h[m],q=0;if(l)return l.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&q>=h.length&&(h=void 0),{value:h&&h[q++],done:!h}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(h,m){var l=typeof Symbol==="function"&&h[Symbol.iterator];if(!l)return h;var q=l.call(h),v,p=[],E;try{for(;(m===void 0||m-- >0)&&!(v=q.next()).done;)p.push(v.value)}catch(H){E={error:H}}finally{try{v&&!v.done&&(l=q.return)&&l.call(q)}finally{if(E)throw E.error}}return p}function u(){for(var h=[],m=0;m<arguments.length;m++)h=h.concat(s(arguments[m]));return h}function w(){for(var h=0,m=0,l=arguments.length;m<l;m++)h+=arguments[m].length;for(var q=Array(h),v=0,m=0;m<l;m++)for(var p=arguments[m],E=0,H=p.length;E<H;E++,v++)q[v]=p[E];return q}function z(h){return this instanceof z?(this.v=h,this):new z(h)}function G(h,m,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var q=l.apply(h,m||[]),v,p=[];return v={},E("next"),E("throw"),E("return"),v[Symbol.asyncIterator]=function(){return this},v;function E(D){q[D]&&(v[D]=function(M){return new Promise(function(_,ia){p.push([D,M,_,ia])>1||H(D,M)})})}function H(D,M){try{X(q[D](M))}catch(_){O(p[0][3],_)}}function X(D){D.value instanceof z?Promise.resolve(D.value.v).then(C,Y):O(p[0][2],D)}function C(D){H("next",D)}function Y(D){H("throw",D)}function O(D,M){(D(M),p.shift(),p.length)&&H(p[0][0],p[0][1])}}function K(h){var m,l;return m={},q("next"),q("throw",function(v){throw v}),q("return"),m[Symbol.iterator]=function(){return this},m;function q(v,p){m[v]=h[v]?function(E){return(l=!l)?{value:z(h[v](E)),done:v==="return"}:p?p(E):E}:p}}function I(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=h[Symbol.asyncIterator],l;return m?m.call(h):(h=typeof o==="function"?o(h):h[Symbol.iterator](),l={},q("next"),q("throw"),q("return"),l[Symbol.asyncIterator]=function(){return this},l);function q(p){l[p]=h[p]&&function(E){return new Promise(function(H,X){E=h[p](E),v(H,X,E.done,E.value)})}}function v(p,E,H,X){Promise.resolve(X).then(function(C){p({value:C,done:H})},E)}}function N(h,m){return Object.defineProperty?Object.defineProperty(h,"raw",{value:m}):h.raw=m,h}function J(h){if(h&&h.__esModule)return h;var m={};if(h!=null)for(var l in h)Object.hasOwnProperty.call(h,l)&&(m[l]=h[l]);return m.default=h,m}function Q(h){return h&&h.__esModule?h:{default:h}}function R(h,m){if(!m.has(h))throw new TypeError("attempted to get private field on non-instance");return m.get(h)}function L(h,m,l){if(!m.has(h))throw new TypeError("attempted to set private field on non-instance");return m.set(h,l),l}});var Zi=kb(i=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=_i(),b=Nf(),c=function(){function n(o,s,u){this.name=o,this.instanceFactory=s,this.type=u,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return n.prototype.setInstantiationMode=function(o){return this.instantiationMode=o,this},n.prototype.setMultipleInstances=function(o){return this.multipleInstances=o,this},n.prototype.setServiceProps=function(o){return this.serviceProps=o,this},n}();var d="[DEFAULT]";var e=function(){function n(o,s){this.name=o,this.container=s,this.component=null,this.instances=new Map(),this.instancesDeferred=new Map()}return n.prototype.get=function(o){o===void 0&&(o=d);var s=this.normalizeInstanceIdentifier(o);if(!this.instancesDeferred.has(s)){var u=new b.Deferred();this.instancesDeferred.set(s,u);try{var w=this.getOrInitializeService(s);w&&u.resolve(w)}catch(z){}}return this.instancesDeferred.get(s).promise},n.prototype.getImmediate=function(o){var s=a.__assign({identifier:d,optional:!1},o),u=s.identifier,w=s.optional,z=this.normalizeInstanceIdentifier(u);try{var G=this.getOrInitializeService(z);if(!G){if(w)return null;throw Error("Service "+this.name+" is not available")}return G}catch(K){if(w)return null;throw K}},n.prototype.getComponent=function(){return this.component},n.prototype.setComponent=function(o){var s,u;if(o.name!==this.name)throw Error("Mismatching Component "+o.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");this.component=o;if(g(o))try{this.getOrInitializeService(d)}catch(Q){}try{for(var w=a.__values(this.instancesDeferred.entries()),z=w.next();!z.done;z=w.next()){var G=a.__read(z.value,2),K=G[0],I=G[1],N=this.normalizeInstanceIdentifier(K);try{var J=this.getOrInitializeService(N);I.resolve(J)}catch(Q){}}}catch(Q){s={error:Q}}finally{try{z&&!z.done&&(u=w.return)&&u.call(w)}finally{if(s)throw s.error}}},n.prototype.clearInstance=function(o){o===void 0&&(o=d),this.instancesDeferred.delete(o),this.instances.delete(o)},n.prototype.delete=function(){return a.__awaiter(this,void 0,void 0,function(){var o;return a.__generator(this,function(s){switch(s.label){case 0:return o=Array.from(this.instances.values()),[4,Promise.all(o.filter(function(u){return"INTERNAL"in u}).map(function(u){return u.INTERNAL.delete()}))];case 1:return s.sent(),[2]}})})},n.prototype.isComponentSet=function(){return this.component!=null},n.prototype.getOrInitializeService=function(o){var s=this.instances.get(o);return!s&&this.component&&(s=this.component.instanceFactory(this.container,f(o)),this.instances.set(o,s)),s||null},n.prototype.normalizeInstanceIdentifier=function(o){return this.component?this.component.multipleInstances?o:d:o},n}();function f(n){return n===d?void 0:n}function g(n){return n.instantiationMode==="EAGER"}var j=function(){function n(o){this.name=o,this.providers=new Map()}return n.prototype.addComponent=function(o){var s=this.getProvider(o.name);if(s.isComponentSet())throw new Error("Component "+o.name+" has already been registered with "+this.name);s.setComponent(o)},n.prototype.addOrOverwriteComponent=function(o){var s=this.getProvider(o.name);s.isComponentSet()&&this.providers.delete(o.name),this.addComponent(o)},n.prototype.getProvider=function(o){if(this.providers.has(o))return this.providers.get(o);var s=new e(o,this);return this.providers.set(o,s),s},n.prototype.getProviders=function(){return Array.from(this.providers.values())},n}();i.Component=c;i.ComponentContainer=j;i.Provider=e});var $i=kb(o=>{qc(o,{LogLevel:()=>d,Logger:()=>i,setLogLevel:()=>k,setUserLogHandler:()=>n});function a(){for(var u=0,w=0,z=arguments.length;w<z;w++)u+=arguments[w].length;for(var G=Array(u),K=0,w=0;w<z;w++)for(var I=arguments[w],N=0,J=I.length;N<J;N++,K++)G[K]=I[N];return G}var b,c=[],d;(function(u){u[u.DEBUG=0]="DEBUG",u[u.VERBOSE=1]="VERBOSE",u[u.INFO=2]="INFO",u[u.WARN=3]="WARN",u[u.ERROR=4]="ERROR",u[u.SILENT=5]="SILENT"})(d||(d={}));var e={debug:d.DEBUG,verbose:d.VERBOSE,info:d.INFO,warn:d.WARN,error:d.ERROR,silent:d.SILENT},f=d.INFO,g=(b={},b[d.DEBUG]="log",b[d.VERBOSE]="log",b[d.INFO]="info",b[d.WARN]="warn",b[d.ERROR]="error",b),j=function(u,w){for(var z=[],G=2;G<arguments.length;G++)z[G-2]=arguments[G];if(w<u.logLevel)return;var K=new Date().toISOString(),I=g[w];if(I)console[I].apply(console,a(["["+K+"]  "+u.name+":"],z));else throw new Error("Attempted to log a message with an invalid logType (value: "+w+")")},i=function(){function u(w){this.name=w,this._logLevel=f,this._logHandler=j,this._userLogHandler=null,c.push(this)}return Object.defineProperty(u.prototype,"logLevel",{get:function(){return this._logLevel},set:function(w){if(!(w in d))throw new TypeError('Invalid value "'+w+'" assigned to `logLevel`');this._logLevel=w},enumerable:!1,configurable:!0}),u.prototype.setLogLevel=function(w){this._logLevel=typeof w==="string"?e[w]:w},Object.defineProperty(u.prototype,"logHandler",{get:function(){return this._logHandler},set:function(w){if(typeof w!=="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=w},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(w){this._userLogHandler=w},enumerable:!1,configurable:!0}),u.prototype.debug=function(){for(var w=[],z=0;z<arguments.length;z++)w[z]=arguments[z];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.DEBUG],w)),this._logHandler.apply(this,a([this,d.DEBUG],w))},u.prototype.log=function(){for(var w=[],z=0;z<arguments.length;z++)w[z]=arguments[z];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.VERBOSE],w)),this._logHandler.apply(this,a([this,d.VERBOSE],w))},u.prototype.info=function(){for(var w=[],z=0;z<arguments.length;z++)w[z]=arguments[z];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.INFO],w)),this._logHandler.apply(this,a([this,d.INFO],w))},u.prototype.warn=function(){for(var w=[],z=0;z<arguments.length;z++)w[z]=arguments[z];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.WARN],w)),this._logHandler.apply(this,a([this,d.WARN],w))},u.prototype.error=function(){for(var w=[],z=0;z<arguments.length;z++)w[z]=arguments[z];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.ERROR],w)),this._logHandler.apply(this,a([this,d.ERROR],w))},u}();function k(u){c.forEach(function(w){w.setLogLevel(u)})}function n(u,w){for(var z=function(N){var J=null;w&&w.level&&(J=e[w.level]),u===null?N.userLogHandler=null:N.userLogHandler=function(Q,R){for(var L=[],r=2;r<arguments.length;r++)L[r-2]=arguments[r];var t=L.map(function(h){if(h==null)return null;{if(typeof h==="string")return h;{if(typeof h==="number"||typeof h==="boolean")return h.toString();{if(h instanceof Error)return h.message;try{return JSON.stringify(h)}catch(m){return null}}}}}).filter(function(h){return h}).join(" ");R>=(J!==null&&J!==void 0?J:Q.logLevel)&&u({level:d[R].toLowerCase(),message:t,args:L,type:Q.name})}},G=0,K=c;G<K.length;G++){var I=K[G];z(I)}}});var Xi=kb(C=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0});var a=Yi(),b=Nf(),c=Zi(),d=$i();var e,f=(e={},e["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",e["bad-app-name"]="Illegal App name: '{$appName}",e["duplicate-app"]="Firebase App named '{$appName}' already exists",e["app-deleted"]="Firebase App named '{$appName}' already deleted",e["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",e["invalid-log-argument"]="First argument to `onLog` must be null or a function.",e),g=new b.ErrorFactory("app","Firebase",f),j="@firebase/app",i="0.6.8",k="@firebase/analytics",n="@firebase/auth",o="@firebase/database",s="@firebase/functions",u="@firebase/installations",w="@firebase/messaging",z="@firebase/performance",G="@firebase/remote-config",K="@firebase/storage",I="@firebase/firestore",N="firebase-wrapper";var J,Q="[DEFAULT]",R=(J={},J[j]="fire-core",J[k]="fire-analytics",J[n]="fire-auth",J[o]="fire-rtdb",J[s]="fire-fn",J[u]="fire-iid",J[w]="fire-fcm",J[z]="fire-perf",J[G]="fire-rc",J[K]="fire-gcs",J[I]="fire-fst",J["fire-js"]="fire-js",J[N]="fire-js-all",J);var L=new d.Logger("@firebase/app");var r=function(){function O(D,M,_){var ia,na,pa=this;this.firebase_=_,this.isDeleted_=!1,this.name_=M.name,this.automaticDataCollectionEnabled_=M.automaticDataCollectionEnabled||!1,this.options_=b.deepCopy(D),this.container=new c.ComponentContainer(M.name),this._addComponent(new c.Component("app",function(){return pa},"PUBLIC"));try{for(var ma=a.__values(this.firebase_.INTERNAL.components.values()),V=ma.next();!V.done;V=ma.next()){var ea=V.value;this._addComponent(ea)}}catch(ja){ia={error:ja}}finally{try{V&&!V.done&&(na=ma.return)&&na.call(ma)}finally{if(ia)throw ia.error}}}return Object.defineProperty(O.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(D){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=D},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),O.prototype.delete=function(){var D=this;return new Promise(function(M){D.checkDestroyed_(),M()}).then(function(){return D.firebase_.INTERNAL.removeApp(D.name_),Promise.all(D.container.getProviders().map(function(M){return M.delete()}))}).then(function(){D.isDeleted_=!0})},O.prototype._getService=function(D,M){return M===void 0&&(M=Q),this.checkDestroyed_(),this.container.getProvider(D).getImmediate({identifier:M})},O.prototype._removeServiceInstance=function(D,M){M===void 0&&(M=Q),this.container.getProvider(D).clearInstance(M)},O.prototype._addComponent=function(D){try{this.container.addComponent(D)}catch(M){L.debug("Component "+D.name+" failed to register with FirebaseApp "+this.name,M)}},O.prototype._addOrOverwriteComponent=function(D){this.container.addOrOverwriteComponent(D)},O.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw g.create("app-deleted",{appName:this.name_})},O}();r.prototype.name&&r.prototype.options||r.prototype.delete||console.log("dc");var t="7.16.0";function h(O){var D={},M=new Map(),_={__esModule:!0,initializeApp:pa,app:na,registerVersion:ea,setLogLevel:d.setLogLevel,onLog:ja,apps:null,SDK_VERSION:t,INTERNAL:{registerComponent:V,removeApp:ia,components:M,useAsService:ka}};_.default=_,Object.defineProperty(_,"apps",{get:ma});function ia(T){delete D[T]}function na(T){T=T||Q;if(!b.contains(D,T))throw g.create("no-app",{appName:T});return D[T]}na.App=O;function pa(T,U){U===void 0&&(U={});if(typeof U!=="object"||U===null){var ga=U;U={name:ga}}var P=U;P.name===void 0&&(P.name=Q);var fa=P.name;if(typeof fa!=="string"||!fa)throw g.create("bad-app-name",{appName:String(fa)});if(b.contains(D,fa))throw g.create("duplicate-app",{appName:fa});var S=new O(T,P,_);return D[fa]=S,S}function ma(){return Object.keys(D).map(function(T){return D[T]})}function V(T){var U,ga,P=T.name;if(M.has(P))return L.debug("There were multiple attempts to register component "+P+"."),T.type==="PUBLIC"?_[P]:null;M.set(P,T);if(T.type==="PUBLIC"){var fa=function(x){x===void 0&&(x=na());if(typeof x[P]!=="function")throw g.create("invalid-app-argument",{appName:P});return x[P]()};T.serviceProps!==void 0&&b.deepExtend(fa,T.serviceProps),_[P]=fa,O.prototype[P]=function(){for(var x=[],B=0;B<arguments.length;B++)x[B]=arguments[B];var F=this._getService.bind(this,P);return F.apply(this,T.multipleInstances?x:[])}}try{for(var S=a.__values(Object.keys(D)),wa=S.next();!wa.done;wa=S.next()){var y=wa.value;D[y]._addComponent(T)}}catch(x){U={error:x}}finally{try{wa&&!wa.done&&(ga=S.return)&&ga.call(S)}finally{if(U)throw U.error}}return T.type==="PUBLIC"?_[P]:null}function ea(T,U,ga){var P,fa=(P=R[T])!==null&&P!==void 0?P:T;ga&&(fa+="-"+ga);var S=fa.match(/\s|\//),wa=U.match(/\s|\//);if(S||wa){var y=['Unable to register library "'+fa+'" with version "'+U+'":'];S&&y.push('library name "'+fa+'" contains illegal characters (whitespace or "/")'),S&&wa&&y.push("and"),wa&&y.push('version name "'+U+'" contains illegal characters (whitespace or "/")'),L.warn(y.join(" "));return}V(new c.Component(fa+"-version",function(){return{library:fa,version:U}},"VERSION"))}function ja(T,U){if(T!==null&&typeof T!=="function")throw g.create("invalid-log-argument",{appName:name});d.setUserLogHandler(T,U)}function ka(T,U){if(U==="serverAuth")return null;var ga=U;return ga}return _}function m(){var O=h(r);O.INTERNAL=a.__assign(a.__assign({},O.INTERNAL),{createFirebaseNamespace:m,extendNamespace:D,createSubscribe:b.createSubscribe,ErrorFactory:b.ErrorFactory,deepExtend:b.deepExtend});function D(M){b.deepExtend(O,M)}return O}var l=m();var q=function(){function O(D){this.container=D}return O.prototype.getPlatformInfoString=function(){var D=this.container.getProviders();return D.map(function(M){if(v(M)){var _=M.getImmediate();return _.library+"/"+_.version}else return null}).filter(function(M){return M}).join(" ")},O}();function v(O){var D=O.getComponent();return(D===null||D===void 0?void 0:D.type)==="VERSION"}function p(O,D){O.INTERNAL.registerComponent(new c.Component("platform-logger",function(M){return new q(M)},"PRIVATE")),O.registerVersion(j,i,D),O.registerVersion("fire-js","")}if(b.isBrowser()&&self.firebase!==void 0){L.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);var E=self.firebase.SDK_VERSION;E&&E.indexOf("LITE")>=0&&L.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}var H=l.initializeApp;l.initializeApp=function(){for(var O=[],D=0;D<arguments.length;D++)O[D]=arguments[D];return b.isNode()&&L.warn(`
      Warning: This is a browser-targeted Firebase bundle but it appears it is being
      run in a Node environment.  If running in a Node environment, make sure you
      are using the bundle specified by the "main" field in package.json.
      
      If you are using Webpack, you can specify "main" as the first item in
      "resolve.mainFields":
      https://webpack.js.org/configuration/resolve/#resolvemainfields
      
      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"
      as the first item in "mainFields", e.g. ['main', 'module'].
      https://github.com/rollup/rollup-plugin-node-resolve
      `),H.apply(void 0,O)};var X=l;p(X);C.default=X;C.firebase=X});var Ma=kb((e,f)=>{"use strict";function a(g){return g&&typeof g==="object"&&"default"in g?g.default:g}var b=a(Xi()),c="firebase",d="7.16.0";b.registerVersion(c,d,"app");f.exports=b});var so=kb((b,c)=>{var a=function(){function d(k,n){if(!j[k]){j[k]={};for(var o=0;o<k.length;o++)j[k][k.charAt(o)]=o}return j[k][n]}var e=String.fromCharCode,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",j={},i={compressToBase64:function(k){if(null==k)return"";var n=i._compress(k,6,function(o){return f.charAt(o)});switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(k){return null==k?"":""==k?null:i._decompress(k.length,32,function(n){return d(f,k.charAt(n))})},compressToUTF16:function(k){return null==k?"":i._compress(k,15,function(n){return e(n+32)})+" "},decompressFromUTF16:function(k){return null==k?"":""==k?null:i._decompress(k.length,16384,function(n){return k.charCodeAt(n)-32})},compressToUint8Array:function(k){for(var n=i.compress(k),o=new Uint8Array(2*n.length),s=0,u=n.length;u>s;s++){var w=n.charCodeAt(s);o[2*s]=w>>>8,o[2*s+1]=w%256}return o},decompressFromUint8Array:function(k){if(null===k||void 0===k)return i.decompress(k);for(var n=new Array(k.length/2),o=0,s=n.length;s>o;o++)n[o]=256*k[2*o]+k[2*o+1];var u=[];return n.forEach(function(w){u.push(e(w))}),i.decompress(u.join(""))},compressToEncodedURIComponent:function(k){return null==k?"":i._compress(k,6,function(n){return g.charAt(n)})},decompressFromEncodedURIComponent:function(k){return null==k?"":""==k?null:(k=k.replace(/ /g,"+"),i._decompress(k.length,32,function(n){return d(g,k.charAt(n))}))},compress:function(k){return i._compress(k,16,function(n){return e(n)})},_compress:function(k,n,o){if(null==k)return"";var s,u,w,z={},G={},K="",I="",N="",J=2,Q=3,R=2,L=[],r=0,t=0;for(w=0;w<k.length;w+=1)if(K=k.charAt(w),Object.prototype.hasOwnProperty.call(z,K)||(z[K]=Q++,G[K]=!0),I=N+K,Object.prototype.hasOwnProperty.call(z,I))N=I;else{if(Object.prototype.hasOwnProperty.call(G,N)){if(N.charCodeAt(0)<256){for(s=0;R>s;s++)r<<=1,t==n-1?(t=0,L.push(o(r)),r=0):t++;for(u=N.charCodeAt(0),s=0;8>s;s++)r=r<<1|1&u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u>>=1}else{for(u=1,s=0;R>s;s++)r=r<<1|u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u=0;for(u=N.charCodeAt(0),s=0;16>s;s++)r=r<<1|1&u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u>>=1}J--,0==J&&(J=Math.pow(2,R),R++),delete G[N]}else for(u=z[N],s=0;R>s;s++)r=r<<1|1&u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u>>=1;J--,0==J&&(J=Math.pow(2,R),R++),z[I]=Q++,N=String(K)}if(""!==N){if(Object.prototype.hasOwnProperty.call(G,N)){if(N.charCodeAt(0)<256){for(s=0;R>s;s++)r<<=1,t==n-1?(t=0,L.push(o(r)),r=0):t++;for(u=N.charCodeAt(0),s=0;8>s;s++)r=r<<1|1&u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u>>=1}else{for(u=1,s=0;R>s;s++)r=r<<1|u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u=0;for(u=N.charCodeAt(0),s=0;16>s;s++)r=r<<1|1&u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u>>=1}J--,0==J&&(J=Math.pow(2,R),R++),delete G[N]}else for(u=z[N],s=0;R>s;s++)r=r<<1|1&u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u>>=1;J--,0==J&&(J=Math.pow(2,R),R++)}for(u=2,s=0;R>s;s++)r=r<<1|1&u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u>>=1;for(;;){if(r<<=1,t==n-1){L.push(o(r));break}t++}return L.join("")},decompress:function(k){return null==k?"":""==k?null:i._decompress(k.length,32768,function(n){return k.charCodeAt(n)})},_decompress:function(k,n,o){var s,u,w,z,G,K,I,N,J=[],Q=4,R=4,L=3,r="",t=[],h={val:o(0),position:n,index:1};for(u=0;3>u;u+=1)J[u]=u;for(z=0,K=Math.pow(2,2),I=1;I!=K;)G=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=o(h.index++)),z|=(G>0?1:0)*I,I<<=1;switch(s=z){case 0:for(z=0,K=Math.pow(2,8),I=1;I!=K;)G=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=o(h.index++)),z|=(G>0?1:0)*I,I<<=1;N=e(z);break;case 1:for(z=0,K=Math.pow(2,16),I=1;I!=K;)G=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=o(h.index++)),z|=(G>0?1:0)*I,I<<=1;N=e(z);break;case 2:return""}for(J[3]=N,w=N,t.push(N);;){if(h.index>k)return"";for(z=0,K=Math.pow(2,L),I=1;I!=K;)G=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=o(h.index++)),z|=(G>0?1:0)*I,I<<=1;switch(N=z){case 0:for(z=0,K=Math.pow(2,8),I=1;I!=K;)G=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=o(h.index++)),z|=(G>0?1:0)*I,I<<=1;J[R++]=e(z),N=R-1,Q--;break;case 1:for(z=0,K=Math.pow(2,16),I=1;I!=K;)G=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=o(h.index++)),z|=(G>0?1:0)*I,I<<=1;J[R++]=e(z),N=R-1,Q--;break;case 2:return t.join("")}if(0==Q&&(Q=Math.pow(2,L),L++),J[N])r=J[N];else{if(N!==R)return null;r=w+w.charAt(0)}t.push(r),J[R++]=w+r.charAt(0),Q--,w=r,0==Q&&(Q=Math.pow(2,L),L++)}}};return i}();"function"==typeof define&&define.amd?define(function(){return a}):"undefined"!=typeof c&&null!=c&&(c.exports=a)});let fj,gj=0,hj=0;const ta={get:()=>fj,set:a=>{fj=a},getFrame:()=>gj,setFrame:a=>{gj=a},getElapsed:()=>hj,setElapsed:a=>{hj=a}};let lj=0;function Ef(a=0){return()=>{lj=a}}function Id(){return lj}let Sf="Phaser",Ao="https://phaser4.io",Bo="#fff",Co="linear-gradient(#3e0081 40%, #00bcc3)";function Of(){if(Sf!==""){const a=ta.get(),b=Sf==="Phaser"?" v"+a.VERSION:"";console.log(`%c${Sf}${b}%c ${Ao}`,`padding: 4px 16px; color: ${Bo}; background: ${Co}`,"")}}let qj=800,rj=600,sj=1;function Hf(a=800,b=600,c=1){return c===0&&(c=window.devicePixelRatio),()=>{qj=a,rj=b,sj=c}}function yb(){return qj}function zb(){return rj}function Ab(){return sj}const ig=[],vc={add:a=>{ig.push(a)},get:()=>ig,clear:()=>{ig.length=0}};let pj;function Jd(a){pj=a}function Pf(){return pj}let Tf=.5,Uf=.5;let mj=0;function Vf(a){mj=a}function Pc(){return mj}function Kd(a){let b;return a&&(typeof a==="string"?b=document.getElementById(a):typeof a==="object"&&a.nodeType===1&&(b=a)),b||(b=document.body),b}let nj;function Ff(a){return()=>{a&&(nj=Kd(a))}}function Qf(){return nj}let oj=[];function Gf(a){return()=>{oj=[].concat(a)}}function Wf(){return oj}let Eo={alpha:!1,antialias:!1,depth:!1,premultipliedAlpha:!1};function Xf(){return Eo}class Hj{constructor(a){this.stack=[],this.current=null,this.renderer=a}reset(){this.stack=[],this.current=null;const a=this.renderer,b=a.gl;b.bindFramebuffer(b.FRAMEBUFFER,null),b.viewport(0,0,a.width,a.height)}add(a,b=!0,c=0,d=0){this.stack.push({framebuffer:a,width:c,height:d}),this.set(a,b,c,d)}set(a,b=!0,c=0,d=0){const e=this.renderer,f=e.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),b&&(f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),c>0&&f.viewport(0,0,c,d),this.current=a}pop(){this.stack.pop();const a=this.stack.length;if(a>0){const b=this.stack[a-1];this.set(b.framebuffer,!1,b.width,b.height)}else this.reset()}rebind(){const a=this.renderer.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.current)}destroy(){this.stack=[]}}let Gj;const za={get:()=>Gj,set:a=>{Gj=a}};function Ij(a,b=[]){const c=a>>16&255,d=a>>8&255,e=a&255,f=a>16777215?a>>>24:255;return b[0]=c/255,b[1]=d/255,b[2]=e/255,b[3]=f/255,b}function Dj(a,b){return a.a===b.a&&a.b===b.b&&a.c===b.c&&a.d===b.d&&a.tx===b.tx&&a.ty===b.ty}function Td(a,b){const c=za.get();b||(b=c.COLOR_ATTACHMENT0);const d=c.createFramebuffer();return c.bindFramebuffer(c.FRAMEBUFFER,d),c.framebufferTexture2D(c.FRAMEBUFFER,b,c.TEXTURE_2D,a,0),c.bindFramebuffer(c.FRAMEBUFFER,null),d}function Yd(a){const b=za.get();if(!b)return;const{parent:c,flipY:d,unpackPremultiplyAlpha:e,minFilter:f,magFilter:g,wrapS:j,wrapT:i,generateMipmap:k,isPOT:n}=a,o=c.image;let s=c.width,u=c.height;const w=b.createTexture();return b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,w),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,d),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),o?(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,o),s=o.width,u=o.height):b.texImage2D(b.TEXTURE_2D,0,b.RGBA,s,u,0,b.RGBA,b.UNSIGNED_BYTE,null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,g),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,j),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,i),k&&n&&b.generateMipmap(b.TEXTURE_2D),a.texture=w,w}function Tb(a){const b=za.get();b&&b.isFramebuffer(a)&&b.deleteFramebuffer(a)}function jg(a){const b=za.get();if(!b)return;b.isTexture(a)&&b.deleteTexture(a)}function Ej(a,b){return a<1||b<1?!1:(a&a-1)===0&&(b&b-1)===0}function Rj(a,b=!0){const c=za.get();c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,a);const d=b?c.LINEAR:c.NEAREST;c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,d),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,d)}function Sj(a){const b=za.get(),c=a.parent.image,d=c.width,e=c.height;return d>0&&e>0&&(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,a.texture),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,a.flipY),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,c)),a.texture}class uc{constructor(a,b={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1;const c=za.get();this.parent=a,this.isPOT=Ej(a.width,a.height);const{texture:d=null,framebuffer:e=null,unpackPremultiplyAlpha:f=!0,minFilter:g=c.LINEAR,magFilter:j=c.LINEAR,wrapS:i=c.CLAMP_TO_EDGE,wrapT:k=c.CLAMP_TO_EDGE,generateMipmap:n=this.isPOT,flipY:o=!1}=b;this.minFilter=g,this.magFilter=j,this.wrapS=i,this.wrapT=k,this.generateMipmap=n,this.flipY=o,this.unpackPremultiplyAlpha=f,e&&(this.framebuffer=e),d?this.texture=d:Yd(this)}setFilter(a){this.texture&&Rj(this.texture,a)}create(){const a=this.texture;return a&&jg(a),Yd(this)}update(){const a=this.texture;return a?Sj(this):Yd(this)}setIndex(a){this.dirtyIndex=a!==this.index,this.index=a}destroy(){jg(this.texture),Tb(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}}class Oj{constructor(a,b,c,d,e){this.batchSize=a,this.dataSize=b,this.indexSize=c,this.vertexElementSize=d,this.quadIndexSize=e,this.vertexByteSize=d*b,this.quadByteSize=this.vertexByteSize*4,this.quadElementSize=d*4,this.bufferByteSize=a*this.quadByteSize,this.create()}create(){let a=[];for(let c=0;c<this.batchSize*this.indexSize;c+=this.indexSize)a.push(c+0,c+1,c+2,c+2,c+3,c+0);this.data=new ArrayBuffer(this.bufferByteSize),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const b=za.get();this.vertexBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.data,b.DYNAMIC_DRAW),this.indexBuffer=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.index,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,null),a=[]}destroy(){}}class kg{constructor(a,b,c,d,e,f){this.trimmed=!1,this.texture=a,this.key=b,this.x=c,this.y=d,this.width=e,this.height=f,this.sourceSizeWidth=e,this.sourceSizeHeight=f,this.updateUVs()}setPivot(a,b){this.pivot={x:a,y:b}}setSize(a,b){this.width=a,this.height=b,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.updateUVs()}setSourceSize(a,b){this.sourceSizeWidth=a,this.sourceSizeHeight=b}setTrim(a,b,c,d,e,f){this.trimmed=!0,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.spriteSourceSizeX=c,this.spriteSourceSizeY=d,this.spriteSourceSizeWidth=e,this.spriteSourceSizeHeight=f}getExtent(a,b){const c=this.sourceSizeWidth,d=this.sourceSizeHeight;let e,f,g,j;return this.trimmed?(e=this.spriteSourceSizeX-a*c,f=e+this.spriteSourceSizeWidth,g=this.spriteSourceSizeY-b*d,j=g+this.spriteSourceSizeHeight):(e=-a*c,f=e+c,g=-b*d,j=g+d),{left:e,right:f,top:g,bottom:j}}setExtent(a){const b=a.transform,c=b.origin.x,d=b.origin.y,e=this.sourceSizeWidth,f=this.sourceSizeHeight;let g,j,i,k;this.trimmed?(g=this.spriteSourceSizeX-c*e,j=this.spriteSourceSizeY-d*f,i=this.spriteSourceSizeWidth,k=this.spriteSourceSizeHeight):(g=-c*e,j=-d*f,i=e,k=f),b.setExtent(g,j,i,k)}updateUVs(){const{x:a,y:b,width:c,height:d}=this,e=this.texture.width,f=this.texture.height;this.u0=a/e,this.v0=b/f,this.u1=(a+c)/e,this.v1=(b+d)/f}}class Ja{constructor(a,b,c){this.key="",a&&(b=a.width,c=a.height),this.image=a,this.width=b,this.height=c,this.frames=new Map(),this.data={},this.addFrame("__BASE",0,0,b,c),vc.add(this)}addFrame(a,b,c,d,e){if(this.frames.has(a))return null;const f=new kg(this,a,b,c,d,e);return this.frames.set(a,f),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=f),f}getFrame(a){if(!a)return this.firstFrame;a instanceof kg&&(a=a.key);let b=this.frames.get(a);return b||(console.warn(`Frame missing: ${a}`),b=this.firstFrame),b}setSize(a,b){this.width=a,this.height=b;const c=this.frames.get("__BASE");c.setSize(a,b)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}}let Nj;const Yc={get:()=>Nj,set:a=>{Nj=a}};const Qj={fragmentShader:`\r
#define SHADER_NAME SINGLE_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture;\r
\r
void main (void)\r
{\r
    vec4 color = texture2D(uTexture, vTextureCoord);\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`,vertexShader:`\r
#define SHADER_NAME SINGLE_QUAD_VERT\r
\r
precision highp float;\r
\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
attribute float aTextureId;\r
attribute vec4 aTintColor;\r
\r
uniform mat4 uProjectionMatrix;\r
uniform mat4 uCameraMatrix;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
void main (void)\r
{\r
    vTextureCoord = aTextureCoord;\r
    vTextureId = aTextureId;\r
    vTintColor = aTintColor;\r
\r
    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\r
}`};class Xd{constructor(a={}){this.attribs={aVertexPosition:0,aTextureCoord:0,aTextureId:0,aTintColor:0},this.uniforms={uProjectionMatrix:0,uCameraMatrix:0,uTexture:0,uTime:0,uResolution:0},this.renderToFBO=!1,this.renderer=Yc.get();const{batchSize:b=4096,dataSize:c=4,indexSize:d=4,vertexElementSize:e=6,quadIndexSize:f=6,fragmentShader:g=Qj.fragmentShader,vertexShader:j=Qj.vertexShader,width:i=yb(),height:k=zb(),resolution:n=Ab(),renderToFBO:o=!1}=a;this.buffer=new Oj(b,c,d,e,f),this.createShaders(g,j),this.count=0,this.renderToFBO=o;const s=new Ja(null,i*n,k*n),u=new uc(s);s.binding=u,u.framebuffer=Td(u.texture),this.texture=s,this.framebuffer=u.framebuffer}createShaders(a,b){const c=this.renderer.gl,d=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(d,a),c.compileShader(d);let e=!1,f=c.getShaderInfoLog(d);f.length>0&&(e=!0,console.error(f));const g=c.createShader(c.VERTEX_SHADER);c.shaderSource(g,b),c.compileShader(g),f=c.getShaderInfoLog(d),f.length>0&&(e=!0,console.error(f));if(e)return;const j=c.createProgram();c.attachShader(j,g),c.attachShader(j,d),c.linkProgram(j),c.useProgram(j),this.program=j;for(const i of Object.keys(this.attribs)){const k=c.getAttribLocation(j,i);c.enableVertexAttribArray(k),this.attribs[i]=k}for(const i of Object.keys(this.uniforms))this.uniforms[i]=c.getUniformLocation(j,i)}bind(a,b,c){if(!this.program)return!1;const d=this.renderer,e=d.gl,f=this.uniforms;return e.useProgram(this.program),e.uniformMatrix4fv(f.uProjectionMatrix,!1,a),e.uniformMatrix4fv(f.uCameraMatrix,!1,b),e.uniform1i(f.uTexture,d.textures.textureIndex[c]),e.uniform1f(f.uTime,performance.now()),e.uniform2f(f.uResolution,d.width,d.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}bindBuffers(a,b){const c=this.renderer.gl,d=this.buffer.vertexByteSize,e=this.attribs;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a),c.bindBuffer(c.ARRAY_BUFFER,b),c.vertexAttribPointer(e.aVertexPosition,2,c.FLOAT,!1,d,0),c.vertexAttribPointer(e.aTextureCoord,2,c.FLOAT,!1,d,8),c.vertexAttribPointer(e.aTextureId,1,c.FLOAT,!1,d,16),c.vertexAttribPointer(e.aTintColor,4,c.UNSIGNED_BYTE,!0,d,20),this.count=0}draw(a){const b=this.renderer,c=b.gl,d=this.buffer;if(a===d.batchSize)c.bufferData(c.ARRAY_BUFFER,d.data,c.DYNAMIC_DRAW);else{const e=d.vertexViewF32.subarray(0,a*d.quadElementSize);c.bufferSubData(c.ARRAY_BUFFER,0,e)}this.renderToFBO&&b.fbo.add(this.framebuffer,!0),c.drawElements(c.TRIANGLES,a*d.quadIndexSize,c.UNSIGNED_SHORT,0),this.renderToFBO&&b.fbo.pop()}flush(){const a=this.count;return a===0?!1:(this.draw(a),this.prevCount=a,this.count=0,!0)}}const So=`\r
#define SHADER_NAME MULTI_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture[%count%];\r
\r
void main (void)\r
{\r
    vec4 color;\r
\r
    %forloop%\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`;class Jj extends Xd{constructor(a={fragmentShader:So}){super(a)}createShaders(a,b){const c=Pc();let d="";for(let e=1;e<c;e++)e>1&&(d+=`
	else `),e<c-1&&(d+=`if (vTextureId < ${e}.5)`),d+=`
	{`,d+=`
		color = texture2D(uTexture[${e}], vTextureCoord);`,d+=`
	}`;a=a.replace(/%count%/gi,`${c}`),a=a.replace(/%forloop%/gi,d),super.createShaders(a,b)}bind(a,b){if(!this.program)return!1;const c=this.renderer,d=c.gl,e=this.uniforms;return d.useProgram(this.program),d.uniformMatrix4fv(e.uProjectionMatrix,!1,a),d.uniformMatrix4fv(e.uCameraMatrix,!1,b),d.uniform1iv(e.uTexture,c.textures.textureIndex),d.uniform1f(e.uTime,performance.now()),d.uniform2f(e.uResolution,c.width,c.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}}function Kj(a,b,c=-1,d=1){const e=-2*(1/-a),f=-2*(1/b),g=2*(1/(c-d));return new Float32Array([e,0,0,0,0,f,0,0,0,0,g,0,-1,1,0,1])}class Lj{constructor(a,b){this.renderer=a;const c={shader:new b()};this.stack=[c],this.currentEntry=c,this.current=c.shader,this.singleQuadShader=new Xd()}add(a,b){const c={shader:a,textureID:b};return this.stack.push(c),c}set(a,b){this.flush();const c=this.renderer,d=c.projectionMatrix,e=c.currentCamera.matrix,f=a.bind(d,e,b);if(f){const g=this.add(a,b);this.currentEntry=g,this.current=a}return f}setDefault(a){this.set(this.singleQuadShader,a)}pop(){this.flush();const a=this.stack;a.length>1&&a.pop(),this.currentEntry=a[a.length-1],this.current=this.currentEntry.shader}reset(){this.pop(),this.rebind()}flush(){return this.current.flush()?(this.renderer.flushTotal++,!0):!1}rebind(){const a=this.renderer,b=a.projectionMatrix,c=a.currentCamera.matrix,d=this.currentEntry;d.shader.bind(b,c,d.textureID)}popAndRebind(){this.pop(),this.rebind()}clear(){}destroy(){}}const Qo=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Ro(a){let b="";for(let c=0;c<a;++c)c>0&&(b+=`
else `),c<a-1&&(b+=`if(test == ${c}.0){}`);return b}function Pj(a,b){const c=b.createShader(b.FRAGMENT_SHADER);for(;;){const d=Qo.replace(/%forloop%/gi,Ro(a));b.shaderSource(c,d),b.compileShader(c);if(!b.getShaderParameter(c,b.COMPILE_STATUS))a=a/2|0;else break}return a}class Mj{constructor(a){this.startActiveTexture=0,this.renderer=a,this.tempTextures=[],this.textureIndex=[]}init(){const a=this.renderer.gl;let b=Pj(a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),a);const c=Pc();c===0||c>0&&c>b?Vf(b):c>0&&c<b&&(b=Math.max(8,c));const d=this.tempTextures;d.length&&d.forEach(f=>{a.deleteTexture(f)});const e=[];for(let f=0;f<b;f++){const g=a.createTexture();a.activeTexture(a.TEXTURE0+f),a.bindTexture(a.TEXTURE_2D,g),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),d[f]=g,e.push(f)}this.maxTextures=b,this.textureIndex=e,this.currentActiveTexture=1}update(){const a=vc.get();for(let b=0;b<a.length;b++){const c=a[b];c.binding||(c.binding=new uc(c))}vc.clear()}reset(){const a=this.renderer.gl,b=this.tempTextures;for(let c=0;c<b.length;c++)a.activeTexture(a.TEXTURE0+c),a.bindTexture(a.TEXTURE_2D,b[c]);this.currentActiveTexture=1,this.startActiveTexture++}bind(a,b=0){const c=this.renderer.gl,d=a.binding;d.setIndex(b),c.activeTexture(c.TEXTURE0+b),c.bindTexture(c.TEXTURE_2D,d.texture)}unbind(a=0){const b=this.renderer.gl;b.activeTexture(b.TEXTURE0+a),b.bindTexture(b.TEXTURE_2D,this.tempTextures[a]),a>0&&this.startActiveTexture++}request(a){const b=this.renderer.gl,c=a.binding,d=this.currentActiveTexture;return c.indexCounter>=this.startActiveTexture?!1:(c.indexCounter=this.startActiveTexture,d<this.maxTextures?(c.setIndex(d),b.activeTexture(b.TEXTURE0+d),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture++):(this.renderer.flush(),this.startActiveTexture++,c.indexCounter=this.startActiveTexture,c.setIndex(1),b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture=2),!0)}}class tj{constructor(){this.clearColor=[0,0,0,1],this.flushTotal=0,this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.currentCamera=null,this.width=yb(),this.height=zb(),this.resolution=Ab(),this.setBackgroundColor(Id());const a=document.createElement("canvas");a.addEventListener("webglcontextlost",b=>this.onContextLost(b),!1),a.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=a,this.fbo=new Hj(this),this.textures=new Mj(this),this.initContext(),Yc.set(this),this.shaders=new Lj(this,Jj)}initContext(){const a=this.canvas.getContext("webgl",Xf());za.set(a),this.gl=a,a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE),this.resize(this.width,this.height,this.resolution),this.textures.init()}resize(a,b,c=1){this.width=a*c,this.height=b*c,this.resolution=c;const d=this.canvas;d.width=this.width,d.height=this.height,this.autoResize&&(d.style.width=(this.width/c).toString()+"px",d.style.height=(this.height/c).toString()+"px"),this.gl.viewport(0,0,this.width,this.height),this.projectionMatrix=Kj(a,b)}onContextLost(a){a.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(a){return Ij(a,this.clearColor),this}reset(a=null,b=this.width,c=this.height){const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),d.viewport(0,0,b,c),d.enable(d.BLEND),d.blendFunc(d.ONE,d.ONE_MINUS_SRC_ALPHA),this.flushTotal=0,this.currentCamera=null,this.textures.update()}render(a){if(this.contextLost)return;this.reset();if(this.optimizeRedraw&&a.numDirtyFrames===0&&a.numDirtyCameras===0)return;const b=this.gl;if(this.clearBeforeRender){const d=this.clearColor;b.clearColor(d[0],d[1],d[2],d[3]),b.clear(b.COLOR_BUFFER_BIT)}const c=a.worldData;for(let d=0;d<c.length;d++){const{camera:e,renderList:f}=c[d];(!this.currentCamera||!Dj(e.worldTransform,this.currentCamera.worldTransform))&&(this.flush(),this.currentCamera=e,this.shaders.rebind()),f.forEach(g=>{g.children.length?this.renderNode(g):g.node.renderGL(this)})}this.flush()}renderNode(a){a.node.renderGL(this),a.children.forEach(b=>{b.children.length>0?this.renderNode(b):b.node.renderGL(this)}),a.node.postRenderGL(this)}flush(){this.shaders.flush()}destroy(){Yc.set(void 0)}}function If(){return()=>{Jd(tj)}}function ya(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);for(const e of d)e.callback.apply(e.context,c),e.once&&d.delete(e);return d.size===0&&a.events.delete(b),!0}function bj(a,b){const c=Kd(b);return c.appendChild(a),a}function cj(a){const b=document.readyState;if(b==="complete"||b==="interactive"){a();return}const c=()=>{document.removeEventListener("deviceready",c,!0),document.removeEventListener("DOMContentLoaded",c,!0),window.removeEventListener("load",c,!0),a()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",c,!0):(document.addEventListener("DOMContentLoaded",c,!0),window.addEventListener("load",c,!0)):window.setTimeout(c,20)}class Rf{constructor(){this.events=new Map()}}class Sc{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function Xa(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new Sc(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function Rb(a,b,c,d=a){return Xa(a,b,c,d,!0)}function Tj(){return{gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]}}function Wj(a,b=0){a.gameFrame=b,a.numTotalFrames=0,a.numDirtyFrames=0,a.numDirtyCameras=0,a.worldData.length=0}let Xj;const Zd={get:()=>Xj,set:a=>{Xj=a}};class dj{constructor(){this.scenes=new Map(),this.sceneIndex=0,this.flush=!1,this.renderResult=Tj(),this.game=ta.get(),Zd.set(this),Rb(this.game,"boot",()=>this.boot())}boot(){Wf().forEach(a=>new a())}update(a,b){for(const c of this.scenes.values())ya(c,"update",a,b)}render(a){const b=this.renderResult;Wj(b,a);for(const c of this.scenes.values())ya(c,"render",b);return this.flush&&(b.numDirtyFrames++,this.flush=!1),b}}function Zc(a,b){const c=document.createElement("canvas");return c.width=a,c.height=b,c.getContext("2d")}let Yj;const Ea={get:()=>Yj,set:a=>{Yj=a}};class ej{constructor(){this.textures=new Map(),this.createDefaultTextures(),Ea.set(this)}createDefaultTextures(){this.add("__BLANK",new Ja(Zc(32,32).canvas));const a=Zc(32,32);a.strokeStyle="#0f0",a.moveTo(0,0),a.lineTo(32,32),a.stroke(),a.strokeRect(.5,.5,31,31),this.add("__MISSING",new Ja(a.canvas))}get(a){const b=this.textures;return b.has(a)?b.get(a):b.get("__MISSING")}has(a){return this.textures.has(a)}add(a,b){let c;const d=this.textures;return d.has(a)||(b instanceof Ja?c=b:c=new Ja(b),c.key=a,d.set(a,c)),c}}class Wi extends Rf{constructor(...a){super();this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,ta.set(this),cj(()=>this.boot(a))}boot(a){a.forEach(d=>d());const b=Pf();this.renderer=new b(),this.textureManager=new ej(),this.sceneManager=new dj();const c=Qf();c&&bj(this.renderer.canvas,c),this.isBooted=!0,Of(),ya(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(a){const b=a-this.lastTick;this.lastTick=a,this.elapsed+=b,this.isPaused||(this.willUpdate&&(this.sceneManager.update(b,a),ya(this,"update",b,a)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,ta.setFrame(this.frame),ta.setElapsed(this.elapsed),requestAnimationFrame(c=>this.step(c))}destroy(){}}function Uj(a,b,c){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:c}function Vj(a,b={}){const c=Zd.get(),d=c.scenes.size,e=c.sceneIndex,f=d===0;typeof b==="string"?a.key=b:(b||!b&&f)&&(a.key=Uj(b,"key","scene"+e.toString())),c.scenes.has(a.key)?console.warn("Scene key already in use: "+a.key):(c.scenes.set(a.key,a),c.flush=!0,c.sceneIndex++)}class Fd{constructor(a){this.game=ta.get(),this.events=new Map(),Vj(this,a)}}function Qb(a){const b=[a],c=[];for(;b.length>0;){const d=b.shift();c.push(d);const e=d.numChildren;if(e>0)for(let f=e-1;f>=0;f--)b.unshift(d.children[f])}return c.shift(),c}function mb(a,b){return a.children.indexOf(b)}function Ld(a,b){const c=a.children;let d;if(b>=0&&b<c.length){const e=c.splice(b,1);e[0]&&(d=e[0],d.parent=null)}return d}function Rc(a,b){const c=mb(a,b);return c>-1&&Ld(a,c),b}const ag="addedtoworld";const bg="removedfromworld";function $f(a,...b){return b.forEach(c=>{c.world&&(ya(c.world,bg,c,c.world),ya(c,bg,c,c.world)),c.world=a,ya(a,ag,c,a),ya(c,ag,c,a)}),b}function Pb(a,...b){b.forEach(d=>{d.parent&&Rc(d.parent,d),d.parent=a});const c=a.world;return c&&$f(c,...Qb(a)),b}function rc(a,b){return a.children.push(b),Pb(a,b),b.transform.updateWorld(),b}const Z={CLEAR:0,TRANSFORM:1,UPDATE:2,CHILD_CACHE:4,POST_RENDER:8,COLORS:16,BOUNDS:32,TEXTURE:64,FRAME:128,ALPHA:256,CHILD:512,DEFAULT:1+2+16+32,USER1:536870912,USER2:1073741824,USER3:2147483648,USER4:4294967296};function Qc(a,b=0,c){const d=a.children;c===void 0&&(c=d.length);const e=c-b;if(e>0&&e<=c){const f=d.splice(b,e);return f.forEach(g=>{g.parent=null}),f}else return[]}function Yf(a,b=0,c){const d=Qc(a,b,c);d.forEach(e=>{e.destroy()})}function Zf(a,...b){return b.forEach(c=>{Rc(a,c)}),b}function _f(a,b,c=0,d){const e=Qc(a,c,d);return Pb(b,...e),e.forEach(f=>{f.transform.updateWorld()}),e}class Ob{constructor(a=1,b=0,c=0,d=1,e=0,f=0){this.set(a,b,c,d,e,f)}set(a=1,b=0,c=0,d=1,e=0,f=0){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=e,this.ty=f,this}identity(){return this.set()}toArray(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]}fromArray(a){return this.set(a[0],a[1],a[2],a[3],a[4],a[5])}}function Ud(a,b,c){return a.width<=0||a.height<=0?!1:a.x<=b&&a.x+a.width>=b&&a.y<=c&&a.y+a.height>=c}class Ia{constructor(a=0,b=0,c=0,d=0){this.set(a,b,c,d)}set(a=0,b=0,c=0,d=0){return this.x=a,this.y=b,this.width=c,this.height=d,this}contains(a,b){return Ud(this,a,b)}set right(a){a<=this.x?this.width=0:this.width=a-this.x}get right(){return this.x+this.width}set bottom(a){a<=this.y?this.height=0:this.height=a-this.y}get bottom(){return this.y+this.height}}function Fj(){}class lb{constructor(a,b=0,c=0,d=!1){this.compareValue=!1,this._x=b,this._y=c,this.callback=a,this.compareValue=d}set(a=0,b=0){return this._x=a,this._y=b,this.callback(this),this}destroy(){this.callback=Fj}set x(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._x=a,this.callback(this))}get x(){return this._x}set y(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._y=a,this.callback(this))}get y(){return this._y}}function Cj(a,b,c){const d=c-b;return b+((a-b)%d+d)%d}function ij(a){return Cj(a,-Math.PI,Math.PI)}class jj{constructor(){this._rotation=0,this.type="Camera",this.dirtyRender=!0;const a=ta.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1]),this.bounds=new Ia(),this.worldTransform=new Ob(),this.position=new lb(()=>this.updateTransform(),0,0),this.scale=new lb(()=>this.updateTransform(),1,1),this.origin=new lb(()=>this.updateTransform(),.5,.5),this.reset()}updateTransform(){const a=this.matrix,b=this.position.x,c=this.position.y,d=this.scale.x,e=this.scale.y,f=-b+this.width*this.origin.x,g=-c+this.height*this.origin.y,j=Math.sin(this.rotation),i=Math.cos(this.rotation),k=j+j,n=j*k,o=i*k,s=(1-n)*d,u=o*d,w=-o*e,z=(1-n)*e;a[0]=s,a[1]=u,a[4]=w,a[5]=z,a[12]=b+f-(s*f+w*g),a[13]=c+g-(u*f+z*g),this.worldTransform.set(i*d,j*d,-j*e,i*e,-b,-c);const G=this.width*(1/d),K=this.height*(1/e);this.bounds.set(f-G/2,g-K/2,G,K),this.dirtyRender=!0}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}set rotation(a){a!==this._rotation&&(this._rotation=ij(a),this.updateTransform())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.origin.destroy(),this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}class kj{constructor(){this.type="StaticCamera",this.dirtyRender=!0;const a=ta.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.bounds=new Ia(),this.worldTransform=new Ob(),this.reset()}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}const Md="destroy";const uj="postupdate";const vj="update";function nb(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof Sc)g.delete(c);else{const j=!d,i=e!==void 0;for(const k of g)k.callback===c&&(j&&k.context===d)&&(i&&k.once===e)&&g.delete(k)}return g.size===0&&f.delete(b),a}function tc(a){const{a:b,b:c,c:d,d:e,tx:f,ty:g}=a.world,{x:j,y:i,right:k,bottom:n}=a.extent,o=j*b+i*d+f,s=j*c+i*e+g,u=j*b+n*d+f,w=j*c+n*e+g,z=k*b+n*d+f,G=k*c+n*e+g,K=k*b+i*d+f,I=k*c+i*e+g;return{x0:o,y0:s,x1:u,y1:w,x2:z,y2:G,x3:K,y3:I}}class Nd{constructor(a){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=a,this.area=new Ia()}set(a,b,c,d){this.area.set(a,b,c,d)}get(){return this.entity.isDirty(Z.BOUNDS)&&!this.fixed&&this.update(),this.area}updateLocal(){const{x0:a,y0:b,x1:c,y1:d,x2:e,y2:f,x3:g,y3:j}=tc(this.entity.transform),i=Math.min(a,c,e,g),k=Math.min(b,d,f,j),n=Math.max(a,c,e,g),o=Math.max(b,d,f,j);return this.area.set(i,k,n-i,o-k)}update(){const a=this.updateLocal();this.entity.clearDirty(Z.BOUNDS);if(!this.includeChildren||!this.entity.numChildren)return a;const b=this.visibleOnly,c=this.entity.children;let d=a.x,e=a.y,f=a.right,g=a.bottom;for(let j=0;j<c.length;j++){const i=c[j];if(!i||b&&!i.visible)continue;const k=i.bounds.get();k.x<d&&(d=k.x),k.y<e&&(e=k.y),k.right>f&&(f=k.right),k.bottom>g&&(g=k.bottom)}return a.set(d,e,f-d,g-e)}destroy(){this.entity=null,this.area=null}}class Od{constructor(a){this.enabled=!1,this.enabledChildren=!0,this.entity=a}destroy(){this.entity=null,this.hitArea=null}}class cb{constructor(a=0,b=0){this.set(a,b)}set(a=0,b=0){return this.x=a,this.y=b,this}getArray(){return[this.x,this.y]}fromArray(a){return this.set(a[0],a[1])}toString(){return`[x=${this.x}, y=${this.y}]`}}function Qd(a){const b=a.local,c=a.position.x,d=a.position.y,e=a.rotation,f=a.scale.x,g=a.scale.y,j=a.skew.x,i=a.skew.y;b.set(Math.cos(e+i)*f,Math.sin(e+i)*f,-Math.sin(e-j)*g,Math.cos(e-j)*g,c,d)}function dg(a,b){return b.set(a.a,a.b,a.c,a.d,a.tx,a.ty)}function Rd(a){const b=a.parent,c=a.transform,d=c.local,e=c.world;if(!b)dg(d,e);else if(c.passthru)dg(b.transform.world,e);else{const{a:f,b:g,c:j,d:i,tx:k,ty:n}=d,{a:o,b:s,c:u,d:w,tx:z,ty:G}=b.transform.world;e.set(f*o+g*u,f*s+g*w,j*o+i*u,j*s+i*w,k*o+n*u+z,k*s+n*w+G)}}class Pd{constructor(a,b=0,c=0){this.passthru=!1,this._rotation=0,this.entity=a,this.local=new Ob(),this.world=new Ob(),this.position=new lb(()=>this.update(),b,c),this.scale=new lb(()=>this.update(),1,1,!0),this.skew=new lb(()=>this.update(),0,0,!0),this.origin=new lb(()=>this.updateExtent(),Tf,Uf),this.extent=new Ia()}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(Z.TRANSFORM,Z.BOUNDS),Qd(this)}updateWorld(){const a=this.entity;a.setDirty(Z.TRANSFORM,Z.BOUNDS),Rd(a),a.numChildren&&this.updateChildren()}updateChildren(){const a=this.entity.children;for(let b=0;b<a.length;b++){const c=a[b];c.transform.updateWorld()}}globalToLocal(a,b,c=new cb()){const{a:d,b:e,c:f,d:g,tx:j,ty:i}=this.world,k=1/(d*g+f*-e);return c.x=g*k*a+-f*k*b+(i*f-j*g)*k,c.y=d*k*b+-e*k*a+(-i*d+j*e)*k,c}localToGlobal(a,b,c=new cb()){const{a:d,b:e,c:f,d:g,tx:j,ty:i}=this.world;return c.x=d*a+f*b+j,c.y=e*a+g*b+i,c}setExtent(a,b,c,d){this.extent.set(a,b,c,d),this.entity.setDirty(Z.TRANSFORM,Z.BOUNDS)}updateExtent(a,b){const c=this.extent,d=this.entity;a!==void 0&&(c.width=a),b!==void 0&&(c.height=b),c.x=-this.origin.x*c.width,c.y=-this.origin.y*c.height,d.setDirty(Z.TRANSFORM,Z.BOUNDS)}set rotation(a){a!==this._rotation&&(this._rotation=a,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}}class ob{constructor(a=0,b=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.events=new Map(),this.transform=new Pd(this,a,b),this.bounds=new Nd(this),this.input=new Od(this),this.dirty=Z.DEFAULT,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(a){return(this.dirty&a)!==0}clearDirty(a){return this.isDirty(a)&&(this.dirty^=a),this}setDirty(a,b){return this.isDirty(a)||(this.dirty^=a,this.dirtyFrame=ta.getFrame()),this.isDirty(b)||(this.dirty^=b),this}update(a,b){if(this.willUpdateChildren){const c=this.children;for(let d=0;d<c.length;d++){const e=c[d];e&&e.willUpdate&&e.update(a,b)}}this.postUpdate(a,b)}postUpdate(a,b){}renderGL(a){}renderCanvas(a){}postRenderGL(a){}postRenderCanvas(a){}get numChildren(){return this.children.length}destroy(a){a?_f(this,a):Yf(this),ya(this,Md,this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}}const Vd="worldrender";const Wd="worldshutdown";var Po=Object.freeze({__proto__:null,WorldRenderEvent:Vd,WorldShutdownEvent:Wd});function _d(a,b){b.numRendered++,b.numRenderable++,a.node.dirtyFrame>=b.gameFrame&&b.dirtyFrame++,a.children.forEach(c=>{c.children.length>0&&_d(c,b)})}function og(a){if(a.node.isDirty(Z.CHILD_CACHE))return!0;const b=[a];for(;b.length>0;){const c=b.pop();if(c.node.isDirty(Z.TRANSFORM))return!0;const d=c.children.length;if(d>0)for(let e=0;e<d;e++)b.push(c.children[e])}return b.length=0,!1}function ng(a,b){a.forEach(c=>{b||og(c)?c.node.setDirty(Z.CHILD_CACHE):c.children.length=0})}function $d(a,b,c=[]){for(let d=0;d<b.numChildren;d++){const e=b.children[d];if(e.isRenderable()){const f=[],g={node:e,children:f};c.push(g),e.willRenderChildren&&e.numChildren>0&&(e.willCacheChildren&&a.push(g),$d(a,e,f))}}return c}function lg(a){const b=[],c=[],d=$d(b,a,c),e=a.renderData;b.length>0&&ng(b,a.camera.dirtyRender),d.forEach(f=>{f.children.length?_d(f,e):(e.numRendered++,e.numRenderable++,f.node.dirtyFrame>=e.gameFrame&&e.dirtyFrame++)}),e.renderList=d,a.forceRefresh&&(e.dirtyFrame++,a.forceRefresh=!1)}function mg(a,b){a.numDirtyFrames+=b.dirtyFrame,a.numTotalFrames+=b.numRendered,b.camera.dirtyRender&&a.numDirtyCameras++,a.worldData.push(b)}function _c(a,b){a.gameFrame=b,a.dirtyFrame=0,a.numRendered=0,a.numRenderable=0,a.renderList.length=0}class Vb extends ob{constructor(a){super();this.forceRefresh=!1,this.type="BaseWorld",this.scene=a,this.world=this,this.events=new Map(),this._updateListener=Xa(a,"update",(b,c)=>this.update(b,c)),this._renderListener=Xa(a,"render",b=>this.render(b)),this._shutdownListener=Xa(a,"shutdown",()=>this.shutdown()),Rb(a,"destroy",()=>this.destroy())}update(a,b){if(!this.willUpdate)return;ya(this,vj,a,b,this),super.update(a,b)}postUpdate(a,b){ya(this,uj,a,b,this)}render(a){const b=this.renderData;_c(b,a.gameFrame);if(!this.willRender||!this.visible)return;lg(this),ya(this,Vd,b,this),mg(a,b),this.camera&&(this.camera.dirtyRender=!1)}shutdown(){const a=this.scene;nb(a,"update",this._updateListener),nb(a,"render",this._renderListener),nb(a,"shutdown",this._shutdownListener),Zf(this),ya(this,Wd,this),_c(this.renderData,0),this.camera&&this.camera.reset()}destroy(a){super.destroy(a),ya(this,Md,this),_c(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}}function $c(a){return{camera:a,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0,renderList:[]}}class Jf extends Vb{constructor(a){super(a);this.type="StaticWorld",this.camera=new kj(),this.renderData=$c(this.camera)}}class To extends Vb{constructor(a){super(a);this.enableCameraCull=!0,this.type="World",this.camera=new jj(),this.renderData=$c(this.camera)}}function wj(a,b){const c=a.texture,d=b.shaders.current,e=d.buffer,f=c.binding;d.count===e.batchSize&&b.flush();const g=a.vertexData;b.textures.request(c);const j=f.index;g[4]=j,g[10]=j,g[16]=j,g[22]=j;const i=d.count*e.quadElementSize;e.vertexViewF32.set(g,i);const k=a.vertexColor,n=e.vertexViewU32;n[i+5]=k[0],n[i+11]=k[2],n[i+17]=k[3],n[i+23]=k[1],d.count++}var Ko=Object.freeze({__proto__:null,BoundsComponent:Nd,InputComponent:Od,GetVertices:tc,TransformComponent:Pd,UpdateLocalTransform:Qd,UpdateWorldTransform:Rd});class pb extends ob{constructor(a=0,b=0){super(a,b);this._alpha=1,this.type="Container"}setSize(a,b=a){return this.transform.updateExtent(a,b),this}setPosition(a,b){return this.transform.position.set(a,b),this}setOrigin(a,b=a){return this.transform.origin.set(a,b),this}setSkew(a,b=a){return this.transform.skew.set(a,b),this}setScale(a,b=a){return this.transform.scale.set(a,b),this}setRotation(a){return this.transform.rotation=a,this}set width(a){this.transform.updateExtent(a)}get width(){return this.transform.extent.width}set height(a){this.transform.updateExtent(void 0,a)}get height(){return this.transform.extent.height}set x(a){this.transform.position.x=a}get x(){return this.transform.position.x}set y(a){this.transform.position.y=a}get y(){return this.transform.position.y}set originX(a){this.transform.origin.x=a}get originX(){return this.transform.origin.x}set originY(a){this.transform.origin.y=a}get originY(){return this.transform.origin.y}set skewX(a){this.transform.skew.x=a}get skewX(){return this.transform.skew.x}set skewY(a){this.transform.skew.y=a}get skewY(){return this.transform.skew.y}set scaleX(a){this.transform.scale.x=a}get scaleX(){return this.transform.scale.x}set scaleY(a){this.transform.scale.y=a}get scaleY(){return this.transform.scale.y}set rotation(a){this.transform.rotation=a}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(a){a!==this._alpha&&(this._alpha=a,this.setDirty(Z.TRANSFORM))}}function xj(a,b){const c=a.frame;if(!c)return;const d=b.ctx,e=a.transform,{a:f,b:g,c:j,d:i,tx:k,ty:n}=e.world,{x:o,y:s}=e.extent;d.save(),d.setTransform(f,g,j,i,k,n),d.globalAlpha=a.alpha,d.drawImage(c.texture.image,c.x,c.y,c.width,c.height,o,s,c.width,c.height),d.restore()}function Ub(a,b){const c=(b*255|0)&255;return(c<<24|a)>>>0}function Sb(a){const b=a.vertexAlpha,c=a.vertexTint,d=a.vertexColor;return d[0]=Ub(c[0],b[0]),d[1]=Ub(c[1],b[1]),d[2]=Ub(c[2],b[2]),d[3]=Ub(c[3],b[3]),a}function Vc(a,b,...c){const d=a.getFrame(b),{u0:e,u1:f,v0:g,v1:j,pivot:i}=d;return c.forEach(k=>{if(!k||d===k.frame)return;k.frame=d,i&&k.setOrigin(i.x,i.y),k.frame.setExtent(k),k.hasTexture=!0;const n=k.vertexData;n[2]=e,n[3]=g,n[8]=e,n[9]=j,n[14]=f,n[15]=j,n[20]=f,n[21]=g}),c}function fg(a,b,...c){if(!a)c.forEach(d=>{d.texture=null,d.frame=null,d.hasTexture=!1});else{let d;a instanceof Ja?d=a:d=Ea.get().get(a),d?(c.forEach(e=>{e.texture=d}),Vc(d,b,...c)):console.warn(`Invalid Texture key: ${a}`)}return c}function gg(a){const b=a.vertexData,{x0:c,y0:d,x1:e,y1:f,x2:g,y2:j,x3:i,y3:k}=tc(a.transform);return b[0]=c,b[1]=d,b[6]=e,b[7]=f,b[12]=g,b[13]=j,b[18]=i,b[19]=k,a}class Wa extends pb{constructor(a,b,c,d){super(a,b);this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertexData=new Float32Array(24).fill(0),this.vertexColor=new Uint32Array(4).fill(4294967295),this.vertexAlpha=new Float32Array(4).fill(1),this.vertexTint=new Uint32Array(4).fill(16777215),this.setTexture(c,d)}setTexture(a,b){return fg(a,b,this),this}setFrame(a){return Vc(this.texture,a,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}preRender(){this.isDirty(Z.COLORS)&&(Sb(this),this.clearDirty(Z.COLORS)),this.isDirty(Z.TRANSFORM)&&(gg(this),this.clearDirty(Z.TRANSFORM))}renderGL(a){this.preRender(),wj(this,a)}renderCanvas(a){this.preRender(),xj(this,a)}get alpha(){return this._alpha}set alpha(a){if(a!==this._alpha){this._alpha=a;const b=this.vertexAlpha;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(Z.ALPHA)}}get tint(){return this._tint}set tint(a){if(a!==this._tint){this._tint=a;const b=this.vertexTint;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(Z.COLORS)}}destroy(a){super.destroy(a),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertexData=null,this.vertexColor=null,this.vertexAlpha=null,this.vertexTint=null}}class Io extends Wa{constructor(a,b,c,d){super(a,b,c,d);this.type="AnimatedSprite",this.anims=new Map(),this.animData={currentAnim:"",currentFrames:[],frameIndex:0,animSpeed:0,nextFrameTime:0,repeatCount:0,isPlaying:!1,yoyo:!1,pendingStart:!1,playingForward:!0,delay:0,repeatDelay:0,onStart:null,onRepeat:null,onComplete:null}}stop(){const a=this.animData;a.isPlaying=!1,a.currentAnim="",a.onComplete&&a.onComplete(this,a.currentAnim)}nextFrame(){const a=this.animData;a.frameIndex++;if(a.frameIndex===a.currentFrames.length)if(a.yoyo)a.frameIndex--,a.playingForward=!1;else if(a.repeatCount===-1||a.repeatCount>0)a.frameIndex=0,a.repeatCount!==-1&&a.repeatCount--,a.onRepeat&&a.onRepeat(this,a.currentAnim),a.nextFrameTime+=a.repeatDelay;else return a.frameIndex--,this.stop();this.setFrame(a.currentFrames[a.frameIndex]),a.nextFrameTime+=a.animSpeed}prevFrame(){const a=this.animData;a.frameIndex--;if(a.frameIndex===-1)if(a.repeatCount===-1||a.repeatCount>0)a.frameIndex=0,a.playingForward=!0,a.repeatCount!==-1&&a.repeatCount--,a.onRepeat&&a.onRepeat(this,a.currentAnim),a.nextFrameTime+=a.repeatDelay;else return a.frameIndex=0,this.stop();this.setFrame(a.currentFrames[a.frameIndex]),a.nextFrameTime+=a.animSpeed}update(a,b){super.update(a,b);const c=this.animData;if(!c.isPlaying)return;c.nextFrameTime-=a*1e3,c.nextFrameTime=Math.max(c.nextFrameTime,0),c.nextFrameTime===0&&(c.pendingStart?(c.onStart&&c.onStart(this,c.currentAnim),c.pendingStart=!1,c.nextFrameTime=c.animSpeed):c.playingForward?this.nextFrame():this.prevFrame())}get isPlaying(){return this.animData.isPlaying}get isPlayingForward(){return this.animData.isPlaying&&this.animData.playingForward}get currentAnimation(){return this.animData.currentAnim}destroy(a){super.destroy(a),this.anims.clear(),this.animData=null}}function cg(a,b,c,d,e,f,g=0,j=1,i=1,k=0,n=0){const o=Math.cos(g+n)*j,s=Math.sin(g+n)*j,u=-Math.sin(g-k)*i,w=Math.cos(g-k)*i,z=a*o+c*u+e,G=a*s+c*w+f,K=a*o+d*u+e,I=a*s+d*w+f,N=b*o+d*u+e,J=b*s+d*w+f,Q=b*o+c*u+e,R=b*s+c*w+f;return{x0:z,y0:G,x1:K,y1:I,x2:N,y2:J,x3:Q,y3:R}}function Sd(a,b,c,d,e,f,g,j,i,k=0,n=4294967295){const o=a.shaders.current,s=o.buffer,u=s.vertexViewF32,w=s.vertexViewU32,z=o.count*s.quadElementSize;u[z+0]=b,u[z+1]=c,u[z+2]=f,u[z+3]=i,u[z+4]=k,w[z+5]=n,u[z+6]=b,u[z+7]=c+e,u[z+8]=f,u[z+9]=g,u[z+10]=k,w[z+11]=n,u[z+12]=b+d,u[z+13]=c+e,u[z+14]=j,u[z+15]=g,u[z+16]=k,w[z+17]=n,u[z+18]=b+d,u[z+19]=c,u[z+20]=j,u[z+21]=i,u[z+22]=k,w[z+23]=n,o.count++}function Tc(a,b,c,d,e,f,g,j,i,k=0,n=4294967295){a.shaders.setDefault(k),Sd(a,b,c,d,e,f,g,j,i,k,n),a.shaders.popAndRebind()}class Uc extends ob{constructor(){super();this.type="Layer",this.transform.passthru=!0,this.willRender=!1}}class eg extends Uc{constructor(){super();this.type="RenderLayer",this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!0,this.setDirty(Z.CHILD_CACHE);const a=yb(),b=zb(),c=Ab(),d=new Ja(null,a*c,b*c);d.binding=new uc(d),d.binding.framebuffer=Td(d.binding.texture),this.texture=d,this.framebuffer=d.binding.framebuffer}renderGL(a){this.numChildren>0&&(a.flush(),this.isDirty(Z.CHILD_CACHE)?(a.fbo.add(this.framebuffer,!0),this.clearDirty(Z.CHILD_CACHE)):(a.fbo.add(this.framebuffer,!1),this.postRenderGL(a)))}postRenderGL(a){const b=this.texture;a.flush(),a.fbo.pop();const{u0:c,v0:d,u1:e,v1:f}=b.firstFrame;a.textures.bind(b),Tc(a,0,0,b.width,b.height,c,d,e,f),a.textures.unbind(),this.clearDirty(Z.TRANSFORM)}}class Jo extends eg{constructor(){super();this.shaders=[],this.type="EffectLayer"}postRenderGL(a){const b=this.shaders,c=this.texture;a.flush(),a.fbo.pop();if(b.length===0){const{u0:d,v0:e,u1:f,v1:g}=c.firstFrame;a.textures.bind(c),Tc(a,0,0,c.width,c.height,d,e,f,g),a.textures.unbind()}else{let d=c;for(let i=0;i<b.length;i++){const k=b[i],{u0:n,v0:o,u1:s,v1:u}=d.firstFrame;a.shaders.set(k,0)&&(k.renderToFBO=!0,a.textures.bind(d),Sd(a,0,0,d.width,d.height,n,o,s,u),a.shaders.pop(),a.textures.unbind(),d=k.texture)}const{u0:e,v0:f,u1:g,v1:j}=d.firstFrame;a.textures.bind(d),Tc(a,0,0,d.width,d.height,e,f,g,j),a.textures.unbind()}this.clearDirty(Z.TRANSFORM)}}function yj(a,b){const c=a.texture,d=b.shaders.current,e=d.buffer;b.flush(),b.textures.request(c),a.updateTextureIndex();const f=b.gl;d.bindBuffers(a.indexBuffer,a.vertexBuffer),f.bufferData(f.ARRAY_BUFFER,a.data,f.STATIC_DRAW),f.drawElements(f.TRIANGLES,a.count*e.quadIndexSize,f.UNSIGNED_SHORT,0),d.prevCount=a.count,b.flushTotal++,d.bindBuffers(e.indexBuffer,e.vertexBuffer)}function zj(a,b,c){return Math.max(b,Math.min(c,a))}class Lo extends Uc{constructor(a,b){super();this.glTextureIndex=0,this.hasTexture=!1,this.type="SpriteBatch",this.willRender=!0,this.setTexture(b),this.setMaxSize(a)}resetBuffers(){let a=[];for(let c=0;c<this.maxSize*4;c+=4)a.push(c+0,c+1,c+2,c+2,c+3,c+0);this.data=new ArrayBuffer(this.maxSize*96),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const b=za.get();b&&(Tb(this.vertexBuffer),Tb(this.indexBuffer),this.vertexBuffer=b.createBuffer(),this.indexBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.data,b.STATIC_DRAW),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.index,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,null)),a=[],this.count=0}setMaxSize(a){return this.maxSize=zj(a,0,65535),this.resetBuffers(),this}setTexture(a){let b;return a instanceof Ja?b=a:b=Ea.get().get(a),b?(this.texture=b,this.hasTexture=!0,this.glTextureIndex=-1):console.warn(`Invalid Texture key: ${a}`),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.count>0}clear(){return this.count=0,this}addToBatch(a,b,c,d,e,f,g,j,i,k){if(this.count>=this.maxSize)return console.warn("SpriteBatch full"),this;const{u0:n,u1:o,v0:s,v1:u}=a,w=this.vertexViewF32,z=this.vertexViewU32,G=this.count*24,K=this.texture.binding?this.texture.binding.index:0;return w[G+0]=c,w[G+1]=d,w[G+2]=n,w[G+3]=s,w[G+4]=K,z[G+5]=b,w[G+6]=e,w[G+7]=f,w[G+8]=n,w[G+9]=u,w[G+10]=K,z[G+11]=b,w[G+12]=g,w[G+13]=j,w[G+14]=o,w[G+15]=u,w[G+16]=K,z[G+17]=b,w[G+18]=i,w[G+19]=k,w[G+20]=o,w[G+21]=s,w[G+22]=K,z[G+23]=b,this.setDirty(Z.TRANSFORM),this.count++,this}add(a){const{frame:b=null,x:c=0,y:d=0,rotation:e=0,scaleX:f=1,scaleY:g=1,skewX:j=0,skewY:i=0,originX:k=0,originY:n=0,alpha:o=1,tint:s=16777215}=a,u=this.texture.getFrame(b),{left:w,right:z,top:G,bottom:K}=u.getExtent(k,n),{x0:I,y0:N,x1:J,y1:Q,x2:R,y2:L,x3:r,y3:t}=cg(w,z,G,K,c,d,e,f,g,j,i),h=Ub(s,o);return this.addToBatch(u,h,I,N,J,Q,R,L,r,t)}addXY(a,b,c){const d=this.texture.getFrame(c),{left:e,right:f,top:g,bottom:j}=d.getExtent(0,0),{x0:i,y0:k,x1:n,y1:o,x2:s,y2:u,x3:w,y3:z}=cg(e,f,g,j,a,b);return this.addToBatch(d,4294967295,i,k,n,o,s,u,w,z)}updateTextureIndex(){const a=this.texture.binding.index;if(a===this.glTextureIndex)return;const b=this.vertexViewF32;this.glTextureIndex=a;for(let c=0;c<this.count;c++)b[c*24+4]=a,b[c*24+10]=a,b[c*24+16]=a,b[c*24+22]=a}renderGL(a){yj(this,a)}destroy(){super.destroy(),Tb(this.vertexBuffer),Tb(this.indexBuffer),this.data=null,this.vertexViewF32=null,this.vertexViewU32=null,this.index=null,this.texture=null,this.hasTexture=!1}}function Bb(a=32,b=32){const c=Zc(a,b);return new Ja(c.canvas)}class Gd extends Wa{constructor(a,b,c="",d,e){super(a,b,Bb());this.splitRegExp=/(?:\r\n|\r|\n)/,this.padding={left:0,right:0,top:0,bottom:0},this.verticalAlign="ascent",this.lineSpacing=0,this.font="16px monospace",this.fillStyle="#fff",this.strokeStyle="",this.backgroundStyle="",this.cornerRadius=0,this.textAlign="left",this.textBaseline="alphabetic",this.lineWidth=0,this.lineDash=[],this.antialias=!1,this.type="Text";const f=ta.get();this.resolution=f.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),d&&(this.font=d),e&&(this.fillStyle=e),this.setText(c)}syncContext(a,b){this.preRenderCallback&&this.preRenderCallback(a,b),b.font=this.font,b.textBaseline=this.textBaseline,b.textAlign=this.textAlign,b.fillStyle=this.fillStyle,b.strokeStyle=this.strokeStyle,b.lineWidth=this.lineWidth,b.lineCap="round",b.lineJoin="round",b.setLineDash(this.lineDash),b.imageSmoothingEnabled=this.antialias}updateText(){const a=this.canvas,b=this.context,c=this.resolution,d=this._text.split(this.splitRegExp),e=this.padding,f=this.fillStyle,g=this.strokeStyle,j=this.lineWidth,i=this.lineSpacing,k=j>0?j/2:0;b.clearRect(0,0,a.width,a.height),this.syncContext(a,b),b.textAlign="start";let n=0,o=0,s=0;const u=[],w=this.verticalAlign==="ascent",z=b.measureText("|MÃq"),G=Math.ceil(Math.abs(z.actualBoundingBoxAscent)+Math.abs(z.actualBoundingBoxDescent))+j;for(let h=0;h<d.length;h++){const m=b.measureText(d[h]),l=m.actualBoundingBoxLeft,q=m.actualBoundingBoxRight;let v=m.actualBoundingBoxAscent,p=m.actualBoundingBoxDescent;(!v&&!p||d[h]==="")&&(v=G,p=0);const E=Math.ceil(Math.abs(l)+Math.abs(q))+j,H=Math.ceil(Math.abs(v)+Math.abs(p))+j;w?(s+=v+k,h>0&&(s+=i+k),o=s+p+k):(s=o+(H-p-k),o+=H,h<d.length-1&&(o+=i)),n=Math.max(n,E),u.push({lineWidth:E,lineHeight:H,ascent:v,descent:p,left:l,right:q,y:s})}n+=e.left+e.right,o+=e.top+e.bottom;const K=this.fixedWidth?this.fixedWidth:n,I=this.fixedHeight?this.fixedHeight:o,N=Math.ceil(K*c),J=Math.ceil(I*c);(a.width!==N||a.height!==J)&&(a.width=N,a.height=J,this.texture.setSize(K,I),this.setSize(K,I)),b.save(),b.scale(c,c),this.syncContext(a,b);const Q=this.backgroundStyle;if(Q){b.save(),b.fillStyle=Q,b.strokeStyle=Q;const h=this.cornerRadius,m=h>0?h/2:0;h&&(b.lineWidth=h,b.strokeRect(m,m,K-h,I-h)),b.fillRect(m,m,K-h,I-h),b.restore()}const R=this.textAlign,L=R==="center",r=R==="right"||R==="end",t=(I-o)/2+e.top;for(let h=0;h<d.length;h++){const m=d[h],l=u[h];let q=e.left+l.left+k;const v=t+l.y;L?q=K/2:r&&(q=K-k),g&&b.strokeText(m,q,v),f&&b.fillText(m,q,v)}return b.restore(),this.texture.binding&&this.texture.binding.update(),this.setDirty(Z.TEXTURE),this}get text(){return this._text}set text(a){this.setText(a)}setText(a=""){return Array.isArray(a)&&(a=a.join(`
`)),a!==this._text&&(this._text=a.toString(),this.updateText()),this}destroy(a){this.texture.destroy(),this.fillStyle=null,this.strokeStyle=null,this.backgroundStyle=null,this.canvas=null,this.context=null,super.destroy(a)}}function Kf(a,...b){return b.forEach(c=>{const d=c.vertexTint;d[0]=a,d[1]=a,d[2]=a,d[3]=a,Sb(c)}),b}function Lf(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function vb(a,b,c,d=1){let e;if(typeof a==="string"){let j=Ea.get();j.has(a)||j.add(a,Bb()),e=j.get(a)}else e=a;let f=e.image,g=f.getContext("2d");return c?b.call(c,f,g):b(f,g),e.setSize(f.width/d,f.height/d),e.binding&&e.binding.update(),e}function wb(a,b,c){switch(typeof a){case"number":return`#${a.toString(16)}`;case"function":return a(b,c);default:return a}}function _n(a,b,c,d,e,f,g,j,i,k,n=!0){b.beginPath(),b.rect(c,d,e,f);if(g){if(k){let o;n?o=b.createLinearGradient(0,0,e,0):o=b.createLinearGradient(0,0,0,f),o.addColorStop(0,g),o.addColorStop(1,k),g=o}b.fillStyle=g,b.fill()}j&&(b.strokeStyle=j,b.lineWidth=i,b.stroke())}function Mf(a,{width:b=32,height:c=b,fillStyle:d,fillColor2:e,isHorizontalGradient:f=!0,strokeStyle:g,lineWidth:j=2}={}){return vb(a,function(i,k){i.width=Math.ceil(b),i.height=Math.ceil(c),g||(j=0);const n=j/2,o=n,s=n;b-=j,c-=j,_n(i,k,o,s,b,c,wb(d,i,k),wb(g,i,k),j,e,f)})}class go{constructor(a=0,b=a,c=0,d=c,e=0){this._width=0;this._height=0;this.cornerRadius={tl:bb(0),tr:bb(0),bl:bb(0),br:bb(0)};this.setTo(a,b,c,d,e)}setTo(a=0,b=a,c=0,d=c,e=0){return this.setPosition(a,b),this.setRadius(e),this.setSize(c,d),this}setPosition(a=0,b=a){return this.x=a,this.y=b,this}setRadius(a=0){let b=this.cornerRadius;if(typeof a==="number"){const c=a,d=a;b.tl=bb(void 0,c,d),b.tr=bb(void 0,c,d),b.bl=bb(void 0,c,d),b.br=bb(void 0,c,d)}else{const c=a.x??0,d=a.y??0;b.tl=bb(a.tl,c,d),b.tr=bb(a.tr,c,d),b.bl=bb(a.bl,c,d),b.br=bb(a.br,c,d)}return this}setSize(a=0,b=a){return this.width=a,this.height=b,this}get minWidth(){let a=this.cornerRadius;return Math.max(a.tl.x+a.tr.x,a.bl.x+a.br.x)}get minHeight(){let a=this.cornerRadius;return Math.max(a.tl.y+a.bl.y,a.tr.y+a.br.y)}get width(){return this._width}set width(a){a==null&&(a=0),this._width=Math.max(a,this.minWidth)}get height(){return this._height}set height(a){a==null&&(a=0),this._height=Math.max(a,this.minHeight)}get radius(){let a=this.cornerRadius,b=Math.max(a.tl.x,a.tl.y,a.tr.x,a.tr.y,a.bl.x,a.bl.y,a.br.x,a.br.y);return b}}function bb(a,b,c){return a===void 0?{x:b,y:c}:typeof a==="number"?{x:a,y:a}:a}const hr=Math.PI/180;function Fb(a){return a*hr}const ho=Fb(0),io=Fb(90),jo=Fb(180),ko=Fb(270);function ef(a,b,c,d,e,f){const g=new go(b,c,d,e,f),j=g.minWidth,i=g.minHeight,k=d>=j?1:d/j,n=e>=i?1:e/i,o=g.cornerRadius;let s,u,w,z,G;a.beginPath(),a.translate(b,c),s=o.br,u=s.x*k,w=s.y*n,z=g.width-u,G=g.height-w,zf(s)&&u>=0&&w>=0?a.ellipse(z,G,u,w,0,ho,io):(a.moveTo(g.width,G),a.lineTo(g.width,g.height),a.lineTo(z,g.height)),s=o.bl,u=s.x*k,w=s.y*n,z=u,G=g.height-w,a.lineTo(u,g.height),zf(s)&&u>=0&&w>=0?a.ellipse(z,G,u,w,0,io,jo):(a.lineTo(0,g.height),a.lineTo(0,G)),s=o.tl,u=s.x*k,w=s.y*n,z=u,G=w,a.lineTo(0,G),zf(s)&&u>=0&&w>=0?a.ellipse(z,G,u,w,0,jo,ko):(a.lineTo(0,0),a.lineTo(z,0)),s=o.tr,u=s.x*k,w=s.y*n,z=g.width-u,G=w,a.lineTo(z,0),zf(s)&&u>=0&&w>=0?a.ellipse(z,G,u,w,0,ko,ho):(a.lineTo(g.width,0),a.lineTo(g.width,G)),a.closePath()}function zf(a){return a.x!==0&&a.y!==0}function rd(a,b,c,d,e,f,g,j,i,k,n,o=!0){ef(b,c,d,e,f,g);if(j){if(n){let s;o?s=b.createLinearGradient(0,0,e,0):s=b.createLinearGradient(0,0,0,f),s.addColorStop(0,j),s.addColorStop(1,n),j=s}b.fillStyle=j,b.fill()}i&&(b.strokeStyle=i,b.lineWidth=k,b.stroke())}var $n;(function(a){a[a.right=0]="right",a[a.down=1]="down",a[a.left=2]="left",a[a.up=3]="up"})($n||($n={}));var Li;(function(a){a[a.IDLE=0]="IDLE",a[a.UPDATING=1]="UPDATING"})(Li||(Li={}));var Da;(function(a){a[a.none=0]="none",a[a.word=1]="word",a[a.char=2]="char"})(Da||(Da={}));var xa;(function(a){a[a.none=0]="none",a[a.raw=1]="raw",a[a.wrapped=2]="wrapped"})(xa||(xa={}));const wi=/(?:\r\n|\r|\n)/;function Bn(a,b,c,d,e,f=0){e<=0&&(d=0);let g=[];if(!a||!a.length)return g;let j=a.split(wi),i=j.length-1;a.slice(-1)===`
`&&(j.length-=1);let k;for(let n=0,o=j.length;n<o;n++){let s=j[n],u=n===i?0:1;if(d===0){g.push(Ed(s,b(s,c),u));continue}n===0?k=e-f:k=e;if(s.length<=100){let I=b(s,c);if(I<=k){g.push(Ed(s,I,u));continue}}let w;d===1?w=s.split(" "):w=s;let z="",G="",K=0;for(let I=0,N=w.length;I<N;I++){let J=w[I];d===1?(z+=J,I<N-1&&(z+=" ")):z+=J;let Q=b(z,c);Q>k&&(I===0?g.push(Ed("",0,2)):(g.push(Ed(G,K,2)),z=J,d===1&&(I<N-1&&(z+=" ")),Q=b(z,c)),k=e),G=z,K=Q}g.push(Ed(G,K,u))}return g}let Ed=function(a,b,c){return{text:a,width:b,newLineMode:c}};var zd;(function(a){a[a.left=0]="left",a[a.center=1]="center",a[a.right=2]="right"})(zd||(zd={}));var Ad;(function(a){a[a.top=0]="top",a[a.center=1]="center",a[a.bottom=2]="bottom"})(Ad||(Ad={}));var ab;(function(a){a[a.LEFT_TOP=0]="LEFT_TOP",a[a.TOP_LEFT=0]="TOP_LEFT",a[a.CENTER_TOP=1]="CENTER_TOP",a[a.TOP_CENTER=1]="TOP_CENTER",a[a.RIGHT_TOP=2]="RIGHT_TOP",a[a.TOP_RIGHT=2]="TOP_RIGHT",a[a.LEFT_CENTER=3]="LEFT_CENTER",a[a.CENTER_LEFT=3]="CENTER_LEFT",a[a.CENTER=4]="CENTER",a[a.CENTER_CENTER=4]="CENTER_CENTER",a[a.RIGHT_CENTER=5]="RIGHT_CENTER",a[a.CENTER_RIGHT=5]="CENTER_RIGHT",a[a.LEFT_BOTTOM=6]="LEFT_BOTTOM",a[a.BOTTOM_LEFT=6]="BOTTOM_LEFT",a[a.CENTER_BOTTOM=7]="CENTER_BOTTOM",a[a.BOTTOM_CENTER=7]="BOTTOM_CENTER",a[a.RIGHT_BOTTOM=8]="RIGHT_BOTTOM",a[a.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(ab||(ab={}));class nc{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(a){return this.items.push(a),this}pushMultiple(a){return this.items.push.apply(this.items,a),a.length=0,this}clear(){return this.items.length=0,this}}class yi{constructor(){this.pens=[]}destroy(){this.pens.length=0}addPen(a){return this.pens.push(a),this}get firstPen(){return this.pens[0]}get lastPen(){return this.pens[this.pens.length-1]}hasPen(){return this.pens.length>0}get pensCount(){return this.pens.length}get startIndex(){let a=this.pens[0];return a?a.startIndex:0}get width(){let a=this.lastPen;return a?a.lastX:0}}function Bf(a){if(Array.isArray(a))a.length=0;else for(let b in a)delete a[b]}function oc(a,b=Array.isArray(a)?[]:{}){Bf(b);if(Array.isArray(a)){b.length=a.length;for(let c=0,d=a.length;c<d;c++)b[c]=a[c]}else for(let c in a)b[c]=a[c];return b}class zi{constructor(){this.text="";this.x=0;this.y=0;this.width=0;this.height=0;this.ascent=0;this.descent=0;this.prop={};this.newLineMode=xa.none;this.startIndex=0}set(a="",b=0,c=0,d=0,e=0,f=0,g=0,j={},i=xa.none,k=0){return this.text=a,this.x=b,this.y=c,this.width=d,this.height=e,this.ascent=f,this.descent=g,this.prop=j,this.newLineMode=i,this.startIndex=k,this}clone(){let a=new zi();return a.set(this.text,this.x,this.y,this.width,this.height,this.ascent,this.descent,oc(this.prop),this.newLineMode,this.startIndex),a}get plainText(){return this.newLineMode===xa.raw?`${this.text}
`:this.text}get wrapText(){return this.newLineMode!==xa.none?`${this.text}
`:this.text}get plainTextLength(){let a=this.text.length;return this.newLineMode===xa.raw&&(a+=1),a}get endIndex(){return this.startIndex+this.plainTextLength}get lastX(){return this.x+this.width}get isTextPen(){return this.text!==""}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}}class Bd{constructor({penPool:a}){this.pens=[];this.lines=[];this.pens=[],this.lines=[],this.penPool=a}destroy(){this.freePens()}freePens(){return this.penPool.pushMultiple(this.pens),this.lines.forEach(a=>{a.destroy()}),this.lines.length=0,this.maxLineWidth=0,this.totalLineHeight=0,this}addTextPen(a,b,c,d,e,f,g,j,i=xa.none){let k=this.penPool.pop();return k==null&&(k=new zi()),k.set(a,b,c,d,e,f,g,j,i),this.addPen(k),this}addImagePen(a,b,c,d,e){return this.addTextPen("",a,b,c,d,d,0,e,xa.none),this}addNewLinePen(a){let b=this.lastPen;return b&&b.newLineMode===xa.none&&(b.newLineMode=a),this}addPen(a){let b=this.lastPen;b==null?a.startIndex=0:a.startIndex=b.endIndex,this.pens.push(a);let c=this.lastLine;return c==null&&(c=new yi(),this.lines.push(c)),c.addPen(a),a.newLineMode!==xa.none&&(c=new yi(),this.lines.push(c)),this}clone(a){a==null&&(a=new Bd({penPool:this.penPool})),a.freePens();const b=this.pens;for(let e=0,f=b.length;e<f;e++)a.addPen(b[e].clone());const c=this.lines,d=a.lines;for(let e=0,f=c.length;e<f;e++){const g=c[e],j=d[e];j.y=g.y,j.height=g.height}return a}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(a){if(a>=this.lines.length)return this.getLineEndIndex(a);{let b=this.lines[a];if(!b)return 0;let c=b.firstPen;return c?c.startIndex:0}}getLineEndIndex(a){let b=this.lines.length;a>=b&&(a=b-1);for(let c=a;c>=0;c--){let d=this.lines[c];if(d&&d.hasPen())return d.lastPen.endIndex}return 0}getLineWidth(a){let b=this.lines[a];return b?b.width:0}getLineHeights(a=[]){return this.lines.forEach(function(b){a.push(b.height)}),a}get lineCount(){return this.lines.length}get plainText(){let a=[],b=this.pens;for(let c=0,d=b.length;c<d;c++)a.push(b[c].plainText);return a.join()}get plainTextLength(){let a=0;for(let b=0,c=this.pens.length;b<c;b++)a+=this.pens[b].plainTextLength;return a}getSliceTagText(a,b,c=0,d,e=!1){if(d===void 0){let k=this.lastPen;if(!k)return"";d=k.endIndex}let f=[],g;for(var j=0,i=this.pens.length;j<i;j++){let k=this.pens[j],n=k.endIndex;if(n<=c)continue;let o=e?k.wrapText:k.plainText,s=k.prop,u=k.startIndex,w=u>=c&&n<=d;w||(o=o.substring(c-u,d-u)),b?f.push(a.call(b,o,s,g)):f.push(a(o,s,g)),g=s;if(n>=d)break}return f.join()}}function yn(a,b,c){let d=oc(a,c);for(let e in b)d.hasOwnProperty(e)&&(d[e]=b[e]);return d}function pf(a,b,c={key:b}){c=yn(Eq,c);let d=Ea.get(),e=d.get(c.key);if(!e)return;let f=e.getFrame(c.frame);if(!f)return;let g=c.width,j=c.height;(g===void 0||j===void 0)&&(g===void 0&&j===void 0?(c.width=f.width,c.height=f.height):g===void 0?c.width=f.width*(j/f.height):j===void 0&&(c.height=f.height*(g/f.width))),a.images.set(b,c)}const Eq={key:void 0,frame:void 0,width:void 0,height:void 0,y:0,left:0,right:0,top:0,bottom:0};class un{constructor(){this.images=new Map()}destroy(){this.images.clear()}add(a,b){if(typeof a==="string")pf(this,a,b);else if(Array.isArray(a)){let c=a;for(let d=0,e=c.length;d<e;d++)pf(this,c[d])}else{let c=a;for(a in c)pf(this,a,c[a])}return this}remove(a){return this.images.delete(a),this}get(a){return this.images.get(a)}getOuterWidth(a){let b=this.images.get(a);return b?b.width+b.left+b.right:0}getOuterHeight(a){let b=this.images.get(a);return b?b.height+b.top+b.bottom:0}getFrame(a){let b=this.images.get(a);if(!b)return;let c=Ea.get(),d=c.get(b.key);if(!d)return;let e=d.getFrame(b.frame);return e}hasTexture(a){return!!this.getFrame(a)}}function nf(a,b){a.font=b.font}function of(a,b){a.textBaseline="alphabetic",a.textAlign="start",a.fillStyle=b.fillStyle,a.strokeStyle=b.strokeStyle,a.lineWidth=b.strokeThickness,a.lineCap="round",a.lineJoin="round",a.imageSmoothingEnabled=b.antialias}function xi(a,b,c){c?(a.shadowColor=b.shadowColor,a.shadowBlur=b.shadowBlur,a.shadowOffsetX=b.shadowOffsetX,a.shadowOffsetY=b.shadowOffsetY):(a.shadowColor="#000",a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0)}function zn(a,b){return b.measureText(a).width}function An(a,b,c=0){let d=b.measureText(a),e=d.actualBoundingBoxAscent,f=d.actualBoundingBoxDescent;return(!e&&!f||a==="")&&(e=c,f=0),tf.ascent=e,tf.descent=f,tf.height=Math.ceil(Math.abs(e)+Math.abs(f)),tf}let tf={ascent:0,descent:0,height:0};function vn(a,b,c,d,e){a.freePens();if(b==="")return a;let f=c.canvas,g=c.context,j=c.parent,i=c.parser.splitText(b),k,n,o=0;for(var s=0,u=i.length;s<u;s++){let I=c.parser.tagTextToProp(i[s],k),N=I.text;k=I.prop;if(k.img){let J,Q;c.imageManager?(J=c.imageManager.getOuterWidth(k.img),Q=c.imageManager.getOuterHeight(k.img)):(J=0,Q=0),e>0&&d!==Da.none&&(e<o+J&&(a.addNewLinePen(xa.wrapped),o=0)),a.addImagePen(o,0,J,Q,oc(k)),o+=J}else if(N!==""){g.save();let J=c.parser.propToStyle(j,k);nf(g,J),of(g,J);let Q=J.strokeThickness,R=Q/2;n=Bn(N,zn,g,d,e,o);let L=An("|MÃq",g);for(let r=0,t=n.length;r<t;r++){const h=n[r],m=L.height+Q,l=L.ascent+R,q=L.descent+R;a.addTextPen(h.text,o,0,h.width,m,l,q,oc(k),h.newLineMode),h.newLineMode!==xa.none?o=0:o+=h.width}g.restore()}}let w=a.lines,z=c.parent.lineSpacing,G=0,K=0;for(let I=0,N=w.length;I<N;I++){const J=w[I],Q=J.pens,R=Q.length;let L=0,r=0;for(let m=0;m<R;m++){const l=Q[m];L=Math.max(L,l.ascent),r=Math.max(r,l.descent)}const t=L+r,h=K+L;for(let m=0;m<R;m++)Q[m].y+=h;J.y=h,J.height=t,G=Math.max(G,J.width),K+=t+z}return a.maxLineWidth=G,a.totalLineHeight=K-z,a}const Bj={PI2:Math.PI*2,HALF_PI:Math.PI*.5,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};class Dq extends Ia{constructor(a,b,c,d,e){super(a,b,c,d);this.name=e}}class xn{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return this.hitAreas.length=0,this}add(a,b,c,d,e){let f=new Dq(b,c,d,e,a);return this.hitAreas.push(f),this}getFirstHitArea(a,b){for(let c=0,d=this.hitAreas.length;c<d;c++){let e=this.hitAreas[c];if(e.contains(a,b))return e}return null}}function wn(a,b,c,d,e,f=0,g=0,j=a.penManager){a.hitAreaManager&&a.hitAreaManager.clear();let i=j.totalLineHeight;if(i===0)return;const k=d<a.textWidth||e<a.textHeight;let n=a.context;n.save();let o=a.parent;yq(a,o),zq(a,o),k&&(n.beginPath(),n.rect(b,c,d,e),n.clip());let s=o.align%3,u=Math.floor(o.align/3),w=c-g;switch(u){case Ad.center:w+=(e-i)/2;break;case Ad.bottom:w+=e-i-2;break}let z=j.lines,G=w;const K=b+e;for(let I=0,N=z.length;I<N;I++){let J=z[I];if(G>K)break;const Q=G+J.height;if(Q<c){G=Q;continue}let R=J.width;if(R===0){G=Q;continue}let L=b-f;switch(s){case zd.center:L+=(d-R)/2;break;case zd.right:L+=d-R;break}let r=J.pens;for(let t=0,h=r.length;t<h;t++)xq(a,r[t],L,w);G=Q}n.restore()}function xq(a,b,c,d){c+=b.x,d+=b.y;let e=a.canvas,f=a.context,g=a.parent;f.save();let j=a.parser.propToStyle(g,b.prop);nf(f,j),of(f,j),j.underlineThickness>0&&b.width>0&&Aq(a,c,d,b.width,j),b.isTextPen&&Bq(a,c,d,b.text,j),b.isImagePen&&Cq(a,c,d,b.prop.img,j),f.restore(),b.hasAreaMarker&&b.width>0&&(a.hitAreaManager||(a.hitAreaManager=new xn()),a.hitAreaManager.add(b.prop.area,c,d,b.width,b.height))}function yq(a,b){let c=a.canvas,d=a.context;d.clearRect(0,0,c.width,c.height)}function zq(a,b){let c=a.canvas,d=a.context;d.clearRect(0,0,c.width,c.height);const e=b.backgroundFillStyle,f=b.backgroundStrokeStyle;if(e||f){const g=b.backgroundStrokeThickness,j=g/2,i=b.cornerRadius,k=j,n=j,o=c.width-g,s=c.height-g;rd(c,d,k,n,o,s,i,e,f,g,b.backgroundFillColor2,b.backgroundIsHorizontalGradient)}else d.clearRect(0,0,c.width,c.height)}function Aq(a,b,c,d,e){c+=e.underlineOffsetY-e.underlineThickness/2;let f=a.context,g=f.lineCap;f.lineCap="butt",f.beginPath(),f.strokeStyle=e.underlineStyle,f.lineWidth=e.underlineThickness,f.moveTo(b,c),f.lineTo(b+d,c),f.stroke(),f.lineCap=g}function Bq(a,b,c,d,e){let f=a.context;e.strokeStyle&&e.strokeStyle!=="none"&&e.strokeThickness>0&&(xi(f,e,e.shadowStroke),f.strokeText(d,b,c)),e.fillStyle&&e.fillStyle!=="none"&&(xi(f,e,e.shadowFill),f.fillText(d,b,c))}function Cq(a,b,c,d,e){let f=a.imageManager;if(!f)return;let g=f.get(d),j=f.getFrame(d);b+=g.left,c+=g.y-g.height;let i=a.context;i.drawImage(j.texture.image,j.x,j.y,j.width,j.height,b,c,g.width,g.height)}class ln{constructor({canvas:a,context:b,parent:c,parser:d,penPool:e=new nc()}){this.textScrollX=0;this.textScrollY=0;this.canvas=a,this.context=b,this.parser=d,this.parent=c,this.penPool=e,this.penManager=new Bd({penPool:e})}destroy(){this.parser.destroy(),this.canvas=null,this.context=null,this.parser=null,this.parent=null,this.penManager&&(this.penManager.destroy(),this.penManager=null),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=null),this.imageManager&&(this.imageManager.destroy(),this.imageManager=null),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=null)}get textWidth(){return this.penManager.maxLineWidth}get textHeight(){return this.penManager.totalLineHeight}updatePenManager(a,b,c,d=this.penManager){return vn(d,a,this,b,c)}draw(a,b,c,d,e=0,f=0){return wn(this,a,b,c,d,e,f,this.penManager),this}get lines(){return this.penManager.lines}get tmpPenManager(){return this._tmpPenManager===null&&(this._tmpPenManager=new Bd({penPool:this.penPool})),this._tmpPenManager}getPlainText(a,b,c){let d;return a==null?d=this.penManager.plainText:d=this.parser.splitText(a,!0).join(""),(b!=null||c!=null)&&(b==null&&(b=0),c==null&&(c=d.length),d=d.substring(b,c)),d}getPenManager(a,b){return a===void 0?this.clonePenManager(b,this.penManager):(b===void 0&&(b=new Bd({penPool:this.penPool})),this.updatePenManager(a,this.parent.wrapMode,this.parent.wrapWidth,b),b)}getText(a,b,c,d){if(a==null)return this.penManager.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d);let e=this.tmpPenManager;return this.updatePenManager(a,this.parent.wrapMode,this.parent.wrapWidth,e),e.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d)}clonePenManager(a,b=this.penManager){return b.clone(a)}getLastPen(a=this.penManager){return a.lastPen}addImageInfo(a,b){return this.imageManager===void 0&&(this.imageManager=new un()),this.imageManager.add(a,b),this}}function ki(a,b=!0,c=!0){let d=a.canvasText;b&&d.updatePenManager(a.text,a.wrapMode,a.wrapWidth);if(c){let e=a.padding,f,g,j,i;a.fixedWidth===0?(f=d.textWidth,j=f+e.left+e.right):(j=a.fixedWidth,f=j-e.left-e.right,f>d.textWidth&&(f=d.textWidth)),a.fixedHeight===0?(g=d.textHeight,i=g+e.top+e.bottom):(i=a.fixedHeight,g=i-e.top-e.bottom,g>d.textHeight&&(g=d.textHeight));let k=a.resolution,n=Math.ceil(j*k),o=Math.ceil(i*k),s=a.canvas;(s.width!==n||s.height!==o)&&(s.width=n,s.height=o,a.texture.setSize(j,i),a.setSize(j,i));let u=a.context;u.save(),u.scale(k,k),d.draw(e.left,e.top,f,g,0,a.textScrollY),u.restore(),a.texture.binding&&a.texture.binding.update(),a.setDirty(Z.TEXTURE)}}function kf(a,b=0,c=0){a.fixedWidth=b,a.fixedHeight=c,mf(a)}function li(a,b,c,d,e){const f=a.padding;if(typeof b==="number")f.left=b,f.right=c===void 0?b:c,f.top=d===void 0?b:d,f.bottom=e===void 0?b:e;else{let g=b;f.left=g.left??0,f.right=g.right??0,f.top=g.top??0,f.bottom=g.bottom??0}mf(a)}function mf(a){const b=a.fixedWidth;if(a.wrapMode!==Da.none){const c=a.padding,d=b-c.left-c.right;a.wrapWidth=Math.max(d,0)}else a.wrapWidth=0}function mn(a,b,c=!1){c?a.textScrollYPercentage=b:a.textScrollY=b}function mi(a,b){typeof b==="string"&&(b=ab[b]),a.align=b}function ni(a,b=0){a.lineSpacing=b}function oi(a,b,c,d=0,e=0,f,g=!0){c||(d=0),a.backgroundFillStyle=b,a.backgroundFillColor2=f,a.backgroundIsHorizontalGradient=g,a.backgroundStrokeStyle=c,a.backgroundStrokeThickness=d,a.cornerRadius=e}function nn(a,b,c){b&&pi(a,b),c&&qi(a,c)}function pi(a,b){a.fontFamily=b}function qi(a,b){typeof b==="number"&&(b=`${b}px`),a.fontSize=b}function ri(a,b){a.fillStyle=b}function si(a,b,c=2){a.strokeStyle=b,a.strokeThickness=c}function ti(a,b="#000",c=5,d=0,e=0,f=!1,g=!1){a.shadowColor=b,a.shadowBlur=c,a.shadowOffsetX=d,a.shadowOffsetY=e,a.shadowFill=f,a.shadowStroke=g}function ui(a,b,c){typeof b==="string"&&(b=Da[b]),a.wrapMode=b,c===void 0?mf(a):a.wrapWidth=c}function vi(a,b,c=2,d=0){a.underlineStyle=b,a.underlineThickness=c,a.underlineOffsetY=d}function ji(a,b,c){a.canvasText.addImageInfo(b,c)}function on(a,b,c,d){return b=a.canvasText.getText(b,c,d,!0),b.split(wi)}function pn(a,b,c,d){return a.canvasText.getPlainText(b,c,d)}function qn(a,b,c,d){return a.canvasText.getText(b,c,d,!1)}function rn(a,b,c,d){return a.canvasText.getText(b,c,d,!1)}function sn(a,b){return a.canvasText.clonePenManager(b)}function tn(a,b,c){return a.canvasText.getPenManager(b,c)}class lf extends Wa{constructor(a,b,c="",{width:d=0,height:e=0,padding:f,wrapMode:g=Da.none,backgroundFillStyle:j,backgroundFillColor2:i,backgroundIsHorizontalGradient:k,backgroundStrokeStyle:n,backgroundStrokeThickness:o,cornerRadius:s=0,align:u=ab.TOP_LEFT,lineSpacing:w=0,fontFamily:z="monospace",fontSize:G="16px",fillStyle:K="#fff",strokeStyle:I,strokeThickness:N=1,shadowColor:J="#000",shadowBlur:Q=4,shadowOffsetX:R=0,shadowOffsetY:L=0,shadowFill:r=!1,shadowStroke:t=!1,underlineStyle:h="#fff",underlineThickness:m=1,underlineOffsetY:l=0,images:q}={},v){super(a,b,Bb());this.antialias=!1;this.fontFamily="monospace";this.fontSize="16px";this.fillStyle="#fff";this.strokeThickness=1;this.shadowStroke=!1;this.shadowFill=!1;this.shadowColor="#000";this.shadowBlur=4;this.shadowOffsetX=0;this.shadowOffsetY=0;this.underlineStyle="#fff";this.underlineThickness=1;this.underlineOffsetY=0;this.align=ab.TOP_LEFT;this.lineSpacing=0;this.wrapMode=Da.none;this.wrapWidth=0;this.fixedWidth=0;this.fixedHeight=0;this.padding={left:0,right:0,top:0,bottom:0};this._textScrollY=0;this.type="rexText";const p=ta.get();this.resolution=p.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.canvasText=new ln({canvas:this.canvas,context:this.context,parent:this,parser:v}),kf(this,d,e),f&&li(this,f),ui(this,g),mi(this,u),ni(this,w),oi(this,j,n,o,s,i,k),pi(this,z),qi(this,G),ri(this,K),I&&si(this,I,N),ti(this,J,Q,R,L,r,t),vi(this,h,m,l),q&&ji(this,q),this.setText(c)}destroy(a){this.canvasText.destroy(),this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}updateText(a=!0,b=!0){return ki(this,a,b),this}get text(){return this._text}set text(a){this.setText(a)}setText(a="",b=!0){return Array.isArray(a)&&(a=a.join(`
`)),a!==this._text&&(this._text=a.toString(),b&&this.updateText()),this}setBackgroundStyle(a,b,c=2,d=0,e,f=!0){return oi(this,a,b,c,d,e,f),this}setFixedSize(a,b){return kf(this,a,b),this}setPadding(a,b,c,d){return li(this,a,b,c,d),this}setTextScrollY(a,b=!1){return mn(this,a,b),this}setAlign(a){return mi(this,a),this}setLineSpacing(a=0){return ni(this,a),this}setFont(a,b){return nn(this,a,b),this}setFillStyle(a){return ri(this,a),this}setStrokeStyle(a,b=2){return si(this,a,b),this}setShadow(a="#000",b=5,c=0,d=0,e=!1,f=!1){return ti(this,a,b,c,d,e,f),this}resize(a,b){return kf(this,a,b),ki(this),this}setWrapMode(a,b=0){return ui(this,a,b),this}setUnderline(a,b=2,c=0){return vi(this,a,b,c),this}addImageInfo(a,b){return ji(this,a,b),this}getWrappedText(a,b,c){return on(this,a,b,c)}getPlainText(a,b,c){return pn(this,a,b,c)}getText(a,b,c){return qn(this,a,b,c)}getSubString(a,b,c){return rn(this,a,b,c)}clonePenManager(a){return sn(this,a)}getPenManager(a,b){return tn(this,a,b)}get textScrollY(){return this._textScrollY}set textScrollY(a){this._textScrollY=a}get textScrollYPercentage(){return this._textScrollY/(this.totalTextHeight-this.displayTextHeight)}set textScrollYPercentage(a){const b=this.displayTextHeight,c=this.totalTextHeight;c<=b?this._textScrollY=0:this._textScrollY=(c-b)*a}get totalTextHeight(){return this.canvasText.textHeight}get displayTextHeight(){const a=this.padding;return this.height-a.top-a.bottom}}class qf{destroy(){}}const rf={text:null,prop:null},sf={font:void 0,fontFamily:void 0,fontStyle:void 0,fontSize:void 0,fillStyle:void 0,strokeStyle:void 0,strokeThickness:void 0,shadowColor:void 0,shadowOffsetX:void 0,shadowOffsetY:void 0,shadowBlur:void 0,shadowStroke:void 0,shadowFill:void 0,underlineStyle:void 0,underlineThickness:void 0,underlineOffsetY:void 0,image:void 0};class Cn extends qf{splitText(a,b=!1){const c=[];let d=0;for(;;){const f=Ai.exec(a);if(!f)break;const g=f[0],j=Ai.lastIndex-g.length;d<j&&c.push(a.substring(d,j)),b||c.push(g),d=Ai.lastIndex}const e=a.length;return d<e&&c.push(a.substring(d,e)),c}tagTextToProp(a,b){let c,d;b==null&&(b={}),b.img&&va(b,ib,"img"),Hq.test(a)?(va(b,Va,"b",!0),c=""):Iq.test(a)?(va(b,ib,"b"),c=""):Jq.test(a)?(va(b,Va,"i",!0),c=""):Kq.test(a)?(va(b,ib,"i"),c=""):En.test(a)?(d=a.match(En),va(b,Va,"size",d[1]+"px"),c=""):Lq.test(a)?(va(b,ib,"size"),c=""):Fn.test(a)?(d=a.match(Fn),va(b,Va,"color",d[1]),c=""):Mq.test(a)?(va(b,ib,"color"),c=""):Gn.test(a)?(d=a.match(Gn),va(b,Va,"u",!0),c=""):Hn.test(a)?(d=a.match(Hn),va(b,Va,"u",d[1]),c=""):Nq.test(a)?(va(b,ib,"u"),c=""):Oq.test(a)?(va(b,Va,"shadow",!0),c=""):In.test(a)?(d=a.match(In),va(b,Va,"shadow",d[1]),c=""):Pq.test(a)?(va(b,ib,"shadow"),c=""):Qq.test(a)?(va(b,Va,"stroke",!0),c=""):Jn.test(a)?(d=a.match(Jn),va(b,Va,"stroke",d[1]),c=""):Rq.test(a)?(va(b,ib,"stroke"),c=""):Kn.test(a)?(d=a.match(Kn),va(b,Va,"img",d[1]),c=""):Sq.test(a)?(va(b,ib,"img"),c=""):Ln.test(a)?(d=a.match(Ln),va(b,Va,"area",d[1]),c=""):Tq.test(a)?(va(b,ib,"area"),c=""):c=a;const e=rf;return e.text=c,e.prop=b,e}propToStyle(a,b){const c=sf;return b.hasOwnProperty("img")?c.image=b.img:(c.image=null,c.fontFamily=a.fontFamily,c.fontSize=b.size??a.fontSize,c.fontStyle=Fq(b.b,b.i),c.font=`${c.fontStyle} ${c.fontSize} ${c.fontFamily}`,c.fillStyle=b.color??a.fillStyle,b.hasOwnProperty("stroke")?b.stroke===!0?(c.strokeStyle=a.strokeStyle,c.strokeThickness=a.strokeThickness):(c.strokeStyle=b.stroke,c.strokeThickness=a.strokeThickness):(c.strokeStyle=a.strokeStyle,c.strokeThickness=0)),b.hasOwnProperty("shadow")?b.shadow===!0?(c.shadowColor=a.shadowColor,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor=b.shadow,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor="#000",c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=0,c.shadowStroke=!1,c.shadowFill=!1),b.hasOwnProperty("u")?b.u===!0?(c.underlineStyle=a.underlineStyle,c.underlineThickness=a.underlineThickness,c.underlineOffsetY=a.underlineOffsetY):(c.underlineStyle=b.u,c.underlineThickness=a.underlineThickness,c.underlineOffsetY=a.underlineOffsetY):(c.underlineStyle="#000",c.underlineThickness=0,c.underlineOffsetY=0),c}propToTagText(a,b,c){c==null&&(c=Gq);let d=[];for(const f in c){if(b.hasOwnProperty(f))continue;d.push(`[/${f}]`)}a=`${d.join()}${a}`;let e=[];for(const f in b){if(c[f]===b[f])continue;switch(f){case"size":const g=b.size.replace("px","");e.push(`[size=${g}]`);break;case"color":case"img":case"area":e.push(`[${f}=${b[f]}]`);break;case"stroke":case"u":b[f]===!0?e.push(`[${f}]`):e.push(`[${f}=${b[f]}]`);break;default:e.push(`[${f}]`);break}}return a=`${a}${e.join()}`,a}}const va=function(a,b,c,d){return b===Va?a[c]=d:a.hasOwnProperty(c)&&delete a[c],a};var Fq=function(a,b){return a&&b?"bold italic":a?"bold":b?"italic":""};const Gq={},Ai=/\[b\]|\[\/b\]|\[i\]|\[\/i\]|\[size=(\d+)\]|\[\/size\]|\[color=([a-z]+|#[0-9abcdef]+)\]|\[\/color\]|\[u\]|\[u=([a-z]+|#[0-9abcdef]+)\]|\[\/u\]|\[shadow\]|\[shadow=([a-z]+|#[0-9abcdef]+)\]|\[\/shadow\]|\[stroke\]|\[stroke=([a-z]+|#[0-9abcdef]+)\]|\[\/stroke\]|\[img=([^\]]+)\]|\[\/img\]|\[area=([^\]]+)\]|\[\/area\]/ig;var Hq=/\[b\]/i,Iq=/\[\/b\]/i,Jq=/\[i\]/i,Kq=/\[\/i\]/i,En=/\[size=(\d+)\]/i,Lq=/\[\/size\]/i,Fn=/\[color=([a-z]+|#[0-9abcdef]+)\]/i,Mq=/\[\/color\]/i,Gn=/\[u\]/i,Hn=/\[u=([a-z]+|#[0-9abcdef]+)\]/i,Nq=/\[\/u\]/i,Oq=/\[shadow\]/i,In=/\[shadow=([a-z]+|#[0-9abcdef]+)\]/i,Pq=/\[\/shadow\]/i,Qq=/\[stroke\]/i,Jn=/\[stroke=([a-z]+|#[0-9abcdef]+)\]/i,Rq=/\[\/stroke\]/i,Kn=/\[img=([^\]]+)\]/i,Sq=/\[\/img\]/i,Ln=/\[area=([^\]]+)\]/i,Tq=/\[\/area\]/i;const ib=!1,Va=!0;class Dn extends lf{constructor(a,b,c="",d){super(a,b,c,d,new Cn());this.type="rexBBcodeText"}}class Nn extends qf{constructor(a){super();this.tags=new Map();if(a)for(const b in a)this.addTag(b,a[b])}destroy(){this.tags.clear()}addTag(a,b){return this.tags.set(a,b),this}isTextTag(a){const b=this.tags.get(a);return b?b.img==null:!1}splitText(a,b=!1){const c=[];let d=0;for(;;){const f=Bi.exec(a);if(!f)break;const g=f[0],j=Bi.lastIndex-g.length;d<j&&c.push(a.substring(d,j));if(!b)c.push(g);else if(Pn.test(g)){const i=g.match(Qn);c.push(i[2])}else if(Rn.test(g)){const i=g.match(Sn);c.push(i[2])}d=Bi.lastIndex}const e=a.length;return d<e&&c.push(a.substring(d,e)),c}tagTextToProp(a,b){let c,d;if(Pn.test(a)){const f=a.match(Qn);if(f!=null){const g=f[1],j=this.tags;d=j.get(g)??{},d._class=g,c=f[2]}}else if(Rn.test(a)){const f=a.match(Sn);if(f!=null){const g=f[1];d=Uq(g),d._style=g,c=f[2]}}c===void 0&&(c=a),d===void 0&&(d={});const e=rf;return e.text=c,e.prop=d,e}propToStyle(a,b){const c=sf;if(b.hasOwnProperty("img"))c.image=b.img;else{c.image=null,c.fontFamily=b.family??b.fontFamily??b["font-family"]??a.fontFamily;let d=b.size??b.fontSize??b["font-size"]??a.fontSize;typeof d==="number"&&(d=`${d}px`),c.fontSize=d,c.fontStyle=b.style??b.fontStyle??b["font-style"]??"",c.font=`${c.fontStyle} ${c.fontSize} ${c.fontFamily}`,c.fillStyle=b.color??b["font-color"]??a.fillStyle;if(b.hasOwnProperty("stroke")){const e=b.stroke;c.strokeStyle=e.color??a.strokeStyle,c.strokeThickness=e.thinkness??a.strokeThickness}else c.strokeStyle=a.strokeStyle,c.strokeThickness=a.strokeThickness}if(b.hasOwnProperty("shadow")){const d=b.shadow;c.shadowColor=d.color??a.shadowColor,c.shadowOffsetX=d.offsetX??a.shadowOffsetX,c.shadowOffsetY=d.offsetY??a.shadowOffsetY,c.shadowBlur=d.blur??a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0}else c.shadowColor=a.shadowColor,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=a.shadowStroke,c.shadowFill=a.shadowFill;if(b.hasOwnProperty("u")||b.hasOwnProperty("underline")){const d=b.u??b.underline;c.underlineStyle=d.color??a.underlineStyle,c.underlineThickness=d.thinkness??a.underlineThickness,c.underlineOffsetY=d.offset??a.underlineOffsetY}else c.underlineStyle="#000",c.underlineThickness=0,c.underlineOffsetY=0;return c}propToTagText(a,b,c){if(b.hasOwnProperty("_class")){if(a===""){if(this.isTextTag(b._class))return""}return`<class=${b._class}>${a}</class>`}else if(b.hasOwnProperty("_style"))return`<style=${b._style}>${a}</style>`}}function Uq(a){const b=a.split(";"),c={};for(var d=0,e=b.length;d<e;d++){const[f,g]=b[d].split(":");if(On(f)||On(g))continue;if(f==="stroke"){const j=g.split(" "),i={},k=j.length;k>=1&&(i.color=j[0]),k>=2&&(i.thinkness=parseInt(j[1].replace("px",""))),c.stroke=i}else if(f==="shadow"){const j=g.split(" "),i={},k=j.length;k>=1&&(i.color=j[0]),k>=2&&(i.offsetX=parseInt(j[1].replace("px",""))),k>=3&&(i.offsetY=parseInt(j[2].replace("px",""))),k>=4&&(i.blur=parseInt(j[3].replace("px",""))),c.shadow=i}else if(f==="u"||f==="underline"){const j=g.split(" "),i={},k=j.length;k>=1&&(i.color=j[0]),k>=2&&(i.thinkness=parseInt(j[1].replace("px",""))),k>=3&&(i.offset=parseInt(j[2].replace("px",""))),c[f]=i}else c[f]=g}return c}function On(a){return a=a.replace(Vq,""),a.length===0}const Bi=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,Pn=/<\s*class=/i,Qn=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,Rn=/<\s*style=/i,Sn=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,Vq=/^\s+|\s+$/;class Mn extends lf{constructor(a,b,c="",d){const e=d?d.tags:void 0;super(a,b,c,d,new Nn(e));this.type="rexTagText"}get parser(){return this.canvasText.parser}addTag(a,b){return this.parser.addTag(a,b),this}addTags(a){for(const b in a)this.parser.addTag(b,a[b]);return this}}function Ua(a,b){return a===void 0||b===void 0?void 0:`${a}|${b}`}function _k(a,b){let c=a.split("|");return b===void 0&&(b=Qp),b.x=parseInt(c[0]),b.y=parseInt(c[1]),b}let Qp={x:0,y:0};let qo=new nc();function gk(){let a=qo.pop();return a===null&&(a=new Map()),a}function se(a){qo.push(a)}function ek(a,b,c,d,e,f,g,j){if(c===f&&d===g&&e===j)return;let i=Ua(c,d),k=Ua(f,g);if(i){let n=b.get(i);n.delete(e);if(i===k){n.set(j,a);return}else n.size===0&&(se(n),b.delete(i))}if(k){let n=b.get(k);n?n.set(j,a):(n=gk(),n.set(j,a),b.set(k,n))}}function Ig(a,b,c,d){let e=Ua(b,c),f=a.get(e);f&&(d!==void 0?(f.delete(d),f.size===0&&(se(f),a.delete(e))):(f.clear(),se(f),a.delete(e)))}let ro=new nc();function fk(){let a=ro.pop();return a===null&&(a=new Set()),a}function Hg(a){ro.push(a)}function re(a,b,c,d){if(c===d)return;if(c!==void 0){let e=b.get(c);e&&(e.delete(a),e.size===0&&(Hg(e),b.delete(c)))}if(d!==void 0){let e=b.get(d);e?e.add(a):(e=fk(),e.add(a),b.set(d,e))}}function Zb(a,b,c){let d=a.get(b);d&&(d.delete(c),d.size===0&&(Hg(d),a.delete(b)))}function $j(a,b,c,d,e){let f=a.chessToXYZ.get(b),g=f?f.x:void 0,j=f?f.y:void 0,i=f?f.y:void 0;f?(f.x=c,f.y=d,f.z=e):a.chessToXYZ.set(b,{x:c,y:d,z:e}),ek(b,a.XYToZMap,g,j,i,c,d,e),re(b,a.XToChessSet,g,c),re(b,a.YToChessSet,j,d),re(b,a.ZToChessSet,i,e)}function Yb(a,b,c,d){let e=a.XYToZMap.get(Ua(b,c));return e===void 0?null:d!==void 0?e.has(d)?e.get(d):null:e}function ak(a,b,c,d){if(d!==void 0){let e=Yb(a,b,c,d);if(e===void 0)return;a.chessToXYZ.delete(e),Ig(a.XYToZMap,b,c,d),Zb(a.XToChessSet,b,e),Zb(a.YToChessSet,c,e),Zb(a.ZToChessSet,d,e)}else{let e=Yb(a,b,c);if(e){for(const[f,g]of e)a.chessToXYZ.delete(g),Zb(a.XToChessSet,b,g),Zb(a.YToChessSet,c,g),Zb(a.ZToChessSet,f,g);Ig(a.XYToZMap,b,c)}}}function bk(a,b){return a.chessToXYZ.has(b)}function ck(a,b,c,d){return Yb(a,b,c,d)!==null}function dk(a,b){return a.chessToXYZ.get(b)||null}function Fg(a){let b=-Infinity;for(const[c,d]of a)b<c&&(b=c);return b}function Gg(a){let b=Infinity;for(const[c,d]of a)b>c&&(b=c);return b}class qg{constructor(){this.chessToXYZ=new Map(),this.XYToZMap=new Map(),this.XToChessSet=new Map(),this.YToChessSet=new Map(),this.ZToChessSet=new Map(),this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0}destroy(){this.clear()}clear(){return this.chessToXYZ.clear(),this.XYToZMap.clear(),this.XToChessSet.clear(),this.YToChessSet.clear(),this.ZToChessSet.clear(),this.clearBounds(),this}clearBounds(){return this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0,this}addChess(a,b,c,d){return $j(this,a,b,c,d),this.clearBounds(),this}getChess(a,b,c){return Yb(this,a,b,c)}removeChess(a,b,c){return ak(this,a,b,c),this.clearBounds(),this}hasChess(a){return bk(this,a)}contains(a,b,c){return ck(this,a,b,c)}getXYZ(a){return dk(this,a)}get xMax(){return this._xMax===void 0&&(this._xMax=Fg(this.XToChessSet)),this._xMax}get xMin(){return this._xMin===void 0&&(this._xMin=Gg(this.XToChessSet)),this._xMin}get yMax(){return this._yMax===void 0&&(this._yMax=Fg(this.YToChessSet)),this._yMax}get yMin(){return this._yMin===void 0&&(this._yMin=Gg(this.YToChessSet)),this._yMin}}function db(a,b=[]){let c=a.boardData.chessToXYZ;for(const[d,e]of c)b.push(d);return b}function He(a){if(typeof a!=="object"||a.nodeType||a===a.window)return!1;try{if(a.constructor&&!{}.hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0}function ed(a){return He(a)?!0:typeof a==="object"?a.isTileXYZ:!1}function ba(a,b){let c=a.boardData.getXYZ(b);return c?c:ed(b)?b:null}function qa(a,b,c,d){return a.boardData.getChess(b,c,d)}class hk{constructor(a){this.parent=a,this.board=null,this.blocker=!1,this.boot()}boot(){typeof this.parent==="object"&&this.parent.on&&this.parent.on("destroy",this.destroy,this)}destroy(){if(this.board){let a=this.tileXYZ;this.board.boardData.removeChess(a.x,a.y,a.z)}this.parent=void 0,this.board=null}setBoard(a){return this.board=a,this}get tileXYZ(){return this.board==null?null:this.board.boardData.getXYZ(this.parent)}setBlocker(a=!0){return this.blocker=a,this}setBlockEdge(a,b=!0){typeof this.blocker==="boolean"&&(this.blocker={});let c=this.blocker;if(typeof a==="object"){let d=a;for(let e in d)c[e]=d[e]}else c[a]=b;return this}getBlockEdge(a){return typeof this.blocker==="boolean"?!1:this.blocker.hasOwnProperty(a)?this.blocker[a]:!1}}function Za(a){return a.hasOwnProperty("rexChess")||(a.rexChess=new hk(a)),a.rexChess}function Oa(a,b,c,d,e,f=!1,g=!1){if(b){let j=ba(a,b);if(j)c=j.x,d=j.y,e=j.z;else return}else{b=qa(a,c,d,e);if(!b)return}g||a.boardData.removeChess(c,d,e),a._isBoard&&Za(b).setBoard(null),f&&b.destroy&&b.destroy()}function Xb(a,b){if(a.infinityMode)return;if(a.height===void 0||a.height<=b){a.height=b;return}let c=db(a);c.forEach(d=>{let e=ba(a,d);e.y>b&&Oa(a,d)}),a.height=b}function Wb(a,b){if(a.infinityMode)return;if(a.width===void 0||a.width<=b){a.width=b;return}let c=db(a);c.forEach(d=>{let e=ba(a,d);e.x>b&&Oa(a,d)}),a.width=b}class ae{constructor({grid:a=void 0,wrap:b=!1,inifinity:c=!1,width:d=0,height:e=0}={}){this.boardData=new qg(),this._isBoard=!0,this.setGrid(a),this.setWrapMode(b),this.setInfinityMode(c),this.setBoardSize(d,e)}destroy(){}setGrid(a){return this.grid=a,this}setWrapMode(a=!0){return this.wrapMode=a,this}setInfinityMode(a=!0){return this.infinityMode=a,this}setBoardSize(a=0,b=0){return Wb(this,a),Xb(this,b),this}}function Ya(a,b,c,d){let e;return a.infinityMode?e=!0:e=b>=0&&b<a.width&&c>=0&&c<a.height,e&&d!==void 0&&(e=a.boardData.contains(b,c,d)),e}function Fa(a,b,c,d){return a.grid.getWorldXY(b,c,d)}function Bc(a,b,c,d){if(b===void 0){let e=db(a);for(let f=0,g=e.length;f<g;f++){let j=e[f],i=ba(a,j);Fa(a,i.x,i.y,j)}}else{if(c===void 0){let e=ba(a,b);c=e.x,d=e.y}Fa(a,c,d,b)}}function Cb(a,b,c,d,e,f=!0){if(!Ya(a,c,d))return;let g=ba(a,b);e===void 0&&(g?e=g.z:e=0);if(g&&g.x===c&&g.y===d&&g.z===e)return;let j=qa(a,c,d,e);j&&(Oa(a,null,c,d,e),console.warn(`Chess at (${c},${d},${e}) has been removed because of overlapped`)),a.boardData.addChess(b,c,d,e),a._isBoard&&Za(b).setBoard(a),f&&Bc(a,b,c,d)}function bc(a,b,c,d){return Math.atan2(d-b,c-a)}function Db(a,b,c){let d=ba(a,b),e=ba(a,c),f=Fa(a,d.x,d.y,!0),g=f.x,j=f.y;f=Fa(a,e.x,e.y,!0);let i=f.x,k=f.y;return bc(g,j,i,k)}function qb(a,b,c){let d=c-b;return b+((a-b)%d+d)%d}function Ac(a,b,c,d={x:0,y:0}){return d===!0&&(d=Zo),a.wrapMode?b=qb(b,0,a.width):!a.infinityMode&&(b<0||b>=a.width)&&(b=null),a.wrapMode?c=qb(c,0,a.height):!a.infinityMode&&(c<0||c>=a.height)&&(c=null),d.x=b,d.y=c,d}let Zo={x:0,y:0};function Na(a,b,c,d,e){let f=ba(a,b);if(f===null)return null;typeof c==="string"&&(c.indexOf(",")===-1?c=parseInt(c):c=c.split(".").map(k=>parseInt(k,10)));let g=typeof c==="number",j=typeof d==="number";if(g&&j){let k=a.grid.getTileXYAtDirection(f,c,d,e);return Ac(a,k.x,k.y,k),(k.x===null||k.y===null)&&(k=null),k}Array.isArray(e)||(e=[]),c===null&&(c=a.grid.allDirections);let i;if(g)if(Array.isArray(d))for(let k=0,n=d.length;k<n;k++)i=Na(a,f,c,d[k]),i!==null&&e.push(i);else{let k,n,o;({end:k=1,start:n=k>0?1:-1,step:o=k>=n?1:-1}=d);if(n===k)i=Na(a,f,c,k),i!==null&&e.push(i);else if(n<k)for(let s=n;s<=k;s+=o)i=Na(a,f,c,s),i!==null&&e.push(i);else for(let s=n;s>=k;s+=o)i=Na(a,f,c,s),i!==null&&e.push(i)}else for(let k=0,n=c.length;k<n;k++)j?(i=Na(a,f,c[k],d),i!==null&&e.push(i)):Na(a,f,c[k],d,e);return e}function hb(a,b,c=null,d={x:0,y:0}){return Na(a,b,c,1,d)}function xc(a,b,c){b===void 0&&(b=bp);let d=a.wrapMode,e=a.infinityMode;a.wrapMode=!1,a.infinityMode=!0;let f=hb(a,b,c,!0);return a.wrapMode=d,a.infinityMode=e,Db(a,b,f)}let bp={x:0,y:0};const ir=180/Math.PI;function Ec(a){return a*ir}function lk(a,b){let c=b-a;if(c===0)return 0;let d=Math.floor((c- -180)/360);return c-d*360}function wc(a,b,c){c=Ec(c);let d=a.grid.allDirections,e=Infinity,f;for(let g=0,j=d.length;g<j;g++){let i=Ec(xc(a,b,d[g])),k=Math.abs(lk(c,i));k<e&&(e=k,f=g)}return f}function zc(a,b,c){if(b===null||c===null)return null;if(b.x===c.x&&b.y===c.y)return null;let d=a.grid.getNeighborTileDirection(b,c);if(a.wrapMode&&d===null){let e=hb(a,b,null);for(let f=0,g=e.length;f<g;f++){let j=e[f];if(c.x===j.x&&c.y===j.y){d=f;break}}}return d}function yc(a,b,c){let d=ba(a,b),e=ba(a,c);return zc(a,d,e)}function ce(a,b,c){return yc(a,b,c)!==null}function de(a,b,c,d=!0){let e=ba(a,b),f=ba(a,c);return e===null||f===null?null:a.grid.directionBetween(e,f,d)}function bd(a,b,c=1,d=[]){let e=a.grid.ringToTileXYArray(b,c);for(let f=0,g=e.length;f<g;f++){let j=e[f];Ya(a,j.x,j.y)&&d.push(j)}return d}function rg(a,b,c,d=!0,e=[]){for(let f=0;f<=c;f++){let g=d?f:c-f;bd(a,b,g,e)}return e}function eb(a,b,c,d,e={x:0,y:0}){return e===!0&&(e=$o),c===0&&d===0?(e.x=b.x,e.y=b.y):a.grid.offset(b,c,d,e),e}let $o={x:0,y:0};function sg(a,b){let c=Infinity,d=Infinity,e;for(let j=0,i=b.length;j<i;j++)e=b[j],c=Math.min(c,e.x),d=Math.min(d,e.y);if(c!==0||d!==0)for(let j=0,i=b.length;j<i;j++)e=b[j],eb(a,e,-c,-d,e);let f=-Infinity,g=-Infinity;for(let j=0,i=b.length;j<i;j++)e=b[j],f=Math.max(f,e.x),g=Math.max(g,e.y);return Wb(a,f+1),Xb(a,g+1),b}var $b;(function(a){a[a["x+,y+"]=0]="x+,y+",a[a["x-,y+"]=1]="x-,y+",a[a["y+,x+"]=2]="y+,x+",a[a["y-,x+"]=3]="y-,x+"})($b||($b={}));function ee(a,b,c,d=0){let e={x:0,y:0};switch(d){case 0:for(let f=0;f<a.height;f++)for(let g=0;g<a.width;g++)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 1:for(let f=0;f<a.height;f++)for(let g=a.width-1;g>=0;g--)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 2:for(let f=0;f<a.width;f++)for(let g=0;g<a.height;g++)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a);break;case 3:for(let f=0;f<a.width;f++)for(let g=a.height-1;g>=0;g--)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a)}}function fe(a,b,c,d){return a.grid.getDistance(b,c,d)}function ad(a,b=0,c=[]){if(Array.isArray(b)){let d=b;for(let e=0;e<a.height;e++)for(let f=0;f<a.width;f++){let g=!0;for(let j=0,i=d.length;j<i;j++)if(qa(a,f,e,d[j])!==null){g=!1;break}g&&c.push({x:f,y:e})}}else for(let d=0;d<a.height;d++)for(let e=0;e<a.width;e++)qa(a,e,d,b)===null&&c.push({x:e,y:d});return c}function ge(a,b,c,d){return a.grid.getGridPoints(b,c,d)}function Pa(a,b,c,d=[]){let e=a.boardData.getChess(b,c);for(const[f,g]of e)d.push(g);return d}function Cc(a,b,c,d=[]){let e=c!=null,f,g;for(let j=0,i=b.length;j<i;j++)f=b[j],e?(g=qa(a,f.x,f.y,c),g!==null&&d.push(g)):Pa(a,f.x,f.y,d);return d}function he(a,b,c,d,e){let f=ba(a,b);if(f===null)return null;d==null&&(d=f.hasOwnProperty("z")?f.z:null);let g=hb(a,f,c,!0);return g===null?null:Array.isArray(g)?(e===void 0&&(e=[]),Cc(a,g,d,e)):d==null?(e===void 0&&(e=[]),Pa(a,g.x,g.y,e)):qa(a,g.x,g.y,d)}function ie(a,b,c,d={x:0,y:0}){let e=wc(a,b,c);return Na(a,b,e,1,d)}function je(a,b,c,d){return a.grid.getOppositeDirection(b,c,d)}function cd(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function Dc(a,b=0,c=a.length){let d=b+Math.floor(Math.random()*c);return a[d]===void 0?null:a[d]}function tg(a,b=0,c={x:0,y:0}){c===!0&&(c=Wo);let d=Math.floor(a.width*a.height*.3);for(let f=0;f<d;f++){let g=cd(0,a.width-1),j=cd(0,a.height-1);if(qa(a,g,j,b)===null)return c.x=g,c.y=j,c}let e=ad(a,b);if(e.length===0)return null;{let f=Dc(e);return c.x=f.x,c.y=f.y,c}}let Wo={x:0,y:0};function ug(a,b,c,d){if(d===void 0){let e=Pa(a,b,c);for(let f=0,g=e.length;f<g;f++){let j=Za(e[f]).blocker;if(j===!0)return!0}return!1}else{let e=qa(a,b,c,d);if(e===null)return!1;let f=Za(e).blocker;return f===!0}}function vg(a,b){return a.boardData.chessToXYZ.has(b)}function wg(a,b,c,d,e){if(d===void 0){let f=Pa(a,b,c);for(let g=0,j=f.length;g<j;g++)if(_j(Za(f[g]).blocker,e))return!0;return!1}else{let f=qa(a,b,c,d);return f===null?!1:_j(Za(f).blocker,e)}}function _j(a,b){return a===!1||a===!0?a:a[b]===!0}function Kg(a){return a=a%mo,a>=0?a:a+mo}const mo=Math.PI*2;function mk(a,b,c=1e-4){return Math.abs(a-b)<c}function ke(a,b,c,d,e){let f=ba(a,b),g=ba(a,c),j=Db(a,f,g);j=Kg(j);let i=Math.abs(j-d);i=Math.min(i,cp-i);let k=e/2;return mk(i,k)||i<k}const cp=Math.PI*2;function le(a,b,c,d,e){let f=ba(a,b),g=ba(a,c),j=a.grid.directions;a.grid.directions=a.grid.sides;let i=a.grid.directionBetween(f,g,!1);a.grid.directions=j;let k=Math.abs(i-d);return k=Math.min(k,a.grid.directions-k),k<=e/2}function Ka(a,b,c,d={x:0,y:0}){return a.grid.getTileXY(b,c,d)}function me(a,b,c,d){if(a.infinityMode&&d===void 0)return!0;let e=Ka(a,b,c,!0);return Ya(a,e.x,e.y,d)}function kk(a,b,c,d){let e=a-c,f=b-d;return Math.sqrt(e*e+f*f)}function Jg(a,b,c){return(b-a)*c+a}function xg(a,b,c,d,e,f=[]){let g=kk(b,c,d,e),j=Math.min(a.grid.width,a.grid.height),i=Math.ceil(g/(j/4)),k;for(let n=0;n<=i;n++){let o=n/i,s=Jg(b,d,o),u=Jg(c,e,o),w=Ka(a,s,u);if(!Ya(a,w.x,w.y))continue;if(k&&k.x===w.x&&k.y===w.y)continue;f.push(w),k=w}return f}var ac;(function(a){a[a.x=1]="x",a[a.horizontal=1]="horizontal",a[a.h=1]="h",a[a.y=2]="y",a[a.vertical=2]="vertical",a[a.v=2]="v",a[a.xy=3]="xy"})(ac||(ac={}));function yg(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=_o),d!==null?eb(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.mirror(e,c,e),d!==null&&eb(a,e,d.x,d.y,e),e}let _o={x:0,y:0};function zg(a,b=!1,c=!1){let d=db(a);for(let e=0,f=d.length;e<f;e++)Oa(a,d[e],void 0,void 0,void 0,b,c)}function Ag(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=ap),d!==null?eb(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.rotate(e,c,e),d!==null&&eb(a,e,d.x,d.y,e),e}let ap={x:0,y:0};function Bg(a,b,c){let d=ba(a,b);if(d===null)return;Cb(a,b,d.x,d.y,c)}function dd(a,b,c){return Math.max(b,Math.min(c,a))}function Cg(a,b,c,d=[]){let e=Ka(a,b.left,b.top,!0),f=e.x-1,g=e.y-1,j=Ka(a,b.right,b.bottom,!0),i=j.x+1,k=j.y+1;a.infinityMode||(f=dd(f,0,a.width-1),g=dd(g,0,a.height-1),i=dd(i,0,a.width-1),k=dd(k,0,a.height-1));for(let n=f;n<=i;n++)for(let o=g;o<=k;o++){let s=Fa(a,n,o,!0);c(b,s.x,s.y)&&d.push({x:n,y:o})}return d}function Dg(a,b,c,d=!0){let e=ba(a,b),f=ba(a,c);if(e==null||f==null)return;Oa(a,b),Oa(a,c),Cb(a,b,f.x,f.y,f.z,d),Cb(a,c,e.x,e.y,e.z,d)}function ne(a,b,c=[]){let d=a.boardData.ZToChessSet.get(b);if(d)for(const e of d)c.push(e);return c}function oe(a,b,c=[]){for(let d=0,e=b.length;d<e;d++){let f=b[d];c.push(Fa(a,f.x,f.y))}return c}function pe(a,b,c,d={x:0,y:0}){return d===!0&&(d=dp),Ka(a,b,c,d),Fa(a,d.x,d.y,d),d}let dp={x:0,y:0};function qe(a,b,c,d,e){let f=Ka(a,b,c,!0);return d!==void 0?qa(a,f.x,f.y,d):Pa(a,f.x,f.y,e)}class be extends ae{addChess(a,b,c,d,e=!0){return Cb(this,a,b,c,d,e),this}angleBetween(a,b){return Db(this,a,b)}angleSnapToDirection(a,b){return wc(this,a,b)}angleToward(a,b){return xc(this,a,b)}areNeighbors(a,b){return ce(this,a,b)}chessToTileXYZ(a){return ba(this,a)}contains(a,b,c){return Ya(this,a,b,c)}directionBetween(a,b,c=!0){return de(this,a,b,c)}filledRingToTileXYArray(a,b,c=!0,d=[]){return rg(this,a,b,c,d)}fit(a){return sg(this,a)}forEachTileXY(a,b,c=0){return ee(this,a,b,c),this}getAllChess(a=[]){return db(this,a)}getChessData(a){return Za(a)}getDistance(a,b,c=!1){return fe(this,a,b,c)}getEmptyTileXYArray(a=0,b=[]){return ad(this,a,b)}getGridPoints(a,b,c){return ge(this,a,b,c)}getNeighborChess(a,b,c,d){return he(this,a,b,c,d)}getNeighborChessDirection(a,b){return yc(this,a,b)}getNeighborTileDirection(a,b){return zc(this,a,b)}getNeighborTileXY(a,b=null,c={x:0,y:0}){return hb(this,a,b,c)}getNeighborTileXYAtAngle(a,b,c={x:0,y:0}){return ie(this,a,b,c)}getOppositeDirection(a,b,c){return je(this,a,b,c)}getRandomEmptyTileXY(a=0,b={x:0,y:0}){return tg(this,a,b)}getTileXYAtDirection(a,b,c,d){return Na(this,a,b,c,d)}getWrapTileXY(a,b,c={x:0,y:0}){return Ac(this,a,b,c)}gridAlign(a,b,c){return Bc(this,a,b,c),this}hasBlocker(a,b,c){return ug(this,a,b,c)}hasChess(a){return vg(this,a)}hasEdgeBlocker(a,b,c,d){return wg(this,a,b,c,d)}isAngleInCone(a,b,c,d){return ke(this,a,b,c,d)}isDirectionInCone(a,b,c,d){return le(this,a,b,c,d)}isOverlappingPoint(a,b,c){return me(this,a,b,c)}lineToTileXYArray(a,b,c,d,e=[]){return xg(this,a,b,c,d,e)}mirror(a,b,c=null,d={x:0,y:0}){return yg(this,a,b,c,d)}offset(a,b,c,d){return eb(this,a,b,c,d)}removeAllChess(a=!1,b=!1){return zg(this,a,b),this}removeChess(a,b,c,d,e=!1,f=!1){return Oa(this,a,b,c,d,e,f),this}ringToTileXYArray(a,b=1,c=[]){return bd(this,a,b,c)}rotate(a,b,c=null,d={x:0,y:0}){return Ag(this,a,b,c,d)}setBoardWidth(a=0){return Wb(this,a),this}setBoardHeight(a=0){return Xb(this,a),this}setTileZ(a,b){return Bg(this,a,b),this}shapeToTileXYArray(a,b,c=[]){return Cg(this,a,b,c)}swapChess(a,b,c=!0){return Dg(this,a,b,c),this}tileXYArrayToChessArray(a,b,c=[]){return Cc(this,a,b,c)}tileXYToChessArray(a,b,c=[]){return Pa(this,a,b,c)}tileXYZToChess(a,b,c){return qa(this,a,b,c)}tileZToChessArray(a,b=[]){return ne(this,a,b)}tileXYArrayToWorldXYArray(a,b=[]){return oe(this,a,b)}tileXYToWorldXY(a,b,c={x:0,y:0}){return Fa(this,a,b,c)}worldXYSnapToGrid(a,b,c={x:0,y:0}){return pe(this,a,b,c)}worldXYToChess(a,b,c,d){return qe(this,a,b,c,d)}worldXYToTileXY(a,b,c){return Ka(this,a,b,c)}}class Zj extends be{}const _a={};qc(_a,{ChessToTileXYZ:()=>ba,Contains:()=>Ya,DirectionBetween:()=>de,ForEachTileXY:()=>ee,GetDistance:()=>fe,GetOppositeDirection:()=>je,GetTileXYAtDirection:()=>Na,GetWrapTileXY:()=>Ac,IsDirectionInCone:()=>le,TileXYArrayToChessArray:()=>Cc,TileXYToChessArray:()=>Pa,TileXYZToChess:()=>qa,TileZToChessArray:()=>ne});const Eb={};qc(Eb,{AngleBetween:()=>Db,AngleSnapToDirection:()=>wc,AngleToward:()=>xc,GetGridPoints:()=>ge,GridAlign:()=>Bc,IsAngleInCone:()=>ke,IsOverlappingPoint:()=>me,TileXYArrayToWorldXYArray:()=>oe,TileXYToWorldXY:()=>Fa,WorldXYSnapToGrid:()=>pe,WorldXYToChess:()=>qe,WorldXYToTileXY:()=>Ka});const _b={};qc(_b,{AreNeighbors:()=>ce,GetNeighborChess:()=>he,GetNeighborChessDirection:()=>yc,GetNeighborTileDirection:()=>zc,GetNeighborTileXY:()=>hb,GetNeighborTileXYAtAngle:()=>ie});var oa;(function(a){a[a.orthogonal=0]="orthogonal",a[a.isometric=1]="isometric"})(oa||(oa={}));var rb;(function(a){a[a["4dir"]=4]="4dir",a[a["8dir"]=8]="8dir"})(rb||(rb={}));class Uk{constructor({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=oa.orthogonal,dir:f=rb["4dir"]}={}){this.setOriginPosition(a,b),this.setCellSize(c,d),this.setType(e),this.setDirectionMode(f)}fromJSON({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=oa.orthogonal,dir:f=rb["4dir"]}={}){return this.setType(e),this.setDirectionMode(f),this.setOriginPosition(a,b),this.setCellSize(c,d),this}toJSON(){return{x:this.x,y:this.y,cellWidth:this.cellWidth,cellHeight:this.cellHeight,type:this.mode,dir:this.directions}}setOriginPosition(a=0,b=0){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setType(a=oa.orthogonal){return typeof a==="string"&&(a=oa[a]),this.mode=a,this}setDirectionMode(a=rb["4dir"]){return typeof a==="string"&&(a=rb[a]),this.directions=a,this}}function Mk(a,b,c,d=!0){let e;switch(a.mode){case oa.orthogonal:case oa.isometric:if(b.y===c.y)e=c.x>=b.x?0:2;else if(b.x===c.x)e=c.y>=b.y?1:3;else if(a.directions===rb["4dir"]){let f=Ec(bc(b.x,b.y,c.x,c.y));f<0&&(f+=360),e=f/90,d&&(e=Math.round(e))}else{let f=c.x-b.x,g=c.y-b.y;if(f===g)e=f>0?4:6;else if(f===-g)e=f>0?7:5;else{let j=Ec(Math.atan2(g,f));j<0&&(j+=360);let i=j/45;d&&(i=Math.round(i)),i>=0&&i<1?e=i:i>=1&&i<2?e=i+3:i>=2&&i<3?e=i-1:i>=3&&i<4?e=i+2:i>=4&&i<5?e=i-2:i>=5&&i<6?e=i+1:i>=6&&i<7?e=i-3:e=i}}break}return e===a.directions&&(e=0),e}function Ce(a,b){return qb(b,0,a.directions)}function Nk(a,b,c,d=!1){let e=c.x-b.x,f=c.y-b.y,g;return d?g=Math.abs(e)+Math.abs(f):g=Math.sqrt(e*e+f*f),g}function ye(a,b=[]){if(!(b.length===a))if(b.length<a)for(let c=b.length;c<a;c++)b.push({x:0,y:0});else b.length=a;return b}function Fe(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=yp);let e,f;switch(a.mode){case oa.orthogonal:e=b*a.width,f=c*a.height;break;case oa.isometric:e=(b-c)*a._halfWidth,f=(b+c)*a._halfHeight;break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let yp={x:0,y:0};function Ok(a,b=0,c=0,d=[]){if(typeof b==="object"){let i=b;c=i.y,b=i.x}d===!0&&(d=up),ye(4,d);let e,f;({x:e,y:f}=Fe(a,b,c));let g=a._halfWidth,j=a._halfHeight;switch(a.mode){case oa.orthogonal:d[0].x=e+g,d[0].y=f-j,d[1].x=e+g,d[1].y=f+j,d[2].x=e-g,d[2].y=f+j,d[3].x=e-g,d[3].y=f-j;break;case oa.isometric:d[0].x=e+g,d[0].y=f,d[1].x=e,d[1].y=f+j,d[2].x=e-g,d[2].y=f,d[3].x=e,d[3].y=f-j;break}return d}let up=[];const Fc=[[1,0],[0,1],[-1,0],[0,-1],[1,1],[-1,1],[-1,-1],[1,-1]],fd=Fc;function Jk(a){let b={},c,d,e;for(let f in a)c=a[f],d=c[0],e=c[1],b.hasOwnProperty(d)||(b[d]={}),b[d][e]=parseInt(f);return b}const Kk=Jk(Fc),Lk=Jk(fd);function Pk(a,b,c){let d;switch(a.mode){case oa.orthogonal:d=Kk;break;case oa.isometric:d=Lk;break}let e=c.x-b.x,f=c.y-b.y;if(d.hasOwnProperty(e)){let g=d[e];if(g.hasOwnProperty(f))return g[f]}return null}function Ge(a,b,c,d,e={x:0,y:0}){e===!0&&(e=xp);let f,g;switch(a.mode){case oa.orthogonal:f=Fc[c][0],g=Fc[c][1];break;case oa.isometric:f=fd[c][0],g=fd[c][1];break}return d===1?(e.x=b.x+f,e.y=b.y+g):(e.x=b.x+d*f,e.y=b.y+d*g),e}let xp={x:0,y:0};function Qk(a,b,c,d={x:0,y:0}){return Ge(a,b,c,1,d)}function Rk(a,b,c,d){return vp[d]}const vp={0:2,1:3,2:0,3:1,4:6,5:7,6:4,7:5};function Sk(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=wp),b-=a.x,c-=a.y;let e=b/a.width,f=c/a.height;switch(a.mode){case oa.orthogonal:d.x=Math.round(e),d.y=Math.round(f);break;case oa.isometric:d.x=Math.round(+e+f),d.y=Math.round(-e+f);break}return d}let wp={x:0,y:0};function Tk(a,b,c,d={x:0,y:0}){return typeof c==="string"&&(c=ac[c]),d===!0&&(d=zp),d.x=c&1?-b.x:b.x,d.y=c&2?-b.y:b.y,d}let zp={x:0,y:0};function cc(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Ap);let f=b.x+c,g=b.y+d;return e.x=f,e.y=g,e}let Ap={x:0,y:0};function Vk(a,b,c,d=[]){let e,f;for(e=c,f=-c;f<=c;f++)d.push(cc(a,b,e,f));for(f=c,e=c-1;e>=-c;e--)d.push(cc(a,b,e,f));for(e=-c,f=c-1;f>=-c;f--)d.push(cc(a,b,e,f));for(f=-c,e=-c+1;e<=c-1;e++)d.push(cc(a,b,e,f));return d}function Wk(a,b,c,d={x:0,y:0}){d===!0&&(d=Fp),c=qb(c,0,3);let e,f;switch(c){case 1:e=-b.y,f=b.x;break;case 2:e=-b.x,f=-b.y;break;case 3:e=b.y,f=-b.x;break;default:e=b.x,f=b.y;break}return d.x=e,d.y=f,d}let Fp={x:0,y:0};function De(a){a._savedOriginX=a.x,a._savedOriginY=a.y}function Ee(a){a.x=a._savedOriginX,a.y=a._savedOriginY}class Ik extends Uk{get sides(){return 4}get allDirections(){return this.directions===4?Bp:Cp}get halfDirections(){return this.directions===4?Dp:Ep}directionBetween(a,b,c=!0){return Mk(this,a,b,c)}directionNormalize(a){return Ce(this,a)}getDistance(a,b,c=!1){return Nk(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return Ok(this,a,b,c)}getNeighborTileDirection(a,b){return Pk(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return Qk(this,a,b,c)}getOppositeDirection(a,b,c){return Rk(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return Sk(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return Ge(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return Fe(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return Tk(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return cc(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return Vk(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return Wk(this,a,b,c)}restoreOrigin(){return Ee(this),this}saveOrigin(){return De(this),this}}const Bp=[0,1,2,3],Cp=[0,1,2,3,4,5,6,7],Dp=[0,1],Ep=[0,1,4,5];var ca;(function(a){a[a.ODD_R=0]="ODD_R",a[a.EVEN_R=1]="EVEN_R",a[a.ODD_Q=2]="ODD_Q",a[a.EVEN_Q=3]="EVEN_Q"})(ca||(ca={}));var fb;(function(a){a[a.y=0]="y",a[a.flat=0]="flat",a[a.x=1]="x",a[a.pointy=1]="pointy"})(fb||(fb={}));var Hb;(function(a){a[a.even=0]="even",a[a.odd=1]="odd"})(Hb||(Hb={}));class Bk{constructor({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=fb.x,staggerIndex:g=Hb.odd}={}){this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e)}fromJSON({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=fb.x,staggerIndex:g=Hb.odd}={}){return this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e),this}toJSON(){return{x:this.x,y:this.y,radius:this.radius,cellWidth:this.cellWidth,cellHeight:this.cellHeight,staggerAxis:this.staggerAxis,staggerIndex:this.staggerIndex}}setOriginPosition(a,b){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this.radius=void 0,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setRadius(a=0){let b,c;return this.staggerAxis===fb.y?(b=2*a,c=Hk*a):(b=Hk*a,c=2*a),this.setCellSize(b,c),this.radius=a,this}setDirectionMode(){return this.directions=6,this}setType(a=1,b=1){return typeof a==="string"&&(a=fb[a]),typeof b==="string"&&(b=Hb[b]),this.staggerAxis=a,this.staggerIndex=b,a===fb.y?this.mode=b===Hb.even?ca.EVEN_Q:ca.ODD_Q:this.mode=b===Hb.even?ca.EVEN_R:ca.ODD_R,this}}const Hk=Math.sqrt(3);function Qa(a,b,c,d={x:0,y:0,z:0}){d===!0&&(d=Lg);switch(a){case ca.ODD_R:d.x=b-(c-(c&1))/2,d.z=c;break;case ca.EVEN_R:d.x=b-(c+(c&1))/2,d.z=c;break;case ca.ODD_Q:d.x=b,d.z=c-(b-(b&1))/2;break;case ca.EVEN_Q:d.x=b,d.z=c-(b+(b&1))/2;break}return d.y=-d.x-d.z,d}function pk(a,b,c,d={x:0,y:0,z:0}){typeof a!=="number"&&(d=a,a=d.x,b=d.y,c=d.z),d===!0&&(d=Lg);let e=Math.round(a),f=Math.round(b),g=Math.round(c),j=Math.abs(e-a),i=Math.abs(f-b),k=Math.abs(g-c);return j>i&&j>k?e=-f-g:i>k?f=-e-g:g=-e-f,d.x=e,d.y=f,d.z=g,d}function Ca(a,b,c,d,e={x:0,y:0}){e===!0&&(e=fp);switch(a){case ca.ODD_R:e.x=b+(d-(d&1))/2,e.y=d;break;case ca.EVEN_R:e.x=b+(d+(d&1))/2,e.y=d;break;case ca.ODD_Q:e.x=b,e.y=d+(b-(b&1))/2;break;case ca.EVEN_Q:e.x=b,e.y=d+(b+(b&1))/2;break}return e}function qk(a,b,c={x:0,y:0,z:0}){return c===!0&&(c=Lg),c.x=a,c.y=-a-b,c.z=b,c}let Lg={x:0,y:0,z:0},fp={x:0,y:0};function sk(a,b,c,d=!0){let e;Qa(a.mode,b.x,b.y,ue),Qa(a.mode,c.x,c.y,ve);let f=ve.x-ue.x,g=ve.y-ue.y,j=ve.z-ue.z;return j===0?e=f>0?0:3:f===0?e=j>0?1:4:g===0?e=j>0?2:5:f>0&&g<0&&j>0?e=0+j/-g:f<0&&g<0&&j>0?e=1+-g/j:f<0&&g>0&&j>0?e=2+g/-f:f<0&&g>0&&j<0?e=3+-j/g:f>0&&g>0&&j<0?e=4+f/-j:e=5+-g/f,d&&(e=Math.round(e)),e}let ue={x:0,y:0,z:0},ve={x:0,y:0,z:0};function tk(a,b,c,d=!1){Qa(a.mode,b.x,b.y,we),Qa(a.mode,c.x,c.y,xe);let e=xe.x-we.x,f=xe.y-we.y,g=xe.z-we.z;return(Math.abs(e)+Math.abs(f)+Math.abs(g))/2}let we={x:0,y:0,z:0},xe={x:0,y:0,z:0};function ze(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=op);let e=b*a.width,f=c*a.height;switch(a.mode){case ca.ODD_R:c&1&&(e+=a._halfWidth),f*=.75;break;case ca.EVEN_R:c&1&&(e-=a._halfWidth),f*=.75;break;case ca.ODD_Q:e*=.75,b&1&&(f+=a._halfHeight);break;case ca.EVEN_Q:e*=.75,b&1&&(f-=a._halfHeight);break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let op={x:0,y:0};function uk(a,b=0,c=0,d=[]){if(typeof b==="object"){let g=b;c=g.y,b=g.x}d===!0&&(d=kp),ye(6,d);let e,f;({x:e,y:f}=ze(a,b,c));if(a.radius!==void 0){let g=a.radius,j=a.staggerAxis===fb.flat?0:-30;for(let i=0;i<6;i++){let k=60*i+j,n=Fb(k);d[i].x=e+g*Math.cos(n),d[i].y=f+g*Math.sin(n)}}else{let g=a._halfWidth,j=g/2,i=a._halfHeight,k=i/2;a.staggerAxis===fb.flat?(d[0].x=e+g,d[0].y=f,d[1].x=e+j,d[1].y=f+i,d[2].x=e-j,d[2].y=f+i,d[3].x=e-g,d[3].y=f,d[4].x=e-j,d[4].y=f-i,d[5].x=e+j,d[5].y=f-i):(d[0].x=e+g,d[0].y=f-k,d[1].x=e+g,d[1].y=f+k,d[2].x=e,d[2].y=f+i,d[3].x=e-g,d[3].y=f+k,d[4].x=e-g,d[4].y=f-k,d[5].x=e,d[5].y=f-i)}return d}let kp=[];const gp=[[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]]],hp=[[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]],[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]]],ip=[[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]],[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]]],jp=[[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]],[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]]],$a=[gp,hp,ip,jp];function Gb(a){let b={},c,d;for(let e in a)[c,d]=a[e],b.hasOwnProperty(c)||(b[c]={}),b[c][d]=parseInt(e);return b}const rk=[[Gb($a[0][0]),Gb($a[0][1])],[Gb($a[1][0]),Gb($a[1][1])],[Gb($a[2][0]),Gb($a[2][1])],[Gb($a[3][0]),Gb($a[3][1])]];function Ae(a,b,c){let d;switch(a){case ca.ODD_R:case ca.EVEN_R:d=c&1;break;case ca.ODD_Q:case ca.EVEN_Q:d=b&1;break}return d}function vk(a,b,c){let d=a.mode,e=Ae(d,b.x,b.y),f=rk[d][e],g=c.x-b.x,j=c.y-b.y;if(f.hasOwnProperty(g)){let i=f[g];if(i.hasOwnProperty(j))return i[j]}return null}function Be(a,b,c,d,e={x:0,y:0}){e===!0&&(e=np);let f=a.mode,g=b.x,j=b.y;if(d===1){let i=Ae(f,g,j);e.x=g+$a[f][i][c][0],e.y=j+$a[f][i][c][1]}else if(d===0)e.x=g,e.y=j;else{let i=Qa(f,g,j,!0),k,n,o;switch(c){case 1:k=i.x,n=i.y-d,o=i.z+d;break;case 2:k=i.x-d,n=i.y,o=i.z+d;break;case 3:k=i.x-d,n=i.y+d,o=i.z;break;case 4:k=i.x,n=i.y+d,o=i.z-d;break;case 5:k=i.x+d,n=i.y,o=i.z-d;break;default:k=i.x+d,n=i.y-d,o=i.z;break}Ca(f,k,n,o,e)}return e}let np={x:0,y:0};function wk(a,b,c,d={x:0,y:0}){return Be(a,b,c,1,d)}function xk(a,b,c,d){return(d+3)%6}const yk=4/3,zk=2/3;function Ak(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=mp),b-=a.x,c-=a.y;let e,f;switch(a.mode){case ca.ODD_R:case ca.EVEN_R:f=c*yk/a.height,e=b/a.width-zk*(c/a.height);break;case ca.ODD_Q:case ca.EVEN_Q:f=c/a.height-zk*(b/a.width),e=b*yk/a.width;break}let g=qk(e,f,lp);return pk(g),Ca(a.mode,g.x,g.y,g.z,d),d}let lp={x:0,y:0,z:0},mp={x:0,y:0};function Ck(a,b,c,d={x:0,y:0}){typeof c==="string"&&(c=ac[c]),d===!0&&(d=rp);let e=Qa(a.mode,b.x,b.y,!0),f=a.mode===ca.ODD_R||a.mode===ca.EVEN_R,g,j,i;return c&1&&(f?(g=e.y,j=e.x,i=e.z):(g=-e.x,j=-e.z,i=-e.y),e.x=g,e.y=j,e.z=i),c&2&&(f?(g=-e.y,j=-e.x,i=-e.z):(g=e.x,j=e.z,i=e.y)),Ca(a.mode,g,j,i,d),d}let rp={x:0,y:0};function Dk(a,b,c,d,e={x:0,y:0}){e===!0&&(e=sp);let f=b.x+c,g=b.y+d;switch(a.mode){case ca.ODD_R:(d&1)!==0&&((g&1)===0&&(f+=1));break;case ca.EVEN_R:(d&1)!==0&&((g&1)===0&&(f-=1));break;case ca.ODD_Q:(c&1)!==0&&((f&1)==0&&(g+=1));break;case ca.EVEN_Q:(c&1)!==0&&((f&1)==0&&(g-=1));break}return e.x=f,e.y=g,e}let sp={x:0,y:0};function Ek(a,b,c,d=[]){let e=Qa(a.mode,b.x,b.y,!0),f=e.x,g=e.y,j=e.z,i,k,n;for(n=c,i=0;i>=-c;i--)k=-i-n,d.push(Ca(a.mode,f+i,g+k,j+n));for(i=-c,k=1;k<=c;k++)n=-i-k,d.push(Ca(a.mode,f+i,g+k,j+n));for(k=c,n=-1;n>=-c;n--)i=-k-n,d.push(Ca(a.mode,f+i,g+k,j+n));for(n=-c,i=1;i<=c;i++)k=-i-n,d.push(Ca(a.mode,f+i,g+k,j+n));for(i=c,k=-1;k>=-c;k--)n=-i-k,d.push(Ca(a.mode,f+i,g+k,j+n));for(k=-c,n=1;n<=c-1;n++)i=-k-n,d.push(Ca(a.mode,f+i,g+k,j+n));return d}function Fk(a,b,c,d={x:0,y:0}){d===!0&&(d=tp),c=qb(c,0,5);let e=Qa(a.mode,b.x,b.y,!0),f,g,j;switch(c){case 1:f=-e.z,g=-e.x,j=-e.y;break;case 2:f=e.y,g=e.z,j=e.x;break;case 3:f=-e.x,g=-e.y,j=-e.z;break;case 4:f=e.z,g=e.x,j=e.y;break;case 5:f=-e.y,g=-e.z,j=-e.x;break;default:f=e.x,g=e.y,j=e.z;break}return Ca(a.mode,f,g,j,d),d}let tp={x:0,y:0};class Gk extends Bk{get sides(){return 6}get allDirections(){return pp}get halfDirections(){return qp}directionBetween(a,b,c=!0){return sk(this,a,b,c)}directionNormalize(a){return Ce(this,a)}getDistance(a,b,c=!1){return tk(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return uk(this,a,b,c)}getNeighborTileDirection(a,b){return vk(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return wk(this,a,b,c)}getOppositeDirection(a,b,c){return xk(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return Ak(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return Be(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return ze(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return Ck(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return Dk(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return Ek(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return Fk(this,a,b,c)}restoreOrigin(){return Ee(this),this}saveOrigin(){return De(this),this}}const pp=[0,1,2,3,4,5],qp=[0,1,2];var Ba;(function(a){a[a.random=0]="random",a[a.diagonal=1]="diagonal",a[a.straight=2]="straight",a[a.line=3]="line",a[a.astar=10]="astar",a[a["astar-random"]=11]="astar-random",a[a["astar-line"]=12]="astar-line"})(Ba||(Ba={}));const dc=null;class ao{constructor(a){this.content=[],this.scoreFunction=a}clear(){this.content.length=0}push(a){this.content.push(a),this.sinkDown(this.content.length-1)}pop(){let a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.bubbleUp(0)),a}remove(a){let b=this.content.indexOf(a),c=this.content.pop();b!==this.content.length-1&&(this.content[b]=c,this.scoreFunction(c)<this.scoreFunction(a)?this.sinkDown(b):this.bubbleUp(b))}get size(){return this.content.length}rescoreElement(a){this.sinkDown(this.content.indexOf(a))}sinkDown(a){let b=this.content[a];for(;a>0;){let c=(a+1>>1)-1,d=this.content[c];if(this.scoreFunction(b)<this.scoreFunction(d))this.content[c]=b,this.content[a]=d,a=c;else break}}bubbleUp(a){let b=this.content.length,c=this.content[a],d=this.scoreFunction(c);for(;;){let e=a+1<<1,f=e-1,g=null,j;if(f<b){let i=this.content[f];j=this.scoreFunction(i),j<d&&(g=f)}if(e<b){let i=this.content[e],k=this.scoreFunction(i);k<(g===null?d:j)&&(g=e)}if(g!==null)this.content[a]=this.content[g],this.content[g]=c,a=g;else break}}}let $na=new ao(a=>a.f);const yf=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d=d.prevNodes[0];return c.reverse()};const eo=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d.prevNodes.length===1?d=d.prevNodes[0]:d=Dc(d.prevNodes);return c.reverse()};const co=function(a,b,c=[]){let d=b,e=b.angleTo(a);for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1)d=d.prevNodes[0];else{let f=Infinity;for(let g=1,j=d.prevNodes.length;g<j;g++){let i=d.prevNodes[g],k=Math.abs(b.angleTo(i)-e);k<f&&(f=k,d=i)}}}return c.reverse()};const bo=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let j=0,i=d.prevNodes.length;j<i;j++){f=d.prevNodes[j],g=f.logicDirTo(d);if(g!==e)break}e=g,d=f}}return c.reverse()};const fo=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let j=0,i=d.prevNodes.length;j<i;j++){f=d.prevNodes[j],g=f.logicDirTo(d);if(g===e)break}e=g,d=f}}return c.reverse()};let pc={};pc[Ba.astar]=yf;pc[Ba["astar-line"]]=yf;pc[Ba["astar-random"]]=yf;pc[Ba.random]=eo;pc[Ba.line]=co;pc[Ba.diagonal]=bo;pc[Ba.straight]=fo;class Zk{constructor(){this.prevNodes=[]}shutdown(){this.key=void 0,this.prevNodes.length=0}destroy(){this.shutdown()}reset(a){this.key=a,this.f=0,this.g=0,this.h=void 0,this.closerH=void 0,this.visited=!1,this.closed=!1}heuristic(a,b,c){if(b===null)return 0;let d,e=this.distanceTo(a)*this.manager.weight;switch(b){case Ba.astar:d=e;break;case Ba["astar-line"]:if(c!==void 0){let f=a.angleTo(c)-this.angleTo(c);d=e+Math.abs(f)}else d=e;case Ba["astar-random"]:d=e+Math.random();break;default:d=e;break}return d}getNextNodes(){return[]}getCost(a){return dc}distanceTo(a){return 0}angleTo(a){return 0}logicDirTo(a){return 0}getNode(a,b=!1){return this.manager.getNode(a,b)}}function ec(a){for(let b=a.length-1;b>0;b--){let c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a}class Pp extends Zk{constructor(a){super();this.isTileXYZ=!0;this.pathFinder=a}reset(a){super.reset(a),this.key=a,_k(a,this),this._px=void 0,this._py=void 0,this.cost=void 0}getNextNodes(){let a=_b.GetNeighborTileXY(this.board,this);this.pathFinder.shuffleNeighbors&&ec(a);let b=[];return a.forEach(c=>{let d=this.getNode(Ua(c.x,c.y),!0);b.push(d)}),b}getCost(a){return this.pathFinder.cacheCost?this.cost===void 0&&(this.cost=this.pathFinder.getCost(this,a)):this.cost=this.pathFinder.getCost(this,a),this.cost}distanceTo(a){return _a.GetDistance(this.board,this,a,!0)}angleTo(a){return bc(this.worldX,this.wroldY,a.worldX,a.worldX)}logicDirTo(a){return _b.GetNeighborTileDirection(this.board,this,a)}get board(){return this.pathFinder.board}get worldX(){if(this._px===void 0){let a=Eb.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._px}get wroldY(){if(this._py===void 0){let a=Eb.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._py}}class Kp{constructor(){this.data=[];this.visited=new Set()}push(a,b){if(Array.isArray(a)){let d=a;for(let e=0,f=d.length;e<f;e++)this.push(d[e]);return this}if(typeof a==="object"){let d=a;a=d.x,b=d.y}let c=`${a},${b}`;return this.visited.has(c)?this:(this.data.push({x:a,y:b}),this.visited.add(c),this)}pop(){return this.data.pop()}get length(){return this.data.length}clear(){return this.data.length=0,this.visited.clear(),this}}let J1=new Kp();var te;(function(a){a[a.direction=0]="direction",a[a.angle=1]="angle"})(te||(te={}));function bf(a,b,c){const d=Math.ceil(b*a.resolution),e=Math.ceil(c*a.resolution),f=a.canvas;if(f.width===d||f.height===e){cf(a);return}f.width=d,f.height=e,a.texture.setSize(b,c),a.setSize(b,c),a.updateTexture()}function cf(a){a.context.clearRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function bi(a,b="#fff"){let c=a.context;c.fillStyle=b,c.fillRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function df(a,b,c){const d=new Image();d.onload=function(){const e=a.resolution,f=d.width/e,g=d.height/e;bf(a,f,g),a.context.drawImage(d,0,0),a.updateTexture(),c&&c(),d.onload=null,d.src="",d.remove()},d.src=b}function ci(a,b){return new Promise(function(c,d){df(a,b,c)})}function di(a,b,c){return a.canvas.toDataURL(b,c)}function ei(a,b,c,d=[0,0,0,0]){const e=a.context.getImageData(b,c,1,1).data;return d[0]=e[0],d[1]=e[1],d[2]=e[2],d[3]=e[3],d}function fi(a,b,c,d,e,f,g){g===void 0&&(g=d!==0||e!==0||f!==0?255:0);const j=a.context.createImageData(1,1);j.data[0]=d,j.data[1]=e,j.data[2]=f,j.data[3]=g,a.context.putImageData(j,b,c),a.updateTexture()}class ic extends Wa{constructor(a=0,b=0,c=32,d=32){super(a,b,Bb());this.type="rexCanvas";const e=ta.get();this.resolution=e.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.resize(c,d)}updateTexture(){return this.texture.binding&&this.texture.binding.update(),this.setDirty(Z.TEXTURE),this}destroy(a){this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}resize(a,b){return bf(this,a,b),this}clear(){return cf(this),this}}function Sm(a,b){b.width!==a.width&&(b.width=a.width),b.height!==a.height&&(b.height=a.height);let c=b.getContext("2d");return c.drawImage(a.texture.image,a.x,a.y,a.width,a.height),b}function gi(a,b,c=0,d=0,e=a.width,f=a.height){const g=a.resolution,j=a.canvas,i=Math.ceil(e*g),k=Math.ceil(f*g);vb(b,function(n,o){n.width!==i&&(n.width=i),n.height!==k&&(n.height=k),o.clearRect(0,0,i,k),o.drawImage(j,c,d,i,k)},void 0,a.resolution)}function hi(a,b,c){const d=Ea.get();if(!d.has(b))return;Sm(d.get(b).getFrame(c),a.canvas);const e=a.canvas.width,f=a.canvas.height,g=a.resolution,j=e/g,i=f/g;a.texture.setSize(j,i),a.setSize(j,i),a.updateTexture()}class Rm extends ic{fill(a="#fff"){return bi(this,a),this}getCanvas(){return this.canvas}getContext(){return this.context}getDataURL(a,b){return di(this,a,b)}getPixel(a,b,c=[0,0,0,0]){return ei(this,a,b,c)}generateTexture(a,b=0,c=0,d=this.width,e=this.height){return gi(this,a,b,c,d,e),this}loadFromURL(a,b){return df(this,a,b),this}loadFromURLPromise(a){return ci(this,a)}loadTexture(a,b){return hi(this,a,b),this}setPixel(a,b,c,d,e,f){return fi(this,a,b,c,d,e,f),this}}class Hd extends ic{constructor({x:a=0,y:b=0,width:c=1,height:d=1,radius:e=0,fillStyle:f,fillColor2:g,isHorizontalGradient:j=!0,strokeStyle:i,lineWidth:k=2}={}){super(a,b);this.type="rexCanvasRoundRectangle",this.setRadius(e),this.setFillStyle(f,g,j),this.setStrokeStyle(i,k),this.resize(c,d)}setRadius(a){return this.radius=a,this}setFillStyle(a,b,c=!0){return this.fillStyle=a,this.fillColor2=b,this.isHorizontalGradient=c,this}setStrokeStyle(a,b){return this.strokeStyle=a,this.lineWidth=b,this}resize(a,b){return super.resize(a,b),this.refresh(),this}refresh(){let a=this.lineWidth;this.strokeStyle||(a=0);const b=a/2,c=b,d=b,e=this.width-a,f=this.height-a;return rd(this.canvas,this.context,c,d,e,f,this.radius,wb(this.fillStyle,this.canvas,this.context),wb(this.strokeStyle,this.canvas,this.context),a,this.fillColor2,this.isHorizontalGradient),this}}function Qi(a,b){return a.events.delete(b),a}function Pi(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);let e=d.size;for(const f of d){f.callback.apply(f.context,c),f.once&&d.delete(f),e--;if(e===0)break}return d.size===0&&a.events.delete(b),!0}class Dd{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function Si(a){return[...a.events.keys()]}function Ri(a,b){const c=a.events.get(b);return c?c.size:0}function Ti(a,b){const c=[],d=a.events.get(b);return d.forEach(e=>{c.push(e.callback)}),c}function Oi(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof Dd)g.delete(c);else{const j=!d,i=e!==void 0;for(const k of g)k.callback===c&&(j&&k.context===d)&&(i&&k.once===e)&&g.delete(k)}return g.size===0&&f.delete(b),a}function Cd(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new Dd(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function Ni(a,b,c,d=a){return Cd(a,b,c,d,!0)}function Af(a,b){b?a.events.delete(b):a.events.clear()}function lo(a){return class extends a{constructor(){super(...arguments);this.events=null}setEventEmitter(b){return this.destroyEventEmitter(),this.privateEE=b===void 0,this.privateEE?this.events=new Map():b?this.events=b.events:this.events=null,this.lastEventInstance=null,this}getEventEmitter(){return this}clearEventEmitter(){return this.setEventEmitter(null),this}destroyEventEmitter(){return this.lastEventInstance=null,this.events&&this.privateEE&&(Af(this),this.events=null),this}on(b,c,d=this,e=!1){return this.lastEventInstance=null,this.events&&(this.lastEventInstance=Cd(this,b,c,d,e)),this}once(b,c,d=this){return this.lastEventInstance=null,this.events&&(this.lastEventInstance=Ni(this,b,c,d)),this}off(b,c,d,e){return this.lastEventInstance=null,this.events&&Oi(this,b,c,d,e),this}emit(b,...c){return this.lastEventInstance=null,this.events&&Pi(this,b,...c),this}removeAllListeners(b){return this.lastEventInstance=null,this.events&&Af(this,b),this}clearEvent(b){return this.lastEventInstance=null,this.events&&Qi(this,b),this}getListenerCount(b){return this.lastEventInstance=null,this.events?Ri(this,b):0}getEventNames(){return this.lastEventInstance=null,this.events?Si(this):[]}getListeners(b){return this.lastEventInstance=null,this.events?Ti(this,b):[]}}}const ua=lo(class{});var jb;(function(a){a[a.no=0]="no",a[a.lazy=1]="lazy",a[a.always=2]="always"})(jb||(jb={}));const Vi="complete";class wf extends ua{constructor(a,{eventEmitter:b,tickingMode:c=jb.lazy}={}){super();this._isRunning=!1;this.tickingState=!1;this.parent=a,this.setEventEmitter(b),this.setTickingMode(c)}boot(){this.tickingMode===jb.always&&!this.tickingState&&this.startTicking()}shutdown(){this.destroyEventEmitter(),this.tickingState&&this.stopTicking()}setTickingMode(a){typeof a==="string"&&(a=jb[a]),this.tickingMode=a}startTicking(){this.tickingState=!0}stopTicking(){this.tickingState=!1}get isRunning(){return this._isRunning}set isRunning(a){if(this._isRunning===a)return;this._isRunning=a,this.tickingMode===jb.lazy&&a!=this.tickingState&&(a?this.startTicking():this.stopTicking())}start(){return this.isRunning=!0,this}pause(){return this.isRunning=!1,this}resume(){return this.isRunning=!0,this}stop(){return this.isRunning=!1,this}complete(a=Vi){this.isRunning=!1,this.emit(a,this.parent,this)}}class uf extends wf{constructor(a,{updater:b=a,isRunning:c=!1,timeScale:d=1,now:e=0,tickingMode:f=jb.lazy}={}){super(a,arguments[1]);this.updater=null;this.timeScale=1;this.now=0;this.parent=a,this.setUpdater(b),this.isRunning=c,this.timeScale=d,this.now=e,this.setTickingMode(f),this.boot()}resetFromJSON({isRunning:a=!1,timeScale:b=1,now:c=0,tickingMode:d=jb.lazy}={}){return this.isRunning=a,this.timeScale=b,this.now=c,this.setTickingMode(d),this}toJSON(){return{isRunning:this.isRunning,timeScale:this.timeScale,now:this.now,tickingMode:this.tickingMode}}boot(){super.boot(),Xa(this.parent,"destroy",this.destroy,this)}shutdown(){super.shutdown(),this.parent=void 0,this.updater=void 0}destroy(){this.shutdown()}setUpdater(a){return a instanceof ob&&(a=a.world),a instanceof Fd||a instanceof Vb?this.updater=a:this.updater=null,this}startTicking(){this.update===null&&this.setUpdater(this.parent);if(this.update===null)return;super.startTicking(),this.updater&&Xa(this.updater,"update",this.update,this)}stopTicking(){super.stopTicking(),this.updater&&nb(this.updater,"update",this.update,this)}start(a=0){return this.now=a,super.start(),this}seek(a){return this.now=a,this}update(a){return!this.isRunning||this.timeScale===0?this:(this.now+=a*this.timeScale,this)}}const Opa=Ha(pg());const Og="receive";const al={receive:Og};function bl(a,b){(!a.sendToRef||a.sendToRef.key!==a.receiverID)&&(a.sendToRef=a.database.ref(a.rootPath).child(a.receiverID));if(b===void 0)return a.sendToRef.remove();let c={message:b,senderID:a.userID,stamp:a.stamp};return a.userName!==void 0&&(c.senderName=a.userName),a.skipFirst=!1,a.stamp=!a.stamp,a.sendToRef.set(c)}function cl(a){if(a.isReceiving&&a.receiverRef.key===a.receiverID)return;Ng(a),a.isReceiving=!0,a.skipFirst=!0,a.receiverRef=a.database.ref(a.rootPath).child(a.receiverID),a.receiverRef.on("value",el,a),a.receiverRef.onDisconnect().remove()}function Ng(a){if(!a.isReceiving)return;a.isReceiving=!1,a.receiverRef.off("value",el,a),a.receiverRef.remove(),a.receiverRef.onDisconnect().cancel()}function el(a){if(this.skipFirst){this.skipFirst=!1;return}let b=a.val();if(b==null)return;delete b.stamp,this.history.add(b),this.emit(this.eventNames.receive,b)}class dl{constructor({maxLength:a=-1}={}){this.maxLength=a,this.records=[]}add(a){return this.maxLength===0?this:(this.records.push(a),this.maxLength>0&&this.records.length>this.maxLength&&this.records.shift(),this)}clear(){return this.records.length=0,this}changeUserName(a,b){return this.maxLength===0?this:(this.records.forEach(c=>{c.senderID===a&&(c.senderName=b)}),this)}}const O4=Ha(Ma());class Hc extends ua{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d,receiverID:e="",history:f=0,eventNames:g=al}={}){super();this.setEventEmitter(a),this.eventNames=g,this.database=O4.database(),this.setRootPath(b),this.skipFirst=!0,this.stamp=!1,this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.isReceiving=!1,f===!0?f=-1:f===!1&&(f=0),this.history=new dl({maxLength:f})}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.sendToRef=void 0,this.receiverRef=void 0,this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.receiverID=a,this}changeUserName(a,b){return a===this.userID&&(this.userName=b),this.history.changeUserName(a,b),this}getHistory(){return this.history.records}clearHistory(){return this.history.clear(),this}send(a){return bl(this,a)}startReceiving(){return cl(this),this}stopReceiving(){return Ng(this),this}}const kr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function Oe(a,b,c=kr){let d=b===void 0?a:cd(a,b),e="";for(let f=0;f<d;f++)e+=Dc(Array.from(c));return e}const _ca=Ha(Ma());var ra;(function(a){a[a["1d"]=1]="1d",a[a["2d"]=2]="2d",a[a["3d"]=3]="3d"})(ra||(ra={}));const Vg="init";const Wg="update";const Pg="addkey0";const Qg="addkey1";const Rg="addkey2";const Xg="removekey0";const Yg="removekey1";const Zg="removekey2";const Sg="changekey0";const Tg="changekey1";const Ug="changekey2";const fl={init:Vg,update:Wg,addkey0:Pg,removekey0:Xg,changekey0:Sg,addkey1:Qg,removekey1:Yg,changekey1:Tg,addkey2:Rg,removekey2:Zg,changekey2:Ug};function oo(a){return a==null||a===""||a.length===0}function jr(a,b,c={}){let d=a;if(!oo(b)){typeof b==="string"&&(b=b.split("."));let e;for(let f=0,g=b.length;f<g;f++){e=b[f];if(d[e]==null||typeof d[e]!=="object"){let j;f===g-1?j=c:j={},d[e]=j}d=d[e]}}return d}function po(a,b,c){if(typeof a!=="object")return;if(oo(b)){if(c==null)return;typeof c==="object"&&(a=c)}else{typeof b==="string"&&(b=b.split("."));let d=b.pop(),e=jr(a,b);e[d]=c}return a}function no(a){return JSON.parse(JSON.stringify(a))}class gl{constructor(){this.data={}}setValue(a,b){return a==null?this.clear():typeof a==="object"?this.data=a:po(this.data,a,b),this}getValue(a){if(a==null)return this.data;{typeof a==="string"&&(a=a.split("."));let b=this.data;for(let c=0,d=a.length;c<d;c++){if(!Ui(b))return;b=b[a[c]]}return b}}cloneValue(a){return no(this.getValue(a))}removeKey(a){if(a==null)this.clear();else{typeof a==="string"&&(a=a.split("."));let b=a.pop(),c=this.data;for(let d=0,e=a.length;d<e;d++){if(!Ui(c))return this;c=c[a[d]]}Ui(c)&&delete c[b]}return this}clear(){return Bf(this.data),this}incValue(a,b=1){let c=this.getValue(a);return typeof c!=="number"&&(c=0),this.setValue(a,c+b),this}mulValue(a,b){let c=this.getValue(a);return typeof c!=="number"&&(c=1),this.setValue(a,c*b),this}}function Ui(a){return a!=null&&typeof a==="object"}const d6=Ha(Ma());class fc extends ua{constructor({eventEmitter:a,parent:b,key:c,type:d,eventNames:e,table:f}={}){super();this.setEventEmitter(a),this.parent=b,this.children=new Map(),this.key=c,this.parent?this.fullKeyPath=ql(this.parent.fullKeyPath,this.key):this.fullKeyPath="",this.type=d,this.eventNames=e,this.table=f,this.database=d6.database(),this.setRootPath()}destroy(){this.stopUpdate().clear().destroyEventEmitter()}setRootPath(a){if(a===void 0){let b=this.parent?this.parent.rootPath:"";a=`${b}/${this.key}`}this.rootPath=a,this.rootRef=a!==""?this.database.ref(a):void 0;for(const[b,c]of this.children)c instanceof fc&&c.setRootPath();return this}setData(a,b){if(arguments.length===0)this.clear();else if(typeof a=="string")this.setChildData(a,b);else{let c=a;for(const[d,e]of this.children)c.hasOwnProperty(d)||this.removeChild(d);for(let d in c)this.setChildData(d,c[d])}return this}clear(){this.table.removeKey(this.fullKeyPath);for(const[a,b]of this.children)this.removeChild(a);return this}get childClass(){return null}setChildData(a,b){const c=ql(this.fullKeyPath,a);this.table.setValue(c,b);if(!(typeof b!=="object")){if(this.children.has(a))this.children.get(a).setData(b);else if(this.childClass){let d=new this.childClass({parent:this,key:a,type:this.type,eventEmitter:this.eventEmitter,eventNames:this.eventNames,table:this.table});d.startUpdate(),this.children.set(a,d)}}return this}removeChild(a){return this.children.has(a)&&(this.children.get(a).destroy(),this.children.delete(a)),this}startUpdate(){return this}stopUpdate(){return this}}function ql(a,b){return a==null||a===""?b:b==null||b===""?a:`${a}.${b}`}class gd extends fc{startUpdate(){return this.rootRef.on("child_added",this.addCol,this),this.rootRef.on("child_removed",this.removeCol,this),this.rootRef.on("child_changed",this.changeColValue,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addCol,this),this.rootRef.off("child_removed",this.removeCol,this),this.rootRef.off("child_changed",this.changeColValue,this),this}addCol(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["1d"]:this.emit(this.eventNames.addkey0,b,c);break;case ra["2d"]:this.emit(this.eventNames.addkey1,this.key,b,c);break;default:this.emit(this.eventNames.addkey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}removeCol(a){const b=a.key;this.removeChild(b);switch(this.type){case ra["1d"]:this.emit(this.eventNames.removekey0,b);break;case ra["2d"]:this.emit(this.eventNames.removekey1,this.key,b);break;default:this.emit(this.eventNames.removekey2,this.pageKey,this.key,b);break}this.emit(this.eventNames.update,this.table.data)}changeColValue(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["1d"]:this.emit(this.eventNames.changekey0,b,c);break;case ra["2d"]:this.emit(this.eventNames.changekey1,this.key,b,c);break;default:this.emit(this.eventNames.changekey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}get pageKey(){return this.parent.key}}class hd extends fc{startUpdate(){return this.rootRef.on("child_added",this.addRow,this),this.rootRef.on("child_removed",this.removeRow,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addRow,this),this.rootRef.off("child_removed",this.removeRow,this),this}addRow(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["2d"]:this.emit(this.eventNames.addkey0,b,c);break;default:this.emit(this.eventNames.addkey1,this.key,b,c);break}}removeRow(a){const b=a.key;this.removeChild(b);switch(this.type){case ra["2d"]:this.emit(this.eventNames.removekey0,b);break;default:this.emit(this.eventNames.removekey1,this.key,b);break}}get childClass(){return gd}}class _g extends fc{startUpdate(){return this.rootRef.on("child_added",this.addPage,this),this.rootRef.on("child_removed",this.removePage,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addPage,this),this.rootRef.off("child_removed",this.removePage,this),this}addPage(a){const b=a.key,c=a.val();this.setData(b,c),this.emit(this.eventNames.addkey0,b,c)}removePage(a){const b=a.key;this.removeChild(b),this.emit(this.eventNames.removekey0,b)}get childClass(){return hd}}const Ke={};Ke[ra["1d"]]=gd;Ke[ra["2d"]]=hd;Ke[ra["3d"]]=_g;function hl(a){return new Ke[a.tableType]({type:a.tableType,eventEmitter:a.eventEmitter,eventNames:a.eventNames,table:a.table})}function il(a){return a.updater.clear(),a.initialFlag=!1,a.rootRef.once("value").then(function(b){let c=b.val()??{};return a.table.setValue(c),a.emit(a.eventNames.init,c),a.initialFlag=!0,Promise.resolve(c)})}function Ga(a,b,c,d){let e=a.rootRef;return e=b?e.child(b):e,e=c?e.child(c):e,e=d?e.child(d):e,e}function jl(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ga(a,c,d,e).set(f)}function kl(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;default:c=b[0];break}return Ga(a,c,d,e).remove()}function ll(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ga(a,c,d,e).transaction(function(g){return g===null&&(g=0),g+f})}function ml(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ga(a,c,d,e).transaction(f)}function nl(a,b){return Ga(a).update(b)}function ol(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;case 1:c=b[0];break}return Ga(a,c,d,e).onDisconnect().remove()}function pl(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ga(a,c,d,e).onDisconnect().set(f)}const g5=Ha(Ma());class Ic extends ua{constructor({eventEmitter:a,root:b="",type:c=ra["3d"],eventNames:d=fl}={}){super();this.setEventEmitter(a),this.eventNames=d,this.database=g5.database(),this.table=new gl(),this.setTableType(c),this.setRootPath(b),this.initialFlag=!1}destroy(){this.updater.destroy(),this.destroyEventEmitter().stopUpdate()}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):null,this.updater.setRootPath(a),this}setTableType(a){return typeof a==="string"&&(a=ra[a]),this.tableType=a,this.updater&&this.updater.destroy(),this.updater=hl(this),this}startUpdate(){return il(this),this.updater.startUpdate(),this}stopUpdate(){return this.updater.stopUpdate(),this}clear(){return this.updater.clear(),this}getData(){return this.table.getValue(...arguments)}cloneData(){return this.table.cloneValue(...arguments)}getItemRef(a,b,c){return Ga(this,a,b,c)}setData(...a){return jl(this,...a)}removeData(...a){return kl(this,...a)}incValue(...a){return ll(this,...a)}transaction(...a){return ml(this,...a)}updateData(a){return nl(this,a)}removeDataOnDisconnect(...a){return ol(this,...a)}setDataOnDisconnect(...a){return pl(this,...a)}}const ica=Ha(Ma());var Yh;(function(a){a.d="d",a.w="w",a.m="m",a.y="y",a.day="d",a.week="w",a.month="m",a.year="y"})(Yh||(Yh={}));var pd;(function(a){a.d="tagD",a.w="tagW",a.m="tagM",a.y="tagY"})(pd||(pd={}));var qd;(function(a){a.d="scoreD",a.w="scoreW",a.m="scoreM",a.y="scoreY"})(qd||(qd={}));var ym;(function(a){a.d="day",a.w="week",a.m="month",a.y="year"})(ym||(ym={}));function ai({query:a,totalLines:b=Infinity,linesPerPage:c=1e3,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g}){return Qm({query:a,remainderLines:b,linesPerPage:c,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g})}function Qm(a){let b=a.query;a.startDocRef&&(b=b[a.startMode](a.startDocRef));let c=Math.min(a.remainderLines,a.linesPerPage);return a.remainderLines-=c,b.limit(c).get().then(function(d){let e=a.remainderLines===0||d.size<c,f=!1;a.forEachPageCallback&&(f=a.forEachPageCallback(d)||!1),e=e||f;if(e){let g;return a.resolveCallback&&(g=a.resolveCallback()),Promise.resolve(g)}else return a.startDocRef=d.docs[d.size-1],a.startMode="startAfter",Qm(a)})}function La(a,b=Infinity,c=0,d,e){let f=[],g=0;return ai({query:a,totalLines:c+b,startDocRef:d,startMode:e,forEachPageCallback:function(j){let i,k=j.size,n=c-g;n<=0?i=j.docs:n<k&&(i=j.docs.slice(n,k)),i&&f.push(...i),g+=k},resolveCallback:function(){return f}})}const nfa=Ha(Ma());function Hm(a,b,c=0){return La(a.nextQuery,b,c,a.baselineDocRef,a.baselineMode).then(function(d){let e=d.length;return a.cacheItems=d,a.pageIndex=void 0,a.startItemIndex=c,a.endItemIndex=a.startItemIndex+e-1,a.isFullPage=b===void 0?!0:e===b,Promise.resolve(a.cacheItems)})}const Nea=Ha(Ma());class af{constructor({query:a={next:void 0,previous:void 0},itemCount:b=100,baselineDoc:c,baselineMode:d="startAt"}={}){this.setQuery(a),this.setItemCount(b),this.setBaselineDoc(c,d),this.pageIndex=void 0,this.baselineDocRef=void 0,this.baselineMode="startAt",this.startItemIndex=void 0,this.endItemIndex=void 0,this.cacheItems=void 0,this.isFullPage=void 0}setQuery(a,b){if(a instanceof Nea.firestore.Query)this.nextQuery=a,this.prevQuery=b;else{var c=a;this.nextQuery=c.next,this.prevQuery=c.previous}return this.pageIndex=null,this.isFullPage=!0,this}setItemCount(a){return this.itemCount=a,this}setBaselineDoc(a,b){return a?(this.baselineDocRef=a.ref,this.baselineMode=b):this.baselineDocRef=void 0,this}load(a,b=0){return Hm(this,a,b)}loadFirstPage(){return this._loadFirstPage()}loadNextPage(){return this.pageIndex==null?this._loadFirstPage():this._loadNextPage()}loadPreviousPage(){return this.pageIndex==null||this.pageIndex===1?this._loadFirstPage():this._loadPreviousPage()}loadCurrentPage(){return this.pageIndex==null||this.pageIndex===0?this._loadFirstPage():this._loadCurrentPage()}}function Nm(a){return La(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=null,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function Im(a){return La(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,Promise.resolve(a.cacheItems)})}function Om(a){return La(a.nextQuery,a.itemCount,0,a.currPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=a.currPageEndDocRef,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function Jm(a){let b=(a.pageIndex+1)*a.itemCount;return La(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function Pm(a){return La(a.prevQuery,a.itemCount+1,0,a.currPageStartDocRef,"startAfter").then(function(b){let c=b.length-1;return a.cacheItems=b,a.cacheItems.pop(),a.cacheItems.reverse(),a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-c+1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=b[c].ref,a.currPageStartDocRef=b[c-1].ref,a.currPageEndDocRef=b[0].ref,Promise.resolve(a.cacheItems)})}function Km(a){let b=(a.pageIndex-1)*a.itemCount;return La(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-d+1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function Mm(a){return La(a.nextQuery,a.itemCount,0,a.prevPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function Lm(a){let b=a.pageIndex*a.itemCount;return La(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}class Zh extends af{_loadFirstPage(){return Im(this)}_loadNextPage(){return Jm(this)}_loadPreviousPage(){return Km(this)}_loadCurrentPage(){return Lm(this)}}const Nda=Ha(Ma());class $e extends af{_loadFirstPage(){return Nm(this)}_loadNextPage(){return Om(this)}_loadPreviousPage(){return Pm(this)}_loadCurrentPage(){return Mm(this)}}const Gea=Ha(Ma());function Am(a,b){let c={senderID:a.userID,message:b,timestamp:Gea.firestore.FieldValue.serverTimestamp()};return a.userName!==void 0&&(c.senderName=a.userName),a.receiverID!==void 0&&(c.receiverID=a.receiverID),a.rootRef.add(c)}function _h(a,b=a.receiverID){let c=a.rootRef;return c=b!==void 0?c.where("receiverID","==",b):c,c}function zm(a,b=a.receiverID){let c=_h(a,b),d=c.orderBy("timestamp"),e=c.orderBy("timestamp","desc");return{next:d,previous:e}}const $h="receive";function Bm(a){let b=_h(a).orderBy("timestamp","desc").limit(1);a.unsubscribe=b.onSnapshot({includeMetadataChanges:!0},function(c){if(c.size>0){let d=c.docs[0];if(d.metadata.hasPendingWrites){a.skipFirst&&(a.skipFirst=!1);return}Fm(a,a.receiverID,d);if(a.skipFirst)a.skipFirst=!1;else{let e=Gm(d);a.cacheMessages.push(e),a.emit($h,e)}}else a.skipFirst&&(a.skipFirst=!1)},function(c){debugger})}function Cm(a){a.unsubscribe&&a.unsubscribe(),a.resetQueryFlag=!0,a.cacheMessages.length=0}function Dm(a){return Fm(a),a.page.loadNextPage().then(function(b){let c=[];for(let d=0,e=b.length;d<e;d++)c.push(Gm(b[d]));return a.cacheMessages.splice(0,0,...c),Promise.resolve(c)})}function Fm(a,b=a.receiverID,c){if(!a.resetQueryFlag)return;a.resetQueryFlag=!1;let d=a.skipFirst?"startAt":"startAfter";a.page.setBaselineDoc(c,d).setQuery(zm(a,b));return}function Gm(a){let b=a.data();return b.timestamp=b.timestamp.toDate(),b}const xea=Ha(Ma());class Em extends ua{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d="",receiverID:e,pageItemCount:f=100}={}){super();this.setEventEmitter(a),this.database=xea.firestore(),this.setRootPath(b),this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.skipFirst=!0,this.unsubscribe=void 0,this.page=new $e(),this.setPageItemCount(f),this.resetQueryFlag=!0,this.cacheMessages=[]}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.resetQueryFlag=this.resetQueryFlag||this.rootPath!==a,this.rootPath=a,this.rootRef=this.database.collection(a),this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.resetQueryFlag=this.resetQueryFlag||this.receiverID!==a,this.receiverID=a,this}setPageItemCount(a){return this.page.setItemCount(a),this}get hasPreviousMessage(){return this.page.isFullPage!==!1}send(a){return Am(this,a)}startReceiving(){return Bm(this),this}stopReceiving(){return Cm(this),this}loadPreviousMessages(){return Dm(this)}}const ch="join";const dh="leave";const fh="init";const eh="update";const bh="changename";const ah="change";const vl={join:ch,leave:dh,update:eh,change:ah,init:fh,changename:bh};var ub;(function(a){a[a.once=0]="once",a[a.child=1]="child",a[a.all=2]="all"})(ub||(ub={}));const Ph="add";const Rh="remove";const Qh="change";const Sh="update";const nm={add:Ph,remove:Rh,update:Sh,change:Qh};function Ze(a){a.items.length=0,a.itemID2Index.clear()}function om(a){return a.items}function pm(a,b){return a.itemID2Index.has(b)}function Oh(a,b){return b==null?null:a.itemID2Index.get(b)}function qm(a,b){if(b==null)return null;let c=Oh(a,b);return c==null?null:a.items[c]}function rm(a,b,c){a.items.forEach(b,c)}function Mb(a){a.itemID2Index.clear();let b=a.items;for(var c=0,d=b.length;c<d;c++){let e=b[c][a.keyItemID];a.itemID2Index.set(e,c)}}function sm(a,b){if(b>=a.length)return;let c=a.length-1,d=a[b];for(let e=b;e<c;e++)a[e]=a[e+1];return a.length=c,d}function Th(a,b){let c=Vh.call(this,a,b);Mb(this),this.emit(this.eventNames.add,c),this.emit(this.eventNames.update,this.items)}function nd(a,b){let c=tm.call(this,a);Mb(this);let d=Vh.call(this,a,b);Mb(this),this.emit(this.eventNames.change,d,c),this.emit(this.eventNames.update,this.items)}function Uh(a){let b=tm.call(this,a);Mb(this),this.emit(this.eventNames.remove,b),this.emit(this.eventNames.update,this.items)}function od(a){Ze(this),a.forEach(function(b){Vh.call(this,b,null,!0)}.bind(this)),Mb(this),this.emit(this.eventNames.update,this.items)}function Vh(a,b,c=!1){let d,e=this.getItemCallback,f=this.getItemCallbackScope;f?d=e.call(f,a):d=e(a);if(c)return this.items.push(d),d;if(b==null)this.items.unshift(d);else{let g=this.itemID2Index.get(b);g===this.items.length-1?this.items.push(d):this.items.splice(g+1,0,d)}return d}function tm(a){let b=this.itemID2Index.get(a.key),c=sm(this.items,b);return c}const wm={start(a,b){a.isUpdating=!1,b.once("value",od,a)},stop(a){}};const vm={start(a,b){b.on("child_added",Th,a),b.on("child_removed",Uh,a),b.on("child_moved",nd,a),b.on("child_changed",nd,a)},stop(a){a.query.off("child_added",Th,a),a.query.off("child_removed",Uh,a),a.query.off("child_moved",nd,a),a.query.off("child_changed",nd,a)}};const um={start(a,b){b.on("value",od,a)},stop(a){a.query.off("value",od,a)}};const md={};md[ub.all]=um;md[ub.child]=vm;md[ub.once]=wm;class gc extends ua{constructor({eventEmitter:a,itemIDKey:b="__itemID__",mode:c=ub.child,getItemCallback:d=jq,getItemCallbackScope:e,query:f,eventNames:g=nm}={}){super();this.setEventEmitter(a),this.eventNames=g,this.isUpdating=!1,this.items=[],this.itemID2Index=new Map(),this.setItemIDKey(b),this.setMode(c),e===void 0&&(e=this),this.setGetitemCallback(d,e),this.setQuery(f)}destroy(){this.stopUpdate().clear()}setItemIDKey(a){return this.keyItemID=a,this}setMode(a){return typeof a==="string"&&(a=ub[a]),this.mode=a,this.updater=md[a],this}setGetitemCallback(a,b){return this.getItemCallback=a,this.getItemCallbackScope=b,this}setQuery(a){return this.query=a,this}startUpdate(a){if(a)this.setQuery(a);else if(this.query)a=this.query;else return this;return this.stopUpdate().clear(),this.isUpdating=!0,this.updater.start(this,a),this}stopUpdate(){return!this.query||!this.isUpdating?this:(this.isUpdating=!1,this.updater.stop(this),this)}clear(){return Ze(this),this}getItems(){return om(this)}hasItem(a){return pm(this,a)}getItemIndexFromItemID(a){return Oh(this,a)}getItemFromItemID(a){return qm(this,a)}forEach(a,b){return rm(this,a,b),this}updateItemID2Index(){return Mb(this),this}}const jq=function(a){let b=a.val();return b[this.keyItemID]=a.key,b};function Ib(a,b=a.userID){return a.userID2ItemID.has(b)}function Le(a,b=a.userID){if(!Ib(a,b))return null;let c=a.userID2ItemID.get(b);return a.rootRef.child(c)}function wl(a,b=a.userID){if(!Ib(a,b))return null;let c=a.userID2ItemID.get(b);return a.userList.getItemFromItemID(c)}function $g(a){return a.userList.getItems()}function xl(a){a.userList.clear()}function yl(a,b,c){a.userList.forEach(b,c)}function zl(a,b=a.userID){let c=a.userList.getItems()[0];return c&&c.userID===b}function Al(a){return a.maxUsers===0?!1:a.userList.getItems().length>=a.maxUsers}function sl(a=0,b){return new Promise(function(c,d){setTimeout(function(){c(b)},a)})}function tl(a,b=a.userID,c=a.userName){if(Ib(a,b))return Promise.resolve();let d={userID:b,userName:c},e=a.maxUsers,f=a.database.ref(a.rootPath),g=f.push();return g.onDisconnect().remove().then(function(){return g.set(d)}).then(function(){return sl(0)}).then(function(){return e===0?(a.isInList=!0,Promise.resolve()):f.limitToFirst(e).once("value").then(function(j){return Zp(j,b)?(a.isInList=!0,Promise.resolve()):(a.isInList=!1,g.remove().then(function(){return g.onDisconnect().cancel()}).then(function(){return Promise.reject()}))})})}function Zp(a,b){let c=!1;return a.forEach(function(d){let e=d.val();if(e.userID===b)return c=!0,!0}),c}function ul(a,b=a.userID){if(!Ib(a,b))return Promise.resolve();let c=a.userID2ItemID.get(b),d=a.database.ref(a.rootPath).child(c);return d.remove()}function rl(a,b){return new Promise(function(c,d){let e=Le(a);if(e)return c(e);{let f=a.rootRef.orderByChild("userID").equalTo(a.userID);f.once("child_added").then(function(g){return c(g.ref)})}}).then(function(c){return c.child("userName").set(b)}).then(function(){return a.userName=b,Promise.resolve()})}const P6=Ha(Ma());class Jc extends ua{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,eventNames:f=vl}={}){super();this.setEventEmitter(a),this.eventNames=f,this.database=P6.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.setMaxUsers(e),this.userList=new gc({eventEmitter:this.eventEmitter,itemIDKey:"joinAt",eventNames:{add:f.join,remove:f.leave,update:f.update,change:f.change}}),this.isInList=!1,this.userID2ItemID=new Map(),this.userList.on(this.eventNames.join,function(g){this.userID2ItemID.set(g.userID,g.joinAt),g.userID===this.userInfo.userID&&this.emit(this.eventNames.init,$g(this))},this).on(this.eventNames.leave,function(g){this.userID2ItemID.delete(g.userID),g.userID===this.userID&&(this.isInList=!1)},this).on(this.eventNames.change,function(g,j){let i=g.userID,k=g.userName,n=j.userName;k!==n&&this.emit(this.eventNames.changename,i,k,n)},this)}destroy(){this.stopUpdate().destroyEventEmitter().leave(),this.userList.destroy()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setMaxUsers(a){return this.maxUsers=a,this}clear(){return xl(this),this}forEach(a,b){return yl(this,a,b),this}isFull(){return Al(this)}isFirstUser(a=this.userID){return zl(this,a)}getUser(a=this.userID){return wl(this,a)}getUsers(){return $g(this)}getUserRef(a=this.userID){return Le(this,a)}contains(a=this.userID){return Ib(this,a)}join(a=this.userID,b=this.userName){return tl(this,a,b)}leave(a=this.userID){return ul(this,a)}changeUserName(a){return rl(this,a)}startUpdate(){let a=this.rootRef;return this.maxUsers>0&&(a=a.limitToFirst(this.maxUsers)),this.userList.startUpdate(a),this}stopUpdate(){return this.userList.stopUpdate(),this}}const hc="room.join";const Kb="room.leave";const vh="userlist.join";const wh="userlist.leave";const yh="userlist.init";const xh="userlist.update";const jd="userlist.changename";const gh="broadcast.receive";function kh(a){return`tables.${a}.init`}function lh(a){return`tables.${a}.update`}function mh(a){return`tables.${a}.addkey0`}function nh(a){return`tables.${a}.addkey1`}function oh(a){return`tables.${a}.addkey2`}function ph(a){return`tables.${a}.removekey0`}function qh(a){return`tables.${a}.removekey1`}function rh(a){return`tables.${a}.removekey2`}function sh(a){return`tables.${a}.changekey0`}function th(a){return`tables.${a}.changekey1`}function uh(a){return`tables.${a}.changekey2`}const hh="roomlist.add";const ih="roomlist.remove";const jh="roomlist.update";function Nl(a){const b=new Jc({eventEmitter:a.eventEmitter,eventNames:{join:vh,leave:wh,update:xh,change:"userlist.change",init:yh,changename:jd},userID:a.userInfo});return b.on("userlist.leave",function(c){c.userID===a.userID&&cq(a)}),a.on(hc,function(){b.startUpdate()}).on(Kb,function(){b.stopUpdate().clear()}),b}function cq(a){a.emit(Kb),setTimeout(function(){a.roomID=void 0,a.roomName=void 0,a.doorState=void 0,a.leftRoomFlag=!1},0)}function Kl(a){const b=new gc({eventEmitter:a.eventEmitter,itemIDKey:"roomID",eventNames:{update:jh,add:hh,remove:ih,change:"roomlist.change"},mode:"once"});return b}function Ul(a){return a.split("|")[0]}function Tl(a){return a.split("|")[1]}function Kc(a,b=""){return`${a}|${b}`}function gb(a,b){let c=a.rootRef;return b&&(c=c.child(b)),c}function kd(a,b,c){let d=gb(a,"rooms");return b!==void 0&&(d=d.child(b),c!==void 0&&(d=d.child(c))),d}function Jl(a,b){return kd(a,b,"alive")}function Ol(a,b){return kd(a,b,"users")}function id(a,b){let c=gb(a,"room-filters");return b!==void 0&&(c=c.child(b)),c}function Lc(a,b){let c=gb(a,"room-metadata");return b!==void 0&&(c=c.child(b)),c}function Ne(a,b,c){let d=`${a.rootPath}/rooms/${b}`;return c&&(d+=`/${c}`),d}function Qe(a,b){return Ne(a,b,"users")}function Ll(a,b,c){let d=Ne(a,b,"tables");return c&&(d+=`/${c}`),d}function Pl(a,b,c="open"){let d=id(a);return d=d.orderByChild("filter"),b===void 0?d=d.startAt(c).endAt(`${c}~`):d=d.equalTo(Kc(c,b)),d}function Gl(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new Hc({eventEmitter:a.eventEmitter,eventNames:{receive:gh},receiverID:"boradcast",senderID:a.userInfo,history:b.history});return a.on(hc,function(d){c.setRootPath(Ne(a,d.roomID)).startReceiving()}).on(Kb,function(){c.stopReceiving()}).on(jd,function(d,e){c.changeUserName(d,e)}),c}function Ml(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,bq(a,d))}),a.on(hc,function(d){for(const[e,f]of c)f.setRootPath(Ll(a,d.roomID,e)).startUpdate()}).on(Kb,function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function bq(a,{key:b,type:c=ra["1d"]}){const d=new Ic({eventEmitter:a.eventEmitter,type:c,eventNames:{init:kh(b),update:lh(b),addkey0:mh(b),removekey0:ph(b),changekey0:sh(b),addkey1:nh(b),removekey1:qh(b),changekey1:th(b),addkey2:oh(b),removekey2:rh(b),changekey2:uh(b)}});return d}function Ra(a,b=a.roomID,c=a.roomName){return{roomID:b,roomName:c}}function Ue(a,b){return b===void 0?a.roomID!==void 0:a.roomID===b}function Xl(a){return a.userList.isFull()}function Yl(a,b=a.userID){return a.userList.isFirstUser(b)}function Zl(a){return a.userList.getUsers()}function Re(a,b,c,d){a.roomID=b,a.roomName=c,a.roomType=d,a.emit("room.join",Ra(a))}function Pe(a,b={}){return b.roomID==null&&(b.roomID=kd(a).push().key),$p(a,b.roomID).then(function(){return aq(a,b)})}function $p(a,b){return Jl(a,b).transaction(function(c){return c===null?!0:void 0})}function aq(a,{roomID:b,roomName:c="",roomType:d="",maxUsers:e=0,presisted:f=!1,door:g="open",join:j=!0,filterData:i}){let k=kd(a,b),n=id(a,b),o=Lc(a,b);a.isRemoveRoomWhenLeft=!f,a.isRemoveRoomWhenLeft&&(k.onDisconnect().remove(),n.onDisconnect().remove(),o.onDisconnect().remove());const s=Kc(g,d),u={},w={filter:s,name:c};i&&(w.data=i),u[`room-filters/${b}`]=w;const z={name:c,filter:s,maxUsers:e,moderators:{}};return z.moderators[a.userID]=a.userName,u[`room-metadata/${b}`]=z,new Promise(function(G,K){if(j){const I=a.userList.setRootPath(Qe(a,b)).setMaxUsers(0).join();return a.userList.setMaxUsers(e),I.then(G,K)}else return G()}).then(function(){return gb(a).update(u)}).then(function(){return a.isRoomCreator=!0,j&&Re(a,b,c,d),Promise.resolve(Ra(a))})}function Hl(a,{digits:b=10,candidates:c="0123456789",retry:d=1e3}){let e=arguments[1];return Il(a,b,c,d,e)}function Il(a,b,c,d,e){return e.roomID=Oe(b,b,c),d<=0?Promise.reject(e):(d--,Pe(a,e).catch(function(){return Il(a,b,c,d,e)}))}function Ve(a,b=a.roomID){const c={};c[`room-filter/${b}`]=null,c[`room-metadata/${b}`]=null,c[`rooms/${b}`]=null;const d=Ra(a);return gb(a).update(c).then(function(){return Promise.resolve(d)})}function Mc(a){if(!Ue(a))return Promise.resolve(Ra(a));a.leftRoomFlag=!0;if(a.isRemoveRoomWhenLeft)return Ve(a);{const b=Ra(a);return a.userList.leave().then(function(){return Promise.resolve(b)})}}function Te(a,{leftThenJoin:b=!0,roomID:c}){return b?Mc(a).then(function(){return Vl(a,c)}):Vl(a,c)}function Vl(a,b){return b==null?Promise.reject(Ra(a,b,"")):(a.isRemoveRoomWhenLeft=!1,dq(a,b).then(function(c){return a.userList.setRootPath(Qe(a,b)).setMaxUsers(c.maxUsers).join().then(function(){return Promise.resolve(c)})}).then(function(c){return Re(a,b,c.name,Tl(c.filter)),Promise.resolve(Ra(a))}))}function dq(a,b){return Lc(a,b).once("value").then(function(c){let d=c.val();return eq(a,d)?Promise.resolve(d):Promise.reject()})}function eq(a,b){if(b==null)return!1;if(Ul(b.filter)==="closed")return!1;const c=a.userID;if(b.moderators[c])return!0;switch(b.permission){case"blocklist":const d=b.blocklist;return!(d&&d[c]);case"allowlist":const e=b.allowlist;return e&&e[c];default:return!0}}function Se(a,b,c){return new Promise(function(d,e){a.roomList.once("roomlist.update",function(f){d(f)}).startUpdate(Pl(a,b,c))})}function Rl(a,{roomType:b="",leftThenJoin:c=!0}={}){return Se(a,b,"open").then(function(d){if(d.length===0)return Promise.reject("No filtered room");ec(d);const e={leftThenJoin:c,roomID:""};return Sl(a,e,d)})}function Sl(a,b,c,d=0){return d===c.length?Promise.reject("Can't join any room"):(b.roomID=c[d].roomID,d++,Te(a,b).catch(function(){return Sl(a,b,c,d)}))}function Wl(a,b){return a.userList.contains(b)?b===a.userID?Mc(a):a.userList.leave(b):Promise.resolve()}function Jb(a,b){return b===a.roomID?Promise.resolve(!0):Lc(a,b).once("value").then(function(c){const d=c.val()!==null;return Promise.resolve(d)})}function Me(a,b,c=a.roomID){return Jb(a,c).then(function(d){if(!d)return Promise.resolve();const e=Kc(b,a.roomType),f={};return f[`room-filters/${c}/filter`]=e,f[`room-metadata/${c}/filter`]=e,gb(a).update(f)})}function Dl(a,b=a.roomID){return Me(a,"open",b)}function El(a,b=a.roomID){return Me(a,"closed",b)}function Bl(a,b,c=a.roomID){return Jb(a,c).then(function(d){return d?id(a,c).child("data").update(b):Promise.resolve()})}function Fl(a,b){return a.userList.changeUserName(b)}function Cl(a,b,c=a.roomID){return Jb(a,c).then(function(d){if(!d)return Promise.resolve();const e={};return e[`room-filters/${c}/name`]=b,e[`room-metadata/${c}/name`]=b,gb(a).update(e)})}function Ql(a,b=a.roomID){return b===a.roomID?a.userList.getUsers():new Promise(function(c,d){const e=new gc({itemIDKey:"joinAt",mode:"once"});e.once("update",function(f){c(f)}).startUpdate(Ol(a,b))})}const A8=Ha(Ma());class _l extends ua{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",broadcast:e=!0,tables:f=!1}={}){super();this.setEventEmitter(a),this.database=A8.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.isRoomCreator=!1,this.roomID=void 0,this.roomName=void 0,this.roomType=void 0,this.doorState=void 0,this.leftRoomFlag=!1,this.isRemoveRoomWhenLeft=void 0,this.userList=Nl(this),this.roomList=Kl(this),this.broadcast=Gl(this,e),this.tables=Ml(this,f)}destroy(){var a=this;this.destroyEventEmitter().leaveRoom().then(function(){a.userList.destroy(),a.userList=void 0,a.roomList.destroy(),a.roomList=void 0,a.broadcast.destroy(),a.broadcast=void 0})}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}getRoomInfo(a,b){return Ra(this,a,b)}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(a){return Ue(this,a)}isFull(){return Xl(this)}isFirstUser(a=this.userID){return Yl(this,a)}getUsers(){return Zl(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}createRoom(a){return Pe(this,a)}createRandomRoom(a={}){return Hl(this,a)}joinRoom(a){return Te(this,a)}joinRandomRoom(a={}){return Rl(this,a)}leaveRoom(){return Mc(this)}removeRoom(a=this.roomID){return Ve(this,a)}kickUser(a){return Wl(this,a)}changeRoomState(a,b=this.roomID){return Me(this,a,b)}openRoom(a=this.roomID){return Dl(this,a)}closeRoom(a=this.roomID){return El(this,a)}changeUserName(a){return Fl(this,a)}changeFilterData(a,b=this.roomID){return Bl(this,a,b)}changeRoomName(a,b,c=a.roomID){return Cl(this,b,c)}getUserList(a=this.roomID){return Ql(this,a)}getRoomList(a,b){return Se(this,a,b)}HasRoom(a){return Jb(this,a)}}function fm(a,b){let c=a.rootPath;return b&&(c+=`/${b}`),c}function dm(a){return fm(a,"users")}function bm(a,b){return`${fm(a,"tables")}/${b}`}const tb="room.join";const Lb="room.leave";const Lh="userlist.join";const We="userlist.leave";const Nh="userlist.init";const Mh="userlist.update";const ld="userlist.changename";const zh="broadcast.receive";function Ah(a){return`tables.${a}.init`}function Bh(a){return`tables.${a}.update`}function Ch(a){return`tables.${a}.addkey0`}function Dh(a){return`tables.${a}.addkey1`}function Eh(a){return`tables.${a}.addkey2`}function Fh(a){return`tables.${a}.removekey0`}function Gh(a){return`tables.${a}.removekey1`}function Hh(a){return`tables.${a}.removekey2`}function Ih(a){return`tables.${a}.changekey0`}function Jh(a){return`tables.${a}.changekey1`}function Kh(a){return`tables.${a}.changekey2`}function em(a,b=0){const c=new Jc({eventEmitter:a.eventEmitter,eventNames:{join:Lh,leave:We,update:Mh,change:"userlist.change",init:Nh,changename:ld},root:dm(a),userID:a.userInfo,maxUsers:b});return c.on(We,function(d){d.userID===a.userID&&hq(a)}),a.on(tb,function(){c.startUpdate()}).on(Lb,function(){c.stopUpdate().clear()}),c}function hq(a){a.emit(Lb),setTimeout(function(){a.leftRoomFlag=!1},0)}function am(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new Hc({eventEmitter:a.eventEmitter,eventNames:{receive:zh},receiverID:"broadcast",senderID:a.userInfo,history:b.history});return a.on(tb,function(){c.setRootPath(a.rootPath).startReceiving()}).on(Lb,function(){c.stopReceiving()}).on(ld,function(d,e){c.changeUserName(d,e)}),c}function cm(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,gq(a,d))}),a.on(tb,function(){for(const[d,e]of c)e.setRootPath(bm(a,d)).startUpdate()}).on(Lb,function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function gq(a,{key:b,type:c=ra["1d"]}){const d=new Ic({eventEmitter:a.eventEmitter,type:c,eventNames:{init:Ah(b),update:Bh(b),addkey0:Ch(b),removekey0:Fh(b),changekey0:Ih(b),addkey1:Dh(b),removekey1:Gh(b),changekey1:Jh(b),addkey2:Eh(b),removekey2:Hh(b),changekey2:Kh(b)}});return d}function Ye(a){return a.userList.isInList}function jm(a){return a.userList.isFull()}function km(a,b=a.userID){return a.userList.isFirstUser(b)}function lm(a){return a.userList.getUsers()}function hm(a){return a.userList.join().then(function(){return a.emit(tb),Promise.resolve()})}function Xe(a){return Ye(a)?(a.leftRoomFlag=!0,a.userList.leave()):Promise.resolve()}function gm(a){return a.userList.getUsers()}function im(a,b){return a.userList.contains(b)?b===a.userID?Xe(a):a.userList.leave(b):Promise.resolve()}function $l(a,b){return a.userList.changeUserName(b)}const maa=Ha(Ma());class mm extends ua{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,broadcast:f=!0,tables:g=!1}={}){const j=arguments[0];super();this.setEventEmitter(a),this.database=maa.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.leftRoomFlag=!1,this.userList=em(this,e),this.broadcast=am(this,f),this.tables=cm(this,g)}shutdown(){}destroy(){this.shutdown()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(){return Ye(this)}isFull(){return jm(this)}isFirstUser(a=this.userID){return km(this,a)}getUsers(){return lm(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}joinRoom(){return hm(this)}leaveRoom(){return Xe(this)}getUserList(){return gm(this)}kickUser(a){return im(this,a)}changeUserName(a){return $l(this,a)}}const Gi="statechange";function Hi(a){return`exit_${a.toString()}`}function Ii(a){return`enter_${a.toString()}`}class Tn extends ua{constructor({eventEmitter:a}={}){super();this._states=new Map();this.enable=!0;this.setEventEmitter(a)}destroy(){this.destroyEventEmitter()}toJSON(){return{curState:this.state,prevState:this.prevState,enable:this.enable,start:this._start}}setEnable(a=!0){return this.enable=a,this}getState(a){return this._states.get(a)}addState(a){return this._states.set(a.name,a),this}addStates(a){for(let b=0,c=a.length;b<c;b++)this.addState(a[b]);return this}removeState(a){return this._states.delete(a),this}removeAllStates(){return this._states.clear(),this}set state(a){if(!this.enable||this._stateLock)return;if(this._state===a)return;this._prevState=this._state,this._state=a,this._stateLock=!0,this.emit(Gi,this);if(this._prevState!=null){const b=this.getState(this._prevState);b&&b.exit&&b.exit(this),this.emit(Hi(this._prevState),this)}this._stateLock=!1;if(this._state!=null){const b=this.getState(this._state);b&&b.enter&&b.enter(this),this.emit(Ii(this._state),this)}}get state(){return this._state}get prevState(){return this._prevState}get stateList(){return Array.from(this._states.keys())}start(a){return this._start=a,this._prevState=void 0,this._state=a,this}goto(a){return a!=null&&(this.state=a),this}next(){const a=this.getState(this.state);if(!a||!a.next)return this;let b;return typeof a.next==="string"?b=a.next:b=a.next(this),this.goto(b),this}update(a,b,c="update"){const d=this.getState(this.state);d&&d[c]&&d[c](this,a,b)}preupdate(a,b){this.update(b,a,"preupdate")}postupdate(a,b){this.update(b,a,"postupdate")}}var Ji;(function(a){a[a.shuffle=0]="shuffle",a[a.random=1]="random"})(Ji||(Ji={}));const Mi="die";class Un extends uf{constructor(a,{lifeTime:b=1e3,destroy:c=!0}={}){super(a,arguments[1]);this.setLifeTime(b),this.setDestroyMode(c)}resetFromJSON({lifeTime:a=1e3,destroy:b=!0}={}){return super.resetFromJSON(arguments[0]),this.setLifeTime(a),this.setDestroyMode(b),this}toJSON(){const a=super.toJSON();return a.lifeTime=this.lifeTime,a.destroy=this.destroyMode,a}setLifeTime(a){return this.lifeTime=a,this}addToLifeTime(a){return this.lifeTime+=a,this}setDestroyMode(a=!0){return this.destroyMode=a,this}get isAlive(){return this.now<this.lifeTime}get remainder(){let a=this.lifeTime-this.now;return a<0&&(a=0),a}update(a){return this.isRunning?(super.update(a),this.isAlive||(this.complete(Mi),this.destroyMode&&this.gameObject.destroy&&this.gameObject.destroy()),this):this}get gameObject(){return this.parent}}class vf{constructor(a,b,c,d,e){this.key=a,this.start=b,this.end=c,this.step=d,this.items=e,this._current=b}reset(){this._current=this.start}get isEnd(){return this.step>=0?this._current>=this.end:this._current<=this.end}get length(){return this.step>=0&&this.start>this.end||this.step<0&&this.start<this.end?0:Math.floor(this.end-this.start)+1}next(){return this.isEnd?this._current=this.start:this._current+=this.step,this}get current(){return this.items?this.items[this._current]:this._current}}class Wn{constructor(){this.indexes=[];this.length=0;this.firstPass=!0;this.currentCount=0}reset(){for(let a=0,b=this.indexes.length;a<b;a++)this.indexes[a].reset();return this.firstPass=!0,this.currentCount=0,this}addNumberLoop(a,b,c,d=c>=b?1:-1){return this.indexes.push(new vf(a,b,c,d)),this.length=this._getLength(),this}addItemsLoop(a,b,c=!1){const d=b.length-1,e=c?d:0,f=c?0:d,g=c?-1:1;return this.indexes.push(new vf(a,e,f,g,b)),this.length=this._getLength(),this}addLoop({key:a,start:b,end:c,step:d,items:e}){return this.indexes.push(new vf(a,b,c,d,e)),this.length=this._getLength(),this}removeLoops(){return this.indexes.length=0,this.length=0,this}_getLength(){let a=this.indexes[0]?.length;for(let b=1,c=this.indexes.length;b<c;b++)a*=this.indexes[b].length;return a??0}get progress(){return this.currentCount/this.length}get isEnd(){for(let a=this.indexes.length-1;a>=0;a--)if(!this.indexes[a].isEnd)return!1;return!0}next(){for(let a=this.indexes.length-1;a>=0;a--){const b=this.indexes[a],c=b.isEnd;b.next();if(!c)break}return this}getCurrent(a={}){for(let b=this.indexes.length-1;b>=0;b--){const c=this.indexes[b];a[c.key]=c.current}return a}getNext(a={}){return this.firstPass?this.firstPass=!1:this.next(),this.getCurrent(a),this.currentCount++,a}}const Ci="tickstart";const Di="tickend";const br=1e3/60;class Vn extends wf{constructor(a,{callback:b,scope:c,deltaPercentage:d=1}={}){super(a,arguments[1]);this.deltaPercentage=1;this.loopIndexGenerator=new Wn();this.currentIndexes={};this.scene=a,this.setCallback(b,c),this.setDeltaPercentage(d),this.boot()}boot(){super.boot(),Rb(this.scene,"shutdown",this.destroy,this)}shutdown(){super.shutdown(),this.scene=void 0}destroy(){this.shutdown()}startTicking(){super.startTicking(),Xa(this.scene,"update",this.preupdate,this)}stopTicking(){super.stopTicking(),this.scene&&nb(this.scene,"update",this.preupdate,this)}setCallback(a,b){return this.callback=a,this.scope=b,this}setDeltaPercentage(a){return this.deltaPercentage=a,this}addNumberLoop(a,b,c,d){return this.loopIndexGenerator.addNumberLoop(a,b,c,d),this}addItemsLoop(a,b,c=!1){return this.loopIndexGenerator.addItemsLoop(a,b,c),this}addLoop(a){return this.loopIndexGenerator.addLoop(a),this}get curTime(){return new Date().getTime()}get progress(){return this.loopIndexGenerator.progress}preupdate(){if(!this.callback)return;const a=this.curTime,b=br*this.deltaPercentage;let c;this.emit(Ci);do{if(this.loopIndexGenerator.isEnd){this.complete();return}this.currentIndexes=this.loopIndexGenerator.getNext(this.currentIndexes),this.scope?this.callback.call(this.scope,this.currentIndexes,this):this.callback(this.currentIndexes,this),c=this.curTime-a>=b}while(!c);this.emit(Di)}}const Mpa=Ha(so());var Ki;(function(a){a[a.none=0]="none",a[a.base64=1]="base64",a[a.utf16=2]="utf16",a[a.uri=3]="uri"})(Ki||(Ki={}));var Nb;(function(a){a[a.circle=0]="circle",a[a.ellipse=1]="ellipse",a[a.roundRectangle=2]="roundRectangle"})(Nb||(Nb={}));class Tm extends ic{constructor(a,b,c,d,e=Nb.circle){super(a,b);this.type="rexMaskedImage",this.maskImage(c,d,e)}maskImage(a,b,c=Nb.circle){let d,e,f;typeof c==="object"?{maskType:d,backgroundStyle:e,radius:f}=c:d=c,typeof d==="string"&&(d=Nb[d]);const g=this.canvas,j=this.context,i=Ea.get();if(!i.has(a))return;const k=i.get(a).getFrame(b),n=k.width,o=k.height;g.width!==n&&(g.width=n),g.height!==o&&(g.height=o),j.clearRect(0,0,n,o),e&&(j.fillStyle=e,j.fillRect(0,0,n,o)),j.beginPath();switch(d){case Nb.roundRectangle:ef(j,0,0,n,o,f);break;default:const s=Math.floor(n/2),u=Math.floor(o/2);d===Nb.circle?j.arc(s,u,Math.min(s,u),0,2*Math.PI):j.ellipse(s,u,s,u,0,0,2*Math.PI);break}j.clip(),j.drawImage(k.texture.image,k.x,k.y,k.width,k.height),this.texture.setSize(n,o),this.setSize(n,o),this.updateTexture()}}let lr=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i;function Gc(a){let b;return a===""?b=null:lr.test(a)?b=parseFloat(a):a==="false"?b=!1:a==="true"?b=!0:b=a,b}const lla=Ha(pg());function Xn(a,{delimiter:b=",",convert:c=!0,types:d={}}={}){const e=lla.default.parse(a,{header:!0,delimiter:b}).data,f=d.question??"q",g=d.option??"",j=c===!0?Gc:c,i=[];let k,n;for(let o=0,s=e.length;o<s;o++){let u=e[o],w=u.type;delete u.type,w===f?(k=u,k.key===""&&delete k.key,Zn(k,j),k.options=[],i.push(k)):w===g&&(k&&(n=u,n.key===""&&delete n.key,Zn(n,j),k.options.push(n)))}return i}function Zn(a,b){const c=a;if(!b)return c;for(const d in a)c[d]=b(a[d],d);return c}function Fi(a,b,c){typeof b==="string"&&(b=Xn(b,c));if(Array.isArray(b))for(let d=0,e=b.length;d<e;d++)Yn(a,b[d]);else Yn(a,b)}function Yn(a,b){const c=b.options;if(c)for(let d=0,e=c.length;d<e;d++){let f=c[d];f.hasOwnProperty("key")||(f.key=`_${d}`)}b.hasOwnProperty("key")||(b.key=`_${a.questions.size}`),a.questions.set(b.key,b)}class Ei{constructor({questions:a}={}){this.questions=new Map();a&&Fi(this,a,arguments[0])}add(a,b){return Fi(this,a,b),this}remove(a){return this.questions.delete(a),this}removeAll(){return this.questions.clear(),this}has(a){return this.questions.has(a)}get(a){return this.questions.get(a)}getKeys(a=[]){const b=this.questions.keys();for(const c of b)a.push(c);return a}getOption(a,b){typeof a==="string"&&(a=this.get(a));if(!a)return null;const c=a.options;if(c)for(let d=0,e=c.length;d<e;d++){let f=c[d];if(f.key===b)return f}return null}}const xf="quest";class cr extends ua{constructor(a,{eventEmitter:b,shuffleQuestions:c=!1,shuffleOptions:d=!1}={}){super();this.questionKeys=[];this.setEventEmitter(b),He(a)&&(a=new Ei(a)),this.questionsManager=a,this.setShuffleQuestionsEnable(c),this.setShuffleOptionsEnable(d),this.init()}setShuffleQuestionsEnable(a=!0){return this.shuffleQuestionsEnable=a,this}setShuffleOptionsEnable(a=!0){return this.shuffleOptionsEnable=a,this}init(){return this.questionKeys.length=0,this.questionsManager.getKeys(this.questionKeys),this.shuffleQuestionsEnable&&ec(this.questionKeys),this.nextIndex=-1,this.nextKey=void 0,this}setNextKey(a){return a===void 0?(this.nextIndex++,this.nextKey=this.questionKeys[this.nextIndex]):this.questionsManager.has(a)&&(this.nextKey=a,this.nextIndex=this.questionKeys.indexOf(a)),this}setPrevKey(){return this.nextIndex--,this.nextKey=this.questionKeys[this.nextIndex],this}getQuestion(){const a=this.questionsManager.get(this.nextKey);if(a&&this.shuffleOptionsEnable){const b=a.options;b&&ec(b)}return a}getNextQuestion(a){return this.setNextKey(a).getQuestion()}getPrevQuestion(){return this.setPrevKey().getQuestion()}getOption(a,b){return b===void 0&&(b=a,a=this.getQuestion()),this.questionsManager.getOption(a,b)}next(a){const b=this.getNextQuestion(a);return b&&this.emit(xf,b,this,this.questionsManager),this}prev(){const a=this.getPrevQuestion();return a&&this.emit(xf,a,this,this.questionsManager),this}restart(a){return this.init(),this.next(a),this}get isLastQuestion(){return this.nextIndex===this.questionKeys.length-1}}function Nc(a=0,b={left:0,right:0,top:0,bottom:0}){if(typeof a==="number")b.left=a,b.right=a,b.top=a,b.bottom=a;else{let c,d,e,f;({left:c=0,right:d=0,top:e=0,bottom:f=0}=a),b.left=c,b.right=d,b.top=e,b.bottom=f}return b}function xb(a){return a.x-a.originX*a.width}function jc(a){return a.x+(.5-a.originX)*a.width}function sd(a){return a.x+a.originX*a.width}function kc(a){return a.y-a.originY*a.height}function lc(a){return a.y+(.5-a.originY)*a.height}function mc(a){return a.y+a.originY*a.height}function td(a,b){a.x+=b-xb(a)}function ud(a,b){a.x+=b-jc(a)}function vd(a,b){a.x+=b-kc(a)}function wd(a,b){a.y+=b-xb(a)}function xd(a,b){a.y+=b-lc(a)}function yd(a,b){a.y+=b-mc(a)}function Um(a,b,c,d){if(a.rexSizer.hidden||!a.needLayout)return a;a.preLayout(b,c,d),c===void 0&&(c=Math.max(a.childrenWidth,a.minWidth)),d===void 0&&(d=Math.max(a.childrenHeight,a.minHeight)),a.resize(c,d),a.layoutBackgrounds(),a.postLayout(b,c,d)}function ii(a,b,c,d){if(b)return;a.layoutInit();const e=a.getChildrenSizers();for(var f=0,g=e.length;f<g;f++){const j=e[f];if(j.rexSizer.hidden||!j.needLayout)continue;ii(j)}}function ff(a){a._childrenWidth=void 0,a._childrenHeight=void 0}function gf(a,b,c){if(!a||b===void 0&&c===void 0)return;a.resize?(b===void 0&&(b=a.width),c===void 0&&(c=a.height),a.resize(b,c)):(b!==void 0&&(a.width=b),c!==void 0&&(a.height=c))}const Oc=new pb().setOrigin(0,0);function hf(a,b,c=ab.CENTER,d=0,e=0){const f=c%3;switch(f){case 0:td(a,xb(b));break;case 1:ud(a,jc(b));break;default:vd(a,sd(b));break}const g=Math.floor(c/3);switch(g){case 0:wd(a,kc(b));break;case 1:xd(a,lc(b));break;default:yd(a,mc(b));break}a.x-=d,a.y-=e}function Vm(a){if(a.backgroundChildren===void 0)return;const b=a.left,c=a.top,d=a.width,e=a.height,f=a.backgroundChildren;for(let g=0,j=f.length;g<j;g++){const i=f[g],k=i.rexSizer;if(k.hidden)continue;const n=k.padding,o=b+n.left,s=c+n.top,u=d-n.left-n.right,w=e-n.top-n.bottom;gf(i,u,w),Oc.setPosition(o,s).setSize(u,w),hf(i,Oc)}}function Wm(a,b,c,d){}function Xm(a,b){rc(a,b)}function Ym(a){return a.hasOwnProperty("rexSizer")||(a.rexSizer={}),a.rexSizer}function Zm(a,b,{padding:c=0,childKey:d}={}){a.backgroundChildren===void 0&&(a.backgroundChildren=[]),a.pin(b),a.backgroundChildren.push(b);const e=a.getSizerState(b);e.padding=Nc(c),d!==void 0&&a.addChildrenMap(d,b)}function _m(a,b){return a.backgroundChildren===void 0?!1:a.backgroundChildren.indexOf(b)!==-1}function $m(a,b,c){a.childrenMap===void 0&&(a.childrenMap={}),a.childrenMap[b]=c}class Sa extends pb{constructor({space:a=0,name:b=""}={}){super();this.type="base";this.rexSizer={};this.needLayout=!0;this.minWidth=0;this._childrenWidth=0;this.minHeight=0;this._childrenHeight=0;this.space=Nc(a),this.name=b}get left(){return xb(this)}set left(a){td(this,a)}alignLeft(a){return this.left=a,this}get right(){return sd(this)}set right(a){vd(this,a)}alignRight(a){return this.right=a,this}get innerLeft(){return this.left+this.space.left}get innerRight(){return this.right-this.space.right}get centerX(){return jc(this)}set centerX(a){ud(this,a)}alignCenterX(a){return this.centerX=a,this}get top(){return kc(this)}set top(a){wd(this,a)}alignTop(a){return this.top=a,this}get bottom(){return mc(this)}set bottom(a){yd(this,a)}alignBottom(a){return this.bottom=a,this}get innerTop(){return this.top+this.space.top}get innerBottom(){return this.bottom-this.space.bottom}get centerY(){return lc(this)}set centerY(a){xd(this,a)}alignCenterY(a){return this.centerY=a,this}get innerWidth(){return this.width-this.space.left-this.space.right}get innerHeight(){return this.height-this.space.top-this.space.bottom}setMinSize(a,b){return this.setMinWidth(a).setMinHeight(b),this}setMinWidth(a=0){return this.minWidth=a,this}setMinHeight(a=0){return this.minHeight=a,this}getChildrenWidth(){return 0}getChildrenHeight(){return 0}get childrenWidth(){return this._childrenWidth===void 0&&(this._childrenWidth=this.getChildrenWidth()),this._childrenWidth}get childrenHeight(){return this._childrenHeight===void 0&&(this._childrenHeight=this.getChildrenHeight()),this._childrenHeight}resize(a=this.width,b=this.height){return this.setSize(a,b),this}getSizerState(a){return Ym(a)}getChildrenSizers(a=[]){return a}layout(){return this._layout(),this}_layout(a,b,c){return Um(this,a,b,c),this}preLayout(a,b,c){return ii(this,a,b,c),this}layoutInit(){return ff(this),this}layoutBackgrounds(){return Vm(this),this}postLayout(a,b,c){return Wm(this,a,b,c),this}pin(a){return Xm(this,a),this}addBackground(a,b){return Zm(this,a,b),this}isBackground(a){return _m(this,a)}addChildrenMap(a,b){return $m(this,a,b),this}}var Ta;(function(a){a[a.x=0]="x",a[a.h=0]="h",a[a.horizontal=0]="horizontal",a[a["left-to-right"]=0]="left-to-right",a[a.y=1]="y",a[a.v=1]="v",a[a.vertical=1]="vertical",a[a["top-to-bottom"]=1]="top-to-bottom"})(Ta||(Ta={}));function an(a){const b=a.sizerChildren;let c=0;for(let d=0,e=b.length;d<e;d++){const f=b[d];if(f.rexSizer.hidden)continue;const g=f.rexSizer,j=g.proportion;j>0&&(c+=j)}return c}function bn(a,b=!0){if(a.rexSizer.hidden)return 0;b===void 0&&(b=!0);const c=a.sizerChildren;let d=0;if(a.orientation===0)for(var e=0,f=c.length;e<f;e++){const g=c[e],j=g.rexSizer;if(j.hidden)continue;let i;j.proportion===0||b&&!g.isRexSpace&&j.proportion>0?i=g instanceof Sa?Math.max(g.minWidth,g.childrenWidth):g.width:i=0;const k=j.padding;i+=k.left+k.right,e>0&&(i+=a.space.item),d+=i}else for(var e=0,f=c.length;e<f;e++){const g=c[e];if(!g.hasOwnProperty("rexSizer"))continue;const j=g.rexSizer;if(j.hidden)continue;let i=g instanceof Sa?Math.max(g.minWidth,g.childrenWidth):g.width;const k=j.padding;i+=k.left+k.right,d=Math.max(i,d)}return d+a.space.left+a.space.right}function cn(a,b=!0){if(a.rexSizer.hidden)return 0;const c=a.sizerChildren;let d=0;if(a.orientation===0)for(var e=0,f=c.length;e<f;e++){const g=c[e],j=g.rexSizer;if(j.hidden)continue;let i=g instanceof Sa?Math.max(g.minHeight,g.childrenHeight):g.height;const k=j.padding;i+=k.top+k.bottom,d=Math.max(i,d)}else for(var e=0,f=c.length;e<f;e++){const g=c[e];if(!g.hasOwnProperty("rexSizer"))continue;const j=g.rexSizer;if(j.hidden)continue;let i;j.proportion===0||b&&!g.isRexSpace&&j.proportion>0?i=g instanceof Sa?Math.max(g.minHeight,g.childrenHeight):g.height:i=0;const k=j.padding;i+=k.top+k.bottom,e>0&&(i+=a.space.item),d+=i}return d+a.space.top+a.space.bottom}function dn(a,b=[]){const c=a.sizerChildren;for(var d=0,e=c.length;d<e;d++){const f=c[d];f instanceof Sa&&b.push(f)}return b}function kn(a,b){let c;const d=b.rexSizer,e=d.padding;return a.orientation===Ta.x?d.proportion>0&&a.proportionLength>0&&(c=d.proportion*a.proportionLength):d.expand&&(c=a.innerWidth-e.left-e.right),c}function jn(a,b){let c;const d=b.rexSizer,e=d.padding;return a.orientation===Ta.x?d.expand&&(c=a.innerHeight-e.top-e.bottom):d.proportion>0&&a.proportionLength>0&&(c=d.proportion*a.proportionLength),c}function en(a,b,c,d){if(a.rexSizer.hidden||!a.needLayout)return;a.preLayout(b),c===void 0&&(c=Math.max(a.childrenWidth,a.minWidth)),d===void 0&&(d=Math.max(a.childrenHeight,a.minHeight)),a.resize(c,d);let e;if(a.childrenProportion>0){let s=a.orientation===Ta.x?a.width-a.childrenWidth:a.height-a.childrenHeight;s>0?(s=a.orientation===Ta.x?a.width-a.getChildrenWidth(!1):a.height-a.getChildrenHeight(!1),e=s/a.childrenProportion):e=0}else e=0;a.proportionLength=e;const f=a.sizerChildren,g=a.innerLeft,j=a.innerTop,i=a.innerWidth,k=a.innerHeight;let n=g,o=j;for(let s=0,u=f.length;s<u;s++){const w=f[s];if(w.rexSizer.hidden)continue;const z=w.rexSizer,G=z.padding;let K=kn(a,w),I=jn(a,w);w instanceof Sa?w._layout(a,K,I):gf(w,K,I),K===void 0&&(K=w.width),I===void 0&&(I=w.height);let N,J,Q,R;a.orientation===Ta.x?(N=n+G.left,z.proportion===0||e===0?Q=K:Q=z.proportion*e,J=o+G.top,R=k-G.top-G.bottom):(N=n+G.left,Q=i-G.left-G.right,J=o+G.top,z.proportion===0||e===0?R=I:R=z.proportion*e),Oc.setPosition(N,J).setSize(Q,R),hf(w,Oc,z.align),a.orientation===Ta.x?n+=Q+G.left+G.right+a.space.item:o+=R+G.top+G.bottom+a.space.item}a.layoutBackgrounds(),a.postLayout()}function fn(a){ff(a),a._childrenProportion=void 0}function jf(a,b,{proportion:c=0,align:d=ab.CENTER,padding:e=0,expand:f=!1,childKey:g,index:j}={}){a.pin(b),typeof d==="string"&&(d=ab[d]);const i=a.getSizerState(b);i.proportion=c,i.align=d,i.padding=Nc(e),i.expand=f,j===void 0||j>=a.sizerChildren.length?a.sizerChildren.push(b):a.sizerChildren.splice(j,0,b),g!==void 0&&a.addChildrenMap(g,b)}class hn extends pb{}function gn(a,b=1){const c=new hn();jf(a,c,{proportion:b})}class sc extends Sa{constructor({space:a={item:0},orientation:b=Ta.x}={}){super(arguments[0]);this.type="sizer";this.sizerChildren=[];this.setOrientation(b),this.setItemSpacing(a.item)}setOrientation(a){return typeof a==="string"&&(a=Ta[a]),this.orientation=a,this}setItemSpacing(a=0){return this.space.item=a,this}get childrenProportion(){return this._childrenProportion===void 0&&(this._childrenProportion=an(this)),this._childrenProportion}getChildrenWidth(a=!0){return bn(this,a)}getChildrenHeight(a=!0){return cn(this,a)}getChildrenSizers(a=[]){return dn(this,a)}_layout(a,b,c){return en(this,a,b,c),this}layoutInit(){return fn(this),this}add(a,b){return jf(this,a,b),this}addSpace(a=1){return gn(this,a),this}}var Mg;(function(a){a[a.ascending=0]="ascending",a[a.descending=1]="descending",a[a.logical_ascending=2]="logical_ascending",a[a.logical_descending=3]="logical_descending"})(Mg||(Mg={}));class vo extends Fd{constructor(){super();Mf("icon",{width:32,height:32,fillStyle:"white"});const a=zo("Items",5).layout().setPosition(400,300),b=new Jf(this);rc(b,a)}}const wo=8085079,xo=2493956;function yo(a){const b=new Wa(0,0,"icon");Kf(Lf(0,16777216),b);const c=new Gd(0,0,a,"30px monospace"),d=new sc({space:{item:10},orientation:"x"}).add(b).add(c);return d}function zo(a="Table",b=3){const c=new sc({space:{left:20,right:20,top:20,bottom:20,item:10},orientation:"y"}),d=new Hd({radius:20,fillStyle:xo,strokeStyle:wo,lineWidth:3});c.addBackground(d);const e=new Gd(0,0,a,"36px monospace");c.add(e,{padding:{bottom:10}});for(let f=0;f<b;f++)c.add(yo(`Item${f}`));return c}new Wi(If(),Hf(800,600),Ff("game"),Ef(2960685),Gf(vo));})();
/* @license
Papa Parse
v5.2.0
https://github.com/mholt/PapaParse
License: MIT
*/
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

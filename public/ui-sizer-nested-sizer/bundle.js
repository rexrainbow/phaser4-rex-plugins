(()=>{var Df=Object.defineProperty,vo=Object.prototype.hasOwnProperty,nb=(a,b)=>()=>(b||(b={exports:{}},a(b.exports,b)),b.exports),wo=a=>Df(a,"__esModule",{value:!0}),rc=(a,b)=>{wo(a);for(var c in b)Df(a,c,{get:b[c],enumerable:!0})},mr=(a,b)=>{wo(a);if(typeof b==="object"||typeof b==="function")for(let c in b)vo.call(b,c)&&!vo.call(a,c)&&c!=="default"&&Df(a,c,{get:()=>b[c],enumerable:!0});return a},Ha=a=>a&&a.__esModule?a:mr(Df({},"default",{value:a,enumerable:!0}),a);var qg=nb((a,b)=>{!function(c,d){"function"==typeof define&&define.amd?define([],d):"object"==typeof b&&"undefined"!=typeof a?b.exports=d():c.Papa=d()}(a,function c(){"use strict";var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==d?d:{},e=!d.document&&!!d.postMessage,f=e&&/blob:/i.test((d.location||{}).protocol),g={},j=0,i={parse:function(r,s){var h=(s=s||{}).dynamicTyping||!1;M(h)&&(s.dynamicTypingFunction=h,h={});if(s.dynamicTyping=h,s.transform=!!M(s.transform)&&s.transform,s.worker&&i.WORKERS_SUPPORTED){var m=function(){if(!i.WORKERS_SUPPORTED)return!1;var p=(o=d.URL||d.webkitURL||null,E=c.toString(),i.BLOB_URL||(i.BLOB_URL=o.createObjectURL(new Blob(["(",E,")();"],{type:"text/javascript"})))),v=new d.Worker(p),o,E;return v.onmessage=I,v.id=j++,g[v.id]=v}();return m.userStep=s.step,m.userChunk=s.chunk,m.userComplete=s.complete,m.userError=s.error,s.step=M(s.step),s.chunk=M(s.chunk),s.complete=M(s.complete),s.error=M(s.error),delete s.worker,void m.postMessage({input:r,config:s,workerId:m.id})}var l=null;return i.NODE_STREAM_INPUT,"string"==typeof r?l=s.download?new q(s):new u(s):!0===r.readable&&M(r.read)&&M(r.on)?l=new x(s):(d.File&&r instanceof File||r instanceof Object)&&(l=new t(s)),l.stream(r)},unparse:function(r,s){var h=!1,m=!0,l=",",p=`\r
`,v='"',o=v+v,E=!1,G=null,Y=!1;!function(){if("object"!=typeof s)return;"string"!=typeof s.delimiter||i.BAD_DELIMITERS.filter(function(L){return-1!==s.delimiter.indexOf(L)}).length||(l=s.delimiter),("boolean"==typeof s.quotes||"function"==typeof s.quotes||Array.isArray(s.quotes))&&(h=s.quotes),"boolean"!=typeof s.skipEmptyLines&&"string"!=typeof s.skipEmptyLines||(E=s.skipEmptyLines),"string"==typeof s.newline&&(p=s.newline),"string"==typeof s.quoteChar&&(v=s.quoteChar),"boolean"==typeof s.header&&(m=s.header);if(Array.isArray(s.columns)){if(0===s.columns.length)throw new Error("Option columns is empty");G=s.columns}void 0!==s.escapeChar&&(o=s.escapeChar+v),"boolean"==typeof s.escapeFormulae&&(Y=s.escapeFormulae)}();var B=new RegExp(H(v),"g");"string"==typeof r&&(r=JSON.parse(r));if(Array.isArray(r)){if(!r.length||Array.isArray(r[0]))return O(null,r,E);if("object"==typeof r[0])return O(G||Z(r[0]),r,E)}else if("object"==typeof r)return"string"==typeof r.data&&(r.data=JSON.parse(r.data)),Array.isArray(r.data)&&(r.fields||(r.fields=r.meta&&r.meta.fields),r.fields||(r.fields=Array.isArray(r.data[0])?r.fields:Z(r.data[0])),Array.isArray(r.data[0])||"object"==typeof r.data[0]||(r.data=[r.data])),O(r.fields||[],r.data||[],E);throw new Error("Unable to serialize unrecognized input");function Z(L){if("object"!=typeof L)return[];var W=[];for(var fa in L)W.push(fa);return W}function O(L,W,fa){var la="";"string"==typeof L&&(L=JSON.parse(L)),"string"==typeof W&&(W=JSON.parse(W));var ma=Array.isArray(L)&&0<L.length,ra=!Array.isArray(W[0]);if(ma&&m){for(var X=0;X<L.length;X++)0<X&&(la+=l),la+=F(L[X],X);0<W.length&&(la+=p)}for(var aa=0;aa<W.length;aa++){var ia=ma?L.length:W[aa].length,ja=!1,R=ma?0===Object.keys(W[aa]).length:0===W[aa].length;if(fa&&!ma&&(ja="greedy"===fa?""===W[aa].join("").trim():1===W[aa].length&&0===W[aa][0].length),"greedy"===fa&&ma){for(var V=[],ea=0;ea<ia;ea++){var U=ra?L[ea]:ea;V.push(W[aa][U])}ja=""===V.join("").trim()}if(!ja){for(var ba=0;ba<ia;ba++){0<ba&&!R&&(la+=l);var na=ma&&ra?L[ba]:ba;la+=F(W[aa][na],ba)}aa<W.length-1&&(!fa||0<ia&&!R)&&(la+=p)}}return la}function F(L,W){if(null==L)return"";if(L.constructor===Date)return JSON.stringify(L).slice(1,25);!0===Y&&"string"==typeof L&&null!==L.match(/^[=+\-@].*$/)&&(L="'"+L);var fa=L.toString().replace(B,o),la="boolean"==typeof h&&h||"function"==typeof h&&h(L,W)||Array.isArray(h)&&h[W]||function(ma,ra){for(var X=0;X<ra.length;X++)if(-1<ma.indexOf(ra[X]))return!0;return!1}(fa,i.BAD_DELIMITERS)||-1<fa.indexOf(l)||" "===fa.charAt(0)||" "===fa.charAt(fa.length-1);return la?v+fa+v:fa}}};if(i.RECORD_SEP=String.fromCharCode(30),i.UNIT_SEP=String.fromCharCode(31),i.BYTE_ORDER_MARK="ï»¿",i.BAD_DELIMITERS=["\r",`
`,'"',i.BYTE_ORDER_MARK],i.WORKERS_SUPPORTED=!e&&!!d.Worker,i.NODE_STREAM_INPUT=1,i.LocalChunkSize=10485760,i.RemoteChunkSize=5242880,i.DefaultDelimiter=",",i.Parser=K,i.ParserHandle=z,i.NetworkStreamer=q,i.FileStreamer=t,i.StringStreamer=u,i.ReadableStreamStreamer=x,d.jQuery){var k=d.jQuery;k.fn.parse=function(r){var s=r.config||{},h=[];return this.each(function(p){if(!("INPUT"===k(this).prop("tagName").toUpperCase()&&"file"===k(this).attr("type").toLowerCase()&&d.FileReader)||!this.files||0===this.files.length)return!0;for(var v=0;v<this.files.length;v++)h.push({file:this.files[v],inputElem:this,instanceConfig:k.extend({},s)})}),m(),this;function m(){if(0!==h.length){var p,v,o,E,G=h[0];if(M(r.before)){var Y=r.before(G.file,G.inputElem);if("object"==typeof Y){if("abort"===Y.action)return p="AbortError",v=G.file,o=G.inputElem,E=Y.reason,void(M(r.error)&&r.error({name:p},v,o,E));if("skip"===Y.action)return void l();"object"==typeof Y.config&&(G.instanceConfig=k.extend(G.instanceConfig,Y.config))}else if("skip"===Y)return void l()}var B=G.instanceConfig.complete;G.instanceConfig.complete=function(Z){M(B)&&B(Z,G.file,G.inputElem),l()},i.parse(G.file,G.instanceConfig)}else M(r.complete)&&r.complete()}function l(){h.splice(0,1),m()}}}function n(r){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(s){var h=P(s);h.chunkSize=parseInt(h.chunkSize),s.step||s.chunk||(h.chunkSize=null),this._handle=new z(h),(this._handle.streamer=this)._config=h}.call(this,r),this.parseChunk=function(s,h){if(this.isFirstChunk&&M(this._config.beforeFirstChunk)){var m=this._config.beforeFirstChunk(s);void 0!==m&&(s=m)}this.isFirstChunk=!1,this._halted=!1;var l=this._partialLine+s;this._partialLine="";var p=this._handle.parse(l,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var v=p.meta.cursor;this._finished||(this._partialLine=l.substring(v-this._baseIndex),this._baseIndex=v),p&&p.data&&(this._rowCount+=p.data.length);var o=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(f)d.postMessage({results:p,workerId:i.WORKER_ID,finished:o});else if(M(this._config.chunk)&&!h){if(this._config.chunk(p,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);p=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(p.data),this._completeResults.errors=this._completeResults.errors.concat(p.errors),this._completeResults.meta=p.meta),this._completed||!o||!M(this._config.complete)||p&&p.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),o||p&&p.meta.paused||this._nextChunk(),p}this._halted=!0},this._sendError=function(s){M(this._config.error)?this._config.error(s):f&&this._config.error&&d.postMessage({workerId:i.WORKER_ID,error:s,finished:!1})}}function q(r){var s;(r=r||{}).chunkSize||(r.chunkSize=i.RemoteChunkSize),n.call(this,r),this._nextChunk=e?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(h){this._input=h,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(s=new XMLHttpRequest(),this._config.withCredentials&&(s.withCredentials=this._config.withCredentials),e||(s.onload=Q(this._chunkLoaded,this),s.onerror=Q(this._chunkError,this)),s.open(this._config.downloadRequestBody?"POST":"GET",this._input,!e),this._config.downloadRequestHeaders){var h=this._config.downloadRequestHeaders;for(var m in h)s.setRequestHeader(m,h[m])}if(this._config.chunkSize){var l=this._start+this._config.chunkSize-1;s.setRequestHeader("Range","bytes="+this._start+"-"+l)}try{s.send(this._config.downloadRequestBody)}catch(p){this._chunkError(p.message)}e&&0===s.status&&this._chunkError()}},this._chunkLoaded=function(){4===s.readyState&&(s.status<200||400<=s.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:s.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(h){var m=h.getResponseHeader("Content-Range");return null===m?-1:parseInt(m.substring(m.lastIndexOf("/")+1))}(s),this.parseChunk(s.responseText)))},this._chunkError=function(h){var m=s.statusText||h;this._sendError(new Error(m))}}function t(r){var s,h;(r=r||{}).chunkSize||(r.chunkSize=i.LocalChunkSize),n.call(this,r);var m="undefined"!=typeof FileReader;this.stream=function(l){this._input=l,h=l.slice||l.webkitSlice||l.mozSlice,m?((s=new FileReader()).onload=Q(this._chunkLoaded,this),s.onerror=Q(this._chunkError,this)):s=new FileReaderSync(),this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var l=this._input;if(this._config.chunkSize){var p=Math.min(this._start+this._config.chunkSize,this._input.size);l=h.call(l,this._start,p)}var v=s.readAsText(l,this._config.encoding);m||this._chunkLoaded({target:{result:v}})},this._chunkLoaded=function(l){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(l.target.result)},this._chunkError=function(){this._sendError(s.error)}}function u(r){var s;n.call(this,r=r||{}),this.stream=function(h){return s=h,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var h,m=this._config.chunkSize;return m?(h=s.substring(0,m),s=s.substring(m)):(h=s,s=""),this._finished=!s,this.parseChunk(h)}}}function x(r){n.call(this,r=r||{});var s=[],h=!0,m=!1;this.pause=function(){n.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){n.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(l){this._input=l,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){m&&1===s.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),s.length?this.parseChunk(s.shift()):h=!0},this._streamData=Q(function(l){try{s.push("string"==typeof l?l:l.toString(this._config.encoding)),h&&(h=!1,this._checkIsFinished(),this.parseChunk(s.shift()))}catch(p){this._streamError(p)}},this),this._streamError=Q(function(l){this._streamCleanUp(),this._sendError(l)},this),this._streamEnd=Q(function(){this._streamCleanUp(),m=!0,this._streamData("")},this),this._streamCleanUp=Q(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function z(r){var s,h,m,l=Math.pow(2,53),p=-l,v=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)(e[-+]?\d+)?\s*$/,o=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,E=this,G=0,Y=0,B=!1,Z=!1,O=[],F={data:[],errors:[],meta:{}};if(M(r.step)){var L=r.step;r.step=function(X){if(F=X,la())fa();else{if(fa(),0===F.data.length)return;G+=X.data.length,r.preview&&G>r.preview?h.abort():(F.data=F.data[0],L(F,E))}}}function W(X){return"greedy"===r.skipEmptyLines?""===X.join("").trim():1===X.length&&0===X[0].length}function fa(){if(F&&m&&(ra("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+i.DefaultDelimiter+"'"),m=!1),r.skipEmptyLines)for(var X=0;X<F.data.length;X++)W(F.data[X])&&F.data.splice(X--,1);return la()&&function(){if(!F)return;function aa(ja,R){M(r.transformHeader)&&(ja=r.transformHeader(ja,R)),O.push(ja)}if(Array.isArray(F.data[0])){for(var ia=0;la()&&ia<F.data.length;ia++)F.data[ia].forEach(aa);F.data.splice(0,1)}else F.data.forEach(aa)}(),function(){if(!F||!r.header&&!r.dynamicTyping&&!r.transform)return F;function aa(ja,R){var V,ea=r.header?{}:[];for(V=0;V<ja.length;V++){var U=V,ba=ja[V];r.header&&(U=V>=O.length?"__parsed_extra":O[V]),r.transform&&(ba=r.transform(ba,U)),ba=ma(U,ba),"__parsed_extra"===U?(ea[U]=ea[U]||[],ea[U].push(ba)):ea[U]=ba}return r.header&&(V>O.length?ra("FieldMismatch","TooManyFields","Too many fields: expected "+O.length+" fields but parsed "+V,Y+R):V<O.length&&ra("FieldMismatch","TooFewFields","Too few fields: expected "+O.length+" fields but parsed "+V,Y+R)),ea}var ia=1;return!F.data.length||Array.isArray(F.data[0])?(F.data=F.data.map(aa),ia=F.data.length):F.data=aa(F.data,0),r.header&&F.meta&&(F.meta.fields=O),Y+=ia,F}()}function la(){return r.header&&0===O.length}function ma(X,aa){return ia=X,r.dynamicTypingFunction&&void 0===r.dynamicTyping[ia]&&(r.dynamicTyping[ia]=r.dynamicTypingFunction(ia)),!0===(r.dynamicTyping[ia]||r.dynamicTyping)?"true"===aa||"TRUE"===aa||"false"!==aa&&"FALSE"!==aa&&(function(ja){if(v.test(ja)){var R=parseFloat(ja);if(p<R&&R<l)return!0}return!1}(aa)?parseFloat(aa):o.test(aa)?new Date(aa):""===aa?null:aa):aa;var ia}function ra(X,aa,ia,ja){var R={type:X,code:aa,message:ia};void 0!==ja&&(R.row=ja),F.errors.push(R)}this.parse=function(X,aa,ia){var ja=r.quoteChar||'"';if(r.newline||(r.newline=function(ea,U){ea=ea.substring(0,1048576);var ba=new RegExp(H(U)+"([^]*?)"+H(U),"gm"),na=(ea=ea.replace(ba,"")).split("\r"),sa=ea.split(`
`),Aa=1<sa.length&&sa[0].length<na[0].length;if(1===na.length||Aa)return`
`;for(var S=0,Ba=0;Ba<na.length;Ba++)`
`===na[Ba][0]&&S++;return S>=na.length/2?`\r
`:"\r"}(X,ja)),m=!1,r.delimiter)M(r.delimiter)&&(r.delimiter=r.delimiter(X),F.meta.delimiter=r.delimiter);else{var R=function(ea,U,ba,na,sa){var Aa,S,Ba,A;sa=sa||[",","	","|",";",i.RECORD_SEP,i.UNIT_SEP];for(var w=0;w<sa.length;w++){var C=sa[w],D=0,y=0,T=0;Ba=void 0;for(var $=new K({comments:na,delimiter:C,newline:U,preview:10}).parse(ea),ha=0;ha<$.data.length;ha++)if(ba&&W($.data[ha]))T++;else{var ga=$.data[ha].length;y+=ga,void 0!==Ba?0<ga&&(D+=Math.abs(ga-Ba),Ba=ga):Ba=ga}0<$.data.length&&(y/=$.data.length-T),(void 0===S||D<=S)&&(void 0===A||A<y)&&1.99<y&&(S=D,Aa=C,A=y)}return{successful:!!(r.delimiter=Aa),bestDelimiter:Aa}}(X,r.newline,r.skipEmptyLines,r.comments,r.delimitersToGuess);R.successful?r.delimiter=R.bestDelimiter:(m=!0,r.delimiter=i.DefaultDelimiter),F.meta.delimiter=r.delimiter}var V=P(r);return r.preview&&r.header&&V.preview++,s=X,h=new K(V),F=h.parse(s,aa,ia),fa(),B?{meta:{paused:!0}}:F||{meta:{paused:!1}}},this.paused=function(){return B},this.pause=function(){B=!0,h.abort(),s=M(r.chunk)?"":s.substring(h.getCharIndex())},this.resume=function(){E.streamer._halted?(B=!1,E.streamer.parseChunk(s,!0)):setTimeout(E.resume,3)},this.aborted=function(){return Z},this.abort=function(){Z=!0,h.abort(),F.meta.aborted=!0,M(r.complete)&&r.complete(F),s=""}}function H(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function K(r){var s,h=(r=r||{}).delimiter,m=r.newline,l=r.comments,p=r.step,v=r.preview,o=r.fastMode,E=s=void 0===r.quoteChar?'"':r.quoteChar;if(void 0!==r.escapeChar&&(E=r.escapeChar),("string"!=typeof h||-1<i.BAD_DELIMITERS.indexOf(h))&&(h=","),l===h)throw new Error("Comment character same as delimiter");!0===l?l="#":("string"!=typeof l||-1<i.BAD_DELIMITERS.indexOf(l))&&(l=!1),`
`!==m&&"\r"!==m&&`\r
`!==m&&(m=`
`);var G=0,Y=!1;this.parse=function(B,Z,O){if("string"!=typeof B)throw new Error("Input must be a string");var F=B.length,L=h.length,W=m.length,fa=l.length,la=M(p),ma=[],ra=[],X=[],aa=G=0;if(!B)return w();if(o||!1!==o&&-1===B.indexOf(s)){for(var ia=B.split(m),ja=0;ja<ia.length;ja++){if(X=ia[ja],G+=X.length,ja!==ia.length-1)G+=m.length;else if(O)return w();if(!l||X.substring(0,fa)!==l){if(la){if(ma=[],Aa(X.split(h)),C(),Y)return w()}else Aa(X.split(h));if(v&&v<=ja)return ma=ma.slice(0,v),w(!0)}}return w()}for(var R=B.indexOf(h,G),V=B.indexOf(m,G),ea=new RegExp(H(E)+H(s),"g"),U=B.indexOf(s,G);;)if(B[G]!==s)if(l&&0===X.length&&B.substring(G,G+fa)===l){if(-1===V)return w();G=V+W,V=B.indexOf(m,G),R=B.indexOf(h,G)}else{if(-1!==R&&(R<V||-1===V)){if(!(R<U)){X.push(B.substring(G,R)),G=R+L,R=B.indexOf(h,G);continue}var ba=D(R,U,V);if(ba&&void 0!==ba.nextDelim){R=ba.nextDelim,U=ba.quoteSearch,X.push(B.substring(G,R)),G=R+L,R=B.indexOf(h,G);continue}}if(-1===V)break;if(X.push(B.substring(G,V)),A(V+W),la&&(C(),Y))return w();if(v&&ma.length>=v)return w(!0)}else for(U=G,G++;;){if(-1===(U=B.indexOf(s,U+1)))return O||ra.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:ma.length,index:G}),Ba();if(U===F-1)return Ba(B.substring(G,U).replace(ea,s));if(s!==E||B[U+1]!==E){if(s===E||0===U||B[U-1]!==E){-1!==R&&R<U+1&&(R=B.indexOf(h,U+1)),-1!==V&&V<U+1&&(V=B.indexOf(m,U+1));var na=S(-1===V?R:Math.min(R,V));if(B[U+1+na]===h){X.push(B.substring(G,U).replace(ea,s)),B[G=U+1+na+L]!==s&&(U=B.indexOf(s,G)),R=B.indexOf(h,G),V=B.indexOf(m,G);break}var sa=S(V);if(B.substring(U+1+sa,U+1+sa+W)===m){if(X.push(B.substring(G,U).replace(ea,s)),A(U+1+sa+W),R=B.indexOf(h,G),U=B.indexOf(s,G),la&&(C(),Y))return w();if(v&&ma.length>=v)return w(!0);break}ra.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:ma.length,index:G}),U++}}else U++}return Ba();function Aa(y){ma.push(y),aa=G}function S(y){var T=0;if(-1!==y){var $=B.substring(U+1,y);$&&""===$.trim()&&(T=$.length)}return T}function Ba(y){return O||(void 0===y&&(y=B.substring(G)),X.push(y),G=F,Aa(X),la&&C()),w()}function A(y){G=y,Aa(X),X=[],V=B.indexOf(m,G)}function w(y){return{data:ma,errors:ra,meta:{delimiter:h,linebreak:m,aborted:Y,truncated:!!y,cursor:aa+(Z||0)}}}function C(){p(w()),ma=[],ra=[]}function D(y,T,$){var ha={nextDelim:void 0,quoteSearch:void 0},ga=B.indexOf(s,T+1);if(T<y&&y<ga&&(ga<$||-1===$)){var ka=B.indexOf(h,ga);if(-1===ka)return ha;ga<ka&&(ga=B.indexOf(s,ga+1)),ha=D(ka,ga,$)}else ha={nextDelim:y,quoteSearch:T};return ha}},this.abort=function(){Y=!0},this.getCharIndex=function(){return G}}function I(r){var s=r.data,h=g[s.workerId],m=!1;if(s.error)h.userError(s.error,s.file);else if(s.results&&s.results.data){var l={abort:function(){m=!0,N(s.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:J,resume:J};if(M(h.userStep)){for(var p=0;p<s.results.data.length&&(h.userStep({data:s.results.data[p],errors:s.results.errors,meta:s.results.meta},l),!m);p++);delete s.results}else M(h.userChunk)&&(h.userChunk(s.results,l,s.file),delete s.results)}s.finished&&!m&&N(s.workerId,s.results)}function N(r,s){var h=g[r];M(h.userComplete)&&h.userComplete(s),h.terminate(),delete g[r]}function J(){throw new Error("Not implemented.")}function P(r){if("object"!=typeof r||null===r)return r;var s=Array.isArray(r)?[]:{};for(var h in r)s[h]=P(r[h]);return s}function Q(r,s){return function(){r.apply(s,arguments)}}function M(r){return"function"==typeof r}return f&&(d.onmessage=function(r){var s=r.data;void 0===i.WORKER_ID&&s&&(i.WORKER_ID=s.workerId);if("string"==typeof s.input)d.postMessage({workerId:i.WORKER_ID,results:i.parse(s.input,s.config),finished:!0});else if(d.File&&s.input instanceof File||s.input instanceof Object){var h=i.parse(s.input,s.config);h&&d.postMessage({workerId:i.WORKER_ID,results:h,finished:!0})}}),(q.prototype=Object.create(n.prototype)).constructor=q,(t.prototype=Object.create(n.prototype)).constructor=t,(u.prototype=Object.create(u.prototype)).constructor=u,(x.prototype=Object.create(n.prototype)).constructor=x,i})});var _i=nb(r=>{rc(r,{__assign:()=>c,__asyncDelegator:()=>K,__asyncGenerator:()=>H,__asyncValues:()=>I,__await:()=>z,__awaiter:()=>j,__classPrivateFieldGet:()=>Q,__classPrivateFieldSet:()=>M,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>P,__importStar:()=>J,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>t,__rest:()=>d,__spread:()=>u,__spreadArrays:()=>x,__values:()=>q});var a=function(h,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,p){l.__proto__=p}||function(l,p){for(var v in p)p.hasOwnProperty(v)&&(l[v]=p[v])},a(h,m)};function b(h,m){a(h,m);function l(){this.constructor=h}h.prototype=m===null?Object.create(m):(l.prototype=m.prototype,new l())}var c=function(){return c=Object.assign||function h(m){for(var l,p=1,v=arguments.length;p<v;p++){l=arguments[p];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(m[o]=l[o])}return m},c.apply(this,arguments)};function d(h,m){var l={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&m.indexOf(p)<0&&(l[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var v=0,p=Object.getOwnPropertySymbols(h);v<p.length;v++)m.indexOf(p[v])<0&&Object.prototype.propertyIsEnumerable.call(h,p[v])&&(l[p[v]]=h[p[v]]);return l}function e(h,m,l,p){var v=arguments.length,o=v<3?m:p===null?p=Object.getOwnPropertyDescriptor(m,l):p,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(h,m,l,p);else for(var G=h.length-1;G>=0;G--)(E=h[G])&&(o=(v<3?E(o):v>3?E(m,l,o):E(m,l))||o);return v>3&&o&&Object.defineProperty(m,l,o),o}function f(h,m){return function(l,p){m(l,p,h)}}function g(h,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,m)}function j(h,m,l,p){function v(o){return o instanceof l?o:new l(function(E){E(o)})}return new(l||(l=Promise))(function(o,E){function G(Z){try{B(p.next(Z))}catch(O){E(O)}}function Y(Z){try{B(p.throw(Z))}catch(O){E(O)}}function B(Z){Z.done?o(Z.value):v(Z.value).then(G,Y)}B((p=p.apply(h,m||[])).next())})}function i(h,m){var l={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},p,v,o,E;return E={next:G(0),throw:G(1),return:G(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function G(B){return function(Z){return Y([B,Z])}}function Y(B){if(p)throw new TypeError("Generator is already executing.");for(;l;)try{if(p=1,v&&(o=B[0]&2?v.return:B[0]?v.throw||((o=v.return)&&o.call(v),0):v.next)&&!(o=o.call(v,B[1])).done)return o;(v=0,o)&&(B=[B[0]&2,o.value]);switch(B[0]){case 0:case 1:o=B;break;case 4:return l.label++,{value:B[1],done:!1};case 5:l.label++,v=B[1],B=[0];continue;case 7:B=l.ops.pop(),l.trys.pop();continue;default:if(!(o=l.trys,o=o.length>0&&o[o.length-1])&&(B[0]===6||B[0]===2)){l=0;continue}if(B[0]===3&&(!o||B[1]>o[0]&&B[1]<o[3])){l.label=B[1];break}if(B[0]===6&&l.label<o[1]){l.label=o[1],o=B;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(B);break}o[2]&&l.ops.pop(),l.trys.pop();continue}B=m.call(h,l)}catch(Z){B=[6,Z],v=0}finally{p=o=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}}function k(h,m,l,p){p===void 0&&(p=l),h[p]=m[l]}function n(h,m){for(var l in h)l!=="default"&&!m.hasOwnProperty(l)&&(m[l]=h[l])}function q(h){var m=typeof Symbol==="function"&&Symbol.iterator,l=m&&h[m],p=0;if(l)return l.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function t(h,m){var l=typeof Symbol==="function"&&h[Symbol.iterator];if(!l)return h;var p=l.call(h),v,o=[],E;try{for(;(m===void 0||m-- >0)&&!(v=p.next()).done;)o.push(v.value)}catch(G){E={error:G}}finally{try{v&&!v.done&&(l=p.return)&&l.call(p)}finally{if(E)throw E.error}}return o}function u(){for(var h=[],m=0;m<arguments.length;m++)h=h.concat(t(arguments[m]));return h}function x(){for(var h=0,m=0,l=arguments.length;m<l;m++)h+=arguments[m].length;for(var p=Array(h),v=0,m=0;m<l;m++)for(var o=arguments[m],E=0,G=o.length;E<G;E++,v++)p[v]=o[E];return p}function z(h){return this instanceof z?(this.v=h,this):new z(h)}function H(h,m,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=l.apply(h,m||[]),v,o=[];return v={},E("next"),E("throw"),E("return"),v[Symbol.asyncIterator]=function(){return this},v;function E(F){p[F]&&(v[F]=function(L){return new Promise(function(W,fa){o.push([F,L,W,fa])>1||G(F,L)})})}function G(F,L){try{Y(p[F](L))}catch(W){O(o[0][3],W)}}function Y(F){F.value instanceof z?Promise.resolve(F.value.v).then(B,Z):O(o[0][2],F)}function B(F){G("next",F)}function Z(F){G("throw",F)}function O(F,L){(F(L),o.shift(),o.length)&&G(o[0][0],o[0][1])}}function K(h){var m,l;return m={},p("next"),p("throw",function(v){throw v}),p("return"),m[Symbol.iterator]=function(){return this},m;function p(v,o){m[v]=h[v]?function(E){return(l=!l)?{value:z(h[v](E)),done:v==="return"}:o?o(E):E}:o}}function I(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=h[Symbol.asyncIterator],l;return m?m.call(h):(h=typeof q==="function"?q(h):h[Symbol.iterator](),l={},p("next"),p("throw"),p("return"),l[Symbol.asyncIterator]=function(){return this},l);function p(o){l[o]=h[o]&&function(E){return new Promise(function(G,Y){E=h[o](E),v(G,Y,E.done,E.value)})}}function v(o,E,G,Y){Promise.resolve(Y).then(function(B){o({value:B,done:G})},E)}}function N(h,m){return Object.defineProperty?Object.defineProperty(h,"raw",{value:m}):h.raw=m,h}function J(h){if(h&&h.__esModule)return h;var m={};if(h!=null)for(var l in h)Object.hasOwnProperty.call(h,l)&&(m[l]=h[l]);return m.default=h,m}function P(h){return h&&h.__esModule?h:{default:h}}function Q(h,m){if(!m.has(h))throw new TypeError("attempted to get private field on non-instance");return m.get(h)}function M(h,m,l){if(!m.has(h))throw new TypeError("attempted to set private field on non-instance");return m.set(h,l),l}});var cj=nb(r=>{rc(r,{__assign:()=>c,__asyncDelegator:()=>K,__asyncGenerator:()=>H,__asyncValues:()=>I,__await:()=>z,__awaiter:()=>j,__classPrivateFieldGet:()=>Q,__classPrivateFieldSet:()=>M,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>P,__importStar:()=>J,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>t,__rest:()=>d,__spread:()=>u,__spreadArrays:()=>x,__values:()=>q});var a=function(h,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,p){l.__proto__=p}||function(l,p){for(var v in p)p.hasOwnProperty(v)&&(l[v]=p[v])},a(h,m)};function b(h,m){a(h,m);function l(){this.constructor=h}h.prototype=m===null?Object.create(m):(l.prototype=m.prototype,new l())}var c=function(){return c=Object.assign||function h(m){for(var l,p=1,v=arguments.length;p<v;p++){l=arguments[p];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(m[o]=l[o])}return m},c.apply(this,arguments)};function d(h,m){var l={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&m.indexOf(p)<0&&(l[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var v=0,p=Object.getOwnPropertySymbols(h);v<p.length;v++)m.indexOf(p[v])<0&&Object.prototype.propertyIsEnumerable.call(h,p[v])&&(l[p[v]]=h[p[v]]);return l}function e(h,m,l,p){var v=arguments.length,o=v<3?m:p===null?p=Object.getOwnPropertyDescriptor(m,l):p,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(h,m,l,p);else for(var G=h.length-1;G>=0;G--)(E=h[G])&&(o=(v<3?E(o):v>3?E(m,l,o):E(m,l))||o);return v>3&&o&&Object.defineProperty(m,l,o),o}function f(h,m){return function(l,p){m(l,p,h)}}function g(h,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,m)}function j(h,m,l,p){function v(o){return o instanceof l?o:new l(function(E){E(o)})}return new(l||(l=Promise))(function(o,E){function G(Z){try{B(p.next(Z))}catch(O){E(O)}}function Y(Z){try{B(p.throw(Z))}catch(O){E(O)}}function B(Z){Z.done?o(Z.value):v(Z.value).then(G,Y)}B((p=p.apply(h,m||[])).next())})}function i(h,m){var l={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},p,v,o,E;return E={next:G(0),throw:G(1),return:G(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function G(B){return function(Z){return Y([B,Z])}}function Y(B){if(p)throw new TypeError("Generator is already executing.");for(;l;)try{if(p=1,v&&(o=B[0]&2?v.return:B[0]?v.throw||((o=v.return)&&o.call(v),0):v.next)&&!(o=o.call(v,B[1])).done)return o;(v=0,o)&&(B=[B[0]&2,o.value]);switch(B[0]){case 0:case 1:o=B;break;case 4:return l.label++,{value:B[1],done:!1};case 5:l.label++,v=B[1],B=[0];continue;case 7:B=l.ops.pop(),l.trys.pop();continue;default:if(!(o=l.trys,o=o.length>0&&o[o.length-1])&&(B[0]===6||B[0]===2)){l=0;continue}if(B[0]===3&&(!o||B[1]>o[0]&&B[1]<o[3])){l.label=B[1];break}if(B[0]===6&&l.label<o[1]){l.label=o[1],o=B;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(B);break}o[2]&&l.ops.pop(),l.trys.pop();continue}B=m.call(h,l)}catch(Z){B=[6,Z],v=0}finally{p=o=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}}function k(h,m,l,p){p===void 0&&(p=l),h[p]=m[l]}function n(h,m){for(var l in h)l!=="default"&&!m.hasOwnProperty(l)&&(m[l]=h[l])}function q(h){var m=typeof Symbol==="function"&&Symbol.iterator,l=m&&h[m],p=0;if(l)return l.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function t(h,m){var l=typeof Symbol==="function"&&h[Symbol.iterator];if(!l)return h;var p=l.call(h),v,o=[],E;try{for(;(m===void 0||m-- >0)&&!(v=p.next()).done;)o.push(v.value)}catch(G){E={error:G}}finally{try{v&&!v.done&&(l=p.return)&&l.call(p)}finally{if(E)throw E.error}}return o}function u(){for(var h=[],m=0;m<arguments.length;m++)h=h.concat(t(arguments[m]));return h}function x(){for(var h=0,m=0,l=arguments.length;m<l;m++)h+=arguments[m].length;for(var p=Array(h),v=0,m=0;m<l;m++)for(var o=arguments[m],E=0,G=o.length;E<G;E++,v++)p[v]=o[E];return p}function z(h){return this instanceof z?(this.v=h,this):new z(h)}function H(h,m,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=l.apply(h,m||[]),v,o=[];return v={},E("next"),E("throw"),E("return"),v[Symbol.asyncIterator]=function(){return this},v;function E(F){p[F]&&(v[F]=function(L){return new Promise(function(W,fa){o.push([F,L,W,fa])>1||G(F,L)})})}function G(F,L){try{Y(p[F](L))}catch(W){O(o[0][3],W)}}function Y(F){F.value instanceof z?Promise.resolve(F.value.v).then(B,Z):O(o[0][2],F)}function B(F){G("next",F)}function Z(F){G("throw",F)}function O(F,L){(F(L),o.shift(),o.length)&&G(o[0][0],o[0][1])}}function K(h){var m,l;return m={},p("next"),p("throw",function(v){throw v}),p("return"),m[Symbol.iterator]=function(){return this},m;function p(v,o){m[v]=h[v]?function(E){return(l=!l)?{value:z(h[v](E)),done:v==="return"}:o?o(E):E}:o}}function I(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=h[Symbol.asyncIterator],l;return m?m.call(h):(h=typeof q==="function"?q(h):h[Symbol.iterator](),l={},p("next"),p("throw"),p("return"),l[Symbol.asyncIterator]=function(){return this},l);function p(o){l[o]=h[o]&&function(E){return new Promise(function(G,Y){E=h[o](E),v(G,Y,E.done,E.value)})}}function v(o,E,G,Y){Promise.resolve(Y).then(function(B){o({value:B,done:G})},E)}}function N(h,m){return Object.defineProperty?Object.defineProperty(h,"raw",{value:m}):h.raw=m,h}function J(h){if(h&&h.__esModule)return h;var m={};if(h!=null)for(var l in h)Object.hasOwnProperty.call(h,l)&&(m[l]=h[l]);return m.default=h,m}function P(h){return h&&h.__esModule?h:{default:h}}function Q(h,m){if(!m.has(h))throw new TypeError("attempted to get private field on non-instance");return m.get(h)}function M(h,m,l){if(!m.has(h))throw new TypeError("attempted to set private field on non-instance");return m.set(h,l),l}});var Of=nb(S=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0});var a=cj();var b={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};var c=function(A,w){if(!A)throw d(w)},d=function(A){return new Error("Firebase Database ("+b.SDK_VERSION+") INTERNAL ASSERT FAILED: "+A)};var e=function(A){for(var w=[],C=0,D=0;D<A.length;D++){var y=A.charCodeAt(D);y<128?w[C++]=y:y<2048?(w[C++]=y>>6|192,w[C++]=y&63|128):(y&64512)===55296&&D+1<A.length&&(A.charCodeAt(D+1)&64512)===56320?(y=65536+((y&1023)<<10)+(A.charCodeAt(++D)&1023),w[C++]=y>>18|240,w[C++]=y>>12&63|128,w[C++]=y>>6&63|128,w[C++]=y&63|128):(w[C++]=y>>12|224,w[C++]=y>>6&63|128,w[C++]=y&63|128)}return w},f=function(A){for(var w=[],C=0,D=0;C<A.length;){var y=A[C++];if(y<128)w[D++]=String.fromCharCode(y);else if(y>191&&y<224){var T=A[C++];w[D++]=String.fromCharCode((y&31)<<6|T&63)}else if(y>239&&y<365){var T=A[C++],$=A[C++],ha=A[C++],ga=((y&7)<<18|(T&63)<<12|($&63)<<6|ha&63)-65536;w[D++]=String.fromCharCode(55296+(ga>>10)),w[D++]=String.fromCharCode(56320+(ga&1023))}else{var T=A[C++],$=A[C++];w[D++]=String.fromCharCode((y&15)<<12|(T&63)<<6|$&63)}}return w.join("")},g={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob==="function",encodeByteArray:function(A,w){if(!Array.isArray(A))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var C=w?this.byteToCharMapWebSafe_:this.byteToCharMap_,D=[],y=0;y<A.length;y+=3){var T=A[y],$=y+1<A.length,ha=$?A[y+1]:0,ga=y+2<A.length,ka=ga?A[y+2]:0,Ya=T>>2,Va=(T&3)<<4|ha>>4,Ia=(ha&15)<<2|ka>>6,Ef=ka&63;ga||(Ef=64,$||(Ia=64)),D.push(C[Ya],C[Va],C[Ia],C[Ef])}return D.join("")},encodeString:function(A,w){return this.HAS_NATIVE_SUPPORT&&!w?btoa(A):this.encodeByteArray(e(A),w)},decodeString:function(A,w){return this.HAS_NATIVE_SUPPORT&&!w?atob(A):f(this.decodeStringToByteArray(A,w))},decodeStringToByteArray:function(A,w){this.init_();for(var C=w?this.charToByteMapWebSafe_:this.charToByteMap_,D=[],y=0;y<A.length;){var T=C[A.charAt(y++)],$=y<A.length,ha=$?C[A.charAt(y)]:0;++y;var ga=y<A.length,ka=ga?C[A.charAt(y)]:64;++y;var Ya=y<A.length,Va=Ya?C[A.charAt(y)]:64;++y;if(T==null||ha==null||ka==null||Va==null)throw Error();var Ia=T<<2|ha>>4;D.push(Ia);if(ka!==64){var Ef=ha<<4&240|ka>>2;D.push(Ef);if(Va!==64){var nr=ka<<6&192|Va;D.push(nr)}}}return D},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var A=0;A<this.ENCODED_VALS.length;A++)this.byteToCharMap_[A]=this.ENCODED_VALS.charAt(A),this.charToByteMap_[this.byteToCharMap_[A]]=A,this.byteToCharMapWebSafe_[A]=this.ENCODED_VALS_WEBSAFE.charAt(A),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[A]]=A,A>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(A)]=A,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(A)]=A)}}},j=function(A){var w=e(A);return g.encodeByteArray(w,!0)},i=function(A){try{return g.decodeString(A,!0)}catch(w){console.error("base64Decode failed: ",w)}return null};function k(A){return n(void 0,A)}function n(A,w){if(!(w instanceof Object))return w;switch(w.constructor){case Date:var C=w;return new Date(C.getTime());case Object:A===void 0&&(A={});break;case Array:A=[];break;default:return w}for(var D in w){if(!w.hasOwnProperty(D))continue;A[D]=n(A[D],w[D])}return A}var q=function(){function A(){var w=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(C,D){w.resolve=C,w.reject=D})}return A.prototype.wrapCallback=function(w){var C=this;return function(D,y){D?C.reject(D):C.resolve(y),typeof w==="function"&&(C.promise.catch(function(){}),w.length===1?w(D):w(D,y))}},A}();function t(){return typeof navigator!=="undefined"&&typeof navigator.userAgent==="string"?navigator.userAgent:""}function u(){return typeof window!=="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(t())}function x(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(A){return!1}}function z(){return typeof self==="object"&&self.self===self}function H(){var A=typeof chrome==="object"?chrome.runtime:typeof browser==="object"?browser.runtime:void 0;return typeof A==="object"&&A.id!==void 0}function K(){return typeof navigator==="object"&&navigator.product==="ReactNative"}function I(){return t().indexOf("Electron/")>=0}function N(){var A=t();return A.indexOf("MSIE ")>=0||A.indexOf("Trident/")>=0}function J(){return t().indexOf("MSAppHost/")>=0}function P(){return b.NODE_CLIENT===!0||b.NODE_ADMIN===!0}function Q(){return!x()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function M(){return"indexedDB"in self&&indexedDB!==null}function r(){return new Promise(function(A,w){try{var C=!0,D="validate-browser-context-for-indexeddb-analytics-module",y=window.indexedDB.open(D);y.onsuccess=function(){y.result.close(),C||window.indexedDB.deleteDatabase(D),A(!0)},y.onupgradeneeded=function(){C=!1},y.onerror=function(){var T;w(((T=y.error)===null||T===void 0?void 0:T.message)||"")}}catch(T){w(T)}})}function s(){return!navigator||!navigator.cookieEnabled?!1:!0}var h="FirebaseError",m=function(A){a.__extends(w,A);function w(C,D){var y=A.call(this,D)||this;return y.code=C,y.name=h,Object.setPrototypeOf(y,w.prototype),Error.captureStackTrace&&Error.captureStackTrace(y,l.prototype.create),y}return w}(Error),l=function(){function A(w,C,D){this.service=w,this.serviceName=C,this.errors=D}return A.prototype.create=function(w){for(var C=[],D=1;D<arguments.length;D++)C[D-1]=arguments[D];for(var y=C[0]||{},T=this.service+"/"+w,$=this.errors[w],ha=$?p($,y):"Error",ga=this.serviceName+": "+ha+" ("+T+").",ka=new m(T,ga),Ya=0,Va=Object.keys(y);Ya<Va.length;Ya++){var Ia=Va[Ya];Ia.slice(-1)!=="_"&&(Ia in ka&&console.warn('Overwriting FirebaseError base field "'+Ia+'" can cause unexpected behavior.'),ka[Ia]=y[Ia])}return ka},A}();function p(A,w){return A.replace(v,function(C,D){var y=w[D];return y!=null?String(y):"<"+D+"?>"})}var v=/\{\$([^}]+)}/g;function o(A){return JSON.parse(A)}function E(A){return JSON.stringify(A)}var G=function(A){var w={},C={},D={},y="";try{var T=A.split(".");w=o(i(T[0])||""),C=o(i(T[1])||""),y=T[2],D=C.d||{},delete C.d}catch($){}return{header:w,claims:C,data:D,signature:y}},Y=function(A){var w=G(A).claims,C=Math.floor(new Date().getTime()/1e3),D=0,y=0;return typeof w==="object"&&(w.hasOwnProperty("nbf")?D=w.nbf:w.hasOwnProperty("iat")&&(D=w.iat),w.hasOwnProperty("exp")?y=w.exp:y=D+86400),!!C&&!!D&&!!y&&C>=D&&C<=y},B=function(A){var w=G(A).claims;return typeof w==="object"&&w.hasOwnProperty("iat")?w.iat:null},Z=function(A){var w=G(A),C=w.claims;return!!C&&typeof C==="object"&&C.hasOwnProperty("iat")},O=function(A){var w=G(A).claims;return typeof w==="object"&&w.admin===!0};function F(A,w){return Object.prototype.hasOwnProperty.call(A,w)}function L(A,w){return Object.prototype.hasOwnProperty.call(A,w)?A[w]:void 0}function W(A){for(var w in A)if(Object.prototype.hasOwnProperty.call(A,w))return!1;return!0}function fa(A,w,C){var D={};for(var y in A)Object.prototype.hasOwnProperty.call(A,y)&&(D[y]=w.call(C,A[y],y,A));return D}function la(A){for(var w=[],C=function(ga,ka){Array.isArray(ka)?ka.forEach(function(Ya){w.push(encodeURIComponent(ga)+"="+encodeURIComponent(Ya))}):w.push(encodeURIComponent(ga)+"="+encodeURIComponent(ka))},D=0,y=Object.entries(A);D<y.length;D++){var T=y[D],$=T[0],ha=T[1];C($,ha)}return w.length?"&"+w.join("&"):""}function ma(A){var w={},C=A.replace(/^\?/,"").split("&");return C.forEach(function(D){if(D){var y=D.split("=");w[y[0]]=y[1]}}),w}var ra=function(){function A(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(var w=1;w<this.blockSize;++w)this.pad_[w]=0;this.reset()}return A.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},A.prototype.compress_=function(w,C){C||(C=0);var D=this.W_;if(typeof w==="string")for(var y=0;y<16;y++)D[y]=w.charCodeAt(C)<<24|w.charCodeAt(C+1)<<16|w.charCodeAt(C+2)<<8|w.charCodeAt(C+3),C+=4;else for(var y=0;y<16;y++)D[y]=w[C]<<24|w[C+1]<<16|w[C+2]<<8|w[C+3],C+=4;for(var y=16;y<80;y++){var T=D[y-3]^D[y-8]^D[y-14]^D[y-16];D[y]=(T<<1|T>>>31)&4294967295}for(var $=this.chain_[0],ha=this.chain_[1],ga=this.chain_[2],ka=this.chain_[3],Ya=this.chain_[4],Va,Ia,y=0;y<80;y++){y<40?y<20?(Va=ka^ha&(ga^ka),Ia=1518500249):(Va=ha^ga^ka,Ia=1859775393):y<60?(Va=ha&ga|ka&(ha|ga),Ia=2400959708):(Va=ha^ga^ka,Ia=3395469782);var T=($<<5|$>>>27)+Va+Ya+Ia+D[y]&4294967295;Ya=ka,ka=ga,ga=(ha<<30|ha>>>2)&4294967295,ha=$,$=T}this.chain_[0]=this.chain_[0]+$&4294967295,this.chain_[1]=this.chain_[1]+ha&4294967295,this.chain_[2]=this.chain_[2]+ga&4294967295,this.chain_[3]=this.chain_[3]+ka&4294967295,this.chain_[4]=this.chain_[4]+Ya&4294967295},A.prototype.update=function(w,C){if(w==null)return;C===void 0&&(C=w.length);for(var D=C-this.blockSize,y=0,T=this.buf_,$=this.inbuf_;y<C;){if($===0)for(;y<=D;)this.compress_(w,y),y+=this.blockSize;if(typeof w==="string")for(;y<C;){T[$]=w.charCodeAt(y),++$,++y;if($===this.blockSize){this.compress_(T),$=0;break}}else for(;y<C;){T[$]=w[y],++$,++y;if($===this.blockSize){this.compress_(T),$=0;break}}}this.inbuf_=$,this.total_+=C},A.prototype.digest=function(){var w=[],C=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var D=this.blockSize-1;D>=56;D--)this.buf_[D]=C&255,C/=256;this.compress_(this.buf_);for(var y=0,D=0;D<5;D++)for(var T=24;T>=0;T-=8)w[y]=this.chain_[D]>>T&255,++y;return w},A}();function X(A,w){var C=new aa(A,w);return C.subscribe.bind(C)}var aa=function(){function A(w,C){var D=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=C,this.task.then(function(){w(D)}).catch(function(y){D.error(y)})}return A.prototype.next=function(w){this.forEachObserver(function(C){C.next(w)})},A.prototype.error=function(w){this.forEachObserver(function(C){C.error(w)}),this.close(w)},A.prototype.complete=function(){this.forEachObserver(function(w){w.complete()}),this.close()},A.prototype.subscribe=function(w,C,D){var y=this,T;if(w===void 0&&C===void 0&&D===void 0)throw new Error("Missing Observer.");ja(w,["next","error","complete"])?T=w:T={next:w,error:C,complete:D},T.next===void 0&&(T.next=R),T.error===void 0&&(T.error=R),T.complete===void 0&&(T.complete=R);var $=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{y.finalError?T.error(y.finalError):T.complete()}catch(ha){}return}),this.observers.push(T),$},A.prototype.unsubscribeOne=function(w){if(this.observers===void 0||this.observers[w]===void 0)return;delete this.observers[w],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this)},A.prototype.forEachObserver=function(w){if(this.finalized)return;for(var C=0;C<this.observers.length;C++)this.sendOne(C,w)},A.prototype.sendOne=function(w,C){var D=this;this.task.then(function(){if(D.observers!==void 0&&D.observers[w]!==void 0)try{C(D.observers[w])}catch(y){typeof console!=="undefined"&&console.error&&console.error(y)}})},A.prototype.close=function(w){var C=this;if(this.finalized)return;this.finalized=!0,w!==void 0&&(this.finalError=w),this.task.then(function(){C.observers=void 0,C.onNoObservers=void 0})},A}();function ia(A,w){return function(){for(var C=[],D=0;D<arguments.length;D++)C[D]=arguments[D];Promise.resolve(!0).then(function(){A.apply(void 0,C)}).catch(function(y){w&&w(y)})}}function ja(A,w){if(typeof A!=="object"||A===null)return!1;for(var C=0,D=w;C<D.length;C++){var y=D[C];if(y in A&&typeof A[y]==="function")return!0}return!1}function R(){}var V=function(A,w,C,D){var y;D<w?y="at least "+w:D>C&&(y=C===0?"none":"no more than "+C);if(y){var T=A+" failed: Was called with "+D+(D===1?" argument.":" arguments.")+" Expects "+y+".";throw new Error(T)}};function ea(A,w,C){var D="";switch(w){case 1:D=C?"first":"First";break;case 2:D=C?"second":"Second";break;case 3:D=C?"third":"Third";break;case 4:D=C?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var y=A+" failed: ";return y+=D+" argument ",y}function U(A,w,C,D){if(D&&!C)return;if(typeof C!=="string")throw new Error(ea(A,w,D)+"must be a valid firebase namespace.")}function ba(A,w,C,D){if(D&&!C)return;if(typeof C!=="function")throw new Error(ea(A,w,D)+"must be a valid function.")}function na(A,w,C,D){if(D&&!C)return;if(typeof C!=="object"||C===null)throw new Error(ea(A,w,D)+"must be a valid context object.")}var sa=function(A){for(var w=[],C=0,D=0;D<A.length;D++){var y=A.charCodeAt(D);if(y>=55296&&y<=56319){var T=y-55296;D++,c(D<A.length,"Surrogate pair missing trail surrogate.");var $=A.charCodeAt(D)-56320;y=65536+(T<<10)+$}y<128?w[C++]=y:y<2048?(w[C++]=y>>6|192,w[C++]=y&63|128):y<65536?(w[C++]=y>>12|224,w[C++]=y>>6&63|128,w[C++]=y&63|128):(w[C++]=y>>18|240,w[C++]=y>>12&63|128,w[C++]=y>>6&63|128,w[C++]=y&63|128)}return w},Aa=function(A){for(var w=0,C=0;C<A.length;C++){var D=A.charCodeAt(C);D<128?w++:D<2048?w+=2:D>=55296&&D<=56319?(w+=4,C++):w+=3}return w};S.CONSTANTS=b;S.Deferred=q;S.ErrorFactory=l;S.FirebaseError=m;S.Sha1=ra;S.areCookiesEnabled=s;S.assert=c;S.assertionError=d;S.async=ia;S.base64=g;S.base64Decode=i;S.base64Encode=j;S.contains=F;S.createSubscribe=X;S.decode=G;S.deepCopy=k;S.deepExtend=n;S.errorPrefix=ea;S.getUA=t;S.isAdmin=O;S.isBrowser=z;S.isBrowserExtension=H;S.isElectron=I;S.isEmpty=W;S.isIE=N;S.isIndexedDBAvailable=M;S.isMobileCordova=u;S.isNode=x;S.isNodeSdk=P;S.isReactNative=K;S.isSafari=Q;S.isUWP=J;S.isValidFormat=Z;S.isValidTimestamp=Y;S.issuedAtTime=B;S.jsonEval=o;S.map=fa;S.querystring=la;S.querystringDecode=ma;S.safeGet=L;S.stringLength=Aa;S.stringToByteArray=sa;S.stringify=E;S.validateArgCount=V;S.validateCallback=ba;S.validateContextObject=na;S.validateIndexedDBOpenable=r;S.validateNamespace=U});var aj=nb(r=>{rc(r,{__assign:()=>c,__asyncDelegator:()=>K,__asyncGenerator:()=>H,__asyncValues:()=>I,__await:()=>z,__awaiter:()=>j,__classPrivateFieldGet:()=>Q,__classPrivateFieldSet:()=>M,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>P,__importStar:()=>J,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>t,__rest:()=>d,__spread:()=>u,__spreadArrays:()=>x,__values:()=>q});var a=function(h,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,p){l.__proto__=p}||function(l,p){for(var v in p)p.hasOwnProperty(v)&&(l[v]=p[v])},a(h,m)};function b(h,m){a(h,m);function l(){this.constructor=h}h.prototype=m===null?Object.create(m):(l.prototype=m.prototype,new l())}var c=function(){return c=Object.assign||function h(m){for(var l,p=1,v=arguments.length;p<v;p++){l=arguments[p];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(m[o]=l[o])}return m},c.apply(this,arguments)};function d(h,m){var l={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&m.indexOf(p)<0&&(l[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var v=0,p=Object.getOwnPropertySymbols(h);v<p.length;v++)m.indexOf(p[v])<0&&Object.prototype.propertyIsEnumerable.call(h,p[v])&&(l[p[v]]=h[p[v]]);return l}function e(h,m,l,p){var v=arguments.length,o=v<3?m:p===null?p=Object.getOwnPropertyDescriptor(m,l):p,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(h,m,l,p);else for(var G=h.length-1;G>=0;G--)(E=h[G])&&(o=(v<3?E(o):v>3?E(m,l,o):E(m,l))||o);return v>3&&o&&Object.defineProperty(m,l,o),o}function f(h,m){return function(l,p){m(l,p,h)}}function g(h,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,m)}function j(h,m,l,p){function v(o){return o instanceof l?o:new l(function(E){E(o)})}return new(l||(l=Promise))(function(o,E){function G(Z){try{B(p.next(Z))}catch(O){E(O)}}function Y(Z){try{B(p.throw(Z))}catch(O){E(O)}}function B(Z){Z.done?o(Z.value):v(Z.value).then(G,Y)}B((p=p.apply(h,m||[])).next())})}function i(h,m){var l={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},p,v,o,E;return E={next:G(0),throw:G(1),return:G(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function G(B){return function(Z){return Y([B,Z])}}function Y(B){if(p)throw new TypeError("Generator is already executing.");for(;l;)try{if(p=1,v&&(o=B[0]&2?v.return:B[0]?v.throw||((o=v.return)&&o.call(v),0):v.next)&&!(o=o.call(v,B[1])).done)return o;(v=0,o)&&(B=[B[0]&2,o.value]);switch(B[0]){case 0:case 1:o=B;break;case 4:return l.label++,{value:B[1],done:!1};case 5:l.label++,v=B[1],B=[0];continue;case 7:B=l.ops.pop(),l.trys.pop();continue;default:if(!(o=l.trys,o=o.length>0&&o[o.length-1])&&(B[0]===6||B[0]===2)){l=0;continue}if(B[0]===3&&(!o||B[1]>o[0]&&B[1]<o[3])){l.label=B[1];break}if(B[0]===6&&l.label<o[1]){l.label=o[1],o=B;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(B);break}o[2]&&l.ops.pop(),l.trys.pop();continue}B=m.call(h,l)}catch(Z){B=[6,Z],v=0}finally{p=o=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}}function k(h,m,l,p){p===void 0&&(p=l),h[p]=m[l]}function n(h,m){for(var l in h)l!=="default"&&!m.hasOwnProperty(l)&&(m[l]=h[l])}function q(h){var m=typeof Symbol==="function"&&Symbol.iterator,l=m&&h[m],p=0;if(l)return l.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function t(h,m){var l=typeof Symbol==="function"&&h[Symbol.iterator];if(!l)return h;var p=l.call(h),v,o=[],E;try{for(;(m===void 0||m-- >0)&&!(v=p.next()).done;)o.push(v.value)}catch(G){E={error:G}}finally{try{v&&!v.done&&(l=p.return)&&l.call(p)}finally{if(E)throw E.error}}return o}function u(){for(var h=[],m=0;m<arguments.length;m++)h=h.concat(t(arguments[m]));return h}function x(){for(var h=0,m=0,l=arguments.length;m<l;m++)h+=arguments[m].length;for(var p=Array(h),v=0,m=0;m<l;m++)for(var o=arguments[m],E=0,G=o.length;E<G;E++,v++)p[v]=o[E];return p}function z(h){return this instanceof z?(this.v=h,this):new z(h)}function H(h,m,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=l.apply(h,m||[]),v,o=[];return v={},E("next"),E("throw"),E("return"),v[Symbol.asyncIterator]=function(){return this},v;function E(F){p[F]&&(v[F]=function(L){return new Promise(function(W,fa){o.push([F,L,W,fa])>1||G(F,L)})})}function G(F,L){try{Y(p[F](L))}catch(W){O(o[0][3],W)}}function Y(F){F.value instanceof z?Promise.resolve(F.value.v).then(B,Z):O(o[0][2],F)}function B(F){G("next",F)}function Z(F){G("throw",F)}function O(F,L){(F(L),o.shift(),o.length)&&G(o[0][0],o[0][1])}}function K(h){var m,l;return m={},p("next"),p("throw",function(v){throw v}),p("return"),m[Symbol.iterator]=function(){return this},m;function p(v,o){m[v]=h[v]?function(E){return(l=!l)?{value:z(h[v](E)),done:v==="return"}:o?o(E):E}:o}}function I(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=h[Symbol.asyncIterator],l;return m?m.call(h):(h=typeof q==="function"?q(h):h[Symbol.iterator](),l={},p("next"),p("throw"),p("return"),l[Symbol.asyncIterator]=function(){return this},l);function p(o){l[o]=h[o]&&function(E){return new Promise(function(G,Y){E=h[o](E),v(G,Y,E.done,E.value)})}}function v(o,E,G,Y){Promise.resolve(Y).then(function(B){o({value:B,done:G})},E)}}function N(h,m){return Object.defineProperty?Object.defineProperty(h,"raw",{value:m}):h.raw=m,h}function J(h){if(h&&h.__esModule)return h;var m={};if(h!=null)for(var l in h)Object.hasOwnProperty.call(h,l)&&(m[l]=h[l]);return m.default=h,m}function P(h){return h&&h.__esModule?h:{default:h}}function Q(h,m){if(!m.has(h))throw new TypeError("attempted to get private field on non-instance");return m.get(h)}function M(h,m,l){if(!m.has(h))throw new TypeError("attempted to set private field on non-instance");return m.set(h,l),l}});var $i=nb(i=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=aj(),b=Of(),c=function(){function n(q,t,u){this.name=q,this.instanceFactory=t,this.type=u,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return n.prototype.setInstantiationMode=function(q){return this.instantiationMode=q,this},n.prototype.setMultipleInstances=function(q){return this.multipleInstances=q,this},n.prototype.setServiceProps=function(q){return this.serviceProps=q,this},n}();var d="[DEFAULT]";var e=function(){function n(q,t){this.name=q,this.container=t,this.component=null,this.instances=new Map(),this.instancesDeferred=new Map()}return n.prototype.get=function(q){q===void 0&&(q=d);var t=this.normalizeInstanceIdentifier(q);if(!this.instancesDeferred.has(t)){var u=new b.Deferred();this.instancesDeferred.set(t,u);try{var x=this.getOrInitializeService(t);x&&u.resolve(x)}catch(z){}}return this.instancesDeferred.get(t).promise},n.prototype.getImmediate=function(q){var t=a.__assign({identifier:d,optional:!1},q),u=t.identifier,x=t.optional,z=this.normalizeInstanceIdentifier(u);try{var H=this.getOrInitializeService(z);if(!H){if(x)return null;throw Error("Service "+this.name+" is not available")}return H}catch(K){if(x)return null;throw K}},n.prototype.getComponent=function(){return this.component},n.prototype.setComponent=function(q){var t,u;if(q.name!==this.name)throw Error("Mismatching Component "+q.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");this.component=q;if(g(q))try{this.getOrInitializeService(d)}catch(P){}try{for(var x=a.__values(this.instancesDeferred.entries()),z=x.next();!z.done;z=x.next()){var H=a.__read(z.value,2),K=H[0],I=H[1],N=this.normalizeInstanceIdentifier(K);try{var J=this.getOrInitializeService(N);I.resolve(J)}catch(P){}}}catch(P){t={error:P}}finally{try{z&&!z.done&&(u=x.return)&&u.call(x)}finally{if(t)throw t.error}}},n.prototype.clearInstance=function(q){q===void 0&&(q=d),this.instancesDeferred.delete(q),this.instances.delete(q)},n.prototype.delete=function(){return a.__awaiter(this,void 0,void 0,function(){var q;return a.__generator(this,function(t){switch(t.label){case 0:return q=Array.from(this.instances.values()),[4,Promise.all(q.filter(function(u){return"INTERNAL"in u}).map(function(u){return u.INTERNAL.delete()}))];case 1:return t.sent(),[2]}})})},n.prototype.isComponentSet=function(){return this.component!=null},n.prototype.getOrInitializeService=function(q){var t=this.instances.get(q);return!t&&this.component&&(t=this.component.instanceFactory(this.container,f(q)),this.instances.set(q,t)),t||null},n.prototype.normalizeInstanceIdentifier=function(q){return this.component?this.component.multipleInstances?q:d:q},n}();function f(n){return n===d?void 0:n}function g(n){return n.instantiationMode==="EAGER"}var j=function(){function n(q){this.name=q,this.providers=new Map()}return n.prototype.addComponent=function(q){var t=this.getProvider(q.name);if(t.isComponentSet())throw new Error("Component "+q.name+" has already been registered with "+this.name);t.setComponent(q)},n.prototype.addOrOverwriteComponent=function(q){var t=this.getProvider(q.name);t.isComponentSet()&&this.providers.delete(q.name),this.addComponent(q)},n.prototype.getProvider=function(q){if(this.providers.has(q))return this.providers.get(q);var t=new e(q,this);return this.providers.set(q,t),t},n.prototype.getProviders=function(){return Array.from(this.providers.values())},n}();i.Component=c;i.ComponentContainer=j;i.Provider=e});var bj=nb(q=>{rc(q,{LogLevel:()=>d,Logger:()=>i,setLogLevel:()=>k,setUserLogHandler:()=>n});function a(){for(var u=0,x=0,z=arguments.length;x<z;x++)u+=arguments[x].length;for(var H=Array(u),K=0,x=0;x<z;x++)for(var I=arguments[x],N=0,J=I.length;N<J;N++,K++)H[K]=I[N];return H}var b,c=[],d;(function(u){u[u.DEBUG=0]="DEBUG",u[u.VERBOSE=1]="VERBOSE",u[u.INFO=2]="INFO",u[u.WARN=3]="WARN",u[u.ERROR=4]="ERROR",u[u.SILENT=5]="SILENT"})(d||(d={}));var e={debug:d.DEBUG,verbose:d.VERBOSE,info:d.INFO,warn:d.WARN,error:d.ERROR,silent:d.SILENT},f=d.INFO,g=(b={},b[d.DEBUG]="log",b[d.VERBOSE]="log",b[d.INFO]="info",b[d.WARN]="warn",b[d.ERROR]="error",b),j=function(u,x){for(var z=[],H=2;H<arguments.length;H++)z[H-2]=arguments[H];if(x<u.logLevel)return;var K=new Date().toISOString(),I=g[x];if(I)console[I].apply(console,a(["["+K+"]  "+u.name+":"],z));else throw new Error("Attempted to log a message with an invalid logType (value: "+x+")")},i=function(){function u(x){this.name=x,this._logLevel=f,this._logHandler=j,this._userLogHandler=null,c.push(this)}return Object.defineProperty(u.prototype,"logLevel",{get:function(){return this._logLevel},set:function(x){if(!(x in d))throw new TypeError('Invalid value "'+x+'" assigned to `logLevel`');this._logLevel=x},enumerable:!1,configurable:!0}),u.prototype.setLogLevel=function(x){this._logLevel=typeof x==="string"?e[x]:x},Object.defineProperty(u.prototype,"logHandler",{get:function(){return this._logHandler},set:function(x){if(typeof x!=="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=x},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(x){this._userLogHandler=x},enumerable:!1,configurable:!0}),u.prototype.debug=function(){for(var x=[],z=0;z<arguments.length;z++)x[z]=arguments[z];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.DEBUG],x)),this._logHandler.apply(this,a([this,d.DEBUG],x))},u.prototype.log=function(){for(var x=[],z=0;z<arguments.length;z++)x[z]=arguments[z];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.VERBOSE],x)),this._logHandler.apply(this,a([this,d.VERBOSE],x))},u.prototype.info=function(){for(var x=[],z=0;z<arguments.length;z++)x[z]=arguments[z];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.INFO],x)),this._logHandler.apply(this,a([this,d.INFO],x))},u.prototype.warn=function(){for(var x=[],z=0;z<arguments.length;z++)x[z]=arguments[z];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.WARN],x)),this._logHandler.apply(this,a([this,d.WARN],x))},u.prototype.error=function(){for(var x=[],z=0;z<arguments.length;z++)x[z]=arguments[z];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.ERROR],x)),this._logHandler.apply(this,a([this,d.ERROR],x))},u}();function k(u){c.forEach(function(x){x.setLogLevel(u)})}function n(u,x){for(var z=function(N){var J=null;x&&x.level&&(J=e[x.level]),u===null?N.userLogHandler=null:N.userLogHandler=function(P,Q){for(var M=[],r=2;r<arguments.length;r++)M[r-2]=arguments[r];var s=M.map(function(h){if(h==null)return null;{if(typeof h==="string")return h;{if(typeof h==="number"||typeof h==="boolean")return h.toString();{if(h instanceof Error)return h.message;try{return JSON.stringify(h)}catch(m){return null}}}}}).filter(function(h){return h}).join(" ");Q>=(J!==null&&J!==void 0?J:P.logLevel)&&u({level:d[Q].toLowerCase(),message:s,args:M,type:P.name})}},H=0,K=c;H<K.length;H++){var I=K[H];z(I)}}});var Zi=nb(B=>{"use strict";Object.defineProperty(B,"__esModule",{value:!0});var a=_i(),b=Of(),c=$i(),d=bj();var e,f=(e={},e["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",e["bad-app-name"]="Illegal App name: '{$appName}",e["duplicate-app"]="Firebase App named '{$appName}' already exists",e["app-deleted"]="Firebase App named '{$appName}' already deleted",e["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",e["invalid-log-argument"]="First argument to `onLog` must be null or a function.",e),g=new b.ErrorFactory("app","Firebase",f),j="@firebase/app",i="0.6.10",k="@firebase/analytics",n="@firebase/auth",q="@firebase/database",t="@firebase/functions",u="@firebase/installations",x="@firebase/messaging",z="@firebase/performance",H="@firebase/remote-config",K="@firebase/storage",I="@firebase/firestore",N="firebase-wrapper";var J,P="[DEFAULT]",Q=(J={},J[j]="fire-core",J[k]="fire-analytics",J[n]="fire-auth",J[q]="fire-rtdb",J[t]="fire-fn",J[u]="fire-iid",J[x]="fire-fcm",J[z]="fire-perf",J[H]="fire-rc",J[K]="fire-gcs",J[I]="fire-fst",J["fire-js"]="fire-js",J[N]="fire-js-all",J);var M=new d.Logger("@firebase/app");var r=function(){function O(F,L,W){var fa,la,ma=this;this.firebase_=W,this.isDeleted_=!1,this.name_=L.name,this.automaticDataCollectionEnabled_=L.automaticDataCollectionEnabled||!1,this.options_=b.deepCopy(F),this.container=new c.ComponentContainer(L.name),this._addComponent(new c.Component("app",function(){return ma},"PUBLIC"));try{for(var ra=a.__values(this.firebase_.INTERNAL.components.values()),X=ra.next();!X.done;X=ra.next()){var aa=X.value;this._addComponent(aa)}}catch(ia){fa={error:ia}}finally{try{X&&!X.done&&(la=ra.return)&&la.call(ra)}finally{if(fa)throw fa.error}}}return Object.defineProperty(O.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(F){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=F},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),O.prototype.delete=function(){var F=this;return new Promise(function(L){F.checkDestroyed_(),L()}).then(function(){return F.firebase_.INTERNAL.removeApp(F.name_),Promise.all(F.container.getProviders().map(function(L){return L.delete()}))}).then(function(){F.isDeleted_=!0})},O.prototype._getService=function(F,L){return L===void 0&&(L=P),this.checkDestroyed_(),this.container.getProvider(F).getImmediate({identifier:L})},O.prototype._removeServiceInstance=function(F,L){L===void 0&&(L=P),this.container.getProvider(F).clearInstance(L)},O.prototype._addComponent=function(F){try{this.container.addComponent(F)}catch(L){M.debug("Component "+F.name+" failed to register with FirebaseApp "+this.name,L)}},O.prototype._addOrOverwriteComponent=function(F){this.container.addOrOverwriteComponent(F)},O.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw g.create("app-deleted",{appName:this.name_})},O}();r.prototype.name&&r.prototype.options||r.prototype.delete||console.log("dc");var s="7.18.0";function h(O){var F={},L=new Map(),W={__esModule:!0,initializeApp:ma,app:la,registerVersion:aa,setLogLevel:d.setLogLevel,onLog:ia,apps:null,SDK_VERSION:s,INTERNAL:{registerComponent:X,removeApp:fa,components:L,useAsService:ja}};W.default=W,Object.defineProperty(W,"apps",{get:ra});function fa(R){delete F[R]}function la(R){R=R||P;if(!b.contains(F,R))throw g.create("no-app",{appName:R});return F[R]}la.App=O;function ma(R,V){V===void 0&&(V={});if(typeof V!=="object"||V===null){var ea=V;V={name:ea}}var U=V;U.name===void 0&&(U.name=P);var ba=U.name;if(typeof ba!=="string"||!ba)throw g.create("bad-app-name",{appName:String(ba)});if(b.contains(F,ba))throw g.create("duplicate-app",{appName:ba});var na=new O(R,U,W);return F[ba]=na,na}function ra(){return Object.keys(F).map(function(R){return F[R]})}function X(R){var V,ea,U=R.name;if(L.has(U))return M.debug("There were multiple attempts to register component "+U+"."),R.type==="PUBLIC"?W[U]:null;L.set(U,R);if(R.type==="PUBLIC"){var ba=function(S){S===void 0&&(S=la());if(typeof S[U]!=="function")throw g.create("invalid-app-argument",{appName:U});return S[U]()};R.serviceProps!==void 0&&b.deepExtend(ba,R.serviceProps),W[U]=ba,O.prototype[U]=function(){for(var S=[],Ba=0;Ba<arguments.length;Ba++)S[Ba]=arguments[Ba];var A=this._getService.bind(this,U);return A.apply(this,R.multipleInstances?S:[])}}try{for(var na=a.__values(Object.keys(F)),sa=na.next();!sa.done;sa=na.next()){var Aa=sa.value;F[Aa]._addComponent(R)}}catch(S){V={error:S}}finally{try{sa&&!sa.done&&(ea=na.return)&&ea.call(na)}finally{if(V)throw V.error}}return R.type==="PUBLIC"?W[U]:null}function aa(R,V,ea){var U,ba=(U=Q[R])!==null&&U!==void 0?U:R;ea&&(ba+="-"+ea);var na=ba.match(/\s|\//),sa=V.match(/\s|\//);if(na||sa){var Aa=['Unable to register library "'+ba+'" with version "'+V+'":'];na&&Aa.push('library name "'+ba+'" contains illegal characters (whitespace or "/")'),na&&sa&&Aa.push("and"),sa&&Aa.push('version name "'+V+'" contains illegal characters (whitespace or "/")'),M.warn(Aa.join(" "));return}X(new c.Component(ba+"-version",function(){return{library:ba,version:V}},"VERSION"))}function ia(R,V){if(R!==null&&typeof R!=="function")throw g.create("invalid-log-argument",{appName:name});d.setUserLogHandler(R,V)}function ja(R,V){if(V==="serverAuth")return null;var ea=V;return ea}return W}function m(){var O=h(r);O.INTERNAL=a.__assign(a.__assign({},O.INTERNAL),{createFirebaseNamespace:m,extendNamespace:F,createSubscribe:b.createSubscribe,ErrorFactory:b.ErrorFactory,deepExtend:b.deepExtend});function F(L){b.deepExtend(O,L)}return O}var l=m();var p=function(){function O(F){this.container=F}return O.prototype.getPlatformInfoString=function(){var F=this.container.getProviders();return F.map(function(L){if(v(L)){var W=L.getImmediate();return W.library+"/"+W.version}else return null}).filter(function(L){return L}).join(" ")},O}();function v(O){var F=O.getComponent();return(F===null||F===void 0?void 0:F.type)==="VERSION"}function o(O,F){O.INTERNAL.registerComponent(new c.Component("platform-logger",function(L){return new p(L)},"PRIVATE")),O.registerVersion(j,i,F),O.registerVersion("fire-js","")}if(b.isBrowser()&&self.firebase!==void 0){M.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);var E=self.firebase.SDK_VERSION;E&&E.indexOf("LITE")>=0&&M.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}var G=l.initializeApp;l.initializeApp=function(){for(var O=[],F=0;F<arguments.length;F++)O[F]=arguments[F];return b.isNode()&&M.warn(`
      Warning: This is a browser-targeted Firebase bundle but it appears it is being
      run in a Node environment.  If running in a Node environment, make sure you
      are using the bundle specified by the "main" field in package.json.
      
      If you are using Webpack, you can specify "main" as the first item in
      "resolve.mainFields":
      https://webpack.js.org/configuration/resolve/#resolvemainfields
      
      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"
      as the first item in "mainFields", e.g. ['main', 'module'].
      https://github.com/rollup/rollup-plugin-node-resolve
      `),G.apply(void 0,O)};var Y=l;o(Y);B.default=Y;B.firebase=Y});var Na=nb((e,f)=>{"use strict";function a(g){return g&&typeof g==="object"&&"default"in g?g.default:g}var b=a(Zi()),c="firebase",d="7.19.0";b.registerVersion(c,d,"app");f.exports=b});var uo=nb((b,c)=>{var a=function(){function d(k,n){if(!j[k]){j[k]={};for(var q=0;q<k.length;q++)j[k][k.charAt(q)]=q}return j[k][n]}var e=String.fromCharCode,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",j={},i={compressToBase64:function(k){if(null==k)return"";var n=i._compress(k,6,function(q){return f.charAt(q)});switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(k){return null==k?"":""==k?null:i._decompress(k.length,32,function(n){return d(f,k.charAt(n))})},compressToUTF16:function(k){return null==k?"":i._compress(k,15,function(n){return e(n+32)})+" "},decompressFromUTF16:function(k){return null==k?"":""==k?null:i._decompress(k.length,16384,function(n){return k.charCodeAt(n)-32})},compressToUint8Array:function(k){for(var n=i.compress(k),q=new Uint8Array(2*n.length),t=0,u=n.length;u>t;t++){var x=n.charCodeAt(t);q[2*t]=x>>>8,q[2*t+1]=x%256}return q},decompressFromUint8Array:function(k){if(null===k||void 0===k)return i.decompress(k);for(var n=new Array(k.length/2),q=0,t=n.length;t>q;q++)n[q]=256*k[2*q]+k[2*q+1];var u=[];return n.forEach(function(x){u.push(e(x))}),i.decompress(u.join(""))},compressToEncodedURIComponent:function(k){return null==k?"":i._compress(k,6,function(n){return g.charAt(n)})},decompressFromEncodedURIComponent:function(k){return null==k?"":""==k?null:(k=k.replace(/ /g,"+"),i._decompress(k.length,32,function(n){return d(g,k.charAt(n))}))},compress:function(k){return i._compress(k,16,function(n){return e(n)})},_compress:function(k,n,q){if(null==k)return"";var t,u,x,z={},H={},K="",I="",N="",J=2,P=3,Q=2,M=[],r=0,s=0;for(x=0;x<k.length;x+=1)if(K=k.charAt(x),Object.prototype.hasOwnProperty.call(z,K)||(z[K]=P++,H[K]=!0),I=N+K,Object.prototype.hasOwnProperty.call(z,I))N=I;else{if(Object.prototype.hasOwnProperty.call(H,N)){if(N.charCodeAt(0)<256){for(t=0;Q>t;t++)r<<=1,s==n-1?(s=0,M.push(q(r)),r=0):s++;for(u=N.charCodeAt(0),t=0;8>t;t++)r=r<<1|1&u,s==n-1?(s=0,M.push(q(r)),r=0):s++,u>>=1}else{for(u=1,t=0;Q>t;t++)r=r<<1|u,s==n-1?(s=0,M.push(q(r)),r=0):s++,u=0;for(u=N.charCodeAt(0),t=0;16>t;t++)r=r<<1|1&u,s==n-1?(s=0,M.push(q(r)),r=0):s++,u>>=1}J--,0==J&&(J=Math.pow(2,Q),Q++),delete H[N]}else for(u=z[N],t=0;Q>t;t++)r=r<<1|1&u,s==n-1?(s=0,M.push(q(r)),r=0):s++,u>>=1;J--,0==J&&(J=Math.pow(2,Q),Q++),z[I]=P++,N=String(K)}if(""!==N){if(Object.prototype.hasOwnProperty.call(H,N)){if(N.charCodeAt(0)<256){for(t=0;Q>t;t++)r<<=1,s==n-1?(s=0,M.push(q(r)),r=0):s++;for(u=N.charCodeAt(0),t=0;8>t;t++)r=r<<1|1&u,s==n-1?(s=0,M.push(q(r)),r=0):s++,u>>=1}else{for(u=1,t=0;Q>t;t++)r=r<<1|u,s==n-1?(s=0,M.push(q(r)),r=0):s++,u=0;for(u=N.charCodeAt(0),t=0;16>t;t++)r=r<<1|1&u,s==n-1?(s=0,M.push(q(r)),r=0):s++,u>>=1}J--,0==J&&(J=Math.pow(2,Q),Q++),delete H[N]}else for(u=z[N],t=0;Q>t;t++)r=r<<1|1&u,s==n-1?(s=0,M.push(q(r)),r=0):s++,u>>=1;J--,0==J&&(J=Math.pow(2,Q),Q++)}for(u=2,t=0;Q>t;t++)r=r<<1|1&u,s==n-1?(s=0,M.push(q(r)),r=0):s++,u>>=1;for(;;){if(r<<=1,s==n-1){M.push(q(r));break}s++}return M.join("")},decompress:function(k){return null==k?"":""==k?null:i._decompress(k.length,32768,function(n){return k.charCodeAt(n)})},_decompress:function(k,n,q){var t,u,x,z,H,K,I,N,J=[],P=4,Q=4,M=3,r="",s=[],h={val:q(0),position:n,index:1};for(u=0;3>u;u+=1)J[u]=u;for(z=0,K=Math.pow(2,2),I=1;I!=K;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=q(h.index++)),z|=(H>0?1:0)*I,I<<=1;switch(t=z){case 0:for(z=0,K=Math.pow(2,8),I=1;I!=K;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=q(h.index++)),z|=(H>0?1:0)*I,I<<=1;N=e(z);break;case 1:for(z=0,K=Math.pow(2,16),I=1;I!=K;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=q(h.index++)),z|=(H>0?1:0)*I,I<<=1;N=e(z);break;case 2:return""}for(J[3]=N,x=N,s.push(N);;){if(h.index>k)return"";for(z=0,K=Math.pow(2,M),I=1;I!=K;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=q(h.index++)),z|=(H>0?1:0)*I,I<<=1;switch(N=z){case 0:for(z=0,K=Math.pow(2,8),I=1;I!=K;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=q(h.index++)),z|=(H>0?1:0)*I,I<<=1;J[Q++]=e(z),N=Q-1,P--;break;case 1:for(z=0,K=Math.pow(2,16),I=1;I!=K;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=q(h.index++)),z|=(H>0?1:0)*I,I<<=1;J[Q++]=e(z),N=Q-1,P--;break;case 2:return s.join("")}if(0==P&&(P=Math.pow(2,M),M++),J[N])r=J[N];else{if(N!==Q)return null;r=x+x.charAt(0)}s.push(r),J[Q++]=x+r.charAt(0),P--,x=r,0==P&&(P=Math.pow(2,M),M++)}}};return i}();"function"==typeof define&&define.amd?define(function(){return a}):"undefined"!=typeof c&&null!=c&&(c.exports=a)});let hj,ij=0,jj=0;const ta={get:()=>hj,set:a=>{hj=a},getFrame:()=>ij,setFrame:a=>{ij=a},getElapsed:()=>jj,setElapsed:a=>{jj=a}};let nj=0;function Ff(a=0){return()=>{nj=a}}function Jd(){return nj}let Tf="Phaser",Ao="https://phaser4.io",Bo="#fff",Co="linear-gradient(#3e0081 40%, #00bcc3)";function Pf(){if(Tf!==""){const a=ta.get(),b=Tf==="Phaser"?" v"+a.VERSION:"";console.log(`%c${Tf}${b}%c ${Ao}`,`padding: 4px 16px; color: ${Bo}; background: ${Co}`,"")}}let sj=800,tj=600,uj=1;function If(a=800,b=600,c=1){return c===0&&(c=window.devicePixelRatio),()=>{sj=a,tj=b,uj=c}}function Ab(){return sj}function Bb(){return tj}function Cb(){return uj}const jg=[],wc={add:a=>{jg.push(a)},get:()=>jg,clear:()=>{jg.length=0}};let rj;function Kd(a){rj=a}function Qf(){return rj}let Uf=.5,Vf=.5;let oj=0;function Wf(a){oj=a}function Rc(){return oj}function Ld(a){let b;return a&&(typeof a==="string"?b=document.getElementById(a):typeof a==="object"&&a.nodeType===1&&(b=a)),b||(b=document.body),b}let pj;function Gf(a){return()=>{a&&(pj=Ld(a))}}function Rf(){return pj}let qj=[];function Hf(a){return()=>{qj=[].concat(a)}}function Xf(){return qj}let Eo={alpha:!1,antialias:!1,depth:!1,premultipliedAlpha:!1};function Yf(){return Eo}class Jj{constructor(a){this.stack=[],this.current=null,this.renderer=a}reset(){this.stack=[],this.current=null;const a=this.renderer,b=a.gl;b.bindFramebuffer(b.FRAMEBUFFER,null),b.viewport(0,0,a.width,a.height)}add(a,b=!0,c=0,d=0){this.stack.push({framebuffer:a,width:c,height:d}),this.set(a,b,c,d)}set(a,b=!0,c=0,d=0){const e=this.renderer,f=e.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),b&&(f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),c>0&&f.viewport(0,0,c,d),this.current=a}pop(){this.stack.pop();const a=this.stack.length;if(a>0){const b=this.stack[a-1];this.set(b.framebuffer,!1,b.width,b.height)}else this.reset()}rebind(){const a=this.renderer.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.current)}destroy(){this.stack=[]}}let Ij;const ya={get:()=>Ij,set:a=>{Ij=a}};function Kj(a,b=[]){const c=a>>16&255,d=a>>8&255,e=a&255,f=a>16777215?a>>>24:255;return b[0]=c/255,b[1]=d/255,b[2]=e/255,b[3]=f/255,b}function Fj(a,b){return a.a===b.a&&a.b===b.b&&a.c===b.c&&a.d===b.d&&a.tx===b.tx&&a.ty===b.ty}function Ud(a,b){const c=ya.get();b||(b=c.COLOR_ATTACHMENT0);const d=c.createFramebuffer();return c.bindFramebuffer(c.FRAMEBUFFER,d),c.framebufferTexture2D(c.FRAMEBUFFER,b,c.TEXTURE_2D,a,0),c.bindFramebuffer(c.FRAMEBUFFER,null),d}function Zd(a){const b=ya.get();if(!b)return;const{parent:c,flipY:d,unpackPremultiplyAlpha:e,minFilter:f,magFilter:g,wrapS:j,wrapT:i,generateMipmap:k,isPOT:n}=a,q=c.image;let t=c.width,u=c.height;const x=b.createTexture();return b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,x),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,d),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),q?(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,q),t=q.width,u=q.height):b.texImage2D(b.TEXTURE_2D,0,b.RGBA,t,u,0,b.RGBA,b.UNSIGNED_BYTE,null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,g),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,j),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,i),k&&n&&b.generateMipmap(b.TEXTURE_2D),a.texture=x,x}function Vb(a){const b=ya.get();b&&b.isFramebuffer(a)&&b.deleteFramebuffer(a)}function kg(a){const b=ya.get();if(!b)return;b.isTexture(a)&&b.deleteTexture(a)}function Gj(a,b){return a<1||b<1?!1:(a&a-1)===0&&(b&b-1)===0}function Tj(a,b=!0){const c=ya.get();c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,a);const d=b?c.LINEAR:c.NEAREST;c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,d),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,d)}function Uj(a){const b=ya.get(),c=a.parent.image,d=c.width,e=c.height;return d>0&&e>0&&(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,a.texture),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,a.flipY),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,c)),a.texture}class vc{constructor(a,b={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1;const c=ya.get();this.parent=a,this.isPOT=Gj(a.width,a.height);const{texture:d=null,framebuffer:e=null,unpackPremultiplyAlpha:f=!0,minFilter:g=c.LINEAR,magFilter:j=c.LINEAR,wrapS:i=c.CLAMP_TO_EDGE,wrapT:k=c.CLAMP_TO_EDGE,generateMipmap:n=this.isPOT,flipY:q=!1}=b;this.minFilter=g,this.magFilter=j,this.wrapS=i,this.wrapT=k,this.generateMipmap=n,this.flipY=q,this.unpackPremultiplyAlpha=f,e&&(this.framebuffer=e),d?this.texture=d:Zd(this)}setFilter(a){this.texture&&Tj(this.texture,a)}create(){const a=this.texture;return a&&kg(a),Zd(this)}update(){const a=this.texture;return a?Uj(this):Zd(this)}setIndex(a){this.dirtyIndex=a!==this.index,this.index=a}destroy(){kg(this.texture),Vb(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}}class Qj{constructor(a,b,c,d,e){this.batchSize=a,this.dataSize=b,this.indexSize=c,this.vertexElementSize=d,this.quadIndexSize=e,this.vertexByteSize=d*b,this.quadByteSize=this.vertexByteSize*4,this.quadElementSize=d*4,this.bufferByteSize=a*this.quadByteSize,this.create()}create(){let a=[];for(let c=0;c<this.batchSize*this.indexSize;c+=this.indexSize)a.push(c+0,c+1,c+2,c+2,c+3,c+0);this.data=new ArrayBuffer(this.bufferByteSize),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const b=ya.get();this.vertexBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.data,b.DYNAMIC_DRAW),this.indexBuffer=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.index,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,null),a=[]}destroy(){}}class lg{constructor(a,b,c,d,e,f){this.trimmed=!1,this.texture=a,this.key=b,this.x=c,this.y=d,this.width=e,this.height=f,this.sourceSizeWidth=e,this.sourceSizeHeight=f,this.updateUVs()}setPivot(a,b){this.pivot={x:a,y:b}}setSize(a,b){this.width=a,this.height=b,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.updateUVs()}setSourceSize(a,b){this.sourceSizeWidth=a,this.sourceSizeHeight=b}setTrim(a,b,c,d,e,f){this.trimmed=!0,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.spriteSourceSizeX=c,this.spriteSourceSizeY=d,this.spriteSourceSizeWidth=e,this.spriteSourceSizeHeight=f}getExtent(a,b){const c=this.sourceSizeWidth,d=this.sourceSizeHeight;let e,f,g,j;return this.trimmed?(e=this.spriteSourceSizeX-a*c,f=e+this.spriteSourceSizeWidth,g=this.spriteSourceSizeY-b*d,j=g+this.spriteSourceSizeHeight):(e=-a*c,f=e+c,g=-b*d,j=g+d),{left:e,right:f,top:g,bottom:j}}setExtent(a){const b=a.transform,c=b.origin.x,d=b.origin.y,e=this.sourceSizeWidth,f=this.sourceSizeHeight;let g,j,i,k;this.trimmed?(g=this.spriteSourceSizeX-c*e,j=this.spriteSourceSizeY-d*f,i=this.spriteSourceSizeWidth,k=this.spriteSourceSizeHeight):(g=-c*e,j=-d*f,i=e,k=f),b.setExtent(g,j,i,k)}updateUVs(){const{x:a,y:b,width:c,height:d}=this,e=this.texture.width,f=this.texture.height;this.u0=a/e,this.v0=b/f,this.u1=(a+c)/e,this.v1=(b+d)/f}}class Ka{constructor(a,b,c){this.key="",a&&(b=a.width,c=a.height),this.image=a,this.width=b,this.height=c,this.frames=new Map(),this.data={},this.addFrame("__BASE",0,0,b,c),wc.add(this)}addFrame(a,b,c,d,e){if(this.frames.has(a))return null;const f=new lg(this,a,b,c,d,e);return this.frames.set(a,f),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=f),f}getFrame(a){if(!a)return this.firstFrame;a instanceof lg&&(a=a.key);let b=this.frames.get(a);return b||(console.warn(`Frame missing: ${a}`),b=this.firstFrame),b}setSize(a,b){this.width=a,this.height=b;const c=this.frames.get("__BASE");c.setSize(a,b)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}}let Pj;const _c={get:()=>Pj,set:a=>{Pj=a}};const Sj={fragmentShader:`\r
#define SHADER_NAME SINGLE_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture;\r
\r
void main (void)\r
{\r
    vec4 color = texture2D(uTexture, vTextureCoord);\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`,vertexShader:`\r
#define SHADER_NAME SINGLE_QUAD_VERT\r
\r
precision highp float;\r
\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
attribute float aTextureId;\r
attribute vec4 aTintColor;\r
\r
uniform mat4 uProjectionMatrix;\r
uniform mat4 uCameraMatrix;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
void main (void)\r
{\r
    vTextureCoord = aTextureCoord;\r
    vTextureId = aTextureId;\r
    vTintColor = aTintColor;\r
\r
    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\r
}`};class Yd{constructor(a={}){this.attribs={aVertexPosition:0,aTextureCoord:0,aTextureId:0,aTintColor:0},this.uniforms={uProjectionMatrix:0,uCameraMatrix:0,uTexture:0,uTime:0,uResolution:0},this.renderToFBO=!1,this.renderer=_c.get();const{batchSize:b=4096,dataSize:c=4,indexSize:d=4,vertexElementSize:e=6,quadIndexSize:f=6,fragmentShader:g=Sj.fragmentShader,vertexShader:j=Sj.vertexShader,width:i=Ab(),height:k=Bb(),resolution:n=Cb(),renderToFBO:q=!1}=a;this.buffer=new Qj(b,c,d,e,f),this.createShaders(g,j),this.count=0,this.renderToFBO=q;const t=new Ka(null,i*n,k*n),u=new vc(t);t.binding=u,u.framebuffer=Ud(u.texture),this.texture=t,this.framebuffer=u.framebuffer}createShaders(a,b){const c=this.renderer.gl,d=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(d,a),c.compileShader(d);let e=!1,f=c.getShaderInfoLog(d);f.length>0&&(e=!0,console.error(f));const g=c.createShader(c.VERTEX_SHADER);c.shaderSource(g,b),c.compileShader(g),f=c.getShaderInfoLog(d),f.length>0&&(e=!0,console.error(f));if(e)return;const j=c.createProgram();c.attachShader(j,g),c.attachShader(j,d),c.linkProgram(j),c.useProgram(j),this.program=j;for(const i of Object.keys(this.attribs)){const k=c.getAttribLocation(j,i);c.enableVertexAttribArray(k),this.attribs[i]=k}for(const i of Object.keys(this.uniforms))this.uniforms[i]=c.getUniformLocation(j,i)}bind(a,b,c){if(!this.program)return!1;const d=this.renderer,e=d.gl,f=this.uniforms;return e.useProgram(this.program),e.uniformMatrix4fv(f.uProjectionMatrix,!1,a),e.uniformMatrix4fv(f.uCameraMatrix,!1,b),e.uniform1i(f.uTexture,d.textures.textureIndex[c]),e.uniform1f(f.uTime,performance.now()),e.uniform2f(f.uResolution,d.width,d.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}bindBuffers(a,b){const c=this.renderer.gl,d=this.buffer.vertexByteSize,e=this.attribs;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a),c.bindBuffer(c.ARRAY_BUFFER,b),c.vertexAttribPointer(e.aVertexPosition,2,c.FLOAT,!1,d,0),c.vertexAttribPointer(e.aTextureCoord,2,c.FLOAT,!1,d,8),c.vertexAttribPointer(e.aTextureId,1,c.FLOAT,!1,d,16),c.vertexAttribPointer(e.aTintColor,4,c.UNSIGNED_BYTE,!0,d,20),this.count=0}draw(a){const b=this.renderer,c=b.gl,d=this.buffer;if(a===d.batchSize)c.bufferData(c.ARRAY_BUFFER,d.data,c.DYNAMIC_DRAW);else{const e=d.vertexViewF32.subarray(0,a*d.quadElementSize);c.bufferSubData(c.ARRAY_BUFFER,0,e)}this.renderToFBO&&b.fbo.add(this.framebuffer,!0),c.drawElements(c.TRIANGLES,a*d.quadIndexSize,c.UNSIGNED_SHORT,0),this.renderToFBO&&b.fbo.pop()}flush(){const a=this.count;return a===0?!1:(this.draw(a),this.prevCount=a,this.count=0,!0)}}const So=`\r
#define SHADER_NAME MULTI_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture[%count%];\r
\r
void main (void)\r
{\r
    vec4 color;\r
\r
    %forloop%\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`;class Lj extends Yd{constructor(a={fragmentShader:So}){super(a)}createShaders(a,b){const c=Rc();let d="";for(let e=1;e<c;e++)e>1&&(d+=`
	else `),e<c-1&&(d+=`if (vTextureId < ${e}.5)`),d+=`
	{`,d+=`
		color = texture2D(uTexture[${e}], vTextureCoord);`,d+=`
	}`;a=a.replace(/%count%/gi,`${c}`),a=a.replace(/%forloop%/gi,d),super.createShaders(a,b)}bind(a,b){if(!this.program)return!1;const c=this.renderer,d=c.gl,e=this.uniforms;return d.useProgram(this.program),d.uniformMatrix4fv(e.uProjectionMatrix,!1,a),d.uniformMatrix4fv(e.uCameraMatrix,!1,b),d.uniform1iv(e.uTexture,c.textures.textureIndex),d.uniform1f(e.uTime,performance.now()),d.uniform2f(e.uResolution,c.width,c.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}}function Mj(a,b,c=-1,d=1){const e=-2*(1/-a),f=-2*(1/b),g=2*(1/(c-d));return new Float32Array([e,0,0,0,0,f,0,0,0,0,g,0,-1,1,0,1])}class Nj{constructor(a,b){this.renderer=a;const c={shader:new b()};this.stack=[c],this.currentEntry=c,this.current=c.shader,this.singleQuadShader=new Yd()}add(a,b){const c={shader:a,textureID:b};return this.stack.push(c),c}set(a,b){this.flush();const c=this.renderer,d=c.projectionMatrix,e=c.currentCamera.matrix,f=a.bind(d,e,b);if(f){const g=this.add(a,b);this.currentEntry=g,this.current=a}return f}setDefault(a){this.set(this.singleQuadShader,a)}pop(){this.flush();const a=this.stack;a.length>1&&a.pop(),this.currentEntry=a[a.length-1],this.current=this.currentEntry.shader}reset(){this.pop(),this.rebind()}flush(){return this.current.flush()?(this.renderer.flushTotal++,!0):!1}rebind(){const a=this.renderer,b=a.projectionMatrix,c=a.currentCamera.matrix,d=this.currentEntry;d.shader.bind(b,c,d.textureID)}popAndRebind(){this.pop(),this.rebind()}clear(){}destroy(){}}const Qo=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Ro(a){let b="";for(let c=0;c<a;++c)c>0&&(b+=`
else `),c<a-1&&(b+=`if(test == ${c}.0){}`);return b}function Rj(a,b){const c=b.createShader(b.FRAGMENT_SHADER);for(;;){const d=Qo.replace(/%forloop%/gi,Ro(a));b.shaderSource(c,d),b.compileShader(c);if(!b.getShaderParameter(c,b.COMPILE_STATUS))a=a/2|0;else break}return a}class Oj{constructor(a){this.startActiveTexture=0,this.renderer=a,this.tempTextures=[],this.textureIndex=[]}init(){const a=this.renderer.gl;let b=Rj(a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),a);const c=Rc();c===0||c>0&&c>b?Wf(b):c>0&&c<b&&(b=Math.max(8,c));const d=this.tempTextures;d.length&&d.forEach(f=>{a.deleteTexture(f)});const e=[];for(let f=0;f<b;f++){const g=a.createTexture();a.activeTexture(a.TEXTURE0+f),a.bindTexture(a.TEXTURE_2D,g),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),d[f]=g,e.push(f)}this.maxTextures=b,this.textureIndex=e,this.currentActiveTexture=1}update(){const a=wc.get();for(let b=0;b<a.length;b++){const c=a[b];c.binding||(c.binding=new vc(c))}wc.clear()}reset(){const a=this.renderer.gl,b=this.tempTextures;for(let c=0;c<b.length;c++)a.activeTexture(a.TEXTURE0+c),a.bindTexture(a.TEXTURE_2D,b[c]);this.currentActiveTexture=1,this.startActiveTexture++}bind(a,b=0){const c=this.renderer.gl,d=a.binding;d.setIndex(b),c.activeTexture(c.TEXTURE0+b),c.bindTexture(c.TEXTURE_2D,d.texture)}unbind(a=0){const b=this.renderer.gl;b.activeTexture(b.TEXTURE0+a),b.bindTexture(b.TEXTURE_2D,this.tempTextures[a]),a>0&&this.startActiveTexture++}request(a){const b=this.renderer.gl,c=a.binding,d=this.currentActiveTexture;return c.indexCounter>=this.startActiveTexture?!1:(c.indexCounter=this.startActiveTexture,d<this.maxTextures?(c.setIndex(d),b.activeTexture(b.TEXTURE0+d),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture++):(this.renderer.flush(),this.startActiveTexture++,c.indexCounter=this.startActiveTexture,c.setIndex(1),b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture=2),!0)}}class vj{constructor(){this.clearColor=[0,0,0,1],this.flushTotal=0,this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.currentCamera=null,this.width=Ab(),this.height=Bb(),this.resolution=Cb(),this.setBackgroundColor(Jd());const a=document.createElement("canvas");a.addEventListener("webglcontextlost",b=>this.onContextLost(b),!1),a.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=a,this.fbo=new Jj(this),this.textures=new Oj(this),this.initContext(),_c.set(this),this.shaders=new Nj(this,Lj)}initContext(){const a=this.canvas.getContext("webgl",Yf());ya.set(a),this.gl=a,a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE),this.resize(this.width,this.height,this.resolution),this.textures.init()}resize(a,b,c=1){this.width=a*c,this.height=b*c,this.resolution=c;const d=this.canvas;d.width=this.width,d.height=this.height,this.autoResize&&(d.style.width=(this.width/c).toString()+"px",d.style.height=(this.height/c).toString()+"px"),this.gl.viewport(0,0,this.width,this.height),this.projectionMatrix=Mj(a,b)}onContextLost(a){a.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(a){return Kj(a,this.clearColor),this}reset(a=null,b=this.width,c=this.height){const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),d.viewport(0,0,b,c),d.enable(d.BLEND),d.blendFunc(d.ONE,d.ONE_MINUS_SRC_ALPHA),this.flushTotal=0,this.currentCamera=null,this.textures.update()}render(a){if(this.contextLost)return;this.reset();if(this.optimizeRedraw&&a.numDirtyFrames===0&&a.numDirtyCameras===0)return;const b=this.gl;if(this.clearBeforeRender){const d=this.clearColor;b.clearColor(d[0],d[1],d[2],d[3]),b.clear(b.COLOR_BUFFER_BIT)}const c=a.worldData;for(let d=0;d<c.length;d++){const{camera:e,renderList:f}=c[d];(!this.currentCamera||!Fj(e.worldTransform,this.currentCamera.worldTransform))&&(this.flush(),this.currentCamera=e,this.shaders.rebind()),f.forEach(g=>{g.children.length?this.renderNode(g):g.node.renderGL(this)})}this.flush()}renderNode(a){a.node.renderGL(this),a.children.forEach(b=>{b.children.length>0?this.renderNode(b):b.node.renderGL(this)}),a.node.postRenderGL(this)}flush(){this.shaders.flush()}destroy(){_c.set(void 0)}}function Jf(){return()=>{Kd(vj)}}function xa(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);for(const e of d)e.callback.apply(e.context,c),e.once&&d.delete(e);return d.size===0&&a.events.delete(b),!0}function dj(a,b){const c=Ld(b);return c.appendChild(a),a}function ej(a){const b=document.readyState;if(b==="complete"||b==="interactive"){a();return}const c=()=>{document.removeEventListener("deviceready",c,!0),document.removeEventListener("DOMContentLoaded",c,!0),window.removeEventListener("load",c,!0),a()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",c,!0):(document.addEventListener("DOMContentLoaded",c,!0),window.addEventListener("load",c,!0)):window.setTimeout(c,20)}class Sf{constructor(){this.events=new Map()}}class Uc{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function _a(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new Uc(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function Tb(a,b,c,d=a){return _a(a,b,c,d,!0)}function Vj(){return{gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]}}function Yj(a,b=0){a.gameFrame=b,a.numTotalFrames=0,a.numDirtyFrames=0,a.numDirtyCameras=0,a.worldData.length=0}let Zj;const _d={get:()=>Zj,set:a=>{Zj=a}};class fj{constructor(){this.scenes=new Map(),this.sceneIndex=0,this.flush=!1,this.renderResult=Vj(),this.game=ta.get(),_d.set(this),Tb(this.game,"boot",()=>this.boot())}boot(){Xf().forEach(a=>new a())}update(a,b){for(const c of this.scenes.values())xa(c,"update",a,b)}render(a){const b=this.renderResult;Yj(b,a);for(const c of this.scenes.values())xa(c,"render",b);return this.flush&&(b.numDirtyFrames++,this.flush=!1),b}}function $c(a,b){const c=document.createElement("canvas");return c.width=a,c.height=b,c.getContext("2d")}let _j;const Ea={get:()=>_j,set:a=>{_j=a}};class gj{constructor(){this.textures=new Map(),this.createDefaultTextures(),Ea.set(this)}createDefaultTextures(){this.add("__BLANK",new Ka($c(32,32).canvas));const a=$c(32,32);a.strokeStyle="#0f0",a.moveTo(0,0),a.lineTo(32,32),a.stroke(),a.strokeRect(.5,.5,31,31),this.add("__MISSING",new Ka(a.canvas))}get(a){const b=this.textures;return b.has(a)?b.get(a):b.get("__MISSING")}has(a){return this.textures.has(a)}add(a,b){let c;const d=this.textures;return d.has(a)||(b instanceof Ka?c=b:c=new Ka(b),c.key=a,d.set(a,c)),c}}class Yi extends Sf{constructor(...a){super();this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,ta.set(this),ej(()=>this.boot(a))}boot(a){a.forEach(d=>d());const b=Qf();this.renderer=new b(),this.textureManager=new gj(),this.sceneManager=new fj();const c=Rf();c&&dj(this.renderer.canvas,c),this.isBooted=!0,Pf(),xa(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(a){const b=a-this.lastTick;this.lastTick=a,this.elapsed+=b,this.isPaused||(this.willUpdate&&(this.sceneManager.update(b,a),xa(this,"update",b,a)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,ta.setFrame(this.frame),ta.setElapsed(this.elapsed),requestAnimationFrame(c=>this.step(c))}destroy(){}}function Wj(a,b,c){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:c}function Xj(a,b={}){const c=_d.get(),d=c.scenes.size,e=c.sceneIndex,f=d===0;typeof b==="string"?a.key=b:(b||!b&&f)&&(a.key=Wj(b,"key","scene"+e.toString())),c.scenes.has(a.key)?console.warn("Scene key already in use: "+a.key):(c.scenes.set(a.key,a),c.flush=!0,c.sceneIndex++)}class Hd{constructor(a){this.game=ta.get(),this.events=new Map(),Xj(this,a)}}function Sb(a){const b=[a],c=[];for(;b.length>0;){const d=b.shift();c.push(d);const e=d.numChildren;if(e>0)for(let f=e-1;f>=0;f--)b.unshift(d.children[f])}return c.shift(),c}function pb(a,b){return a.children.indexOf(b)}function Md(a,b){const c=a.children;let d;if(b>=0&&b<c.length){const e=c.splice(b,1);e[0]&&(d=e[0],d.parent=null)}return d}function Tc(a,b){const c=pb(a,b);return c>-1&&Md(a,c),b}const bg="addedtoworld";const cg="removedfromworld";function ag(a,...b){return b.forEach(c=>{c.world&&(xa(c.world,cg,c,c.world),xa(c,cg,c,c.world)),c.world=a,xa(a,bg,c,a),xa(c,bg,c,a)}),b}function Rb(a,...b){b.forEach(d=>{d.parent&&Tc(d.parent,d),d.parent=a});const c=a.world;return c&&ag(c,...Sb(a)),b}function sc(a,b){return a.children.push(b),Rb(a,b),b.transform.updateWorld(),b}const _={CLEAR:0,TRANSFORM:1,UPDATE:2,CHILD_CACHE:4,POST_RENDER:8,COLORS:16,BOUNDS:32,TEXTURE:64,FRAME:128,ALPHA:256,CHILD:512,DEFAULT:1+2+16+32,USER1:536870912,USER2:1073741824,USER3:2147483648,USER4:4294967296};function Sc(a,b=0,c){const d=a.children;c===void 0&&(c=d.length);const e=c-b;if(e>0&&e<=c){const f=d.splice(b,e);return f.forEach(g=>{g.parent=null}),f}else return[]}function Zf(a,b=0,c){const d=Sc(a,b,c);d.forEach(e=>{e.destroy()})}function _f(a,...b){return b.forEach(c=>{Tc(a,c)}),b}function $f(a,b,c=0,d){const e=Sc(a,c,d);return Rb(b,...e),e.forEach(f=>{f.transform.updateWorld()}),e}class Qb{constructor(a=1,b=0,c=0,d=1,e=0,f=0){this.set(a,b,c,d,e,f)}set(a=1,b=0,c=0,d=1,e=0,f=0){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=e,this.ty=f,this}identity(){return this.set()}toArray(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]}fromArray(a){return this.set(a[0],a[1],a[2],a[3],a[4],a[5])}}function Vd(a,b,c){return a.width<=0||a.height<=0?!1:a.x<=b&&a.x+a.width>=b&&a.y<=c&&a.y+a.height>=c}class Ja{constructor(a=0,b=0,c=0,d=0){this.set(a,b,c,d)}set(a=0,b=0,c=0,d=0){return this.x=a,this.y=b,this.width=c,this.height=d,this}contains(a,b){return Vd(this,a,b)}set right(a){a<=this.x?this.width=0:this.width=a-this.x}get right(){return this.x+this.width}set bottom(a){a<=this.y?this.height=0:this.height=a-this.y}get bottom(){return this.y+this.height}}function Hj(){}class ob{constructor(a,b=0,c=0,d=!1){this.compareValue=!1,this._x=b,this._y=c,this.callback=a,this.compareValue=d}set(a=0,b=0){return this._x=a,this._y=b,this.callback(this),this}destroy(){this.callback=Hj}set x(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._x=a,this.callback(this))}get x(){return this._x}set y(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._y=a,this.callback(this))}get y(){return this._y}}function Ej(a,b,c){const d=c-b;return b+((a-b)%d+d)%d}function kj(a){return Ej(a,-Math.PI,Math.PI)}class lj{constructor(){this._rotation=0,this.type="Camera",this.dirtyRender=!0;const a=ta.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1]),this.bounds=new Ja(),this.worldTransform=new Qb(),this.position=new ob(()=>this.updateTransform(),0,0),this.scale=new ob(()=>this.updateTransform(),1,1),this.origin=new ob(()=>this.updateTransform(),.5,.5),this.reset()}updateTransform(){const a=this.matrix,b=this.position.x,c=this.position.y,d=this.scale.x,e=this.scale.y,f=-b+this.width*this.origin.x,g=-c+this.height*this.origin.y,j=Math.sin(this.rotation),i=Math.cos(this.rotation),k=j+j,n=j*k,q=i*k,t=(1-n)*d,u=q*d,x=-q*e,z=(1-n)*e;a[0]=t,a[1]=u,a[4]=x,a[5]=z,a[12]=b+f-(t*f+x*g),a[13]=c+g-(u*f+z*g),this.worldTransform.set(i*d,j*d,-j*e,i*e,-b,-c);const H=this.width*(1/d),K=this.height*(1/e);this.bounds.set(f-H/2,g-K/2,H,K),this.dirtyRender=!0}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}set rotation(a){a!==this._rotation&&(this._rotation=kj(a),this.updateTransform())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.origin.destroy(),this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}class mj{constructor(){this.type="StaticCamera",this.dirtyRender=!0;const a=ta.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.bounds=new Ja(),this.worldTransform=new Qb(),this.reset()}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}const Nd="destroy";const wj="postupdate";const xj="update";function qb(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof Uc)g.delete(c);else{const j=!d,i=e!==void 0;for(const k of g)k.callback===c&&(j&&k.context===d)&&(i&&k.once===e)&&g.delete(k)}return g.size===0&&f.delete(b),a}function uc(a){const{a:b,b:c,c:d,d:e,tx:f,ty:g}=a.world,{x:j,y:i,right:k,bottom:n}=a.extent,q=j*b+i*d+f,t=j*c+i*e+g,u=j*b+n*d+f,x=j*c+n*e+g,z=k*b+n*d+f,H=k*c+n*e+g,K=k*b+i*d+f,I=k*c+i*e+g;return{x0:q,y0:t,x1:u,y1:x,x2:z,y2:H,x3:K,y3:I}}class Od{constructor(a){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=a,this.area=new Ja()}set(a,b,c,d){this.area.set(a,b,c,d)}get(){return this.entity.isDirty(_.BOUNDS)&&!this.fixed&&this.update(),this.area}updateLocal(){const{x0:a,y0:b,x1:c,y1:d,x2:e,y2:f,x3:g,y3:j}=uc(this.entity.transform),i=Math.min(a,c,e,g),k=Math.min(b,d,f,j),n=Math.max(a,c,e,g),q=Math.max(b,d,f,j);return this.area.set(i,k,n-i,q-k)}update(){const a=this.updateLocal();this.entity.clearDirty(_.BOUNDS);if(!this.includeChildren||!this.entity.numChildren)return a;const b=this.visibleOnly,c=this.entity.children;let d=a.x,e=a.y,f=a.right,g=a.bottom;for(let j=0;j<c.length;j++){const i=c[j];if(!i||b&&!i.visible)continue;const k=i.bounds.get();k.x<d&&(d=k.x),k.y<e&&(e=k.y),k.right>f&&(f=k.right),k.bottom>g&&(g=k.bottom)}return a.set(d,e,f-d,g-e)}destroy(){this.entity=null,this.area=null}}class Pd{constructor(a){this.enabled=!1,this.enabledChildren=!0,this.entity=a}destroy(){this.entity=null,this.hitArea=null}}class fb{constructor(a=0,b=0){this.set(a,b)}set(a=0,b=0){return this.x=a,this.y=b,this}getArray(){return[this.x,this.y]}fromArray(a){return this.set(a[0],a[1])}toString(){return`[x=${this.x}, y=${this.y}]`}}function Rd(a){const b=a.local,c=a.position.x,d=a.position.y,e=a.rotation,f=a.scale.x,g=a.scale.y,j=a.skew.x,i=a.skew.y;b.set(Math.cos(e+i)*f,Math.sin(e+i)*f,-Math.sin(e-j)*g,Math.cos(e-j)*g,c,d)}function eg(a,b){return b.set(a.a,a.b,a.c,a.d,a.tx,a.ty)}function Sd(a){const b=a.parent,c=a.transform,d=c.local,e=c.world;if(!b)eg(d,e);else if(c.passthru)eg(b.transform.world,e);else{const{a:f,b:g,c:j,d:i,tx:k,ty:n}=d,{a:q,b:t,c:u,d:x,tx:z,ty:H}=b.transform.world;e.set(f*q+g*u,f*t+g*x,j*q+i*u,j*t+i*x,k*q+n*u+z,k*t+n*x+H)}}class Qd{constructor(a,b=0,c=0){this.passthru=!1,this._rotation=0,this.entity=a,this.local=new Qb(),this.world=new Qb(),this.position=new ob(()=>this.update(),b,c),this.scale=new ob(()=>this.update(),1,1,!0),this.skew=new ob(()=>this.update(),0,0,!0),this.origin=new ob(()=>this.updateExtent(),Uf,Vf),this.extent=new Ja()}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(_.TRANSFORM,_.BOUNDS),Rd(this)}updateWorld(){const a=this.entity;a.setDirty(_.TRANSFORM,_.BOUNDS),Sd(a),a.numChildren&&this.updateChildren()}updateChildren(){const a=this.entity.children;for(let b=0;b<a.length;b++){const c=a[b];c.transform.updateWorld()}}globalToLocal(a,b,c=new fb()){const{a:d,b:e,c:f,d:g,tx:j,ty:i}=this.world,k=1/(d*g+f*-e);return c.x=g*k*a+-f*k*b+(i*f-j*g)*k,c.y=d*k*b+-e*k*a+(-i*d+j*e)*k,c}localToGlobal(a,b,c=new fb()){const{a:d,b:e,c:f,d:g,tx:j,ty:i}=this.world;return c.x=d*a+f*b+j,c.y=e*a+g*b+i,c}setExtent(a,b,c,d){this.extent.set(a,b,c,d),this.entity.setDirty(_.TRANSFORM,_.BOUNDS)}updateExtent(a,b){const c=this.extent,d=this.entity;a!==void 0&&(c.width=a),b!==void 0&&(c.height=b),c.x=-this.origin.x*c.width,c.y=-this.origin.y*c.height,d.setDirty(_.TRANSFORM,_.BOUNDS)}set rotation(a){a!==this._rotation&&(this._rotation=a,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}}class rb{constructor(a=0,b=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.events=new Map(),this.transform=new Qd(this,a,b),this.bounds=new Od(this),this.input=new Pd(this),this.dirty=_.DEFAULT,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(a){return(this.dirty&a)!==0}clearDirty(a){return this.isDirty(a)&&(this.dirty^=a),this}setDirty(a,b){return this.isDirty(a)||(this.dirty^=a,this.dirtyFrame=ta.getFrame()),this.isDirty(b)||(this.dirty^=b),this}update(a,b){if(this.willUpdateChildren){const c=this.children;for(let d=0;d<c.length;d++){const e=c[d];e&&e.willUpdate&&e.update(a,b)}}this.postUpdate(a,b)}postUpdate(a,b){}renderGL(a){}renderCanvas(a){}postRenderGL(a){}postRenderCanvas(a){}get numChildren(){return this.children.length}destroy(a){a?$f(this,a):Zf(this),xa(this,Nd,this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}}const Wd="worldrender";const Xd="worldshutdown";var Po=Object.freeze({__proto__:null,WorldRenderEvent:Wd,WorldShutdownEvent:Xd});function $d(a,b){b.numRendered++,b.numRenderable++,a.node.dirtyFrame>=b.gameFrame&&b.dirtyFrame++,a.children.forEach(c=>{c.children.length>0&&$d(c,b)})}function pg(a){if(a.node.isDirty(_.CHILD_CACHE))return!0;const b=[a];for(;b.length>0;){const c=b.pop();if(c.node.isDirty(_.TRANSFORM))return!0;const d=c.children.length;if(d>0)for(let e=0;e<d;e++)b.push(c.children[e])}return b.length=0,!1}function og(a,b){a.forEach(c=>{b||pg(c)?c.node.setDirty(_.CHILD_CACHE):c.children.length=0})}function ae(a,b,c=[]){for(let d=0;d<b.numChildren;d++){const e=b.children[d];if(e.isRenderable()){const f=[],g={node:e,children:f};c.push(g),e.willRenderChildren&&e.numChildren>0&&(e.willCacheChildren&&a.push(g),ae(a,e,f))}}return c}function mg(a){const b=[],c=[],d=ae(b,a,c),e=a.renderData;b.length>0&&og(b,a.camera.dirtyRender),d.forEach(f=>{f.children.length?$d(f,e):(e.numRendered++,e.numRenderable++,f.node.dirtyFrame>=e.gameFrame&&e.dirtyFrame++)}),e.renderList=d,a.forceRefresh&&(e.dirtyFrame++,a.forceRefresh=!1)}function ng(a,b){a.numDirtyFrames+=b.dirtyFrame,a.numTotalFrames+=b.numRendered,b.camera.dirtyRender&&a.numDirtyCameras++,a.worldData.push(b)}function ad(a,b){a.gameFrame=b,a.dirtyFrame=0,a.numRendered=0,a.numRenderable=0,a.renderList.length=0}class Xb extends rb{constructor(a){super();this.forceRefresh=!1,this.type="BaseWorld",this.scene=a,this.world=this,this.events=new Map(),this._updateListener=_a(a,"update",(b,c)=>this.update(b,c)),this._renderListener=_a(a,"render",b=>this.render(b)),this._shutdownListener=_a(a,"shutdown",()=>this.shutdown()),Tb(a,"destroy",()=>this.destroy())}update(a,b){if(!this.willUpdate)return;xa(this,xj,a,b,this),super.update(a,b)}postUpdate(a,b){xa(this,wj,a,b,this)}render(a){const b=this.renderData;ad(b,a.gameFrame);if(!this.willRender||!this.visible)return;mg(this),xa(this,Wd,b,this),ng(a,b),this.camera&&(this.camera.dirtyRender=!1)}shutdown(){const a=this.scene;qb(a,"update",this._updateListener),qb(a,"render",this._renderListener),qb(a,"shutdown",this._shutdownListener),_f(this),xa(this,Xd,this),ad(this.renderData,0),this.camera&&this.camera.reset()}destroy(a){super.destroy(a),xa(this,Nd,this),ad(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}}function bd(a){return{camera:a,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0,renderList:[]}}class Kf extends Xb{constructor(a){super(a);this.type="StaticWorld",this.camera=new mj(),this.renderData=bd(this.camera)}}class To extends Xb{constructor(a){super(a);this.enableCameraCull=!0,this.type="World",this.camera=new lj(),this.renderData=bd(this.camera)}}function yj(a,b){const c=a.texture,d=b.shaders.current,e=d.buffer,f=c.binding;d.count===e.batchSize&&b.flush();const g=a.vertexData;b.textures.request(c);const j=f.index;g[4]=j,g[10]=j,g[16]=j,g[22]=j;const i=d.count*e.quadElementSize;e.vertexViewF32.set(g,i);const k=a.vertexColor,n=e.vertexViewU32;n[i+5]=k[0],n[i+11]=k[2],n[i+17]=k[3],n[i+23]=k[1],d.count++}var Ko=Object.freeze({__proto__:null,BoundsComponent:Od,InputComponent:Pd,GetVertices:uc,TransformComponent:Qd,UpdateLocalTransform:Rd,UpdateWorldTransform:Sd});class sb extends rb{constructor(a=0,b=0){super(a,b);this._alpha=1,this.type="Container"}setSize(a,b=a){return this.transform.updateExtent(a,b),this}setPosition(a,b){return this.transform.position.set(a,b),this}setOrigin(a,b=a){return this.transform.origin.set(a,b),this}setSkew(a,b=a){return this.transform.skew.set(a,b),this}setScale(a,b=a){return this.transform.scale.set(a,b),this}setRotation(a){return this.transform.rotation=a,this}set width(a){this.transform.updateExtent(a)}get width(){return this.transform.extent.width}set height(a){this.transform.updateExtent(void 0,a)}get height(){return this.transform.extent.height}set x(a){this.transform.position.x=a}get x(){return this.transform.position.x}set y(a){this.transform.position.y=a}get y(){return this.transform.position.y}set originX(a){this.transform.origin.x=a}get originX(){return this.transform.origin.x}set originY(a){this.transform.origin.y=a}get originY(){return this.transform.origin.y}set skewX(a){this.transform.skew.x=a}get skewX(){return this.transform.skew.x}set skewY(a){this.transform.skew.y=a}get skewY(){return this.transform.skew.y}set scaleX(a){this.transform.scale.x=a}get scaleX(){return this.transform.scale.x}set scaleY(a){this.transform.scale.y=a}get scaleY(){return this.transform.scale.y}set rotation(a){this.transform.rotation=a}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(a){a!==this._alpha&&(this._alpha=a,this.setDirty(_.TRANSFORM))}}function zj(a,b){const c=a.frame;if(!c)return;const d=b.ctx,e=a.transform,{a:f,b:g,c:j,d:i,tx:k,ty:n}=e.world,{x:q,y:t}=e.extent;d.save(),d.setTransform(f,g,j,i,k,n),d.globalAlpha=a.alpha,d.drawImage(c.texture.image,c.x,c.y,c.width,c.height,q,t,c.width,c.height),d.restore()}function Wb(a,b){const c=(b*255|0)&255;return(c<<24|a)>>>0}function Ub(a){const b=a.vertexAlpha,c=a.vertexTint,d=a.vertexColor;return d[0]=Wb(c[0],b[0]),d[1]=Wb(c[1],b[1]),d[2]=Wb(c[2],b[2]),d[3]=Wb(c[3],b[3]),a}function Xc(a,b,...c){const d=a.getFrame(b),{u0:e,u1:f,v0:g,v1:j,pivot:i}=d;return c.forEach(k=>{if(!k||d===k.frame)return;k.frame=d,i&&k.setOrigin(i.x,i.y),k.frame.setExtent(k),k.hasTexture=!0;const n=k.vertexData;n[2]=e,n[3]=g,n[8]=e,n[9]=j,n[14]=f,n[15]=j,n[20]=f,n[21]=g}),c}function gg(a,b,...c){if(!a)c.forEach(d=>{d.texture=null,d.frame=null,d.hasTexture=!1});else{let d;a instanceof Ka?d=a:d=Ea.get().get(a),d?(c.forEach(e=>{e.texture=d}),Xc(d,b,...c)):console.warn(`Invalid Texture key: ${a}`)}return c}function hg(a){const b=a.vertexData,{x0:c,y0:d,x1:e,y1:f,x2:g,y2:j,x3:i,y3:k}=uc(a.transform);return b[0]=c,b[1]=d,b[6]=e,b[7]=f,b[12]=g,b[13]=j,b[18]=i,b[19]=k,a}class Za extends sb{constructor(a,b,c,d){super(a,b);this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertexData=new Float32Array(24).fill(0),this.vertexColor=new Uint32Array(4).fill(4294967295),this.vertexAlpha=new Float32Array(4).fill(1),this.vertexTint=new Uint32Array(4).fill(16777215),this.setTexture(c,d)}setTexture(a,b){return gg(a,b,this),this}setFrame(a){return Xc(this.texture,a,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}preRender(){this.isDirty(_.COLORS)&&(Ub(this),this.clearDirty(_.COLORS)),this.isDirty(_.TRANSFORM)&&(hg(this),this.clearDirty(_.TRANSFORM))}renderGL(a){this.preRender(),yj(this,a)}renderCanvas(a){this.preRender(),zj(this,a)}get alpha(){return this._alpha}set alpha(a){if(a!==this._alpha){this._alpha=a;const b=this.vertexAlpha;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(_.ALPHA)}}get tint(){return this._tint}set tint(a){if(a!==this._tint){this._tint=a;const b=this.vertexTint;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(_.COLORS)}}destroy(a){super.destroy(a),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertexData=null,this.vertexColor=null,this.vertexAlpha=null,this.vertexTint=null}}class Io extends Za{constructor(a,b,c,d){super(a,b,c,d);this.type="AnimatedSprite",this.anims=new Map(),this.animData={currentAnim:"",currentFrames:[],frameIndex:0,animSpeed:0,nextFrameTime:0,repeatCount:0,isPlaying:!1,yoyo:!1,pendingStart:!1,playingForward:!0,delay:0,repeatDelay:0,onStart:null,onRepeat:null,onComplete:null}}stop(){const a=this.animData;a.isPlaying=!1,a.currentAnim="",a.onComplete&&a.onComplete(this,a.currentAnim)}nextFrame(){const a=this.animData;a.frameIndex++;if(a.frameIndex===a.currentFrames.length)if(a.yoyo)a.frameIndex--,a.playingForward=!1;else if(a.repeatCount===-1||a.repeatCount>0)a.frameIndex=0,a.repeatCount!==-1&&a.repeatCount--,a.onRepeat&&a.onRepeat(this,a.currentAnim),a.nextFrameTime+=a.repeatDelay;else return a.frameIndex--,this.stop();this.setFrame(a.currentFrames[a.frameIndex]),a.nextFrameTime+=a.animSpeed}prevFrame(){const a=this.animData;a.frameIndex--;if(a.frameIndex===-1)if(a.repeatCount===-1||a.repeatCount>0)a.frameIndex=0,a.playingForward=!0,a.repeatCount!==-1&&a.repeatCount--,a.onRepeat&&a.onRepeat(this,a.currentAnim),a.nextFrameTime+=a.repeatDelay;else return a.frameIndex=0,this.stop();this.setFrame(a.currentFrames[a.frameIndex]),a.nextFrameTime+=a.animSpeed}update(a,b){super.update(a,b);const c=this.animData;if(!c.isPlaying)return;c.nextFrameTime-=a*1e3,c.nextFrameTime=Math.max(c.nextFrameTime,0),c.nextFrameTime===0&&(c.pendingStart?(c.onStart&&c.onStart(this,c.currentAnim),c.pendingStart=!1,c.nextFrameTime=c.animSpeed):c.playingForward?this.nextFrame():this.prevFrame())}get isPlaying(){return this.animData.isPlaying}get isPlayingForward(){return this.animData.isPlaying&&this.animData.playingForward}get currentAnimation(){return this.animData.currentAnim}destroy(a){super.destroy(a),this.anims.clear(),this.animData=null}}function dg(a,b,c,d,e,f,g=0,j=1,i=1,k=0,n=0){const q=Math.cos(g+n)*j,t=Math.sin(g+n)*j,u=-Math.sin(g-k)*i,x=Math.cos(g-k)*i,z=a*q+c*u+e,H=a*t+c*x+f,K=a*q+d*u+e,I=a*t+d*x+f,N=b*q+d*u+e,J=b*t+d*x+f,P=b*q+c*u+e,Q=b*t+c*x+f;return{x0:z,y0:H,x1:K,y1:I,x2:N,y2:J,x3:P,y3:Q}}function Td(a,b,c,d,e,f,g,j,i,k=0,n=4294967295){const q=a.shaders.current,t=q.buffer,u=t.vertexViewF32,x=t.vertexViewU32,z=q.count*t.quadElementSize;u[z+0]=b,u[z+1]=c,u[z+2]=f,u[z+3]=i,u[z+4]=k,x[z+5]=n,u[z+6]=b,u[z+7]=c+e,u[z+8]=f,u[z+9]=g,u[z+10]=k,x[z+11]=n,u[z+12]=b+d,u[z+13]=c+e,u[z+14]=j,u[z+15]=g,u[z+16]=k,x[z+17]=n,u[z+18]=b+d,u[z+19]=c,u[z+20]=j,u[z+21]=i,u[z+22]=k,x[z+23]=n,q.count++}function Vc(a,b,c,d,e,f,g,j,i,k=0,n=4294967295){a.shaders.setDefault(k),Td(a,b,c,d,e,f,g,j,i,k,n),a.shaders.popAndRebind()}class Wc extends rb{constructor(){super();this.type="Layer",this.transform.passthru=!0,this.willRender=!1}}class fg extends Wc{constructor(){super();this.type="RenderLayer",this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!0,this.setDirty(_.CHILD_CACHE);const a=Ab(),b=Bb(),c=Cb(),d=new Ka(null,a*c,b*c);d.binding=new vc(d),d.binding.framebuffer=Ud(d.binding.texture),this.texture=d,this.framebuffer=d.binding.framebuffer}renderGL(a){this.numChildren>0&&(a.flush(),this.isDirty(_.CHILD_CACHE)?(a.fbo.add(this.framebuffer,!0),this.clearDirty(_.CHILD_CACHE)):(a.fbo.add(this.framebuffer,!1),this.postRenderGL(a)))}postRenderGL(a){const b=this.texture;a.flush(),a.fbo.pop();const{u0:c,v0:d,u1:e,v1:f}=b.firstFrame;a.textures.bind(b),Vc(a,0,0,b.width,b.height,c,d,e,f),a.textures.unbind(),this.clearDirty(_.TRANSFORM)}}class Jo extends fg{constructor(){super();this.shaders=[],this.type="EffectLayer"}postRenderGL(a){const b=this.shaders,c=this.texture;a.flush(),a.fbo.pop();if(b.length===0){const{u0:d,v0:e,u1:f,v1:g}=c.firstFrame;a.textures.bind(c),Vc(a,0,0,c.width,c.height,d,e,f,g),a.textures.unbind()}else{let d=c;for(let i=0;i<b.length;i++){const k=b[i],{u0:n,v0:q,u1:t,v1:u}=d.firstFrame;a.shaders.set(k,0)&&(k.renderToFBO=!0,a.textures.bind(d),Td(a,0,0,d.width,d.height,n,q,t,u),a.shaders.pop(),a.textures.unbind(),d=k.texture)}const{u0:e,v0:f,u1:g,v1:j}=d.firstFrame;a.textures.bind(d),Vc(a,0,0,d.width,d.height,e,f,g,j),a.textures.unbind()}this.clearDirty(_.TRANSFORM)}}function Aj(a,b){const c=a.texture,d=b.shaders.current,e=d.buffer;b.flush(),b.textures.request(c),a.updateTextureIndex();const f=b.gl;d.bindBuffers(a.indexBuffer,a.vertexBuffer),f.bufferData(f.ARRAY_BUFFER,a.data,f.STATIC_DRAW),f.drawElements(f.TRIANGLES,a.count*e.quadIndexSize,f.UNSIGNED_SHORT,0),d.prevCount=a.count,b.flushTotal++,d.bindBuffers(e.indexBuffer,e.vertexBuffer)}function Bj(a,b,c){return Math.max(b,Math.min(c,a))}class Lo extends Wc{constructor(a,b){super();this.glTextureIndex=0,this.hasTexture=!1,this.type="SpriteBatch",this.willRender=!0,this.setTexture(b),this.setMaxSize(a)}resetBuffers(){let a=[];for(let c=0;c<this.maxSize*4;c+=4)a.push(c+0,c+1,c+2,c+2,c+3,c+0);this.data=new ArrayBuffer(this.maxSize*96),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const b=ya.get();b&&(Vb(this.vertexBuffer),Vb(this.indexBuffer),this.vertexBuffer=b.createBuffer(),this.indexBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.data,b.STATIC_DRAW),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.index,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,null)),a=[],this.count=0}setMaxSize(a){return this.maxSize=Bj(a,0,65535),this.resetBuffers(),this}setTexture(a){let b;return a instanceof Ka?b=a:b=Ea.get().get(a),b?(this.texture=b,this.hasTexture=!0,this.glTextureIndex=-1):console.warn(`Invalid Texture key: ${a}`),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.count>0}clear(){return this.count=0,this}addToBatch(a,b,c,d,e,f,g,j,i,k){if(this.count>=this.maxSize)return console.warn("SpriteBatch full"),this;const{u0:n,u1:q,v0:t,v1:u}=a,x=this.vertexViewF32,z=this.vertexViewU32,H=this.count*24,K=this.texture.binding?this.texture.binding.index:0;return x[H+0]=c,x[H+1]=d,x[H+2]=n,x[H+3]=t,x[H+4]=K,z[H+5]=b,x[H+6]=e,x[H+7]=f,x[H+8]=n,x[H+9]=u,x[H+10]=K,z[H+11]=b,x[H+12]=g,x[H+13]=j,x[H+14]=q,x[H+15]=u,x[H+16]=K,z[H+17]=b,x[H+18]=i,x[H+19]=k,x[H+20]=q,x[H+21]=t,x[H+22]=K,z[H+23]=b,this.setDirty(_.TRANSFORM),this.count++,this}add(a){const{frame:b=null,x:c=0,y:d=0,rotation:e=0,scaleX:f=1,scaleY:g=1,skewX:j=0,skewY:i=0,originX:k=0,originY:n=0,alpha:q=1,tint:t=16777215}=a,u=this.texture.getFrame(b),{left:x,right:z,top:H,bottom:K}=u.getExtent(k,n),{x0:I,y0:N,x1:J,y1:P,x2:Q,y2:M,x3:r,y3:s}=dg(x,z,H,K,c,d,e,f,g,j,i),h=Wb(t,q);return this.addToBatch(u,h,I,N,J,P,Q,M,r,s)}addXY(a,b,c){const d=this.texture.getFrame(c),{left:e,right:f,top:g,bottom:j}=d.getExtent(0,0),{x0:i,y0:k,x1:n,y1:q,x2:t,y2:u,x3:x,y3:z}=dg(e,f,g,j,a,b);return this.addToBatch(d,4294967295,i,k,n,q,t,u,x,z)}updateTextureIndex(){const a=this.texture.binding.index;if(a===this.glTextureIndex)return;const b=this.vertexViewF32;this.glTextureIndex=a;for(let c=0;c<this.count;c++)b[c*24+4]=a,b[c*24+10]=a,b[c*24+16]=a,b[c*24+22]=a}renderGL(a){Aj(this,a)}destroy(){super.destroy(),Vb(this.vertexBuffer),Vb(this.indexBuffer),this.data=null,this.vertexViewF32=null,this.vertexViewU32=null,this.index=null,this.texture=null,this.hasTexture=!1}}function Db(a=32,b=32){const c=$c(a,b);return new Ka(c.canvas)}class Id extends Za{constructor(a,b,c="",d,e){super(a,b,Db());this.splitRegExp=/(?:\r\n|\r|\n)/,this.padding={left:0,right:0,top:0,bottom:0},this.verticalAlign="ascent",this.lineSpacing=0,this.font="16px monospace",this.fillStyle="#fff",this.strokeStyle="",this.backgroundStyle="",this.cornerRadius=0,this.textAlign="left",this.textBaseline="alphabetic",this.lineWidth=0,this.lineDash=[],this.antialias=!1,this.type="Text";const f=ta.get();this.resolution=f.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),d&&(this.font=d),e&&(this.fillStyle=e),this.setText(c)}syncContext(a,b){this.preRenderCallback&&this.preRenderCallback(a,b),b.font=this.font,b.textBaseline=this.textBaseline,b.textAlign=this.textAlign,b.fillStyle=this.fillStyle,b.strokeStyle=this.strokeStyle,b.lineWidth=this.lineWidth,b.lineCap="round",b.lineJoin="round",b.setLineDash(this.lineDash),b.imageSmoothingEnabled=this.antialias}updateText(){const a=this.canvas,b=this.context,c=this.resolution,d=this._text.split(this.splitRegExp),e=this.padding,f=this.fillStyle,g=this.strokeStyle,j=this.lineWidth,i=this.lineSpacing,k=j>0?j/2:0;b.clearRect(0,0,a.width,a.height),this.syncContext(a,b),b.textAlign="start";let n=0,q=0,t=0;const u=[],x=this.verticalAlign==="ascent",z=b.measureText("|MÃq"),H=Math.ceil(Math.abs(z.actualBoundingBoxAscent)+Math.abs(z.actualBoundingBoxDescent))+j;for(let h=0;h<d.length;h++){const m=b.measureText(d[h]),l=m.actualBoundingBoxLeft,p=m.actualBoundingBoxRight;let v=m.actualBoundingBoxAscent,o=m.actualBoundingBoxDescent;(!v&&!o||d[h]==="")&&(v=H,o=0);const E=Math.ceil(Math.abs(l)+Math.abs(p))+j,G=Math.ceil(Math.abs(v)+Math.abs(o))+j;x?(t+=v+k,h>0&&(t+=i+k),q=t+o+k):(t=q+(G-o-k),q+=G,h<d.length-1&&(q+=i)),n=Math.max(n,E),u.push({lineWidth:E,lineHeight:G,ascent:v,descent:o,left:l,right:p,y:t})}n+=e.left+e.right,q+=e.top+e.bottom;const K=this.fixedWidth?this.fixedWidth:n,I=this.fixedHeight?this.fixedHeight:q,N=Math.ceil(K*c),J=Math.ceil(I*c);(a.width!==N||a.height!==J)&&(a.width=N,a.height=J,this.texture.setSize(K,I),this.setSize(K,I)),b.save(),b.scale(c,c),this.syncContext(a,b);const P=this.backgroundStyle;if(P){b.save(),b.fillStyle=P,b.strokeStyle=P;const h=this.cornerRadius,m=h>0?h/2:0;h&&(b.lineWidth=h,b.strokeRect(m,m,K-h,I-h)),b.fillRect(m,m,K-h,I-h),b.restore()}const Q=this.textAlign,M=Q==="center",r=Q==="right"||Q==="end",s=(I-q)/2+e.top;for(let h=0;h<d.length;h++){const m=d[h],l=u[h];let p=e.left+l.left+k;const v=s+l.y;M?p=K/2:r&&(p=K-k),g&&b.strokeText(m,p,v),f&&b.fillText(m,p,v)}return b.restore(),this.texture.binding&&this.texture.binding.update(),this.setDirty(_.TEXTURE),this}get text(){return this._text}set text(a){this.setText(a)}setText(a=""){return Array.isArray(a)&&(a=a.join(`
`)),a!==this._text&&(this._text=a.toString(),this.updateText()),this}destroy(a){this.texture.destroy(),this.fillStyle=null,this.strokeStyle=null,this.backgroundStyle=null,this.canvas=null,this.context=null,super.destroy(a)}}function Lf(a,...b){return b.forEach(c=>{const d=c.vertexTint;d[0]=a,d[1]=a,d[2]=a,d[3]=a,Ub(c)}),b}function Mf(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function yb(a,b,c,d=1){let e;if(typeof a==="string"){let j=Ea.get();j.has(a)||j.add(a,Db()),e=j.get(a)}else e=a;let f=e.image,g=f.getContext("2d");return c?b.call(c,f,g):b(f,g),e.setSize(f.width/d,f.height/d),e.binding&&e.binding.update(),e}function Qc(a,b,c){switch(typeof a){case"number":return`#${a.toString(16)}`;case"function":return a(b,c);default:return a}}function ao(a,b,c,d,e,f,g,j,i){b.beginPath(),b.rect(c,d,e,f),g&&(b.fillStyle=g,b.fill()),j&&(b.strokeStyle=j,b.lineWidth=i,b.stroke())}function Nf(a,{width:b=32,height:c=b,fillStyle:d,strokeStyle:e,lineWidth:f=2}={}){return yb(a,function(g,j){g.width=Math.ceil(b),g.height=Math.ceil(c),e||(f=0);const i=f/2,k=i,n=i;b-=f,c-=f,ao(g,j,k,n,b,c,Qc(d,g,j),Qc(e,g,j),f)})}class io{constructor(a=0,b=a,c=0,d=c,e=0){this._width=0;this._height=0;this.cornerRadius={tl:eb(0),tr:eb(0),bl:eb(0),br:eb(0)};this.setTo(a,b,c,d,e)}setTo(a=0,b=a,c=0,d=c,e=0){return this.setPosition(a,b),this.setRadius(e),this.setSize(c,d),this}setPosition(a=0,b=a){return this.x=a,this.y=b,this}setRadius(a=0){let b=this.cornerRadius;if(typeof a==="number"){const c=a,d=a;b.tl=eb(void 0,c,d),b.tr=eb(void 0,c,d),b.bl=eb(void 0,c,d),b.br=eb(void 0,c,d)}else{const c=a.x??0,d=a.y??0;b.tl=eb(a.tl,c,d),b.tr=eb(a.tr,c,d),b.bl=eb(a.bl,c,d),b.br=eb(a.br,c,d)}return this}setSize(a=0,b=a){return this.width=a,this.height=b,this}get minWidth(){let a=this.cornerRadius;return Math.max(a.tl.x+a.tr.x,a.bl.x+a.br.x)}get minHeight(){let a=this.cornerRadius;return Math.max(a.tl.y+a.bl.y,a.tr.y+a.br.y)}get width(){return this._width}set width(a){a==null&&(a=0),this._width=Math.max(a,this.minWidth)}get height(){return this._height}set height(a){a==null&&(a=0),this._height=Math.max(a,this.minHeight)}get radius(){let a=this.cornerRadius,b=Math.max(a.tl.x,a.tl.y,a.tr.x,a.tr.y,a.bl.x,a.bl.y,a.br.x,a.br.y);return b}}function eb(a,b,c){return a===void 0?{x:b,y:c}:typeof a==="number"?{x:a,y:a}:a}const hr=Math.PI/180;function Hb(a){return a*hr}const jo=Hb(0),ko=Hb(90),lo=Hb(180),mo=Hb(270);function ff(a,b,c,d,e,f){const g=new io(b,c,d,e,f),j=g.minWidth,i=g.minHeight,k=d>=j?1:d/j,n=e>=i?1:e/i,q=g.cornerRadius;let t,u,x,z,H;a.beginPath(),a.translate(b,c),t=q.br,u=t.x*k,x=t.y*n,z=g.width-u,H=g.height-x,Af(t)?a.ellipse(z,H,u,x,0,jo,ko):(a.moveTo(g.width,H),a.lineTo(g.width,g.height),a.lineTo(z,g.height)),t=q.bl,u=t.x*k,x=t.y*n,z=u,H=g.height-x,a.lineTo(u,g.height),Af(t)?a.ellipse(z,H,u,x,0,ko,lo):(a.lineTo(0,g.height),a.lineTo(0,H)),t=q.tl,u=t.x*k,x=t.y*n,z=u,H=x,a.lineTo(0,H),Af(t)?a.ellipse(z,H,u,x,0,lo,mo):(a.lineTo(0,0),a.lineTo(z,0)),t=q.tr,u=t.x*k,x=t.y*n,z=g.width-u,H=x,a.lineTo(z,0),Af(t)?a.ellipse(z,H,u,x,0,mo,jo):(a.lineTo(g.width,0),a.lineTo(g.width,H)),a.closePath()}function Af(a){return a.x!==0&&a.y!==0}function zi(a,b,c,d,e,f,g,j,i,k){ff(b,c,d,e,f,g),j&&(b.fillStyle=j,b.fill()),i&&(b.strokeStyle=i,b.lineWidth=k,b.stroke())}var bo;(function(a){a[a.right=0]="right",a[a.down=1]="down",a[a.left=2]="left",a[a.up=3]="up"})(bo||(bo={}));var Ni;(function(a){a[a.IDLE=0]="IDLE",a[a.UPDATING=1]="UPDATING"})(Ni||(Ni={}));var Da;(function(a){a[a.none=0]="none",a[a.word=1]="word",a[a.char=2]="char"})(Da||(Da={}));var wa;(function(a){a[a.none=0]="none",a[a.raw=1]="raw",a[a.wrapped=2]="wrapped"})(wa||(wa={}));const xi=/(?:\r\n|\r|\n)/;function Dn(a,b,c,d,e,f=0){e<=0&&(d=0);let g=[];if(!a||!a.length)return g;let j=a.split(xi),i=j.length-1;a.slice(-1)===`
`&&(j.length-=1);let k;for(let n=0,q=j.length;n<q;n++){let t=j[n],u=n===i?0:1;if(d===0){g.push(Gd(t,b(t,c),u));continue}n===0?k=e-f:k=e;if(t.length<=100){let I=b(t,c);if(I<=k){g.push(Gd(t,I,u));continue}}let x;d===1?x=t.split(" "):x=t;let z="",H="",K=0;for(let I=0,N=x.length;I<N;I++){let J=x[I];d===1?(z+=J,I<N-1&&(z+=" ")):z+=J;let P=b(z,c);P>k&&(I===0?g.push(Gd("",0,2)):(g.push(Gd(H,K,2)),z=J,d===1&&(I<N-1&&(z+=" ")),P=b(z,c)),k=e),H=z,K=P}g.push(Gd(H,K,u))}return g}let Gd=function(a,b,c){return{text:a,width:b,newLineMode:c}};var Bd;(function(a){a[a.left=0]="left",a[a.center=1]="center",a[a.right=2]="right"})(Bd||(Bd={}));var Cd;(function(a){a[a.top=0]="top",a[a.center=1]="center",a[a.bottom=2]="bottom"})(Cd||(Cd={}));var db;(function(a){a[a.LEFT_TOP=0]="LEFT_TOP",a[a.TOP_LEFT=0]="TOP_LEFT",a[a.CENTER_TOP=1]="CENTER_TOP",a[a.TOP_CENTER=1]="TOP_CENTER",a[a.RIGHT_TOP=2]="RIGHT_TOP",a[a.TOP_RIGHT=2]="TOP_RIGHT",a[a.LEFT_CENTER=3]="LEFT_CENTER",a[a.CENTER_LEFT=3]="CENTER_LEFT",a[a.CENTER=4]="CENTER",a[a.CENTER_CENTER=4]="CENTER_CENTER",a[a.RIGHT_CENTER=5]="RIGHT_CENTER",a[a.CENTER_RIGHT=5]="CENTER_RIGHT",a[a.LEFT_BOTTOM=6]="LEFT_BOTTOM",a[a.BOTTOM_LEFT=6]="BOTTOM_LEFT",a[a.CENTER_BOTTOM=7]="CENTER_BOTTOM",a[a.BOTTOM_CENTER=7]="BOTTOM_CENTER",a[a.RIGHT_BOTTOM=8]="RIGHT_BOTTOM",a[a.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(db||(db={}));class oc{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(a){return this.items.push(a),this}pushMultiple(a){return this.items.push.apply(this.items,a),a.length=0,this}clear(){return this.items.length=0,this}}class Ai{constructor(){this.pens=[]}destroy(){this.pens.length=0}addPen(a){return this.pens.push(a),this}get firstPen(){return this.pens[0]}get lastPen(){return this.pens[this.pens.length-1]}hasPen(){return this.pens.length>0}get pensCount(){return this.pens.length}get startIndex(){let a=this.pens[0];return a?a.startIndex:0}get width(){let a=this.lastPen;return a?a.lastX:0}}function Cf(a){if(Array.isArray(a))a.length=0;else for(let b in a)delete a[b]}function pc(a,b=Array.isArray(a)?[]:{}){Cf(b);if(Array.isArray(a)){b.length=a.length;for(let c=0,d=a.length;c<d;c++)b[c]=a[c]}else for(let c in a)b[c]=a[c];return b}class Bi{constructor(){this.text="";this.x=0;this.y=0;this.width=0;this.height=0;this.ascent=0;this.descent=0;this.prop={};this.newLineMode=wa.none;this.startIndex=0}set(a="",b=0,c=0,d=0,e=0,f=0,g=0,j={},i=wa.none,k=0){return this.text=a,this.x=b,this.y=c,this.width=d,this.height=e,this.ascent=f,this.descent=g,this.prop=j,this.newLineMode=i,this.startIndex=k,this}clone(){let a=new Bi();return a.set(this.text,this.x,this.y,this.width,this.height,this.ascent,this.descent,pc(this.prop),this.newLineMode,this.startIndex),a}get plainText(){return this.newLineMode===wa.raw?`${this.text}
`:this.text}get wrapText(){return this.newLineMode!==wa.none?`${this.text}
`:this.text}get plainTextLength(){let a=this.text.length;return this.newLineMode===wa.raw&&(a+=1),a}get endIndex(){return this.startIndex+this.plainTextLength}get lastX(){return this.x+this.width}get isTextPen(){return this.text!==""}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}}class Dd{constructor({penPool:a}){this.pens=[];this.lines=[];this.pens=[],this.lines=[],this.penPool=a}destroy(){this.freePens()}freePens(){return this.penPool.pushMultiple(this.pens),this.lines.forEach(a=>{a.destroy()}),this.lines.length=0,this.maxLineWidth=0,this.totalLineHeight=0,this}addTextPen(a,b,c,d,e,f,g,j,i=wa.none){let k=this.penPool.pop();return k==null&&(k=new Bi()),k.set(a,b,c,d,e,f,g,j,i),this.addPen(k),this}addImagePen(a,b,c,d,e){return this.addTextPen("",a,b,c,d,d,0,e,wa.none),this}addNewLinePen(a){let b=this.lastPen;return b&&b.newLineMode===wa.none&&(b.newLineMode=a),this}addPen(a){let b=this.lastPen;b==null?a.startIndex=0:a.startIndex=b.endIndex,this.pens.push(a);let c=this.lastLine;return c==null&&(c=new Ai(),this.lines.push(c)),c.addPen(a),a.newLineMode!==wa.none&&(c=new Ai(),this.lines.push(c)),this}clone(a){a==null&&(a=new Dd({penPool:this.penPool})),a.freePens();const b=this.pens;for(let e=0,f=b.length;e<f;e++)a.addPen(b[e].clone());const c=this.lines,d=a.lines;for(let e=0,f=c.length;e<f;e++){const g=c[e],j=d[e];j.y=g.y,j.height=g.height}return a}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(a){if(a>=this.lines.length)return this.getLineEndIndex(a);{let b=this.lines[a];if(!b)return 0;let c=b.firstPen;return c?c.startIndex:0}}getLineEndIndex(a){let b=this.lines.length;a>=b&&(a=b-1);for(let c=a;c>=0;c--){let d=this.lines[c];if(d&&d.hasPen())return d.lastPen.endIndex}return 0}getLineWidth(a){let b=this.lines[a];return b?b.width:0}getLineHeights(a=[]){return this.lines.forEach(function(b){a.push(b.height)}),a}get lineCount(){return this.lines.length}get plainText(){let a=[],b=this.pens;for(let c=0,d=b.length;c<d;c++)a.push(b[c].plainText);return a.join()}get plainTextLength(){let a=0;for(let b=0,c=this.pens.length;b<c;b++)a+=this.pens[b].plainTextLength;return a}getSliceTagText(a,b,c=0,d,e=!1){if(d===void 0){let k=this.lastPen;if(!k)return"";d=k.endIndex}let f=[],g;for(var j=0,i=this.pens.length;j<i;j++){let k=this.pens[j],n=k.endIndex;if(n<=c)continue;let q=e?k.wrapText:k.plainText,t=k.prop,u=k.startIndex,x=u>=c&&n<=d;x||(q=q.substring(c-u,d-u)),b?f.push(a.call(b,q,t,g)):f.push(a(q,t,g)),g=t;if(n>=d)break}return f.join()}}function An(a,b,c){let d=pc(a,c);for(let e in b)d.hasOwnProperty(e)&&(d[e]=b[e]);return d}function qf(a,b,c={key:b}){c=An(Eq,c);let d=Ea.get(),e=d.get(c.key);if(!e)return;let f=e.getFrame(c.frame);if(!f)return;let g=c.width,j=c.height;(g===void 0||j===void 0)&&(g===void 0&&j===void 0?(c.width=f.width,c.height=f.height):g===void 0?c.width=f.width*(j/f.height):j===void 0&&(c.height=f.height*(g/f.width))),a.images.set(b,c)}const Eq={key:void 0,frame:void 0,width:void 0,height:void 0,y:0,left:0,right:0,top:0,bottom:0};class wn{constructor(){this.images=new Map()}destroy(){this.images.clear()}add(a,b){if(typeof a==="string")qf(this,a,b);else if(Array.isArray(a)){let c=a;for(let d=0,e=c.length;d<e;d++)qf(this,c[d])}else{let c=a;for(a in c)qf(this,a,c[a])}return this}remove(a){return this.images.delete(a),this}get(a){return this.images.get(a)}getOuterWidth(a){let b=this.images.get(a);return b?b.width+b.left+b.right:0}getOuterHeight(a){let b=this.images.get(a);return b?b.height+b.top+b.bottom:0}getFrame(a){let b=this.images.get(a);if(!b)return;let c=Ea.get(),d=c.get(b.key);if(!d)return;let e=d.getFrame(b.frame);return e}hasTexture(a){return!!this.getFrame(a)}}function of(a,b){a.font=b.font}function pf(a,b){a.textBaseline="alphabetic",a.textAlign="start",a.fillStyle=b.fillStyle,a.strokeStyle=b.strokeStyle,a.lineWidth=b.strokeThickness,a.lineCap="round",a.lineJoin="round",a.imageSmoothingEnabled=b.antialias}function yi(a,b,c){c?(a.shadowColor=b.shadowColor,a.shadowBlur=b.shadowBlur,a.shadowOffsetX=b.shadowOffsetX,a.shadowOffsetY=b.shadowOffsetY):(a.shadowColor="#000",a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0)}function Bn(a,b){return b.measureText(a).width}function Cn(a,b,c=0){let d=b.measureText(a),e=d.actualBoundingBoxAscent,f=d.actualBoundingBoxDescent;return(!e&&!f||a==="")&&(e=c,f=0),uf.ascent=e,uf.descent=f,uf.height=Math.ceil(Math.abs(e)+Math.abs(f)),uf}let uf={ascent:0,descent:0,height:0};function xn(a,b,c,d,e){a.freePens();if(b==="")return a;let f=c.canvas,g=c.context,j=c.parent,i=c.parser.splitText(b),k,n,q=0;for(var t=0,u=i.length;t<u;t++){let I=c.parser.tagTextToProp(i[t],k),N=I.text;k=I.prop;if(k.img){let J,P;c.imageManager?(J=c.imageManager.getOuterWidth(k.img),P=c.imageManager.getOuterHeight(k.img)):(J=0,P=0),e>0&&d!==Da.none&&(e<q+J&&(a.addNewLinePen(wa.wrapped),q=0)),a.addImagePen(q,0,J,P,pc(k)),q+=J}else if(N!==""){g.save();let J=c.parser.propToStyle(j,k);of(g,J),pf(g,J);let P=J.strokeThickness,Q=P/2;n=Dn(N,Bn,g,d,e,q);let M=Cn("|MÃq",g);for(let r=0,s=n.length;r<s;r++){const h=n[r],m=M.height+P,l=M.ascent+Q,p=M.descent+Q;a.addTextPen(h.text,q,0,h.width,m,l,p,pc(k),h.newLineMode),h.newLineMode!==wa.none?q=0:q+=h.width}g.restore()}}let x=a.lines,z=c.parent.lineSpacing,H=0,K=0;for(let I=0,N=x.length;I<N;I++){const J=x[I],P=J.pens,Q=P.length;let M=0,r=0;for(let m=0;m<Q;m++){const l=P[m];M=Math.max(M,l.ascent),r=Math.max(r,l.descent)}const s=M+r,h=K+M;for(let m=0;m<Q;m++)P[m].y+=h;J.y=h,J.height=s,H=Math.max(H,J.width),K+=s+z}return a.maxLineWidth=H,a.totalLineHeight=K-z,a}const Dj={PI2:Math.PI*2,HALF_PI:Math.PI*.5,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};class Dq extends Ja{constructor(a,b,c,d,e){super(a,b,c,d);this.name=e}}class zn{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return this.hitAreas.length=0,this}add(a,b,c,d,e){let f=new Dq(b,c,d,e,a);return this.hitAreas.push(f),this}getFirstHitArea(a,b){for(let c=0,d=this.hitAreas.length;c<d;c++){let e=this.hitAreas[c];if(e.contains(a,b))return e}return null}}function yn(a,b,c,d,e,f=0,g=0,j=a.penManager){a.hitAreaManager&&a.hitAreaManager.clear();let i=j.totalLineHeight;if(i===0)return;const k=d<a.textWidth||e<a.textHeight;let n=a.context;n.save();let q=a.parent;yq(a,q),zq(a,q),k&&(n.beginPath(),n.rect(b,c,d,e),n.clip());let t=q.align%3,u=Math.floor(q.align/3),x=c-g;switch(u){case Cd.center:x+=(e-i)/2;break;case Cd.bottom:x+=e-i-2;break}let z=j.lines,H=x;const K=b+e;for(let I=0,N=z.length;I<N;I++){let J=z[I];if(H>K)break;const P=H+J.height;if(P<c){H=P;continue}let Q=J.width;if(Q===0){H=P;continue}let M=b-f;switch(t){case Bd.center:M+=(d-Q)/2;break;case Bd.right:M+=d-Q;break}let r=J.pens;for(let s=0,h=r.length;s<h;s++)xq(a,r[s],M,x);H=P}n.restore()}function xq(a,b,c,d){c+=b.x,d+=b.y;let e=a.canvas,f=a.context,g=a.parent;f.save();let j=a.parser.propToStyle(g,b.prop);of(f,j),pf(f,j),j.underlineThickness>0&&b.width>0&&Aq(a,c,d,b.width,j),b.isTextPen&&Bq(a,c,d,b.text,j),b.isImagePen&&Cq(a,c,d,b.prop.img,j),f.restore(),b.hasAreaMarker&&b.width>0&&(a.hitAreaManager||(a.hitAreaManager=new zn()),a.hitAreaManager.add(b.prop.area,c,d,b.width,b.height))}function yq(a,b){let c=a.canvas,d=a.context;d.clearRect(0,0,c.width,c.height)}function zq(a,b){let c=a.canvas,d=a.context;d.clearRect(0,0,c.width,c.height);const e=b.backgroundFillStyle,f=b.backgroundStrokeStyle;if(e||f){const g=b.backgroundStrokeThickness,j=g/2,i=b.cornerRadius,k=j,n=j,q=c.width-g,t=c.height-g;zi(c,d,k,n,q,t,i,e,f,g)}else d.clearRect(0,0,c.width,c.height)}function Aq(a,b,c,d,e){c+=e.underlineOffsetY-e.underlineThickness/2;let f=a.context,g=f.lineCap;f.lineCap="butt",f.beginPath(),f.strokeStyle=e.underlineStyle,f.lineWidth=e.underlineThickness,f.moveTo(b,c),f.lineTo(b+d,c),f.stroke(),f.lineCap=g}function Bq(a,b,c,d,e){let f=a.context;e.strokeStyle&&e.strokeStyle!=="none"&&e.strokeThickness>0&&(yi(f,e,e.shadowStroke),f.strokeText(d,b,c)),e.fillStyle&&e.fillStyle!=="none"&&(yi(f,e,e.shadowFill),f.fillText(d,b,c))}function Cq(a,b,c,d,e){let f=a.imageManager;if(!f)return;let g=f.get(d),j=f.getFrame(d);b+=g.left,c+=g.y-g.height;let i=a.context;i.drawImage(j.texture.image,j.x,j.y,j.width,j.height,b,c,g.width,g.height)}class nn{constructor({canvas:a,context:b,parent:c,parser:d,penPool:e=new oc()}){this.textScrollX=0;this.textScrollY=0;this.canvas=a,this.context=b,this.parser=d,this.parent=c,this.penPool=e,this.penManager=new Dd({penPool:e})}destroy(){this.parser.destroy(),this.canvas=null,this.context=null,this.parser=null,this.parent=null,this.penManager&&(this.penManager.destroy(),this.penManager=null),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=null),this.imageManager&&(this.imageManager.destroy(),this.imageManager=null),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=null)}get textWidth(){return this.penManager.maxLineWidth}get textHeight(){return this.penManager.totalLineHeight}updatePenManager(a,b,c,d=this.penManager){return xn(d,a,this,b,c)}draw(a,b,c,d,e=0,f=0){return yn(this,a,b,c,d,e,f,this.penManager),this}get lines(){return this.penManager.lines}get tmpPenManager(){return this._tmpPenManager===null&&(this._tmpPenManager=new Dd({penPool:this.penPool})),this._tmpPenManager}getPlainText(a,b,c){let d;return a==null?d=this.penManager.plainText:d=this.parser.splitText(a,!0).join(""),(b!=null||c!=null)&&(b==null&&(b=0),c==null&&(c=d.length),d=d.substring(b,c)),d}getPenManager(a,b){return a===void 0?this.clonePenManager(b,this.penManager):(b===void 0&&(b=new Dd({penPool:this.penPool})),this.updatePenManager(a,this.parent.wrapMode,this.parent.wrapWidth,b),b)}getText(a,b,c,d){if(a==null)return this.penManager.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d);let e=this.tmpPenManager;return this.updatePenManager(a,this.parent.wrapMode,this.parent.wrapWidth,e),e.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d)}clonePenManager(a,b=this.penManager){return b.clone(a)}getLastPen(a=this.penManager){return a.lastPen}addImageInfo(a,b){return this.imageManager===void 0&&(this.imageManager=new wn()),this.imageManager.add(a,b),this}}function li(a,b=!0,c=!0){let d=a.canvasText;b&&d.updatePenManager(a.text,a.wrapMode,a.wrapWidth);if(c){let e=a.padding,f,g,j,i;a.fixedWidth===0?(f=d.textWidth,j=f+e.left+e.right):(j=a.fixedWidth,f=j-e.left-e.right,f>d.textWidth&&(f=d.textWidth)),a.fixedHeight===0?(g=d.textHeight,i=g+e.top+e.bottom):(i=a.fixedHeight,g=i-e.top-e.bottom,g>d.textHeight&&(g=d.textHeight));let k=a.resolution,n=Math.ceil(j*k),q=Math.ceil(i*k),t=a.canvas;(t.width!==n||t.height!==q)&&(t.width=n,t.height=q,a.texture.setSize(j,i),a.setSize(j,i));let u=a.context;u.save(),u.scale(k,k),d.draw(e.left,e.top,f,g,0,a.textScrollY),u.restore(),a.texture.binding&&a.texture.binding.update(),a.setDirty(_.TEXTURE)}}function lf(a,b=0,c=0){a.fixedWidth=b,a.fixedHeight=c,nf(a)}function mi(a,b,c,d,e){const f=a.padding;if(typeof b==="number")f.left=b,f.right=c===void 0?b:c,f.top=d===void 0?b:d,f.bottom=e===void 0?b:e;else{let g=b;f.left=g.left??0,f.right=g.right??0,f.top=g.top??0,f.bottom=g.bottom??0}nf(a)}function nf(a){const b=a.fixedWidth;if(a.wrapMode!==Da.none){const c=a.padding,d=b-c.left-c.right;a.wrapWidth=Math.max(d,0)}else a.wrapWidth=0}function on(a,b,c=!1){c?a.textScrollYPercentage=b:a.textScrollY=b}function ni(a,b){typeof b==="string"&&(b=db[b]),a.align=b}function oi(a,b=0){a.lineSpacing=b}function pi(a,b,c,d=0,e=0){c||(d=0),a.backgroundFillStyle=b,a.backgroundStrokeStyle=c,a.backgroundStrokeThickness=d,a.cornerRadius=e}function pn(a,b,c){b&&qi(a,b),c&&ri(a,c)}function qi(a,b){a.fontFamily=b}function ri(a,b){typeof b==="number"&&(b=`${b}px`),a.fontSize=b}function si(a,b){a.fillStyle=b}function ti(a,b,c=2){a.strokeStyle=b,a.strokeThickness=c}function ui(a,b="#000",c=5,d=0,e=0,f=!1,g=!1){a.shadowColor=b,a.shadowBlur=c,a.shadowOffsetX=d,a.shadowOffsetY=e,a.shadowFill=f,a.shadowStroke=g}function vi(a,b,c){typeof b==="string"&&(b=Da[b]),a.wrapMode=b,c===void 0?nf(a):a.wrapWidth=c}function wi(a,b,c=2,d=0){a.underlineStyle=b,a.underlineThickness=c,a.underlineOffsetY=d}function ki(a,b,c){a.canvasText.addImageInfo(b,c)}function qn(a,b,c,d){return b=a.canvasText.getText(b,c,d,!0),b.split(xi)}function rn(a,b,c,d){return a.canvasText.getPlainText(b,c,d)}function sn(a,b,c,d){return a.canvasText.getText(b,c,d,!1)}function tn(a,b,c,d){return a.canvasText.getText(b,c,d,!1)}function un(a,b){return a.canvasText.clonePenManager(b)}function vn(a,b,c){return a.canvasText.getPenManager(b,c)}class mf extends Za{constructor(a,b,c="",{width:d=0,height:e=0,padding:f,wrapMode:g=Da.none,backgroundFillStyle:j,backgroundStrokeStyle:i,backgroundStrokeThickness:k,cornerRadius:n=0,align:q=db.TOP_LEFT,lineSpacing:t=0,fontFamily:u="monospace",fontSize:x="16px",fillStyle:z="#fff",strokeStyle:H,strokeThickness:K=1,shadowColor:I="#000",shadowBlur:N=4,shadowOffsetX:J=0,shadowOffsetY:P=0,shadowFill:Q=!1,shadowStroke:M=!1,underlineStyle:r="#fff",underlineThickness:s=1,underlineOffsetY:h=0,images:m}={},l){super(a,b,Db());this.antialias=!1;this.fontFamily="monospace";this.fontSize="16px";this.fillStyle="#fff";this.strokeThickness=1;this.shadowStroke=!1;this.shadowFill=!1;this.shadowColor="#000";this.shadowBlur=4;this.shadowOffsetX=0;this.shadowOffsetY=0;this.underlineStyle="#fff";this.underlineThickness=1;this.underlineOffsetY=0;this.align=db.TOP_LEFT;this.lineSpacing=0;this.wrapMode=Da.none;this.wrapWidth=0;this.fixedWidth=0;this.fixedHeight=0;this.padding={left:0,right:0,top:0,bottom:0};this._textScrollY=0;this.type="rexText";const p=ta.get();this.resolution=p.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.canvasText=new nn({canvas:this.canvas,context:this.context,parent:this,parser:l}),lf(this,d,e),f&&mi(this,f),vi(this,g),ni(this,q),oi(this,t),pi(this,j,i,k,n),qi(this,u),ri(this,x),si(this,z),H&&ti(this,H,K),ui(this,I,N,J,P,Q,M),wi(this,r,s,h),m&&ki(this,m),this.setText(c)}destroy(a){this.canvasText.destroy(),this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}updateText(a=!0,b=!0){return li(this,a,b),this}get text(){return this._text}set text(a){this.setText(a)}setText(a="",b=!0){return Array.isArray(a)&&(a=a.join(`
`)),a!==this._text&&(this._text=a.toString(),b&&this.updateText()),this}setBackgroundStyle(a,b,c=2,d=0){return pi(this,a,b,c,d),this}setFixedSize(a,b){return lf(this,a,b),this}setPadding(a,b,c,d){return mi(this,a,b,c,d),this}setTextScrollY(a,b=!1){return on(this,a,b),this}setAlign(a){return ni(this,a),this}setLineSpacing(a=0){return oi(this,a),this}setFont(a,b){return pn(this,a,b),this}setFillStyle(a){return si(this,a),this}setStrokeStyle(a,b=2){return ti(this,a,b),this}setShadow(a="#000",b=5,c=0,d=0,e=!1,f=!1){return ui(this,a,b,c,d,e,f),this}resize(a,b){return lf(this,a,b),li(this),this}setWrapMode(a,b=0){return vi(this,a,b),this}setUnderline(a,b=2,c=0){return wi(this,a,b,c),this}addImageInfo(a,b){return ki(this,a,b),this}getWrappedText(a,b,c){return qn(this,a,b,c)}getPlainText(a,b,c){return rn(this,a,b,c)}getText(a,b,c){return sn(this,a,b,c)}getSubString(a,b,c){return tn(this,a,b,c)}clonePenManager(a){return un(this,a)}getPenManager(a,b){return vn(this,a,b)}get textScrollY(){return this._textScrollY}set textScrollY(a){this._textScrollY=a}get textScrollYPercentage(){return this._textScrollY/(this.totalTextHeight-this.displayTextHeight)}set textScrollYPercentage(a){const b=this.displayTextHeight,c=this.totalTextHeight;c<=b?this._textScrollY=0:this._textScrollY=(c-b)*a}get totalTextHeight(){return this.canvasText.textHeight}get displayTextHeight(){const a=this.padding;return this.height-a.top-a.bottom}}class rf{destroy(){}}const sf={text:null,prop:null},tf={font:void 0,fontFamily:void 0,fontStyle:void 0,fontSize:void 0,fillStyle:void 0,strokeStyle:void 0,strokeThickness:void 0,shadowColor:void 0,shadowOffsetX:void 0,shadowOffsetY:void 0,shadowBlur:void 0,shadowStroke:void 0,shadowFill:void 0,underlineStyle:void 0,underlineThickness:void 0,underlineOffsetY:void 0,image:void 0};class En extends rf{splitText(a,b=!1){const c=[];let d=0;for(;;){const f=Ci.exec(a);if(!f)break;const g=f[0],j=Ci.lastIndex-g.length;d<j&&c.push(a.substring(d,j)),b||c.push(g),d=Ci.lastIndex}const e=a.length;return d<e&&c.push(a.substring(d,e)),c}tagTextToProp(a,b){let c,d;b==null&&(b={}),b.img&&va(b,lb,"img"),Hq.test(a)?(va(b,Xa,"b",!0),c=""):Iq.test(a)?(va(b,lb,"b"),c=""):Jq.test(a)?(va(b,Xa,"i",!0),c=""):Kq.test(a)?(va(b,lb,"i"),c=""):Gn.test(a)?(d=a.match(Gn),va(b,Xa,"size",d[1]+"px"),c=""):Lq.test(a)?(va(b,lb,"size"),c=""):Hn.test(a)?(d=a.match(Hn),va(b,Xa,"color",d[1]),c=""):Mq.test(a)?(va(b,lb,"color"),c=""):In.test(a)?(d=a.match(In),va(b,Xa,"u",!0),c=""):Jn.test(a)?(d=a.match(Jn),va(b,Xa,"u",d[1]),c=""):Nq.test(a)?(va(b,lb,"u"),c=""):Oq.test(a)?(va(b,Xa,"shadow",!0),c=""):Kn.test(a)?(d=a.match(Kn),va(b,Xa,"shadow",d[1]),c=""):Pq.test(a)?(va(b,lb,"shadow"),c=""):Qq.test(a)?(va(b,Xa,"stroke",!0),c=""):Ln.test(a)?(d=a.match(Ln),va(b,Xa,"stroke",d[1]),c=""):Rq.test(a)?(va(b,lb,"stroke"),c=""):Mn.test(a)?(d=a.match(Mn),va(b,Xa,"img",d[1]),c=""):Sq.test(a)?(va(b,lb,"img"),c=""):Nn.test(a)?(d=a.match(Nn),va(b,Xa,"area",d[1]),c=""):Tq.test(a)?(va(b,lb,"area"),c=""):c=a;const e=sf;return e.text=c,e.prop=b,e}propToStyle(a,b){const c=tf;return b.hasOwnProperty("img")?c.image=b.img:(c.image=null,c.fontFamily=a.fontFamily,c.fontSize=b.size??a.fontSize,c.fontStyle=Fq(b.b,b.i),c.font=`${c.fontStyle} ${c.fontSize} ${c.fontFamily}`,c.fillStyle=b.color??a.fillStyle,b.hasOwnProperty("stroke")?b.stroke===!0?(c.strokeStyle=a.strokeStyle,c.strokeThickness=a.strokeThickness):(c.strokeStyle=b.stroke,c.strokeThickness=a.strokeThickness):(c.strokeStyle=a.strokeStyle,c.strokeThickness=0)),b.hasOwnProperty("shadow")?b.shadow===!0?(c.shadowColor=a.shadowColor,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor=b.shadow,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor="#000",c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=0,c.shadowStroke=!1,c.shadowFill=!1),b.hasOwnProperty("u")?b.u===!0?(c.underlineStyle=a.underlineStyle,c.underlineThickness=a.underlineThickness,c.underlineOffsetY=a.underlineOffsetY):(c.underlineStyle=b.u,c.underlineThickness=a.underlineThickness,c.underlineOffsetY=a.underlineOffsetY):(c.underlineStyle="#000",c.underlineThickness=0,c.underlineOffsetY=0),c}propToTagText(a,b,c){c==null&&(c=Gq);let d=[];for(const f in c){if(b.hasOwnProperty(f))continue;d.push(`[/${f}]`)}a=`${d.join()}${a}`;let e=[];for(const f in b){if(c[f]===b[f])continue;switch(f){case"size":const g=b.size.replace("px","");e.push(`[size=${g}]`);break;case"color":case"img":case"area":e.push(`[${f}=${b[f]}]`);break;case"stroke":case"u":b[f]===!0?e.push(`[${f}]`):e.push(`[${f}=${b[f]}]`);break;default:e.push(`[${f}]`);break}}return a=`${a}${e.join()}`,a}}const va=function(a,b,c,d){return b===Xa?a[c]=d:a.hasOwnProperty(c)&&delete a[c],a};var Fq=function(a,b){return a&&b?"bold italic":a?"bold":b?"italic":""};const Gq={},Ci=/\[b\]|\[\/b\]|\[i\]|\[\/i\]|\[size=(\d+)\]|\[\/size\]|\[color=([a-z]+|#[0-9abcdef]+)\]|\[\/color\]|\[u\]|\[u=([a-z]+|#[0-9abcdef]+)\]|\[\/u\]|\[shadow\]|\[shadow=([a-z]+|#[0-9abcdef]+)\]|\[\/shadow\]|\[stroke\]|\[stroke=([a-z]+|#[0-9abcdef]+)\]|\[\/stroke\]|\[img=([^\]]+)\]|\[\/img\]|\[area=([^\]]+)\]|\[\/area\]/ig;var Hq=/\[b\]/i,Iq=/\[\/b\]/i,Jq=/\[i\]/i,Kq=/\[\/i\]/i,Gn=/\[size=(\d+)\]/i,Lq=/\[\/size\]/i,Hn=/\[color=([a-z]+|#[0-9abcdef]+)\]/i,Mq=/\[\/color\]/i,In=/\[u\]/i,Jn=/\[u=([a-z]+|#[0-9abcdef]+)\]/i,Nq=/\[\/u\]/i,Oq=/\[shadow\]/i,Kn=/\[shadow=([a-z]+|#[0-9abcdef]+)\]/i,Pq=/\[\/shadow\]/i,Qq=/\[stroke\]/i,Ln=/\[stroke=([a-z]+|#[0-9abcdef]+)\]/i,Rq=/\[\/stroke\]/i,Mn=/\[img=([^\]]+)\]/i,Sq=/\[\/img\]/i,Nn=/\[area=([^\]]+)\]/i,Tq=/\[\/area\]/i;const lb=!1,Xa=!0;class Fn extends mf{constructor(a,b,c="",d){super(a,b,c,d,new En());this.type="rexBBcodeText"}}class Pn extends rf{constructor(a){super();this.tags=new Map();if(a)for(const b in a)this.addTag(b,a[b])}destroy(){this.tags.clear()}addTag(a,b){return this.tags.set(a,b),this}isTextTag(a){const b=this.tags.get(a);return b?b.img==null:!1}splitText(a,b=!1){const c=[];let d=0;for(;;){const f=Di.exec(a);if(!f)break;const g=f[0],j=Di.lastIndex-g.length;d<j&&c.push(a.substring(d,j));if(!b)c.push(g);else if(Rn.test(g)){const i=g.match(Sn);c.push(i[2])}else if(Tn.test(g)){const i=g.match(Un);c.push(i[2])}d=Di.lastIndex}const e=a.length;return d<e&&c.push(a.substring(d,e)),c}tagTextToProp(a,b){let c,d;if(Rn.test(a)){const f=a.match(Sn);if(f!=null){const g=f[1],j=this.tags;d=j.get(g)??{},d._class=g,c=f[2]}}else if(Tn.test(a)){const f=a.match(Un);if(f!=null){const g=f[1];d=Uq(g),d._style=g,c=f[2]}}c===void 0&&(c=a),d===void 0&&(d={});const e=sf;return e.text=c,e.prop=d,e}propToStyle(a,b){const c=tf;if(b.hasOwnProperty("img"))c.image=b.img;else{c.image=null,c.fontFamily=b.family??b.fontFamily??b["font-family"]??a.fontFamily;let d=b.size??b.fontSize??b["font-size"]??a.fontSize;typeof d==="number"&&(d=`${d}px`),c.fontSize=d,c.fontStyle=b.style??b.fontStyle??b["font-style"]??"",c.font=`${c.fontStyle} ${c.fontSize} ${c.fontFamily}`,c.fillStyle=b.color??b["font-color"]??a.fillStyle;if(b.hasOwnProperty("stroke")){const e=b.stroke;c.strokeStyle=e.color??a.strokeStyle,c.strokeThickness=e.thinkness??a.strokeThickness}else c.strokeStyle=a.strokeStyle,c.strokeThickness=a.strokeThickness}if(b.hasOwnProperty("shadow")){const d=b.shadow;c.shadowColor=d.color??a.shadowColor,c.shadowOffsetX=d.offsetX??a.shadowOffsetX,c.shadowOffsetY=d.offsetY??a.shadowOffsetY,c.shadowBlur=d.blur??a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0}else c.shadowColor=a.shadowColor,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=a.shadowStroke,c.shadowFill=a.shadowFill;if(b.hasOwnProperty("u")||b.hasOwnProperty("underline")){const d=b.u??b.underline;c.underlineStyle=d.color??a.underlineStyle,c.underlineThickness=d.thinkness??a.underlineThickness,c.underlineOffsetY=d.offset??a.underlineOffsetY}else c.underlineStyle="#000",c.underlineThickness=0,c.underlineOffsetY=0;return c}propToTagText(a,b,c){if(b.hasOwnProperty("_class")){if(a===""){if(this.isTextTag(b._class))return""}return`<class=${b._class}>${a}</class>`}else if(b.hasOwnProperty("_style"))return`<style=${b._style}>${a}</style>`}}function Uq(a){const b=a.split(";"),c={};for(var d=0,e=b.length;d<e;d++){const[f,g]=b[d].split(":");if(Qn(f)||Qn(g))continue;if(f==="stroke"){const j=g.split(" "),i={},k=j.length;k>=1&&(i.color=j[0]),k>=2&&(i.thinkness=parseInt(j[1].replace("px",""))),c.stroke=i}else if(f==="shadow"){const j=g.split(" "),i={},k=j.length;k>=1&&(i.color=j[0]),k>=2&&(i.offsetX=parseInt(j[1].replace("px",""))),k>=3&&(i.offsetY=parseInt(j[2].replace("px",""))),k>=4&&(i.blur=parseInt(j[3].replace("px",""))),c.shadow=i}else if(f==="u"||f==="underline"){const j=g.split(" "),i={},k=j.length;k>=1&&(i.color=j[0]),k>=2&&(i.thinkness=parseInt(j[1].replace("px",""))),k>=3&&(i.offset=parseInt(j[2].replace("px",""))),c[f]=i}else c[f]=g}return c}function Qn(a){return a=a.replace(Vq,""),a.length===0}const Di=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,Rn=/<\s*class=/i,Sn=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,Tn=/<\s*style=/i,Un=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,Vq=/^\s+|\s+$/;class On extends mf{constructor(a,b,c="",d){const e=d?d.tags:void 0;super(a,b,c,d,new Pn(e));this.type="rexTagText"}get parser(){return this.canvasText.parser}addTag(a,b){return this.parser.addTag(a,b),this}addTags(a){for(const b in a)this.parser.addTag(b,a[b]);return this}}function Wa(a,b){return a===void 0||b===void 0?void 0:`${a}|${b}`}function al(a,b){let c=a.split("|");return b===void 0&&(b=Qp),b.x=parseInt(c[0]),b.y=parseInt(c[1]),b}let Qp={x:0,y:0};let so=new oc();function ik(){let a=so.pop();return a===null&&(a=new Map()),a}function te(a){so.push(a)}function gk(a,b,c,d,e,f,g,j){if(c===f&&d===g&&e===j)return;let i=Wa(c,d),k=Wa(f,g);if(i){let n=b.get(i);n.delete(e);if(i===k){n.set(j,a);return}else n.size===0&&(te(n),b.delete(i))}if(k){let n=b.get(k);n?n.set(j,a):(n=ik(),n.set(j,a),b.set(k,n))}}function Jg(a,b,c,d){let e=Wa(b,c),f=a.get(e);f&&(d!==void 0?(f.delete(d),f.size===0&&(te(f),a.delete(e))):(f.clear(),te(f),a.delete(e)))}let to=new oc();function hk(){let a=to.pop();return a===null&&(a=new Set()),a}function Ig(a){to.push(a)}function se(a,b,c,d){if(c===d)return;if(c!==void 0){let e=b.get(c);e&&(e.delete(a),e.size===0&&(Ig(e),b.delete(c)))}if(d!==void 0){let e=b.get(d);e?e.add(a):(e=hk(),e.add(a),b.set(d,e))}}function $b(a,b,c){let d=a.get(b);d&&(d.delete(c),d.size===0&&(Ig(d),a.delete(b)))}function bk(a,b,c,d,e){let f=a.chessToXYZ.get(b),g=f?f.x:void 0,j=f?f.y:void 0,i=f?f.y:void 0;f?(f.x=c,f.y=d,f.z=e):a.chessToXYZ.set(b,{x:c,y:d,z:e}),gk(b,a.XYToZMap,g,j,i,c,d,e),se(b,a.XToChessSet,g,c),se(b,a.YToChessSet,j,d),se(b,a.ZToChessSet,i,e)}function _b(a,b,c,d){let e=a.XYToZMap.get(Wa(b,c));return e===void 0?null:d!==void 0?e.has(d)?e.get(d):null:e}function ck(a,b,c,d){if(d!==void 0){let e=_b(a,b,c,d);if(e===void 0)return;a.chessToXYZ.delete(e),Jg(a.XYToZMap,b,c,d),$b(a.XToChessSet,b,e),$b(a.YToChessSet,c,e),$b(a.ZToChessSet,d,e)}else{let e=_b(a,b,c);if(e){for(const[f,g]of e)a.chessToXYZ.delete(g),$b(a.XToChessSet,b,g),$b(a.YToChessSet,c,g),$b(a.ZToChessSet,f,g);Jg(a.XYToZMap,b,c)}}}function dk(a,b){return a.chessToXYZ.has(b)}function ek(a,b,c,d){return _b(a,b,c,d)!==null}function fk(a,b){return a.chessToXYZ.get(b)||null}function Gg(a){let b=-Infinity;for(const[c,d]of a)b<c&&(b=c);return b}function Hg(a){let b=Infinity;for(const[c,d]of a)b>c&&(b=c);return b}class rg{constructor(){this.chessToXYZ=new Map(),this.XYToZMap=new Map(),this.XToChessSet=new Map(),this.YToChessSet=new Map(),this.ZToChessSet=new Map(),this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0}destroy(){this.clear()}clear(){return this.chessToXYZ.clear(),this.XYToZMap.clear(),this.XToChessSet.clear(),this.YToChessSet.clear(),this.ZToChessSet.clear(),this.clearBounds(),this}clearBounds(){return this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0,this}addChess(a,b,c,d){return bk(this,a,b,c,d),this.clearBounds(),this}getChess(a,b,c){return _b(this,a,b,c)}removeChess(a,b,c){return ck(this,a,b,c),this.clearBounds(),this}hasChess(a){return dk(this,a)}contains(a,b,c){return ek(this,a,b,c)}getXYZ(a){return fk(this,a)}get xMax(){return this._xMax===void 0&&(this._xMax=Gg(this.XToChessSet)),this._xMax}get xMin(){return this._xMin===void 0&&(this._xMin=Hg(this.XToChessSet)),this._xMin}get yMax(){return this._yMax===void 0&&(this._yMax=Gg(this.YToChessSet)),this._yMax}get yMin(){return this._yMin===void 0&&(this._yMin=Hg(this.YToChessSet)),this._yMin}}function gb(a,b=[]){let c=a.boardData.chessToXYZ;for(const[d,e]of c)b.push(d);return b}function Ie(a){if(typeof a!=="object"||a.nodeType||a===a.window)return!1;try{if(a.constructor&&!{}.hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0}function gd(a){return Ie(a)?!0:typeof a==="object"?a.isTileXYZ:!1}function ca(a,b){let c=a.boardData.getXYZ(b);return c?c:gd(b)?b:null}function pa(a,b,c,d){return a.boardData.getChess(b,c,d)}class jk{constructor(a){this.parent=a,this.board=null,this.blocker=!1,this.boot()}boot(){typeof this.parent==="object"&&this.parent.on&&this.parent.on("destroy",this.destroy,this)}destroy(){if(this.board){let a=this.tileXYZ;this.board.boardData.removeChess(a.x,a.y,a.z)}this.parent=void 0,this.board=null}setBoard(a){return this.board=a,this}get tileXYZ(){return this.board==null?null:this.board.boardData.getXYZ(this.parent)}setBlocker(a=!0){return this.blocker=a,this}setBlockEdge(a,b=!0){typeof this.blocker==="boolean"&&(this.blocker={});let c=this.blocker;if(typeof a==="object"){let d=a;for(let e in d)c[e]=d[e]}else c[a]=b;return this}getBlockEdge(a){return typeof this.blocker==="boolean"?!1:this.blocker.hasOwnProperty(a)?this.blocker[a]:!1}}function ab(a){return a.hasOwnProperty("rexChess")||(a.rexChess=new jk(a)),a.rexChess}function Pa(a,b,c,d,e,f=!1,g=!1){if(b){let j=ca(a,b);if(j)c=j.x,d=j.y,e=j.z;else return}else{b=pa(a,c,d,e);if(!b)return}g||a.boardData.removeChess(c,d,e),a._isBoard&&ab(b).setBoard(null),f&&b.destroy&&b.destroy()}function Zb(a,b){if(a.infinityMode)return;if(a.height===void 0||a.height<=b){a.height=b;return}let c=gb(a);c.forEach(d=>{let e=ca(a,d);e.y>b&&Pa(a,d)}),a.height=b}function Yb(a,b){if(a.infinityMode)return;if(a.width===void 0||a.width<=b){a.width=b;return}let c=gb(a);c.forEach(d=>{let e=ca(a,d);e.x>b&&Pa(a,d)}),a.width=b}class be{constructor({grid:a=void 0,wrap:b=!1,inifinity:c=!1,width:d=0,height:e=0}={}){this.boardData=new rg(),this._isBoard=!0,this.setGrid(a),this.setWrapMode(b),this.setInfinityMode(c),this.setBoardSize(d,e)}destroy(){}setGrid(a){return this.grid=a,this}setWrapMode(a=!0){return this.wrapMode=a,this}setInfinityMode(a=!0){return this.infinityMode=a,this}setBoardSize(a=0,b=0){return Yb(this,a),Zb(this,b),this}}function $a(a,b,c,d){let e;return a.infinityMode?e=!0:e=b>=0&&b<a.width&&c>=0&&c<a.height,e&&d!==void 0&&(e=a.boardData.contains(b,c,d)),e}function Fa(a,b,c,d){return a.grid.getWorldXY(b,c,d)}function Cc(a,b,c,d){if(b===void 0){let e=gb(a);for(let f=0,g=e.length;f<g;f++){let j=e[f],i=ca(a,j);Fa(a,i.x,i.y,j)}}else{if(c===void 0){let e=ca(a,b);c=e.x,d=e.y}Fa(a,c,d,b)}}function Eb(a,b,c,d,e,f=!0){if(!$a(a,c,d))return;let g=ca(a,b);e===void 0&&(g?e=g.z:e=0);if(g&&g.x===c&&g.y===d&&g.z===e)return;let j=pa(a,c,d,e);j&&(Pa(a,null,c,d,e),console.warn(`Chess at (${c},${d},${e}) has been removed because of overlapped`)),a.boardData.addChess(b,c,d,e),a._isBoard&&ab(b).setBoard(a),f&&Cc(a,b,c,d)}function dc(a,b,c,d){return Math.atan2(d-b,c-a)}function Fb(a,b,c){let d=ca(a,b),e=ca(a,c),f=Fa(a,d.x,d.y,!0),g=f.x,j=f.y;f=Fa(a,e.x,e.y,!0);let i=f.x,k=f.y;return dc(g,j,i,k)}function tb(a,b,c){let d=c-b;return b+((a-b)%d+d)%d}function Bc(a,b,c,d={x:0,y:0}){return d===!0&&(d=Zo),a.wrapMode?b=tb(b,0,a.width):!a.infinityMode&&(b<0||b>=a.width)&&(b=null),a.wrapMode?c=tb(c,0,a.height):!a.infinityMode&&(c<0||c>=a.height)&&(c=null),d.x=b,d.y=c,d}let Zo={x:0,y:0};function Oa(a,b,c,d,e){let f=ca(a,b);if(f===null)return null;typeof c==="string"&&(c.indexOf(",")===-1?c=parseInt(c):c=c.split(".").map(k=>parseInt(k,10)));let g=typeof c==="number",j=typeof d==="number";if(g&&j){let k=a.grid.getTileXYAtDirection(f,c,d,e);return Bc(a,k.x,k.y,k),(k.x===null||k.y===null)&&(k=null),k}Array.isArray(e)||(e=[]),c===null&&(c=a.grid.allDirections);let i;if(g)if(Array.isArray(d))for(let k=0,n=d.length;k<n;k++)i=Oa(a,f,c,d[k]),i!==null&&e.push(i);else{let k,n,q;({end:k=1,start:n=k>0?1:-1,step:q=k>=n?1:-1}=d);if(n===k)i=Oa(a,f,c,k),i!==null&&e.push(i);else if(n<k)for(let t=n;t<=k;t+=q)i=Oa(a,f,c,t),i!==null&&e.push(i);else for(let t=n;t>=k;t+=q)i=Oa(a,f,c,t),i!==null&&e.push(i)}else for(let k=0,n=c.length;k<n;k++)j?(i=Oa(a,f,c[k],d),i!==null&&e.push(i)):Oa(a,f,c[k],d,e);return e}function kb(a,b,c=null,d={x:0,y:0}){return Oa(a,b,c,1,d)}function yc(a,b,c){b===void 0&&(b=bp);let d=a.wrapMode,e=a.infinityMode;a.wrapMode=!1,a.infinityMode=!0;let f=kb(a,b,c,!0);return a.wrapMode=d,a.infinityMode=e,Fb(a,b,f)}let bp={x:0,y:0};const ir=180/Math.PI;function Fc(a){return a*ir}function nk(a,b){let c=b-a;if(c===0)return 0;let d=Math.floor((c- -180)/360);return c-d*360}function xc(a,b,c){c=Fc(c);let d=a.grid.allDirections,e=Infinity,f;for(let g=0,j=d.length;g<j;g++){let i=Fc(yc(a,b,d[g])),k=Math.abs(nk(c,i));k<e&&(e=k,f=g)}return f}function Ac(a,b,c){if(b===null||c===null)return null;if(b.x===c.x&&b.y===c.y)return null;let d=a.grid.getNeighborTileDirection(b,c);if(a.wrapMode&&d===null){let e=kb(a,b,null);for(let f=0,g=e.length;f<g;f++){let j=e[f];if(c.x===j.x&&c.y===j.y){d=f;break}}}return d}function zc(a,b,c){let d=ca(a,b),e=ca(a,c);return Ac(a,d,e)}function de(a,b,c){return zc(a,b,c)!==null}function ee(a,b,c,d=!0){let e=ca(a,b),f=ca(a,c);return e===null||f===null?null:a.grid.directionBetween(e,f,d)}function dd(a,b,c=1,d=[]){let e=a.grid.ringToTileXYArray(b,c);for(let f=0,g=e.length;f<g;f++){let j=e[f];$a(a,j.x,j.y)&&d.push(j)}return d}function sg(a,b,c,d=!0,e=[]){for(let f=0;f<=c;f++){let g=d?f:c-f;dd(a,b,g,e)}return e}function hb(a,b,c,d,e={x:0,y:0}){return e===!0&&(e=$o),c===0&&d===0?(e.x=b.x,e.y=b.y):a.grid.offset(b,c,d,e),e}let $o={x:0,y:0};function tg(a,b){let c=Infinity,d=Infinity,e;for(let j=0,i=b.length;j<i;j++)e=b[j],c=Math.min(c,e.x),d=Math.min(d,e.y);if(c!==0||d!==0)for(let j=0,i=b.length;j<i;j++)e=b[j],hb(a,e,-c,-d,e);let f=-Infinity,g=-Infinity;for(let j=0,i=b.length;j<i;j++)e=b[j],f=Math.max(f,e.x),g=Math.max(g,e.y);return Yb(a,f+1),Zb(a,g+1),b}var bc;(function(a){a[a["x+,y+"]=0]="x+,y+",a[a["x-,y+"]=1]="x-,y+",a[a["y+,x+"]=2]="y+,x+",a[a["y-,x+"]=3]="y-,x+"})(bc||(bc={}));function fe(a,b,c,d=0){let e={x:0,y:0};switch(d){case 0:for(let f=0;f<a.height;f++)for(let g=0;g<a.width;g++)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 1:for(let f=0;f<a.height;f++)for(let g=a.width-1;g>=0;g--)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 2:for(let f=0;f<a.width;f++)for(let g=0;g<a.height;g++)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a);break;case 3:for(let f=0;f<a.width;f++)for(let g=a.height-1;g>=0;g--)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a)}}function ge(a,b,c,d){return a.grid.getDistance(b,c,d)}function cd(a,b=0,c=[]){if(Array.isArray(b)){let d=b;for(let e=0;e<a.height;e++)for(let f=0;f<a.width;f++){let g=!0;for(let j=0,i=d.length;j<i;j++)if(pa(a,f,e,d[j])!==null){g=!1;break}g&&c.push({x:f,y:e})}}else for(let d=0;d<a.height;d++)for(let e=0;e<a.width;e++)pa(a,e,d,b)===null&&c.push({x:e,y:d});return c}function he(a,b,c,d){return a.grid.getGridPoints(b,c,d)}function Qa(a,b,c,d=[]){let e=a.boardData.getChess(b,c);for(const[f,g]of e)d.push(g);return d}function Dc(a,b,c,d=[]){let e=c!=null,f,g;for(let j=0,i=b.length;j<i;j++)f=b[j],e?(g=pa(a,f.x,f.y,c),g!==null&&d.push(g)):Qa(a,f.x,f.y,d);return d}function ie(a,b,c,d,e){let f=ca(a,b);if(f===null)return null;d==null&&(d=f.hasOwnProperty("z")?f.z:null);let g=kb(a,f,c,!0);return g===null?null:Array.isArray(g)?(e===void 0&&(e=[]),Dc(a,g,d,e)):d==null?(e===void 0&&(e=[]),Qa(a,g.x,g.y,e)):pa(a,g.x,g.y,d)}function je(a,b,c,d={x:0,y:0}){let e=xc(a,b,c);return Oa(a,b,e,1,d)}function ke(a,b,c,d){return a.grid.getOppositeDirection(b,c,d)}function ed(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function Ec(a,b=0,c=a.length){let d=b+Math.floor(Math.random()*c);return a[d]===void 0?null:a[d]}function ug(a,b=0,c={x:0,y:0}){c===!0&&(c=Wo);let d=Math.floor(a.width*a.height*.3);for(let f=0;f<d;f++){let g=ed(0,a.width-1),j=ed(0,a.height-1);if(pa(a,g,j,b)===null)return c.x=g,c.y=j,c}let e=cd(a,b);if(e.length===0)return null;{let f=Ec(e);return c.x=f.x,c.y=f.y,c}}let Wo={x:0,y:0};function vg(a,b,c,d){if(d===void 0){let e=Qa(a,b,c);for(let f=0,g=e.length;f<g;f++){let j=ab(e[f]).blocker;if(j===!0)return!0}return!1}else{let e=pa(a,b,c,d);if(e===null)return!1;let f=ab(e).blocker;return f===!0}}function wg(a,b){return a.boardData.chessToXYZ.has(b)}function xg(a,b,c,d,e){if(d===void 0){let f=Qa(a,b,c);for(let g=0,j=f.length;g<j;g++)if(ak(ab(f[g]).blocker,e))return!0;return!1}else{let f=pa(a,b,c,d);return f===null?!1:ak(ab(f).blocker,e)}}function ak(a,b){return a===!1||a===!0?a:a[b]===!0}function Lg(a){return a=a%oo,a>=0?a:a+oo}const oo=Math.PI*2;function ok(a,b,c=1e-4){return Math.abs(a-b)<c}function le(a,b,c,d,e){let f=ca(a,b),g=ca(a,c),j=Fb(a,f,g);j=Lg(j);let i=Math.abs(j-d);i=Math.min(i,cp-i);let k=e/2;return ok(i,k)||i<k}const cp=Math.PI*2;function me(a,b,c,d,e){let f=ca(a,b),g=ca(a,c),j=a.grid.directions;a.grid.directions=a.grid.sides;let i=a.grid.directionBetween(f,g,!1);a.grid.directions=j;let k=Math.abs(i-d);return k=Math.min(k,a.grid.directions-k),k<=e/2}function La(a,b,c,d={x:0,y:0}){return a.grid.getTileXY(b,c,d)}function ne(a,b,c,d){if(a.infinityMode&&d===void 0)return!0;let e=La(a,b,c,!0);return $a(a,e.x,e.y,d)}function mk(a,b,c,d){let e=a-c,f=b-d;return Math.sqrt(e*e+f*f)}function Kg(a,b,c){return(b-a)*c+a}function yg(a,b,c,d,e,f=[]){let g=mk(b,c,d,e),j=Math.min(a.grid.width,a.grid.height),i=Math.ceil(g/(j/4)),k;for(let n=0;n<=i;n++){let q=n/i,t=Kg(b,d,q),u=Kg(c,e,q),x=La(a,t,u);if(!$a(a,x.x,x.y))continue;if(k&&k.x===x.x&&k.y===x.y)continue;f.push(x),k=x}return f}var cc;(function(a){a[a.x=1]="x",a[a.horizontal=1]="horizontal",a[a.h=1]="h",a[a.y=2]="y",a[a.vertical=2]="vertical",a[a.v=2]="v",a[a.xy=3]="xy"})(cc||(cc={}));function zg(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=_o),d!==null?hb(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.mirror(e,c,e),d!==null&&hb(a,e,d.x,d.y,e),e}let _o={x:0,y:0};function Ag(a,b=!1,c=!1){let d=gb(a);for(let e=0,f=d.length;e<f;e++)Pa(a,d[e],void 0,void 0,void 0,b,c)}function Bg(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=ap),d!==null?hb(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.rotate(e,c,e),d!==null&&hb(a,e,d.x,d.y,e),e}let ap={x:0,y:0};function Cg(a,b,c){let d=ca(a,b);if(d===null)return;Eb(a,b,d.x,d.y,c)}function fd(a,b,c){return Math.max(b,Math.min(c,a))}function Dg(a,b,c,d=[]){let e=La(a,b.left,b.top,!0),f=e.x-1,g=e.y-1,j=La(a,b.right,b.bottom,!0),i=j.x+1,k=j.y+1;a.infinityMode||(f=fd(f,0,a.width-1),g=fd(g,0,a.height-1),i=fd(i,0,a.width-1),k=fd(k,0,a.height-1));for(let n=f;n<=i;n++)for(let q=g;q<=k;q++){let t=Fa(a,n,q,!0);c(b,t.x,t.y)&&d.push({x:n,y:q})}return d}function Eg(a,b,c,d=!0){let e=ca(a,b),f=ca(a,c);if(e==null||f==null)return;Pa(a,b),Pa(a,c),Eb(a,b,f.x,f.y,f.z,d),Eb(a,c,e.x,e.y,e.z,d)}function oe(a,b,c=[]){let d=a.boardData.ZToChessSet.get(b);if(d)for(const e of d)c.push(e);return c}function pe(a,b,c=[]){for(let d=0,e=b.length;d<e;d++){let f=b[d];c.push(Fa(a,f.x,f.y))}return c}function qe(a,b,c,d={x:0,y:0}){return d===!0&&(d=dp),La(a,b,c,d),Fa(a,d.x,d.y,d),d}let dp={x:0,y:0};function re(a,b,c,d,e){let f=La(a,b,c,!0);return d!==void 0?pa(a,f.x,f.y,d):Qa(a,f.x,f.y,e)}class ce extends be{addChess(a,b,c,d,e=!0){return Eb(this,a,b,c,d,e),this}angleBetween(a,b){return Fb(this,a,b)}angleSnapToDirection(a,b){return xc(this,a,b)}angleToward(a,b){return yc(this,a,b)}areNeighbors(a,b){return de(this,a,b)}chessToTileXYZ(a){return ca(this,a)}contains(a,b,c){return $a(this,a,b,c)}directionBetween(a,b,c=!0){return ee(this,a,b,c)}filledRingToTileXYArray(a,b,c=!0,d=[]){return sg(this,a,b,c,d)}fit(a){return tg(this,a)}forEachTileXY(a,b,c=0){return fe(this,a,b,c),this}getAllChess(a=[]){return gb(this,a)}getChessData(a){return ab(a)}getDistance(a,b,c=!1){return ge(this,a,b,c)}getEmptyTileXYArray(a=0,b=[]){return cd(this,a,b)}getGridPoints(a,b,c){return he(this,a,b,c)}getNeighborChess(a,b,c,d){return ie(this,a,b,c,d)}getNeighborChessDirection(a,b){return zc(this,a,b)}getNeighborTileDirection(a,b){return Ac(this,a,b)}getNeighborTileXY(a,b=null,c={x:0,y:0}){return kb(this,a,b,c)}getNeighborTileXYAtAngle(a,b,c={x:0,y:0}){return je(this,a,b,c)}getOppositeDirection(a,b,c){return ke(this,a,b,c)}getRandomEmptyTileXY(a=0,b={x:0,y:0}){return ug(this,a,b)}getTileXYAtDirection(a,b,c,d){return Oa(this,a,b,c,d)}getWrapTileXY(a,b,c={x:0,y:0}){return Bc(this,a,b,c)}gridAlign(a,b,c){return Cc(this,a,b,c),this}hasBlocker(a,b,c){return vg(this,a,b,c)}hasChess(a){return wg(this,a)}hasEdgeBlocker(a,b,c,d){return xg(this,a,b,c,d)}isAngleInCone(a,b,c,d){return le(this,a,b,c,d)}isDirectionInCone(a,b,c,d){return me(this,a,b,c,d)}isOverlappingPoint(a,b,c){return ne(this,a,b,c)}lineToTileXYArray(a,b,c,d,e=[]){return yg(this,a,b,c,d,e)}mirror(a,b,c=null,d={x:0,y:0}){return zg(this,a,b,c,d)}offset(a,b,c,d){return hb(this,a,b,c,d)}removeAllChess(a=!1,b=!1){return Ag(this,a,b),this}removeChess(a,b,c,d,e=!1,f=!1){return Pa(this,a,b,c,d,e,f),this}ringToTileXYArray(a,b=1,c=[]){return dd(this,a,b,c)}rotate(a,b,c=null,d={x:0,y:0}){return Bg(this,a,b,c,d)}setBoardWidth(a=0){return Yb(this,a),this}setBoardHeight(a=0){return Zb(this,a),this}setTileZ(a,b){return Cg(this,a,b),this}shapeToTileXYArray(a,b,c=[]){return Dg(this,a,b,c)}swapChess(a,b,c=!0){return Eg(this,a,b,c),this}tileXYArrayToChessArray(a,b,c=[]){return Dc(this,a,b,c)}tileXYToChessArray(a,b,c=[]){return Qa(this,a,b,c)}tileXYZToChess(a,b,c){return pa(this,a,b,c)}tileZToChessArray(a,b=[]){return oe(this,a,b)}tileXYArrayToWorldXYArray(a,b=[]){return pe(this,a,b)}tileXYToWorldXY(a,b,c={x:0,y:0}){return Fa(this,a,b,c)}worldXYSnapToGrid(a,b,c={x:0,y:0}){return qe(this,a,b,c)}worldXYToChess(a,b,c,d){return re(this,a,b,c,d)}worldXYToTileXY(a,b,c){return La(this,a,b,c)}}class $j extends ce{}const bb={};rc(bb,{ChessToTileXYZ:()=>ca,Contains:()=>$a,DirectionBetween:()=>ee,ForEachTileXY:()=>fe,GetDistance:()=>ge,GetOppositeDirection:()=>ke,GetTileXYAtDirection:()=>Oa,GetWrapTileXY:()=>Bc,IsDirectionInCone:()=>me,TileXYArrayToChessArray:()=>Dc,TileXYToChessArray:()=>Qa,TileXYZToChess:()=>pa,TileZToChessArray:()=>oe});const Gb={};rc(Gb,{AngleBetween:()=>Fb,AngleSnapToDirection:()=>xc,AngleToward:()=>yc,GetGridPoints:()=>he,GridAlign:()=>Cc,IsAngleInCone:()=>le,IsOverlappingPoint:()=>ne,TileXYArrayToWorldXYArray:()=>pe,TileXYToWorldXY:()=>Fa,WorldXYSnapToGrid:()=>qe,WorldXYToChess:()=>re,WorldXYToTileXY:()=>La});const ac={};rc(ac,{AreNeighbors:()=>de,GetNeighborChess:()=>ie,GetNeighborChessDirection:()=>zc,GetNeighborTileDirection:()=>Ac,GetNeighborTileXY:()=>kb,GetNeighborTileXYAtAngle:()=>je});var oa;(function(a){a[a.orthogonal=0]="orthogonal",a[a.isometric=1]="isometric"})(oa||(oa={}));var ub;(function(a){a[a["4dir"]=4]="4dir",a[a["8dir"]=8]="8dir"})(ub||(ub={}));class Wk{constructor({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=oa.orthogonal,dir:f=ub["4dir"]}={}){this.setOriginPosition(a,b),this.setCellSize(c,d),this.setType(e),this.setDirectionMode(f)}fromJSON({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=oa.orthogonal,dir:f=ub["4dir"]}={}){return this.setType(e),this.setDirectionMode(f),this.setOriginPosition(a,b),this.setCellSize(c,d),this}toJSON(){return{x:this.x,y:this.y,cellWidth:this.cellWidth,cellHeight:this.cellHeight,type:this.mode,dir:this.directions}}setOriginPosition(a=0,b=0){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setType(a=oa.orthogonal){return typeof a==="string"&&(a=oa[a]),this.mode=a,this}setDirectionMode(a=ub["4dir"]){return typeof a==="string"&&(a=ub[a]),this.directions=a,this}}function Ok(a,b,c,d=!0){let e;switch(a.mode){case oa.orthogonal:case oa.isometric:if(b.y===c.y)e=c.x>=b.x?0:2;else if(b.x===c.x)e=c.y>=b.y?1:3;else if(a.directions===ub["4dir"]){let f=Fc(dc(b.x,b.y,c.x,c.y));f<0&&(f+=360),e=f/90,d&&(e=Math.round(e))}else{let f=c.x-b.x,g=c.y-b.y;if(f===g)e=f>0?4:6;else if(f===-g)e=f>0?7:5;else{let j=Fc(Math.atan2(g,f));j<0&&(j+=360);let i=j/45;d&&(i=Math.round(i)),i>=0&&i<1?e=i:i>=1&&i<2?e=i+3:i>=2&&i<3?e=i-1:i>=3&&i<4?e=i+2:i>=4&&i<5?e=i-2:i>=5&&i<6?e=i+1:i>=6&&i<7?e=i-3:e=i}}break}return e===a.directions&&(e=0),e}function De(a,b){return tb(b,0,a.directions)}function Pk(a,b,c,d=!1){let e=c.x-b.x,f=c.y-b.y,g;return d?g=Math.abs(e)+Math.abs(f):g=Math.sqrt(e*e+f*f),g}function ze(a,b=[]){if(!(b.length===a))if(b.length<a)for(let c=b.length;c<a;c++)b.push({x:0,y:0});else b.length=a;return b}function Ge(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=yp);let e,f;switch(a.mode){case oa.orthogonal:e=b*a.width,f=c*a.height;break;case oa.isometric:e=(b-c)*a._halfWidth,f=(b+c)*a._halfHeight;break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let yp={x:0,y:0};function Qk(a,b=0,c=0,d=[]){if(typeof b==="object"){let i=b;c=i.y,b=i.x}d===!0&&(d=up),ze(4,d);let e,f;({x:e,y:f}=Ge(a,b,c));let g=a._halfWidth,j=a._halfHeight;switch(a.mode){case oa.orthogonal:d[0].x=e+g,d[0].y=f-j,d[1].x=e+g,d[1].y=f+j,d[2].x=e-g,d[2].y=f+j,d[3].x=e-g,d[3].y=f-j;break;case oa.isometric:d[0].x=e+g,d[0].y=f,d[1].x=e,d[1].y=f+j,d[2].x=e-g,d[2].y=f,d[3].x=e,d[3].y=f-j;break}return d}let up=[];const Gc=[[1,0],[0,1],[-1,0],[0,-1],[1,1],[-1,1],[-1,-1],[1,-1]],hd=Gc;function Lk(a){let b={},c,d,e;for(let f in a)c=a[f],d=c[0],e=c[1],b.hasOwnProperty(d)||(b[d]={}),b[d][e]=parseInt(f);return b}const Mk=Lk(Gc),Nk=Lk(hd);function Rk(a,b,c){let d;switch(a.mode){case oa.orthogonal:d=Mk;break;case oa.isometric:d=Nk;break}let e=c.x-b.x,f=c.y-b.y;if(d.hasOwnProperty(e)){let g=d[e];if(g.hasOwnProperty(f))return g[f]}return null}function He(a,b,c,d,e={x:0,y:0}){e===!0&&(e=xp);let f,g;switch(a.mode){case oa.orthogonal:f=Gc[c][0],g=Gc[c][1];break;case oa.isometric:f=hd[c][0],g=hd[c][1];break}return d===1?(e.x=b.x+f,e.y=b.y+g):(e.x=b.x+d*f,e.y=b.y+d*g),e}let xp={x:0,y:0};function Sk(a,b,c,d={x:0,y:0}){return He(a,b,c,1,d)}function Tk(a,b,c,d){return vp[d]}const vp={0:2,1:3,2:0,3:1,4:6,5:7,6:4,7:5};function Uk(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=wp),b-=a.x,c-=a.y;let e=b/a.width,f=c/a.height;switch(a.mode){case oa.orthogonal:d.x=Math.round(e),d.y=Math.round(f);break;case oa.isometric:d.x=Math.round(+e+f),d.y=Math.round(-e+f);break}return d}let wp={x:0,y:0};function Vk(a,b,c,d={x:0,y:0}){return typeof c==="string"&&(c=cc[c]),d===!0&&(d=zp),d.x=c&1?-b.x:b.x,d.y=c&2?-b.y:b.y,d}let zp={x:0,y:0};function ec(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Ap);let f=b.x+c,g=b.y+d;return e.x=f,e.y=g,e}let Ap={x:0,y:0};function Xk(a,b,c,d=[]){let e,f;for(e=c,f=-c;f<=c;f++)d.push(ec(a,b,e,f));for(f=c,e=c-1;e>=-c;e--)d.push(ec(a,b,e,f));for(e=-c,f=c-1;f>=-c;f--)d.push(ec(a,b,e,f));for(f=-c,e=-c+1;e<=c-1;e++)d.push(ec(a,b,e,f));return d}function Yk(a,b,c,d={x:0,y:0}){d===!0&&(d=Fp),c=tb(c,0,3);let e,f;switch(c){case 1:e=-b.y,f=b.x;break;case 2:e=-b.x,f=-b.y;break;case 3:e=b.y,f=-b.x;break;default:e=b.x,f=b.y;break}return d.x=e,d.y=f,d}let Fp={x:0,y:0};function Ee(a){a._savedOriginX=a.x,a._savedOriginY=a.y}function Fe(a){a.x=a._savedOriginX,a.y=a._savedOriginY}class Kk extends Wk{get sides(){return 4}get allDirections(){return this.directions===4?Bp:Cp}get halfDirections(){return this.directions===4?Dp:Ep}directionBetween(a,b,c=!0){return Ok(this,a,b,c)}directionNormalize(a){return De(this,a)}getDistance(a,b,c=!1){return Pk(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return Qk(this,a,b,c)}getNeighborTileDirection(a,b){return Rk(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return Sk(this,a,b,c)}getOppositeDirection(a,b,c){return Tk(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return Uk(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return He(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return Ge(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return Vk(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return ec(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return Xk(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return Yk(this,a,b,c)}restoreOrigin(){return Fe(this),this}saveOrigin(){return Ee(this),this}}const Bp=[0,1,2,3],Cp=[0,1,2,3,4,5,6,7],Dp=[0,1],Ep=[0,1,4,5];var da;(function(a){a[a.ODD_R=0]="ODD_R",a[a.EVEN_R=1]="EVEN_R",a[a.ODD_Q=2]="ODD_Q",a[a.EVEN_Q=3]="EVEN_Q"})(da||(da={}));var ib;(function(a){a[a.y=0]="y",a[a.flat=0]="flat",a[a.x=1]="x",a[a.pointy=1]="pointy"})(ib||(ib={}));var Jb;(function(a){a[a.even=0]="even",a[a.odd=1]="odd"})(Jb||(Jb={}));class Dk{constructor({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=ib.x,staggerIndex:g=Jb.odd}={}){this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e)}fromJSON({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=ib.x,staggerIndex:g=Jb.odd}={}){return this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e),this}toJSON(){return{x:this.x,y:this.y,radius:this.radius,cellWidth:this.cellWidth,cellHeight:this.cellHeight,staggerAxis:this.staggerAxis,staggerIndex:this.staggerIndex}}setOriginPosition(a,b){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this.radius=void 0,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setRadius(a=0){let b,c;return this.staggerAxis===ib.y?(b=2*a,c=Jk*a):(b=Jk*a,c=2*a),this.setCellSize(b,c),this.radius=a,this}setDirectionMode(){return this.directions=6,this}setType(a=1,b=1){return typeof a==="string"&&(a=ib[a]),typeof b==="string"&&(b=Jb[b]),this.staggerAxis=a,this.staggerIndex=b,a===ib.y?this.mode=b===Jb.even?da.EVEN_Q:da.ODD_Q:this.mode=b===Jb.even?da.EVEN_R:da.ODD_R,this}}const Jk=Math.sqrt(3);function Ra(a,b,c,d={x:0,y:0,z:0}){d===!0&&(d=Mg);switch(a){case da.ODD_R:d.x=b-(c-(c&1))/2,d.z=c;break;case da.EVEN_R:d.x=b-(c+(c&1))/2,d.z=c;break;case da.ODD_Q:d.x=b,d.z=c-(b-(b&1))/2;break;case da.EVEN_Q:d.x=b,d.z=c-(b+(b&1))/2;break}return d.y=-d.x-d.z,d}function rk(a,b,c,d={x:0,y:0,z:0}){typeof a!=="number"&&(d=a,a=d.x,b=d.y,c=d.z),d===!0&&(d=Mg);let e=Math.round(a),f=Math.round(b),g=Math.round(c),j=Math.abs(e-a),i=Math.abs(f-b),k=Math.abs(g-c);return j>i&&j>k?e=-f-g:i>k?f=-e-g:g=-e-f,d.x=e,d.y=f,d.z=g,d}function Ca(a,b,c,d,e={x:0,y:0}){e===!0&&(e=fp);switch(a){case da.ODD_R:e.x=b+(d-(d&1))/2,e.y=d;break;case da.EVEN_R:e.x=b+(d+(d&1))/2,e.y=d;break;case da.ODD_Q:e.x=b,e.y=d+(b-(b&1))/2;break;case da.EVEN_Q:e.x=b,e.y=d+(b+(b&1))/2;break}return e}function sk(a,b,c={x:0,y:0,z:0}){return c===!0&&(c=Mg),c.x=a,c.y=-a-b,c.z=b,c}let Mg={x:0,y:0,z:0},fp={x:0,y:0};function uk(a,b,c,d=!0){let e;Ra(a.mode,b.x,b.y,ve),Ra(a.mode,c.x,c.y,we);let f=we.x-ve.x,g=we.y-ve.y,j=we.z-ve.z;return j===0?e=f>0?0:3:f===0?e=j>0?1:4:g===0?e=j>0?2:5:f>0&&g<0&&j>0?e=0+j/-g:f<0&&g<0&&j>0?e=1+-g/j:f<0&&g>0&&j>0?e=2+g/-f:f<0&&g>0&&j<0?e=3+-j/g:f>0&&g>0&&j<0?e=4+f/-j:e=5+-g/f,d&&(e=Math.round(e)),e}let ve={x:0,y:0,z:0},we={x:0,y:0,z:0};function vk(a,b,c,d=!1){Ra(a.mode,b.x,b.y,xe),Ra(a.mode,c.x,c.y,ye);let e=ye.x-xe.x,f=ye.y-xe.y,g=ye.z-xe.z;return(Math.abs(e)+Math.abs(f)+Math.abs(g))/2}let xe={x:0,y:0,z:0},ye={x:0,y:0,z:0};function Ae(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=op);let e=b*a.width,f=c*a.height;switch(a.mode){case da.ODD_R:c&1&&(e+=a._halfWidth),f*=.75;break;case da.EVEN_R:c&1&&(e-=a._halfWidth),f*=.75;break;case da.ODD_Q:e*=.75,b&1&&(f+=a._halfHeight);break;case da.EVEN_Q:e*=.75,b&1&&(f-=a._halfHeight);break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let op={x:0,y:0};function wk(a,b=0,c=0,d=[]){if(typeof b==="object"){let g=b;c=g.y,b=g.x}d===!0&&(d=kp),ze(6,d);let e,f;({x:e,y:f}=Ae(a,b,c));if(a.radius!==void 0){let g=a.radius,j=a.staggerAxis===ib.flat?0:-30;for(let i=0;i<6;i++){let k=60*i+j,n=Hb(k);d[i].x=e+g*Math.cos(n),d[i].y=f+g*Math.sin(n)}}else{let g=a._halfWidth,j=g/2,i=a._halfHeight,k=i/2;a.staggerAxis===ib.flat?(d[0].x=e+g,d[0].y=f,d[1].x=e+j,d[1].y=f+i,d[2].x=e-j,d[2].y=f+i,d[3].x=e-g,d[3].y=f,d[4].x=e-j,d[4].y=f-i,d[5].x=e+j,d[5].y=f-i):(d[0].x=e+g,d[0].y=f-k,d[1].x=e+g,d[1].y=f+k,d[2].x=e,d[2].y=f+i,d[3].x=e-g,d[3].y=f+k,d[4].x=e-g,d[4].y=f-k,d[5].x=e,d[5].y=f-i)}return d}let kp=[];const gp=[[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]]],hp=[[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]],[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]]],ip=[[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]],[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]]],jp=[[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]],[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]]],cb=[gp,hp,ip,jp];function Ib(a){let b={},c,d;for(let e in a)[c,d]=a[e],b.hasOwnProperty(c)||(b[c]={}),b[c][d]=parseInt(e);return b}const tk=[[Ib(cb[0][0]),Ib(cb[0][1])],[Ib(cb[1][0]),Ib(cb[1][1])],[Ib(cb[2][0]),Ib(cb[2][1])],[Ib(cb[3][0]),Ib(cb[3][1])]];function Be(a,b,c){let d;switch(a){case da.ODD_R:case da.EVEN_R:d=c&1;break;case da.ODD_Q:case da.EVEN_Q:d=b&1;break}return d}function xk(a,b,c){let d=a.mode,e=Be(d,b.x,b.y),f=tk[d][e],g=c.x-b.x,j=c.y-b.y;if(f.hasOwnProperty(g)){let i=f[g];if(i.hasOwnProperty(j))return i[j]}return null}function Ce(a,b,c,d,e={x:0,y:0}){e===!0&&(e=np);let f=a.mode,g=b.x,j=b.y;if(d===1){let i=Be(f,g,j);e.x=g+cb[f][i][c][0],e.y=j+cb[f][i][c][1]}else if(d===0)e.x=g,e.y=j;else{let i=Ra(f,g,j,!0),k,n,q;switch(c){case 1:k=i.x,n=i.y-d,q=i.z+d;break;case 2:k=i.x-d,n=i.y,q=i.z+d;break;case 3:k=i.x-d,n=i.y+d,q=i.z;break;case 4:k=i.x,n=i.y+d,q=i.z-d;break;case 5:k=i.x+d,n=i.y,q=i.z-d;break;default:k=i.x+d,n=i.y-d,q=i.z;break}Ca(f,k,n,q,e)}return e}let np={x:0,y:0};function yk(a,b,c,d={x:0,y:0}){return Ce(a,b,c,1,d)}function zk(a,b,c,d){return(d+3)%6}const Ak=4/3,Bk=2/3;function Ck(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=mp),b-=a.x,c-=a.y;let e,f;switch(a.mode){case da.ODD_R:case da.EVEN_R:f=c*Ak/a.height,e=b/a.width-Bk*(c/a.height);break;case da.ODD_Q:case da.EVEN_Q:f=c/a.height-Bk*(b/a.width),e=b*Ak/a.width;break}let g=sk(e,f,lp);return rk(g),Ca(a.mode,g.x,g.y,g.z,d),d}let lp={x:0,y:0,z:0},mp={x:0,y:0};function Ek(a,b,c,d={x:0,y:0}){typeof c==="string"&&(c=cc[c]),d===!0&&(d=rp);let e=Ra(a.mode,b.x,b.y,!0),f=a.mode===da.ODD_R||a.mode===da.EVEN_R,g,j,i;return c&1&&(f?(g=e.y,j=e.x,i=e.z):(g=-e.x,j=-e.z,i=-e.y),e.x=g,e.y=j,e.z=i),c&2&&(f?(g=-e.y,j=-e.x,i=-e.z):(g=e.x,j=e.z,i=e.y)),Ca(a.mode,g,j,i,d),d}let rp={x:0,y:0};function Fk(a,b,c,d,e={x:0,y:0}){e===!0&&(e=sp);let f=b.x+c,g=b.y+d;switch(a.mode){case da.ODD_R:(d&1)!==0&&((g&1)===0&&(f+=1));break;case da.EVEN_R:(d&1)!==0&&((g&1)===0&&(f-=1));break;case da.ODD_Q:(c&1)!==0&&((f&1)==0&&(g+=1));break;case da.EVEN_Q:(c&1)!==0&&((f&1)==0&&(g-=1));break}return e.x=f,e.y=g,e}let sp={x:0,y:0};function Gk(a,b,c,d=[]){let e=Ra(a.mode,b.x,b.y,!0),f=e.x,g=e.y,j=e.z,i,k,n;for(n=c,i=0;i>=-c;i--)k=-i-n,d.push(Ca(a.mode,f+i,g+k,j+n));for(i=-c,k=1;k<=c;k++)n=-i-k,d.push(Ca(a.mode,f+i,g+k,j+n));for(k=c,n=-1;n>=-c;n--)i=-k-n,d.push(Ca(a.mode,f+i,g+k,j+n));for(n=-c,i=1;i<=c;i++)k=-i-n,d.push(Ca(a.mode,f+i,g+k,j+n));for(i=c,k=-1;k>=-c;k--)n=-i-k,d.push(Ca(a.mode,f+i,g+k,j+n));for(k=-c,n=1;n<=c-1;n++)i=-k-n,d.push(Ca(a.mode,f+i,g+k,j+n));return d}function Hk(a,b,c,d={x:0,y:0}){d===!0&&(d=tp),c=tb(c,0,5);let e=Ra(a.mode,b.x,b.y,!0),f,g,j;switch(c){case 1:f=-e.z,g=-e.x,j=-e.y;break;case 2:f=e.y,g=e.z,j=e.x;break;case 3:f=-e.x,g=-e.y,j=-e.z;break;case 4:f=e.z,g=e.x,j=e.y;break;case 5:f=-e.y,g=-e.z,j=-e.x;break;default:f=e.x,g=e.y,j=e.z;break}return Ca(a.mode,f,g,j,d),d}let tp={x:0,y:0};class Ik extends Dk{get sides(){return 6}get allDirections(){return pp}get halfDirections(){return qp}directionBetween(a,b,c=!0){return uk(this,a,b,c)}directionNormalize(a){return De(this,a)}getDistance(a,b,c=!1){return vk(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return wk(this,a,b,c)}getNeighborTileDirection(a,b){return xk(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return yk(this,a,b,c)}getOppositeDirection(a,b,c){return zk(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return Ck(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return Ce(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return Ae(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return Ek(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return Fk(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return Gk(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return Hk(this,a,b,c)}restoreOrigin(){return Fe(this),this}saveOrigin(){return Ee(this),this}}const pp=[0,1,2,3,4,5],qp=[0,1,2];var za;(function(a){a[a.random=0]="random",a[a.diagonal=1]="diagonal",a[a.straight=2]="straight",a[a.line=3]="line",a[a.astar=10]="astar",a[a["astar-random"]=11]="astar-random",a[a["astar-line"]=12]="astar-line"})(za||(za={}));const fc=null;class co{constructor(a){this.content=[],this.scoreFunction=a}clear(){this.content.length=0}push(a){this.content.push(a),this.sinkDown(this.content.length-1)}pop(){let a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.bubbleUp(0)),a}remove(a){let b=this.content.indexOf(a),c=this.content.pop();b!==this.content.length-1&&(this.content[b]=c,this.scoreFunction(c)<this.scoreFunction(a)?this.sinkDown(b):this.bubbleUp(b))}get size(){return this.content.length}rescoreElement(a){this.sinkDown(this.content.indexOf(a))}sinkDown(a){let b=this.content[a];for(;a>0;){let c=(a+1>>1)-1,d=this.content[c];if(this.scoreFunction(b)<this.scoreFunction(d))this.content[c]=b,this.content[a]=d,a=c;else break}}bubbleUp(a){let b=this.content.length,c=this.content[a],d=this.scoreFunction(c);for(;;){let e=a+1<<1,f=e-1,g=null,j;if(f<b){let i=this.content[f];j=this.scoreFunction(i),j<d&&(g=f)}if(e<b){let i=this.content[e],k=this.scoreFunction(i);k<(g===null?d:j)&&(g=e)}if(g!==null)this.content[a]=this.content[g],this.content[g]=c,a=g;else break}}}let Una=new co(a=>a.f);const zf=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d=d.prevNodes[0];return c.reverse()};const go=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d.prevNodes.length===1?d=d.prevNodes[0]:d=Ec(d.prevNodes);return c.reverse()};const fo=function(a,b,c=[]){let d=b,e=b.angleTo(a);for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1)d=d.prevNodes[0];else{let f=Infinity;for(let g=1,j=d.prevNodes.length;g<j;g++){let i=d.prevNodes[g],k=Math.abs(b.angleTo(i)-e);k<f&&(f=k,d=i)}}}return c.reverse()};const eo=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let j=0,i=d.prevNodes.length;j<i;j++){f=d.prevNodes[j],g=f.logicDirTo(d);if(g!==e)break}e=g,d=f}}return c.reverse()};const ho=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let j=0,i=d.prevNodes.length;j<i;j++){f=d.prevNodes[j],g=f.logicDirTo(d);if(g===e)break}e=g,d=f}}return c.reverse()};let qc={};qc[za.astar]=zf;qc[za["astar-line"]]=zf;qc[za["astar-random"]]=zf;qc[za.random]=go;qc[za.line]=fo;qc[za.diagonal]=eo;qc[za.straight]=ho;class $k{constructor(){this.prevNodes=[]}shutdown(){this.key=void 0,this.prevNodes.length=0}destroy(){this.shutdown()}reset(a){this.key=a,this.f=0,this.g=0,this.h=void 0,this.closerH=void 0,this.visited=!1,this.closed=!1}heuristic(a,b,c){if(b===null)return 0;let d,e=this.distanceTo(a)*this.manager.weight;switch(b){case za.astar:d=e;break;case za["astar-line"]:if(c!==void 0){let f=a.angleTo(c)-this.angleTo(c);d=e+Math.abs(f)}else d=e;case za["astar-random"]:d=e+Math.random();break;default:d=e;break}return d}getNextNodes(){return[]}getCost(a){return fc}distanceTo(a){return 0}angleTo(a){return 0}logicDirTo(a){return 0}getNode(a,b=!1){return this.manager.getNode(a,b)}}function gc(a){for(let b=a.length-1;b>0;b--){let c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a}class Pp extends $k{constructor(a){super();this.isTileXYZ=!0;this.pathFinder=a}reset(a){super.reset(a),this.key=a,al(a,this),this._px=void 0,this._py=void 0,this.cost=void 0}getNextNodes(){let a=ac.GetNeighborTileXY(this.board,this);this.pathFinder.shuffleNeighbors&&gc(a);let b=[];return a.forEach(c=>{let d=this.getNode(Wa(c.x,c.y),!0);b.push(d)}),b}getCost(a){return this.pathFinder.cacheCost?this.cost===void 0&&(this.cost=this.pathFinder.getCost(this,a)):this.cost=this.pathFinder.getCost(this,a),this.cost}distanceTo(a){return bb.GetDistance(this.board,this,a,!0)}angleTo(a){return dc(this.worldX,this.wroldY,a.worldX,a.worldX)}logicDirTo(a){return ac.GetNeighborTileDirection(this.board,this,a)}get board(){return this.pathFinder.board}get worldX(){if(this._px===void 0){let a=Gb.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._px}get wroldY(){if(this._py===void 0){let a=Gb.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._py}}class Kp{constructor(){this.data=[];this.visited=new Set()}push(a,b){if(Array.isArray(a)){let d=a;for(let e=0,f=d.length;e<f;e++)this.push(d[e]);return this}if(typeof a==="object"){let d=a;a=d.x,b=d.y}let c=`${a},${b}`;return this.visited.has(c)?this:(this.data.push({x:a,y:b}),this.visited.add(c),this)}pop(){return this.data.pop()}get length(){return this.data.length}clear(){return this.data.length=0,this.visited.clear(),this}}let J1=new Kp();var ue;(function(a){a[a.direction=0]="direction",a[a.angle=1]="angle"})(ue||(ue={}));function cf(a,b,c){const d=Math.ceil(b*a.resolution),e=Math.ceil(c*a.resolution),f=a.canvas;if(f.width===d||f.height===e){df(a);return}f.width=d,f.height=e,a.texture.setSize(b,c),a.setSize(b,c),a.updateTexture()}function df(a){a.context.clearRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function ci(a,b="#fff"){let c=a.context;c.fillStyle=b,c.fillRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function ef(a,b,c){const d=new Image();d.onload=function(){const e=a.resolution,f=d.width/e,g=d.height/e;cf(a,f,g),a.context.drawImage(d,0,0),a.updateTexture(),c&&c(),d.onload=null,d.src="",d.remove()},d.src=b}function di(a,b){return new Promise(function(c,d){ef(a,b,c)})}function ei(a,b,c){return a.canvas.toDataURL(b,c)}function fi(a,b,c,d=[0,0,0,0]){const e=a.context.getImageData(b,c,1,1).data;return d[0]=e[0],d[1]=e[1],d[2]=e[2],d[3]=e[3],d}function gi(a,b,c,d,e,f,g){g===void 0&&(g=d!==0||e!==0||f!==0?255:0);const j=a.context.createImageData(1,1);j.data[0]=d,j.data[1]=e,j.data[2]=f,j.data[3]=g,a.context.putImageData(j,b,c),a.updateTexture()}class td extends Za{constructor(a=0,b=0,c=32,d=32){super(a,b,Db());this.type="rexCanvas";const e=ta.get();this.resolution=e.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.resize(c,d)}updateTexture(){return this.texture.binding&&this.texture.binding.update(),this.setDirty(_.TEXTURE),this}destroy(a){this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}resize(a,b){return cf(this,a,b),this}clear(){return df(this),this}}function Um(a,b){b.width!==a.width&&(b.width=a.width),b.height!==a.height&&(b.height=a.height);let c=b.getContext("2d");return c.drawImage(a.texture.image,a.x,a.y,a.width,a.height),b}function hi(a,b,c=0,d=0,e=a.width,f=a.height){const g=a.resolution,j=a.canvas,i=Math.ceil(e*g),k=Math.ceil(f*g);yb(b,function(n,q){n.width!==i&&(n.width=i),n.height!==k&&(n.height=k),q.clearRect(0,0,i,k),q.drawImage(j,c,d,i,k)},void 0,a.resolution)}function ii(a,b,c){const d=Ea.get();if(!d.has(b))return;Um(d.get(b).getFrame(c),a.canvas);const e=a.canvas.width,f=a.canvas.height,g=a.resolution,j=e/g,i=f/g;a.texture.setSize(j,i),a.setSize(j,i),a.updateTexture()}class Tm extends td{fill(a="#fff"){return ci(this,a),this}getCanvas(){return this.canvas}getContext(){return this.context}getDataURL(a,b){return ei(this,a,b)}getPixel(a,b,c=[0,0,0,0]){return fi(this,a,b,c)}generateTexture(a,b=0,c=0,d=this.width,e=this.height){return hi(this,a,b,c,d,e),this}loadFromURL(a,b){return ef(this,a,b),this}loadFromURLPromise(a){return di(this,a)}loadTexture(a,b){return ii(this,a,b),this}setPixel(a,b,c,d,e,f){return gi(this,a,b,c,d,e,f),this}}function Si(a,b){return a.events.delete(b),a}function Ri(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);let e=d.size;for(const f of d){f.callback.apply(f.context,c),f.once&&d.delete(f),e--;if(e===0)break}return d.size===0&&a.events.delete(b),!0}class Fd{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function Ui(a){return[...a.events.keys()]}function Ti(a,b){const c=a.events.get(b);return c?c.size:0}function Vi(a,b){const c=[],d=a.events.get(b);return d.forEach(e=>{c.push(e.callback)}),c}function Qi(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof Fd)g.delete(c);else{const j=!d,i=e!==void 0;for(const k of g)k.callback===c&&(j&&k.context===d)&&(i&&k.once===e)&&g.delete(k)}return g.size===0&&f.delete(b),a}function Ed(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new Fd(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function Pi(a,b,c,d=a){return Ed(a,b,c,d,!0)}function Bf(a,b){b?a.events.delete(b):a.events.clear()}function no(a){return class extends a{constructor(){super(...arguments);this.events=null}setEventEmitter(b){return this.destroyEventEmitter(),this.privateEE=b===void 0,this.privateEE?this.events=new Map():b?this.events=b.events:this.events=null,this.lastEventInstance=null,this}getEventEmitter(){return this}clearEventEmitter(){return this.setEventEmitter(null),this}destroyEventEmitter(){return this.lastEventInstance=null,this.events&&this.privateEE&&(Bf(this),this.events=null),this}on(b,c,d=this,e=!1){return this.lastEventInstance=null,this.events&&(this.lastEventInstance=Ed(this,b,c,d,e)),this}once(b,c,d=this){return this.lastEventInstance=null,this.events&&(this.lastEventInstance=Pi(this,b,c,d)),this}off(b,c,d,e){return this.lastEventInstance=null,this.events&&Qi(this,b,c,d,e),this}emit(b,...c){return this.lastEventInstance=null,this.events&&Ri(this,b,...c),this}removeAllListeners(b){return this.lastEventInstance=null,this.events&&Bf(this,b),this}clearEvent(b){return this.lastEventInstance=null,this.events&&Si(this,b),this}getListenerCount(b){return this.lastEventInstance=null,this.events?Ti(this,b):0}getEventNames(){return this.lastEventInstance=null,this.events?Ui(this):[]}getListeners(b){return this.lastEventInstance=null,this.events?Vi(this,b):[]}}}const ua=no(class{});var mb;(function(a){a[a.no=0]="no",a[a.lazy=1]="lazy",a[a.always=2]="always"})(mb||(mb={}));const Xi="complete";class xf extends ua{constructor(a,{eventEmitter:b,tickingMode:c=mb.lazy}={}){super();this._isRunning=!1;this.tickingState=!1;this.parent=a,this.setEventEmitter(b),this.setTickingMode(c)}boot(){this.tickingMode===mb.always&&!this.tickingState&&this.startTicking()}shutdown(){this.destroyEventEmitter(),this.tickingState&&this.stopTicking()}setTickingMode(a){typeof a==="string"&&(a=mb[a]),this.tickingMode=a}startTicking(){this.tickingState=!0}stopTicking(){this.tickingState=!1}get isRunning(){return this._isRunning}set isRunning(a){if(this._isRunning===a)return;this._isRunning=a,this.tickingMode===mb.lazy&&a!=this.tickingState&&(a?this.startTicking():this.stopTicking())}start(){return this.isRunning=!0,this}pause(){return this.isRunning=!1,this}resume(){return this.isRunning=!0,this}stop(){return this.isRunning=!1,this}complete(a=Xi){this.isRunning=!1,this.emit(a,this.parent,this)}}class vf extends xf{constructor(a,{updater:b=a,isRunning:c=!1,timeScale:d=1,now:e=0,tickingMode:f=mb.lazy}={}){super(a,arguments[1]);this.updater=null;this.timeScale=1;this.now=0;this.parent=a,this.setUpdater(b),this.isRunning=c,this.timeScale=d,this.now=e,this.setTickingMode(f),this.boot()}resetFromJSON({isRunning:a=!1,timeScale:b=1,now:c=0,tickingMode:d=mb.lazy}={}){return this.isRunning=a,this.timeScale=b,this.now=c,this.setTickingMode(d),this}toJSON(){return{isRunning:this.isRunning,timeScale:this.timeScale,now:this.now,tickingMode:this.tickingMode}}boot(){super.boot(),_a(this.parent,"destroy",this.destroy,this)}shutdown(){super.shutdown(),this.parent=void 0,this.updater=void 0}destroy(){this.shutdown()}setUpdater(a){return a instanceof rb&&(a=a.world),a instanceof Hd||a instanceof Xb?this.updater=a:this.updater=null,this}startTicking(){this.update===null&&this.setUpdater(this.parent);if(this.update===null)return;super.startTicking(),this.updater&&_a(this.updater,"update",this.update,this)}stopTicking(){super.stopTicking(),this.updater&&qb(this.updater,"update",this.update,this)}start(a=0){return this.now=a,super.start(),this}seek(a){return this.now=a,this}update(a){return!this.isRunning||this.timeScale===0?this:(this.now+=a*this.timeScale,this)}}const Hpa=Ha(qg());const Pg="receive";const cl={receive:Pg};function dl(a,b){(!a.sendToRef||a.sendToRef.key!==a.receiverID)&&(a.sendToRef=a.database.ref(a.rootPath).child(a.receiverID));if(b===void 0)return a.sendToRef.remove();let c={message:b,senderID:a.userID,stamp:a.stamp};return a.userName!==void 0&&(c.senderName=a.userName),a.skipFirst=!1,a.stamp=!a.stamp,a.sendToRef.set(c)}function el(a){if(a.isReceiving&&a.receiverRef.key===a.receiverID)return;Og(a),a.isReceiving=!0,a.skipFirst=!0,a.receiverRef=a.database.ref(a.rootPath).child(a.receiverID),a.receiverRef.on("value",gl,a),a.receiverRef.onDisconnect().remove()}function Og(a){if(!a.isReceiving)return;a.isReceiving=!1,a.receiverRef.off("value",gl,a),a.receiverRef.remove(),a.receiverRef.onDisconnect().cancel()}function gl(a){if(this.skipFirst){this.skipFirst=!1;return}let b=a.val();if(b==null)return;delete b.stamp,this.history.add(b),this.emit(this.eventNames.receive,b)}class fl{constructor({maxLength:a=-1}={}){this.maxLength=a,this.records=[]}add(a){return this.maxLength===0?this:(this.records.push(a),this.maxLength>0&&this.records.length>this.maxLength&&this.records.shift(),this)}clear(){return this.records.length=0,this}changeUserName(a,b){return this.maxLength===0?this:(this.records.forEach(c=>{c.senderID===a&&(c.senderName=b)}),this)}}const O4=Ha(Na());class Ic extends ua{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d,receiverID:e="",history:f=0,eventNames:g=cl}={}){super();this.setEventEmitter(a),this.eventNames=g,this.database=O4.database(),this.setRootPath(b),this.skipFirst=!0,this.stamp=!1,this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.isReceiving=!1,f===!0?f=-1:f===!1&&(f=0),this.history=new fl({maxLength:f})}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.sendToRef=void 0,this.receiverRef=void 0,this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.receiverID=a,this}changeUserName(a,b){return a===this.userID&&(this.userName=b),this.history.changeUserName(a,b),this}getHistory(){return this.history.records}clearHistory(){return this.history.clear(),this}send(a){return dl(this,a)}startReceiving(){return el(this),this}stopReceiving(){return Og(this),this}}const kr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function Pe(a,b,c=kr){let d=b===void 0?a:ed(a,b),e="";for(let f=0;f<d;f++)e+=Ec(Array.from(c));return e}const _ca=Ha(Na());var qa;(function(a){a[a["1d"]=1]="1d",a[a["2d"]=2]="2d",a[a["3d"]=3]="3d"})(qa||(qa={}));const Wg="init";const Xg="update";const Qg="addkey0";const Rg="addkey1";const Sg="addkey2";const Yg="removekey0";const Zg="removekey1";const _g="removekey2";const Tg="changekey0";const Ug="changekey1";const Vg="changekey2";const hl={init:Wg,update:Xg,addkey0:Qg,removekey0:Yg,changekey0:Tg,addkey1:Rg,removekey1:Zg,changekey1:Ug,addkey2:Sg,removekey2:_g,changekey2:Vg};function qo(a){return a==null||a===""||a.length===0}function jr(a,b,c={}){let d=a;if(!qo(b)){typeof b==="string"&&(b=b.split("."));let e;for(let f=0,g=b.length;f<g;f++){e=b[f];if(d[e]==null||typeof d[e]!=="object"){let j;f===g-1?j=c:j={},d[e]=j}d=d[e]}}return d}function ro(a,b,c){if(typeof a!=="object")return;if(qo(b)){if(c==null)return;typeof c==="object"&&(a=c)}else{typeof b==="string"&&(b=b.split("."));let d=b.pop(),e=jr(a,b);e[d]=c}return a}function po(a){return JSON.parse(JSON.stringify(a))}class il{constructor(){this.data={}}setValue(a,b){return a==null?this.clear():typeof a==="object"?this.data=a:ro(this.data,a,b),this}getValue(a){if(a==null)return this.data;{typeof a==="string"&&(a=a.split("."));let b=this.data;for(let c=0,d=a.length;c<d;c++){if(!Wi(b))return;b=b[a[c]]}return b}}cloneValue(a){return po(this.getValue(a))}removeKey(a){if(a==null)this.clear();else{typeof a==="string"&&(a=a.split("."));let b=a.pop(),c=this.data;for(let d=0,e=a.length;d<e;d++){if(!Wi(c))return this;c=c[a[d]]}Wi(c)&&delete c[b]}return this}clear(){return Cf(this.data),this}incValue(a,b=1){let c=this.getValue(a);return typeof c!=="number"&&(c=0),this.setValue(a,c+b),this}mulValue(a,b){let c=this.getValue(a);return typeof c!=="number"&&(c=1),this.setValue(a,c*b),this}}function Wi(a){return a!=null&&typeof a==="object"}const d6=Ha(Na());class hc extends ua{constructor({eventEmitter:a,parent:b,key:c,type:d,eventNames:e,table:f}={}){super();this.setEventEmitter(a),this.parent=b,this.children=new Map(),this.key=c,this.parent?this.fullKeyPath=sl(this.parent.fullKeyPath,this.key):this.fullKeyPath="",this.type=d,this.eventNames=e,this.table=f,this.database=d6.database(),this.setRootPath()}destroy(){this.stopUpdate().clear().destroyEventEmitter()}setRootPath(a){if(a===void 0){let b=this.parent?this.parent.rootPath:"";a=`${b}/${this.key}`}this.rootPath=a,this.rootRef=a!==""?this.database.ref(a):void 0;for(const[b,c]of this.children)c instanceof hc&&c.setRootPath();return this}setData(a,b){if(arguments.length===0)this.clear();else if(typeof a=="string")this.setChildData(a,b);else{let c=a;for(const[d,e]of this.children)c.hasOwnProperty(d)||this.removeChild(d);for(let d in c)this.setChildData(d,c[d])}return this}clear(){this.table.removeKey(this.fullKeyPath);for(const[a,b]of this.children)this.removeChild(a);return this}get childClass(){return null}setChildData(a,b){const c=sl(this.fullKeyPath,a);this.table.setValue(c,b);if(!(typeof b!=="object")){if(this.children.has(a))this.children.get(a).setData(b);else if(this.childClass){let d=new this.childClass({parent:this,key:a,type:this.type,eventEmitter:this.eventEmitter,eventNames:this.eventNames,table:this.table});d.startUpdate(),this.children.set(a,d)}}return this}removeChild(a){return this.children.has(a)&&(this.children.get(a).destroy(),this.children.delete(a)),this}startUpdate(){return this}stopUpdate(){return this}}function sl(a,b){return a==null||a===""?b:b==null||b===""?a:`${a}.${b}`}class id extends hc{startUpdate(){return this.rootRef.on("child_added",this.addCol,this),this.rootRef.on("child_removed",this.removeCol,this),this.rootRef.on("child_changed",this.changeColValue,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addCol,this),this.rootRef.off("child_removed",this.removeCol,this),this.rootRef.off("child_changed",this.changeColValue,this),this}addCol(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case qa["1d"]:this.emit(this.eventNames.addkey0,b,c);break;case qa["2d"]:this.emit(this.eventNames.addkey1,this.key,b,c);break;default:this.emit(this.eventNames.addkey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}removeCol(a){const b=a.key;this.removeChild(b);switch(this.type){case qa["1d"]:this.emit(this.eventNames.removekey0,b);break;case qa["2d"]:this.emit(this.eventNames.removekey1,this.key,b);break;default:this.emit(this.eventNames.removekey2,this.pageKey,this.key,b);break}this.emit(this.eventNames.update,this.table.data)}changeColValue(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case qa["1d"]:this.emit(this.eventNames.changekey0,b,c);break;case qa["2d"]:this.emit(this.eventNames.changekey1,this.key,b,c);break;default:this.emit(this.eventNames.changekey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}get pageKey(){return this.parent.key}}class jd extends hc{startUpdate(){return this.rootRef.on("child_added",this.addRow,this),this.rootRef.on("child_removed",this.removeRow,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addRow,this),this.rootRef.off("child_removed",this.removeRow,this),this}addRow(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case qa["2d"]:this.emit(this.eventNames.addkey0,b,c);break;default:this.emit(this.eventNames.addkey1,this.key,b,c);break}}removeRow(a){const b=a.key;this.removeChild(b);switch(this.type){case qa["2d"]:this.emit(this.eventNames.removekey0,b);break;default:this.emit(this.eventNames.removekey1,this.key,b);break}}get childClass(){return id}}class $g extends hc{startUpdate(){return this.rootRef.on("child_added",this.addPage,this),this.rootRef.on("child_removed",this.removePage,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addPage,this),this.rootRef.off("child_removed",this.removePage,this),this}addPage(a){const b=a.key,c=a.val();this.setData(b,c),this.emit(this.eventNames.addkey0,b,c)}removePage(a){const b=a.key;this.removeChild(b),this.emit(this.eventNames.removekey0,b)}get childClass(){return jd}}const Le={};Le[qa["1d"]]=id;Le[qa["2d"]]=jd;Le[qa["3d"]]=$g;function jl(a){return new Le[a.tableType]({type:a.tableType,eventEmitter:a.eventEmitter,eventNames:a.eventNames,table:a.table})}function kl(a){return a.updater.clear(),a.initialFlag=!1,a.rootRef.once("value").then(function(b){let c=b.val()??{};return a.table.setValue(c),a.emit(a.eventNames.init,c),a.initialFlag=!0,Promise.resolve(c)})}function Ga(a,b,c,d){let e=a.rootRef;return e=b?e.child(b):e,e=c?e.child(c):e,e=d?e.child(d):e,e}function ll(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ga(a,c,d,e).set(f)}function ml(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;default:c=b[0];break}return Ga(a,c,d,e).remove()}function nl(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ga(a,c,d,e).transaction(function(g){return g===null&&(g=0),g+f})}function ol(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ga(a,c,d,e).transaction(f)}function pl(a,b){return Ga(a).update(b)}function ql(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;case 1:c=b[0];break}return Ga(a,c,d,e).onDisconnect().remove()}function rl(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ga(a,c,d,e).onDisconnect().set(f)}const g5=Ha(Na());class Jc extends ua{constructor({eventEmitter:a,root:b="",type:c=qa["3d"],eventNames:d=hl}={}){super();this.setEventEmitter(a),this.eventNames=d,this.database=g5.database(),this.table=new il(),this.setTableType(c),this.setRootPath(b),this.initialFlag=!1}destroy(){this.updater.destroy(),this.destroyEventEmitter().stopUpdate()}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):null,this.updater.setRootPath(a),this}setTableType(a){return typeof a==="string"&&(a=qa[a]),this.tableType=a,this.updater&&this.updater.destroy(),this.updater=jl(this),this}startUpdate(){return kl(this),this.updater.startUpdate(),this}stopUpdate(){return this.updater.stopUpdate(),this}clear(){return this.updater.clear(),this}getData(){return this.table.getValue(...arguments)}cloneData(){return this.table.cloneValue(...arguments)}getItemRef(a,b,c){return Ga(this,a,b,c)}setData(...a){return ll(this,...a)}removeData(...a){return ml(this,...a)}incValue(...a){return nl(this,...a)}transaction(...a){return ol(this,...a)}updateData(a){return pl(this,a)}removeDataOnDisconnect(...a){return ql(this,...a)}setDataOnDisconnect(...a){return rl(this,...a)}}const ica=Ha(Na());var Zh;(function(a){a.d="d",a.w="w",a.m="m",a.y="y",a.day="d",a.week="w",a.month="m",a.year="y"})(Zh||(Zh={}));var rd;(function(a){a.d="tagD",a.w="tagW",a.m="tagM",a.y="tagY"})(rd||(rd={}));var sd;(function(a){a.d="scoreD",a.w="scoreW",a.m="scoreM",a.y="scoreY"})(sd||(sd={}));var Am;(function(a){a.d="day",a.w="week",a.m="month",a.y="year"})(Am||(Am={}));function bi({query:a,totalLines:b=Infinity,linesPerPage:c=1e3,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g}){return Sm({query:a,remainderLines:b,linesPerPage:c,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g})}function Sm(a){let b=a.query;a.startDocRef&&(b=b[a.startMode](a.startDocRef));let c=Math.min(a.remainderLines,a.linesPerPage);return a.remainderLines-=c,b.limit(c).get().then(function(d){let e=a.remainderLines===0||d.size<c,f=!1;a.forEachPageCallback&&(f=a.forEachPageCallback(d)||!1),e=e||f;if(e){let g;return a.resolveCallback&&(g=a.resolveCallback()),Promise.resolve(g)}else return a.startDocRef=d.docs[d.size-1],a.startMode="startAfter",Sm(a)})}function Ma(a,b=Infinity,c=0,d,e){let f=[],g=0;return bi({query:a,totalLines:c+b,startDocRef:d,startMode:e,forEachPageCallback:function(j){let i,k=j.size,n=c-g;n<=0?i=j.docs:n<k&&(i=j.docs.slice(n,k)),i&&f.push(...i),g+=k},resolveCallback:function(){return f}})}const nfa=Ha(Na());function Jm(a,b,c=0){return Ma(a.nextQuery,b,c,a.baselineDocRef,a.baselineMode).then(function(d){let e=d.length;return a.cacheItems=d,a.pageIndex=void 0,a.startItemIndex=c,a.endItemIndex=a.startItemIndex+e-1,a.isFullPage=b===void 0?!0:e===b,Promise.resolve(a.cacheItems)})}const Nea=Ha(Na());class bf{constructor({query:a={next:void 0,previous:void 0},itemCount:b=100,baselineDoc:c,baselineMode:d="startAt"}={}){this.setQuery(a),this.setItemCount(b),this.setBaselineDoc(c,d),this.pageIndex=void 0,this.baselineDocRef=void 0,this.baselineMode="startAt",this.startItemIndex=void 0,this.endItemIndex=void 0,this.cacheItems=void 0,this.isFullPage=void 0}setQuery(a,b){if(a instanceof Nea.firestore.Query)this.nextQuery=a,this.prevQuery=b;else{var c=a;this.nextQuery=c.next,this.prevQuery=c.previous}return this.pageIndex=null,this.isFullPage=!0,this}setItemCount(a){return this.itemCount=a,this}setBaselineDoc(a,b){return a?(this.baselineDocRef=a.ref,this.baselineMode=b):this.baselineDocRef=void 0,this}load(a,b=0){return Jm(this,a,b)}loadFirstPage(){return this._loadFirstPage()}loadNextPage(){return this.pageIndex==null?this._loadFirstPage():this._loadNextPage()}loadPreviousPage(){return this.pageIndex==null||this.pageIndex===1?this._loadFirstPage():this._loadPreviousPage()}loadCurrentPage(){return this.pageIndex==null||this.pageIndex===0?this._loadFirstPage():this._loadCurrentPage()}}function Pm(a){return Ma(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=null,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function Km(a){return Ma(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,Promise.resolve(a.cacheItems)})}function Qm(a){return Ma(a.nextQuery,a.itemCount,0,a.currPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=a.currPageEndDocRef,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function Lm(a){let b=(a.pageIndex+1)*a.itemCount;return Ma(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function Rm(a){return Ma(a.prevQuery,a.itemCount+1,0,a.currPageStartDocRef,"startAfter").then(function(b){let c=b.length-1;return a.cacheItems=b,a.cacheItems.pop(),a.cacheItems.reverse(),a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-c+1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=b[c].ref,a.currPageStartDocRef=b[c-1].ref,a.currPageEndDocRef=b[0].ref,Promise.resolve(a.cacheItems)})}function Mm(a){let b=(a.pageIndex-1)*a.itemCount;return Ma(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-d+1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function Om(a){return Ma(a.nextQuery,a.itemCount,0,a.prevPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function Nm(a){let b=a.pageIndex*a.itemCount;return Ma(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}class _h extends bf{_loadFirstPage(){return Km(this)}_loadNextPage(){return Lm(this)}_loadPreviousPage(){return Mm(this)}_loadCurrentPage(){return Nm(this)}}const Nda=Ha(Na());class af extends bf{_loadFirstPage(){return Pm(this)}_loadNextPage(){return Qm(this)}_loadPreviousPage(){return Rm(this)}_loadCurrentPage(){return Om(this)}}const Gea=Ha(Na());function Cm(a,b){let c={senderID:a.userID,message:b,timestamp:Gea.firestore.FieldValue.serverTimestamp()};return a.userName!==void 0&&(c.senderName=a.userName),a.receiverID!==void 0&&(c.receiverID=a.receiverID),a.rootRef.add(c)}function $h(a,b=a.receiverID){let c=a.rootRef;return c=b!==void 0?c.where("receiverID","==",b):c,c}function Bm(a,b=a.receiverID){let c=$h(a,b),d=c.orderBy("timestamp"),e=c.orderBy("timestamp","desc");return{next:d,previous:e}}const ai="receive";function Dm(a){let b=$h(a).orderBy("timestamp","desc").limit(1);a.unsubscribe=b.onSnapshot({includeMetadataChanges:!0},function(c){if(c.size>0){let d=c.docs[0];if(d.metadata.hasPendingWrites){a.skipFirst&&(a.skipFirst=!1);return}Hm(a,a.receiverID,d);if(a.skipFirst)a.skipFirst=!1;else{let e=Im(d);a.cacheMessages.push(e),a.emit(ai,e)}}else a.skipFirst&&(a.skipFirst=!1)},function(c){debugger})}function Em(a){a.unsubscribe&&a.unsubscribe(),a.resetQueryFlag=!0,a.cacheMessages.length=0}function Fm(a){return Hm(a),a.page.loadNextPage().then(function(b){let c=[];for(let d=0,e=b.length;d<e;d++)c.push(Im(b[d]));return a.cacheMessages.splice(0,0,...c),Promise.resolve(c)})}function Hm(a,b=a.receiverID,c){if(!a.resetQueryFlag)return;a.resetQueryFlag=!1;let d=a.skipFirst?"startAt":"startAfter";a.page.setBaselineDoc(c,d).setQuery(Bm(a,b));return}function Im(a){let b=a.data();return b.timestamp=b.timestamp.toDate(),b}const xea=Ha(Na());class Gm extends ua{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d="",receiverID:e,pageItemCount:f=100}={}){super();this.setEventEmitter(a),this.database=xea.firestore(),this.setRootPath(b),this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.skipFirst=!0,this.unsubscribe=void 0,this.page=new af(),this.setPageItemCount(f),this.resetQueryFlag=!0,this.cacheMessages=[]}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.resetQueryFlag=this.resetQueryFlag||this.rootPath!==a,this.rootPath=a,this.rootRef=this.database.collection(a),this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.resetQueryFlag=this.resetQueryFlag||this.receiverID!==a,this.receiverID=a,this}setPageItemCount(a){return this.page.setItemCount(a),this}get hasPreviousMessage(){return this.page.isFullPage!==!1}send(a){return Cm(this,a)}startReceiving(){return Dm(this),this}stopReceiving(){return Em(this),this}loadPreviousMessages(){return Fm(this)}}const dh="join";const eh="leave";const gh="init";const fh="update";const ch="changename";const bh="change";const xl={join:dh,leave:eh,update:fh,change:bh,init:gh,changename:ch};var xb;(function(a){a[a.once=0]="once",a[a.child=1]="child",a[a.all=2]="all"})(xb||(xb={}));const Qh="add";const Sh="remove";const Rh="change";const Th="update";const pm={add:Qh,remove:Sh,update:Th,change:Rh};function _e(a){a.items.length=0,a.itemID2Index.clear()}function qm(a){return a.items}function rm(a,b){return a.itemID2Index.has(b)}function Ph(a,b){return b==null?null:a.itemID2Index.get(b)}function sm(a,b){if(b==null)return null;let c=Ph(a,b);return c==null?null:a.items[c]}function tm(a,b,c){a.items.forEach(b,c)}function Ob(a){a.itemID2Index.clear();let b=a.items;for(var c=0,d=b.length;c<d;c++){let e=b[c][a.keyItemID];a.itemID2Index.set(e,c)}}function um(a,b){if(b>=a.length)return;let c=a.length-1,d=a[b];for(let e=b;e<c;e++)a[e]=a[e+1];return a.length=c,d}function Uh(a,b){let c=Wh.call(this,a,b);Ob(this),this.emit(this.eventNames.add,c),this.emit(this.eventNames.update,this.items)}function pd(a,b){let c=vm.call(this,a);Ob(this);let d=Wh.call(this,a,b);Ob(this),this.emit(this.eventNames.change,d,c),this.emit(this.eventNames.update,this.items)}function Vh(a){let b=vm.call(this,a);Ob(this),this.emit(this.eventNames.remove,b),this.emit(this.eventNames.update,this.items)}function qd(a){_e(this),a.forEach(function(b){Wh.call(this,b,null,!0)}.bind(this)),Ob(this),this.emit(this.eventNames.update,this.items)}function Wh(a,b,c=!1){let d,e=this.getItemCallback,f=this.getItemCallbackScope;f?d=e.call(f,a):d=e(a);if(c)return this.items.push(d),d;if(b==null)this.items.unshift(d);else{let g=this.itemID2Index.get(b);g===this.items.length-1?this.items.push(d):this.items.splice(g+1,0,d)}return d}function vm(a){let b=this.itemID2Index.get(a.key),c=um(this.items,b);return c}const ym={start(a,b){a.isUpdating=!1,b.once("value",qd,a)},stop(a){}};const xm={start(a,b){b.on("child_added",Uh,a),b.on("child_removed",Vh,a),b.on("child_moved",pd,a),b.on("child_changed",pd,a)},stop(a){a.query.off("child_added",Uh,a),a.query.off("child_removed",Vh,a),a.query.off("child_moved",pd,a),a.query.off("child_changed",pd,a)}};const wm={start(a,b){b.on("value",qd,a)},stop(a){a.query.off("value",qd,a)}};const od={};od[xb.all]=wm;od[xb.child]=xm;od[xb.once]=ym;class ic extends ua{constructor({eventEmitter:a,itemIDKey:b="__itemID__",mode:c=xb.child,getItemCallback:d=jq,getItemCallbackScope:e,query:f,eventNames:g=pm}={}){super();this.setEventEmitter(a),this.eventNames=g,this.isUpdating=!1,this.items=[],this.itemID2Index=new Map(),this.setItemIDKey(b),this.setMode(c),e===void 0&&(e=this),this.setGetitemCallback(d,e),this.setQuery(f)}destroy(){this.stopUpdate().clear()}setItemIDKey(a){return this.keyItemID=a,this}setMode(a){return typeof a==="string"&&(a=xb[a]),this.mode=a,this.updater=od[a],this}setGetitemCallback(a,b){return this.getItemCallback=a,this.getItemCallbackScope=b,this}setQuery(a){return this.query=a,this}startUpdate(a){if(a)this.setQuery(a);else if(this.query)a=this.query;else return this;return this.stopUpdate().clear(),this.isUpdating=!0,this.updater.start(this,a),this}stopUpdate(){return!this.query||!this.isUpdating?this:(this.isUpdating=!1,this.updater.stop(this),this)}clear(){return _e(this),this}getItems(){return qm(this)}hasItem(a){return rm(this,a)}getItemIndexFromItemID(a){return Ph(this,a)}getItemFromItemID(a){return sm(this,a)}forEach(a,b){return tm(this,a,b),this}updateItemID2Index(){return Ob(this),this}}const jq=function(a){let b=a.val();return b[this.keyItemID]=a.key,b};function Kb(a,b=a.userID){return a.userID2ItemID.has(b)}function Me(a,b=a.userID){if(!Kb(a,b))return null;let c=a.userID2ItemID.get(b);return a.rootRef.child(c)}function yl(a,b=a.userID){if(!Kb(a,b))return null;let c=a.userID2ItemID.get(b);return a.userList.getItemFromItemID(c)}function ah(a){return a.userList.getItems()}function zl(a){a.userList.clear()}function Al(a,b,c){a.userList.forEach(b,c)}function Bl(a,b=a.userID){let c=a.userList.getItems()[0];return c&&c.userID===b}function Cl(a){return a.maxUsers===0?!1:a.userList.getItems().length>=a.maxUsers}function ul(a=0,b){return new Promise(function(c,d){setTimeout(function(){c(b)},a)})}function vl(a,b=a.userID,c=a.userName){if(Kb(a,b))return Promise.resolve();let d={userID:b,userName:c},e=a.maxUsers,f=a.database.ref(a.rootPath),g=f.push();return g.onDisconnect().remove().then(function(){return g.set(d)}).then(function(){return ul(0)}).then(function(){return e===0?(a.isInList=!0,Promise.resolve()):f.limitToFirst(e).once("value").then(function(j){return Zp(j,b)?(a.isInList=!0,Promise.resolve()):(a.isInList=!1,g.remove().then(function(){return g.onDisconnect().cancel()}).then(function(){return Promise.reject()}))})})}function Zp(a,b){let c=!1;return a.forEach(function(d){let e=d.val();if(e.userID===b)return c=!0,!0}),c}function wl(a,b=a.userID){if(!Kb(a,b))return Promise.resolve();let c=a.userID2ItemID.get(b),d=a.database.ref(a.rootPath).child(c);return d.remove()}function tl(a,b){return new Promise(function(c,d){let e=Me(a);if(e)return c(e);{let f=a.rootRef.orderByChild("userID").equalTo(a.userID);f.once("child_added").then(function(g){return c(g.ref)})}}).then(function(c){return c.child("userName").set(b)}).then(function(){return a.userName=b,Promise.resolve()})}const P6=Ha(Na());class Kc extends ua{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,eventNames:f=xl}={}){super();this.setEventEmitter(a),this.eventNames=f,this.database=P6.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.setMaxUsers(e),this.userList=new ic({eventEmitter:this.eventEmitter,itemIDKey:"joinAt",eventNames:{add:f.join,remove:f.leave,update:f.update,change:f.change}}),this.isInList=!1,this.userID2ItemID=new Map(),this.userList.on(this.eventNames.join,function(g){this.userID2ItemID.set(g.userID,g.joinAt),g.userID===this.userInfo.userID&&this.emit(this.eventNames.init,ah(this))},this).on(this.eventNames.leave,function(g){this.userID2ItemID.delete(g.userID),g.userID===this.userID&&(this.isInList=!1)},this).on(this.eventNames.change,function(g,j){let i=g.userID,k=g.userName,n=j.userName;k!==n&&this.emit(this.eventNames.changename,i,k,n)},this)}destroy(){this.stopUpdate().destroyEventEmitter().leave(),this.userList.destroy()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setMaxUsers(a){return this.maxUsers=a,this}clear(){return zl(this),this}forEach(a,b){return Al(this,a,b),this}isFull(){return Cl(this)}isFirstUser(a=this.userID){return Bl(this,a)}getUser(a=this.userID){return yl(this,a)}getUsers(){return ah(this)}getUserRef(a=this.userID){return Me(this,a)}contains(a=this.userID){return Kb(this,a)}join(a=this.userID,b=this.userName){return vl(this,a,b)}leave(a=this.userID){return wl(this,a)}changeUserName(a){return tl(this,a)}startUpdate(){let a=this.rootRef;return this.maxUsers>0&&(a=a.limitToFirst(this.maxUsers)),this.userList.startUpdate(a),this}stopUpdate(){return this.userList.stopUpdate(),this}}const jc="room.join";const Mb="room.leave";const wh="userlist.join";const xh="userlist.leave";const zh="userlist.init";const yh="userlist.update";const ld="userlist.changename";const hh="broadcast.receive";function lh(a){return`tables.${a}.init`}function mh(a){return`tables.${a}.update`}function nh(a){return`tables.${a}.addkey0`}function oh(a){return`tables.${a}.addkey1`}function ph(a){return`tables.${a}.addkey2`}function qh(a){return`tables.${a}.removekey0`}function rh(a){return`tables.${a}.removekey1`}function sh(a){return`tables.${a}.removekey2`}function th(a){return`tables.${a}.changekey0`}function uh(a){return`tables.${a}.changekey1`}function vh(a){return`tables.${a}.changekey2`}const ih="roomlist.add";const jh="roomlist.remove";const kh="roomlist.update";function Pl(a){const b=new Kc({eventEmitter:a.eventEmitter,eventNames:{join:wh,leave:xh,update:yh,change:"userlist.change",init:zh,changename:ld},userID:a.userInfo});return b.on("userlist.leave",function(c){c.userID===a.userID&&cq(a)}),a.on(jc,function(){b.startUpdate()}).on(Mb,function(){b.stopUpdate().clear()}),b}function cq(a){a.emit(Mb),setTimeout(function(){a.roomID=void 0,a.roomName=void 0,a.doorState=void 0,a.leftRoomFlag=!1},0)}function Ml(a){const b=new ic({eventEmitter:a.eventEmitter,itemIDKey:"roomID",eventNames:{update:kh,add:ih,remove:jh,change:"roomlist.change"},mode:"once"});return b}function Wl(a){return a.split("|")[0]}function Vl(a){return a.split("|")[1]}function Lc(a,b=""){return`${a}|${b}`}function jb(a,b){let c=a.rootRef;return b&&(c=c.child(b)),c}function md(a,b,c){let d=jb(a,"rooms");return b!==void 0&&(d=d.child(b),c!==void 0&&(d=d.child(c))),d}function Ll(a,b){return md(a,b,"alive")}function Ql(a,b){return md(a,b,"users")}function kd(a,b){let c=jb(a,"room-filters");return b!==void 0&&(c=c.child(b)),c}function Mc(a,b){let c=jb(a,"room-metadata");return b!==void 0&&(c=c.child(b)),c}function Oe(a,b,c){let d=`${a.rootPath}/rooms/${b}`;return c&&(d+=`/${c}`),d}function Re(a,b){return Oe(a,b,"users")}function Nl(a,b,c){let d=Oe(a,b,"tables");return c&&(d+=`/${c}`),d}function Rl(a,b,c="open"){let d=kd(a);return d=d.orderByChild("filter"),b===void 0?d=d.startAt(c).endAt(`${c}~`):d=d.equalTo(Lc(c,b)),d}function Il(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new Ic({eventEmitter:a.eventEmitter,eventNames:{receive:hh},receiverID:"boradcast",senderID:a.userInfo,history:b.history});return a.on(jc,function(d){c.setRootPath(Oe(a,d.roomID)).startReceiving()}).on(Mb,function(){c.stopReceiving()}).on(ld,function(d,e){c.changeUserName(d,e)}),c}function Ol(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,bq(a,d))}),a.on(jc,function(d){for(const[e,f]of c)f.setRootPath(Nl(a,d.roomID,e)).startUpdate()}).on(Mb,function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function bq(a,{key:b,type:c=qa["1d"]}){const d=new Jc({eventEmitter:a.eventEmitter,type:c,eventNames:{init:lh(b),update:mh(b),addkey0:nh(b),removekey0:qh(b),changekey0:th(b),addkey1:oh(b),removekey1:rh(b),changekey1:uh(b),addkey2:ph(b),removekey2:sh(b),changekey2:vh(b)}});return d}function Sa(a,b=a.roomID,c=a.roomName){return{roomID:b,roomName:c}}function Ve(a,b){return b===void 0?a.roomID!==void 0:a.roomID===b}function Zl(a){return a.userList.isFull()}function _l(a,b=a.userID){return a.userList.isFirstUser(b)}function $l(a){return a.userList.getUsers()}function Se(a,b,c,d){a.roomID=b,a.roomName=c,a.roomType=d,a.emit("room.join",Sa(a))}function Qe(a,b={}){return b.roomID==null&&(b.roomID=md(a).push().key),$p(a,b.roomID).then(function(){return aq(a,b)})}function $p(a,b){return Ll(a,b).transaction(function(c){return c===null?!0:void 0})}function aq(a,{roomID:b,roomName:c="",roomType:d="",maxUsers:e=0,presisted:f=!1,door:g="open",join:j=!0,filterData:i}){let k=md(a,b),n=kd(a,b),q=Mc(a,b);a.isRemoveRoomWhenLeft=!f,a.isRemoveRoomWhenLeft&&(k.onDisconnect().remove(),n.onDisconnect().remove(),q.onDisconnect().remove());const t=Lc(g,d),u={},x={filter:t,name:c};i&&(x.data=i),u[`room-filters/${b}`]=x;const z={name:c,filter:t,maxUsers:e,moderators:{}};return z.moderators[a.userID]=a.userName,u[`room-metadata/${b}`]=z,new Promise(function(H,K){if(j){const I=a.userList.setRootPath(Re(a,b)).setMaxUsers(0).join();return a.userList.setMaxUsers(e),I.then(H,K)}else return H()}).then(function(){return jb(a).update(u)}).then(function(){return a.isRoomCreator=!0,j&&Se(a,b,c,d),Promise.resolve(Sa(a))})}function Jl(a,{digits:b=10,candidates:c="0123456789",retry:d=1e3}){let e=arguments[1];return Kl(a,b,c,d,e)}function Kl(a,b,c,d,e){return e.roomID=Pe(b,b,c),d<=0?Promise.reject(e):(d--,Qe(a,e).catch(function(){return Kl(a,b,c,d,e)}))}function We(a,b=a.roomID){const c={};c[`room-filter/${b}`]=null,c[`room-metadata/${b}`]=null,c[`rooms/${b}`]=null;const d=Sa(a);return jb(a).update(c).then(function(){return Promise.resolve(d)})}function Nc(a){if(!Ve(a))return Promise.resolve(Sa(a));a.leftRoomFlag=!0;if(a.isRemoveRoomWhenLeft)return We(a);{const b=Sa(a);return a.userList.leave().then(function(){return Promise.resolve(b)})}}function Ue(a,{leftThenJoin:b=!0,roomID:c}){return b?Nc(a).then(function(){return Xl(a,c)}):Xl(a,c)}function Xl(a,b){return b==null?Promise.reject(Sa(a,b,"")):(a.isRemoveRoomWhenLeft=!1,dq(a,b).then(function(c){return a.userList.setRootPath(Re(a,b)).setMaxUsers(c.maxUsers).join().then(function(){return Promise.resolve(c)})}).then(function(c){return Se(a,b,c.name,Vl(c.filter)),Promise.resolve(Sa(a))}))}function dq(a,b){return Mc(a,b).once("value").then(function(c){let d=c.val();return eq(a,d)?Promise.resolve(d):Promise.reject()})}function eq(a,b){if(b==null)return!1;if(Wl(b.filter)==="closed")return!1;const c=a.userID;if(b.moderators[c])return!0;switch(b.permission){case"blocklist":const d=b.blocklist;return!(d&&d[c]);case"allowlist":const e=b.allowlist;return e&&e[c];default:return!0}}function Te(a,b,c){return new Promise(function(d,e){a.roomList.once("roomlist.update",function(f){d(f)}).startUpdate(Rl(a,b,c))})}function Tl(a,{roomType:b="",leftThenJoin:c=!0}={}){return Te(a,b,"open").then(function(d){if(d.length===0)return Promise.reject("No filtered room");gc(d);const e={leftThenJoin:c,roomID:""};return Ul(a,e,d)})}function Ul(a,b,c,d=0){return d===c.length?Promise.reject("Can't join any room"):(b.roomID=c[d].roomID,d++,Ue(a,b).catch(function(){return Ul(a,b,c,d)}))}function Yl(a,b){return a.userList.contains(b)?b===a.userID?Nc(a):a.userList.leave(b):Promise.resolve()}function Lb(a,b){return b===a.roomID?Promise.resolve(!0):Mc(a,b).once("value").then(function(c){const d=c.val()!==null;return Promise.resolve(d)})}function Ne(a,b,c=a.roomID){return Lb(a,c).then(function(d){if(!d)return Promise.resolve();const e=Lc(b,a.roomType),f={};return f[`room-filters/${c}/filter`]=e,f[`room-metadata/${c}/filter`]=e,jb(a).update(f)})}function Fl(a,b=a.roomID){return Ne(a,"open",b)}function Gl(a,b=a.roomID){return Ne(a,"closed",b)}function Dl(a,b,c=a.roomID){return Lb(a,c).then(function(d){return d?kd(a,c).child("data").update(b):Promise.resolve()})}function Hl(a,b){return a.userList.changeUserName(b)}function El(a,b,c=a.roomID){return Lb(a,c).then(function(d){if(!d)return Promise.resolve();const e={};return e[`room-filters/${c}/name`]=b,e[`room-metadata/${c}/name`]=b,jb(a).update(e)})}function Sl(a,b=a.roomID){return b===a.roomID?a.userList.getUsers():new Promise(function(c,d){const e=new ic({itemIDKey:"joinAt",mode:"once"});e.once("update",function(f){c(f)}).startUpdate(Ql(a,b))})}const A8=Ha(Na());class am extends ua{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",broadcast:e=!0,tables:f=!1}={}){super();this.setEventEmitter(a),this.database=A8.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.isRoomCreator=!1,this.roomID=void 0,this.roomName=void 0,this.roomType=void 0,this.doorState=void 0,this.leftRoomFlag=!1,this.isRemoveRoomWhenLeft=void 0,this.userList=Pl(this),this.roomList=Ml(this),this.broadcast=Il(this,e),this.tables=Ol(this,f)}destroy(){var a=this;this.destroyEventEmitter().leaveRoom().then(function(){a.userList.destroy(),a.userList=void 0,a.roomList.destroy(),a.roomList=void 0,a.broadcast.destroy(),a.broadcast=void 0})}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}getRoomInfo(a,b){return Sa(this,a,b)}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(a){return Ve(this,a)}isFull(){return Zl(this)}isFirstUser(a=this.userID){return _l(this,a)}getUsers(){return $l(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}createRoom(a){return Qe(this,a)}createRandomRoom(a={}){return Jl(this,a)}joinRoom(a){return Ue(this,a)}joinRandomRoom(a={}){return Tl(this,a)}leaveRoom(){return Nc(this)}removeRoom(a=this.roomID){return We(this,a)}kickUser(a){return Yl(this,a)}changeRoomState(a,b=this.roomID){return Ne(this,a,b)}openRoom(a=this.roomID){return Fl(this,a)}closeRoom(a=this.roomID){return Gl(this,a)}changeUserName(a){return Hl(this,a)}changeFilterData(a,b=this.roomID){return Dl(this,a,b)}changeRoomName(a,b,c=a.roomID){return El(this,b,c)}getUserList(a=this.roomID){return Sl(this,a)}getRoomList(a,b){return Te(this,a,b)}HasRoom(a){return Lb(this,a)}}function hm(a,b){let c=a.rootPath;return b&&(c+=`/${b}`),c}function fm(a){return hm(a,"users")}function dm(a,b){return`${hm(a,"tables")}/${b}`}const wb="room.join";const Nb="room.leave";const Mh="userlist.join";const Xe="userlist.leave";const Oh="userlist.init";const Nh="userlist.update";const nd="userlist.changename";const Ah="broadcast.receive";function Bh(a){return`tables.${a}.init`}function Ch(a){return`tables.${a}.update`}function Dh(a){return`tables.${a}.addkey0`}function Eh(a){return`tables.${a}.addkey1`}function Fh(a){return`tables.${a}.addkey2`}function Gh(a){return`tables.${a}.removekey0`}function Hh(a){return`tables.${a}.removekey1`}function Ih(a){return`tables.${a}.removekey2`}function Jh(a){return`tables.${a}.changekey0`}function Kh(a){return`tables.${a}.changekey1`}function Lh(a){return`tables.${a}.changekey2`}function gm(a,b=0){const c=new Kc({eventEmitter:a.eventEmitter,eventNames:{join:Mh,leave:Xe,update:Nh,change:"userlist.change",init:Oh,changename:nd},root:fm(a),userID:a.userInfo,maxUsers:b});return c.on(Xe,function(d){d.userID===a.userID&&hq(a)}),a.on(wb,function(){c.startUpdate()}).on(Nb,function(){c.stopUpdate().clear()}),c}function hq(a){a.emit(Nb),setTimeout(function(){a.leftRoomFlag=!1},0)}function cm(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new Ic({eventEmitter:a.eventEmitter,eventNames:{receive:Ah},receiverID:"broadcast",senderID:a.userInfo,history:b.history});return a.on(wb,function(){c.setRootPath(a.rootPath).startReceiving()}).on(Nb,function(){c.stopReceiving()}).on(nd,function(d,e){c.changeUserName(d,e)}),c}function em(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,gq(a,d))}),a.on(wb,function(){for(const[d,e]of c)e.setRootPath(dm(a,d)).startUpdate()}).on(Nb,function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function gq(a,{key:b,type:c=qa["1d"]}){const d=new Jc({eventEmitter:a.eventEmitter,type:c,eventNames:{init:Bh(b),update:Ch(b),addkey0:Dh(b),removekey0:Gh(b),changekey0:Jh(b),addkey1:Eh(b),removekey1:Hh(b),changekey1:Kh(b),addkey2:Fh(b),removekey2:Ih(b),changekey2:Lh(b)}});return d}function Ze(a){return a.userList.isInList}function lm(a){return a.userList.isFull()}function mm(a,b=a.userID){return a.userList.isFirstUser(b)}function nm(a){return a.userList.getUsers()}function jm(a){return a.userList.join().then(function(){return a.emit(wb),Promise.resolve()})}function Ye(a){return Ze(a)?(a.leftRoomFlag=!0,a.userList.leave()):Promise.resolve()}function im(a){return a.userList.getUsers()}function km(a,b){return a.userList.contains(b)?b===a.userID?Ye(a):a.userList.leave(b):Promise.resolve()}function bm(a,b){return a.userList.changeUserName(b)}const maa=Ha(Na());class om extends ua{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,broadcast:f=!0,tables:g=!1}={}){const j=arguments[0];super();this.setEventEmitter(a),this.database=maa.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.leftRoomFlag=!1,this.userList=gm(this,e),this.broadcast=cm(this,f),this.tables=em(this,g)}shutdown(){}destroy(){this.shutdown()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(){return Ze(this)}isFull(){return lm(this)}isFirstUser(a=this.userID){return mm(this,a)}getUsers(){return nm(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}joinRoom(){return jm(this)}leaveRoom(){return Ye(this)}getUserList(){return im(this)}kickUser(a){return km(this,a)}changeUserName(a){return bm(this,a)}}const Ii="statechange";function Ji(a){return`exit_${a.toString()}`}function Ki(a){return`enter_${a.toString()}`}class Vn extends ua{constructor({eventEmitter:a}={}){super();this._states=new Map();this.enable=!0;this.setEventEmitter(a)}destroy(){this.destroyEventEmitter()}toJSON(){return{curState:this.state,prevState:this.prevState,enable:this.enable,start:this._start}}setEnable(a=!0){return this.enable=a,this}getState(a){return this._states.get(a)}addState(a){return this._states.set(a.name,a),this}addStates(a){for(let b=0,c=a.length;b<c;b++)this.addState(a[b]);return this}removeState(a){return this._states.delete(a),this}removeAllStates(){return this._states.clear(),this}set state(a){if(!this.enable||this._stateLock)return;if(this._state===a)return;this._prevState=this._state,this._state=a,this._stateLock=!0,this.emit(Ii,this);if(this._prevState!=null){const b=this.getState(this._prevState);b&&b.exit&&b.exit(this),this.emit(Ji(this._prevState),this)}this._stateLock=!1;if(this._state!=null){const b=this.getState(this._state);b&&b.enter&&b.enter(this),this.emit(Ki(this._state),this)}}get state(){return this._state}get prevState(){return this._prevState}get stateList(){return Array.from(this._states.keys())}start(a){return this._start=a,this._prevState=void 0,this._state=a,this}goto(a){return a!=null&&(this.state=a),this}next(){const a=this.getState(this.state);if(!a||!a.next)return this;let b;return typeof a.next==="string"?b=a.next:b=a.next(this),this.goto(b),this}update(a,b,c="update"){const d=this.getState(this.state);d&&d[c]&&d[c](this,a,b)}preupdate(a,b){this.update(b,a,"preupdate")}postupdate(a,b){this.update(b,a,"postupdate")}}var Li;(function(a){a[a.shuffle=0]="shuffle",a[a.random=1]="random"})(Li||(Li={}));const Oi="die";class Wn extends vf{constructor(a,{lifeTime:b=1e3,destroy:c=!0}={}){super(a,arguments[1]);this.setLifeTime(b),this.setDestroyMode(c)}resetFromJSON({lifeTime:a=1e3,destroy:b=!0}={}){return super.resetFromJSON(arguments[0]),this.setLifeTime(a),this.setDestroyMode(b),this}toJSON(){const a=super.toJSON();return a.lifeTime=this.lifeTime,a.destroy=this.destroyMode,a}setLifeTime(a){return this.lifeTime=a,this}addToLifeTime(a){return this.lifeTime+=a,this}setDestroyMode(a=!0){return this.destroyMode=a,this}get isAlive(){return this.now<this.lifeTime}get remainder(){let a=this.lifeTime-this.now;return a<0&&(a=0),a}update(a){return this.isRunning?(super.update(a),this.isAlive||(this.complete(Oi),this.destroyMode&&this.gameObject.destroy&&this.gameObject.destroy()),this):this}get gameObject(){return this.parent}}class wf{constructor(a,b,c,d,e){this.key=a,this.start=b,this.end=c,this.step=d,this.items=e,this._current=b}reset(){this._current=this.start}get isEnd(){return this.step>=0?this._current>=this.end:this._current<=this.end}get length(){return this.step>=0&&this.start>this.end||this.step<0&&this.start<this.end?0:Math.floor(this.end-this.start)+1}next(){return this.isEnd?this._current=this.start:this._current+=this.step,this}get current(){return this.items?this.items[this._current]:this._current}}class Yn{constructor(){this.indexes=[];this.length=0;this.firstPass=!0;this.currentCount=0}reset(){for(let a=0,b=this.indexes.length;a<b;a++)this.indexes[a].reset();return this.firstPass=!0,this.currentCount=0,this}addNumberLoop(a,b,c,d=c>=b?1:-1){return this.indexes.push(new wf(a,b,c,d)),this.length=this._getLength(),this}addItemsLoop(a,b,c=!1){const d=b.length-1,e=c?d:0,f=c?0:d,g=c?-1:1;return this.indexes.push(new wf(a,e,f,g,b)),this.length=this._getLength(),this}addLoop({key:a,start:b,end:c,step:d,items:e}){return this.indexes.push(new wf(a,b,c,d,e)),this.length=this._getLength(),this}removeLoops(){return this.indexes.length=0,this.length=0,this}_getLength(){let a=this.indexes[0]?.length;for(let b=1,c=this.indexes.length;b<c;b++)a*=this.indexes[b].length;return a??0}get progress(){return this.currentCount/this.length}get isEnd(){for(let a=this.indexes.length-1;a>=0;a--)if(!this.indexes[a].isEnd)return!1;return!0}next(){for(let a=this.indexes.length-1;a>=0;a--){const b=this.indexes[a],c=b.isEnd;b.next();if(!c)break}return this}getCurrent(a={}){for(let b=this.indexes.length-1;b>=0;b--){const c=this.indexes[b];a[c.key]=c.current}return a}getNext(a={}){return this.firstPass?this.firstPass=!1:this.next(),this.getCurrent(a),this.currentCount++,a}}const Ei="tickstart";const Fi="tickend";const br=1e3/60;class Xn extends xf{constructor(a,{callback:b,scope:c,deltaPercentage:d=1}={}){super(a,arguments[1]);this.deltaPercentage=1;this.loopIndexGenerator=new Yn();this.currentIndexes={};this.scene=a,this.setCallback(b,c),this.setDeltaPercentage(d),this.boot()}boot(){super.boot(),Tb(this.scene,"shutdown",this.destroy,this)}shutdown(){super.shutdown(),this.scene=void 0}destroy(){this.shutdown()}startTicking(){super.startTicking(),_a(this.scene,"update",this.preupdate,this)}stopTicking(){super.stopTicking(),this.scene&&qb(this.scene,"update",this.preupdate,this)}setCallback(a,b){return this.callback=a,this.scope=b,this}setDeltaPercentage(a){return this.deltaPercentage=a,this}addNumberLoop(a,b,c,d){return this.loopIndexGenerator.addNumberLoop(a,b,c,d),this}addItemsLoop(a,b,c=!1){return this.loopIndexGenerator.addItemsLoop(a,b,c),this}addLoop(a){return this.loopIndexGenerator.addLoop(a),this}get curTime(){return new Date().getTime()}get progress(){return this.loopIndexGenerator.progress}preupdate(){if(!this.callback)return;const a=this.curTime,b=br*this.deltaPercentage;let c;this.emit(Ei);do{if(this.loopIndexGenerator.isEnd){this.complete();return}this.currentIndexes=this.loopIndexGenerator.getNext(this.currentIndexes),this.scope?this.callback.call(this.scope,this.currentIndexes,this):this.callback(this.currentIndexes,this),c=this.curTime-a>=b}while(!c);this.emit(Fi)}}const Fpa=Ha(uo());var Mi;(function(a){a[a.none=0]="none",a[a.base64=1]="base64",a[a.utf16=2]="utf16",a[a.uri=3]="uri"})(Mi||(Mi={}));var Pb;(function(a){a[a.circle=0]="circle",a[a.ellipse=1]="ellipse",a[a.roundRectangle=2]="roundRectangle"})(Pb||(Pb={}));class Vm extends td{constructor(a,b,c,d,e=Pb.circle){super(a,b);this.type="rexMaskedImage",this.maskImage(c,d,e)}maskImage(a,b,c=Pb.circle){let d,e,f;typeof c==="object"?{maskType:d,backgroundStyle:e,radius:f}=c:d=c,typeof d==="string"&&(d=Pb[d]);const g=this.canvas,j=this.context,i=Ea.get();if(!i.has(a))return;const k=i.get(a).getFrame(b),n=k.width,q=k.height;g.width!==n&&(g.width=n),g.height!==q&&(g.height=q),j.clearRect(0,0,n,q),e&&(j.fillStyle=e,j.fillRect(0,0,n,q)),j.beginPath();switch(d){case Pb.roundRectangle:ff(j,0,0,n,q,f);break;default:const t=Math.floor(n/2),u=Math.floor(q/2);d===Pb.circle?j.arc(t,u,Math.min(t,u),0,2*Math.PI):j.ellipse(t,u,t,u,0,0,2*Math.PI);break}j.clip(),j.drawImage(k.texture.image,k.x,k.y,k.width,k.height),this.texture.setSize(n,q),this.setSize(n,q),this.updateTexture()}}let lr=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i;function Hc(a){let b;return a===""?b=null:lr.test(a)?b=parseFloat(a):a==="false"?b=!1:a==="true"?b=!0:b=a,b}const ela=Ha(qg());function Zn(a,{delimiter:b=",",convert:c=!0,types:d={}}={}){const e=ela.default.parse(a,{header:!0,delimiter:b}).data,f=d.question??"q",g=d.option??"",j=c===!0?Hc:c,i=[];let k,n;for(let q=0,t=e.length;q<t;q++){let u=e[q],x=u.type;delete u.type,x===f?(k=u,k.key===""&&delete k.key,$n(k,j),k.options=[],i.push(k)):x===g&&(k&&(n=u,n.key===""&&delete n.key,$n(n,j),k.options.push(n)))}return i}function $n(a,b){const c=a;if(!b)return c;for(const d in a)c[d]=b(a[d],d);return c}function Hi(a,b,c){typeof b==="string"&&(b=Zn(b,c));if(Array.isArray(b))for(let d=0,e=b.length;d<e;d++)_n(a,b[d]);else _n(a,b)}function _n(a,b){const c=b.options;if(c)for(let d=0,e=c.length;d<e;d++){let f=c[d];f.hasOwnProperty("key")||(f.key=`_${d}`)}b.hasOwnProperty("key")||(b.key=`_${a.questions.size}`),a.questions.set(b.key,b)}class Gi{constructor({questions:a}={}){this.questions=new Map();a&&Hi(this,a,arguments[0])}add(a,b){return Hi(this,a,b),this}remove(a){return this.questions.delete(a),this}removeAll(){return this.questions.clear(),this}has(a){return this.questions.has(a)}get(a){return this.questions.get(a)}getKeys(a=[]){const b=this.questions.keys();for(const c of b)a.push(c);return a}getOption(a,b){typeof a==="string"&&(a=this.get(a));if(!a)return null;const c=a.options;if(c)for(let d=0,e=c.length;d<e;d++){let f=c[d];if(f.key===b)return f}return null}}const yf="quest";class cr extends ua{constructor(a,{eventEmitter:b,shuffleQuestions:c=!1,shuffleOptions:d=!1}={}){super();this.questionKeys=[];this.setEventEmitter(b),Ie(a)&&(a=new Gi(a)),this.questionsManager=a,this.setShuffleQuestionsEnable(c),this.setShuffleOptionsEnable(d),this.init()}setShuffleQuestionsEnable(a=!0){return this.shuffleQuestionsEnable=a,this}setShuffleOptionsEnable(a=!0){return this.shuffleOptionsEnable=a,this}init(){return this.questionKeys.length=0,this.questionsManager.getKeys(this.questionKeys),this.shuffleQuestionsEnable&&gc(this.questionKeys),this.nextIndex=-1,this.nextKey=void 0,this}setNextKey(a){return a===void 0?(this.nextIndex++,this.nextKey=this.questionKeys[this.nextIndex]):this.questionsManager.has(a)&&(this.nextKey=a,this.nextIndex=this.questionKeys.indexOf(a)),this}setPrevKey(){return this.nextIndex--,this.nextKey=this.questionKeys[this.nextIndex],this}getQuestion(){const a=this.questionsManager.get(this.nextKey);if(a&&this.shuffleOptionsEnable){const b=a.options;b&&gc(b)}return a}getNextQuestion(a){return this.setNextKey(a).getQuestion()}getPrevQuestion(){return this.setPrevKey().getQuestion()}getOption(a,b){return b===void 0&&(b=a,a=this.getQuestion()),this.questionsManager.getOption(a,b)}next(a){const b=this.getNextQuestion(a);return b&&this.emit(yf,b,this,this.questionsManager),this}prev(){const a=this.getPrevQuestion();return a&&this.emit(yf,a,this,this.questionsManager),this}restart(a){return this.init(),this.next(a),this}get isLastQuestion(){return this.nextIndex===this.questionKeys.length-1}}function Oc(a=0,b={left:0,right:0,top:0,bottom:0}){if(typeof a==="number")b.left=a,b.right=a,b.top=a,b.bottom=a;else{let c,d,e,f;({left:c=0,right:d=0,top:e=0,bottom:f=0}=a),b.left=c,b.right=d,b.top=e,b.bottom=f}return b}function zb(a){return a.x-a.originX*a.width}function kc(a){return a.x+(.5-a.originX)*a.width}function ud(a){return a.x+a.originX*a.width}function lc(a){return a.y-a.originY*a.height}function mc(a){return a.y+(.5-a.originY)*a.height}function nc(a){return a.y+a.originY*a.height}function vd(a,b){a.x+=b-zb(a)}function wd(a,b){a.x+=b-kc(a)}function xd(a,b){a.x+=b-lc(a)}function yd(a,b){a.y+=b-zb(a)}function zd(a,b){a.y+=b-mc(a)}function Ad(a,b){a.y+=b-nc(a)}function Wm(a,b,c,d){if(a.rexSizer.hidden||!a.needLayout)return a;a.preLayout(b,c,d),c===void 0&&(c=Math.max(a.childrenWidth,a.minWidth)),d===void 0&&(d=Math.max(a.childrenHeight,a.minHeight)),a.resize(c,d),a.layoutBackgrounds(),a.postLayout(b,c,d)}function ji(a,b,c,d){if(b)return;a.layoutInit();const e=a.getChildrenSizers();for(var f=0,g=e.length;f<g;f++){const j=e[f];if(j.rexSizer.hidden||!j.needLayout)continue;ji(j)}}function gf(a){a._childrenWidth=void 0,a._childrenHeight=void 0}function hf(a,b,c){if(!a||b===void 0&&c===void 0)return;a.resize?(b===void 0&&(b=a.width),c===void 0&&(c=a.height),a.resize(b,c)):(b!==void 0&&(a.width=b),c!==void 0&&(a.height=c))}const Pc=new sb().setOrigin(0,0);function jf(a,b,c=db.CENTER,d=0,e=0){const f=c%3;switch(f){case 0:vd(a,zb(b));break;case 1:wd(a,kc(b));break;default:xd(a,ud(b));break}const g=Math.floor(c/3);switch(g){case 0:yd(a,lc(b));break;case 1:zd(a,mc(b));break;default:Ad(a,nc(b));break}a.x-=d,a.y-=e}function Xm(a){if(a.backgroundChildren===void 0)return;var b=0,c=0,d=a.width,e=a.height;const f=a.backgroundChildren;for(let g=0,j=f.length;g<j;g++){const i=f[g],k=i.rexSizer;if(k.hidden)continue;const n=k.padding,q=b+n.left,t=c+n.top,u=d-n.left-n.right,x=e-n.top-n.bottom;hf(i,u,x),Pc.setPosition(q,t).setSize(u,x),jf(i,Pc)}}function Ym(a,b,c,d){}function Zm(a,b){sc(a,b)}function _m(a){return a.hasOwnProperty("rexSizer")||(a.rexSizer={}),a.rexSizer}function $m(a,b,{padding:c=0,childKey:d}={}){a.backgroundChildren===void 0&&(a.backgroundChildren=[]),a.pin(b),a.backgroundChildren.push(b);const e=a.rexSizer;e.padding=Oc(c),d!==void 0&&a.addChildrenMap(d,b)}function an(a,b){return a.backgroundChildren===void 0?!1:a.backgroundChildren.indexOf(b)!==-1}function bn(a,b,c){a.childrenMap===void 0&&(a.childrenMap={}),a.childrenMap[b]=c}class Ta extends sb{constructor({space:a=0,name:b=""}={}){super();this.type="base";this.rexSizer={};this.needLayout=!0;this.minWidth=0;this._childrenWidth=0;this.minHeight=0;this._childrenHeight=0;this.space=Oc(a),this.name=b}get left(){return zb(this)}set left(a){vd(this,a)}alignLeft(a){return this.left=a,this}get right(){return ud(this)}set right(a){xd(this,a)}alignRight(a){return this.right=a,this}get innerLeft(){return this.left+this.space.left}get innerRight(){return this.right-this.space.right}get centerX(){return kc(this)}set centerX(a){wd(this,a)}alignCenterX(a){return this.centerX=a,this}get top(){return lc(this)}set top(a){yd(this,a)}alignTop(a){return this.top=a,this}get bottom(){return nc(this)}set bottom(a){Ad(this,a)}alignBottom(a){return this.bottom=a,this}get innerTop(){return this.top+this.space.top}get innerBottom(){return this.bottom-this.space.bottom}get centerY(){return mc(this)}set centerY(a){zd(this,a)}alignCenterY(a){return this.centerY=a,this}get innerWidth(){return this.width-this.space.left-this.space.right}get innerHeight(){return this.height-this.space.top-this.space.bottom}setMinSize(a,b){return this.setMinWidth(a).setMinHeight(b),this}setMinWidth(a=0){return this.minWidth=a,this}setMinHeight(a=0){return this.minHeight=a,this}getChildrenWidth(){return 0}getChildrenHeight(){return 0}get childrenWidth(){return this._childrenWidth===void 0&&(this._childrenWidth=this.getChildrenWidth()),this._childrenWidth}get childrenHeight(){return this._childrenHeight===void 0&&(this._childrenHeight=this.getChildrenHeight()),this._childrenHeight}resize(a=this.width,b=this.height){return this.setSize(a,b),this}getSizerState(a){return _m(a)}getChildrenSizers(a=[]){return a}layout(){return this._layout(),this}_layout(a,b,c){return Wm(this,a,b,c),this}preLayout(a,b,c){return ji(this,a,b,c),this}layoutInit(){return gf(this),this}layoutBackgrounds(){return Xm(this),this}postLayout(a,b,c){return Ym(this,a,b,c),this}pin(a){return Zm(this,a),this}addBackground(a,b){return $m(this,a,b),this}isBackground(a){return an(this,a)}addChildrenMap(a,b){return bn(this,a,b),this}}var Ua;(function(a){a[a.x=0]="x",a[a.h=0]="h",a[a.horizontal=0]="horizontal",a[a["left-to-right"]=0]="left-to-right",a[a.y=1]="y",a[a.v=1]="v",a[a.vertical=1]="vertical",a[a["top-to-bottom"]=1]="top-to-bottom"})(Ua||(Ua={}));function cn(a){const b=a.sizerChildren;let c=0;for(let d=0,e=b.length;d<e;d++){const f=b[d];if(f.rexSizer.hidden)continue;const g=f.rexSizer,j=g.proportion;j>0&&(c+=j)}return c}function dn(a,b=!0){if(a.rexSizer.hidden)return 0;b===void 0&&(b=!0);const c=a.sizerChildren;let d=0;if(a.orientation===0)for(var e=0,f=c.length;e<f;e++){const g=c[e],j=g.rexSizer;if(j.hidden)continue;let i;j.proportion===0||b&&!g.isRexSpace&&j.proportion>0?i=g instanceof Ta?Math.max(g.minWidth,g.childrenWidth):g.width:i=0;const k=j.padding;i+=k.left+k.right,e>0&&(i+=a.space.item),d+=i}else for(var e=0,f=c.length;e<f;e++){const g=c[e];if(!g.hasOwnProperty("rexSizer"))continue;const j=g.rexSizer;if(j.hidden)continue;let i=g instanceof Ta?Math.max(g.minWidth,g.childrenWidth):g.width;const k=j.padding;i+=k.left+k.right,d=Math.max(i,d)}return d+a.space.left+a.space.right}function en(a,b=!0){if(a.rexSizer.hidden)return 0;const c=a.sizerChildren;let d=0;if(a.orientation===0)for(var e=0,f=c.length;e<f;e++){const g=c[e],j=g.rexSizer;if(j.hidden)continue;let i=g instanceof Ta?Math.max(g.minHeight,g.childrenHeight):g.height;const k=j.padding;i+=k.top+k.bottom,d=Math.max(i,d)}else for(var e=0,f=c.length;e<f;e++){const g=c[e];if(!g.hasOwnProperty("rexSizer"))continue;const j=g.rexSizer;if(j.hidden)continue;let i;j.proportion===0||b&&!g.isRexSpace&&j.proportion>0?i=g instanceof Ta?Math.max(g.minHeight,g.childrenHeight):g.height:i=0;const k=j.padding;i+=k.top+k.bottom,e>0&&(i+=a.space.item),d+=i}return d+a.space.top+a.space.bottom}function fn(a,b=[]){const c=a.sizerChildren;for(var d=0,e=c.length;d<e;d++){const f=c[d];f instanceof Ta&&b.push(f)}return b}function mn(a,b){let c;const d=b.rexSizer,e=d.padding;return a.orientation===Ua.x?d.proportion>0&&a.proportionLength>0&&(c=d.proportion*a.proportionLength):d.expand&&(c=a.innerWidth-e.left-e.right),c}function ln(a,b){let c;const d=b.rexSizer,e=d.padding;return a.orientation===Ua.x?d.expand&&(c=a.innerHeight-e.top-e.bottom):d.proportion>0&&a.proportionLength>0&&(c=d.proportion*a.proportionLength),c}function gn(a,b,c,d){if(a.rexSizer.hidden||!a.needLayout)return;a.preLayout(b),c===void 0&&(c=Math.max(a.childrenWidth,a.minWidth)),d===void 0&&(d=Math.max(a.childrenHeight,a.minHeight)),a.resize(c,d);let e;if(a.childrenProportion>0){let t=a.orientation===Ua.x?a.width-a.childrenWidth:a.height-a.childrenHeight;t>0?(t=a.orientation===Ua.x?a.width-a.getChildrenWidth(!1):a.height-a.getChildrenHeight(!1),e=t/a.childrenProportion):e=0}else e=0;a.proportionLength=e;const f=a.sizerChildren,g=a.left,j=a.top,i=a.innerWidth,k=a.innerHeight;let n=g,q=j;for(let t=0,u=f.length;t<u;t++){const x=f[t];if(x.rexSizer.hidden)continue;const z=x.rexSizer,H=z.padding;let K=mn(a,x),I=ln(a,x);x instanceof Ta?x._layout(a,K,I):hf(x,K,I),K===void 0&&(K=x.width),I===void 0&&(I=x.height);let N,J,P,Q;a.orientation===Ua.x?(N=n+H.left,z.proportion===0||e===0?P=K:P=z.proportion*e,J=q+H.top,Q=k-H.top-H.bottom):(N=n+H.left,P=i-H.left-H.right,J=q+H.top,z.proportion===0||e===0?Q=I:Q=z.proportion*e),Pc.setPosition(N,J).setSize(P,Q),jf(x,Pc,z.align),a.orientation===Ua.x?n+=P+H.left+H.right+a.space.item:q+=Q+H.top+H.bottom+a.space.item}a.layoutBackgrounds(),a.postLayout()}function hn(a){gf(a),a._childrenProportion=void 0}function kf(a,b,{proportion:c=0,align:d=db.CENTER,padding:e=0,expand:f=!1,childKey:g,index:j}={}){a.pin(b),typeof d==="string"&&(d=db[d]);const i=a.getSizerState(b);i.proportion=c,i.align=d,i.padding=Oc(e),i.expand=f,j===void 0||j>=a.sizerChildren.length?a.sizerChildren.push(b):a.sizerChildren.splice(j,0,b),g!==void 0&&a.addChildrenMap(g,b)}class kn extends sb{}function jn(a,b=1){const c=new kn();kf(a,c,{proportion:b})}class tc extends Ta{constructor({space:a={item:0},orientation:b=Ua.x}={}){super(arguments[0]);this.type="sizer";this.sizerChildren=[];this.setOrientation(b),this.setItemSpacing(a.item)}setOrientation(a){return typeof a==="string"&&(a=Ua[a]),this.orientation=a,this}setItemSpacing(a=0){return this.space.item=a,this}get childrenProportion(){return this._childrenProportion===void 0&&(this._childrenProportion=cn(this)),this._childrenProportion}getChildrenWidth(a=!0){return dn(this,a)}getChildrenHeight(a=!0){return en(this,a)}getChildrenSizers(a=[]){return fn(this,a)}_layout(a,b,c){return gn(this,a,b,c),this}layoutInit(){return hn(this),this}add(a,b){return kf(this,a,b),this}addSpace(a=1){return jn(this,a),this}}var Ng;(function(a){a[a.ascending=0]="ascending",a[a.descending=1]="descending",a[a.logical_ascending=2]="logical_ascending",a[a.logical_descending=3]="logical_descending"})(Ng||(Ng={}));class xo extends Hd{constructor(){super();Nf("icon",{width:32,height:32,fillStyle:"white"});const a=zo("Items",5).layout().setPosition(400,300),b=new Kf(this);sc(b,a)}}function yo(a){const b=new Za(0,0,"icon");Lf(Mf(0,16777216),b);const c=new Id(0,0,a,"30px monospace"),d=new tc({space:{item:10},orientation:"x"}).add(b).add(c);return d}function zo(a="Table",b=3){const c=new tc({space:{item:10},orientation:"y"}),d=new Id(0,0,a,"36px monospace");c.add(d,{padding:{bottom:5}});for(let e=0;e<b;e++)c.add(yo(`Item${e}`));return c}new Yi(Jf(),If(800,600),Gf("game"),Ff(2960685),Hf(xo));})();
/* @license
Papa Parse
v5.3.0
https://github.com/mholt/PapaParse
License: MIT
*/
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

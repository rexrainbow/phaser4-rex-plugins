(()=>{var Nf=Object.defineProperty,To=Object.prototype.hasOwnProperty,mb=(a,b)=>()=>(b||(b={exports:{}},a(b.exports,b)),b.exports),Uo=a=>Nf(a,"__esModule",{value:!0}),Pb=(a,b)=>{Uo(a);for(var c in b)Nf(a,c,{get:b[c],enumerable:!0})},Mr=(a,b)=>{Uo(a);if(typeof b==="object"||typeof b==="function")for(let c in b)To.call(b,c)&&!To.call(a,c)&&c!=="default"&&Nf(a,c,{get:()=>b[c],enumerable:!0});return a},Ka=a=>a&&a.__esModule?a:Mr(Nf({},"default",{value:a,enumerable:!0}),a);var wg=mb((a,b)=>{!function(c,d){"function"==typeof define&&define.amd?define([],d):"object"==typeof b&&"undefined"!=typeof a?b.exports=d():c.Papa=d()}(a,function c(){"use strict";var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==d?d:{},e=!d.document&&!!d.postMessage,f=e&&/blob:/i.test((d.location||{}).protocol),g={},i=0,h={parse:function(r,t){var j=(t=t||{}).dynamicTyping||!1;L(j)&&(t.dynamicTypingFunction=j,j={});if(t.dynamicTyping=j,t.transform=!!L(t.transform)&&t.transform,t.worker&&h.WORKERS_SUPPORTED){var m=function(){if(!h.WORKERS_SUPPORTED)return!1;var q=(p=d.URL||d.webkitURL||null,E=c.toString(),h.BLOB_URL||(h.BLOB_URL=p.createObjectURL(new Blob(["(",E,")();"],{type:"text/javascript"})))),w=new d.Worker(q),p,E;return w.onmessage=J,w.id=i++,g[w.id]=w}();return m.userStep=t.step,m.userChunk=t.chunk,m.userComplete=t.complete,m.userError=t.error,t.step=L(t.step),t.chunk=L(t.chunk),t.complete=L(t.complete),t.error=L(t.error),delete t.worker,void m.postMessage({input:r,config:t,workerId:m.id})}var l=null;return h.NODE_STREAM_INPUT,"string"==typeof r?l=t.download?new o(t):new u(t):!0===r.readable&&L(r.read)&&L(r.on)?l=new v(t):(d.File&&r instanceof File||r instanceof Object)&&(l=new s(t)),l.stream(r)},unparse:function(r,t){var j=!1,m=!0,l=",",q=`\r
`,w='"',p=w+w,E=!1,H=null;!function(){if("object"!=typeof t)return;"string"!=typeof t.delimiter||h.BAD_DELIMITERS.filter(function(D){return-1!==t.delimiter.indexOf(D)}).length||(l=t.delimiter),("boolean"==typeof t.quotes||"function"==typeof t.quotes||Array.isArray(t.quotes))&&(j=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(E=t.skipEmptyLines),"string"==typeof t.newline&&(q=t.newline),"string"==typeof t.quoteChar&&(w=t.quoteChar),"boolean"==typeof t.header&&(m=t.header);if(Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");H=t.columns}void 0!==t.escapeChar&&(p=t.escapeChar+w)}();var X=new RegExp(G(w),"g");"string"==typeof r&&(r=JSON.parse(r));if(Array.isArray(r)){if(!r.length||Array.isArray(r[0]))return Y(null,r,E);if("object"==typeof r[0])return Y(H||C(r[0]),r,E)}else if("object"==typeof r)return"string"==typeof r.data&&(r.data=JSON.parse(r.data)),Array.isArray(r.data)&&(r.fields||(r.fields=r.meta&&r.meta.fields),r.fields||(r.fields=Array.isArray(r.data[0])?r.fields:C(r.data[0])),Array.isArray(r.data[0])||"object"==typeof r.data[0]||(r.data=[r.data])),Y(r.fields||[],r.data||[],E);throw new Error("Unable to serialize unrecognized input");function C(D){if("object"!=typeof D)return[];var M=[];for(var _ in D)M.push(_);return M}function Y(D,M,_){var ia="";"string"==typeof D&&(D=JSON.parse(D)),"string"==typeof M&&(M=JSON.parse(M));var oa=Array.isArray(D)&&0<D.length,qa=!Array.isArray(M[0]);if(oa&&m){for(var ma=0;ma<D.length;ma++)0<ma&&(ia+=l),ia+=Q(D[ma],ma);0<M.length&&(ia+=q)}for(var V=0;V<M.length;V++){var ea=oa?D.length:M[V].length,ja=!1,ka=oa?0===Object.keys(M[V]).length:0===M[V].length;if(_&&!oa&&(ja="greedy"===_?""===M[V].join("").trim():1===M[V].length&&0===M[V][0].length),"greedy"===_&&oa){for(var T=[],U=0;U<ea;U++){var ga=qa?D[U]:U;T.push(M[V][ga])}ja=""===T.join("").trim()}if(!ja){for(var R=0;R<ea;R++){0<R&&!ka&&(ia+=l);var fa=oa&&qa?D[R]:R;ia+=Q(M[V][fa],R)}V<M.length-1&&(!_||0<ea&&!ka)&&(ia+=q)}}return ia}function Q(D,M){if(null==D)return"";if(D.constructor===Date)return JSON.stringify(D).slice(1,25);var _=D.toString().replace(X,p),ia="boolean"==typeof j&&j||"function"==typeof j&&j(D,M)||Array.isArray(j)&&j[M]||function(oa,qa){for(var ma=0;ma<qa.length;ma++)if(-1<oa.indexOf(qa[ma]))return!0;return!1}(_,h.BAD_DELIMITERS)||-1<_.indexOf(l)||" "===_.charAt(0)||" "===_.charAt(_.length-1);return ia?w+_+w:_}}};if(h.RECORD_SEP=String.fromCharCode(30),h.UNIT_SEP=String.fromCharCode(31),h.BYTE_ORDER_MARK="ï»¿",h.BAD_DELIMITERS=["\r",`
`,'"',h.BYTE_ORDER_MARK],h.WORKERS_SUPPORTED=!e&&!!d.Worker,h.NODE_STREAM_INPUT=1,h.LocalChunkSize=10485760,h.RemoteChunkSize=5242880,h.DefaultDelimiter=",",h.Parser=K,h.ParserHandle=y,h.NetworkStreamer=o,h.FileStreamer=s,h.StringStreamer=u,h.ReadableStreamStreamer=v,d.jQuery){var k=d.jQuery;k.fn.parse=function(r){var t=r.config||{},j=[];return this.each(function(q){if(!("INPUT"===k(this).prop("tagName").toUpperCase()&&"file"===k(this).attr("type").toLowerCase()&&d.FileReader)||!this.files||0===this.files.length)return!0;for(var w=0;w<this.files.length;w++)j.push({file:this.files[w],inputElem:this,instanceConfig:k.extend({},t)})}),m(),this;function m(){if(0!==j.length){var q,w,p,E,H=j[0];if(L(r.before)){var X=r.before(H.file,H.inputElem);if("object"==typeof X){if("abort"===X.action)return q="AbortError",w=H.file,p=H.inputElem,E=X.reason,void(L(r.error)&&r.error({name:q},w,p,E));if("skip"===X.action)return void l();"object"==typeof X.config&&(H.instanceConfig=k.extend(H.instanceConfig,X.config))}else if("skip"===X)return void l()}var C=H.instanceConfig.complete;H.instanceConfig.complete=function(Y){L(C)&&C(Y,H.file,H.inputElem),l()},h.parse(H.file,H.instanceConfig)}else L(r.complete)&&r.complete()}function l(){j.splice(0,1),m()}}}function n(r){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(t){var j=O(t);j.chunkSize=parseInt(j.chunkSize),t.step||t.chunk||(j.chunkSize=null),this._handle=new y(j),(this._handle.streamer=this)._config=j}.call(this,r),this.parseChunk=function(t,j){if(this.isFirstChunk&&L(this._config.beforeFirstChunk)){var m=this._config.beforeFirstChunk(t);void 0!==m&&(t=m)}this.isFirstChunk=!1,this._halted=!1;var l=this._partialLine+t;this._partialLine="";var q=this._handle.parse(l,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var w=q.meta.cursor;this._finished||(this._partialLine=l.substring(w-this._baseIndex),this._baseIndex=w),q&&q.data&&(this._rowCount+=q.data.length);var p=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(f)d.postMessage({results:q,workerId:h.WORKER_ID,finished:p});else if(L(this._config.chunk)&&!j){if(this._config.chunk(q,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);q=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(q.data),this._completeResults.errors=this._completeResults.errors.concat(q.errors),this._completeResults.meta=q.meta),this._completed||!p||!L(this._config.complete)||q&&q.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),p||q&&q.meta.paused||this._nextChunk(),q}this._halted=!0},this._sendError=function(t){L(this._config.error)?this._config.error(t):f&&this._config.error&&d.postMessage({workerId:h.WORKER_ID,error:t,finished:!1})}}function o(r){var t;(r=r||{}).chunkSize||(r.chunkSize=h.RemoteChunkSize),n.call(this,r),this._nextChunk=e?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(j){this._input=j,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest(),this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),e||(t.onload=P(this._chunkLoaded,this),t.onerror=P(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!e),this._config.downloadRequestHeaders){var j=this._config.downloadRequestHeaders;for(var m in j)t.setRequestHeader(m,j[m])}if(this._config.chunkSize){var l=this._start+this._config.chunkSize-1;t.setRequestHeader("Range","bytes="+this._start+"-"+l)}try{t.send(this._config.downloadRequestBody)}catch(q){this._chunkError(q.message)}e&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:t.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(j){var m=j.getResponseHeader("Content-Range");return null===m?-1:parseInt(m.substring(m.lastIndexOf("/")+1))}(t),this.parseChunk(t.responseText)))},this._chunkError=function(j){var m=t.statusText||j;this._sendError(new Error(m))}}function s(r){var t,j;(r=r||{}).chunkSize||(r.chunkSize=h.LocalChunkSize),n.call(this,r);var m="undefined"!=typeof FileReader;this.stream=function(l){this._input=l,j=l.slice||l.webkitSlice||l.mozSlice,m?((t=new FileReader()).onload=P(this._chunkLoaded,this),t.onerror=P(this._chunkError,this)):t=new FileReaderSync(),this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var l=this._input;if(this._config.chunkSize){var q=Math.min(this._start+this._config.chunkSize,this._input.size);l=j.call(l,this._start,q)}var w=t.readAsText(l,this._config.encoding);m||this._chunkLoaded({target:{result:w}})},this._chunkLoaded=function(l){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(l.target.result)},this._chunkError=function(){this._sendError(t.error)}}function u(r){var t;n.call(this,r=r||{}),this.stream=function(j){return t=j,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var j,m=this._config.chunkSize;return m?(j=t.substring(0,m),t=t.substring(m)):(j=t,t=""),this._finished=!t,this.parseChunk(j)}}}function v(r){n.call(this,r=r||{});var t=[],j=!0,m=!1;this.pause=function(){n.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){n.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(l){this._input=l,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){m&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):j=!0},this._streamData=P(function(l){try{t.push("string"==typeof l?l:l.toString(this._config.encoding)),j&&(j=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(q){this._streamError(q)}},this),this._streamError=P(function(l){this._streamCleanUp(),this._sendError(l)},this),this._streamEnd=P(function(){this._streamCleanUp(),m=!0,this._streamData("")},this),this._streamCleanUp=P(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function y(r){var t,j,m,l=Math.pow(2,53),q=-l,w=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)(e[-+]?\d+)?\s*$/,p=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,E=this,H=0,X=0,C=!1,Y=!1,Q=[],D={data:[],errors:[],meta:{}};if(L(r.step)){var M=r.step;r.step=function(V){if(D=V,oa())ia();else{if(ia(),0===D.data.length)return;H+=V.data.length,r.preview&&H>r.preview?j.abort():(D.data=D.data[0],M(D,E))}}}function _(V){return"greedy"===r.skipEmptyLines?""===V.join("").trim():1===V.length&&0===V[0].length}function ia(){if(D&&m&&(ma("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+h.DefaultDelimiter+"'"),m=!1),r.skipEmptyLines)for(var V=0;V<D.data.length;V++)_(D.data[V])&&D.data.splice(V--,1);return oa()&&function(){if(!D)return;function ea(ka){L(r.transformHeader)&&(ka=r.transformHeader(ka)),Q.push(ka)}if(Array.isArray(D.data[0])){for(var ja=0;oa()&&ja<D.data.length;ja++)D.data[ja].forEach(ea);D.data.splice(0,1)}else D.data.forEach(ea)}(),function(){if(!D||!r.header&&!r.dynamicTyping&&!r.transform)return D;function ea(ka,T){var U,ga=r.header?{}:[];for(U=0;U<ka.length;U++){var R=U,fa=ka[U];r.header&&(R=U>=Q.length?"__parsed_extra":Q[U]),r.transform&&(fa=r.transform(fa,R)),fa=qa(R,fa),"__parsed_extra"===R?(ga[R]=ga[R]||[],ga[R].push(fa)):ga[R]=fa}return r.header&&(U>Q.length?ma("FieldMismatch","TooManyFields","Too many fields: expected "+Q.length+" fields but parsed "+U,X+T):U<Q.length&&ma("FieldMismatch","TooFewFields","Too few fields: expected "+Q.length+" fields but parsed "+U,X+T)),ga}var ja=1;return!D.data.length||Array.isArray(D.data[0])?(D.data=D.data.map(ea),ja=D.data.length):D.data=ea(D.data,0),r.header&&D.meta&&(D.meta.fields=Q),X+=ja,D}()}function oa(){return r.header&&0===Q.length}function qa(V,ea){return ja=V,r.dynamicTypingFunction&&void 0===r.dynamicTyping[ja]&&(r.dynamicTyping[ja]=r.dynamicTypingFunction(ja)),!0===(r.dynamicTyping[ja]||r.dynamicTyping)?"true"===ea||"TRUE"===ea||"false"!==ea&&"FALSE"!==ea&&(function(ka){if(w.test(ka)){var T=parseFloat(ka);if(q<T&&T<l)return!0}return!1}(ea)?parseFloat(ea):p.test(ea)?new Date(ea):""===ea?null:ea):ea;var ja}function ma(V,ea,ja,ka){var T={type:V,code:ea,message:ja};void 0!==ka&&(T.row=ka),D.errors.push(T)}this.parse=function(V,ea,ja){var ka=r.quoteChar||'"';if(r.newline||(r.newline=function(ga,R){ga=ga.substring(0,1048576);var fa=new RegExp(G(R)+"([^]*?)"+G(R),"gm"),S=(ga=ga.replace(fa,"")).split("\r"),xa=ga.split(`
`),z=1<xa.length&&xa[0].length<S[0].length;if(1===S.length||z)return`
`;for(var x=0,B=0;B<S.length;B++)`
`===S[B][0]&&x++;return x>=S.length/2?`\r
`:"\r"}(V,ka)),m=!1,r.delimiter)L(r.delimiter)&&(r.delimiter=r.delimiter(V),D.meta.delimiter=r.delimiter);else{var T=function(ga,R,fa,S,xa){var z,x,B,F;xa=xa||[",","	","|",";",h.RECORD_SEP,h.UNIT_SEP];for(var A=0;A<xa.length;A++){var W=xa[A],aa=0,$=0,ha=0;B=void 0;for(var da=new K({comments:S,delimiter:W,newline:R,preview:10}).parse(ga),ta=0;ta<da.data.length;ta++)if(fa&&_(da.data[ta]))ha++;else{var la=da.data[ta].length;$+=la,void 0!==B?0<la&&(aa+=Math.abs(la-B),B=la):B=la}0<da.data.length&&($/=da.data.length-ha),(void 0===x||aa<=x)&&(void 0===F||F<$)&&1.99<$&&(x=aa,z=W,F=$)}return{successful:!!(r.delimiter=z),bestDelimiter:z}}(V,r.newline,r.skipEmptyLines,r.comments,r.delimitersToGuess);T.successful?r.delimiter=T.bestDelimiter:(m=!0,r.delimiter=h.DefaultDelimiter),D.meta.delimiter=r.delimiter}var U=O(r);return r.preview&&r.header&&U.preview++,t=V,j=new K(U),D=j.parse(t,ea,ja),ia(),C?{meta:{paused:!0}}:D||{meta:{paused:!1}}},this.paused=function(){return C},this.pause=function(){C=!0,j.abort(),t=L(r.chunk)?"":t.substring(j.getCharIndex())},this.resume=function(){E.streamer._halted?(C=!1,E.streamer.parseChunk(t,!0)):setTimeout(E.resume,3)},this.aborted=function(){return Y},this.abort=function(){Y=!0,j.abort(),D.meta.aborted=!0,L(r.complete)&&r.complete(D),t=""}}function G(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function K(r){var t,j=(r=r||{}).delimiter,m=r.newline,l=r.comments,q=r.step,w=r.preview,p=r.fastMode,E=t=void 0===r.quoteChar?'"':r.quoteChar;if(void 0!==r.escapeChar&&(E=r.escapeChar),("string"!=typeof j||-1<h.BAD_DELIMITERS.indexOf(j))&&(j=","),l===j)throw new Error("Comment character same as delimiter");!0===l?l="#":("string"!=typeof l||-1<h.BAD_DELIMITERS.indexOf(l))&&(l=!1),`
`!==m&&"\r"!==m&&`\r
`!==m&&(m=`
`);var H=0,X=!1;this.parse=function(C,Y,Q){if("string"!=typeof C)throw new Error("Input must be a string");var D=C.length,M=j.length,_=m.length,ia=l.length,oa=L(q),qa=[],ma=[],V=[],ea=H=0;if(!C)return A();if(p||!1!==p&&-1===C.indexOf(t)){for(var ja=C.split(m),ka=0;ka<ja.length;ka++){if(V=ja[ka],H+=V.length,ka!==ja.length-1)H+=m.length;else if(Q)return A();if(!l||V.substring(0,ia)!==l){if(oa){if(qa=[],z(V.split(j)),W(),X)return A()}else z(V.split(j));if(w&&w<=ka)return qa=qa.slice(0,w),A(!0)}}return A()}for(var T=C.indexOf(j,H),U=C.indexOf(m,H),ga=new RegExp(G(E)+G(t),"g"),R=C.indexOf(t,H);;)if(C[H]!==t)if(l&&0===V.length&&C.substring(H,H+ia)===l){if(-1===U)return A();H=U+_,U=C.indexOf(m,H),T=C.indexOf(j,H)}else{if(-1!==T&&(T<U||-1===U)){if(!(T<R)){V.push(C.substring(H,T)),H=T+M,T=C.indexOf(j,H);continue}var fa=aa(T,R,U);if(fa&&void 0!==fa.nextDelim){T=fa.nextDelim,R=fa.quoteSearch,V.push(C.substring(H,T)),H=T+M,T=C.indexOf(j,H);continue}}if(-1===U)break;if(V.push(C.substring(H,U)),F(U+_),oa&&(W(),X))return A();if(w&&qa.length>=w)return A(!0)}else for(R=H,H++;;){if(-1===(R=C.indexOf(t,R+1)))return Q||ma.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:qa.length,index:H}),B();if(R===D-1)return B(C.substring(H,R).replace(ga,t));if(t!==E||C[R+1]!==E){if(t===E||0===R||C[R-1]!==E){-1!==T&&T<R+1&&(T=C.indexOf(j,R+1)),-1!==U&&U<R+1&&(U=C.indexOf(m,R+1));var S=x(-1===U?T:Math.min(T,U));if(C[R+1+S]===j){V.push(C.substring(H,R).replace(ga,t)),C[H=R+1+S+M]!==t&&(R=C.indexOf(t,H)),T=C.indexOf(j,H),U=C.indexOf(m,H);break}var xa=x(U);if(C.substring(R+1+xa,R+1+xa+_)===m){if(V.push(C.substring(H,R).replace(ga,t)),F(R+1+xa+_),T=C.indexOf(j,H),R=C.indexOf(t,H),oa&&(W(),X))return A();if(w&&qa.length>=w)return A(!0);break}ma.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:qa.length,index:H}),R++}}else R++}return B();function z($){qa.push($),ea=H}function x($){var ha=0;if(-1!==$){var da=C.substring(R+1,$);da&&""===da.trim()&&(ha=da.length)}return ha}function B($){return Q||(void 0===$&&($=C.substring(H)),V.push($),H=D,z(V),oa&&W()),A()}function F($){H=$,z(V),V=[],U=C.indexOf(m,H)}function A($){return{data:qa,errors:ma,meta:{delimiter:j,linebreak:m,aborted:X,truncated:!!$,cursor:ea+(Y||0)}}}function W(){q(A()),qa=[],ma=[]}function aa($,ha,da){var ta={nextDelim:void 0,quoteSearch:void 0},la=C.indexOf(t,ha+1);if(ha<$&&$<la&&(la<da||-1===da)){var Ba=C.indexOf(j,la);if(-1===Ba)return ta;la<Ba&&(la=C.indexOf(t,la+1)),ta=aa(Ba,la,da)}else ta={nextDelim:$,quoteSearch:ha};return ta}},this.abort=function(){X=!0},this.getCharIndex=function(){return H}}function J(r){var t=r.data,j=g[t.workerId],m=!1;if(t.error)j.userError(t.error,t.file);else if(t.results&&t.results.data){var l={abort:function(){m=!0,N(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:I,resume:I};if(L(j.userStep)){for(var q=0;q<t.results.data.length&&(j.userStep({data:t.results.data[q],errors:t.results.errors,meta:t.results.meta},l),!m);q++);delete t.results}else L(j.userChunk)&&(j.userChunk(t.results,l,t.file),delete t.results)}t.finished&&!m&&N(t.workerId,t.results)}function N(r,t){var j=g[r];L(j.userComplete)&&j.userComplete(t),j.terminate(),delete g[r]}function I(){throw new Error("Not implemented.")}function O(r){if("object"!=typeof r||null===r)return r;var t=Array.isArray(r)?[]:{};for(var j in r)t[j]=O(r[j]);return t}function P(r,t){return function(){r.apply(t,arguments)}}function L(r){return"function"==typeof r}return f&&(d.onmessage=function(r){var t=r.data;void 0===h.WORKER_ID&&t&&(h.WORKER_ID=t.workerId);if("string"==typeof t.input)d.postMessage({workerId:h.WORKER_ID,results:h.parse(t.input,t.config),finished:!0});else if(d.File&&t.input instanceof File||t.input instanceof Object){var j=h.parse(t.input,t.config);j&&d.postMessage({workerId:h.WORKER_ID,results:j,finished:!0})}}),(o.prototype=Object.create(n.prototype)).constructor=o,(s.prototype=Object.create(n.prototype)).constructor=s,(u.prototype=Object.create(u.prototype)).constructor=u,(v.prototype=Object.create(n.prototype)).constructor=v,h})});var hj=mb(r=>{Pb(r,{__assign:()=>c,__asyncDelegator:()=>K,__asyncGenerator:()=>G,__asyncValues:()=>J,__await:()=>y,__awaiter:()=>i,__classPrivateFieldGet:()=>P,__classPrivateFieldSet:()=>L,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>h,__importDefault:()=>O,__importStar:()=>I,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>s,__rest:()=>d,__spread:()=>u,__spreadArrays:()=>v,__values:()=>o});var a=function(j,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,q){l.__proto__=q}||function(l,q){for(var w in q)q.hasOwnProperty(w)&&(l[w]=q[w])},a(j,m)};function b(j,m){a(j,m);function l(){this.constructor=j}j.prototype=m===null?Object.create(m):(l.prototype=m.prototype,new l())}var c=function(){return c=Object.assign||function j(m){for(var l,q=1,w=arguments.length;q<w;q++){l=arguments[q];for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(m[p]=l[p])}return m},c.apply(this,arguments)};function d(j,m){var l={};for(var q in j)Object.prototype.hasOwnProperty.call(j,q)&&m.indexOf(q)<0&&(l[q]=j[q]);if(j!=null&&typeof Object.getOwnPropertySymbols==="function")for(var w=0,q=Object.getOwnPropertySymbols(j);w<q.length;w++)m.indexOf(q[w])<0&&Object.prototype.propertyIsEnumerable.call(j,q[w])&&(l[q[w]]=j[q[w]]);return l}function e(j,m,l,q){var w=arguments.length,p=w<3?m:q===null?q=Object.getOwnPropertyDescriptor(m,l):q,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")p=Reflect.decorate(j,m,l,q);else for(var H=j.length-1;H>=0;H--)(E=j[H])&&(p=(w<3?E(p):w>3?E(m,l,p):E(m,l))||p);return w>3&&p&&Object.defineProperty(m,l,p),p}function f(j,m){return function(l,q){m(l,q,j)}}function g(j,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(j,m)}function i(j,m,l,q){function w(p){return p instanceof l?p:new l(function(E){E(p)})}return new(l||(l=Promise))(function(p,E){function H(Y){try{C(q.next(Y))}catch(Q){E(Q)}}function X(Y){try{C(q.throw(Y))}catch(Q){E(Q)}}function C(Y){Y.done?p(Y.value):w(Y.value).then(H,X)}C((q=q.apply(j,m||[])).next())})}function h(j,m){var l={label:0,sent:function(){if(p[0]&1)throw p[1];return p[1]},trys:[],ops:[]},q,w,p,E;return E={next:H(0),throw:H(1),return:H(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function H(C){return function(Y){return X([C,Y])}}function X(C){if(q)throw new TypeError("Generator is already executing.");for(;l;)try{if(q=1,w&&(p=C[0]&2?w.return:C[0]?w.throw||((p=w.return)&&p.call(w),0):w.next)&&!(p=p.call(w,C[1])).done)return p;(w=0,p)&&(C=[C[0]&2,p.value]);switch(C[0]){case 0:case 1:p=C;break;case 4:return l.label++,{value:C[1],done:!1};case 5:l.label++,w=C[1],C=[0];continue;case 7:C=l.ops.pop(),l.trys.pop();continue;default:if(!(p=l.trys,p=p.length>0&&p[p.length-1])&&(C[0]===6||C[0]===2)){l=0;continue}if(C[0]===3&&(!p||C[1]>p[0]&&C[1]<p[3])){l.label=C[1];break}if(C[0]===6&&l.label<p[1]){l.label=p[1],p=C;break}if(p&&l.label<p[2]){l.label=p[2],l.ops.push(C);break}p[2]&&l.ops.pop(),l.trys.pop();continue}C=m.call(j,l)}catch(Y){C=[6,Y],w=0}finally{q=p=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}}function k(j,m,l,q){q===void 0&&(q=l),j[q]=m[l]}function n(j,m){for(var l in j)l!=="default"&&!m.hasOwnProperty(l)&&(m[l]=j[l])}function o(j){var m=typeof Symbol==="function"&&Symbol.iterator,l=m&&j[m],q=0;if(l)return l.call(j);if(j&&typeof j.length==="number")return{next:function(){return j&&q>=j.length&&(j=void 0),{value:j&&j[q++],done:!j}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(j,m){var l=typeof Symbol==="function"&&j[Symbol.iterator];if(!l)return j;var q=l.call(j),w,p=[],E;try{for(;(m===void 0||m-- >0)&&!(w=q.next()).done;)p.push(w.value)}catch(H){E={error:H}}finally{try{w&&!w.done&&(l=q.return)&&l.call(q)}finally{if(E)throw E.error}}return p}function u(){for(var j=[],m=0;m<arguments.length;m++)j=j.concat(s(arguments[m]));return j}function v(){for(var j=0,m=0,l=arguments.length;m<l;m++)j+=arguments[m].length;for(var q=Array(j),w=0,m=0;m<l;m++)for(var p=arguments[m],E=0,H=p.length;E<H;E++,w++)q[w]=p[E];return q}function y(j){return this instanceof y?(this.v=j,this):new y(j)}function G(j,m,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var q=l.apply(j,m||[]),w,p=[];return w={},E("next"),E("throw"),E("return"),w[Symbol.asyncIterator]=function(){return this},w;function E(D){q[D]&&(w[D]=function(M){return new Promise(function(_,ia){p.push([D,M,_,ia])>1||H(D,M)})})}function H(D,M){try{X(q[D](M))}catch(_){Q(p[0][3],_)}}function X(D){D.value instanceof y?Promise.resolve(D.value.v).then(C,Y):Q(p[0][2],D)}function C(D){H("next",D)}function Y(D){H("throw",D)}function Q(D,M){(D(M),p.shift(),p.length)&&H(p[0][0],p[0][1])}}function K(j){var m,l;return m={},q("next"),q("throw",function(w){throw w}),q("return"),m[Symbol.iterator]=function(){return this},m;function q(w,p){m[w]=j[w]?function(E){return(l=!l)?{value:y(j[w](E)),done:w==="return"}:p?p(E):E}:p}}function J(j){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=j[Symbol.asyncIterator],l;return m?m.call(j):(j=typeof o==="function"?o(j):j[Symbol.iterator](),l={},q("next"),q("throw"),q("return"),l[Symbol.asyncIterator]=function(){return this},l);function q(p){l[p]=j[p]&&function(E){return new Promise(function(H,X){E=j[p](E),w(H,X,E.done,E.value)})}}function w(p,E,H,X){Promise.resolve(X).then(function(C){p({value:C,done:H})},E)}}function N(j,m){return Object.defineProperty?Object.defineProperty(j,"raw",{value:m}):j.raw=m,j}function I(j){if(j&&j.__esModule)return j;var m={};if(j!=null)for(var l in j)Object.hasOwnProperty.call(j,l)&&(m[l]=j[l]);return m.default=j,m}function O(j){return j&&j.__esModule?j:{default:j}}function P(j,m){if(!m.has(j))throw new TypeError("attempted to get private field on non-instance");return m.get(j)}function L(j,m,l){if(!m.has(j))throw new TypeError("attempted to set private field on non-instance");return m.set(j,l),l}});var lj=mb(r=>{Pb(r,{__assign:()=>c,__asyncDelegator:()=>K,__asyncGenerator:()=>G,__asyncValues:()=>J,__await:()=>y,__awaiter:()=>i,__classPrivateFieldGet:()=>P,__classPrivateFieldSet:()=>L,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>h,__importDefault:()=>O,__importStar:()=>I,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>s,__rest:()=>d,__spread:()=>u,__spreadArrays:()=>v,__values:()=>o});var a=function(j,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,q){l.__proto__=q}||function(l,q){for(var w in q)q.hasOwnProperty(w)&&(l[w]=q[w])},a(j,m)};function b(j,m){a(j,m);function l(){this.constructor=j}j.prototype=m===null?Object.create(m):(l.prototype=m.prototype,new l())}var c=function(){return c=Object.assign||function j(m){for(var l,q=1,w=arguments.length;q<w;q++){l=arguments[q];for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(m[p]=l[p])}return m},c.apply(this,arguments)};function d(j,m){var l={};for(var q in j)Object.prototype.hasOwnProperty.call(j,q)&&m.indexOf(q)<0&&(l[q]=j[q]);if(j!=null&&typeof Object.getOwnPropertySymbols==="function")for(var w=0,q=Object.getOwnPropertySymbols(j);w<q.length;w++)m.indexOf(q[w])<0&&Object.prototype.propertyIsEnumerable.call(j,q[w])&&(l[q[w]]=j[q[w]]);return l}function e(j,m,l,q){var w=arguments.length,p=w<3?m:q===null?q=Object.getOwnPropertyDescriptor(m,l):q,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")p=Reflect.decorate(j,m,l,q);else for(var H=j.length-1;H>=0;H--)(E=j[H])&&(p=(w<3?E(p):w>3?E(m,l,p):E(m,l))||p);return w>3&&p&&Object.defineProperty(m,l,p),p}function f(j,m){return function(l,q){m(l,q,j)}}function g(j,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(j,m)}function i(j,m,l,q){function w(p){return p instanceof l?p:new l(function(E){E(p)})}return new(l||(l=Promise))(function(p,E){function H(Y){try{C(q.next(Y))}catch(Q){E(Q)}}function X(Y){try{C(q.throw(Y))}catch(Q){E(Q)}}function C(Y){Y.done?p(Y.value):w(Y.value).then(H,X)}C((q=q.apply(j,m||[])).next())})}function h(j,m){var l={label:0,sent:function(){if(p[0]&1)throw p[1];return p[1]},trys:[],ops:[]},q,w,p,E;return E={next:H(0),throw:H(1),return:H(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function H(C){return function(Y){return X([C,Y])}}function X(C){if(q)throw new TypeError("Generator is already executing.");for(;l;)try{if(q=1,w&&(p=C[0]&2?w.return:C[0]?w.throw||((p=w.return)&&p.call(w),0):w.next)&&!(p=p.call(w,C[1])).done)return p;(w=0,p)&&(C=[C[0]&2,p.value]);switch(C[0]){case 0:case 1:p=C;break;case 4:return l.label++,{value:C[1],done:!1};case 5:l.label++,w=C[1],C=[0];continue;case 7:C=l.ops.pop(),l.trys.pop();continue;default:if(!(p=l.trys,p=p.length>0&&p[p.length-1])&&(C[0]===6||C[0]===2)){l=0;continue}if(C[0]===3&&(!p||C[1]>p[0]&&C[1]<p[3])){l.label=C[1];break}if(C[0]===6&&l.label<p[1]){l.label=p[1],p=C;break}if(p&&l.label<p[2]){l.label=p[2],l.ops.push(C);break}p[2]&&l.ops.pop(),l.trys.pop();continue}C=m.call(j,l)}catch(Y){C=[6,Y],w=0}finally{q=p=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}}function k(j,m,l,q){q===void 0&&(q=l),j[q]=m[l]}function n(j,m){for(var l in j)l!=="default"&&!m.hasOwnProperty(l)&&(m[l]=j[l])}function o(j){var m=typeof Symbol==="function"&&Symbol.iterator,l=m&&j[m],q=0;if(l)return l.call(j);if(j&&typeof j.length==="number")return{next:function(){return j&&q>=j.length&&(j=void 0),{value:j&&j[q++],done:!j}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(j,m){var l=typeof Symbol==="function"&&j[Symbol.iterator];if(!l)return j;var q=l.call(j),w,p=[],E;try{for(;(m===void 0||m-- >0)&&!(w=q.next()).done;)p.push(w.value)}catch(H){E={error:H}}finally{try{w&&!w.done&&(l=q.return)&&l.call(q)}finally{if(E)throw E.error}}return p}function u(){for(var j=[],m=0;m<arguments.length;m++)j=j.concat(s(arguments[m]));return j}function v(){for(var j=0,m=0,l=arguments.length;m<l;m++)j+=arguments[m].length;for(var q=Array(j),w=0,m=0;m<l;m++)for(var p=arguments[m],E=0,H=p.length;E<H;E++,w++)q[w]=p[E];return q}function y(j){return this instanceof y?(this.v=j,this):new y(j)}function G(j,m,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var q=l.apply(j,m||[]),w,p=[];return w={},E("next"),E("throw"),E("return"),w[Symbol.asyncIterator]=function(){return this},w;function E(D){q[D]&&(w[D]=function(M){return new Promise(function(_,ia){p.push([D,M,_,ia])>1||H(D,M)})})}function H(D,M){try{X(q[D](M))}catch(_){Q(p[0][3],_)}}function X(D){D.value instanceof y?Promise.resolve(D.value.v).then(C,Y):Q(p[0][2],D)}function C(D){H("next",D)}function Y(D){H("throw",D)}function Q(D,M){(D(M),p.shift(),p.length)&&H(p[0][0],p[0][1])}}function K(j){var m,l;return m={},q("next"),q("throw",function(w){throw w}),q("return"),m[Symbol.iterator]=function(){return this},m;function q(w,p){m[w]=j[w]?function(E){return(l=!l)?{value:y(j[w](E)),done:w==="return"}:p?p(E):E}:p}}function J(j){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=j[Symbol.asyncIterator],l;return m?m.call(j):(j=typeof o==="function"?o(j):j[Symbol.iterator](),l={},q("next"),q("throw"),q("return"),l[Symbol.asyncIterator]=function(){return this},l);function q(p){l[p]=j[p]&&function(E){return new Promise(function(H,X){E=j[p](E),w(H,X,E.done,E.value)})}}function w(p,E,H,X){Promise.resolve(X).then(function(C){p({value:C,done:H})},E)}}function N(j,m){return Object.defineProperty?Object.defineProperty(j,"raw",{value:m}):j.raw=m,j}function I(j){if(j&&j.__esModule)return j;var m={};if(j!=null)for(var l in j)Object.hasOwnProperty.call(j,l)&&(m[l]=j[l]);return m.default=j,m}function O(j){return j&&j.__esModule?j:{default:j}}function P(j,m){if(!m.has(j))throw new TypeError("attempted to get private field on non-instance");return m.get(j)}function L(j,m,l){if(!m.has(j))throw new TypeError("attempted to set private field on non-instance");return m.set(j,l),l}});var Xf=mb(S=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0});var a=lj();var b={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};var c=function(z,x){if(!z)throw d(x)},d=function(z){return new Error("Firebase Database ("+b.SDK_VERSION+") INTERNAL ASSERT FAILED: "+z)};var e=function(z){for(var x=[],B=0,F=0;F<z.length;F++){var A=z.charCodeAt(F);A<128?x[B++]=A:A<2048?(x[B++]=A>>6|192,x[B++]=A&63|128):(A&64512)===55296&&F+1<z.length&&(z.charCodeAt(F+1)&64512)===56320?(A=65536+((A&1023)<<10)+(z.charCodeAt(++F)&1023),x[B++]=A>>18|240,x[B++]=A>>12&63|128,x[B++]=A>>6&63|128,x[B++]=A&63|128):(x[B++]=A>>12|224,x[B++]=A>>6&63|128,x[B++]=A&63|128)}return x},f=function(z){for(var x=[],B=0,F=0;B<z.length;){var A=z[B++];if(A<128)x[F++]=String.fromCharCode(A);else if(A>191&&A<224){var W=z[B++];x[F++]=String.fromCharCode((A&31)<<6|W&63)}else if(A>239&&A<365){var W=z[B++],aa=z[B++],$=z[B++],ha=((A&7)<<18|(W&63)<<12|(aa&63)<<6|$&63)-65536;x[F++]=String.fromCharCode(55296+(ha>>10)),x[F++]=String.fromCharCode(56320+(ha&1023))}else{var W=z[B++],aa=z[B++];x[F++]=String.fromCharCode((A&15)<<12|(W&63)<<6|aa&63)}}return x.join("")},g={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob==="function",encodeByteArray:function(z,x){if(!Array.isArray(z))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var B=x?this.byteToCharMapWebSafe_:this.byteToCharMap_,F=[],A=0;A<z.length;A+=3){var W=z[A],aa=A+1<z.length,$=aa?z[A+1]:0,ha=A+2<z.length,da=ha?z[A+2]:0,ta=W>>2,la=(W&3)<<4|$>>4,Ba=($&15)<<2|da>>6,Of=da&63;ha||(Of=64,aa||(Ba=64)),F.push(B[ta],B[la],B[Ba],B[Of])}return F.join("")},encodeString:function(z,x){return this.HAS_NATIVE_SUPPORT&&!x?btoa(z):this.encodeByteArray(e(z),x)},decodeString:function(z,x){return this.HAS_NATIVE_SUPPORT&&!x?atob(z):f(this.decodeStringToByteArray(z,x))},decodeStringToByteArray:function(z,x){this.init_();for(var B=x?this.charToByteMapWebSafe_:this.charToByteMap_,F=[],A=0;A<z.length;){var W=B[z.charAt(A++)],aa=A<z.length,$=aa?B[z.charAt(A)]:0;++A;var ha=A<z.length,da=ha?B[z.charAt(A)]:64;++A;var ta=A<z.length,la=ta?B[z.charAt(A)]:64;++A;if(W==null||$==null||da==null||la==null)throw Error();var Ba=W<<2|$>>4;F.push(Ba);if(da!==64){var Of=$<<4&240|da>>2;F.push(Of);if(la!==64){var Nr=da<<6&192|la;F.push(Nr)}}}return F},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var z=0;z<this.ENCODED_VALS.length;z++)this.byteToCharMap_[z]=this.ENCODED_VALS.charAt(z),this.charToByteMap_[this.byteToCharMap_[z]]=z,this.byteToCharMapWebSafe_[z]=this.ENCODED_VALS_WEBSAFE.charAt(z),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[z]]=z,z>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(z)]=z,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(z)]=z)}}},i=function(z){var x=e(z);return g.encodeByteArray(x,!0)},h=function(z){try{return g.decodeString(z,!0)}catch(x){console.error("base64Decode failed: ",x)}return null};function k(z){return n(void 0,z)}function n(z,x){if(!(x instanceof Object))return x;switch(x.constructor){case Date:var B=x;return new Date(B.getTime());case Object:z===void 0&&(z={});break;case Array:z=[];break;default:return x}for(var F in x){if(!x.hasOwnProperty(F))continue;z[F]=n(z[F],x[F])}return z}var o=function(){function z(){var x=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(B,F){x.resolve=B,x.reject=F})}return z.prototype.wrapCallback=function(x){var B=this;return function(F,A){F?B.reject(F):B.resolve(A),typeof x==="function"&&(B.promise.catch(function(){}),x.length===1?x(F):x(F,A))}},z}();function s(){return typeof navigator!=="undefined"&&typeof navigator.userAgent==="string"?navigator.userAgent:""}function u(){return typeof window!=="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(s())}function v(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(z){return!1}}function y(){return typeof self==="object"&&self.self===self}function G(){var z=typeof chrome==="object"?chrome.runtime:typeof browser==="object"?browser.runtime:void 0;return typeof z==="object"&&z.id!==void 0}function K(){return typeof navigator==="object"&&navigator.product==="ReactNative"}function J(){return s().indexOf("Electron/")>=0}function N(){var z=s();return z.indexOf("MSIE ")>=0||z.indexOf("Trident/")>=0}function I(){return s().indexOf("MSAppHost/")>=0}function O(){return b.NODE_CLIENT===!0||b.NODE_ADMIN===!0}function P(){return!v()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}var L="FirebaseError",r=function(z){a.__extends(x,z);function x(B,F){var A=z.call(this,F)||this;return A.code=B,A.name=L,Object.setPrototypeOf(A,x.prototype),Error.captureStackTrace&&Error.captureStackTrace(A,t.prototype.create),A}return x}(Error),t=function(){function z(x,B,F){this.service=x,this.serviceName=B,this.errors=F}return z.prototype.create=function(x){for(var B=[],F=1;F<arguments.length;F++)B[F-1]=arguments[F];for(var A=B[0]||{},W=this.service+"/"+x,aa=this.errors[x],$=aa?j(aa,A):"Error",ha=this.serviceName+": "+$+" ("+W+").",da=new r(W,ha),ta=0,la=Object.keys(A);ta<la.length;ta++){var Ba=la[ta];Ba.slice(-1)!=="_"&&(Ba in da&&console.warn('Overwriting FirebaseError base field "'+Ba+'" can cause unexpected behavior.'),da[Ba]=A[Ba])}return da},z}();function j(z,x){return z.replace(m,function(B,F){var A=x[F];return A!=null?String(A):"<"+F+"?>"})}var m=/\{\$([^}]+)}/g;function l(z){return JSON.parse(z)}function q(z){return JSON.stringify(z)}var w=function(z){var x={},B={},F={},A="";try{var W=z.split(".");x=l(h(W[0])||""),B=l(h(W[1])||""),A=W[2],F=B.d||{},delete B.d}catch(aa){}return{header:x,claims:B,data:F,signature:A}},p=function(z){var x=w(z).claims,B=Math.floor(new Date().getTime()/1e3),F=0,A=0;return typeof x==="object"&&(x.hasOwnProperty("nbf")?F=x.nbf:x.hasOwnProperty("iat")&&(F=x.iat),x.hasOwnProperty("exp")?A=x.exp:A=F+86400),!!B&&!!F&&!!A&&B>=F&&B<=A},E=function(z){var x=w(z).claims;return typeof x==="object"&&x.hasOwnProperty("iat")?x.iat:null},H=function(z){var x=w(z),B=x.claims;return!!B&&typeof B==="object"&&B.hasOwnProperty("iat")},X=function(z){var x=w(z).claims;return typeof x==="object"&&x.admin===!0};function C(z,x){return Object.prototype.hasOwnProperty.call(z,x)}function Y(z,x){return Object.prototype.hasOwnProperty.call(z,x)?z[x]:void 0}function Q(z){for(var x in z)if(Object.prototype.hasOwnProperty.call(z,x))return!1;return!0}function D(z,x,B){var F={};for(var A in z)Object.prototype.hasOwnProperty.call(z,A)&&(F[A]=x.call(B,z[A],A,z));return F}function M(z){for(var x=[],B=function(ha,da){Array.isArray(da)?da.forEach(function(ta){x.push(encodeURIComponent(ha)+"="+encodeURIComponent(ta))}):x.push(encodeURIComponent(ha)+"="+encodeURIComponent(da))},F=0,A=Object.entries(z);F<A.length;F++){var W=A[F],aa=W[0],$=W[1];B(aa,$)}return x.length?"&"+x.join("&"):""}function _(z){var x={},B=z.replace(/^\?/,"").split("&");return B.forEach(function(F){if(F){var A=F.split("=");x[A[0]]=A[1]}}),x}var ia=function(){function z(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(var x=1;x<this.blockSize;++x)this.pad_[x]=0;this.reset()}return z.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},z.prototype.compress_=function(x,B){B||(B=0);var F=this.W_;if(typeof x==="string")for(var A=0;A<16;A++)F[A]=x.charCodeAt(B)<<24|x.charCodeAt(B+1)<<16|x.charCodeAt(B+2)<<8|x.charCodeAt(B+3),B+=4;else for(var A=0;A<16;A++)F[A]=x[B]<<24|x[B+1]<<16|x[B+2]<<8|x[B+3],B+=4;for(var A=16;A<80;A++){var W=F[A-3]^F[A-8]^F[A-14]^F[A-16];F[A]=(W<<1|W>>>31)&4294967295}for(var aa=this.chain_[0],$=this.chain_[1],ha=this.chain_[2],da=this.chain_[3],ta=this.chain_[4],la,Ba,A=0;A<80;A++){A<40?A<20?(la=da^$&(ha^da),Ba=1518500249):(la=$^ha^da,Ba=1859775393):A<60?(la=$&ha|da&($|ha),Ba=2400959708):(la=$^ha^da,Ba=3395469782);var W=(aa<<5|aa>>>27)+la+ta+Ba+F[A]&4294967295;ta=da,da=ha,ha=($<<30|$>>>2)&4294967295,$=aa,aa=W}this.chain_[0]=this.chain_[0]+aa&4294967295,this.chain_[1]=this.chain_[1]+$&4294967295,this.chain_[2]=this.chain_[2]+ha&4294967295,this.chain_[3]=this.chain_[3]+da&4294967295,this.chain_[4]=this.chain_[4]+ta&4294967295},z.prototype.update=function(x,B){if(x==null)return;B===void 0&&(B=x.length);for(var F=B-this.blockSize,A=0,W=this.buf_,aa=this.inbuf_;A<B;){if(aa===0)for(;A<=F;)this.compress_(x,A),A+=this.blockSize;if(typeof x==="string")for(;A<B;){W[aa]=x.charCodeAt(A),++aa,++A;if(aa===this.blockSize){this.compress_(W),aa=0;break}}else for(;A<B;){W[aa]=x[A],++aa,++A;if(aa===this.blockSize){this.compress_(W),aa=0;break}}}this.inbuf_=aa,this.total_+=B},z.prototype.digest=function(){var x=[],B=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var F=this.blockSize-1;F>=56;F--)this.buf_[F]=B&255,B/=256;this.compress_(this.buf_);for(var A=0,F=0;F<5;F++)for(var W=24;W>=0;W-=8)x[A]=this.chain_[F]>>W&255,++A;return x},z}();function oa(z,x){var B=new qa(z,x);return B.subscribe.bind(B)}var qa=function(){function z(x,B){var F=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=B,this.task.then(function(){x(F)}).catch(function(A){F.error(A)})}return z.prototype.next=function(x){this.forEachObserver(function(B){B.next(x)})},z.prototype.error=function(x){this.forEachObserver(function(B){B.error(x)}),this.close(x)},z.prototype.complete=function(){this.forEachObserver(function(x){x.complete()}),this.close()},z.prototype.subscribe=function(x,B,F){var A=this,W;if(x===void 0&&B===void 0&&F===void 0)throw new Error("Missing Observer.");V(x,["next","error","complete"])?W=x:W={next:x,error:B,complete:F},W.next===void 0&&(W.next=ea),W.error===void 0&&(W.error=ea),W.complete===void 0&&(W.complete=ea);var aa=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{A.finalError?W.error(A.finalError):W.complete()}catch($){}return}),this.observers.push(W),aa},z.prototype.unsubscribeOne=function(x){if(this.observers===void 0||this.observers[x]===void 0)return;delete this.observers[x],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this)},z.prototype.forEachObserver=function(x){if(this.finalized)return;for(var B=0;B<this.observers.length;B++)this.sendOne(B,x)},z.prototype.sendOne=function(x,B){var F=this;this.task.then(function(){if(F.observers!==void 0&&F.observers[x]!==void 0)try{B(F.observers[x])}catch(A){typeof console!=="undefined"&&console.error&&console.error(A)}})},z.prototype.close=function(x){var B=this;if(this.finalized)return;this.finalized=!0,x!==void 0&&(this.finalError=x),this.task.then(function(){B.observers=void 0,B.onNoObservers=void 0})},z}();function ma(z,x){return function(){for(var B=[],F=0;F<arguments.length;F++)B[F]=arguments[F];Promise.resolve(!0).then(function(){z.apply(void 0,B)}).catch(function(A){x&&x(A)})}}function V(z,x){if(typeof z!=="object"||z===null)return!1;for(var B=0,F=x;B<F.length;B++){var A=F[B];if(A in z&&typeof z[A]==="function")return!0}return!1}function ea(){}var ja=function(z,x,B,F){var A;F<x?A="at least "+x:F>B&&(A=B===0?"none":"no more than "+B);if(A){var W=z+" failed: Was called with "+F+(F===1?" argument.":" arguments.")+" Expects "+A+".";throw new Error(W)}};function ka(z,x,B){var F="";switch(x){case 1:F=B?"first":"First";break;case 2:F=B?"second":"Second";break;case 3:F=B?"third":"Third";break;case 4:F=B?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var A=z+" failed: ";return A+=F+" argument ",A}function T(z,x,B,F){if(F&&!B)return;if(typeof B!=="string")throw new Error(ka(z,x,F)+"must be a valid firebase namespace.")}function U(z,x,B,F){if(F&&!B)return;if(typeof B!=="function")throw new Error(ka(z,x,F)+"must be a valid function.")}function ga(z,x,B,F){if(F&&!B)return;if(typeof B!=="object"||B===null)throw new Error(ka(z,x,F)+"must be a valid context object.")}var R=function(z){for(var x=[],B=0,F=0;F<z.length;F++){var A=z.charCodeAt(F);if(A>=55296&&A<=56319){var W=A-55296;F++,c(F<z.length,"Surrogate pair missing trail surrogate.");var aa=z.charCodeAt(F)-56320;A=65536+(W<<10)+aa}A<128?x[B++]=A:A<2048?(x[B++]=A>>6|192,x[B++]=A&63|128):A<65536?(x[B++]=A>>12|224,x[B++]=A>>6&63|128,x[B++]=A&63|128):(x[B++]=A>>18|240,x[B++]=A>>12&63|128,x[B++]=A>>6&63|128,x[B++]=A&63|128)}return x},fa=function(z){for(var x=0,B=0;B<z.length;B++){var F=z.charCodeAt(B);F<128?x++:F<2048?x+=2:F>=55296&&F<=56319?(x+=4,B++):x+=3}return x};S.CONSTANTS=b;S.Deferred=o;S.ErrorFactory=t;S.FirebaseError=r;S.Sha1=ia;S.assert=c;S.assertionError=d;S.async=ma;S.base64=g;S.base64Decode=h;S.base64Encode=i;S.contains=C;S.createSubscribe=oa;S.decode=w;S.deepCopy=k;S.deepExtend=n;S.errorPrefix=ka;S.getUA=s;S.isAdmin=X;S.isBrowser=y;S.isBrowserExtension=G;S.isElectron=J;S.isEmpty=Q;S.isIE=N;S.isMobileCordova=u;S.isNode=v;S.isNodeSdk=O;S.isReactNative=K;S.isSafari=P;S.isUWP=I;S.isValidFormat=H;S.isValidTimestamp=p;S.issuedAtTime=E;S.jsonEval=l;S.map=D;S.querystring=M;S.querystringDecode=_;S.safeGet=Y;S.stringLength=fa;S.stringToByteArray=R;S.stringify=q;S.validateArgCount=ja;S.validateCallback=U;S.validateContextObject=ga;S.validateNamespace=T});var jj=mb(r=>{Pb(r,{__assign:()=>c,__asyncDelegator:()=>K,__asyncGenerator:()=>G,__asyncValues:()=>J,__await:()=>y,__awaiter:()=>i,__classPrivateFieldGet:()=>P,__classPrivateFieldSet:()=>L,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>h,__importDefault:()=>O,__importStar:()=>I,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>s,__rest:()=>d,__spread:()=>u,__spreadArrays:()=>v,__values:()=>o});var a=function(j,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,q){l.__proto__=q}||function(l,q){for(var w in q)q.hasOwnProperty(w)&&(l[w]=q[w])},a(j,m)};function b(j,m){a(j,m);function l(){this.constructor=j}j.prototype=m===null?Object.create(m):(l.prototype=m.prototype,new l())}var c=function(){return c=Object.assign||function j(m){for(var l,q=1,w=arguments.length;q<w;q++){l=arguments[q];for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(m[p]=l[p])}return m},c.apply(this,arguments)};function d(j,m){var l={};for(var q in j)Object.prototype.hasOwnProperty.call(j,q)&&m.indexOf(q)<0&&(l[q]=j[q]);if(j!=null&&typeof Object.getOwnPropertySymbols==="function")for(var w=0,q=Object.getOwnPropertySymbols(j);w<q.length;w++)m.indexOf(q[w])<0&&Object.prototype.propertyIsEnumerable.call(j,q[w])&&(l[q[w]]=j[q[w]]);return l}function e(j,m,l,q){var w=arguments.length,p=w<3?m:q===null?q=Object.getOwnPropertyDescriptor(m,l):q,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")p=Reflect.decorate(j,m,l,q);else for(var H=j.length-1;H>=0;H--)(E=j[H])&&(p=(w<3?E(p):w>3?E(m,l,p):E(m,l))||p);return w>3&&p&&Object.defineProperty(m,l,p),p}function f(j,m){return function(l,q){m(l,q,j)}}function g(j,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(j,m)}function i(j,m,l,q){function w(p){return p instanceof l?p:new l(function(E){E(p)})}return new(l||(l=Promise))(function(p,E){function H(Y){try{C(q.next(Y))}catch(Q){E(Q)}}function X(Y){try{C(q.throw(Y))}catch(Q){E(Q)}}function C(Y){Y.done?p(Y.value):w(Y.value).then(H,X)}C((q=q.apply(j,m||[])).next())})}function h(j,m){var l={label:0,sent:function(){if(p[0]&1)throw p[1];return p[1]},trys:[],ops:[]},q,w,p,E;return E={next:H(0),throw:H(1),return:H(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function H(C){return function(Y){return X([C,Y])}}function X(C){if(q)throw new TypeError("Generator is already executing.");for(;l;)try{if(q=1,w&&(p=C[0]&2?w.return:C[0]?w.throw||((p=w.return)&&p.call(w),0):w.next)&&!(p=p.call(w,C[1])).done)return p;(w=0,p)&&(C=[C[0]&2,p.value]);switch(C[0]){case 0:case 1:p=C;break;case 4:return l.label++,{value:C[1],done:!1};case 5:l.label++,w=C[1],C=[0];continue;case 7:C=l.ops.pop(),l.trys.pop();continue;default:if(!(p=l.trys,p=p.length>0&&p[p.length-1])&&(C[0]===6||C[0]===2)){l=0;continue}if(C[0]===3&&(!p||C[1]>p[0]&&C[1]<p[3])){l.label=C[1];break}if(C[0]===6&&l.label<p[1]){l.label=p[1],p=C;break}if(p&&l.label<p[2]){l.label=p[2],l.ops.push(C);break}p[2]&&l.ops.pop(),l.trys.pop();continue}C=m.call(j,l)}catch(Y){C=[6,Y],w=0}finally{q=p=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}}function k(j,m,l,q){q===void 0&&(q=l),j[q]=m[l]}function n(j,m){for(var l in j)l!=="default"&&!m.hasOwnProperty(l)&&(m[l]=j[l])}function o(j){var m=typeof Symbol==="function"&&Symbol.iterator,l=m&&j[m],q=0;if(l)return l.call(j);if(j&&typeof j.length==="number")return{next:function(){return j&&q>=j.length&&(j=void 0),{value:j&&j[q++],done:!j}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(j,m){var l=typeof Symbol==="function"&&j[Symbol.iterator];if(!l)return j;var q=l.call(j),w,p=[],E;try{for(;(m===void 0||m-- >0)&&!(w=q.next()).done;)p.push(w.value)}catch(H){E={error:H}}finally{try{w&&!w.done&&(l=q.return)&&l.call(q)}finally{if(E)throw E.error}}return p}function u(){for(var j=[],m=0;m<arguments.length;m++)j=j.concat(s(arguments[m]));return j}function v(){for(var j=0,m=0,l=arguments.length;m<l;m++)j+=arguments[m].length;for(var q=Array(j),w=0,m=0;m<l;m++)for(var p=arguments[m],E=0,H=p.length;E<H;E++,w++)q[w]=p[E];return q}function y(j){return this instanceof y?(this.v=j,this):new y(j)}function G(j,m,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var q=l.apply(j,m||[]),w,p=[];return w={},E("next"),E("throw"),E("return"),w[Symbol.asyncIterator]=function(){return this},w;function E(D){q[D]&&(w[D]=function(M){return new Promise(function(_,ia){p.push([D,M,_,ia])>1||H(D,M)})})}function H(D,M){try{X(q[D](M))}catch(_){Q(p[0][3],_)}}function X(D){D.value instanceof y?Promise.resolve(D.value.v).then(C,Y):Q(p[0][2],D)}function C(D){H("next",D)}function Y(D){H("throw",D)}function Q(D,M){(D(M),p.shift(),p.length)&&H(p[0][0],p[0][1])}}function K(j){var m,l;return m={},q("next"),q("throw",function(w){throw w}),q("return"),m[Symbol.iterator]=function(){return this},m;function q(w,p){m[w]=j[w]?function(E){return(l=!l)?{value:y(j[w](E)),done:w==="return"}:p?p(E):E}:p}}function J(j){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=j[Symbol.asyncIterator],l;return m?m.call(j):(j=typeof o==="function"?o(j):j[Symbol.iterator](),l={},q("next"),q("throw"),q("return"),l[Symbol.asyncIterator]=function(){return this},l);function q(p){l[p]=j[p]&&function(E){return new Promise(function(H,X){E=j[p](E),w(H,X,E.done,E.value)})}}function w(p,E,H,X){Promise.resolve(X).then(function(C){p({value:C,done:H})},E)}}function N(j,m){return Object.defineProperty?Object.defineProperty(j,"raw",{value:m}):j.raw=m,j}function I(j){if(j&&j.__esModule)return j;var m={};if(j!=null)for(var l in j)Object.hasOwnProperty.call(j,l)&&(m[l]=j[l]);return m.default=j,m}function O(j){return j&&j.__esModule?j:{default:j}}function P(j,m){if(!m.has(j))throw new TypeError("attempted to get private field on non-instance");return m.get(j)}function L(j,m,l){if(!m.has(j))throw new TypeError("attempted to set private field on non-instance");return m.set(j,l),l}});var ij=mb(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0});var a=jj(),b=Xf(),c=function(){function n(o,s,u){this.name=o,this.instanceFactory=s,this.type=u,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return n.prototype.setInstantiationMode=function(o){return this.instantiationMode=o,this},n.prototype.setMultipleInstances=function(o){return this.multipleInstances=o,this},n.prototype.setServiceProps=function(o){return this.serviceProps=o,this},n}();var d="[DEFAULT]";var e=function(){function n(o,s){this.name=o,this.container=s,this.component=null,this.instances=new Map(),this.instancesDeferred=new Map()}return n.prototype.get=function(o){o===void 0&&(o=d);var s=this.normalizeInstanceIdentifier(o);if(!this.instancesDeferred.has(s)){var u=new b.Deferred();this.instancesDeferred.set(s,u);try{var v=this.getOrInitializeService(s);v&&u.resolve(v)}catch(y){}}return this.instancesDeferred.get(s).promise},n.prototype.getImmediate=function(o){var s=a.__assign({identifier:d,optional:!1},o),u=s.identifier,v=s.optional,y=this.normalizeInstanceIdentifier(u);try{var G=this.getOrInitializeService(y);if(!G){if(v)return null;throw Error("Service "+this.name+" is not available")}return G}catch(K){if(v)return null;throw K}},n.prototype.getComponent=function(){return this.component},n.prototype.setComponent=function(o){var s,u;if(o.name!==this.name)throw Error("Mismatching Component "+o.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");this.component=o;if(g(o))try{this.getOrInitializeService(d)}catch(O){}try{for(var v=a.__values(this.instancesDeferred.entries()),y=v.next();!y.done;y=v.next()){var G=a.__read(y.value,2),K=G[0],J=G[1],N=this.normalizeInstanceIdentifier(K);try{var I=this.getOrInitializeService(N);J.resolve(I)}catch(O){}}}catch(O){s={error:O}}finally{try{y&&!y.done&&(u=v.return)&&u.call(v)}finally{if(s)throw s.error}}},n.prototype.clearInstance=function(o){o===void 0&&(o=d),this.instancesDeferred.delete(o),this.instances.delete(o)},n.prototype.delete=function(){return a.__awaiter(this,void 0,void 0,function(){var o;return a.__generator(this,function(s){switch(s.label){case 0:return o=Array.from(this.instances.values()),[4,Promise.all(o.filter(function(u){return"INTERNAL"in u}).map(function(u){return u.INTERNAL.delete()}))];case 1:return s.sent(),[2]}})})},n.prototype.isComponentSet=function(){return this.component!=null},n.prototype.getOrInitializeService=function(o){var s=this.instances.get(o);return!s&&this.component&&(s=this.component.instanceFactory(this.container,f(o)),this.instances.set(o,s)),s||null},n.prototype.normalizeInstanceIdentifier=function(o){return this.component?this.component.multipleInstances?o:d:o},n}();function f(n){return n===d?void 0:n}function g(n){return n.instantiationMode==="EAGER"}var i=function(){function n(o){this.name=o,this.providers=new Map()}return n.prototype.addComponent=function(o){var s=this.getProvider(o.name);if(s.isComponentSet())throw new Error("Component "+o.name+" has already been registered with "+this.name);s.setComponent(o)},n.prototype.addOrOverwriteComponent=function(o){var s=this.getProvider(o.name);s.isComponentSet()&&this.providers.delete(o.name),this.addComponent(o)},n.prototype.getProvider=function(o){if(this.providers.has(o))return this.providers.get(o);var s=new e(o,this);return this.providers.set(o,s),s},n.prototype.getProviders=function(){return Array.from(this.providers.values())},n}();h.Component=c;h.ComponentContainer=i;h.Provider=e});var kj=mb(o=>{Pb(o,{LogLevel:()=>d,Logger:()=>h,setLogLevel:()=>k,setUserLogHandler:()=>n});function a(){for(var u=0,v=0,y=arguments.length;v<y;v++)u+=arguments[v].length;for(var G=Array(u),K=0,v=0;v<y;v++)for(var J=arguments[v],N=0,I=J.length;N<I;N++,K++)G[K]=J[N];return G}var b,c=[],d;(function(u){u[u.DEBUG=0]="DEBUG",u[u.VERBOSE=1]="VERBOSE",u[u.INFO=2]="INFO",u[u.WARN=3]="WARN",u[u.ERROR=4]="ERROR",u[u.SILENT=5]="SILENT"})(d||(d={}));var e={debug:d.DEBUG,verbose:d.VERBOSE,info:d.INFO,warn:d.WARN,error:d.ERROR,silent:d.SILENT},f=d.INFO,g=(b={},b[d.DEBUG]="log",b[d.VERBOSE]="log",b[d.INFO]="info",b[d.WARN]="warn",b[d.ERROR]="error",b),i=function(u,v){for(var y=[],G=2;G<arguments.length;G++)y[G-2]=arguments[G];if(v<u.logLevel)return;var K=new Date().toISOString(),J=g[v];if(J)console[J].apply(console,a(["["+K+"]  "+u.name+":"],y));else throw new Error("Attempted to log a message with an invalid logType (value: "+v+")")},h=function(){function u(v){this.name=v,this._logLevel=f,this._logHandler=i,this._userLogHandler=null,c.push(this)}return Object.defineProperty(u.prototype,"logLevel",{get:function(){return this._logLevel},set:function(v){if(!(v in d))throw new TypeError('Invalid value "'+v+'" assigned to `logLevel`');this._logLevel=v},enumerable:!1,configurable:!0}),u.prototype.setLogLevel=function(v){this._logLevel=typeof v==="string"?e[v]:v},Object.defineProperty(u.prototype,"logHandler",{get:function(){return this._logHandler},set:function(v){if(typeof v!=="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=v},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(v){this._userLogHandler=v},enumerable:!1,configurable:!0}),u.prototype.debug=function(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.DEBUG],v)),this._logHandler.apply(this,a([this,d.DEBUG],v))},u.prototype.log=function(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.VERBOSE],v)),this._logHandler.apply(this,a([this,d.VERBOSE],v))},u.prototype.info=function(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.INFO],v)),this._logHandler.apply(this,a([this,d.INFO],v))},u.prototype.warn=function(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.WARN],v)),this._logHandler.apply(this,a([this,d.WARN],v))},u.prototype.error=function(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.ERROR],v)),this._logHandler.apply(this,a([this,d.ERROR],v))},u}();function k(u){c.forEach(function(v){v.setLogLevel(u)})}function n(u,v){for(var y=function(N){var I=null;v&&v.level&&(I=e[v.level]),u===null?N.userLogHandler=null:N.userLogHandler=function(O,P){for(var L=[],r=2;r<arguments.length;r++)L[r-2]=arguments[r];var t=L.map(function(j){if(j==null)return null;{if(typeof j==="string")return j;{if(typeof j==="number"||typeof j==="boolean")return j.toString();{if(j instanceof Error)return j.message;try{return JSON.stringify(j)}catch(m){return null}}}}}).filter(function(j){return j}).join(" ");P>=(I!==null&&I!==void 0?I:O.logLevel)&&u({level:d[P].toLowerCase(),message:t,args:L,type:O.name})}},G=0,K=c;G<K.length;G++){var J=K[G];y(J)}}});var gj=mb(C=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0});var a=hj(),b=Xf(),c=ij(),d=kj();var e,f=(e={},e["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",e["bad-app-name"]="Illegal App name: '{$appName}",e["duplicate-app"]="Firebase App named '{$appName}' already exists",e["app-deleted"]="Firebase App named '{$appName}' already deleted",e["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",e["invalid-log-argument"]="First argument to `onLog` must be null or a function.",e),g=new b.ErrorFactory("app","Firebase",f),i="@firebase/app",h="0.6.8",k="@firebase/analytics",n="@firebase/auth",o="@firebase/database",s="@firebase/functions",u="@firebase/installations",v="@firebase/messaging",y="@firebase/performance",G="@firebase/remote-config",K="@firebase/storage",J="@firebase/firestore",N="firebase-wrapper";var I,O="[DEFAULT]",P=(I={},I[i]="fire-core",I[k]="fire-analytics",I[n]="fire-auth",I[o]="fire-rtdb",I[s]="fire-fn",I[u]="fire-iid",I[v]="fire-fcm",I[y]="fire-perf",I[G]="fire-rc",I[K]="fire-gcs",I[J]="fire-fst",I["fire-js"]="fire-js",I[N]="fire-js-all",I);var L=new d.Logger("@firebase/app");var r=function(){function Q(D,M,_){var ia,oa,qa=this;this.firebase_=_,this.isDeleted_=!1,this.name_=M.name,this.automaticDataCollectionEnabled_=M.automaticDataCollectionEnabled||!1,this.options_=b.deepCopy(D),this.container=new c.ComponentContainer(M.name),this._addComponent(new c.Component("app",function(){return qa},"PUBLIC"));try{for(var ma=a.__values(this.firebase_.INTERNAL.components.values()),V=ma.next();!V.done;V=ma.next()){var ea=V.value;this._addComponent(ea)}}catch(ja){ia={error:ja}}finally{try{V&&!V.done&&(oa=ma.return)&&oa.call(ma)}finally{if(ia)throw ia.error}}}return Object.defineProperty(Q.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(D){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=D},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),Q.prototype.delete=function(){var D=this;return new Promise(function(M){D.checkDestroyed_(),M()}).then(function(){return D.firebase_.INTERNAL.removeApp(D.name_),Promise.all(D.container.getProviders().map(function(M){return M.delete()}))}).then(function(){D.isDeleted_=!0})},Q.prototype._getService=function(D,M){return M===void 0&&(M=O),this.checkDestroyed_(),this.container.getProvider(D).getImmediate({identifier:M})},Q.prototype._removeServiceInstance=function(D,M){M===void 0&&(M=O),this.container.getProvider(D).clearInstance(M)},Q.prototype._addComponent=function(D){try{this.container.addComponent(D)}catch(M){L.debug("Component "+D.name+" failed to register with FirebaseApp "+this.name,M)}},Q.prototype._addOrOverwriteComponent=function(D){this.container.addOrOverwriteComponent(D)},Q.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw g.create("app-deleted",{appName:this.name_})},Q}();r.prototype.name&&r.prototype.options||r.prototype.delete||console.log("dc");var t="7.16.0";function j(Q){var D={},M=new Map(),_={__esModule:!0,initializeApp:qa,app:oa,registerVersion:ea,setLogLevel:d.setLogLevel,onLog:ja,apps:null,SDK_VERSION:t,INTERNAL:{registerComponent:V,removeApp:ia,components:M,useAsService:ka}};_.default=_,Object.defineProperty(_,"apps",{get:ma});function ia(T){delete D[T]}function oa(T){T=T||O;if(!b.contains(D,T))throw g.create("no-app",{appName:T});return D[T]}oa.App=Q;function qa(T,U){U===void 0&&(U={});if(typeof U!=="object"||U===null){var ga=U;U={name:ga}}var R=U;R.name===void 0&&(R.name=O);var fa=R.name;if(typeof fa!=="string"||!fa)throw g.create("bad-app-name",{appName:String(fa)});if(b.contains(D,fa))throw g.create("duplicate-app",{appName:fa});var S=new Q(T,R,_);return D[fa]=S,S}function ma(){return Object.keys(D).map(function(T){return D[T]})}function V(T){var U,ga,R=T.name;if(M.has(R))return L.debug("There were multiple attempts to register component "+R+"."),T.type==="PUBLIC"?_[R]:null;M.set(R,T);if(T.type==="PUBLIC"){var fa=function(x){x===void 0&&(x=oa());if(typeof x[R]!=="function")throw g.create("invalid-app-argument",{appName:R});return x[R]()};T.serviceProps!==void 0&&b.deepExtend(fa,T.serviceProps),_[R]=fa,Q.prototype[R]=function(){for(var x=[],B=0;B<arguments.length;B++)x[B]=arguments[B];var F=this._getService.bind(this,R);return F.apply(this,T.multipleInstances?x:[])}}try{for(var S=a.__values(Object.keys(D)),xa=S.next();!xa.done;xa=S.next()){var z=xa.value;D[z]._addComponent(T)}}catch(x){U={error:x}}finally{try{xa&&!xa.done&&(ga=S.return)&&ga.call(S)}finally{if(U)throw U.error}}return T.type==="PUBLIC"?_[R]:null}function ea(T,U,ga){var R,fa=(R=P[T])!==null&&R!==void 0?R:T;ga&&(fa+="-"+ga);var S=fa.match(/\s|\//),xa=U.match(/\s|\//);if(S||xa){var z=['Unable to register library "'+fa+'" with version "'+U+'":'];S&&z.push('library name "'+fa+'" contains illegal characters (whitespace or "/")'),S&&xa&&z.push("and"),xa&&z.push('version name "'+U+'" contains illegal characters (whitespace or "/")'),L.warn(z.join(" "));return}V(new c.Component(fa+"-version",function(){return{library:fa,version:U}},"VERSION"))}function ja(T,U){if(T!==null&&typeof T!=="function")throw g.create("invalid-log-argument",{appName:name});d.setUserLogHandler(T,U)}function ka(T,U){if(U==="serverAuth")return null;var ga=U;return ga}return _}function m(){var Q=j(r);Q.INTERNAL=a.__assign(a.__assign({},Q.INTERNAL),{createFirebaseNamespace:m,extendNamespace:D,createSubscribe:b.createSubscribe,ErrorFactory:b.ErrorFactory,deepExtend:b.deepExtend});function D(M){b.deepExtend(Q,M)}return Q}var l=m();var q=function(){function Q(D){this.container=D}return Q.prototype.getPlatformInfoString=function(){var D=this.container.getProviders();return D.map(function(M){if(w(M)){var _=M.getImmediate();return _.library+"/"+_.version}else return null}).filter(function(M){return M}).join(" ")},Q}();function w(Q){var D=Q.getComponent();return(D===null||D===void 0?void 0:D.type)==="VERSION"}function p(Q,D){Q.INTERNAL.registerComponent(new c.Component("platform-logger",function(M){return new q(M)},"PRIVATE")),Q.registerVersion(i,h,D),Q.registerVersion("fire-js","")}if(b.isBrowser()&&self.firebase!==void 0){L.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);var E=self.firebase.SDK_VERSION;E&&E.indexOf("LITE")>=0&&L.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}var H=l.initializeApp;l.initializeApp=function(){for(var Q=[],D=0;D<arguments.length;D++)Q[D]=arguments[D];return b.isNode()&&L.warn(`
      Warning: This is a browser-targeted Firebase bundle but it appears it is being
      run in a Node environment.  If running in a Node environment, make sure you
      are using the bundle specified by the "main" field in package.json.
      
      If you are using Webpack, you can specify "main" as the first item in
      "resolve.mainFields":
      https://webpack.js.org/configuration/resolve/#resolvemainfields
      
      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"
      as the first item in "mainFields", e.g. ['main', 'module'].
      https://github.com/rollup/rollup-plugin-node-resolve
      `),H.apply(void 0,Q)};var X=l;p(X);C.default=X;C.firebase=X});var Qa=mb((e,f)=>{"use strict";function a(g){return g&&typeof g==="object"&&"default"in g?g.default:g}var b=a(gj()),c="firebase",d="7.16.0";b.registerVersion(c,d,"app");f.exports=b});var So=mb((b,c)=>{var a=function(){function d(k,n){if(!i[k]){i[k]={};for(var o=0;o<k.length;o++)i[k][k.charAt(o)]=o}return i[k][n]}var e=String.fromCharCode,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",i={},h={compressToBase64:function(k){if(null==k)return"";var n=h._compress(k,6,function(o){return f.charAt(o)});switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(k){return null==k?"":""==k?null:h._decompress(k.length,32,function(n){return d(f,k.charAt(n))})},compressToUTF16:function(k){return null==k?"":h._compress(k,15,function(n){return e(n+32)})+" "},decompressFromUTF16:function(k){return null==k?"":""==k?null:h._decompress(k.length,16384,function(n){return k.charCodeAt(n)-32})},compressToUint8Array:function(k){for(var n=h.compress(k),o=new Uint8Array(2*n.length),s=0,u=n.length;u>s;s++){var v=n.charCodeAt(s);o[2*s]=v>>>8,o[2*s+1]=v%256}return o},decompressFromUint8Array:function(k){if(null===k||void 0===k)return h.decompress(k);for(var n=new Array(k.length/2),o=0,s=n.length;s>o;o++)n[o]=256*k[2*o]+k[2*o+1];var u=[];return n.forEach(function(v){u.push(e(v))}),h.decompress(u.join(""))},compressToEncodedURIComponent:function(k){return null==k?"":h._compress(k,6,function(n){return g.charAt(n)})},decompressFromEncodedURIComponent:function(k){return null==k?"":""==k?null:(k=k.replace(/ /g,"+"),h._decompress(k.length,32,function(n){return d(g,k.charAt(n))}))},compress:function(k){return h._compress(k,16,function(n){return e(n)})},_compress:function(k,n,o){if(null==k)return"";var s,u,v,y={},G={},K="",J="",N="",I=2,O=3,P=2,L=[],r=0,t=0;for(v=0;v<k.length;v+=1)if(K=k.charAt(v),Object.prototype.hasOwnProperty.call(y,K)||(y[K]=O++,G[K]=!0),J=N+K,Object.prototype.hasOwnProperty.call(y,J))N=J;else{if(Object.prototype.hasOwnProperty.call(G,N)){if(N.charCodeAt(0)<256){for(s=0;P>s;s++)r<<=1,t==n-1?(t=0,L.push(o(r)),r=0):t++;for(u=N.charCodeAt(0),s=0;8>s;s++)r=r<<1|1&u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u>>=1}else{for(u=1,s=0;P>s;s++)r=r<<1|u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u=0;for(u=N.charCodeAt(0),s=0;16>s;s++)r=r<<1|1&u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u>>=1}I--,0==I&&(I=Math.pow(2,P),P++),delete G[N]}else for(u=y[N],s=0;P>s;s++)r=r<<1|1&u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u>>=1;I--,0==I&&(I=Math.pow(2,P),P++),y[J]=O++,N=String(K)}if(""!==N){if(Object.prototype.hasOwnProperty.call(G,N)){if(N.charCodeAt(0)<256){for(s=0;P>s;s++)r<<=1,t==n-1?(t=0,L.push(o(r)),r=0):t++;for(u=N.charCodeAt(0),s=0;8>s;s++)r=r<<1|1&u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u>>=1}else{for(u=1,s=0;P>s;s++)r=r<<1|u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u=0;for(u=N.charCodeAt(0),s=0;16>s;s++)r=r<<1|1&u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u>>=1}I--,0==I&&(I=Math.pow(2,P),P++),delete G[N]}else for(u=y[N],s=0;P>s;s++)r=r<<1|1&u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u>>=1;I--,0==I&&(I=Math.pow(2,P),P++)}for(u=2,s=0;P>s;s++)r=r<<1|1&u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u>>=1;for(;;){if(r<<=1,t==n-1){L.push(o(r));break}t++}return L.join("")},decompress:function(k){return null==k?"":""==k?null:h._decompress(k.length,32768,function(n){return k.charCodeAt(n)})},_decompress:function(k,n,o){var s,u,v,y,G,K,J,N,I=[],O=4,P=4,L=3,r="",t=[],j={val:o(0),position:n,index:1};for(u=0;3>u;u+=1)I[u]=u;for(y=0,K=Math.pow(2,2),J=1;J!=K;)G=j.val&j.position,j.position>>=1,0==j.position&&(j.position=n,j.val=o(j.index++)),y|=(G>0?1:0)*J,J<<=1;switch(s=y){case 0:for(y=0,K=Math.pow(2,8),J=1;J!=K;)G=j.val&j.position,j.position>>=1,0==j.position&&(j.position=n,j.val=o(j.index++)),y|=(G>0?1:0)*J,J<<=1;N=e(y);break;case 1:for(y=0,K=Math.pow(2,16),J=1;J!=K;)G=j.val&j.position,j.position>>=1,0==j.position&&(j.position=n,j.val=o(j.index++)),y|=(G>0?1:0)*J,J<<=1;N=e(y);break;case 2:return""}for(I[3]=N,v=N,t.push(N);;){if(j.index>k)return"";for(y=0,K=Math.pow(2,L),J=1;J!=K;)G=j.val&j.position,j.position>>=1,0==j.position&&(j.position=n,j.val=o(j.index++)),y|=(G>0?1:0)*J,J<<=1;switch(N=y){case 0:for(y=0,K=Math.pow(2,8),J=1;J!=K;)G=j.val&j.position,j.position>>=1,0==j.position&&(j.position=n,j.val=o(j.index++)),y|=(G>0?1:0)*J,J<<=1;I[P++]=e(y),N=P-1,O--;break;case 1:for(y=0,K=Math.pow(2,16),J=1;J!=K;)G=j.val&j.position,j.position>>=1,0==j.position&&(j.position=n,j.val=o(j.index++)),y|=(G>0?1:0)*J,J<<=1;I[P++]=e(y),N=P-1,O--;break;case 2:return t.join("")}if(0==O&&(O=Math.pow(2,L),L++),I[N])r=I[N];else{if(N!==P)return null;r=v+v.charAt(0)}t.push(r),I[P++]=v+r.charAt(0),O--,v=r,0==O&&(O=Math.pow(2,L),L++)}}};return h}();"function"==typeof define&&define.amd?define(function(){return a}):"undefined"!=typeof c&&null!=c&&(c.exports=a)});let qj,rj=0,sj=0;const ua={get:()=>qj,set:a=>{qj=a},getFrame:()=>rj,setFrame:a=>{rj=a},getElapsed:()=>sj,setElapsed:a=>{sj=a}};let wj=0;function Pf(a=0){return()=>{wj=a}}function Pd(){return wj}let ag="Phaser",Wo="https://phaser4.io",Xo="#fff",Yo="linear-gradient(#3e0081 40%, #00bcc3)";function Yf(){if(ag!==""){const a=ua.get(),b=ag==="Phaser"?" v"+a.VERSION:"";console.log(`%c${ag}${b}%c ${Wo}`,`padding: 4px 16px; color: ${Xo}; background: ${Yo}`,"")}}let Bj=800,Cj=600,Dj=1;function Sf(a=800,b=600,c=1){return c===0&&(c=window.devicePixelRatio),()=>{Bj=a,Cj=b,Dj=c}}function xb(){return Bj}function yb(){return Cj}function zb(){return Dj}const pg=[],xc={add:a=>{pg.push(a)},get:()=>pg,clear:()=>{pg.length=0}};let Aj;function Qd(a){Aj=a}function Zf(){return Aj}let bg=.5,cg=.5;let xj=0;function dg(a){xj=a}function Vc(){return xj}function Rd(a){let b;return a&&(typeof a==="string"?b=document.getElementById(a):typeof a==="object"&&a.nodeType===1&&(b=a)),b||(b=document.body),b}let yj;function Qf(a){return()=>{a&&(yj=Rd(a))}}function _f(){return yj}let zj=[];function Rf(a){return()=>{zj=[].concat(a)}}function eg(){return zj}let _o={alpha:!1,antialias:!1,depth:!1,premultipliedAlpha:!1};function fg(){return _o}class Uj{constructor(a){this.stack=[],this.current=null,this.renderer=a}reset(){this.stack=[],this.current=null;const a=this.renderer,b=a.gl;b.bindFramebuffer(b.FRAMEBUFFER,null),b.viewport(0,0,a.width,a.height)}add(a,b=!0,c=0,d=0){this.stack.push({framebuffer:a,width:c,height:d}),this.set(a,b,c,d)}set(a,b=!0,c=0,d=0){const e=this.renderer,f=e.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),b&&(f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),c>0&&f.viewport(0,0,c,d),this.current=a}pop(){this.stack.pop();const a=this.stack.length;if(a>0){const b=this.stack[a-1];this.set(b.framebuffer,!1,b.width,b.height)}else this.reset()}rebind(){const a=this.renderer.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.current)}destroy(){this.stack=[]}}let Tj;const Aa={get:()=>Tj,set:a=>{Tj=a}};function Vj(a,b=[]){const c=a>>16&255,d=a>>8&255,e=a&255,f=a>16777215?a>>>24:255;return b[0]=c/255,b[1]=d/255,b[2]=e/255,b[3]=f/255,b}function Qj(a,b){return a.a===b.a&&a.b===b.b&&a.c===b.c&&a.d===b.d&&a.tx===b.tx&&a.ty===b.ty}function _d(a,b){const c=Aa.get();b||(b=c.COLOR_ATTACHMENT0);const d=c.createFramebuffer();return c.bindFramebuffer(c.FRAMEBUFFER,d),c.framebufferTexture2D(c.FRAMEBUFFER,b,c.TEXTURE_2D,a,0),c.bindFramebuffer(c.FRAMEBUFFER,null),d}function fe(a){const b=Aa.get();if(!b)return;const{parent:c,flipY:d,unpackPremultiplyAlpha:e,minFilter:f,magFilter:g,wrapS:i,wrapT:h,generateMipmap:k,isPOT:n}=a,o=c.image;let s=c.width,u=c.height;const v=b.createTexture();return b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,v),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,d),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),o?(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,o),s=o.width,u=o.height):b.texImage2D(b.TEXTURE_2D,0,b.RGBA,s,u,0,b.RGBA,b.UNSIGNED_BYTE,null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,g),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,i),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,h),k&&n&&b.generateMipmap(b.TEXTURE_2D),a.texture=v,v}function Wb(a){const b=Aa.get();b&&b.isFramebuffer(a)&&b.deleteFramebuffer(a)}function qg(a){const b=Aa.get();if(!b)return;b.isTexture(a)&&b.deleteTexture(a)}function Rj(a,b){return a<1||b<1?!1:(a&a-1)===0&&(b&b-1)===0}function ck(a,b=!0){const c=Aa.get();c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,a);const d=b?c.LINEAR:c.NEAREST;c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,d),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,d)}function dk(a){const b=Aa.get(),c=a.parent.image,d=c.width,e=c.height;return d>0&&e>0&&(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,a.texture),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,a.flipY),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,c)),a.texture}class wc{constructor(a,b={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1;const c=Aa.get();this.parent=a,this.isPOT=Rj(a.width,a.height);const{texture:d=null,framebuffer:e=null,unpackPremultiplyAlpha:f=!0,minFilter:g=c.LINEAR,magFilter:i=c.LINEAR,wrapS:h=c.CLAMP_TO_EDGE,wrapT:k=c.CLAMP_TO_EDGE,generateMipmap:n=this.isPOT,flipY:o=!1}=b;this.minFilter=g,this.magFilter=i,this.wrapS=h,this.wrapT=k,this.generateMipmap=n,this.flipY=o,this.unpackPremultiplyAlpha=f,e&&(this.framebuffer=e),d?this.texture=d:fe(this)}setFilter(a){this.texture&&ck(this.texture,a)}create(){const a=this.texture;return a&&qg(a),fe(this)}update(){const a=this.texture;return a?dk(this):fe(this)}setIndex(a){this.dirtyIndex=a!==this.index,this.index=a}destroy(){qg(this.texture),Wb(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}}class $j{constructor(a,b,c,d,e){this.batchSize=a,this.dataSize=b,this.indexSize=c,this.vertexElementSize=d,this.quadIndexSize=e,this.vertexByteSize=d*b,this.quadByteSize=this.vertexByteSize*4,this.quadElementSize=d*4,this.bufferByteSize=a*this.quadByteSize,this.create()}create(){let a=[];for(let c=0;c<this.batchSize*this.indexSize;c+=this.indexSize)a.push(c+0,c+1,c+2,c+2,c+3,c+0);this.data=new ArrayBuffer(this.bufferByteSize),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const b=Aa.get();this.vertexBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.data,b.DYNAMIC_DRAW),this.indexBuffer=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.index,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,null),a=[]}destroy(){}}class rg{constructor(a,b,c,d,e,f){this.trimmed=!1,this.texture=a,this.key=b,this.x=c,this.y=d,this.width=e,this.height=f,this.sourceSizeWidth=e,this.sourceSizeHeight=f,this.updateUVs()}setPivot(a,b){this.pivot={x:a,y:b}}setSize(a,b){this.width=a,this.height=b,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.updateUVs()}setSourceSize(a,b){this.sourceSizeWidth=a,this.sourceSizeHeight=b}setTrim(a,b,c,d,e,f){this.trimmed=!0,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.spriteSourceSizeX=c,this.spriteSourceSizeY=d,this.spriteSourceSizeWidth=e,this.spriteSourceSizeHeight=f}getExtent(a,b){const c=this.sourceSizeWidth,d=this.sourceSizeHeight;let e,f,g,i;return this.trimmed?(e=this.spriteSourceSizeX-a*c,f=e+this.spriteSourceSizeWidth,g=this.spriteSourceSizeY-b*d,i=g+this.spriteSourceSizeHeight):(e=-a*c,f=e+c,g=-b*d,i=g+d),{left:e,right:f,top:g,bottom:i}}setExtent(a){const b=a.transform,c=b.origin.x,d=b.origin.y,e=this.sourceSizeWidth,f=this.sourceSizeHeight;let g,i,h,k;this.trimmed?(g=this.spriteSourceSizeX-c*e,i=this.spriteSourceSizeY-d*f,h=this.spriteSourceSizeWidth,k=this.spriteSourceSizeHeight):(g=-c*e,i=-d*f,h=e,k=f),b.setExtent(g,i,h,k)}updateUVs(){const{x:a,y:b,width:c,height:d}=this,e=this.texture.width,f=this.texture.height;this.u0=a/e,this.v0=b/f,this.u1=(a+c)/e,this.v1=(b+d)/f}}class Ma{constructor(a,b,c){this.key="",a&&(b=a.width,c=a.height),this.image=a,this.width=b,this.height=c,this.frames=new Map(),this.data={},this.addFrame("__BASE",0,0,b,c),xc.add(this)}addFrame(a,b,c,d,e){if(this.frames.has(a))return null;const f=new rg(this,a,b,c,d,e);return this.frames.set(a,f),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=f),f}getFrame(a){if(!a)return this.firstFrame;a instanceof rg&&(a=a.key);let b=this.frames.get(a);return b||(console.warn(`Frame missing: ${a}`),b=this.firstFrame),b}setSize(a,b){this.width=a,this.height=b;const c=this.frames.get("__BASE");c.setSize(a,b)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}}let _j;const ad={get:()=>_j,set:a=>{_j=a}};const bk={fragmentShader:`\r
#define SHADER_NAME SINGLE_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture;\r
\r
void main (void)\r
{\r
    vec4 color = texture2D(uTexture, vTextureCoord);\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`,vertexShader:`\r
#define SHADER_NAME SINGLE_QUAD_VERT\r
\r
precision highp float;\r
\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
attribute float aTextureId;\r
attribute vec4 aTintColor;\r
\r
uniform mat4 uProjectionMatrix;\r
uniform mat4 uCameraMatrix;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
void main (void)\r
{\r
    vTextureCoord = aTextureCoord;\r
    vTextureId = aTextureId;\r
    vTintColor = aTintColor;\r
\r
    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\r
}`};class ee{constructor(a={}){this.attribs={aVertexPosition:0,aTextureCoord:0,aTextureId:0,aTintColor:0},this.uniforms={uProjectionMatrix:0,uCameraMatrix:0,uTexture:0,uTime:0,uResolution:0},this.renderToFBO=!1,this.renderer=ad.get();const{batchSize:b=4096,dataSize:c=4,indexSize:d=4,vertexElementSize:e=6,quadIndexSize:f=6,fragmentShader:g=bk.fragmentShader,vertexShader:i=bk.vertexShader,width:h=xb(),height:k=yb(),resolution:n=zb(),renderToFBO:o=!1}=a;this.buffer=new $j(b,c,d,e,f),this.createShaders(g,i),this.count=0,this.renderToFBO=o;const s=new Ma(null,h*n,k*n),u=new wc(s);s.binding=u,u.framebuffer=_d(u.texture),this.texture=s,this.framebuffer=u.framebuffer}createShaders(a,b){const c=this.renderer.gl,d=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(d,a),c.compileShader(d);let e=!1,f=c.getShaderInfoLog(d);f.length>0&&(e=!0,console.error(f));const g=c.createShader(c.VERTEX_SHADER);c.shaderSource(g,b),c.compileShader(g),f=c.getShaderInfoLog(d),f.length>0&&(e=!0,console.error(f));if(e)return;const i=c.createProgram();c.attachShader(i,g),c.attachShader(i,d),c.linkProgram(i),c.useProgram(i),this.program=i;for(const h of Object.keys(this.attribs)){const k=c.getAttribLocation(i,h);c.enableVertexAttribArray(k),this.attribs[h]=k}for(const h of Object.keys(this.uniforms))this.uniforms[h]=c.getUniformLocation(i,h)}bind(a,b,c){if(!this.program)return!1;const d=this.renderer,e=d.gl,f=this.uniforms;return e.useProgram(this.program),e.uniformMatrix4fv(f.uProjectionMatrix,!1,a),e.uniformMatrix4fv(f.uCameraMatrix,!1,b),e.uniform1i(f.uTexture,d.textures.textureIndex[c]),e.uniform1f(f.uTime,performance.now()),e.uniform2f(f.uResolution,d.width,d.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}bindBuffers(a,b){const c=this.renderer.gl,d=this.buffer.vertexByteSize,e=this.attribs;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a),c.bindBuffer(c.ARRAY_BUFFER,b),c.vertexAttribPointer(e.aVertexPosition,2,c.FLOAT,!1,d,0),c.vertexAttribPointer(e.aTextureCoord,2,c.FLOAT,!1,d,8),c.vertexAttribPointer(e.aTextureId,1,c.FLOAT,!1,d,16),c.vertexAttribPointer(e.aTintColor,4,c.UNSIGNED_BYTE,!0,d,20),this.count=0}draw(a){const b=this.renderer,c=b.gl,d=this.buffer;if(a===d.batchSize)c.bufferData(c.ARRAY_BUFFER,d.data,c.DYNAMIC_DRAW);else{const e=d.vertexViewF32.subarray(0,a*d.quadElementSize);c.bufferSubData(c.ARRAY_BUFFER,0,e)}this.renderToFBO&&b.fbo.add(this.framebuffer,!0),c.drawElements(c.TRIANGLES,a*d.quadIndexSize,c.UNSIGNED_SHORT,0),this.renderToFBO&&b.fbo.pop()}flush(){const a=this.count;return a===0?!1:(this.draw(a),this.prevCount=a,this.count=0,!0)}}const np=`\r
#define SHADER_NAME MULTI_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture[%count%];\r
\r
void main (void)\r
{\r
    vec4 color;\r
\r
    %forloop%\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`;class Wj extends ee{constructor(a={fragmentShader:np}){super(a)}createShaders(a,b){const c=Vc();let d="";for(let e=1;e<c;e++)e>1&&(d+=`
	else `),e<c-1&&(d+=`if (vTextureId < ${e}.5)`),d+=`
	{`,d+=`
		color = texture2D(uTexture[${e}], vTextureCoord);`,d+=`
	}`;a=a.replace(/%count%/gi,`${c}`),a=a.replace(/%forloop%/gi,d),super.createShaders(a,b)}bind(a,b){if(!this.program)return!1;const c=this.renderer,d=c.gl,e=this.uniforms;return d.useProgram(this.program),d.uniformMatrix4fv(e.uProjectionMatrix,!1,a),d.uniformMatrix4fv(e.uCameraMatrix,!1,b),d.uniform1iv(e.uTexture,c.textures.textureIndex),d.uniform1f(e.uTime,performance.now()),d.uniform2f(e.uResolution,c.width,c.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}}function Xj(a,b,c=-1,d=1){const e=-2*(1/-a),f=-2*(1/b),g=2*(1/(c-d));return new Float32Array([e,0,0,0,0,f,0,0,0,0,g,0,-1,1,0,1])}class Yj{constructor(a,b){this.renderer=a;const c={shader:new b()};this.stack=[c],this.currentEntry=c,this.current=c.shader,this.singleQuadShader=new ee()}add(a,b){const c={shader:a,textureID:b};return this.stack.push(c),c}set(a,b){this.flush();const c=this.renderer,d=c.projectionMatrix,e=c.currentCamera.matrix,f=a.bind(d,e,b);if(f){const g=this.add(a,b);this.currentEntry=g,this.current=a}return f}setDefault(a){this.set(this.singleQuadShader,a)}pop(){this.flush();const a=this.stack;a.length>1&&a.pop(),this.currentEntry=a[a.length-1],this.current=this.currentEntry.shader}reset(){this.pop(),this.rebind()}flush(){return this.current.flush()?(this.renderer.flushTotal++,!0):!1}rebind(){const a=this.renderer,b=a.projectionMatrix,c=a.currentCamera.matrix,d=this.currentEntry;d.shader.bind(b,c,d.textureID)}popAndRebind(){this.pop(),this.rebind()}clear(){}destroy(){}}const lp=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function mp(a){let b="";for(let c=0;c<a;++c)c>0&&(b+=`
else `),c<a-1&&(b+=`if(test == ${c}.0){}`);return b}function ak(a,b){const c=b.createShader(b.FRAGMENT_SHADER);for(;;){const d=lp.replace(/%forloop%/gi,mp(a));b.shaderSource(c,d),b.compileShader(c);if(!b.getShaderParameter(c,b.COMPILE_STATUS))a=a/2|0;else break}return a}class Zj{constructor(a){this.startActiveTexture=0,this.renderer=a,this.tempTextures=[],this.textureIndex=[]}init(){const a=this.renderer.gl;let b=ak(a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),a);const c=Vc();c===0||c>0&&c>b?dg(b):c>0&&c<b&&(b=Math.max(8,c));const d=this.tempTextures;d.length&&d.forEach(f=>{a.deleteTexture(f)});const e=[];for(let f=0;f<b;f++){const g=a.createTexture();a.activeTexture(a.TEXTURE0+f),a.bindTexture(a.TEXTURE_2D,g),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),d[f]=g,e.push(f)}this.maxTextures=b,this.textureIndex=e,this.currentActiveTexture=1}update(){const a=xc.get();for(let b=0;b<a.length;b++){const c=a[b];c.binding||(c.binding=new wc(c))}xc.clear()}reset(){const a=this.renderer.gl,b=this.tempTextures;for(let c=0;c<b.length;c++)a.activeTexture(a.TEXTURE0+c),a.bindTexture(a.TEXTURE_2D,b[c]);this.currentActiveTexture=1,this.startActiveTexture++}bind(a,b=0){const c=this.renderer.gl,d=a.binding;d.setIndex(b),c.activeTexture(c.TEXTURE0+b),c.bindTexture(c.TEXTURE_2D,d.texture)}unbind(a=0){const b=this.renderer.gl;b.activeTexture(b.TEXTURE0+a),b.bindTexture(b.TEXTURE_2D,this.tempTextures[a]),a>0&&this.startActiveTexture++}request(a){const b=this.renderer.gl,c=a.binding,d=this.currentActiveTexture;return c.indexCounter>=this.startActiveTexture?!1:(c.indexCounter=this.startActiveTexture,d<this.maxTextures?(c.setIndex(d),b.activeTexture(b.TEXTURE0+d),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture++):(this.renderer.flush(),this.startActiveTexture++,c.indexCounter=this.startActiveTexture,c.setIndex(1),b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture=2),!0)}}class Ej{constructor(){this.clearColor=[0,0,0,1],this.flushTotal=0,this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.currentCamera=null,this.width=xb(),this.height=yb(),this.resolution=zb(),this.setBackgroundColor(Pd());const a=document.createElement("canvas");a.addEventListener("webglcontextlost",b=>this.onContextLost(b),!1),a.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=a,this.fbo=new Uj(this),this.textures=new Zj(this),this.initContext(),ad.set(this),this.shaders=new Yj(this,Wj)}initContext(){const a=this.canvas.getContext("webgl",fg());Aa.set(a),this.gl=a,a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE),this.resize(this.width,this.height,this.resolution),this.textures.init()}resize(a,b,c=1){this.width=a*c,this.height=b*c,this.resolution=c;const d=this.canvas;d.width=this.width,d.height=this.height,this.autoResize&&(d.style.width=(this.width/c).toString()+"px",d.style.height=(this.height/c).toString()+"px"),this.gl.viewport(0,0,this.width,this.height),this.projectionMatrix=Xj(a,b)}onContextLost(a){a.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(a){return Vj(a,this.clearColor),this}reset(a=null,b=this.width,c=this.height){const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),d.viewport(0,0,b,c),d.enable(d.BLEND),d.blendFunc(d.ONE,d.ONE_MINUS_SRC_ALPHA),this.flushTotal=0,this.currentCamera=null,this.textures.update()}render(a){if(this.contextLost)return;this.reset();if(this.optimizeRedraw&&a.numDirtyFrames===0&&a.numDirtyCameras===0)return;const b=this.gl;if(this.clearBeforeRender){const d=this.clearColor;b.clearColor(d[0],d[1],d[2],d[3]),b.clear(b.COLOR_BUFFER_BIT)}const c=a.worldData;for(let d=0;d<c.length;d++){const{camera:e,renderList:f}=c[d];(!this.currentCamera||!Qj(e.worldTransform,this.currentCamera.worldTransform))&&(this.flush(),this.currentCamera=e,this.shaders.rebind()),f.forEach(g=>{g.children.length?this.renderNode(g):g.node.renderGL(this)})}this.flush()}renderNode(a){a.node.renderGL(this),a.children.forEach(b=>{b.children.length>0?this.renderNode(b):b.node.renderGL(this)}),a.node.postRenderGL(this)}flush(){this.shaders.flush()}destroy(){ad.set(void 0)}}function Tf(){return()=>{Qd(Ej)}}function za(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);for(const e of d)e.callback.apply(e.context,c),e.once&&d.delete(e);return d.size===0&&a.events.delete(b),!0}function mj(a,b){const c=Rd(b);return c.appendChild(a),a}function nj(a){const b=document.readyState;if(b==="complete"||b==="interactive"){a();return}const c=()=>{document.removeEventListener("deviceready",c,!0),document.removeEventListener("DOMContentLoaded",c,!0),window.removeEventListener("load",c,!0),a()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",c,!0):(document.addEventListener("DOMContentLoaded",c,!0),window.addEventListener("load",c,!0)):window.setTimeout(c,20)}class $f{constructor(){this.events=new Map()}}class Xc{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function Ya(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new Xc(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function Ub(a,b,c,d=a){return Ya(a,b,c,d,!0)}function ek(){return{gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]}}function hk(a,b=0){a.gameFrame=b,a.numTotalFrames=0,a.numDirtyFrames=0,a.numDirtyCameras=0,a.worldData.length=0}let ik;const ge={get:()=>ik,set:a=>{ik=a}};class oj{constructor(){this.scenes=new Map(),this.sceneIndex=0,this.flush=!1,this.renderResult=ek(),this.game=ua.get(),ge.set(this),Ub(this.game,"boot",()=>this.boot())}boot(){eg().forEach(a=>new a())}update(a,b){for(const c of this.scenes.values())za(c,"update",a,b)}render(a){const b=this.renderResult;hk(b,a);for(const c of this.scenes.values())za(c,"render",b);return this.flush&&(b.numDirtyFrames++,this.flush=!1),b}}function bd(a,b){const c=document.createElement("canvas");return c.width=a,c.height=b,c.getContext("2d")}let jk;const Ha={get:()=>jk,set:a=>{jk=a}};class pj{constructor(){this.textures=new Map(),this.createDefaultTextures(),Ha.set(this)}createDefaultTextures(){this.add("__BLANK",new Ma(bd(32,32).canvas));const a=bd(32,32);a.strokeStyle="#0f0",a.moveTo(0,0),a.lineTo(32,32),a.stroke(),a.strokeRect(.5,.5,31,31),this.add("__MISSING",new Ma(a.canvas))}get(a){const b=this.textures;return b.has(a)?b.get(a):b.get("__MISSING")}has(a){return this.textures.has(a)}add(a,b){let c;const d=this.textures;return d.has(a)||(b instanceof Ma?c=b:c=new Ma(b),c.key=a,d.set(a,c)),c}}class dj extends $f{constructor(...a){super();this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,ua.set(this),nj(()=>this.boot(a))}boot(a){a.forEach(d=>d());const b=Zf();this.renderer=new b(),this.textureManager=new pj(),this.sceneManager=new oj();const c=_f();c&&mj(this.renderer.canvas,c),this.isBooted=!0,Yf(),za(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(a){const b=a-this.lastTick;this.lastTick=a,this.elapsed+=b,this.isPaused||(this.willUpdate&&(this.sceneManager.update(b,a),za(this,"update",b,a)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,ua.setFrame(this.frame),ua.setElapsed(this.elapsed),requestAnimationFrame(c=>this.step(c))}destroy(){}}function fk(a,b,c){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:c}function gk(a,b={}){const c=ge.get(),d=c.scenes.size,e=c.sceneIndex,f=d===0;typeof b==="string"?a.key=b:(b||!b&&f)&&(a.key=fk(b,"key","scene"+e.toString())),c.scenes.has(a.key)?console.warn("Scene key already in use: "+a.key):(c.scenes.set(a.key,a),c.flush=!0,c.sceneIndex++)}class Od{constructor(a){this.game=ua.get(),this.events=new Map(),gk(this,a)}}function Sb(a){const b=[a],c=[];for(;b.length>0;){const d=b.shift();c.push(d);const e=d.numChildren;if(e>0)for(let f=e-1;f>=0;f--)b.unshift(d.children[f])}return c.shift(),c}function ob(a,b){return a.children.indexOf(b)}function Sd(a,b){const c=a.children;let d;if(b>=0&&b<c.length){const e=c.splice(b,1);e[0]&&(d=e[0],d.parent=null)}return d}function Tb(a,b){const c=ob(a,b);return c>-1&&Sd(a,c),b}const jg="addedtoworld";const kg="removedfromworld";function ig(a,...b){return b.forEach(c=>{c.world&&(za(c.world,kg,c,c.world),za(c,kg,c,c.world)),c.world=a,za(a,jg,c,a),za(c,jg,c,a)}),b}function Rb(a,...b){b.forEach(d=>{d.parent&&Tb(d.parent,d),d.parent=a});const c=a.world;return c&&ig(c,...Sb(a)),b}function uc(a,b){return a.children.push(b),Rb(a,b),b.transform.updateWorld(),b}const Z={CLEAR:0,TRANSFORM:1,UPDATE:2,CHILD_CACHE:4,POST_RENDER:8,COLORS:16,BOUNDS:32,TEXTURE:64,FRAME:128,ALPHA:256,CHILD:512,DEFAULT:1+2+16+32,USER1:536870912,USER2:1073741824,USER3:2147483648,USER4:4294967296};function Wc(a,b=0,c){const d=a.children;c===void 0&&(c=d.length);const e=c-b;if(e>0&&e<=c){const f=d.splice(b,e);return f.forEach(g=>{g.parent=null}),f}else return[]}function gg(a,b=0,c){const d=Wc(a,b,c);d.forEach(e=>{e.destroy()})}function Ab(a,...b){return b.forEach(c=>{Tb(a,c)}),b}function hg(a,b,c=0,d){const e=Wc(a,c,d);return Rb(b,...e),e.forEach(f=>{f.transform.updateWorld()}),e}class Qb{constructor(a=1,b=0,c=0,d=1,e=0,f=0){this.set(a,b,c,d,e,f)}set(a=1,b=0,c=0,d=1,e=0,f=0){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=e,this.ty=f,this}identity(){return this.set()}toArray(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]}fromArray(a){return this.set(a[0],a[1],a[2],a[3],a[4],a[5])}}function be(a,b,c){return a.width<=0||a.height<=0?!1:a.x<=b&&a.x+a.width>=b&&a.y<=c&&a.y+a.height>=c}class La{constructor(a=0,b=0,c=0,d=0){this.set(a,b,c,d)}set(a=0,b=0,c=0,d=0){return this.x=a,this.y=b,this.width=c,this.height=d,this}contains(a,b){return be(this,a,b)}set right(a){a<=this.x?this.width=0:this.width=a-this.x}get right(){return this.x+this.width}set bottom(a){a<=this.y?this.height=0:this.height=a-this.y}get bottom(){return this.y+this.height}}function Sj(){}class nb{constructor(a,b=0,c=0,d=!1){this.compareValue=!1,this._x=b,this._y=c,this.callback=a,this.compareValue=d}set(a=0,b=0){return this._x=a,this._y=b,this.callback(this),this}destroy(){this.callback=Sj}set x(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._x=a,this.callback(this))}get x(){return this._x}set y(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._y=a,this.callback(this))}get y(){return this._y}}function Pj(a,b,c){const d=c-b;return b+((a-b)%d+d)%d}function tj(a){return Pj(a,-Math.PI,Math.PI)}class uj{constructor(){this._rotation=0,this.type="Camera",this.dirtyRender=!0;const a=ua.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1]),this.bounds=new La(),this.worldTransform=new Qb(),this.position=new nb(()=>this.updateTransform(),0,0),this.scale=new nb(()=>this.updateTransform(),1,1),this.origin=new nb(()=>this.updateTransform(),.5,.5),this.reset()}updateTransform(){const a=this.matrix,b=this.position.x,c=this.position.y,d=this.scale.x,e=this.scale.y,f=-b+this.width*this.origin.x,g=-c+this.height*this.origin.y,i=Math.sin(this.rotation),h=Math.cos(this.rotation),k=i+i,n=i*k,o=h*k,s=(1-n)*d,u=o*d,v=-o*e,y=(1-n)*e;a[0]=s,a[1]=u,a[4]=v,a[5]=y,a[12]=b+f-(s*f+v*g),a[13]=c+g-(u*f+y*g),this.worldTransform.set(h*d,i*d,-i*e,h*e,-b,-c);const G=this.width*(1/d),K=this.height*(1/e);this.bounds.set(f-G/2,g-K/2,G,K),this.dirtyRender=!0}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}set rotation(a){a!==this._rotation&&(this._rotation=tj(a),this.updateTransform())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.origin.destroy(),this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}class vj{constructor(){this.type="StaticCamera",this.dirtyRender=!0;const a=ua.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.bounds=new La(),this.worldTransform=new Qb(),this.reset()}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}const Td="destroy";const Fj="postupdate";const Gj="update";function pb(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof Xc)g.delete(c);else{const i=!d,h=e!==void 0;for(const k of g)k.callback===c&&(i&&k.context===d)&&(h&&k.once===e)&&g.delete(k)}return g.size===0&&f.delete(b),a}function vc(a){const{a:b,b:c,c:d,d:e,tx:f,ty:g}=a.world,{x:i,y:h,right:k,bottom:n}=a.extent,o=i*b+h*d+f,s=i*c+h*e+g,u=i*b+n*d+f,v=i*c+n*e+g,y=k*b+n*d+f,G=k*c+n*e+g,K=k*b+h*d+f,J=k*c+h*e+g;return{x0:o,y0:s,x1:u,y1:v,x2:y,y2:G,x3:K,y3:J}}class Ud{constructor(a){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=a,this.area=new La()}set(a,b,c,d){this.area.set(a,b,c,d)}get(){return this.entity.isDirty(Z.BOUNDS)&&!this.fixed&&this.update(),this.area}updateLocal(){const{x0:a,y0:b,x1:c,y1:d,x2:e,y2:f,x3:g,y3:i}=vc(this.entity.transform),h=Math.min(a,c,e,g),k=Math.min(b,d,f,i),n=Math.max(a,c,e,g),o=Math.max(b,d,f,i);return this.area.set(h,k,n-h,o-k)}update(){const a=this.updateLocal();this.entity.clearDirty(Z.BOUNDS);if(!this.includeChildren||!this.entity.numChildren)return a;const b=this.visibleOnly,c=this.entity.children;let d=a.x,e=a.y,f=a.right,g=a.bottom;for(let i=0;i<c.length;i++){const h=c[i];if(!h||b&&!h.visible)continue;const k=h.bounds.get();k.x<d&&(d=k.x),k.y<e&&(e=k.y),k.right>f&&(f=k.right),k.bottom>g&&(g=k.bottom)}return a.set(d,e,f-d,g-e)}destroy(){this.entity=null,this.area=null}}class Vd{constructor(a){this.enabled=!1,this.enabledChildren=!0,this.entity=a}destroy(){this.entity=null,this.hitArea=null}}class db{constructor(a=0,b=0){this.set(a,b)}set(a=0,b=0){return this.x=a,this.y=b,this}getArray(){return[this.x,this.y]}fromArray(a){return this.set(a[0],a[1])}toString(){return`[x=${this.x}, y=${this.y}]`}}function Xd(a){const b=a.local,c=a.position.x,d=a.position.y,e=a.rotation,f=a.scale.x,g=a.scale.y,i=a.skew.x,h=a.skew.y;b.set(Math.cos(e+h)*f,Math.sin(e+h)*f,-Math.sin(e-i)*g,Math.cos(e-i)*g,c,d)}function mg(a,b){return b.set(a.a,a.b,a.c,a.d,a.tx,a.ty)}function Yd(a){const b=a.parent,c=a.transform,d=c.local,e=c.world;if(!b)mg(d,e);else if(c.passthru)mg(b.transform.world,e);else{const{a:f,b:g,c:i,d:h,tx:k,ty:n}=d,{a:o,b:s,c:u,d:v,tx:y,ty:G}=b.transform.world;e.set(f*o+g*u,f*s+g*v,i*o+h*u,i*s+h*v,k*o+n*u+y,k*s+n*v+G)}}class Wd{constructor(a,b=0,c=0){this.passthru=!1,this._rotation=0,this.entity=a,this.local=new Qb(),this.world=new Qb(),this.position=new nb(()=>this.update(),b,c),this.scale=new nb(()=>this.update(),1,1,!0),this.skew=new nb(()=>this.update(),0,0,!0),this.origin=new nb(()=>this.updateExtent(),bg,cg),this.extent=new La()}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(Z.TRANSFORM,Z.BOUNDS),Xd(this)}updateWorld(){const a=this.entity;a.setDirty(Z.TRANSFORM,Z.BOUNDS),Yd(a),a.numChildren&&this.updateChildren()}updateChildren(){const a=this.entity.children;for(let b=0;b<a.length;b++){const c=a[b];c.transform.updateWorld()}}globalToLocal(a,b,c=new db()){const{a:d,b:e,c:f,d:g,tx:i,ty:h}=this.world,k=1/(d*g+f*-e);return c.x=g*k*a+-f*k*b+(h*f-i*g)*k,c.y=d*k*b+-e*k*a+(-h*d+i*e)*k,c}localToGlobal(a,b,c=new db()){const{a:d,b:e,c:f,d:g,tx:i,ty:h}=this.world;return c.x=d*a+f*b+i,c.y=e*a+g*b+h,c}setExtent(a,b,c,d){this.extent.set(a,b,c,d),this.entity.setDirty(Z.TRANSFORM,Z.BOUNDS)}updateExtent(a,b){const c=this.extent,d=this.entity;a!==void 0&&(c.width=a),b!==void 0&&(c.height=b),c.x=-this.origin.x*c.width,c.y=-this.origin.y*c.height,d.setDirty(Z.TRANSFORM,Z.BOUNDS)}set rotation(a){a!==this._rotation&&(this._rotation=a,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}}class qb{constructor(a=0,b=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.events=new Map(),this.transform=new Wd(this,a,b),this.bounds=new Ud(this),this.input=new Vd(this),this.dirty=Z.DEFAULT,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(a){return(this.dirty&a)!==0}clearDirty(a){return this.isDirty(a)&&(this.dirty^=a),this}setDirty(a,b){return this.isDirty(a)||(this.dirty^=a,this.dirtyFrame=ua.getFrame()),this.isDirty(b)||(this.dirty^=b),this}update(a,b){if(this.willUpdateChildren){const c=this.children;for(let d=0;d<c.length;d++){const e=c[d];e&&e.willUpdate&&e.update(a,b)}}this.postUpdate(a,b)}postUpdate(a,b){}renderGL(a){}renderCanvas(a){}postRenderGL(a){}postRenderCanvas(a){}get numChildren(){return this.children.length}destroy(a){a?hg(this,a):gg(this),za(this,Td,this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}}const ce="worldrender";const de="worldshutdown";var kp=Object.freeze({__proto__:null,WorldRenderEvent:ce,WorldShutdownEvent:de});function he(a,b){b.numRendered++,b.numRenderable++,a.node.dirtyFrame>=b.gameFrame&&b.dirtyFrame++,a.children.forEach(c=>{c.children.length>0&&he(c,b)})}function vg(a){if(a.node.isDirty(Z.CHILD_CACHE))return!0;const b=[a];for(;b.length>0;){const c=b.pop();if(c.node.isDirty(Z.TRANSFORM))return!0;const d=c.children.length;if(d>0)for(let e=0;e<d;e++)b.push(c.children[e])}return b.length=0,!1}function ug(a,b){a.forEach(c=>{b||vg(c)?c.node.setDirty(Z.CHILD_CACHE):c.children.length=0})}function ie(a,b,c=[]){for(let d=0;d<b.numChildren;d++){const e=b.children[d];if(e.isRenderable()){const f=[],g={node:e,children:f};c.push(g),e.willRenderChildren&&e.numChildren>0&&(e.willCacheChildren&&a.push(g),ie(a,e,f))}}return c}function sg(a){const b=[],c=[],d=ie(b,a,c),e=a.renderData;b.length>0&&ug(b,a.camera.dirtyRender),d.forEach(f=>{f.children.length?he(f,e):(e.numRendered++,e.numRenderable++,f.node.dirtyFrame>=e.gameFrame&&e.dirtyFrame++)}),e.renderList=d,a.forceRefresh&&(e.dirtyFrame++,a.forceRefresh=!1)}function tg(a,b){a.numDirtyFrames+=b.dirtyFrame,a.numTotalFrames+=b.numRendered,b.camera.dirtyRender&&a.numDirtyCameras++,a.worldData.push(b)}function cd(a,b){a.gameFrame=b,a.dirtyFrame=0,a.numRendered=0,a.numRenderable=0,a.renderList.length=0}class Yb extends qb{constructor(a){super();this.forceRefresh=!1,this.type="BaseWorld",this.scene=a,this.world=this,this.events=new Map(),this._updateListener=Ya(a,"update",(b,c)=>this.update(b,c)),this._renderListener=Ya(a,"render",b=>this.render(b)),this._shutdownListener=Ya(a,"shutdown",()=>this.shutdown()),Ub(a,"destroy",()=>this.destroy())}update(a,b){if(!this.willUpdate)return;za(this,Gj,a,b,this),super.update(a,b)}postUpdate(a,b){za(this,Fj,a,b,this)}render(a){const b=this.renderData;cd(b,a.gameFrame);if(!this.willRender||!this.visible)return;sg(this),za(this,ce,b,this),tg(a,b),this.camera&&(this.camera.dirtyRender=!1)}shutdown(){const a=this.scene;pb(a,"update",this._updateListener),pb(a,"render",this._renderListener),pb(a,"shutdown",this._shutdownListener),Ab(this),za(this,de,this),cd(this.renderData,0),this.camera&&this.camera.reset()}destroy(a){super.destroy(a),za(this,Td,this),cd(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}}function dd(a){return{camera:a,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0,renderList:[]}}class Uf extends Yb{constructor(a){super(a);this.type="StaticWorld",this.camera=new vj(),this.renderData=dd(this.camera)}}class op extends Yb{constructor(a){super(a);this.enableCameraCull=!0,this.type="World",this.camera=new uj(),this.renderData=dd(this.camera)}}function Ij(a,b){const c=a.texture,d=b.shaders.current,e=d.buffer,f=c.binding;d.count===e.batchSize&&b.flush();const g=a.vertexData;b.textures.request(c);const i=f.index;g[4]=i,g[10]=i,g[16]=i,g[22]=i;const h=d.count*e.quadElementSize;e.vertexViewF32.set(g,h);const k=a.vertexColor,n=e.vertexViewU32;n[h+5]=k[0],n[h+11]=k[2],n[h+17]=k[3],n[h+23]=k[1],d.count++}var ep=Object.freeze({__proto__:null,BoundsComponent:Ud,InputComponent:Vd,GetVertices:vc,TransformComponent:Wd,UpdateLocalTransform:Xd,UpdateWorldTransform:Yd});class Vb extends qb{constructor(a=0,b=0){super(a,b);this._alpha=1,this.type="Container"}setSize(a,b=a){return this.transform.updateExtent(a,b),this}setPosition(a,b){return this.transform.position.set(a,b),this}setOrigin(a,b=a){return this.transform.origin.set(a,b),this}setSkew(a,b=a){return this.transform.skew.set(a,b),this}setScale(a,b=a){return this.transform.scale.set(a,b),this}setRotation(a){return this.transform.rotation=a,this}set width(a){this.transform.updateExtent(a)}get width(){return this.transform.extent.width}set height(a){this.transform.updateExtent(void 0,a)}get height(){return this.transform.extent.height}set x(a){this.transform.position.x=a}get x(){return this.transform.position.x}set y(a){this.transform.position.y=a}get y(){return this.transform.position.y}set originX(a){this.transform.origin.x=a}get originX(){return this.transform.origin.x}set originY(a){this.transform.origin.y=a}get originY(){return this.transform.origin.y}set skewX(a){this.transform.skew.x=a}get skewX(){return this.transform.skew.x}set skewY(a){this.transform.skew.y=a}get skewY(){return this.transform.skew.y}set scaleX(a){this.transform.scale.x=a}get scaleX(){return this.transform.scale.x}set scaleY(a){this.transform.scale.y=a}get scaleY(){return this.transform.scale.y}set rotation(a){this.transform.rotation=a}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(a){a!==this._alpha&&(this._alpha=a,this.setDirty(Z.TRANSFORM))}}function Jj(a,b){const c=a.frame;if(!c)return;const d=b.ctx,e=a.transform,{a:f,b:g,c:i,d:h,tx:k,ty:n}=e.world,{x:o,y:s}=e.extent;d.save(),d.setTransform(f,g,i,h,k,n),d.globalAlpha=a.alpha,d.drawImage(c.texture.image,c.x,c.y,c.width,c.height,o,s,c.width,c.height),d.restore()}function Xb(a,b){const c=(b*255|0)&255;return(c<<24|a)>>>0}function ae(a){const b=a.vertexAlpha,c=a.vertexTint,d=a.vertexColor;return d[0]=Xb(c[0],b[0]),d[1]=Xb(c[1],b[1]),d[2]=Xb(c[2],b[2]),d[3]=Xb(c[3],b[3]),a}function $d(a,b,...c){const d=a.getFrame(b),{u0:e,u1:f,v0:g,v1:i,pivot:h}=d;return c.forEach(k=>{if(!k||d===k.frame)return;k.frame=d,h&&k.setOrigin(h.x,h.y),k.frame.setExtent(k),k.hasTexture=!0;const n=k.vertexData;n[2]=e,n[3]=g,n[8]=e,n[9]=i,n[14]=f,n[15]=i,n[20]=f,n[21]=g}),c}function Hj(a,b,...c){if(!a)c.forEach(d=>{d.texture=null,d.frame=null,d.hasTexture=!1});else{let d;a instanceof Ma?d=a:d=Ha.get().get(a),d?(c.forEach(e=>{e.texture=d}),$d(d,b,...c)):console.warn(`Invalid Texture key: ${a}`)}return c}function Kj(a){const b=a.vertexData,{x0:c,y0:d,x1:e,y1:f,x2:g,y2:i,x3:h,y3:k}=vc(a.transform);return b[0]=c,b[1]=d,b[6]=e,b[7]=f,b[12]=g,b[13]=i,b[18]=h,b[19]=k,a}class cb extends Vb{constructor(a,b,c,d){super(a,b);this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertexData=new Float32Array(24).fill(0),this.vertexColor=new Uint32Array(4).fill(4294967295),this.vertexAlpha=new Float32Array(4).fill(1),this.vertexTint=new Uint32Array(4).fill(16777215),this.setTexture(c,d)}setTexture(a,b){return Hj(a,b,this),this}setFrame(a){return $d(this.texture,a,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}preRender(){this.isDirty(Z.COLORS)&&(ae(this),this.clearDirty(Z.COLORS)),this.isDirty(Z.TRANSFORM)&&(Kj(this),this.clearDirty(Z.TRANSFORM))}renderGL(a){this.preRender(),Ij(this,a)}renderCanvas(a){this.preRender(),Jj(this,a)}get alpha(){return this._alpha}set alpha(a){if(a!==this._alpha){this._alpha=a;const b=this.vertexAlpha;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(Z.ALPHA)}}get tint(){return this._tint}set tint(a){if(a!==this._tint){this._tint=a;const b=this.vertexTint;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(Z.COLORS)}}destroy(a){super.destroy(a),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertexData=null,this.vertexColor=null,this.vertexAlpha=null,this.vertexTint=null}}class cp extends cb{constructor(a,b,c,d){super(a,b,c,d);this.type="AnimatedSprite",this.anims=new Map(),this.animData={currentAnim:"",currentFrames:[],frameIndex:0,animSpeed:0,nextFrameTime:0,repeatCount:0,isPlaying:!1,yoyo:!1,pendingStart:!1,playingForward:!0,delay:0,repeatDelay:0,onStart:null,onRepeat:null,onComplete:null}}stop(){const a=this.animData;a.isPlaying=!1,a.currentAnim="",a.onComplete&&a.onComplete(this,a.currentAnim)}nextFrame(){const a=this.animData;a.frameIndex++;if(a.frameIndex===a.currentFrames.length)if(a.yoyo)a.frameIndex--,a.playingForward=!1;else if(a.repeatCount===-1||a.repeatCount>0)a.frameIndex=0,a.repeatCount!==-1&&a.repeatCount--,a.onRepeat&&a.onRepeat(this,a.currentAnim),a.nextFrameTime+=a.repeatDelay;else return a.frameIndex--,this.stop();this.setFrame(a.currentFrames[a.frameIndex]),a.nextFrameTime+=a.animSpeed}prevFrame(){const a=this.animData;a.frameIndex--;if(a.frameIndex===-1)if(a.repeatCount===-1||a.repeatCount>0)a.frameIndex=0,a.playingForward=!0,a.repeatCount!==-1&&a.repeatCount--,a.onRepeat&&a.onRepeat(this,a.currentAnim),a.nextFrameTime+=a.repeatDelay;else return a.frameIndex=0,this.stop();this.setFrame(a.currentFrames[a.frameIndex]),a.nextFrameTime+=a.animSpeed}update(a,b){super.update(a,b);const c=this.animData;if(!c.isPlaying)return;c.nextFrameTime-=a*1e3,c.nextFrameTime=Math.max(c.nextFrameTime,0),c.nextFrameTime===0&&(c.pendingStart?(c.onStart&&c.onStart(this,c.currentAnim),c.pendingStart=!1,c.nextFrameTime=c.animSpeed):c.playingForward?this.nextFrame():this.prevFrame())}get isPlaying(){return this.animData.isPlaying}get isPlayingForward(){return this.animData.isPlaying&&this.animData.playingForward}get currentAnimation(){return this.animData.currentAnim}destroy(a){super.destroy(a),this.anims.clear(),this.animData=null}}function lg(a,b,c,d,e,f,g=0,i=1,h=1,k=0,n=0){const o=Math.cos(g+n)*i,s=Math.sin(g+n)*i,u=-Math.sin(g-k)*h,v=Math.cos(g-k)*h,y=a*o+c*u+e,G=a*s+c*v+f,K=a*o+d*u+e,J=a*s+d*v+f,N=b*o+d*u+e,I=b*s+d*v+f,O=b*o+c*u+e,P=b*s+c*v+f;return{x0:y,y0:G,x1:K,y1:J,x2:N,y2:I,x3:O,y3:P}}function Zd(a,b,c,d,e,f,g,i,h,k=0,n=4294967295){const o=a.shaders.current,s=o.buffer,u=s.vertexViewF32,v=s.vertexViewU32,y=o.count*s.quadElementSize;u[y+0]=b,u[y+1]=c,u[y+2]=f,u[y+3]=h,u[y+4]=k,v[y+5]=n,u[y+6]=b,u[y+7]=c+e,u[y+8]=f,u[y+9]=g,u[y+10]=k,v[y+11]=n,u[y+12]=b+d,u[y+13]=c+e,u[y+14]=i,u[y+15]=g,u[y+16]=k,v[y+17]=n,u[y+18]=b+d,u[y+19]=c,u[y+20]=i,u[y+21]=h,u[y+22]=k,v[y+23]=n,o.count++}function Yc(a,b,c,d,e,f,g,i,h,k=0,n=4294967295){a.shaders.setDefault(k),Zd(a,b,c,d,e,f,g,i,h,k,n),a.shaders.popAndRebind()}class Zc extends qb{constructor(){super();this.type="Layer",this.transform.passthru=!0,this.willRender=!1}}class ng extends Zc{constructor(){super();this.type="RenderLayer",this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!0,this.setDirty(Z.CHILD_CACHE);const a=xb(),b=yb(),c=zb(),d=new Ma(null,a*c,b*c);d.binding=new wc(d),d.binding.framebuffer=_d(d.binding.texture),this.texture=d,this.framebuffer=d.binding.framebuffer}renderGL(a){this.numChildren>0&&(a.flush(),this.isDirty(Z.CHILD_CACHE)?(a.fbo.add(this.framebuffer,!0),this.clearDirty(Z.CHILD_CACHE)):(a.fbo.add(this.framebuffer,!1),this.postRenderGL(a)))}postRenderGL(a){const b=this.texture;a.flush(),a.fbo.pop();const{u0:c,v0:d,u1:e,v1:f}=b.firstFrame;a.textures.bind(b),Yc(a,0,0,b.width,b.height,c,d,e,f),a.textures.unbind(),this.clearDirty(Z.TRANSFORM)}}class dp extends ng{constructor(){super();this.shaders=[],this.type="EffectLayer"}postRenderGL(a){const b=this.shaders,c=this.texture;a.flush(),a.fbo.pop();if(b.length===0){const{u0:d,v0:e,u1:f,v1:g}=c.firstFrame;a.textures.bind(c),Yc(a,0,0,c.width,c.height,d,e,f,g),a.textures.unbind()}else{let d=c;for(let h=0;h<b.length;h++){const k=b[h],{u0:n,v0:o,u1:s,v1:u}=d.firstFrame;a.shaders.set(k,0)&&(k.renderToFBO=!0,a.textures.bind(d),Zd(a,0,0,d.width,d.height,n,o,s,u),a.shaders.pop(),a.textures.unbind(),d=k.texture)}const{u0:e,v0:f,u1:g,v1:i}=d.firstFrame;a.textures.bind(d),Yc(a,0,0,d.width,d.height,e,f,g,i),a.textures.unbind()}this.clearDirty(Z.TRANSFORM)}}function Lj(a,b){const c=a.texture,d=b.shaders.current,e=d.buffer;b.flush(),b.textures.request(c),a.updateTextureIndex();const f=b.gl;d.bindBuffers(a.indexBuffer,a.vertexBuffer),f.bufferData(f.ARRAY_BUFFER,a.data,f.STATIC_DRAW),f.drawElements(f.TRIANGLES,a.count*e.quadIndexSize,f.UNSIGNED_SHORT,0),d.prevCount=a.count,b.flushTotal++,d.bindBuffers(e.indexBuffer,e.vertexBuffer)}function Mj(a,b,c){return Math.max(b,Math.min(c,a))}class fp extends Zc{constructor(a,b){super();this.glTextureIndex=0,this.hasTexture=!1,this.type="SpriteBatch",this.willRender=!0,this.setTexture(b),this.setMaxSize(a)}resetBuffers(){let a=[];for(let c=0;c<this.maxSize*4;c+=4)a.push(c+0,c+1,c+2,c+2,c+3,c+0);this.data=new ArrayBuffer(this.maxSize*96),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const b=Aa.get();b&&(Wb(this.vertexBuffer),Wb(this.indexBuffer),this.vertexBuffer=b.createBuffer(),this.indexBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.data,b.STATIC_DRAW),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.index,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,null)),a=[],this.count=0}setMaxSize(a){return this.maxSize=Mj(a,0,65535),this.resetBuffers(),this}setTexture(a){let b;return a instanceof Ma?b=a:b=Ha.get().get(a),b?(this.texture=b,this.hasTexture=!0,this.glTextureIndex=-1):console.warn(`Invalid Texture key: ${a}`),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.count>0}clear(){return this.count=0,this}addToBatch(a,b,c,d,e,f,g,i,h,k){if(this.count>=this.maxSize)return console.warn("SpriteBatch full"),this;const{u0:n,u1:o,v0:s,v1:u}=a,v=this.vertexViewF32,y=this.vertexViewU32,G=this.count*24,K=this.texture.binding?this.texture.binding.index:0;return v[G+0]=c,v[G+1]=d,v[G+2]=n,v[G+3]=s,v[G+4]=K,y[G+5]=b,v[G+6]=e,v[G+7]=f,v[G+8]=n,v[G+9]=u,v[G+10]=K,y[G+11]=b,v[G+12]=g,v[G+13]=i,v[G+14]=o,v[G+15]=u,v[G+16]=K,y[G+17]=b,v[G+18]=h,v[G+19]=k,v[G+20]=o,v[G+21]=s,v[G+22]=K,y[G+23]=b,this.setDirty(Z.TRANSFORM),this.count++,this}add(a){const{frame:b=null,x:c=0,y:d=0,rotation:e=0,scaleX:f=1,scaleY:g=1,skewX:i=0,skewY:h=0,originX:k=0,originY:n=0,alpha:o=1,tint:s=16777215}=a,u=this.texture.getFrame(b),{left:v,right:y,top:G,bottom:K}=u.getExtent(k,n),{x0:J,y0:N,x1:I,y1:O,x2:P,y2:L,x3:r,y3:t}=lg(v,y,G,K,c,d,e,f,g,i,h),j=Xb(s,o);return this.addToBatch(u,j,J,N,I,O,P,L,r,t)}addXY(a,b,c){const d=this.texture.getFrame(c),{left:e,right:f,top:g,bottom:i}=d.getExtent(0,0),{x0:h,y0:k,x1:n,y1:o,x2:s,y2:u,x3:v,y3:y}=lg(e,f,g,i,a,b);return this.addToBatch(d,4294967295,h,k,n,o,s,u,v,y)}updateTextureIndex(){const a=this.texture.binding.index;if(a===this.glTextureIndex)return;const b=this.vertexViewF32;this.glTextureIndex=a;for(let c=0;c<this.count;c++)b[c*24+4]=a,b[c*24+10]=a,b[c*24+16]=a,b[c*24+22]=a}renderGL(a){Lj(this,a)}destroy(){super.destroy(),Wb(this.vertexBuffer),Wb(this.indexBuffer),this.data=null,this.vertexViewF32=null,this.vertexViewU32=null,this.index=null,this.texture=null,this.hasTexture=!1}}function Bb(a=32,b=32){const c=bd(a,b);return new Ma(c.canvas)}class gp extends cb{constructor(a,b,c="",d,e){super(a,b,Bb());this.splitRegExp=/(?:\r\n|\r|\n)/,this.padding={left:0,right:0,top:0,bottom:0},this.verticalAlign="ascent",this.lineSpacing=0,this.font="16px monospace",this.fillStyle="#fff",this.strokeStyle="",this.backgroundStyle="",this.cornerRadius=0,this.textAlign="left",this.textBaseline="alphabetic",this.lineWidth=0,this.lineDash=[],this.antialias=!1,this.type="Text";const f=ua.get();this.resolution=f.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),d&&(this.font=d),e&&(this.fillStyle=e),this.setText(c)}syncContext(a,b){this.preRenderCallback&&this.preRenderCallback(a,b),b.font=this.font,b.textBaseline=this.textBaseline,b.textAlign=this.textAlign,b.fillStyle=this.fillStyle,b.strokeStyle=this.strokeStyle,b.lineWidth=this.lineWidth,b.lineCap="round",b.lineJoin="round",b.setLineDash(this.lineDash),b.imageSmoothingEnabled=this.antialias}updateText(){const a=this.canvas,b=this.context,c=this.resolution,d=this._text.split(this.splitRegExp),e=this.padding,f=this.fillStyle,g=this.strokeStyle,i=this.lineWidth,h=this.lineSpacing,k=i>0?i/2:0;b.clearRect(0,0,a.width,a.height),this.syncContext(a,b),b.textAlign="start";let n=0,o=0,s=0;const u=[],v=this.verticalAlign==="ascent",y=b.measureText("|MÃq"),G=Math.ceil(Math.abs(y.actualBoundingBoxAscent)+Math.abs(y.actualBoundingBoxDescent))+i;for(let j=0;j<d.length;j++){const m=b.measureText(d[j]),l=m.actualBoundingBoxLeft,q=m.actualBoundingBoxRight;let w=m.actualBoundingBoxAscent,p=m.actualBoundingBoxDescent;(!w&&!p||d[j]==="")&&(w=G,p=0);const E=Math.ceil(Math.abs(l)+Math.abs(q))+i,H=Math.ceil(Math.abs(w)+Math.abs(p))+i;v?(s+=w+k,j>0&&(s+=h+k),o=s+p+k):(s=o+(H-p-k),o+=H,j<d.length-1&&(o+=h)),n=Math.max(n,E),u.push({lineWidth:E,lineHeight:H,ascent:w,descent:p,left:l,right:q,y:s})}n+=e.left+e.right,o+=e.top+e.bottom;const K=this.fixedWidth?this.fixedWidth:n,J=this.fixedHeight?this.fixedHeight:o,N=Math.ceil(K*c),I=Math.ceil(J*c);(a.width!==N||a.height!==I)&&(a.width=N,a.height=I,this.texture.setSize(K,J),this.setSize(K,J)),b.save(),b.scale(c,c),this.syncContext(a,b);const O=this.backgroundStyle;if(O){b.save(),b.fillStyle=O,b.strokeStyle=O;const j=this.cornerRadius,m=j>0?j/2:0;j&&(b.lineWidth=j,b.strokeRect(m,m,K-j,J-j)),b.fillRect(m,m,K-j,J-j),b.restore()}const P=this.textAlign,L=P==="center",r=P==="right"||P==="end",t=(J-o)/2+e.top;for(let j=0;j<d.length;j++){const m=d[j],l=u[j];let q=e.left+l.left+k;const w=t+l.y;L?q=K/2:r&&(q=K-k),g&&b.strokeText(m,q,w),f&&b.fillText(m,q,w)}return b.restore(),this.texture.binding&&this.texture.binding.update(),this.setDirty(Z.TEXTURE),this}get text(){return this._text}set text(a){this.setText(a)}setText(a=""){return Array.isArray(a)&&(a=a.join(`
`)),a!==this._text&&(this._text=a.toString(),this.updateText()),this}destroy(a){this.texture.destroy(),this.fillStyle=null,this.strokeStyle=null,this.backgroundStyle=null,this.canvas=null,this.context=null,super.destroy(a)}}function ej(a,...b){return b.forEach(c=>{const d=c.vertexTint;d[0]=a,d[1]=a,d[2]=a,d[3]=a,ae(c)}),b}function wb(a,b,c,d=1){let e;if(typeof a==="string"){let i=Ha.get();i.has(a)||i.add(a,Bb()),e=i.get(a)}else e=a;let f=e.image,g=f.getContext("2d");return c?b.call(c,f,g):b(f,g),e.setSize(f.width/d,f.height/d),e.binding&&e.binding.update(),e}function Pa(a,b,c){switch(typeof a){case"number":return`#${a.toString(16)}`;case"function":return a(b,c);default:return a}}function pf(a,b,c,d,e,f,g,i,h,k,n=!0){b.beginPath(),b.rect(c,d,e,f);if(g){if(k){let o;n?o=b.createLinearGradient(0,0,e,0):o=b.createLinearGradient(0,0,0,f),o.addColorStop(0,g),o.addColorStop(1,k),g=o}b.fillStyle=g,b.fill()}i&&(b.strokeStyle=i,b.lineWidth=h,b.stroke())}function Vf(a,{width:b=32,height:c=b,fillStyle:d,fillColor2:e,isHorizontalGradient:f=!0,strokeStyle:g,lineWidth:i=2}={}){return wb(a,function(h,k){h.width=Math.ceil(b),h.height=Math.ceil(c),g||(i=0);const n=i/2,o=n,s=n;b-=i,c-=i,pf(h,k,o,s,b,c,Pa(d,h,k),Pa(g,h,k),i,Pa(e,h,k),f)})}class Go{constructor(a=0,b=a,c=0,d=c,e=0){this._width=0;this._height=0;this.cornerRadius={tl:bb(0),tr:bb(0),bl:bb(0),br:bb(0)};this.setTo(a,b,c,d,e)}setTo(a=0,b=a,c=0,d=c,e=0){return this.setPosition(a,b),this.setRadius(e),this.setSize(c,d),this}setPosition(a=0,b=a){return this.x=a,this.y=b,this}setRadius(a=0){let b=this.cornerRadius;if(typeof a==="number"){const c=a,d=a;b.tl=bb(void 0,c,d),b.tr=bb(void 0,c,d),b.bl=bb(void 0,c,d),b.br=bb(void 0,c,d)}else{const c=a.x??0,d=a.y??0;b.tl=bb(a.tl,c,d),b.tr=bb(a.tr,c,d),b.bl=bb(a.bl,c,d),b.br=bb(a.br,c,d)}return this}setSize(a=0,b=a){return this.width=a,this.height=b,this}get minWidth(){let a=this.cornerRadius;return Math.max(a.tl.x+a.tr.x,a.bl.x+a.br.x)}get minHeight(){let a=this.cornerRadius;return Math.max(a.tl.y+a.bl.y,a.tr.y+a.br.y)}get width(){return this._width}set width(a){a==null&&(a=0),this._width=Math.max(a,this.minWidth)}get height(){return this._height}set height(a){a==null&&(a=0),this._height=Math.max(a,this.minHeight)}get radius(){let a=this.cornerRadius,b=Math.max(a.tl.x,a.tl.y,a.tr.x,a.tr.y,a.bl.x,a.bl.y,a.br.x,a.br.y);return b}}function bb(a,b,c){return a===void 0?{x:b,y:c}:typeof a==="number"?{x:a,y:a}:a}const Hr=Math.PI/180;function Fb(a){return a*Hr}const Ho=Fb(0),Io=Fb(90),Jo=Fb(180),Ko=Fb(270);function of(a,b,c,d,e,f){const g=new Go(b,c,d,e,f),i=g.minWidth,h=g.minHeight,k=d>=i?1:d/i,n=e>=h?1:e/h,o=g.cornerRadius;let s,u,v,y,G;a.beginPath(),a.translate(b,c),s=o.br,u=s.x*k,v=s.y*n,y=g.width-u,G=g.height-v,Kf(s)&&u>=0&&v>=0?a.ellipse(y,G,u,v,0,Ho,Io):(a.moveTo(g.width,G),a.lineTo(g.width,g.height),a.lineTo(y,g.height)),s=o.bl,u=s.x*k,v=s.y*n,y=u,G=g.height-v,a.lineTo(u,g.height),Kf(s)&&u>=0&&v>=0?a.ellipse(y,G,u,v,0,Io,Jo):(a.lineTo(0,g.height),a.lineTo(0,G)),s=o.tl,u=s.x*k,v=s.y*n,y=u,G=v,a.lineTo(0,G),Kf(s)&&u>=0&&v>=0?a.ellipse(y,G,u,v,0,Jo,Ko):(a.lineTo(0,0),a.lineTo(y,0)),s=o.tr,u=s.x*k,v=s.y*n,y=g.width-u,G=v,a.lineTo(y,0),Kf(s)&&u>=0&&v>=0?a.ellipse(y,G,u,v,0,Ko,Ho):(a.lineTo(g.width,0),a.lineTo(g.width,G)),a.closePath()}function Kf(a){return a.x!==0&&a.y!==0}function Ad(a,b,c,d,e,f,g,i,h,k,n,o=!0){of(b,c,d,e,f,g);if(i){if(n){let s;o?s=b.createLinearGradient(0,0,e,0):s=b.createLinearGradient(0,0,0,f),s.addColorStop(0,i),s.addColorStop(1,n),i=s}b.fillStyle=i,b.fill()}h&&(b.strokeStyle=h,b.lineWidth=k,b.stroke())}var Ao;(function(a){a[a.right=0]="right",a[a.down=1]="down",a[a.left=2]="left",a[a.up=3]="up"})(Ao||(Ao={}));function Wf(a,b){return Math.floor(Math.random()*(b-a+1)+a)}var Ui;(function(a){a[a.IDLE=0]="IDLE",a[a.UPDATING=1]="UPDATING"})(Ui||(Ui={}));function lf(a,b,c){const d=Math.ceil(b*a.resolution),e=Math.ceil(c*a.resolution),f=a.canvas;if(f.width===d||f.height===e){mf(a);return}f.width=d,f.height=e,a.texture.setSize(b,c),a.setSize(b,c),a.updateTexture()}function mf(a){a.context.clearRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function ii(a,b="#fff"){let c=a.context;c.fillStyle=b,c.fillRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function nf(a,b,c){const d=new Image();d.onload=function(){const e=a.resolution,f=d.width/e,g=d.height/e;lf(a,f,g),a.context.drawImage(d,0,0),a.updateTexture(),c&&c(),d.onload=null,d.src="",d.remove()},d.src=b}function ji(a,b){return new Promise(function(c,d){nf(a,b,c)})}function ki(a,b,c){return a.canvas.toDataURL(b,c)}function li(a,b,c,d=[0,0,0,0]){const e=a.context.getImageData(b,c,1,1).data;return d[0]=e[0],d[1]=e[1],d[2]=e[2],d[3]=e[3],d}function mi(a,b,c,d,e,f,g){g===void 0&&(g=d!==0||e!==0||f!==0?255:0);const i=a.context.createImageData(1,1);i.data[0]=d,i.data[1]=e,i.data[2]=f,i.data[3]=g,a.context.putImageData(i,b,c),a.updateTexture()}class jb extends cb{constructor(a=0,b=0,c=32,d=32){super(a,b,Bb());this.type="rexCanvas";const e=ua.get();this.resolution=e.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.resize(c,d)}updateTexture(){return this.texture.binding&&this.texture.binding.update(),this.setDirty(Z.TEXTURE),this}destroy(a){this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}resize(a,b){return lf(this,a,b),this}clear(){return mf(this),this}}function cn(a,b){b.width!==a.width&&(b.width=a.width),b.height!==a.height&&(b.height=a.height);let c=b.getContext("2d");return c.drawImage(a.texture.image,a.x,a.y,a.width,a.height),b}function ni(a,b,c=0,d=0,e=a.width,f=a.height){const g=a.resolution,i=a.canvas,h=Math.ceil(e*g),k=Math.ceil(f*g);wb(b,function(n,o){n.width!==h&&(n.width=h),n.height!==k&&(n.height=k),o.clearRect(0,0,h,k),o.drawImage(i,c,d,h,k)},void 0,a.resolution)}function oi(a,b,c){const d=Ha.get();if(!d.has(b))return;cn(d.get(b).getFrame(c),a.canvas);const e=a.canvas.width,f=a.canvas.height,g=a.resolution,i=e/g,h=f/g;a.texture.setSize(i,h),a.setSize(i,h),a.updateTexture()}class pi extends jb{fill(a="#fff"){return ii(this,a),this}getCanvas(){return this.canvas}getContext(){return this.context}getDataURL(a,b){return ki(this,a,b)}getPixel(a,b,c=[0,0,0,0]){return li(this,a,b,c)}generateTexture(a,b=0,c=0,d=this.width,e=this.height){return ni(this,a,b,c,d,e),this}loadFromURL(a,b){return nf(this,a,b),this}loadFromURLPromise(a){return ji(this,a)}loadTexture(a,b){return oi(this,a,b),this}setPixel(a,b,c,d,e,f){return mi(this,a,b,c,d,e,f),this}}var Nb;(function(a){a[a.circle=0]="circle",a[a.ellipse=1]="ellipse",a[a.roundRectangle=2]="roundRectangle"})(Nb||(Nb={}));class vd extends jb{constructor(a,b,c,d,e=Nb.circle){super(a,b);this.type="rexMaskedImage",this.maskImage(c,d,e)}maskImage(a,b,c=Nb.circle){let d,e,f;typeof c==="object"?{maskType:d,backgroundStyle:e,radius:f}=c:d=c,typeof d==="string"&&(d=Nb[d]);const g=this.canvas,i=this.context,h=Ha.get();if(!h.has(a))return;const k=h.get(a).getFrame(b),n=k.width,o=k.height;g.width!==n&&(g.width=n),g.height!==o&&(g.height=o),i.clearRect(0,0,n,o),e&&(i.fillStyle=e,i.fillRect(0,0,n,o)),i.beginPath();switch(d){case Nb.roundRectangle:of(i,0,0,n,o,f);break;default:const s=Math.floor(n/2),u=Math.floor(o/2);d===Nb.circle?i.arc(s,u,Math.min(s,u),0,2*Math.PI):i.ellipse(s,u,s,u,0,0,2*Math.PI);break}i.clip(),i.drawImage(k.texture.image,k.x,k.y,k.width,k.height),this.texture.setSize(n,o),this.setSize(n,o),this.updateTexture()}}class wd extends jb{constructor({x:a=0,y:b=0,width:c=1,height:d=1,fillStyle:e,fillColor2:f,isHorizontalGradient:g=!0,strokeStyle:i,lineWidth:h=2}={}){super(a,b);this.type="rexCanvasRoundRectangle",this.setFillStyle(e,f,g),this.setStrokeStyle(i,h),this.resize(c,d)}setFillStyle(a,b,c=!0){return this.fillStyle=a,this.fillColor2=b,this.isHorizontalGradient=c,this}setStrokeStyle(a,b){return this.strokeStyle=a,this.lineWidth=b,this}resize(a,b){return super.resize(a,b),this.refresh(),this}refresh(){let a=this.lineWidth;this.strokeStyle||(a=0);const b=a/2,c=b,d=b,e=this.width-a,f=this.height-a;return pf(this.canvas,this.context,c,d,e,f,Pa(this.fillStyle,this.canvas,this.context),Pa(this.strokeStyle,this.canvas,this.context),a,Pa(this.fillColor2,this.canvas,this.context),this.isHorizontalGradient),this}}class xd extends jb{constructor({x:a=0,y:b=0,width:c=1,height:d=1,radius:e=0,fillStyle:f,fillColor2:g,isHorizontalGradient:i=!0,strokeStyle:h,lineWidth:k=2}={}){super(a,b);this.type="rexCanvasRoundRectangle",this.setRadius(e),this.setFillStyle(f,g,i),this.setStrokeStyle(h,k),this.resize(c,d)}setRadius(a){return this.radius=a,this}setFillStyle(a,b,c=!0){return this.fillStyle=a,this.fillColor2=b,this.isHorizontalGradient=c,this}setStrokeStyle(a,b){return this.strokeStyle=a,this.lineWidth=b,this}resize(a,b){return super.resize(a,b),this.refresh(),this}refresh(){let a=this.lineWidth;this.strokeStyle||(a=0);const b=a/2,c=b,d=b,e=this.width-a,f=this.height-a;return Ad(this.canvas,this.context,c,d,e,f,this.radius,Pa(this.fillStyle,this.canvas,this.context),Pa(this.strokeStyle,this.canvas,this.context),a,Pa(this.fillColor2,this.canvas,this.context),this.isHorizontalGradient),this}}function Ob(a=0,b={left:0,right:0,top:0,bottom:0}){if(typeof a==="number")b.left=a,b.right=a,b.top=a,b.bottom=a;else{let c,d,e,f;({left:c=0,right:d=0,top:e=0,bottom:f=0}=a),b.left=c,b.right=d,b.top=e,b.bottom=f}return b}function lc(a){return a.x-a.originX*a.width}function nc(a){return a.x+(.5-a.originX)*a.width}function mc(a){return a.x+(1-a.originX)*a.width}function oc(a){return a.y-a.originY*a.height}function qc(a){return a.y+(.5-a.originY)*a.height}function pc(a){return a.y+(1-a.originY)*a.height}function Bd(a,b){a.x+=b-lc(a)}function Dd(a,b){a.x+=b-nc(a)}function Cd(a,b){a.x+=b-mc(a)}function Ed(a,b){a.y+=b-oc(a)}function Gd(a,b){a.y+=b-qc(a)}function Fd(a,b){a.y+=b-pc(a)}function dn(a,b=[]){const c=a.sizerChildren;for(var d=0,e=c.length;d<e;d++){const f=c[d];f instanceof na&&b.push(f)}return b}function en(a,b,c,d){if(a.rexSizer.hidden||!a.needLayout)return a;a.preLayout(b,c,d),c===void 0&&(c=Math.max(a.childrenWidth,a.minWidth)),d===void 0&&(d=Math.max(a.childrenHeight,a.minHeight)),a.resize(c,d),a.layoutBackgrounds(),a.postLayout(b,c,d)}function qi(a,b,c,d){if(b)return;a.layoutInit();const e=a.getChildrenSizers();for(var f=0,g=e.length;f<g;f++){const i=e[f];if(i.rexSizer.hidden||!i.needLayout)continue;qi(i)}}function qf(a){a._childrenWidth=void 0,a._childrenHeight=void 0}function Pc(a,b,c){if(!a||b===void 0&&c===void 0)return;a.resize?(b===void 0&&(b=a.width),c===void 0&&(c=a.height),a.resize(b,c)):(b!==void 0&&(a.width=b),c!==void 0&&(a.height=c))}var Da;(function(a){a[a.LEFT_TOP=0]="LEFT_TOP",a[a.TOP_LEFT=0]="TOP_LEFT",a[a.CENTER_TOP=1]="CENTER_TOP",a[a.TOP_CENTER=1]="TOP_CENTER",a[a.RIGHT_TOP=2]="RIGHT_TOP",a[a.TOP_RIGHT=2]="TOP_RIGHT",a[a.LEFT_CENTER=3]="LEFT_CENTER",a[a.CENTER_LEFT=3]="CENTER_LEFT",a[a.CENTER=4]="CENTER",a[a.CENTER_CENTER=4]="CENTER_CENTER",a[a.RIGHT_CENTER=5]="RIGHT_CENTER",a[a.CENTER_RIGHT=5]="CENTER_RIGHT",a[a.LEFT_BOTTOM=6]="LEFT_BOTTOM",a[a.BOTTOM_LEFT=6]="BOTTOM_LEFT",a[a.CENTER_BOTTOM=7]="CENTER_BOTTOM",a[a.BOTTOM_CENTER=7]="BOTTOM_CENTER",a[a.RIGHT_BOTTOM=8]="RIGHT_BOTTOM",a[a.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(Da||(Da={}));function Nn(a,b,c=Da.CENTER,d=0,e=0){const f=c%3;switch(f){case 0:Bd(a,lc(b));break;case 1:Dd(a,nc(b));break;default:Cd(a,mc(b));break}const g=Math.floor(c/3);switch(g){case 0:Ed(a,oc(b));break;case 1:Gd(a,qc(b));break;default:Fd(a,pc(b));break}a.x-=d,a.y-=e}class Vq{constructor(){this.x=0;this.y=0;this.width=0;this.height=0;this.originX=0;this.originY=0}setTo(a=0,b=0,c=0,d=0){return this.x=a,this.y=b,this.width=c,this.height=d,this}alignIn(a,b=Da.CENTER,c=0,d=0){return Nn(a,this,b,c,d),this}}const Qc=new Vq();function fn(a){if(a.backgroundChildren===void 0)return;const b=a.left,c=a.top,d=a.width,e=a.height,f=a.backgroundChildren;for(let g=0,i=f.length;g<i;g++){const h=f[g],k=h.rexSizer;if(k.hidden)continue;const n=k.padding,o=b+n.left,s=c+n.top,u=d-n.left-n.right,v=e-n.top-n.bottom;Pc(h,u,v),Qc.setTo(o,s,u,v).alignIn(h)}}function gn(a,b,c,d){}function hn(a,b){uc(a,b)}function jn(a){return a.hasOwnProperty("rexSizer")||(a.rexSizer={}),a.rexSizer}function kn(a,b,{padding:c=0,childKey:d}={}){a.backgroundChildren===void 0&&(a.backgroundChildren=[]),a.pin(b),a.backgroundChildren.push(b);const e=a.getSizerState(b);e.padding=Ob(c),d!==void 0&&a.addChildrenMap(d,b)}function ln(a,b){return a.backgroundChildren===void 0?!1:a.backgroundChildren.indexOf(b)!==-1}function mn(a,b,c){a.childrenMap===void 0&&(a.childrenMap={}),a.childrenMap[b]=c}function pn(a,b,c=!1){if(c){const d=[a];for(;d.length;){a=d.shift();for(let e=0,f=a.children.length;e<f;e++){const g=a.children[e];if(g.name===b)return g;d.push(g)}}}else for(let d=0,e=a.children.length;d<e;d++){const f=a.children[d];if(f.name===b)return f}return null}function ri(a,b,c){typeof b==="string"&&(b=b.split("."));if(b.length===0)return null;let d=b.shift(),e=null;if(d.charAt(0)==="#")d=d.substring(1),e=pn(a,d,c);else if(d.indexOf("[")===-1)a.childrenMap&&(e=a.childrenMap[d]);else{const f=d.match(Uq);if(f!=null){if(a.childrenMap){let g=a.childrenMap[f[1]];g&&(e=g[f[2]])}}}return b.length===0?e:e&&e.childrenMap?ri(e,b,c):null}const Uq=/(\S+)\[(\d+)\]/i;function Hd(a){let b=a.parent;for(;b;){if(b instanceof na)return b;b=b.parent}return null}function nn(a,b){return Hd(b)===a}function on(a){let b,c=Hd(a);for(;c;)b=c,c=Hd(c);return b}class na extends Vb{constructor({x:a=0,y:b=0,width:c=0,height:d=0,space:e=0,name:f=""}={}){super(a,b);this.type="rexBaseSizer";this.rexSizer={};this.needLayout=!0;this.setMinSize(c,d),this.space=Ob(e),this.name=f}destroy(a){this.sizerChildren=null,this.backgroundChildren=null,super.destroy(a)}get left(){return lc(this)}set left(a){Bd(this,a)}alignLeft(a){return this.left=a,this}get right(){return mc(this)}set right(a){Cd(this,a)}alignRight(a){return this.right=a,this}get innerLeft(){return this.left+this.space.left}get innerRight(){return this.right-this.space.right}get centerX(){return nc(this)}set centerX(a){Dd(this,a)}alignCenterX(a){return this.centerX=a,this}get top(){return oc(this)}set top(a){Ed(this,a)}alignTop(a){return this.top=a,this}get bottom(){return pc(this)}set bottom(a){Fd(this,a)}alignBottom(a){return this.bottom=a,this}get innerTop(){return this.top+this.space.top}get innerBottom(){return this.bottom-this.space.bottom}get centerY(){return qc(this)}set centerY(a){Gd(this,a)}alignCenterY(a){return this.centerY=a,this}get innerWidth(){return this.width-this.space.left-this.space.right}get innerHeight(){return this.height-this.space.top-this.space.bottom}setMinSize(a,b){return this.setMinWidth(a).setMinHeight(b),this}setMinWidth(a=0){return this.minWidth=a,this}setMinHeight(a=0){return this.minHeight=a,this}getChildrenWidth(){return 0}getChildrenHeight(){return 0}getChildrenSizers(a=[]){return dn(this,a)}get childrenWidth(){return this._childrenWidth===void 0&&(this._childrenWidth=this.getChildrenWidth()),this._childrenWidth}get childrenHeight(){return this._childrenHeight===void 0&&(this._childrenHeight=this.getChildrenHeight()),this._childrenHeight}resize(a=this.width,b=this.height){return this.setSize(a,b),this}getSizerState(a){return jn(a)}layout(){const a=this.x,b=this.y;return this.setPosition(0,0)._layout().setPosition(a,b),this}_layout(a,b,c){return en(this,a,b,c),this}preLayout(a,b,c){return qi(this,a,b,c),this}layoutInit(){return qf(this),this}layoutBackgrounds(){return fn(this),this}postLayout(a,b,c){return gn(this,a,b,c),this}pin(a){return hn(this,a),this}addBackground(a,b){return kn(this,a,b),this}isBackground(a){return ln(this,a)}addChildrenMap(a,b){return mn(this,a,b),this}getElement(a,b=!1){return ri(this,a,b)}isChild(a){return nn(this,a)}getTopmostParentSizer(a=this){return on(a)}}function Sc(a,b,c=0,d=a.length-1){for(let e=c;e<=d;e++)a[e]=b;return a}function qn(a,{column:b=0,row:c=0,columnProportions:d=0,rowProportions:e=0,space:f}={}){a.columnCount=b,a.rowCount=c,a.sizerChildren.length=b*c,Sc(a.sizerChildren,null),a.columnProportions.length=b;if(typeof d==="number")Sc(a.columnProportions,d);else for(let h=0;h<b;h++)a.columnProportions[h]=d[h]??0;a.rowProportions.length=c;if(typeof e==="number")Sc(a.rowProportions,e);else for(let h=0;h<c;h++)a.rowProportions[h]=e[h]??0;a.columnWidth.length=b,a.rowHeight.length=c,a.space.column=[],a.space.column.length=b-1;const g=f.column??0;if(typeof g==="number")Sc(a.space.column,g);else for(let h=0,k=a.space.column.length;h<k;h++)a.space.column[h]=g[h]??0;a.space.row=[],a.space.row.length=c-1;const i=f.row??0;if(typeof i==="number")Sc(a.space.row,i);else for(let h=0,k=a.space.row.length;h<k;h++)a.space.row[h]=i[h]??0}function sf(...a){return Array.prototype.reduce.call(a,Gr,0)}function Gr(a,b){return a+b}function rn(a){if(a.rexSizer.hidden)return 0;let b=0;const c=a.sizerChildren;for(let d=0;d<a.columnCount;d++){const e=a.columnProportions[d];let f=0;if(e===0){for(let g=0;g<a.rowCount;g++){const i=c[g*a.columnCount+d];if(!i)continue;if(i.rexSizer.hidden)continue;let h=i instanceof na?Math.max(i.minWidth,i.childrenWidth):i.width;const k=i.rexSizer.padding;h+=k.left+k.right,f=Math.max(f,h)}b+=f}a.columnWidth[d]=f}return b+sf(a.space.left,...a.space.column,a.space.right)}function sn(a){if(a.rexSizer.hidden)return 0;let b=0;const c=a.sizerChildren;for(let e=0;e<a.rowCount;e++){const f=a.rowProportions[e];let g=0;if(f===0){for(var d=0;d<a.columnCount;d++){const i=c[e*a.columnCount+d];if(!i)continue;if(i.rexSizer.hidden)continue;let h=i instanceof na?Math.max(i.minHeight,i.childrenHeight):i.height;const k=i.rexSizer.padding;h+=k.top+k.bottom,g=Math.max(g,h)}b+=g}a.rowHeight[e]=g}return b+sf(a.space.top,...a.space.row,a.space.bottom)}function An(a,b){let c;const d=a.rexSizer;if(d.expand){const e=d.padding;c=b-e.left-e.right}return c}function zn(a,b){let c;const d=a.rexSizer;if(d.expand){const e=d.padding;c=b-e.top-e.bottom}return c}function Rc(a,b,c){return a.sizerChildren[c*a.columnCount+b]}function tn(a,b,c,d){if(a.rexSizer.hidden||!a.needLayout)return;a.preLayout(b);const e=a.totalColumnProportions,f=a.totalRowProportions;if(c===void 0)if(b&&e>0){const y=a.rexSizer.padding;c=b.width-y.left-y.right}else c=Math.max(a.childrenWidth,a.minWidth);if(d===void 0)if(b&&f>0){const y=a.rexSizer.padding;d=b.height-y.top-y.bottom}else d=Math.max(a.childrenHeight,a.minHeight);a.resize(c,d);let g;e>0?g=(a.width-a.childrenWidth)/e:g=0;let i;f>0?i=(a.height-a.childrenHeight)/f:i=0;const h=a.innerLeft,k=a.innerTop,n=a.space.column,o=a.space.row;let s=h,u=k;for(let y=0;y<a.rowCount;y++){const G=a.rowProportions[y],K=G===0?a.rowHeight[y]:G*i;s=h;for(var v=0;v<a.columnCount;v++){const J=a.columnProportions[v],N=J===0?a.columnWidth[v]:J*g,I=Rc(a,v,y);if(!I||I.rexSizer.hidden){s+=N+n[v];continue}const O=An(I,N),P=zn(I,K);I instanceof na?I._layout(a,O,P):Pc(I,O,P);const L=I.rexSizer,r=L.padding,t=s+r.left,j=N-r.left-r.right,m=u+r.top,l=K-r.top-r.bottom;Qc.setTo(t,m,j,l).alignIn(I,L.align),s+=N+n[v]}u+=K+o[y]}return a.layoutBackgrounds(),a.postLayout()}function yn(a,b,c,d,e){if(typeof a==="number"&&typeof b==="number"){let f=b*d+a;if(!c[f])return f}else if(b===void 0&&typeof a==="number")for(let f=0;f<e;f++){let g=f*d+a;if(!c[g])return g}else if(a===void 0&&typeof b==="number")for(let f=0;f<d;f++){let g=b*d+f;if(!c[g])return g}else if(b===!0)for(let f=0;f<d;f++)for(let g=0;g<e;g++){let i=g*d+f;if(!c[i])return i}else for(let f=0,g=c.length;f<g;f++)if(!c[f])return f;return null}function un(a,b,{column:c,row:d,align:e=Da.CENTER,padding:f=0,expand:g=!0,childKey:i}={}){const h=yn(c,d,a.sizerChildren,a.columnCount,a.rowCount);if(h===null)return;a.pin(b),typeof e==="string"&&(e=Da[e]);const k=a.getSizerState(b);k.align=e,k.padding=Ob(f),k.expand=g,a.sizerChildren[h]=b,i!==void 0&&a.addChildrenMap(i,b)}function vn(a,b,c){if(!b)return null;const d=a.sizerChildren.indexOf(b);return d===-1?null:(c===void 0&&(c={x:0,y:0}),c.x=d%a.columnCount,c.y=Math.floor(d/a.columnCount),c)}function wn(a,b,c){for(let d=0,e=a.rowCount;d<e;d++)for(let f=0,g=a.columnCount;f<g;f++){if(Rc(a,f,d))continue;let i;c?i=b.call(c,f,d,a):i=b(f,d,a);if(i)return}}function xn(a){const b=a.sizerChildren;let c=0;for(let d=0,e=b.length;d<e;d++)b[d]||c++;return c}class rf extends na{constructor(a={}){super(a);this.type="rexGridSizer";this.sizerChildren=[];this.columnProportions=[];this.rowProportions=[];this.columnWidth=[];this.rowHeight=[];qn(this,a)}setColumnProportion(a,b){return a<this.columnProportions.length&&(this.columnProportions[a]=b),this}setRowProportion(a,b){return a<this.rowProportions.length&&(this.rowProportions[a]=b),this}get totalColumnProportions(){return this.columnProportions.reduce((a,b)=>a+b)}get totalRowProportions(){return this.rowProportions.reduce((a,b)=>a+b)}getChildrenWidth(){return rn(this)}getChildrenHeight(){return sn(this)}_layout(a,b,c){return tn(this,a,b,c),this}add(a,b){return un(this,a,b),this}getChildAt(a,b){return Rc(this,a,b)}childToGridIndex(a,b){return vn(this,a,b)}forEachEmptyGrid(a,b){return wn(this,a,b),this}get gridCount(){return this.sizerChildren.length}get emptyGridCount(){return xn(this)}}var Fa;(function(a){a[a.x=0]="x",a[a.h=0]="h",a[a.horizontal=0]="horizontal",a[a["left-to-right"]=0]="left-to-right",a[a.y=1]="y",a[a.v=1]="v",a[a.vertical=1]="vertical",a[a["top-to-bottom"]=1]="top-to-bottom"})(Fa||(Fa={}));function Bn(a){const b=a.sizerChildren;let c=0;for(let d=0,e=b.length;d<e;d++){const f=b[d];if(f.rexSizer.hidden)continue;const g=f.rexSizer,i=g.proportion;i>0&&(c+=i)}return c}function Cn(a,b=!0){if(a.rexSizer.hidden)return 0;b===void 0&&(b=!0);const c=a.sizerChildren;let d=0;if(a.orientation===0)for(var e=0,f=c.length;e<f;e++){const g=c[e],i=g.rexSizer;if(i.hidden)continue;let h;i.proportion===0||b&&!g.isRexSpace&&i.proportion>0?h=g instanceof na?Math.max(g.minWidth,g.childrenWidth):g.width:h=0;const k=i.padding;h+=k.left+k.right,e>0&&(h+=a.space.item),d+=h}else for(var e=0,f=c.length;e<f;e++){const g=c[e];if(!g.hasOwnProperty("rexSizer"))continue;const i=g.rexSizer;if(i.hidden)continue;let h=g instanceof na?Math.max(g.minWidth,g.childrenWidth):g.width;const k=i.padding;h+=k.left+k.right,d=Math.max(h,d)}return d+a.space.left+a.space.right}function Dn(a,b=!0){if(a.rexSizer.hidden)return 0;const c=a.sizerChildren;let d=0;if(a.orientation===0)for(var e=0,f=c.length;e<f;e++){const g=c[e],i=g.rexSizer;if(i.hidden)continue;let h=g instanceof na?Math.max(g.minHeight,g.childrenHeight):g.height;const k=i.padding;h+=k.top+k.bottom,d=Math.max(h,d)}else for(var e=0,f=c.length;e<f;e++){const g=c[e];if(!g.hasOwnProperty("rexSizer"))continue;const i=g.rexSizer;if(i.hidden)continue;let h;i.proportion===0||b&&!g.isRexSpace&&i.proportion>0?h=g instanceof na?Math.max(g.minHeight,g.childrenHeight):g.height:h=0;const k=i.padding;h+=k.top+k.bottom,e>0&&(h+=a.space.item),d+=h}return d+a.space.top+a.space.bottom}function Mn(a,b){let c;const d=b.rexSizer,e=d.padding;return a.orientation===Fa.x?d.proportion>0&&a.proportionLength>0&&(c=d.proportion*a.proportionLength):d.expand&&(c=a.innerWidth-e.left-e.right),c}function Ln(a,b){let c;const d=b.rexSizer,e=d.padding;return a.orientation===Fa.x?d.expand&&(c=a.innerHeight-e.top-e.bottom):d.proportion>0&&a.proportionLength>0&&(c=d.proportion*a.proportionLength),c}function En(a,b,c,d){if(a.rexSizer.hidden||!a.needLayout)return;a.preLayout(b),c===void 0&&(c=Math.max(a.childrenWidth,a.minWidth)),d===void 0&&(d=Math.max(a.childrenHeight,a.minHeight)),a.resize(c,d);let e;if(a.childrenProportion>0){let s=a.orientation===Fa.x?a.width-a.childrenWidth:a.height-a.childrenHeight;s>0?(s=a.orientation===Fa.x?a.width-a.getChildrenWidth(!1):a.height-a.getChildrenHeight(!1),e=s/a.childrenProportion):e=0}else e=0;a.proportionLength=e;const f=a.sizerChildren,g=a.innerLeft,i=a.innerTop,h=a.innerWidth,k=a.innerHeight;let n=g,o=i;for(let s=0,u=f.length;s<u;s++){const v=f[s];if(v.rexSizer.hidden)continue;const y=v.rexSizer,G=y.padding;let K=Mn(a,v),J=Ln(a,v);v instanceof na?v._layout(a,K,J):Pc(v,K,J),K===void 0&&(K=v.width),J===void 0&&(J=v.height);let N,I,O,P;a.orientation===Fa.x?(N=n+G.left,y.proportion===0||e===0?O=K:O=y.proportion*e,I=o+G.top,P=k-G.top-G.bottom):(N=n+G.left,O=h-G.left-G.right,I=o+G.top,y.proportion===0||e===0?P=J:P=y.proportion*e),Qc.setTo(N,I,O,P).alignIn(v,y.align),a.orientation===Fa.x?n+=O+G.left+G.right+a.space.item:o+=P+G.top+G.bottom+a.space.item}a.layoutBackgrounds(),a.postLayout()}function Fn(a){qf(a),a._childrenProportion=void 0}function uf(a,b,{proportion:c=0,align:d=Da.CENTER,padding:e=0,expand:f=!1,childKey:g,index:i}={}){a.pin(b),typeof d==="string"&&(d=Da[d]);const h=a.getSizerState(b);h.proportion=c,h.align=d,h.padding=Ob(e),h.expand=f,i===void 0||i>=a.sizerChildren.length?a.sizerChildren.push(b):a.sizerChildren.splice(i,0,b),g!==void 0&&a.addChildrenMap(g,b)}class Kn extends Vb{}function Gn(a,b=1){const c=new Kn();uf(a,c,{proportion:b})}function Hn(a,b,c=!0){if(!a.isChild(b))return;Tb(a,b);const d=a.sizerChildren;d.splice(d.indexOf(b),1),c&&b.destroy()}function In(a,b=!0){Ab(a,...a.sizerChildren);let c;b&&(c=[],c.push.apply(c,a.sizerChildren)),a.sizerChildren.length=0,b&&c.forEach(function(d){d.destroy()})}function Jn(a,b=!0){Ab(a,...a.sizerChildren),a.backgroundChildren&&Ab(a,...a.backgroundChildren);let c;b&&(c=[],c.push.apply(c,a.sizerChildren),a.backgroundChildren&&c.push.apply(c,a.backgroundChildren)),a.sizerChildren.length=0,a.backgroundChildren&&(a.backgroundChildren.length=0),b&&c.forEach(function(d){d.destroy()})}class Tc extends na{constructor({space:a={item:0},orientation:b=Fa.x}={}){super(arguments[0]);this.type="rexSizer";this.sizerChildren=[];this.setOrientation(b),this.setItemSpacing(a.item)}setOrientation(a){return typeof a==="string"&&(a=Fa[a]),this.orientation=a,this}setItemSpacing(a=0){return this.space.item=a,this}get childrenProportion(){return this._childrenProportion===void 0&&(this._childrenProportion=Bn(this)),this._childrenProportion}getChildrenWidth(a=!0){return Cn(this,a)}getChildrenHeight(a=!0){return Dn(this,a)}_layout(a,b,c){return En(this,a,b,c),this}layoutInit(){return Fn(this),this}add(a,b){return uf(this,a,b),this}addSpace(a=1){return Gn(this,a),this}remove(a,b=!0){return Hn(this,a,b),this}removeAll(a=!0){return In(this,a),this}clear(a=!0){return Jn(this,a),this}}class tf extends Tc{constructor({background:a,icon:b,text:c,expandTextWidth:d=!1,expandTextHeight:e=!1,action:f,align:g,space:i={}}={}){super(arguments[0]);this.type="rexLabel";a&&this.addBackground(a),(g==="right"||g==="bottom"||g==="center")&&this.addSpace();if(b){let h;const k=i.icon??0;this.orientation===Fa.x?(c||f)&&(h={right:k}):(c||f)&&(h={bottom:k}),this.add(b,{padding:h})}if(c){let h,k,n;const o=i.text??0;this.orientation===Fa.x?(h=d?1:0,f&&(k={right:o}),n=e):(h=e?1:0,f&&(k={bottom:o}),n=d),this.add(c,{proportion:h,align:Da.CENTER,padding:k,expand:n})}f&&this.add(f),g==="center"&&this.addSpace(),this.addChildrenMap("background",a),this.addChildrenMap("icon",b),this.addChildrenMap("text",c),this.addChildrenMap("action",f)}get text(){const a=this.childrenMap.text;if(a===void 0)return"";let b;return a.text?(b=a.text,typeof b!=="string"&&(b=b.join(`
`))):b="",b}set text(a){const b=this.childrenMap.text;b!==void 0&&(b.text=a)}setText(a){return typeof a!=="string"&&(a=a.join(`
`)),this.text=a,this}appendText(a){return typeof a!=="string"&&(a=a.join(`
`)),this.text+=a,this}}var Ga;(function(a){a[a.none=0]="none",a[a.word=1]="word",a[a.char=2]="char"})(Ga||(Ga={}));var ya;(function(a){a[a.none=0]="none",a[a.raw=1]="raw",a[a.wrapped=2]="wrapped"})(ya||(ya={}));const Fi=/(?:\r\n|\r|\n)/;function co(a,b,c,d,e,f=0){e<=0&&(d=0);let g=[];if(!a||!a.length)return g;let i=a.split(Fi),h=i.length-1;a.slice(-1)===`
`&&(i.length-=1);let k;for(let n=0,o=i.length;n<o;n++){let s=i[n],u=n===h?0:1;if(d===0){g.push(Nd(s,b(s,c),u));continue}n===0?k=e-f:k=e;if(s.length<=100){let J=b(s,c);if(J<=k){g.push(Nd(s,J,u));continue}}let v;d===1?v=s.split(" "):v=s;let y="",G="",K=0;for(let J=0,N=v.length;J<N;J++){let I=v[J];d===1?(y+=I,J<N-1&&(y+=" ")):y+=I;let O=b(y,c);O>k&&(J===0?g.push(Nd("",0,2)):(g.push(Nd(G,K,2)),y=I,d===1&&(J<N-1&&(y+=" ")),O=b(y,c)),k=e),G=y,K=O}g.push(Nd(G,K,u))}return g}let Nd=function(a,b,c){return{text:a,width:b,newLineMode:c}};var Id;(function(a){a[a.left=0]="left",a[a.center=1]="center",a[a.right=2]="right"})(Id||(Id={}));var Jd;(function(a){a[a.top=0]="top",a[a.center=1]="center",a[a.bottom=2]="bottom"})(Jd||(Jd={}));class rc{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(a){return this.items.push(a),this}pushMultiple(a){return this.items.push.apply(this.items,a),a.length=0,this}clear(){return this.items.length=0,this}}class Hi{constructor(){this.pens=[]}destroy(){this.pens.length=0}addPen(a){return this.pens.push(a),this}get firstPen(){return this.pens[0]}get lastPen(){return this.pens[this.pens.length-1]}hasPen(){return this.pens.length>0}get pensCount(){return this.pens.length}get startIndex(){let a=this.pens[0];return a?a.startIndex:0}get width(){let a=this.lastPen;return a?a.lastX:0}}function Mf(a){if(Array.isArray(a))a.length=0;else for(let b in a)delete a[b]}function sc(a,b=Array.isArray(a)?[]:{}){Mf(b);if(Array.isArray(a)){b.length=a.length;for(let c=0,d=a.length;c<d;c++)b[c]=a[c]}else for(let c in a)b[c]=a[c];return b}class Ii{constructor(){this.text="";this.x=0;this.y=0;this.width=0;this.height=0;this.ascent=0;this.descent=0;this.prop={};this.newLineMode=ya.none;this.startIndex=0}set(a="",b=0,c=0,d=0,e=0,f=0,g=0,i={},h=ya.none,k=0){return this.text=a,this.x=b,this.y=c,this.width=d,this.height=e,this.ascent=f,this.descent=g,this.prop=i,this.newLineMode=h,this.startIndex=k,this}clone(){let a=new Ii();return a.set(this.text,this.x,this.y,this.width,this.height,this.ascent,this.descent,sc(this.prop),this.newLineMode,this.startIndex),a}get plainText(){return this.newLineMode===ya.raw?`${this.text}
`:this.text}get wrapText(){return this.newLineMode!==ya.none?`${this.text}
`:this.text}get plainTextLength(){let a=this.text.length;return this.newLineMode===ya.raw&&(a+=1),a}get endIndex(){return this.startIndex+this.plainTextLength}get lastX(){return this.x+this.width}get isTextPen(){return this.text!==""}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}}class Kd{constructor({penPool:a}){this.pens=[];this.lines=[];this.pens=[],this.lines=[],this.penPool=a}destroy(){this.freePens()}freePens(){return this.penPool.pushMultiple(this.pens),this.lines.forEach(a=>{a.destroy()}),this.lines.length=0,this.maxLineWidth=0,this.totalLineHeight=0,this}addTextPen(a,b,c,d,e,f,g,i,h=ya.none){let k=this.penPool.pop();return k==null&&(k=new Ii()),k.set(a,b,c,d,e,f,g,i,h),this.addPen(k),this}addImagePen(a,b,c,d,e){return this.addTextPen("",a,b,c,d,d,0,e,ya.none),this}addNewLinePen(a){let b=this.lastPen;return b&&b.newLineMode===ya.none&&(b.newLineMode=a),this}addPen(a){let b=this.lastPen;b==null?a.startIndex=0:a.startIndex=b.endIndex,this.pens.push(a);let c=this.lastLine;return c==null&&(c=new Hi(),this.lines.push(c)),c.addPen(a),a.newLineMode!==ya.none&&(c=new Hi(),this.lines.push(c)),this}clone(a){a==null&&(a=new Kd({penPool:this.penPool})),a.freePens();const b=this.pens;for(let e=0,f=b.length;e<f;e++)a.addPen(b[e].clone());const c=this.lines,d=a.lines;for(let e=0,f=c.length;e<f;e++){const g=c[e],i=d[e];i.y=g.y,i.height=g.height}return a}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(a){if(a>=this.lines.length)return this.getLineEndIndex(a);{let b=this.lines[a];if(!b)return 0;let c=b.firstPen;return c?c.startIndex:0}}getLineEndIndex(a){let b=this.lines.length;a>=b&&(a=b-1);for(let c=a;c>=0;c--){let d=this.lines[c];if(d&&d.hasPen())return d.lastPen.endIndex}return 0}getLineWidth(a){let b=this.lines[a];return b?b.width:0}getLineHeights(a=[]){return this.lines.forEach(function(b){a.push(b.height)}),a}get lineCount(){return this.lines.length}get plainText(){let a=[],b=this.pens;for(let c=0,d=b.length;c<d;c++)a.push(b[c].plainText);return a.join()}get plainTextLength(){let a=0;for(let b=0,c=this.pens.length;b<c;b++)a+=this.pens[b].plainTextLength;return a}getSliceTagText(a,b,c=0,d,e=!1){if(d===void 0){let k=this.lastPen;if(!k)return"";d=k.endIndex}let f=[],g;for(var i=0,h=this.pens.length;i<h;i++){let k=this.pens[i],n=k.endIndex;if(n<=c)continue;let o=e?k.wrapText:k.plainText,s=k.prop,u=k.startIndex,v=u>=c&&n<=d;v||(o=o.substring(c-u,d-u)),b?f.push(a.call(b,o,s,g)):f.push(a(o,s,g)),g=s;if(n>=d)break}return f.join()}}function $n(a,b,c){let d=sc(a,c);for(let e in b)d.hasOwnProperty(e)&&(d[e]=b[e]);return d}function Af(a,b,c={key:b}){c=$n(br,c);let d=Ha.get(),e=d.get(c.key);if(!e)return;let f=e.getFrame(c.frame);if(!f)return;let g=c.width,i=c.height;(g===void 0||i===void 0)&&(g===void 0&&i===void 0?(c.width=f.width,c.height=f.height):g===void 0?c.width=f.width*(i/f.height):i===void 0&&(c.height=f.height*(g/f.width))),a.images.set(b,c)}const br={key:void 0,frame:void 0,width:void 0,height:void 0,y:0,left:0,right:0,top:0,bottom:0};class Xn{constructor(){this.images=new Map()}destroy(){this.images.clear()}add(a,b){if(typeof a==="string")Af(this,a,b);else if(Array.isArray(a)){let c=a;for(let d=0,e=c.length;d<e;d++)Af(this,c[d])}else{let c=a;for(a in c)Af(this,a,c[a])}return this}remove(a){return this.images.delete(a),this}get(a){return this.images.get(a)}getOuterWidth(a){let b=this.images.get(a);return b?b.width+b.left+b.right:0}getOuterHeight(a){let b=this.images.get(a);return b?b.height+b.top+b.bottom:0}getFrame(a){let b=this.images.get(a);if(!b)return;let c=Ha.get(),d=c.get(b.key);if(!d)return;let e=d.getFrame(b.frame);return e}hasTexture(a){return!!this.getFrame(a)}}function yf(a,b){a.font=b.font}function zf(a,b){a.textBaseline="alphabetic",a.textAlign="start",a.fillStyle=b.fillStyle,a.strokeStyle=b.strokeStyle,a.lineWidth=b.strokeThickness,a.lineCap="round",a.lineJoin="round",a.imageSmoothingEnabled=b.antialias}function Gi(a,b,c){c?(a.shadowColor=b.shadowColor,a.shadowBlur=b.shadowBlur,a.shadowOffsetX=b.shadowOffsetX,a.shadowOffsetY=b.shadowOffsetY):(a.shadowColor="#000",a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0)}function ao(a,b){return b.measureText(a).width}function bo(a,b,c=0){let d=b.measureText(a),e=d.actualBoundingBoxAscent,f=d.actualBoundingBoxDescent;return(!e&&!f||a==="")&&(e=c,f=0),Ef.ascent=e,Ef.descent=f,Ef.height=Math.ceil(Math.abs(e)+Math.abs(f)),Ef}let Ef={ascent:0,descent:0,height:0};function Yn(a,b,c,d,e){a.freePens();if(b==="")return a;let f=c.canvas,g=c.context,i=c.parent,h=c.parser.splitText(b),k,n,o=0;for(var s=0,u=h.length;s<u;s++){let J=c.parser.tagTextToProp(h[s],k),N=J.text;k=J.prop;if(k.img){let I,O;c.imageManager?(I=c.imageManager.getOuterWidth(k.img),O=c.imageManager.getOuterHeight(k.img)):(I=0,O=0),e>0&&d!==Ga.none&&(e<o+I&&(a.addNewLinePen(ya.wrapped),o=0)),a.addImagePen(o,0,I,O,sc(k)),o+=I}else if(N!==""){g.save();let I=c.parser.propToStyle(i,k);yf(g,I),zf(g,I);let O=I.strokeThickness,P=O/2;n=co(N,ao,g,d,e,o);let L=bo("|MÃq",g);for(let r=0,t=n.length;r<t;r++){const j=n[r],m=L.height+O,l=L.ascent+P,q=L.descent+P;a.addTextPen(j.text,o,0,j.width,m,l,q,sc(k),j.newLineMode),j.newLineMode!==ya.none?o=0:o+=j.width}g.restore()}}let v=a.lines,y=c.parent.lineSpacing,G=0,K=0;for(let J=0,N=v.length;J<N;J++){const I=v[J],O=I.pens,P=O.length;let L=0,r=0;for(let m=0;m<P;m++){const l=O[m];L=Math.max(L,l.ascent),r=Math.max(r,l.descent)}const t=L+r,j=K+L;for(let m=0;m<P;m++)O[m].y+=j;I.y=j,I.height=t,G=Math.max(G,I.width),K+=t+y}return a.maxLineWidth=G,a.totalLineHeight=K-y,a}const Oj={PI2:Math.PI*2,HALF_PI:Math.PI*.5,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};class ar extends La{constructor(a,b,c,d,e){super(a,b,c,d);this.name=e}}class _n{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return this.hitAreas.length=0,this}add(a,b,c,d,e){let f=new ar(b,c,d,e,a);return this.hitAreas.push(f),this}getFirstHitArea(a,b){for(let c=0,d=this.hitAreas.length;c<d;c++){let e=this.hitAreas[c];if(e.contains(a,b))return e}return null}}function Zn(a,b,c,d,e,f=0,g=0,i=a.penManager){a.hitAreaManager&&a.hitAreaManager.clear();let h=i.totalLineHeight;if(h===0)return;const k=d<a.textWidth||e<a.textHeight;let n=a.context;n.save();let o=a.parent;Xq(a,o),Yq(a,o),k&&(n.beginPath(),n.rect(b,c,d,e),n.clip());let s=o.align%3,u=Math.floor(o.align/3),v=c-g;switch(u){case Jd.center:v+=(e-h)/2;break;case Jd.bottom:v+=e-h-2;break}let y=i.lines,G=v;const K=b+e;for(let J=0,N=y.length;J<N;J++){let I=y[J];if(G>K)break;const O=G+I.height;if(O<c){G=O;continue}let P=I.width;if(P===0){G=O;continue}let L=b-f;switch(s){case Id.center:L+=(d-P)/2;break;case Id.right:L+=d-P;break}let r=I.pens;for(let t=0,j=r.length;t<j;t++)Wq(a,r[t],L,v);G=O}n.restore()}function Wq(a,b,c,d){c+=b.x,d+=b.y;let e=a.canvas,f=a.context,g=a.parent;f.save();let i=a.parser.propToStyle(g,b.prop);yf(f,i),zf(f,i),i.underlineThickness>0&&b.width>0&&Zq(a,c,d,b.width,i),b.isTextPen&&_q(a,c,d,b.text,i),b.isImagePen&&$q(a,c,d,b.prop.img,i),f.restore(),b.hasAreaMarker&&b.width>0&&(a.hitAreaManager||(a.hitAreaManager=new _n()),a.hitAreaManager.add(b.prop.area,c,d,b.width,b.height))}function Xq(a,b){let c=a.canvas,d=a.context;d.clearRect(0,0,c.width,c.height)}function Yq(a,b){let c=a.canvas,d=a.context;d.clearRect(0,0,c.width,c.height);const e=b.backgroundFillStyle,f=b.backgroundStrokeStyle;if(e||f){const g=b.backgroundStrokeThickness,i=g/2,h=b.cornerRadius,k=i,n=i,o=c.width-g,s=c.height-g;Ad(c,d,k,n,o,s,h,e,f,g,b.backgroundFillColor2,b.backgroundIsHorizontalGradient)}else d.clearRect(0,0,c.width,c.height)}function Zq(a,b,c,d,e){c+=e.underlineOffsetY-e.underlineThickness/2;let f=a.context,g=f.lineCap;f.lineCap="butt",f.beginPath(),f.strokeStyle=e.underlineStyle,f.lineWidth=e.underlineThickness,f.moveTo(b,c),f.lineTo(b+d,c),f.stroke(),f.lineCap=g}function _q(a,b,c,d,e){let f=a.context;e.strokeStyle&&e.strokeStyle!=="none"&&e.strokeThickness>0&&(Gi(f,e,e.shadowStroke),f.strokeText(d,b,c)),e.fillStyle&&e.fillStyle!=="none"&&(Gi(f,e,e.shadowFill),f.fillText(d,b,c))}function $q(a,b,c,d,e){let f=a.imageManager;if(!f)return;let g=f.get(d),i=f.getFrame(d);b+=g.left,c+=g.y-g.height;let h=a.context;h.drawImage(i.texture.image,i.x,i.y,i.width,i.height,b,c,g.width,g.height)}class On{constructor({canvas:a,context:b,parent:c,parser:d,penPool:e=new rc()}){this.textScrollX=0;this.textScrollY=0;this.canvas=a,this.context=b,this.parser=d,this.parent=c,this.penPool=e,this.penManager=new Kd({penPool:e})}destroy(){this.parser.destroy(),this.canvas=null,this.context=null,this.parser=null,this.parent=null,this.penManager&&(this.penManager.destroy(),this.penManager=null),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=null),this.imageManager&&(this.imageManager.destroy(),this.imageManager=null),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=null)}get textWidth(){return this.penManager.maxLineWidth}get textHeight(){return this.penManager.totalLineHeight}updatePenManager(a,b,c,d=this.penManager){return Yn(d,a,this,b,c)}draw(a,b,c,d,e=0,f=0){return Zn(this,a,b,c,d,e,f,this.penManager),this}get lines(){return this.penManager.lines}get tmpPenManager(){return this._tmpPenManager===null&&(this._tmpPenManager=new Kd({penPool:this.penPool})),this._tmpPenManager}getPlainText(a,b,c){let d;return a==null?d=this.penManager.plainText:d=this.parser.splitText(a,!0).join(""),(b!=null||c!=null)&&(b==null&&(b=0),c==null&&(c=d.length),d=d.substring(b,c)),d}getPenManager(a,b){return a===void 0?this.clonePenManager(b,this.penManager):(b===void 0&&(b=new Kd({penPool:this.penPool})),this.updatePenManager(a,this.parent.wrapMode,this.parent.wrapWidth,b),b)}getText(a,b,c,d){if(a==null)return this.penManager.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d);let e=this.tmpPenManager;return this.updatePenManager(a,this.parent.wrapMode,this.parent.wrapWidth,e),e.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d)}clonePenManager(a,b=this.penManager){return b.clone(a)}getLastPen(a=this.penManager){return a.lastPen}addImageInfo(a,b){return this.imageManager===void 0&&(this.imageManager=new Xn()),this.imageManager.add(a,b),this}}function ti(a,b=!0,c=!0){let d=a.canvasText;b&&d.updatePenManager(a.text,a.wrapMode,a.wrapWidth);if(c){let e=a.padding,f,g,i,h;a.fixedWidth===0?(f=d.textWidth,i=f+e.left+e.right):(i=a.fixedWidth,f=i-e.left-e.right,f>d.textWidth&&(f=d.textWidth)),a.fixedHeight===0?(g=d.textHeight,h=g+e.top+e.bottom):(h=a.fixedHeight,g=h-e.top-e.bottom,g>d.textHeight&&(g=d.textHeight));let k=a.resolution,n=Math.ceil(i*k),o=Math.ceil(h*k),s=a.canvas;(s.width!==n||s.height!==o)&&(s.width=n,s.height=o,a.texture.setSize(i,h),a.setSize(i,h));let u=a.context;u.save(),u.scale(k,k),d.draw(e.left,e.top,f,g,0,a.textScrollY),u.restore(),a.texture.binding&&a.texture.binding.update(),a.setDirty(Z.TEXTURE)}}function vf(a,b=0,c=0){a.fixedWidth=b,a.fixedHeight=c,xf(a)}function ui(a,b,c,d,e){const f=a.padding;if(typeof b==="number")f.left=b,f.right=c===void 0?b:c,f.top=d===void 0?b:d,f.bottom=e===void 0?b:e;else{let g=b;f.left=g.left??0,f.right=g.right??0,f.top=g.top??0,f.bottom=g.bottom??0}xf(a)}function xf(a){const b=a.fixedWidth;if(a.wrapMode!==Ga.none){const c=a.padding,d=b-c.left-c.right;a.wrapWidth=Math.max(d,0)}else a.wrapWidth=0}function Pn(a,b,c=!1){c?a.textScrollYPercentage=b:a.textScrollY=b}function vi(a,b){typeof b==="string"&&(b=Da[b]),a.align=b}function wi(a,b=0){a.lineSpacing=b}function xi(a,b,c,d=0,e=0,f,g=!0){c||(d=0),a.backgroundFillStyle=b,a.backgroundFillColor2=f,a.backgroundIsHorizontalGradient=g,a.backgroundStrokeStyle=c,a.backgroundStrokeThickness=d,a.cornerRadius=e}function Qn(a,b,c){b&&yi(a,b),c&&zi(a,c)}function yi(a,b){a.fontFamily=b}function zi(a,b){typeof b==="number"&&(b=`${b}px`),a.fontSize=b}function Ai(a,b){a.fillStyle=b}function Bi(a,b,c=2){a.strokeStyle=b,a.strokeThickness=c}function Ci(a,b="#000",c=5,d=0,e=0,f=!1,g=!1){a.shadowColor=b,a.shadowBlur=c,a.shadowOffsetX=d,a.shadowOffsetY=e,a.shadowFill=f,a.shadowStroke=g}function Di(a,b,c){typeof b==="string"&&(b=Ga[b]),a.wrapMode=b,c===void 0?xf(a):a.wrapWidth=c}function Ei(a,b,c=2,d=0){a.underlineStyle=b,a.underlineThickness=c,a.underlineOffsetY=d}function si(a,b,c){a.canvasText.addImageInfo(b,c)}function Rn(a,b,c,d){return b=a.canvasText.getText(b,c,d,!0),b.split(Fi)}function Sn(a,b,c,d){return a.canvasText.getPlainText(b,c,d)}function Tn(a,b,c,d){return a.canvasText.getText(b,c,d,!1)}function Un(a,b,c,d){return a.canvasText.getText(b,c,d,!1)}function Vn(a,b){return a.canvasText.clonePenManager(b)}function Wn(a,b,c){return a.canvasText.getPenManager(b,c)}class wf extends cb{constructor(a,b,c="",{width:d=0,height:e=0,padding:f,wrapMode:g=Ga.none,backgroundFillStyle:i,backgroundFillColor2:h,backgroundIsHorizontalGradient:k,backgroundStrokeStyle:n,backgroundStrokeThickness:o,cornerRadius:s=0,align:u=Da.TOP_LEFT,lineSpacing:v=0,fontFamily:y="monospace",fontSize:G="16px",fillStyle:K="#fff",strokeStyle:J,strokeThickness:N=1,shadowColor:I="#000",shadowBlur:O=4,shadowOffsetX:P=0,shadowOffsetY:L=0,shadowFill:r=!1,shadowStroke:t=!1,underlineStyle:j="#fff",underlineThickness:m=1,underlineOffsetY:l=0,images:q}={},w){super(a,b,Bb());this.antialias=!1;this.fontFamily="monospace";this.fontSize="16px";this.fillStyle="#fff";this.strokeThickness=1;this.shadowStroke=!1;this.shadowFill=!1;this.shadowColor="#000";this.shadowBlur=4;this.shadowOffsetX=0;this.shadowOffsetY=0;this.underlineStyle="#fff";this.underlineThickness=1;this.underlineOffsetY=0;this.align=Da.TOP_LEFT;this.lineSpacing=0;this.wrapMode=Ga.none;this.wrapWidth=0;this.fixedWidth=0;this.fixedHeight=0;this.padding={left:0,right:0,top:0,bottom:0};this._textScrollY=0;this.type="rexText";const p=ua.get();this.resolution=p.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.canvasText=new On({canvas:this.canvas,context:this.context,parent:this,parser:w}),vf(this,d,e),f&&ui(this,f),Di(this,g),vi(this,u),wi(this,v),xi(this,i,n,o,s,h,k),yi(this,y),zi(this,G),Ai(this,K),J&&Bi(this,J,N),Ci(this,I,O,P,L,r,t),Ei(this,j,m,l),q&&si(this,q),this.setText(c)}destroy(a){this.canvasText.destroy(),this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}updateText(a=!0,b=!0){return ti(this,a,b),this}get text(){return this._text}set text(a){this.setText(a)}setText(a="",b=!0){return Array.isArray(a)&&(a=a.join(`
`)),a!==this._text&&(this._text=a.toString(),b&&this.updateText()),this}setBackgroundStyle(a,b,c=2,d=0,e,f=!0){return xi(this,a,b,c,d,e,f),this}setFixedSize(a,b){return vf(this,a,b),this}setPadding(a,b,c,d){return ui(this,a,b,c,d),this}setTextScrollY(a,b=!1){return Pn(this,a,b),this}setAlign(a){return vi(this,a),this}setLineSpacing(a=0){return wi(this,a),this}setFont(a,b){return Qn(this,a,b),this}setFillStyle(a){return Ai(this,a),this}setStrokeStyle(a,b=2){return Bi(this,a,b),this}setShadow(a="#000",b=5,c=0,d=0,e=!1,f=!1){return Ci(this,a,b,c,d,e,f),this}resize(a,b){return vf(this,a,b),ti(this),this}setWrapMode(a,b=0){return Di(this,a,b),this}setUnderline(a,b=2,c=0){return Ei(this,a,b,c),this}addImageInfo(a,b){return si(this,a,b),this}getWrappedText(a,b,c){return Rn(this,a,b,c)}getPlainText(a,b,c){return Sn(this,a,b,c)}getText(a,b,c){return Tn(this,a,b,c)}getSubString(a,b,c){return Un(this,a,b,c)}clonePenManager(a){return Vn(this,a)}getPenManager(a,b){return Wn(this,a,b)}get textScrollY(){return this._textScrollY}set textScrollY(a){this._textScrollY=a}get textScrollYPercentage(){return this._textScrollY/(this.totalTextHeight-this.displayTextHeight)}set textScrollYPercentage(a){const b=this.displayTextHeight,c=this.totalTextHeight;c<=b?this._textScrollY=0:this._textScrollY=(c-b)*a}get totalTextHeight(){return this.canvasText.textHeight}get displayTextHeight(){const a=this.padding;return this.height-a.top-a.bottom}}class Bf{destroy(){}}const Cf={text:null,prop:null},Df={font:void 0,fontFamily:void 0,fontStyle:void 0,fontSize:void 0,fillStyle:void 0,strokeStyle:void 0,strokeThickness:void 0,shadowColor:void 0,shadowOffsetX:void 0,shadowOffsetY:void 0,shadowBlur:void 0,shadowStroke:void 0,shadowFill:void 0,underlineStyle:void 0,underlineThickness:void 0,underlineOffsetY:void 0,image:void 0};class eo extends Bf{splitText(a,b=!1){const c=[];let d=0;for(;;){const f=Ji.exec(a);if(!f)break;const g=f[0],i=Ji.lastIndex-g.length;d<i&&c.push(a.substring(d,i)),b||c.push(g),d=Ji.lastIndex}const e=a.length;return d<e&&c.push(a.substring(d,e)),c}tagTextToProp(a,b){let c,d;b==null&&(b={}),b.img&&wa(b,kb,"img"),er.test(a)?(wa(b,Xa,"b",!0),c=""):fr.test(a)?(wa(b,kb,"b"),c=""):gr.test(a)?(wa(b,Xa,"i",!0),c=""):hr.test(a)?(wa(b,kb,"i"),c=""):fo.test(a)?(d=a.match(fo),wa(b,Xa,"size",d[1]+"px"),c=""):ir.test(a)?(wa(b,kb,"size"),c=""):go.test(a)?(d=a.match(go),wa(b,Xa,"color",d[1]),c=""):jr.test(a)?(wa(b,kb,"color"),c=""):ho.test(a)?(d=a.match(ho),wa(b,Xa,"u",!0),c=""):io.test(a)?(d=a.match(io),wa(b,Xa,"u",d[1]),c=""):kr.test(a)?(wa(b,kb,"u"),c=""):lr.test(a)?(wa(b,Xa,"shadow",!0),c=""):jo.test(a)?(d=a.match(jo),wa(b,Xa,"shadow",d[1]),c=""):mr.test(a)?(wa(b,kb,"shadow"),c=""):nr.test(a)?(wa(b,Xa,"stroke",!0),c=""):ko.test(a)?(d=a.match(ko),wa(b,Xa,"stroke",d[1]),c=""):or.test(a)?(wa(b,kb,"stroke"),c=""):lo.test(a)?(d=a.match(lo),wa(b,Xa,"img",d[1]),c=""):pr.test(a)?(wa(b,kb,"img"),c=""):mo.test(a)?(d=a.match(mo),wa(b,Xa,"area",d[1]),c=""):qr.test(a)?(wa(b,kb,"area"),c=""):c=a;const e=Cf;return e.text=c,e.prop=b,e}propToStyle(a,b){const c=Df;return b.hasOwnProperty("img")?c.image=b.img:(c.image=null,c.fontFamily=a.fontFamily,c.fontSize=b.size??a.fontSize,c.fontStyle=cr(b.b,b.i),c.font=`${c.fontStyle} ${c.fontSize} ${c.fontFamily}`,c.fillStyle=b.color??a.fillStyle,b.hasOwnProperty("stroke")?b.stroke===!0?(c.strokeStyle=a.strokeStyle,c.strokeThickness=a.strokeThickness):(c.strokeStyle=b.stroke,c.strokeThickness=a.strokeThickness):(c.strokeStyle=a.strokeStyle,c.strokeThickness=0)),b.hasOwnProperty("shadow")?b.shadow===!0?(c.shadowColor=a.shadowColor,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor=b.shadow,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor="#000",c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=0,c.shadowStroke=!1,c.shadowFill=!1),b.hasOwnProperty("u")?b.u===!0?(c.underlineStyle=a.underlineStyle,c.underlineThickness=a.underlineThickness,c.underlineOffsetY=a.underlineOffsetY):(c.underlineStyle=b.u,c.underlineThickness=a.underlineThickness,c.underlineOffsetY=a.underlineOffsetY):(c.underlineStyle="#000",c.underlineThickness=0,c.underlineOffsetY=0),c}propToTagText(a,b,c){c==null&&(c=dr);let d=[];for(const f in c){if(b.hasOwnProperty(f))continue;d.push(`[/${f}]`)}a=`${d.join()}${a}`;let e=[];for(const f in b){if(c[f]===b[f])continue;switch(f){case"size":const g=b.size.replace("px","");e.push(`[size=${g}]`);break;case"color":case"img":case"area":e.push(`[${f}=${b[f]}]`);break;case"stroke":case"u":b[f]===!0?e.push(`[${f}]`):e.push(`[${f}=${b[f]}]`);break;default:e.push(`[${f}]`);break}}return a=`${a}${e.join()}`,a}}const wa=function(a,b,c,d){return b===Xa?a[c]=d:a.hasOwnProperty(c)&&delete a[c],a};var cr=function(a,b){return a&&b?"bold italic":a?"bold":b?"italic":""};const dr={},Ji=/\[b\]|\[\/b\]|\[i\]|\[\/i\]|\[size=(\d+)\]|\[\/size\]|\[color=([a-z]+|#[0-9abcdef]+)\]|\[\/color\]|\[u\]|\[u=([a-z]+|#[0-9abcdef]+)\]|\[\/u\]|\[shadow\]|\[shadow=([a-z]+|#[0-9abcdef]+)\]|\[\/shadow\]|\[stroke\]|\[stroke=([a-z]+|#[0-9abcdef]+)\]|\[\/stroke\]|\[img=([^\]]+)\]|\[\/img\]|\[area=([^\]]+)\]|\[\/area\]/ig;var er=/\[b\]/i,fr=/\[\/b\]/i,gr=/\[i\]/i,hr=/\[\/i\]/i,fo=/\[size=(\d+)\]/i,ir=/\[\/size\]/i,go=/\[color=([a-z]+|#[0-9abcdef]+)\]/i,jr=/\[\/color\]/i,ho=/\[u\]/i,io=/\[u=([a-z]+|#[0-9abcdef]+)\]/i,kr=/\[\/u\]/i,lr=/\[shadow\]/i,jo=/\[shadow=([a-z]+|#[0-9abcdef]+)\]/i,mr=/\[\/shadow\]/i,nr=/\[stroke\]/i,ko=/\[stroke=([a-z]+|#[0-9abcdef]+)\]/i,or=/\[\/stroke\]/i,lo=/\[img=([^\]]+)\]/i,pr=/\[\/img\]/i,mo=/\[area=([^\]]+)\]/i,qr=/\[\/area\]/i;const kb=!1,Xa=!0;class yd extends wf{constructor(a,b,c="",d){super(a,b,c,d,new eo());this.type="rexBBcodeText"}}class no extends Bf{constructor(a){super();this.tags=new Map();if(a)for(const b in a)this.addTag(b,a[b])}destroy(){this.tags.clear()}addTag(a,b){return this.tags.set(a,b),this}isTextTag(a){const b=this.tags.get(a);return b?b.img==null:!1}splitText(a,b=!1){const c=[];let d=0;for(;;){const f=Ki.exec(a);if(!f)break;const g=f[0],i=Ki.lastIndex-g.length;d<i&&c.push(a.substring(d,i));if(!b)c.push(g);else if(po.test(g)){const h=g.match(qo);c.push(h[2])}else if(ro.test(g)){const h=g.match(so);c.push(h[2])}d=Ki.lastIndex}const e=a.length;return d<e&&c.push(a.substring(d,e)),c}tagTextToProp(a,b){let c,d;if(po.test(a)){const f=a.match(qo);if(f!=null){const g=f[1],i=this.tags;d=i.get(g)??{},d._class=g,c=f[2]}}else if(ro.test(a)){const f=a.match(so);if(f!=null){const g=f[1];d=rr(g),d._style=g,c=f[2]}}c===void 0&&(c=a),d===void 0&&(d={});const e=Cf;return e.text=c,e.prop=d,e}propToStyle(a,b){const c=Df;if(b.hasOwnProperty("img"))c.image=b.img;else{c.image=null,c.fontFamily=b.family??b.fontFamily??b["font-family"]??a.fontFamily;let d=b.size??b.fontSize??b["font-size"]??a.fontSize;typeof d==="number"&&(d=`${d}px`),c.fontSize=d,c.fontStyle=b.style??b.fontStyle??b["font-style"]??"",c.font=`${c.fontStyle} ${c.fontSize} ${c.fontFamily}`,c.fillStyle=b.color??b["font-color"]??a.fillStyle;if(b.hasOwnProperty("stroke")){const e=b.stroke;c.strokeStyle=e.color??a.strokeStyle,c.strokeThickness=e.thinkness??a.strokeThickness}else c.strokeStyle=a.strokeStyle,c.strokeThickness=a.strokeThickness}if(b.hasOwnProperty("shadow")){const d=b.shadow;c.shadowColor=d.color??a.shadowColor,c.shadowOffsetX=d.offsetX??a.shadowOffsetX,c.shadowOffsetY=d.offsetY??a.shadowOffsetY,c.shadowBlur=d.blur??a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0}else c.shadowColor=a.shadowColor,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=a.shadowStroke,c.shadowFill=a.shadowFill;if(b.hasOwnProperty("u")||b.hasOwnProperty("underline")){const d=b.u??b.underline;c.underlineStyle=d.color??a.underlineStyle,c.underlineThickness=d.thinkness??a.underlineThickness,c.underlineOffsetY=d.offset??a.underlineOffsetY}else c.underlineStyle="#000",c.underlineThickness=0,c.underlineOffsetY=0;return c}propToTagText(a,b,c){if(b.hasOwnProperty("_class")){if(a===""){if(this.isTextTag(b._class))return""}return`<class=${b._class}>${a}</class>`}else if(b.hasOwnProperty("_style"))return`<style=${b._style}>${a}</style>`}}function rr(a){const b=a.split(";"),c={};for(var d=0,e=b.length;d<e;d++){const[f,g]=b[d].split(":");if(oo(f)||oo(g))continue;if(f==="stroke"){const i=g.split(" "),h={},k=i.length;k>=1&&(h.color=i[0]),k>=2&&(h.thinkness=parseInt(i[1].replace("px",""))),c.stroke=h}else if(f==="shadow"){const i=g.split(" "),h={},k=i.length;k>=1&&(h.color=i[0]),k>=2&&(h.offsetX=parseInt(i[1].replace("px",""))),k>=3&&(h.offsetY=parseInt(i[2].replace("px",""))),k>=4&&(h.blur=parseInt(i[3].replace("px",""))),c.shadow=h}else if(f==="u"||f==="underline"){const i=g.split(" "),h={},k=i.length;k>=1&&(h.color=i[0]),k>=2&&(h.thinkness=parseInt(i[1].replace("px",""))),k>=3&&(h.offset=parseInt(i[2].replace("px",""))),c[f]=h}else c[f]=g}return c}function oo(a){return a=a.replace(sr,""),a.length===0}const Ki=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,po=/<\s*class=/i,qo=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,ro=/<\s*style=/i,so=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,sr=/^\s+|\s+$/;class zd extends wf{constructor(a,b,c="",d){const e=d?d.tags:void 0;super(a,b,c,d,new no(e));this.type="rexTagText"}get parser(){return this.canvasText.parser}addTag(a,b){return this.parser.addTag(a,b),this}addTags(a){for(const b in a)this.parser.addTag(b,a[b]);return this}}const Uc={};Pb(Uc,{BBCodeText:()=>yd,BaseSizer:()=>na,GridSizer:()=>rf,Label:()=>tf,MaskedImage:()=>vd,RectangleCanvas:()=>wd,RoundRectangleCanvas:()=>xd,Sizer:()=>Tc,TagText:()=>zd});function Wa(a,b){return a===void 0||b===void 0?void 0:`${a}|${b}`}function ll(a,b){let c=a.split("|");return b===void 0&&(b=lq),b.x=parseInt(c[0]),b.y=parseInt(c[1]),b}let lq={x:0,y:0};let Qo=new rc();function tk(){let a=Qo.pop();return a===null&&(a=new Map()),a}function Be(a){Qo.push(a)}function rk(a,b,c,d,e,f,g,i){if(c===f&&d===g&&e===i)return;let h=Wa(c,d),k=Wa(f,g);if(h){let n=b.get(h);n.delete(e);if(h===k){n.set(i,a);return}else n.size===0&&(Be(n),b.delete(h))}if(k){let n=b.get(k);n?n.set(i,a):(n=tk(),n.set(i,a),b.set(k,n))}}function Pg(a,b,c,d){let e=Wa(b,c),f=a.get(e);f&&(d!==void 0?(f.delete(d),f.size===0&&(Be(f),a.delete(e))):(f.clear(),Be(f),a.delete(e)))}let Ro=new rc();function sk(){let a=Ro.pop();return a===null&&(a=new Set()),a}function Og(a){Ro.push(a)}function Ae(a,b,c,d){if(c===d)return;if(c!==void 0){let e=b.get(c);e&&(e.delete(a),e.size===0&&(Og(e),b.delete(c)))}if(d!==void 0){let e=b.get(d);e?e.add(a):(e=sk(),e.add(a),b.set(d,e))}}function ac(a,b,c){let d=a.get(b);d&&(d.delete(c),d.size===0&&(Og(d),a.delete(b)))}function mk(a,b,c,d,e){let f=a.chessToXYZ.get(b),g=f?f.x:void 0,i=f?f.y:void 0,h=f?f.y:void 0;f?(f.x=c,f.y=d,f.z=e):a.chessToXYZ.set(b,{x:c,y:d,z:e}),rk(b,a.XYToZMap,g,i,h,c,d,e),Ae(b,a.XToChessSet,g,c),Ae(b,a.YToChessSet,i,d),Ae(b,a.ZToChessSet,h,e)}function $b(a,b,c,d){let e=a.XYToZMap.get(Wa(b,c));return e===void 0?null:d!==void 0?e.has(d)?e.get(d):null:e}function nk(a,b,c,d){if(d!==void 0){let e=$b(a,b,c,d);if(e===void 0)return;a.chessToXYZ.delete(e),Pg(a.XYToZMap,b,c,d),ac(a.XToChessSet,b,e),ac(a.YToChessSet,c,e),ac(a.ZToChessSet,d,e)}else{let e=$b(a,b,c);if(e){for(const[f,g]of e)a.chessToXYZ.delete(g),ac(a.XToChessSet,b,g),ac(a.YToChessSet,c,g),ac(a.ZToChessSet,f,g);Pg(a.XYToZMap,b,c)}}}function ok(a,b){return a.chessToXYZ.has(b)}function pk(a,b,c,d){return $b(a,b,c,d)!==null}function qk(a,b){return a.chessToXYZ.get(b)||null}function Mg(a){let b=-Infinity;for(const[c,d]of a)b<c&&(b=c);return b}function Ng(a){let b=Infinity;for(const[c,d]of a)b>c&&(b=c);return b}class xg{constructor(){this.chessToXYZ=new Map(),this.XYToZMap=new Map(),this.XToChessSet=new Map(),this.YToChessSet=new Map(),this.ZToChessSet=new Map(),this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0}destroy(){this.clear()}clear(){return this.chessToXYZ.clear(),this.XYToZMap.clear(),this.XToChessSet.clear(),this.YToChessSet.clear(),this.ZToChessSet.clear(),this.clearBounds(),this}clearBounds(){return this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0,this}addChess(a,b,c,d){return mk(this,a,b,c,d),this.clearBounds(),this}getChess(a,b,c){return $b(this,a,b,c)}removeChess(a,b,c){return nk(this,a,b,c),this.clearBounds(),this}hasChess(a){return ok(this,a)}contains(a,b,c){return pk(this,a,b,c)}getXYZ(a){return qk(this,a)}get xMax(){return this._xMax===void 0&&(this._xMax=Mg(this.XToChessSet)),this._xMax}get xMin(){return this._xMin===void 0&&(this._xMin=Ng(this.XToChessSet)),this._xMin}get yMax(){return this._yMax===void 0&&(this._yMax=Mg(this.YToChessSet)),this._yMax}get yMin(){return this._yMin===void 0&&(this._yMin=Ng(this.YToChessSet)),this._yMin}}function eb(a,b=[]){let c=a.boardData.chessToXYZ;for(const[d,e]of c)b.push(d);return b}function Qe(a){if(typeof a!=="object"||a.nodeType||a===a.window)return!1;try{if(a.constructor&&!{}.hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0}function id(a){return Qe(a)?!0:typeof a==="object"?a.isTileXYZ:!1}function ba(a,b){let c=a.boardData.getXYZ(b);return c?c:id(b)?b:null}function ra(a,b,c,d){return a.boardData.getChess(b,c,d)}class uk{constructor(a){this.parent=a,this.board=null,this.blocker=!1,this.boot()}boot(){typeof this.parent==="object"&&this.parent.on&&this.parent.on("destroy",this.destroy,this)}destroy(){if(this.board){let a=this.tileXYZ;this.board.boardData.removeChess(a.x,a.y,a.z)}this.parent=void 0,this.board=null}setBoard(a){return this.board=a,this}get tileXYZ(){return this.board==null?null:this.board.boardData.getXYZ(this.parent)}setBlocker(a=!0){return this.blocker=a,this}setBlockEdge(a,b=!0){typeof this.blocker==="boolean"&&(this.blocker={});let c=this.blocker;if(typeof a==="object"){let d=a;for(let e in d)c[e]=d[e]}else c[a]=b;return this}getBlockEdge(a){return typeof this.blocker==="boolean"?!1:this.blocker.hasOwnProperty(a)?this.blocker[a]:!1}}function _a(a){return a.hasOwnProperty("rexChess")||(a.rexChess=new uk(a)),a.rexChess}function Sa(a,b,c,d,e,f=!1,g=!1){if(b){let i=ba(a,b);if(i)c=i.x,d=i.y,e=i.z;else return}else{b=ra(a,c,d,e);if(!b)return}g||a.boardData.removeChess(c,d,e),a._isBoard&&_a(b).setBoard(null),f&&b.destroy&&b.destroy()}function _b(a,b){if(a.infinityMode)return;if(a.height===void 0||a.height<=b){a.height=b;return}let c=eb(a);c.forEach(d=>{let e=ba(a,d);e.y>b&&Sa(a,d)}),a.height=b}function Zb(a,b){if(a.infinityMode)return;if(a.width===void 0||a.width<=b){a.width=b;return}let c=eb(a);c.forEach(d=>{let e=ba(a,d);e.x>b&&Sa(a,d)}),a.width=b}class je{constructor({grid:a=void 0,wrap:b=!1,inifinity:c=!1,width:d=0,height:e=0}={}){this.boardData=new xg(),this._isBoard=!0,this.setGrid(a),this.setWrapMode(b),this.setInfinityMode(c),this.setBoardSize(d,e)}destroy(){}setGrid(a){return this.grid=a,this}setWrapMode(a=!0){return this.wrapMode=a,this}setInfinityMode(a=!0){return this.infinityMode=a,this}setBoardSize(a=0,b=0){return Zb(this,a),_b(this,b),this}}function Za(a,b,c,d){let e;return a.infinityMode?e=!0:e=b>=0&&b<a.width&&c>=0&&c<a.height,e&&d!==void 0&&(e=a.boardData.contains(b,c,d)),e}function Ia(a,b,c,d){return a.grid.getWorldXY(b,c,d)}function Dc(a,b,c,d){if(b===void 0){let e=eb(a);for(let f=0,g=e.length;f<g;f++){let i=e[f],h=ba(a,i);Ia(a,h.x,h.y,i)}}else{if(c===void 0){let e=ba(a,b);c=e.x,d=e.y}Ia(a,c,d,b)}}function Cb(a,b,c,d,e,f=!0){if(!Za(a,c,d))return;let g=ba(a,b);e===void 0&&(g?e=g.z:e=0);if(g&&g.x===c&&g.y===d&&g.z===e)return;let i=ra(a,c,d,e);i&&(Sa(a,null,c,d,e),console.warn(`Chess at (${c},${d},${e}) has been removed because of overlapped`)),a.boardData.addChess(b,c,d,e),a._isBoard&&_a(b).setBoard(a),f&&Dc(a,b,c,d)}function ec(a,b,c,d){return Math.atan2(d-b,c-a)}function Db(a,b,c){let d=ba(a,b),e=ba(a,c),f=Ia(a,d.x,d.y,!0),g=f.x,i=f.y;f=Ia(a,e.x,e.y,!0);let h=f.x,k=f.y;return ec(g,i,h,k)}function rb(a,b,c){let d=c-b;return b+((a-b)%d+d)%d}function Cc(a,b,c,d={x:0,y:0}){return d===!0&&(d=up),a.wrapMode?b=rb(b,0,a.width):!a.infinityMode&&(b<0||b>=a.width)&&(b=null),a.wrapMode?c=rb(c,0,a.height):!a.infinityMode&&(c<0||c>=a.height)&&(c=null),d.x=b,d.y=c,d}let up={x:0,y:0};function Ra(a,b,c,d,e){let f=ba(a,b);if(f===null)return null;typeof c==="string"&&(c.indexOf(",")===-1?c=parseInt(c):c=c.split(".").map(k=>parseInt(k,10)));let g=typeof c==="number",i=typeof d==="number";if(g&&i){let k=a.grid.getTileXYAtDirection(f,c,d,e);return Cc(a,k.x,k.y,k),(k.x===null||k.y===null)&&(k=null),k}Array.isArray(e)||(e=[]),c===null&&(c=a.grid.allDirections);let h;if(g)if(Array.isArray(d))for(let k=0,n=d.length;k<n;k++)h=Ra(a,f,c,d[k]),h!==null&&e.push(h);else{let k,n,o;({end:k=1,start:n=k>0?1:-1,step:o=k>=n?1:-1}=d);if(n===k)h=Ra(a,f,c,k),h!==null&&e.push(h);else if(n<k)for(let s=n;s<=k;s+=o)h=Ra(a,f,c,s),h!==null&&e.push(h);else for(let s=n;s>=k;s+=o)h=Ra(a,f,c,s),h!==null&&e.push(h)}else for(let k=0,n=c.length;k<n;k++)i?(h=Ra(a,f,c[k],d),h!==null&&e.push(h)):Ra(a,f,c[k],d,e);return e}function ib(a,b,c=null,d={x:0,y:0}){return Ra(a,b,c,1,d)}function zc(a,b,c){b===void 0&&(b=yp);let d=a.wrapMode,e=a.infinityMode;a.wrapMode=!1,a.infinityMode=!0;let f=ib(a,b,c,!0);return a.wrapMode=d,a.infinityMode=e,Db(a,b,f)}let yp={x:0,y:0};const Ir=180/Math.PI;function Gc(a){return a*Ir}function yk(a,b){let c=b-a;if(c===0)return 0;let d=Math.floor((c- -180)/360);return c-d*360}function yc(a,b,c){c=Gc(c);let d=a.grid.allDirections,e=Infinity,f;for(let g=0,i=d.length;g<i;g++){let h=Gc(zc(a,b,d[g])),k=Math.abs(yk(c,h));k<e&&(e=k,f=g)}return f}function Bc(a,b,c){if(b===null||c===null)return null;if(b.x===c.x&&b.y===c.y)return null;let d=a.grid.getNeighborTileDirection(b,c);if(a.wrapMode&&d===null){let e=ib(a,b,null);for(let f=0,g=e.length;f<g;f++){let i=e[f];if(c.x===i.x&&c.y===i.y){d=f;break}}}return d}function Ac(a,b,c){let d=ba(a,b),e=ba(a,c);return Bc(a,d,e)}function le(a,b,c){return Ac(a,b,c)!==null}function me(a,b,c,d=!0){let e=ba(a,b),f=ba(a,c);return e===null||f===null?null:a.grid.directionBetween(e,f,d)}function fd(a,b,c=1,d=[]){let e=a.grid.ringToTileXYArray(b,c);for(let f=0,g=e.length;f<g;f++){let i=e[f];Za(a,i.x,i.y)&&d.push(i)}return d}function yg(a,b,c,d=!0,e=[]){for(let f=0;f<=c;f++){let g=d?f:c-f;fd(a,b,g,e)}return e}function fb(a,b,c,d,e={x:0,y:0}){return e===!0&&(e=wp),c===0&&d===0?(e.x=b.x,e.y=b.y):a.grid.offset(b,c,d,e),e}let wp={x:0,y:0};function zg(a,b){let c=Infinity,d=Infinity,e;for(let i=0,h=b.length;i<h;i++)e=b[i],c=Math.min(c,e.x),d=Math.min(d,e.y);if(c!==0||d!==0)for(let i=0,h=b.length;i<h;i++)e=b[i],fb(a,e,-c,-d,e);let f=-Infinity,g=-Infinity;for(let i=0,h=b.length;i<h;i++)e=b[i],f=Math.max(f,e.x),g=Math.max(g,e.y);return Zb(a,f+1),_b(a,g+1),b}var cc;(function(a){a[a["x+,y+"]=0]="x+,y+",a[a["x-,y+"]=1]="x-,y+",a[a["y+,x+"]=2]="y+,x+",a[a["y-,x+"]=3]="y-,x+"})(cc||(cc={}));function ne(a,b,c,d=0){let e={x:0,y:0};switch(d){case 0:for(let f=0;f<a.height;f++)for(let g=0;g<a.width;g++)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 1:for(let f=0;f<a.height;f++)for(let g=a.width-1;g>=0;g--)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 2:for(let f=0;f<a.width;f++)for(let g=0;g<a.height;g++)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a);break;case 3:for(let f=0;f<a.width;f++)for(let g=a.height-1;g>=0;g--)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a)}}function oe(a,b,c,d){return a.grid.getDistance(b,c,d)}function ed(a,b=0,c=[]){if(Array.isArray(b)){let d=b;for(let e=0;e<a.height;e++)for(let f=0;f<a.width;f++){let g=!0;for(let i=0,h=d.length;i<h;i++)if(ra(a,f,e,d[i])!==null){g=!1;break}g&&c.push({x:f,y:e})}}else for(let d=0;d<a.height;d++)for(let e=0;e<a.width;e++)ra(a,e,d,b)===null&&c.push({x:e,y:d});return c}function pe(a,b,c,d){return a.grid.getGridPoints(b,c,d)}function Ta(a,b,c,d=[]){let e=a.boardData.getChess(b,c);for(const[f,g]of e)d.push(g);return d}function Ec(a,b,c,d=[]){let e=c!=null,f,g;for(let i=0,h=b.length;i<h;i++)f=b[i],e?(g=ra(a,f.x,f.y,c),g!==null&&d.push(g)):Ta(a,f.x,f.y,d);return d}function qe(a,b,c,d,e){let f=ba(a,b);if(f===null)return null;d==null&&(d=f.hasOwnProperty("z")?f.z:null);let g=ib(a,f,c,!0);return g===null?null:Array.isArray(g)?(e===void 0&&(e=[]),Ec(a,g,d,e)):d==null?(e===void 0&&(e=[]),Ta(a,g.x,g.y,e)):ra(a,g.x,g.y,d)}function re(a,b,c,d={x:0,y:0}){let e=yc(a,b,c);return Ra(a,b,e,1,d)}function se(a,b,c,d){return a.grid.getOppositeDirection(b,c,d)}function gd(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function Fc(a,b=0,c=a.length){let d=b+Math.floor(Math.random()*c);return a[d]===void 0?null:a[d]}function Ag(a,b=0,c={x:0,y:0}){c===!0&&(c=rp);let d=Math.floor(a.width*a.height*.3);for(let f=0;f<d;f++){let g=gd(0,a.width-1),i=gd(0,a.height-1);if(ra(a,g,i,b)===null)return c.x=g,c.y=i,c}let e=ed(a,b);if(e.length===0)return null;{let f=Fc(e);return c.x=f.x,c.y=f.y,c}}let rp={x:0,y:0};function Bg(a,b,c,d){if(d===void 0){let e=Ta(a,b,c);for(let f=0,g=e.length;f<g;f++){let i=_a(e[f]).blocker;if(i===!0)return!0}return!1}else{let e=ra(a,b,c,d);if(e===null)return!1;let f=_a(e).blocker;return f===!0}}function Cg(a,b){return a.boardData.chessToXYZ.has(b)}function Dg(a,b,c,d,e){if(d===void 0){let f=Ta(a,b,c);for(let g=0,i=f.length;g<i;g++)if(lk(_a(f[g]).blocker,e))return!0;return!1}else{let f=ra(a,b,c,d);return f===null?!1:lk(_a(f).blocker,e)}}function lk(a,b){return a===!1||a===!0?a:a[b]===!0}function Rg(a){return a=a%Mo,a>=0?a:a+Mo}const Mo=Math.PI*2;function zk(a,b,c=1e-4){return Math.abs(a-b)<c}function te(a,b,c,d,e){let f=ba(a,b),g=ba(a,c),i=Db(a,f,g);i=Rg(i);let h=Math.abs(i-d);h=Math.min(h,zp-h);let k=e/2;return zk(h,k)||h<k}const zp=Math.PI*2;function ue(a,b,c,d,e){let f=ba(a,b),g=ba(a,c),i=a.grid.directions;a.grid.directions=a.grid.sides;let h=a.grid.directionBetween(f,g,!1);a.grid.directions=i;let k=Math.abs(h-d);return k=Math.min(k,a.grid.directions-k),k<=e/2}function Na(a,b,c,d={x:0,y:0}){return a.grid.getTileXY(b,c,d)}function ve(a,b,c,d){if(a.infinityMode&&d===void 0)return!0;let e=Na(a,b,c,!0);return Za(a,e.x,e.y,d)}function xk(a,b,c,d){let e=a-c,f=b-d;return Math.sqrt(e*e+f*f)}function Qg(a,b,c){return(b-a)*c+a}function Eg(a,b,c,d,e,f=[]){let g=xk(b,c,d,e),i=Math.min(a.grid.width,a.grid.height),h=Math.ceil(g/(i/4)),k;for(let n=0;n<=h;n++){let o=n/h,s=Qg(b,d,o),u=Qg(c,e,o),v=Na(a,s,u);if(!Za(a,v.x,v.y))continue;if(k&&k.x===v.x&&k.y===v.y)continue;f.push(v),k=v}return f}var dc;(function(a){a[a.x=1]="x",a[a.horizontal=1]="horizontal",a[a.h=1]="h",a[a.y=2]="y",a[a.vertical=2]="vertical",a[a.v=2]="v",a[a.xy=3]="xy"})(dc||(dc={}));function Fg(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=vp),d!==null?fb(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.mirror(e,c,e),d!==null&&fb(a,e,d.x,d.y,e),e}let vp={x:0,y:0};function Gg(a,b=!1,c=!1){let d=eb(a);for(let e=0,f=d.length;e<f;e++)Sa(a,d[e],void 0,void 0,void 0,b,c)}function Hg(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=xp),d!==null?fb(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.rotate(e,c,e),d!==null&&fb(a,e,d.x,d.y,e),e}let xp={x:0,y:0};function Ig(a,b,c){let d=ba(a,b);if(d===null)return;Cb(a,b,d.x,d.y,c)}function hd(a,b,c){return Math.max(b,Math.min(c,a))}function Jg(a,b,c,d=[]){let e=Na(a,b.left,b.top,!0),f=e.x-1,g=e.y-1,i=Na(a,b.right,b.bottom,!0),h=i.x+1,k=i.y+1;a.infinityMode||(f=hd(f,0,a.width-1),g=hd(g,0,a.height-1),h=hd(h,0,a.width-1),k=hd(k,0,a.height-1));for(let n=f;n<=h;n++)for(let o=g;o<=k;o++){let s=Ia(a,n,o,!0);c(b,s.x,s.y)&&d.push({x:n,y:o})}return d}function Kg(a,b,c,d=!0){let e=ba(a,b),f=ba(a,c);if(e==null||f==null)return;Sa(a,b),Sa(a,c),Cb(a,b,f.x,f.y,f.z,d),Cb(a,c,e.x,e.y,e.z,d)}function we(a,b,c=[]){let d=a.boardData.ZToChessSet.get(b);if(d)for(const e of d)c.push(e);return c}function xe(a,b,c=[]){for(let d=0,e=b.length;d<e;d++){let f=b[d];c.push(Ia(a,f.x,f.y))}return c}function ye(a,b,c,d={x:0,y:0}){return d===!0&&(d=Ap),Na(a,b,c,d),Ia(a,d.x,d.y,d),d}let Ap={x:0,y:0};function ze(a,b,c,d,e){let f=Na(a,b,c,!0);return d!==void 0?ra(a,f.x,f.y,d):Ta(a,f.x,f.y,e)}class ke extends je{addChess(a,b,c,d,e=!0){return Cb(this,a,b,c,d,e),this}angleBetween(a,b){return Db(this,a,b)}angleSnapToDirection(a,b){return yc(this,a,b)}angleToward(a,b){return zc(this,a,b)}areNeighbors(a,b){return le(this,a,b)}chessToTileXYZ(a){return ba(this,a)}contains(a,b,c){return Za(this,a,b,c)}directionBetween(a,b,c=!0){return me(this,a,b,c)}filledRingToTileXYArray(a,b,c=!0,d=[]){return yg(this,a,b,c,d)}fit(a){return zg(this,a)}forEachTileXY(a,b,c=0){return ne(this,a,b,c),this}getAllChess(a=[]){return eb(this,a)}getChessData(a){return _a(a)}getDistance(a,b,c=!1){return oe(this,a,b,c)}getEmptyTileXYArray(a=0,b=[]){return ed(this,a,b)}getGridPoints(a,b,c){return pe(this,a,b,c)}getNeighborChess(a,b,c,d){return qe(this,a,b,c,d)}getNeighborChessDirection(a,b){return Ac(this,a,b)}getNeighborTileDirection(a,b){return Bc(this,a,b)}getNeighborTileXY(a,b=null,c={x:0,y:0}){return ib(this,a,b,c)}getNeighborTileXYAtAngle(a,b,c={x:0,y:0}){return re(this,a,b,c)}getOppositeDirection(a,b,c){return se(this,a,b,c)}getRandomEmptyTileXY(a=0,b={x:0,y:0}){return Ag(this,a,b)}getTileXYAtDirection(a,b,c,d){return Ra(this,a,b,c,d)}getWrapTileXY(a,b,c={x:0,y:0}){return Cc(this,a,b,c)}gridAlign(a,b,c){return Dc(this,a,b,c),this}hasBlocker(a,b,c){return Bg(this,a,b,c)}hasChess(a){return Cg(this,a)}hasEdgeBlocker(a,b,c,d){return Dg(this,a,b,c,d)}isAngleInCone(a,b,c,d){return te(this,a,b,c,d)}isDirectionInCone(a,b,c,d){return ue(this,a,b,c,d)}isOverlappingPoint(a,b,c){return ve(this,a,b,c)}lineToTileXYArray(a,b,c,d,e=[]){return Eg(this,a,b,c,d,e)}mirror(a,b,c=null,d={x:0,y:0}){return Fg(this,a,b,c,d)}offset(a,b,c,d){return fb(this,a,b,c,d)}removeAllChess(a=!1,b=!1){return Gg(this,a,b),this}removeChess(a,b,c,d,e=!1,f=!1){return Sa(this,a,b,c,d,e,f),this}ringToTileXYArray(a,b=1,c=[]){return fd(this,a,b,c)}rotate(a,b,c=null,d={x:0,y:0}){return Hg(this,a,b,c,d)}setBoardWidth(a=0){return Zb(this,a),this}setBoardHeight(a=0){return _b(this,a),this}setTileZ(a,b){return Ig(this,a,b),this}shapeToTileXYArray(a,b,c=[]){return Jg(this,a,b,c)}swapChess(a,b,c=!0){return Kg(this,a,b,c),this}tileXYArrayToChessArray(a,b,c=[]){return Ec(this,a,b,c)}tileXYToChessArray(a,b,c=[]){return Ta(this,a,b,c)}tileXYZToChess(a,b,c){return ra(this,a,b,c)}tileZToChessArray(a,b=[]){return we(this,a,b)}tileXYArrayToWorldXYArray(a,b=[]){return xe(this,a,b)}tileXYToWorldXY(a,b,c={x:0,y:0}){return Ia(this,a,b,c)}worldXYSnapToGrid(a,b,c={x:0,y:0}){return ye(this,a,b,c)}worldXYToChess(a,b,c,d){return ze(this,a,b,c,d)}worldXYToTileXY(a,b,c){return Na(this,a,b,c)}}class kk extends ke{}const $a={};Pb($a,{ChessToTileXYZ:()=>ba,Contains:()=>Za,DirectionBetween:()=>me,ForEachTileXY:()=>ne,GetDistance:()=>oe,GetOppositeDirection:()=>se,GetTileXYAtDirection:()=>Ra,GetWrapTileXY:()=>Cc,IsDirectionInCone:()=>ue,TileXYArrayToChessArray:()=>Ec,TileXYToChessArray:()=>Ta,TileXYZToChess:()=>ra,TileZToChessArray:()=>we});const Eb={};Pb(Eb,{AngleBetween:()=>Db,AngleSnapToDirection:()=>yc,AngleToward:()=>zc,GetGridPoints:()=>pe,GridAlign:()=>Dc,IsAngleInCone:()=>te,IsOverlappingPoint:()=>ve,TileXYArrayToWorldXYArray:()=>xe,TileXYToWorldXY:()=>Ia,WorldXYSnapToGrid:()=>ye,WorldXYToChess:()=>ze,WorldXYToTileXY:()=>Na});const bc={};Pb(bc,{AreNeighbors:()=>le,GetNeighborChess:()=>qe,GetNeighborChessDirection:()=>Ac,GetNeighborTileDirection:()=>Bc,GetNeighborTileXY:()=>ib,GetNeighborTileXYAtAngle:()=>re});var pa;(function(a){a[a.orthogonal=0]="orthogonal",a[a.isometric=1]="isometric"})(pa||(pa={}));var sb;(function(a){a[a["4dir"]=4]="4dir",a[a["8dir"]=8]="8dir"})(sb||(sb={}));class fl{constructor({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=pa.orthogonal,dir:f=sb["4dir"]}={}){this.setOriginPosition(a,b),this.setCellSize(c,d),this.setType(e),this.setDirectionMode(f)}fromJSON({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=pa.orthogonal,dir:f=sb["4dir"]}={}){return this.setType(e),this.setDirectionMode(f),this.setOriginPosition(a,b),this.setCellSize(c,d),this}toJSON(){return{x:this.x,y:this.y,cellWidth:this.cellWidth,cellHeight:this.cellHeight,type:this.mode,dir:this.directions}}setOriginPosition(a=0,b=0){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setType(a=pa.orthogonal){return typeof a==="string"&&(a=pa[a]),this.mode=a,this}setDirectionMode(a=sb["4dir"]){return typeof a==="string"&&(a=sb[a]),this.directions=a,this}}function Zk(a,b,c,d=!0){let e;switch(a.mode){case pa.orthogonal:case pa.isometric:if(b.y===c.y)e=c.x>=b.x?0:2;else if(b.x===c.x)e=c.y>=b.y?1:3;else if(a.directions===sb["4dir"]){let f=Gc(ec(b.x,b.y,c.x,c.y));f<0&&(f+=360),e=f/90,d&&(e=Math.round(e))}else{let f=c.x-b.x,g=c.y-b.y;if(f===g)e=f>0?4:6;else if(f===-g)e=f>0?7:5;else{let i=Gc(Math.atan2(g,f));i<0&&(i+=360);let h=i/45;d&&(h=Math.round(h)),h>=0&&h<1?e=h:h>=1&&h<2?e=h+3:h>=2&&h<3?e=h-1:h>=3&&h<4?e=h+2:h>=4&&h<5?e=h-2:h>=5&&h<6?e=h+1:h>=6&&h<7?e=h-3:e=h}}break}return e===a.directions&&(e=0),e}function Le(a,b){return rb(b,0,a.directions)}function _k(a,b,c,d=!1){let e=c.x-b.x,f=c.y-b.y,g;return d?g=Math.abs(e)+Math.abs(f):g=Math.sqrt(e*e+f*f),g}function He(a,b=[]){if(!(b.length===a))if(b.length<a)for(let c=b.length;c<a;c++)b.push({x:0,y:0});else b.length=a;return b}function Oe(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Vp);let e,f;switch(a.mode){case pa.orthogonal:e=b*a.width,f=c*a.height;break;case pa.isometric:e=(b-c)*a._halfWidth,f=(b+c)*a._halfHeight;break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let Vp={x:0,y:0};function $k(a,b=0,c=0,d=[]){if(typeof b==="object"){let h=b;c=h.y,b=h.x}d===!0&&(d=Rp),He(4,d);let e,f;({x:e,y:f}=Oe(a,b,c));let g=a._halfWidth,i=a._halfHeight;switch(a.mode){case pa.orthogonal:d[0].x=e+g,d[0].y=f-i,d[1].x=e+g,d[1].y=f+i,d[2].x=e-g,d[2].y=f+i,d[3].x=e-g,d[3].y=f-i;break;case pa.isometric:d[0].x=e+g,d[0].y=f,d[1].x=e,d[1].y=f+i,d[2].x=e-g,d[2].y=f,d[3].x=e,d[3].y=f-i;break}return d}let Rp=[];const Hc=[[1,0],[0,1],[-1,0],[0,-1],[1,1],[-1,1],[-1,-1],[1,-1]],jd=Hc;function Wk(a){let b={},c,d,e;for(let f in a)c=a[f],d=c[0],e=c[1],b.hasOwnProperty(d)||(b[d]={}),b[d][e]=parseInt(f);return b}const Xk=Wk(Hc),Yk=Wk(jd);function al(a,b,c){let d;switch(a.mode){case pa.orthogonal:d=Xk;break;case pa.isometric:d=Yk;break}let e=c.x-b.x,f=c.y-b.y;if(d.hasOwnProperty(e)){let g=d[e];if(g.hasOwnProperty(f))return g[f]}return null}function Pe(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Up);let f,g;switch(a.mode){case pa.orthogonal:f=Hc[c][0],g=Hc[c][1];break;case pa.isometric:f=jd[c][0],g=jd[c][1];break}return d===1?(e.x=b.x+f,e.y=b.y+g):(e.x=b.x+d*f,e.y=b.y+d*g),e}let Up={x:0,y:0};function bl(a,b,c,d={x:0,y:0}){return Pe(a,b,c,1,d)}function cl(a,b,c,d){return Sp[d]}const Sp={0:2,1:3,2:0,3:1,4:6,5:7,6:4,7:5};function dl(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Tp),b-=a.x,c-=a.y;let e=b/a.width,f=c/a.height;switch(a.mode){case pa.orthogonal:d.x=Math.round(e),d.y=Math.round(f);break;case pa.isometric:d.x=Math.round(+e+f),d.y=Math.round(-e+f);break}return d}let Tp={x:0,y:0};function el(a,b,c,d={x:0,y:0}){return typeof c==="string"&&(c=dc[c]),d===!0&&(d=Wp),d.x=c&1?-b.x:b.x,d.y=c&2?-b.y:b.y,d}let Wp={x:0,y:0};function fc(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Xp);let f=b.x+c,g=b.y+d;return e.x=f,e.y=g,e}let Xp={x:0,y:0};function gl(a,b,c,d=[]){let e,f;for(e=c,f=-c;f<=c;f++)d.push(fc(a,b,e,f));for(f=c,e=c-1;e>=-c;e--)d.push(fc(a,b,e,f));for(e=-c,f=c-1;f>=-c;f--)d.push(fc(a,b,e,f));for(f=-c,e=-c+1;e<=c-1;e++)d.push(fc(a,b,e,f));return d}function hl(a,b,c,d={x:0,y:0}){d===!0&&(d=aq),c=rb(c,0,3);let e,f;switch(c){case 1:e=-b.y,f=b.x;break;case 2:e=-b.x,f=-b.y;break;case 3:e=b.y,f=-b.x;break;default:e=b.x,f=b.y;break}return d.x=e,d.y=f,d}let aq={x:0,y:0};function Me(a){a._savedOriginX=a.x,a._savedOriginY=a.y}function Ne(a){a.x=a._savedOriginX,a.y=a._savedOriginY}class Vk extends fl{get sides(){return 4}get allDirections(){return this.directions===4?Yp:Zp}get halfDirections(){return this.directions===4?_p:$p}directionBetween(a,b,c=!0){return Zk(this,a,b,c)}directionNormalize(a){return Le(this,a)}getDistance(a,b,c=!1){return _k(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return $k(this,a,b,c)}getNeighborTileDirection(a,b){return al(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return bl(this,a,b,c)}getOppositeDirection(a,b,c){return cl(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return dl(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return Pe(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return Oe(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return el(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return fc(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return gl(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return hl(this,a,b,c)}restoreOrigin(){return Ne(this),this}saveOrigin(){return Me(this),this}}const Yp=[0,1,2,3],Zp=[0,1,2,3,4,5,6,7],_p=[0,1],$p=[0,1,4,5];var ca;(function(a){a[a.ODD_R=0]="ODD_R",a[a.EVEN_R=1]="EVEN_R",a[a.ODD_Q=2]="ODD_Q",a[a.EVEN_Q=3]="EVEN_Q"})(ca||(ca={}));var gb;(function(a){a[a.y=0]="y",a[a.flat=0]="flat",a[a.x=1]="x",a[a.pointy=1]="pointy"})(gb||(gb={}));var Hb;(function(a){a[a.even=0]="even",a[a.odd=1]="odd"})(Hb||(Hb={}));class Ok{constructor({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=gb.x,staggerIndex:g=Hb.odd}={}){this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e)}fromJSON({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=gb.x,staggerIndex:g=Hb.odd}={}){return this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e),this}toJSON(){return{x:this.x,y:this.y,radius:this.radius,cellWidth:this.cellWidth,cellHeight:this.cellHeight,staggerAxis:this.staggerAxis,staggerIndex:this.staggerIndex}}setOriginPosition(a,b){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this.radius=void 0,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setRadius(a=0){let b,c;return this.staggerAxis===gb.y?(b=2*a,c=Uk*a):(b=Uk*a,c=2*a),this.setCellSize(b,c),this.radius=a,this}setDirectionMode(){return this.directions=6,this}setType(a=1,b=1){return typeof a==="string"&&(a=gb[a]),typeof b==="string"&&(b=Hb[b]),this.staggerAxis=a,this.staggerIndex=b,a===gb.y?this.mode=b===Hb.even?ca.EVEN_Q:ca.ODD_Q:this.mode=b===Hb.even?ca.EVEN_R:ca.ODD_R,this}}const Uk=Math.sqrt(3);function Ua(a,b,c,d={x:0,y:0,z:0}){d===!0&&(d=Sg);switch(a){case ca.ODD_R:d.x=b-(c-(c&1))/2,d.z=c;break;case ca.EVEN_R:d.x=b-(c+(c&1))/2,d.z=c;break;case ca.ODD_Q:d.x=b,d.z=c-(b-(b&1))/2;break;case ca.EVEN_Q:d.x=b,d.z=c-(b+(b&1))/2;break}return d.y=-d.x-d.z,d}function Ck(a,b,c,d={x:0,y:0,z:0}){typeof a!=="number"&&(d=a,a=d.x,b=d.y,c=d.z),d===!0&&(d=Sg);let e=Math.round(a),f=Math.round(b),g=Math.round(c),i=Math.abs(e-a),h=Math.abs(f-b),k=Math.abs(g-c);return i>h&&i>k?e=-f-g:h>k?f=-e-g:g=-e-f,d.x=e,d.y=f,d.z=g,d}function Ea(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Cp);switch(a){case ca.ODD_R:e.x=b+(d-(d&1))/2,e.y=d;break;case ca.EVEN_R:e.x=b+(d+(d&1))/2,e.y=d;break;case ca.ODD_Q:e.x=b,e.y=d+(b-(b&1))/2;break;case ca.EVEN_Q:e.x=b,e.y=d+(b+(b&1))/2;break}return e}function Dk(a,b,c={x:0,y:0,z:0}){return c===!0&&(c=Sg),c.x=a,c.y=-a-b,c.z=b,c}let Sg={x:0,y:0,z:0},Cp={x:0,y:0};function Fk(a,b,c,d=!0){let e;Ua(a.mode,b.x,b.y,De),Ua(a.mode,c.x,c.y,Ee);let f=Ee.x-De.x,g=Ee.y-De.y,i=Ee.z-De.z;return i===0?e=f>0?0:3:f===0?e=i>0?1:4:g===0?e=i>0?2:5:f>0&&g<0&&i>0?e=0+i/-g:f<0&&g<0&&i>0?e=1+-g/i:f<0&&g>0&&i>0?e=2+g/-f:f<0&&g>0&&i<0?e=3+-i/g:f>0&&g>0&&i<0?e=4+f/-i:e=5+-g/f,d&&(e=Math.round(e)),e}let De={x:0,y:0,z:0},Ee={x:0,y:0,z:0};function Gk(a,b,c,d=!1){Ua(a.mode,b.x,b.y,Fe),Ua(a.mode,c.x,c.y,Ge);let e=Ge.x-Fe.x,f=Ge.y-Fe.y,g=Ge.z-Fe.z;return(Math.abs(e)+Math.abs(f)+Math.abs(g))/2}let Fe={x:0,y:0,z:0},Ge={x:0,y:0,z:0};function Ie(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Lp);let e=b*a.width,f=c*a.height;switch(a.mode){case ca.ODD_R:c&1&&(e+=a._halfWidth),f*=.75;break;case ca.EVEN_R:c&1&&(e-=a._halfWidth),f*=.75;break;case ca.ODD_Q:e*=.75,b&1&&(f+=a._halfHeight);break;case ca.EVEN_Q:e*=.75,b&1&&(f-=a._halfHeight);break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let Lp={x:0,y:0};function Hk(a,b=0,c=0,d=[]){if(typeof b==="object"){let g=b;c=g.y,b=g.x}d===!0&&(d=Hp),He(6,d);let e,f;({x:e,y:f}=Ie(a,b,c));if(a.radius!==void 0){let g=a.radius,i=a.staggerAxis===gb.flat?0:-30;for(let h=0;h<6;h++){let k=60*h+i,n=Fb(k);d[h].x=e+g*Math.cos(n),d[h].y=f+g*Math.sin(n)}}else{let g=a._halfWidth,i=g/2,h=a._halfHeight,k=h/2;a.staggerAxis===gb.flat?(d[0].x=e+g,d[0].y=f,d[1].x=e+i,d[1].y=f+h,d[2].x=e-i,d[2].y=f+h,d[3].x=e-g,d[3].y=f,d[4].x=e-i,d[4].y=f-h,d[5].x=e+i,d[5].y=f-h):(d[0].x=e+g,d[0].y=f-k,d[1].x=e+g,d[1].y=f+k,d[2].x=e,d[2].y=f+h,d[3].x=e-g,d[3].y=f+k,d[4].x=e-g,d[4].y=f-k,d[5].x=e,d[5].y=f-h)}return d}let Hp=[];const Dp=[[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]]],Ep=[[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]],[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]]],Fp=[[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]],[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]]],Gp=[[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]],[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]]],ab=[Dp,Ep,Fp,Gp];function Gb(a){let b={},c,d;for(let e in a)[c,d]=a[e],b.hasOwnProperty(c)||(b[c]={}),b[c][d]=parseInt(e);return b}const Ek=[[Gb(ab[0][0]),Gb(ab[0][1])],[Gb(ab[1][0]),Gb(ab[1][1])],[Gb(ab[2][0]),Gb(ab[2][1])],[Gb(ab[3][0]),Gb(ab[3][1])]];function Je(a,b,c){let d;switch(a){case ca.ODD_R:case ca.EVEN_R:d=c&1;break;case ca.ODD_Q:case ca.EVEN_Q:d=b&1;break}return d}function Ik(a,b,c){let d=a.mode,e=Je(d,b.x,b.y),f=Ek[d][e],g=c.x-b.x,i=c.y-b.y;if(f.hasOwnProperty(g)){let h=f[g];if(h.hasOwnProperty(i))return h[i]}return null}function Ke(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Kp);let f=a.mode,g=b.x,i=b.y;if(d===1){let h=Je(f,g,i);e.x=g+ab[f][h][c][0],e.y=i+ab[f][h][c][1]}else if(d===0)e.x=g,e.y=i;else{let h=Ua(f,g,i,!0),k,n,o;switch(c){case 1:k=h.x,n=h.y-d,o=h.z+d;break;case 2:k=h.x-d,n=h.y,o=h.z+d;break;case 3:k=h.x-d,n=h.y+d,o=h.z;break;case 4:k=h.x,n=h.y+d,o=h.z-d;break;case 5:k=h.x+d,n=h.y,o=h.z-d;break;default:k=h.x+d,n=h.y-d,o=h.z;break}Ea(f,k,n,o,e)}return e}let Kp={x:0,y:0};function Jk(a,b,c,d={x:0,y:0}){return Ke(a,b,c,1,d)}function Kk(a,b,c,d){return(d+3)%6}const Lk=4/3,Mk=2/3;function Nk(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Jp),b-=a.x,c-=a.y;let e,f;switch(a.mode){case ca.ODD_R:case ca.EVEN_R:f=c*Lk/a.height,e=b/a.width-Mk*(c/a.height);break;case ca.ODD_Q:case ca.EVEN_Q:f=c/a.height-Mk*(b/a.width),e=b*Lk/a.width;break}let g=Dk(e,f,Ip);return Ck(g),Ea(a.mode,g.x,g.y,g.z,d),d}let Ip={x:0,y:0,z:0},Jp={x:0,y:0};function Pk(a,b,c,d={x:0,y:0}){typeof c==="string"&&(c=dc[c]),d===!0&&(d=Op);let e=Ua(a.mode,b.x,b.y,!0),f=a.mode===ca.ODD_R||a.mode===ca.EVEN_R,g,i,h;return c&1&&(f?(g=e.y,i=e.x,h=e.z):(g=-e.x,i=-e.z,h=-e.y),e.x=g,e.y=i,e.z=h),c&2&&(f?(g=-e.y,i=-e.x,h=-e.z):(g=e.x,i=e.z,h=e.y)),Ea(a.mode,g,i,h,d),d}let Op={x:0,y:0};function Qk(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Pp);let f=b.x+c,g=b.y+d;switch(a.mode){case ca.ODD_R:(d&1)!==0&&((g&1)===0&&(f+=1));break;case ca.EVEN_R:(d&1)!==0&&((g&1)===0&&(f-=1));break;case ca.ODD_Q:(c&1)!==0&&((f&1)==0&&(g+=1));break;case ca.EVEN_Q:(c&1)!==0&&((f&1)==0&&(g-=1));break}return e.x=f,e.y=g,e}let Pp={x:0,y:0};function Rk(a,b,c,d=[]){let e=Ua(a.mode,b.x,b.y,!0),f=e.x,g=e.y,i=e.z,h,k,n;for(n=c,h=0;h>=-c;h--)k=-h-n,d.push(Ea(a.mode,f+h,g+k,i+n));for(h=-c,k=1;k<=c;k++)n=-h-k,d.push(Ea(a.mode,f+h,g+k,i+n));for(k=c,n=-1;n>=-c;n--)h=-k-n,d.push(Ea(a.mode,f+h,g+k,i+n));for(n=-c,h=1;h<=c;h++)k=-h-n,d.push(Ea(a.mode,f+h,g+k,i+n));for(h=c,k=-1;k>=-c;k--)n=-h-k,d.push(Ea(a.mode,f+h,g+k,i+n));for(k=-c,n=1;n<=c-1;n++)h=-k-n,d.push(Ea(a.mode,f+h,g+k,i+n));return d}function Sk(a,b,c,d={x:0,y:0}){d===!0&&(d=Qp),c=rb(c,0,5);let e=Ua(a.mode,b.x,b.y,!0),f,g,i;switch(c){case 1:f=-e.z,g=-e.x,i=-e.y;break;case 2:f=e.y,g=e.z,i=e.x;break;case 3:f=-e.x,g=-e.y,i=-e.z;break;case 4:f=e.z,g=e.x,i=e.y;break;case 5:f=-e.y,g=-e.z,i=-e.x;break;default:f=e.x,g=e.y,i=e.z;break}return Ea(a.mode,f,g,i,d),d}let Qp={x:0,y:0};class Tk extends Ok{get sides(){return 6}get allDirections(){return Mp}get halfDirections(){return Np}directionBetween(a,b,c=!0){return Fk(this,a,b,c)}directionNormalize(a){return Le(this,a)}getDistance(a,b,c=!1){return Gk(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return Hk(this,a,b,c)}getNeighborTileDirection(a,b){return Ik(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return Jk(this,a,b,c)}getOppositeDirection(a,b,c){return Kk(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return Nk(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return Ke(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return Ie(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return Pk(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return Qk(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return Rk(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return Sk(this,a,b,c)}restoreOrigin(){return Ne(this),this}saveOrigin(){return Me(this),this}}const Mp=[0,1,2,3,4,5],Np=[0,1,2];var Ca;(function(a){a[a.random=0]="random",a[a.diagonal=1]="diagonal",a[a.straight=2]="straight",a[a.line=3]="line",a[a.astar=10]="astar",a[a["astar-random"]=11]="astar-random",a[a["astar-line"]=12]="astar-line"})(Ca||(Ca={}));const gc=null;class Bo{constructor(a){this.content=[],this.scoreFunction=a}clear(){this.content.length=0}push(a){this.content.push(a),this.sinkDown(this.content.length-1)}pop(){let a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.bubbleUp(0)),a}remove(a){let b=this.content.indexOf(a),c=this.content.pop();b!==this.content.length-1&&(this.content[b]=c,this.scoreFunction(c)<this.scoreFunction(a)?this.sinkDown(b):this.bubbleUp(b))}get size(){return this.content.length}rescoreElement(a){this.sinkDown(this.content.indexOf(a))}sinkDown(a){let b=this.content[a];for(;a>0;){let c=(a+1>>1)-1,d=this.content[c];if(this.scoreFunction(b)<this.scoreFunction(d))this.content[c]=b,this.content[a]=d,a=c;else break}}bubbleUp(a){let b=this.content.length,c=this.content[a],d=this.scoreFunction(c);for(;;){let e=a+1<<1,f=e-1,g=null,i;if(f<b){let h=this.content[f];i=this.scoreFunction(h),i<d&&(g=f)}if(e<b){let h=this.content[e],k=this.scoreFunction(h);k<(g===null?d:i)&&(g=e)}if(g!==null)this.content[a]=this.content[g],this.content[g]=c,a=g;else break}}}let Soa=new Bo(a=>a.f);const Jf=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d=d.prevNodes[0];return c.reverse()};const Eo=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d.prevNodes.length===1?d=d.prevNodes[0]:d=Fc(d.prevNodes);return c.reverse()};const Do=function(a,b,c=[]){let d=b,e=b.angleTo(a);for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1)d=d.prevNodes[0];else{let f=Infinity;for(let g=1,i=d.prevNodes.length;g<i;g++){let h=d.prevNodes[g],k=Math.abs(b.angleTo(h)-e);k<f&&(f=k,d=h)}}}return c.reverse()};const Co=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let i=0,h=d.prevNodes.length;i<h;i++){f=d.prevNodes[i],g=f.logicDirTo(d);if(g!==e)break}e=g,d=f}}return c.reverse()};const Fo=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let i=0,h=d.prevNodes.length;i<h;i++){f=d.prevNodes[i],g=f.logicDirTo(d);if(g===e)break}e=g,d=f}}return c.reverse()};let tc={};tc[Ca.astar]=Jf;tc[Ca["astar-line"]]=Jf;tc[Ca["astar-random"]]=Jf;tc[Ca.random]=Eo;tc[Ca.line]=Do;tc[Ca.diagonal]=Co;tc[Ca.straight]=Fo;class kl{constructor(){this.prevNodes=[]}shutdown(){this.key=void 0,this.prevNodes.length=0}destroy(){this.shutdown()}reset(a){this.key=a,this.f=0,this.g=0,this.h=void 0,this.closerH=void 0,this.visited=!1,this.closed=!1}heuristic(a,b,c){if(b===null)return 0;let d,e=this.distanceTo(a)*this.manager.weight;switch(b){case Ca.astar:d=e;break;case Ca["astar-line"]:if(c!==void 0){let f=a.angleTo(c)-this.angleTo(c);d=e+Math.abs(f)}else d=e;case Ca["astar-random"]:d=e+Math.random();break;default:d=e;break}return d}getNextNodes(){return[]}getCost(a){return gc}distanceTo(a){return 0}angleTo(a){return 0}logicDirTo(a){return 0}getNode(a,b=!1){return this.manager.getNode(a,b)}}function hc(a){for(let b=a.length-1;b>0;b--){let c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a}class kq extends kl{constructor(a){super();this.isTileXYZ=!0;this.pathFinder=a}reset(a){super.reset(a),this.key=a,ll(a,this),this._px=void 0,this._py=void 0,this.cost=void 0}getNextNodes(){let a=bc.GetNeighborTileXY(this.board,this);this.pathFinder.shuffleNeighbors&&hc(a);let b=[];return a.forEach(c=>{let d=this.getNode(Wa(c.x,c.y),!0);b.push(d)}),b}getCost(a){return this.pathFinder.cacheCost?this.cost===void 0&&(this.cost=this.pathFinder.getCost(this,a)):this.cost=this.pathFinder.getCost(this,a),this.cost}distanceTo(a){return $a.GetDistance(this.board,this,a,!0)}angleTo(a){return ec(this.worldX,this.wroldY,a.worldX,a.worldX)}logicDirTo(a){return bc.GetNeighborTileDirection(this.board,this,a)}get board(){return this.pathFinder.board}get worldX(){if(this._px===void 0){let a=Eb.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._px}get wroldY(){if(this._py===void 0){let a=Eb.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._py}}class fq{constructor(){this.data=[];this.visited=new Set()}push(a,b){if(Array.isArray(a)){let d=a;for(let e=0,f=d.length;e<f;e++)this.push(d[e]);return this}if(typeof a==="object"){let d=a;a=d.x,b=d.y}let c=`${a},${b}`;return this.visited.has(c)?this:(this.data.push({x:a,y:b}),this.visited.add(c),this)}pop(){return this.data.pop()}get length(){return this.data.length}clear(){return this.data.length=0,this.visited.clear(),this}}let b1=new fq();var Ce;(function(a){a[a.direction=0]="direction",a[a.angle=1]="angle"})(Ce||(Ce={}));function Zi(a,b){return a.events.delete(b),a}function Yi(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);let e=d.size;for(const f of d){f.callback.apply(f.context,c),f.once&&d.delete(f),e--;if(e===0)break}return d.size===0&&a.events.delete(b),!0}class Md{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function $i(a){return[...a.events.keys()]}function _i(a,b){const c=a.events.get(b);return c?c.size:0}function aj(a,b){const c=[],d=a.events.get(b);return d.forEach(e=>{c.push(e.callback)}),c}function Xi(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof Md)g.delete(c);else{const i=!d,h=e!==void 0;for(const k of g)k.callback===c&&(i&&k.context===d)&&(h&&k.once===e)&&g.delete(k)}return g.size===0&&f.delete(b),a}function Ld(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new Md(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function Wi(a,b,c,d=a){return Ld(a,b,c,d,!0)}function Lf(a,b){b?a.events.delete(b):a.events.clear()}function Lo(a){return class extends a{constructor(){super(...arguments);this.events=null}setEventEmitter(b){return this.destroyEventEmitter(),this.privateEE=b===void 0,this.privateEE?this.events=new Map():b?this.events=b.events:this.events=null,this.lastEventInstance=null,this}getEventEmitter(){return this}clearEventEmitter(){return this.setEventEmitter(null),this}destroyEventEmitter(){return this.lastEventInstance=null,this.events&&this.privateEE&&(Lf(this),this.events=null),this}on(b,c,d=this,e=!1){return this.lastEventInstance=null,this.events&&(this.lastEventInstance=Ld(this,b,c,d,e)),this}once(b,c,d=this){return this.lastEventInstance=null,this.events&&(this.lastEventInstance=Wi(this,b,c,d)),this}off(b,c,d,e){return this.lastEventInstance=null,this.events&&Xi(this,b,c,d,e),this}emit(b,...c){return this.lastEventInstance=null,this.events&&Yi(this,b,...c),this}removeAllListeners(b){return this.lastEventInstance=null,this.events&&Lf(this,b),this}clearEvent(b){return this.lastEventInstance=null,this.events&&Zi(this,b),this}getListenerCount(b){return this.lastEventInstance=null,this.events?_i(this,b):0}getEventNames(){return this.lastEventInstance=null,this.events?$i(this):[]}getListeners(b){return this.lastEventInstance=null,this.events?aj(this,b):[]}}}const va=Lo(class{});var lb;(function(a){a[a.no=0]="no",a[a.lazy=1]="lazy",a[a.always=2]="always"})(lb||(lb={}));const cj="complete";class Hf extends va{constructor(a,{eventEmitter:b,tickingMode:c=lb.lazy}={}){super();this._isRunning=!1;this.tickingState=!1;this.parent=a,this.setEventEmitter(b),this.setTickingMode(c)}boot(){this.tickingMode===lb.always&&!this.tickingState&&this.startTicking()}shutdown(){this.destroyEventEmitter(),this.tickingState&&this.stopTicking()}setTickingMode(a){typeof a==="string"&&(a=lb[a]),this.tickingMode=a}startTicking(){this.tickingState=!0}stopTicking(){this.tickingState=!1}get isRunning(){return this._isRunning}set isRunning(a){if(this._isRunning===a)return;this._isRunning=a,this.tickingMode===lb.lazy&&a!=this.tickingState&&(a?this.startTicking():this.stopTicking())}start(){return this.isRunning=!0,this}pause(){return this.isRunning=!1,this}resume(){return this.isRunning=!0,this}stop(){return this.isRunning=!1,this}complete(a=cj){this.isRunning=!1,this.emit(a,this.parent,this)}}class Ff extends Hf{constructor(a,{updater:b=a,isRunning:c=!1,timeScale:d=1,now:e=0,tickingMode:f=lb.lazy}={}){super(a,arguments[1]);this.updater=null;this.timeScale=1;this.now=0;this.parent=a,this.setUpdater(b),this.isRunning=c,this.timeScale=d,this.now=e,this.setTickingMode(f),this.boot()}resetFromJSON({isRunning:a=!1,timeScale:b=1,now:c=0,tickingMode:d=lb.lazy}={}){return this.isRunning=a,this.timeScale=b,this.now=c,this.setTickingMode(d),this}toJSON(){return{isRunning:this.isRunning,timeScale:this.timeScale,now:this.now,tickingMode:this.tickingMode}}boot(){super.boot(),Ya(this.parent,"destroy",this.destroy,this)}shutdown(){super.shutdown(),this.parent=void 0,this.updater=void 0}destroy(){this.shutdown()}setUpdater(a){return a instanceof qb&&(a=a.world),a instanceof Od||a instanceof Yb?this.updater=a:this.updater=null,this}startTicking(){this.update===null&&this.setUpdater(this.parent);if(this.update===null)return;super.startTicking(),this.updater&&Ya(this.updater,"update",this.update,this)}stopTicking(){super.stopTicking(),this.updater&&pb(this.updater,"update",this.update,this)}start(a=0){return this.now=a,super.start(),this}seek(a){return this.now=a,this}update(a){return!this.isRunning||this.timeScale===0?this:(this.now+=a*this.timeScale,this)}}const Gqa=Ka(wg());const Vg="receive";const nl={receive:Vg};function ol(a,b){(!a.sendToRef||a.sendToRef.key!==a.receiverID)&&(a.sendToRef=a.database.ref(a.rootPath).child(a.receiverID));if(b===void 0)return a.sendToRef.remove();let c={message:b,senderID:a.userID,stamp:a.stamp};return a.userName!==void 0&&(c.senderName=a.userName),a.skipFirst=!1,a.stamp=!a.stamp,a.sendToRef.set(c)}function pl(a){if(a.isReceiving&&a.receiverRef.key===a.receiverID)return;Ug(a),a.isReceiving=!0,a.skipFirst=!0,a.receiverRef=a.database.ref(a.rootPath).child(a.receiverID),a.receiverRef.on("value",rl,a),a.receiverRef.onDisconnect().remove()}function Ug(a){if(!a.isReceiving)return;a.isReceiving=!1,a.receiverRef.off("value",rl,a),a.receiverRef.remove(),a.receiverRef.onDisconnect().cancel()}function rl(a){if(this.skipFirst){this.skipFirst=!1;return}let b=a.val();if(b==null)return;delete b.stamp,this.history.add(b),this.emit(this.eventNames.receive,b)}class ql{constructor({maxLength:a=-1}={}){this.maxLength=a,this.records=[]}add(a){return this.maxLength===0?this:(this.records.push(a),this.maxLength>0&&this.records.length>this.maxLength&&this.records.shift(),this)}clear(){return this.records.length=0,this}changeUserName(a,b){return this.maxLength===0?this:(this.records.forEach(c=>{c.senderID===a&&(c.senderName=b)}),this)}}const g4=Ka(Qa());class Jc extends va{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d,receiverID:e="",history:f=0,eventNames:g=nl}={}){super();this.setEventEmitter(a),this.eventNames=g,this.database=g4.database(),this.setRootPath(b),this.skipFirst=!0,this.stamp=!1,this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.isReceiving=!1,f===!0?f=-1:f===!1&&(f=0),this.history=new ql({maxLength:f})}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.sendToRef=void 0,this.receiverRef=void 0,this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.receiverID=a,this}changeUserName(a,b){return a===this.userID&&(this.userName=b),this.history.changeUserName(a,b),this}getHistory(){return this.history.records}clearHistory(){return this.history.clear(),this}send(a){return ol(this,a)}startReceiving(){return pl(this),this}stopReceiving(){return Ug(this),this}}const Kr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function Xe(a,b,c=Kr){let d=b===void 0?a:gd(a,b),e="";for(let f=0;f<d;f++)e+=Fc(Array.from(c));return e}const sca=Ka(Qa());var sa;(function(a){a[a["1d"]=1]="1d",a[a["2d"]=2]="2d",a[a["3d"]=3]="3d"})(sa||(sa={}));const ah="init";const bh="update";const Wg="addkey0";const Xg="addkey1";const Yg="addkey2";const ch="removekey0";const dh="removekey1";const eh="removekey2";const Zg="changekey0";const _g="changekey1";const $g="changekey2";const sl={init:ah,update:bh,addkey0:Wg,removekey0:ch,changekey0:Zg,addkey1:Xg,removekey1:dh,changekey1:_g,addkey2:Yg,removekey2:eh,changekey2:$g};function Oo(a){return a==null||a===""||a.length===0}function Jr(a,b,c={}){let d=a;if(!Oo(b)){typeof b==="string"&&(b=b.split("."));let e;for(let f=0,g=b.length;f<g;f++){e=b[f];if(d[e]==null||typeof d[e]!=="object"){let i;f===g-1?i=c:i={},d[e]=i}d=d[e]}}return d}function Po(a,b,c){if(typeof a!=="object")return;if(Oo(b)){if(c==null)return;typeof c==="object"&&(a=c)}else{typeof b==="string"&&(b=b.split("."));let d=b.pop(),e=Jr(a,b);e[d]=c}return a}function No(a){return JSON.parse(JSON.stringify(a))}class tl{constructor(){this.data={}}setValue(a,b){return a==null?this.clear():typeof a==="object"?this.data=a:Po(this.data,a,b),this}getValue(a){if(a==null)return this.data;{typeof a==="string"&&(a=a.split("."));let b=this.data;for(let c=0,d=a.length;c<d;c++){if(!bj(b))return;b=b[a[c]]}return b}}cloneValue(a){return No(this.getValue(a))}removeKey(a){if(a==null)this.clear();else{typeof a==="string"&&(a=a.split("."));let b=a.pop(),c=this.data;for(let d=0,e=a.length;d<e;d++){if(!bj(c))return this;c=c[a[d]]}bj(c)&&delete c[b]}return this}clear(){return Mf(this.data),this}incValue(a,b=1){let c=this.getValue(a);return typeof c!=="number"&&(c=0),this.setValue(a,c+b),this}mulValue(a,b){let c=this.getValue(a);return typeof c!=="number"&&(c=1),this.setValue(a,c*b),this}}function bj(a){return a!=null&&typeof a==="object"}const x5=Ka(Qa());class ic extends va{constructor({eventEmitter:a,parent:b,key:c,type:d,eventNames:e,table:f}={}){super();this.setEventEmitter(a),this.parent=b,this.children=new Map(),this.key=c,this.parent?this.fullKeyPath=Dl(this.parent.fullKeyPath,this.key):this.fullKeyPath="",this.type=d,this.eventNames=e,this.table=f,this.database=x5.database(),this.setRootPath()}destroy(){this.stopUpdate().clear().destroyEventEmitter()}setRootPath(a){if(a===void 0){let b=this.parent?this.parent.rootPath:"";a=`${b}/${this.key}`}this.rootPath=a,this.rootRef=a!==""?this.database.ref(a):void 0;for(const[b,c]of this.children)c instanceof ic&&c.setRootPath();return this}setData(a,b){if(arguments.length===0)this.clear();else if(typeof a=="string")this.setChildData(a,b);else{let c=a;for(const[d,e]of this.children)c.hasOwnProperty(d)||this.removeChild(d);for(let d in c)this.setChildData(d,c[d])}return this}clear(){this.table.removeKey(this.fullKeyPath);for(const[a,b]of this.children)this.removeChild(a);return this}get childClass(){return null}setChildData(a,b){const c=Dl(this.fullKeyPath,a);this.table.setValue(c,b);if(!(typeof b!=="object")){if(this.children.has(a))this.children.get(a).setData(b);else if(this.childClass){let d=new this.childClass({parent:this,key:a,type:this.type,eventEmitter:this.eventEmitter,eventNames:this.eventNames,table:this.table});d.startUpdate(),this.children.set(a,d)}}return this}removeChild(a){return this.children.has(a)&&(this.children.get(a).destroy(),this.children.delete(a)),this}startUpdate(){return this}stopUpdate(){return this}}function Dl(a,b){return a==null||a===""?b:b==null||b===""?a:`${a}.${b}`}class kd extends ic{startUpdate(){return this.rootRef.on("child_added",this.addCol,this),this.rootRef.on("child_removed",this.removeCol,this),this.rootRef.on("child_changed",this.changeColValue,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addCol,this),this.rootRef.off("child_removed",this.removeCol,this),this.rootRef.off("child_changed",this.changeColValue,this),this}addCol(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case sa["1d"]:this.emit(this.eventNames.addkey0,b,c);break;case sa["2d"]:this.emit(this.eventNames.addkey1,this.key,b,c);break;default:this.emit(this.eventNames.addkey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}removeCol(a){const b=a.key;this.removeChild(b);switch(this.type){case sa["1d"]:this.emit(this.eventNames.removekey0,b);break;case sa["2d"]:this.emit(this.eventNames.removekey1,this.key,b);break;default:this.emit(this.eventNames.removekey2,this.pageKey,this.key,b);break}this.emit(this.eventNames.update,this.table.data)}changeColValue(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case sa["1d"]:this.emit(this.eventNames.changekey0,b,c);break;case sa["2d"]:this.emit(this.eventNames.changekey1,this.key,b,c);break;default:this.emit(this.eventNames.changekey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}get pageKey(){return this.parent.key}}class ld extends ic{startUpdate(){return this.rootRef.on("child_added",this.addRow,this),this.rootRef.on("child_removed",this.removeRow,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addRow,this),this.rootRef.off("child_removed",this.removeRow,this),this}addRow(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case sa["2d"]:this.emit(this.eventNames.addkey0,b,c);break;default:this.emit(this.eventNames.addkey1,this.key,b,c);break}}removeRow(a){const b=a.key;this.removeChild(b);switch(this.type){case sa["2d"]:this.emit(this.eventNames.removekey0,b);break;default:this.emit(this.eventNames.removekey1,this.key,b);break}}get childClass(){return kd}}class fh extends ic{startUpdate(){return this.rootRef.on("child_added",this.addPage,this),this.rootRef.on("child_removed",this.removePage,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addPage,this),this.rootRef.off("child_removed",this.removePage,this),this}addPage(a){const b=a.key,c=a.val();this.setData(b,c),this.emit(this.eventNames.addkey0,b,c)}removePage(a){const b=a.key;this.removeChild(b),this.emit(this.eventNames.removekey0,b)}get childClass(){return ld}}const Te={};Te[sa["1d"]]=kd;Te[sa["2d"]]=ld;Te[sa["3d"]]=fh;function ul(a){return new Te[a.tableType]({type:a.tableType,eventEmitter:a.eventEmitter,eventNames:a.eventNames,table:a.table})}function vl(a){return a.updater.clear(),a.initialFlag=!1,a.rootRef.once("value").then(function(b){let c=b.val()??{};return a.table.setValue(c),a.emit(a.eventNames.init,c),a.initialFlag=!0,Promise.resolve(c)})}function Ja(a,b,c,d){let e=a.rootRef;return e=b?e.child(b):e,e=c?e.child(c):e,e=d?e.child(d):e,e}function wl(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ja(a,c,d,e).set(f)}function xl(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;default:c=b[0];break}return Ja(a,c,d,e).remove()}function yl(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ja(a,c,d,e).transaction(function(g){return g===null&&(g=0),g+f})}function zl(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ja(a,c,d,e).transaction(f)}function Al(a,b){return Ja(a).update(b)}function Bl(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;case 1:c=b[0];break}return Ja(a,c,d,e).onDisconnect().remove()}function Cl(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ja(a,c,d,e).onDisconnect().set(f)}const A4=Ka(Qa());class Kc extends va{constructor({eventEmitter:a,root:b="",type:c=sa["3d"],eventNames:d=sl}={}){super();this.setEventEmitter(a),this.eventNames=d,this.database=A4.database(),this.table=new tl(),this.setTableType(c),this.setRootPath(b),this.initialFlag=!1}destroy(){this.updater.destroy(),this.destroyEventEmitter().stopUpdate()}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):null,this.updater.setRootPath(a),this}setTableType(a){return typeof a==="string"&&(a=sa[a]),this.tableType=a,this.updater&&this.updater.destroy(),this.updater=ul(this),this}startUpdate(){return vl(this),this.updater.startUpdate(),this}stopUpdate(){return this.updater.stopUpdate(),this}clear(){return this.updater.clear(),this}getData(){return this.table.getValue(...arguments)}cloneData(){return this.table.cloneValue(...arguments)}getItemRef(a,b,c){return Ja(this,a,b,c)}setData(...a){return wl(this,...a)}removeData(...a){return xl(this,...a)}incValue(...a){return yl(this,...a)}transaction(...a){return zl(this,...a)}updateData(a){return Al(this,a)}removeDataOnDisconnect(...a){return Bl(this,...a)}setDataOnDisconnect(...a){return Cl(this,...a)}}const Cba=Ka(Qa());var di;(function(a){a.d="d",a.w="w",a.m="m",a.y="y",a.day="d",a.week="w",a.month="m",a.year="y"})(di||(di={}));var td;(function(a){a.d="tagD",a.w="tagW",a.m="tagM",a.y="tagY"})(td||(td={}));var ud;(function(a){a.d="scoreD",a.w="scoreW",a.m="scoreM",a.y="scoreY"})(ud||(ud={}));var Lm;(function(a){a.d="day",a.w="week",a.m="month",a.y="year"})(Lm||(Lm={}));function hi({query:a,totalLines:b=Infinity,linesPerPage:c=1e3,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g}){return bn({query:a,remainderLines:b,linesPerPage:c,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g})}function bn(a){let b=a.query;a.startDocRef&&(b=b[a.startMode](a.startDocRef));let c=Math.min(a.remainderLines,a.linesPerPage);return a.remainderLines-=c,b.limit(c).get().then(function(d){let e=a.remainderLines===0||d.size<c,f=!1;a.forEachPageCallback&&(f=a.forEachPageCallback(d)||!1),e=e||f;if(e){let g;return a.resolveCallback&&(g=a.resolveCallback()),Promise.resolve(g)}else return a.startDocRef=d.docs[d.size-1],a.startMode="startAfter",bn(a)})}function Oa(a,b=Infinity,c=0,d,e){let f=[],g=0;return hi({query:a,totalLines:c+b,startDocRef:d,startMode:e,forEachPageCallback:function(i){let h,k=i.size,n=c-g;n<=0?h=i.docs:n<k&&(h=i.docs.slice(n,k)),h&&f.push(...h),g+=k},resolveCallback:function(){return f}})}const Hea=Ka(Qa());function Um(a,b,c=0){return Oa(a.nextQuery,b,c,a.baselineDocRef,a.baselineMode).then(function(d){let e=d.length;return a.cacheItems=d,a.pageIndex=void 0,a.startItemIndex=c,a.endItemIndex=a.startItemIndex+e-1,a.isFullPage=b===void 0?!0:e===b,Promise.resolve(a.cacheItems)})}const fea=Ka(Qa());class kf{constructor({query:a={next:void 0,previous:void 0},itemCount:b=100,baselineDoc:c,baselineMode:d="startAt"}={}){this.setQuery(a),this.setItemCount(b),this.setBaselineDoc(c,d),this.pageIndex=void 0,this.baselineDocRef=void 0,this.baselineMode="startAt",this.startItemIndex=void 0,this.endItemIndex=void 0,this.cacheItems=void 0,this.isFullPage=void 0}setQuery(a,b){if(a instanceof fea.firestore.Query)this.nextQuery=a,this.prevQuery=b;else{var c=a;this.nextQuery=c.next,this.prevQuery=c.previous}return this.pageIndex=null,this.isFullPage=!0,this}setItemCount(a){return this.itemCount=a,this}setBaselineDoc(a,b){return a?(this.baselineDocRef=a.ref,this.baselineMode=b):this.baselineDocRef=void 0,this}load(a,b=0){return Um(this,a,b)}loadFirstPage(){return this._loadFirstPage()}loadNextPage(){return this.pageIndex==null?this._loadFirstPage():this._loadNextPage()}loadPreviousPage(){return this.pageIndex==null||this.pageIndex===1?this._loadFirstPage():this._loadPreviousPage()}loadCurrentPage(){return this.pageIndex==null||this.pageIndex===0?this._loadFirstPage():this._loadCurrentPage()}}function _m(a){return Oa(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=null,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function Vm(a){return Oa(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,Promise.resolve(a.cacheItems)})}function $m(a){return Oa(a.nextQuery,a.itemCount,0,a.currPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=a.currPageEndDocRef,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function Wm(a){let b=(a.pageIndex+1)*a.itemCount;return Oa(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function an(a){return Oa(a.prevQuery,a.itemCount+1,0,a.currPageStartDocRef,"startAfter").then(function(b){let c=b.length-1;return a.cacheItems=b,a.cacheItems.pop(),a.cacheItems.reverse(),a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-c+1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=b[c].ref,a.currPageStartDocRef=b[c-1].ref,a.currPageEndDocRef=b[0].ref,Promise.resolve(a.cacheItems)})}function Xm(a){let b=(a.pageIndex-1)*a.itemCount;return Oa(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-d+1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function Zm(a){return Oa(a.nextQuery,a.itemCount,0,a.prevPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function Ym(a){let b=a.pageIndex*a.itemCount;return Oa(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}class ei extends kf{_loadFirstPage(){return Vm(this)}_loadNextPage(){return Wm(this)}_loadPreviousPage(){return Xm(this)}_loadCurrentPage(){return Ym(this)}}const fda=Ka(Qa());class jf extends kf{_loadFirstPage(){return _m(this)}_loadNextPage(){return $m(this)}_loadPreviousPage(){return an(this)}_loadCurrentPage(){return Zm(this)}}const _da=Ka(Qa());function Nm(a,b){let c={senderID:a.userID,message:b,timestamp:_da.firestore.FieldValue.serverTimestamp()};return a.userName!==void 0&&(c.senderName=a.userName),a.receiverID!==void 0&&(c.receiverID=a.receiverID),a.rootRef.add(c)}function fi(a,b=a.receiverID){let c=a.rootRef;return c=b!==void 0?c.where("receiverID","==",b):c,c}function Mm(a,b=a.receiverID){let c=fi(a,b),d=c.orderBy("timestamp"),e=c.orderBy("timestamp","desc");return{next:d,previous:e}}const gi="receive";function Om(a){let b=fi(a).orderBy("timestamp","desc").limit(1);a.unsubscribe=b.onSnapshot({includeMetadataChanges:!0},function(c){if(c.size>0){let d=c.docs[0];if(d.metadata.hasPendingWrites){a.skipFirst&&(a.skipFirst=!1);return}Sm(a,a.receiverID,d);if(a.skipFirst)a.skipFirst=!1;else{let e=Tm(d);a.cacheMessages.push(e),a.emit(gi,e)}}else a.skipFirst&&(a.skipFirst=!1)},function(c){debugger})}function Pm(a){a.unsubscribe&&a.unsubscribe(),a.resetQueryFlag=!0,a.cacheMessages.length=0}function Qm(a){return Sm(a),a.page.loadNextPage().then(function(b){let c=[];for(let d=0,e=b.length;d<e;d++)c.push(Tm(b[d]));return a.cacheMessages.splice(0,0,...c),Promise.resolve(c)})}function Sm(a,b=a.receiverID,c){if(!a.resetQueryFlag)return;a.resetQueryFlag=!1;let d=a.skipFirst?"startAt":"startAfter";a.page.setBaselineDoc(c,d).setQuery(Mm(a,b));return}function Tm(a){let b=a.data();return b.timestamp=b.timestamp.toDate(),b}const Rda=Ka(Qa());class Rm extends va{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d="",receiverID:e,pageItemCount:f=100}={}){super();this.setEventEmitter(a),this.database=Rda.firestore(),this.setRootPath(b),this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.skipFirst=!0,this.unsubscribe=void 0,this.page=new jf(),this.setPageItemCount(f),this.resetQueryFlag=!0,this.cacheMessages=[]}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.resetQueryFlag=this.resetQueryFlag||this.rootPath!==a,this.rootPath=a,this.rootRef=this.database.collection(a),this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.resetQueryFlag=this.resetQueryFlag||this.receiverID!==a,this.receiverID=a,this}setPageItemCount(a){return this.page.setItemCount(a),this}get hasPreviousMessage(){return this.page.isFullPage!==!1}send(a){return Nm(this,a)}startReceiving(){return Om(this),this}stopReceiving(){return Pm(this),this}loadPreviousMessages(){return Qm(this)}}const jh="join";const kh="leave";const mh="init";const lh="update";const ih="changename";const hh="change";const Il={join:jh,leave:kh,update:lh,change:hh,init:mh,changename:ih};var vb;(function(a){a[a.once=0]="once",a[a.child=1]="child",a[a.all=2]="all"})(vb||(vb={}));const Wh="add";const Yh="remove";const Xh="change";const Zh="update";const Am={add:Wh,remove:Yh,update:Zh,change:Xh};function gf(a){a.items.length=0,a.itemID2Index.clear()}function Bm(a){return a.items}function Cm(a,b){return a.itemID2Index.has(b)}function Vh(a,b){return b==null?null:a.itemID2Index.get(b)}function Dm(a,b){if(b==null)return null;let c=Vh(a,b);return c==null?null:a.items[c]}function Em(a,b,c){a.items.forEach(b,c)}function Mb(a){a.itemID2Index.clear();let b=a.items;for(var c=0,d=b.length;c<d;c++){let e=b[c][a.keyItemID];a.itemID2Index.set(e,c)}}function Fm(a,b){if(b>=a.length)return;let c=a.length-1,d=a[b];for(let e=b;e<c;e++)a[e]=a[e+1];return a.length=c,d}function _h(a,b){let c=ai.call(this,a,b);Mb(this),this.emit(this.eventNames.add,c),this.emit(this.eventNames.update,this.items)}function rd(a,b){let c=Gm.call(this,a);Mb(this);let d=ai.call(this,a,b);Mb(this),this.emit(this.eventNames.change,d,c),this.emit(this.eventNames.update,this.items)}function $h(a){let b=Gm.call(this,a);Mb(this),this.emit(this.eventNames.remove,b),this.emit(this.eventNames.update,this.items)}function sd(a){gf(this),a.forEach(function(b){ai.call(this,b,null,!0)}.bind(this)),Mb(this),this.emit(this.eventNames.update,this.items)}function ai(a,b,c=!1){let d,e=this.getItemCallback,f=this.getItemCallbackScope;f?d=e.call(f,a):d=e(a);if(c)return this.items.push(d),d;if(b==null)this.items.unshift(d);else{let g=this.itemID2Index.get(b);g===this.items.length-1?this.items.push(d):this.items.splice(g+1,0,d)}return d}function Gm(a){let b=this.itemID2Index.get(a.key),c=Fm(this.items,b);return c}const Jm={start(a,b){a.isUpdating=!1,b.once("value",sd,a)},stop(a){}};const Im={start(a,b){b.on("child_added",_h,a),b.on("child_removed",$h,a),b.on("child_moved",rd,a),b.on("child_changed",rd,a)},stop(a){a.query.off("child_added",_h,a),a.query.off("child_removed",$h,a),a.query.off("child_moved",rd,a),a.query.off("child_changed",rd,a)}};const Hm={start(a,b){b.on("value",sd,a)},stop(a){a.query.off("value",sd,a)}};const qd={};qd[vb.all]=Hm;qd[vb.child]=Im;qd[vb.once]=Jm;class jc extends va{constructor({eventEmitter:a,itemIDKey:b="__itemID__",mode:c=vb.child,getItemCallback:d=Gq,getItemCallbackScope:e,query:f,eventNames:g=Am}={}){super();this.setEventEmitter(a),this.eventNames=g,this.isUpdating=!1,this.items=[],this.itemID2Index=new Map(),this.setItemIDKey(b),this.setMode(c),e===void 0&&(e=this),this.setGetitemCallback(d,e),this.setQuery(f)}destroy(){this.stopUpdate().clear()}setItemIDKey(a){return this.keyItemID=a,this}setMode(a){return typeof a==="string"&&(a=vb[a]),this.mode=a,this.updater=qd[a],this}setGetitemCallback(a,b){return this.getItemCallback=a,this.getItemCallbackScope=b,this}setQuery(a){return this.query=a,this}startUpdate(a){if(a)this.setQuery(a);else if(this.query)a=this.query;else return this;return this.stopUpdate().clear(),this.isUpdating=!0,this.updater.start(this,a),this}stopUpdate(){return!this.query||!this.isUpdating?this:(this.isUpdating=!1,this.updater.stop(this),this)}clear(){return gf(this),this}getItems(){return Bm(this)}hasItem(a){return Cm(this,a)}getItemIndexFromItemID(a){return Vh(this,a)}getItemFromItemID(a){return Dm(this,a)}forEach(a,b){return Em(this,a,b),this}updateItemID2Index(){return Mb(this),this}}const Gq=function(a){let b=a.val();return b[this.keyItemID]=a.key,b};function Ib(a,b=a.userID){return a.userID2ItemID.has(b)}function Ue(a,b=a.userID){if(!Ib(a,b))return null;let c=a.userID2ItemID.get(b);return a.rootRef.child(c)}function Jl(a,b=a.userID){if(!Ib(a,b))return null;let c=a.userID2ItemID.get(b);return a.userList.getItemFromItemID(c)}function gh(a){return a.userList.getItems()}function Kl(a){a.userList.clear()}function Ll(a,b,c){a.userList.forEach(b,c)}function Ml(a,b=a.userID){let c=a.userList.getItems()[0];return c&&c.userID===b}function Nl(a){return a.maxUsers===0?!1:a.userList.getItems().length>=a.maxUsers}function Fl(a=0,b){return new Promise(function(c,d){setTimeout(function(){c(b)},a)})}function Gl(a,b=a.userID,c=a.userName){if(Ib(a,b))return Promise.resolve();let d={userID:b,userName:c},e=a.maxUsers,f=a.database.ref(a.rootPath),g=f.push();return g.onDisconnect().remove().then(function(){return g.set(d)}).then(function(){return Fl(0)}).then(function(){return e===0?(a.isInList=!0,Promise.resolve()):f.limitToFirst(e).once("value").then(function(i){return uq(i,b)?(a.isInList=!0,Promise.resolve()):(a.isInList=!1,g.remove().then(function(){return g.onDisconnect().cancel()}).then(function(){return Promise.reject()}))})})}function uq(a,b){let c=!1;return a.forEach(function(d){let e=d.val();if(e.userID===b)return c=!0,!0}),c}function Hl(a,b=a.userID){if(!Ib(a,b))return Promise.resolve();let c=a.userID2ItemID.get(b),d=a.database.ref(a.rootPath).child(c);return d.remove()}function El(a,b){return new Promise(function(c,d){let e=Ue(a);if(e)return c(e);{let f=a.rootRef.orderByChild("userID").equalTo(a.userID);f.once("child_added").then(function(g){return c(g.ref)})}}).then(function(c){return c.child("userName").set(b)}).then(function(){return a.userName=b,Promise.resolve()})}const h6=Ka(Qa());class Lc extends va{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,eventNames:f=Il}={}){super();this.setEventEmitter(a),this.eventNames=f,this.database=h6.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.setMaxUsers(e),this.userList=new jc({eventEmitter:this.eventEmitter,itemIDKey:"joinAt",eventNames:{add:f.join,remove:f.leave,update:f.update,change:f.change}}),this.isInList=!1,this.userID2ItemID=new Map(),this.userList.on(this.eventNames.join,function(g){this.userID2ItemID.set(g.userID,g.joinAt),g.userID===this.userInfo.userID&&this.emit(this.eventNames.init,gh(this))},this).on(this.eventNames.leave,function(g){this.userID2ItemID.delete(g.userID),g.userID===this.userID&&(this.isInList=!1)},this).on(this.eventNames.change,function(g,i){let h=g.userID,k=g.userName,n=i.userName;k!==n&&this.emit(this.eventNames.changename,h,k,n)},this)}destroy(){this.stopUpdate().destroyEventEmitter().leave(),this.userList.destroy()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setMaxUsers(a){return this.maxUsers=a,this}clear(){return Kl(this),this}forEach(a,b){return Ll(this,a,b),this}isFull(){return Nl(this)}isFirstUser(a=this.userID){return Ml(this,a)}getUser(a=this.userID){return Jl(this,a)}getUsers(){return gh(this)}getUserRef(a=this.userID){return Ue(this,a)}contains(a=this.userID){return Ib(this,a)}join(a=this.userID,b=this.userName){return Gl(this,a,b)}leave(a=this.userID){return Hl(this,a)}changeUserName(a){return El(this,a)}startUpdate(){let a=this.rootRef;return this.maxUsers>0&&(a=a.limitToFirst(this.maxUsers)),this.userList.startUpdate(a),this}stopUpdate(){return this.userList.stopUpdate(),this}}const kc="room.join";const Kb="room.leave";const Ch="userlist.join";const Dh="userlist.leave";const Fh="userlist.init";const Eh="userlist.update";const nd="userlist.changename";const nh="broadcast.receive";function rh(a){return`tables.${a}.init`}function sh(a){return`tables.${a}.update`}function th(a){return`tables.${a}.addkey0`}function uh(a){return`tables.${a}.addkey1`}function vh(a){return`tables.${a}.addkey2`}function wh(a){return`tables.${a}.removekey0`}function xh(a){return`tables.${a}.removekey1`}function yh(a){return`tables.${a}.removekey2`}function zh(a){return`tables.${a}.changekey0`}function Ah(a){return`tables.${a}.changekey1`}function Bh(a){return`tables.${a}.changekey2`}const oh="roomlist.add";const ph="roomlist.remove";const qh="roomlist.update";function _l(a){const b=new Lc({eventEmitter:a.eventEmitter,eventNames:{join:Ch,leave:Dh,update:Eh,change:"userlist.change",init:Fh,changename:nd},userID:a.userInfo});return b.on("userlist.leave",function(c){c.userID===a.userID&&zq(a)}),a.on(kc,function(){b.startUpdate()}).on(Kb,function(){b.stopUpdate().clear()}),b}function zq(a){a.emit(Kb),setTimeout(function(){a.roomID=void 0,a.roomName=void 0,a.doorState=void 0,a.leftRoomFlag=!1},0)}function Xl(a){const b=new jc({eventEmitter:a.eventEmitter,itemIDKey:"roomID",eventNames:{update:qh,add:oh,remove:ph,change:"roomlist.change"},mode:"once"});return b}function fm(a){return a.split("|")[0]}function em(a){return a.split("|")[1]}function Mc(a,b=""){return`${a}|${b}`}function hb(a,b){let c=a.rootRef;return b&&(c=c.child(b)),c}function od(a,b,c){let d=hb(a,"rooms");return b!==void 0&&(d=d.child(b),c!==void 0&&(d=d.child(c))),d}function Wl(a,b){return od(a,b,"alive")}function $l(a,b){return od(a,b,"users")}function md(a,b){let c=hb(a,"room-filters");return b!==void 0&&(c=c.child(b)),c}function Nc(a,b){let c=hb(a,"room-metadata");return b!==void 0&&(c=c.child(b)),c}function We(a,b,c){let d=`${a.rootPath}/rooms/${b}`;return c&&(d+=`/${c}`),d}function Ze(a,b){return We(a,b,"users")}function Yl(a,b,c){let d=We(a,b,"tables");return c&&(d+=`/${c}`),d}function am(a,b,c="open"){let d=md(a);return d=d.orderByChild("filter"),b===void 0?d=d.startAt(c).endAt(`${c}~`):d=d.equalTo(Mc(c,b)),d}function Tl(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new Jc({eventEmitter:a.eventEmitter,eventNames:{receive:nh},receiverID:"boradcast",senderID:a.userInfo,history:b.history});return a.on(kc,function(d){c.setRootPath(We(a,d.roomID)).startReceiving()}).on(Kb,function(){c.stopReceiving()}).on(nd,function(d,e){c.changeUserName(d,e)}),c}function Zl(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,yq(a,d))}),a.on(kc,function(d){for(const[e,f]of c)f.setRootPath(Yl(a,d.roomID,e)).startUpdate()}).on(Kb,function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function yq(a,{key:b,type:c=sa["1d"]}){const d=new Kc({eventEmitter:a.eventEmitter,type:c,eventNames:{init:rh(b),update:sh(b),addkey0:th(b),removekey0:wh(b),changekey0:zh(b),addkey1:uh(b),removekey1:xh(b),changekey1:Ah(b),addkey2:vh(b),removekey2:yh(b),changekey2:Bh(b)}});return d}function Va(a,b=a.roomID,c=a.roomName){return{roomID:b,roomName:c}}function bf(a,b){return b===void 0?a.roomID!==void 0:a.roomID===b}function im(a){return a.userList.isFull()}function jm(a,b=a.userID){return a.userList.isFirstUser(b)}function km(a){return a.userList.getUsers()}function _e(a,b,c,d){a.roomID=b,a.roomName=c,a.roomType=d,a.emit("room.join",Va(a))}function Ye(a,b={}){return b.roomID==null&&(b.roomID=od(a).push().key),wq(a,b.roomID).then(function(){return xq(a,b)})}function wq(a,b){return Wl(a,b).transaction(function(c){return c===null?!0:void 0})}function xq(a,{roomID:b,roomName:c="",roomType:d="",maxUsers:e=0,presisted:f=!1,door:g="open",join:i=!0,filterData:h}){let k=od(a,b),n=md(a,b),o=Nc(a,b);a.isRemoveRoomWhenLeft=!f,a.isRemoveRoomWhenLeft&&(k.onDisconnect().remove(),n.onDisconnect().remove(),o.onDisconnect().remove());const s=Mc(g,d),u={},v={filter:s,name:c};h&&(v.data=h),u[`room-filters/${b}`]=v;const y={name:c,filter:s,maxUsers:e,moderators:{}};return y.moderators[a.userID]=a.userName,u[`room-metadata/${b}`]=y,new Promise(function(G,K){if(i){const J=a.userList.setRootPath(Ze(a,b)).setMaxUsers(0).join();return a.userList.setMaxUsers(e),J.then(G,K)}else return G()}).then(function(){return hb(a).update(u)}).then(function(){return a.isRoomCreator=!0,i&&_e(a,b,c,d),Promise.resolve(Va(a))})}function Ul(a,{digits:b=10,candidates:c="0123456789",retry:d=1e3}){let e=arguments[1];return Vl(a,b,c,d,e)}function Vl(a,b,c,d,e){return e.roomID=Xe(b,b,c),d<=0?Promise.reject(e):(d--,Ye(a,e).catch(function(){return Vl(a,b,c,d,e)}))}function cf(a,b=a.roomID){const c={};c[`room-filter/${b}`]=null,c[`room-metadata/${b}`]=null,c[`rooms/${b}`]=null;const d=Va(a);return hb(a).update(c).then(function(){return Promise.resolve(d)})}function Oc(a){if(!bf(a))return Promise.resolve(Va(a));a.leftRoomFlag=!0;if(a.isRemoveRoomWhenLeft)return cf(a);{const b=Va(a);return a.userList.leave().then(function(){return Promise.resolve(b)})}}function af(a,{leftThenJoin:b=!0,roomID:c}){return b?Oc(a).then(function(){return gm(a,c)}):gm(a,c)}function gm(a,b){return b==null?Promise.reject(Va(a,b,"")):(a.isRemoveRoomWhenLeft=!1,Aq(a,b).then(function(c){return a.userList.setRootPath(Ze(a,b)).setMaxUsers(c.maxUsers).join().then(function(){return Promise.resolve(c)})}).then(function(c){return _e(a,b,c.name,em(c.filter)),Promise.resolve(Va(a))}))}function Aq(a,b){return Nc(a,b).once("value").then(function(c){let d=c.val();return Bq(a,d)?Promise.resolve(d):Promise.reject()})}function Bq(a,b){if(b==null)return!1;if(fm(b.filter)==="closed")return!1;const c=a.userID;if(b.moderators[c])return!0;switch(b.permission){case"blocklist":const d=b.blocklist;return!(d&&d[c]);case"allowlist":const e=b.allowlist;return e&&e[c];default:return!0}}function $e(a,b,c){return new Promise(function(d,e){a.roomList.once("roomlist.update",function(f){d(f)}).startUpdate(am(a,b,c))})}function cm(a,{roomType:b="",leftThenJoin:c=!0}={}){return $e(a,b,"open").then(function(d){if(d.length===0)return Promise.reject("No filtered room");hc(d);const e={leftThenJoin:c,roomID:""};return dm(a,e,d)})}function dm(a,b,c,d=0){return d===c.length?Promise.reject("Can't join any room"):(b.roomID=c[d].roomID,d++,af(a,b).catch(function(){return dm(a,b,c,d)}))}function hm(a,b){return a.userList.contains(b)?b===a.userID?Oc(a):a.userList.leave(b):Promise.resolve()}function Jb(a,b){return b===a.roomID?Promise.resolve(!0):Nc(a,b).once("value").then(function(c){const d=c.val()!==null;return Promise.resolve(d)})}function Ve(a,b,c=a.roomID){return Jb(a,c).then(function(d){if(!d)return Promise.resolve();const e=Mc(b,a.roomType),f={};return f[`room-filters/${c}/filter`]=e,f[`room-metadata/${c}/filter`]=e,hb(a).update(f)})}function Ql(a,b=a.roomID){return Ve(a,"open",b)}function Rl(a,b=a.roomID){return Ve(a,"closed",b)}function Ol(a,b,c=a.roomID){return Jb(a,c).then(function(d){return d?md(a,c).child("data").update(b):Promise.resolve()})}function Sl(a,b){return a.userList.changeUserName(b)}function Pl(a,b,c=a.roomID){return Jb(a,c).then(function(d){if(!d)return Promise.resolve();const e={};return e[`room-filters/${c}/name`]=b,e[`room-metadata/${c}/name`]=b,hb(a).update(e)})}function bm(a,b=a.roomID){return b===a.roomID?a.userList.getUsers():new Promise(function(c,d){const e=new jc({itemIDKey:"joinAt",mode:"once"});e.once("update",function(f){c(f)}).startUpdate($l(a,b))})}const U7=Ka(Qa());class lm extends va{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",broadcast:e=!0,tables:f=!1}={}){super();this.setEventEmitter(a),this.database=U7.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.isRoomCreator=!1,this.roomID=void 0,this.roomName=void 0,this.roomType=void 0,this.doorState=void 0,this.leftRoomFlag=!1,this.isRemoveRoomWhenLeft=void 0,this.userList=_l(this),this.roomList=Xl(this),this.broadcast=Tl(this,e),this.tables=Zl(this,f)}destroy(){var a=this;this.destroyEventEmitter().leaveRoom().then(function(){a.userList.destroy(),a.userList=void 0,a.roomList.destroy(),a.roomList=void 0,a.broadcast.destroy(),a.broadcast=void 0})}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}getRoomInfo(a,b){return Va(this,a,b)}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(a){return bf(this,a)}isFull(){return im(this)}isFirstUser(a=this.userID){return jm(this,a)}getUsers(){return km(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}createRoom(a){return Ye(this,a)}createRandomRoom(a={}){return Ul(this,a)}joinRoom(a){return af(this,a)}joinRandomRoom(a={}){return cm(this,a)}leaveRoom(){return Oc(this)}removeRoom(a=this.roomID){return cf(this,a)}kickUser(a){return hm(this,a)}changeRoomState(a,b=this.roomID){return Ve(this,a,b)}openRoom(a=this.roomID){return Ql(this,a)}closeRoom(a=this.roomID){return Rl(this,a)}changeUserName(a){return Sl(this,a)}changeFilterData(a,b=this.roomID){return Ol(this,a,b)}changeRoomName(a,b,c=a.roomID){return Pl(this,b,c)}getUserList(a=this.roomID){return bm(this,a)}getRoomList(a,b){return $e(this,a,b)}HasRoom(a){return Jb(this,a)}}function sm(a,b){let c=a.rootPath;return b&&(c+=`/${b}`),c}function qm(a){return sm(a,"users")}function om(a,b){return`${sm(a,"tables")}/${b}`}const ub="room.join";const Lb="room.leave";const Sh="userlist.join";const df="userlist.leave";const Uh="userlist.init";const Th="userlist.update";const pd="userlist.changename";const Gh="broadcast.receive";function Hh(a){return`tables.${a}.init`}function Ih(a){return`tables.${a}.update`}function Jh(a){return`tables.${a}.addkey0`}function Kh(a){return`tables.${a}.addkey1`}function Lh(a){return`tables.${a}.addkey2`}function Mh(a){return`tables.${a}.removekey0`}function Nh(a){return`tables.${a}.removekey1`}function Oh(a){return`tables.${a}.removekey2`}function Ph(a){return`tables.${a}.changekey0`}function Qh(a){return`tables.${a}.changekey1`}function Rh(a){return`tables.${a}.changekey2`}function rm(a,b=0){const c=new Lc({eventEmitter:a.eventEmitter,eventNames:{join:Sh,leave:df,update:Th,change:"userlist.change",init:Uh,changename:pd},root:qm(a),userID:a.userInfo,maxUsers:b});return c.on(df,function(d){d.userID===a.userID&&Eq(a)}),a.on(ub,function(){c.startUpdate()}).on(Lb,function(){c.stopUpdate().clear()}),c}function Eq(a){a.emit(Lb),setTimeout(function(){a.leftRoomFlag=!1},0)}function nm(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new Jc({eventEmitter:a.eventEmitter,eventNames:{receive:Gh},receiverID:"broadcast",senderID:a.userInfo,history:b.history});return a.on(ub,function(){c.setRootPath(a.rootPath).startReceiving()}).on(Lb,function(){c.stopReceiving()}).on(pd,function(d,e){c.changeUserName(d,e)}),c}function pm(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,Dq(a,d))}),a.on(ub,function(){for(const[d,e]of c)e.setRootPath(om(a,d)).startUpdate()}).on(Lb,function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function Dq(a,{key:b,type:c=sa["1d"]}){const d=new Kc({eventEmitter:a.eventEmitter,type:c,eventNames:{init:Hh(b),update:Ih(b),addkey0:Jh(b),removekey0:Mh(b),changekey0:Ph(b),addkey1:Kh(b),removekey1:Nh(b),changekey1:Qh(b),addkey2:Lh(b),removekey2:Oh(b),changekey2:Rh(b)}});return d}function ff(a){return a.userList.isInList}function wm(a){return a.userList.isFull()}function xm(a,b=a.userID){return a.userList.isFirstUser(b)}function ym(a){return a.userList.getUsers()}function um(a){return a.userList.join().then(function(){return a.emit(ub),Promise.resolve()})}function ef(a){return ff(a)?(a.leftRoomFlag=!0,a.userList.leave()):Promise.resolve()}function tm(a){return a.userList.getUsers()}function vm(a,b){return a.userList.contains(b)?b===a.userID?ef(a):a.userList.leave(b):Promise.resolve()}function mm(a,b){return a.userList.changeUserName(b)}const G9=Ka(Qa());class zm extends va{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,broadcast:f=!0,tables:g=!1}={}){const i=arguments[0];super();this.setEventEmitter(a),this.database=G9.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.leftRoomFlag=!1,this.userList=rm(this,e),this.broadcast=nm(this,f),this.tables=pm(this,g)}shutdown(){}destroy(){this.shutdown()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(){return ff(this)}isFull(){return wm(this)}isFirstUser(a=this.userID){return xm(this,a)}getUsers(){return ym(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}joinRoom(){return um(this)}leaveRoom(){return ef(this)}getUserList(){return tm(this)}kickUser(a){return vm(this,a)}changeUserName(a){return mm(this,a)}}const Pi="statechange";function Qi(a){return`exit_${a.toString()}`}function Ri(a){return`enter_${a.toString()}`}class to extends va{constructor({eventEmitter:a}={}){super();this._states=new Map();this.enable=!0;this.setEventEmitter(a)}destroy(){this.destroyEventEmitter()}toJSON(){return{curState:this.state,prevState:this.prevState,enable:this.enable,start:this._start}}setEnable(a=!0){return this.enable=a,this}getState(a){return this._states.get(a)}addState(a){return this._states.set(a.name,a),this}addStates(a){for(let b=0,c=a.length;b<c;b++)this.addState(a[b]);return this}removeState(a){return this._states.delete(a),this}removeAllStates(){return this._states.clear(),this}set state(a){if(!this.enable||this._stateLock)return;if(this._state===a)return;this._prevState=this._state,this._state=a,this._stateLock=!0,this.emit(Pi,this);if(this._prevState!=null){const b=this.getState(this._prevState);b&&b.exit&&b.exit(this),this.emit(Qi(this._prevState),this)}this._stateLock=!1;if(this._state!=null){const b=this.getState(this._state);b&&b.enter&&b.enter(this),this.emit(Ri(this._state),this)}}get state(){return this._state}get prevState(){return this._prevState}get stateList(){return Array.from(this._states.keys())}start(a){return this._start=a,this._prevState=void 0,this._state=a,this}goto(a){return a!=null&&(this.state=a),this}next(){const a=this.getState(this.state);if(!a||!a.next)return this;let b;return typeof a.next==="string"?b=a.next:b=a.next(this),this.goto(b),this}update(a,b,c="update"){const d=this.getState(this.state);d&&d[c]&&d[c](this,a,b)}preupdate(a,b){this.update(b,a,"preupdate")}postupdate(a,b){this.update(b,a,"postupdate")}}var Si;(function(a){a[a.shuffle=0]="shuffle",a[a.random=1]="random"})(Si||(Si={}));const Vi="die";class uo extends Ff{constructor(a,{lifeTime:b=1e3,destroy:c=!0}={}){super(a,arguments[1]);this.setLifeTime(b),this.setDestroyMode(c)}resetFromJSON({lifeTime:a=1e3,destroy:b=!0}={}){return super.resetFromJSON(arguments[0]),this.setLifeTime(a),this.setDestroyMode(b),this}toJSON(){const a=super.toJSON();return a.lifeTime=this.lifeTime,a.destroy=this.destroyMode,a}setLifeTime(a){return this.lifeTime=a,this}addToLifeTime(a){return this.lifeTime+=a,this}setDestroyMode(a=!0){return this.destroyMode=a,this}get isAlive(){return this.now<this.lifeTime}get remainder(){let a=this.lifeTime-this.now;return a<0&&(a=0),a}update(a){return this.isRunning?(super.update(a),this.isAlive||(this.complete(Vi),this.destroyMode&&this.gameObject.destroy&&this.gameObject.destroy()),this):this}get gameObject(){return this.parent}}class Gf{constructor(a,b,c,d,e){this.key=a,this.start=b,this.end=c,this.step=d,this.items=e,this._current=b}reset(){this._current=this.start}get isEnd(){return this.step>=0?this._current>=this.end:this._current<=this.end}get length(){return this.step>=0&&this.start>this.end||this.step<0&&this.start<this.end?0:Math.floor(this.end-this.start)+1}next(){return this.isEnd?this._current=this.start:this._current+=this.step,this}get current(){return this.items?this.items[this._current]:this._current}}class wo{constructor(){this.indexes=[];this.length=0;this.firstPass=!0;this.currentCount=0}reset(){for(let a=0,b=this.indexes.length;a<b;a++)this.indexes[a].reset();return this.firstPass=!0,this.currentCount=0,this}addNumberLoop(a,b,c,d=c>=b?1:-1){return this.indexes.push(new Gf(a,b,c,d)),this.length=this._getLength(),this}addItemsLoop(a,b,c=!1){const d=b.length-1,e=c?d:0,f=c?0:d,g=c?-1:1;return this.indexes.push(new Gf(a,e,f,g,b)),this.length=this._getLength(),this}addLoop({key:a,start:b,end:c,step:d,items:e}){return this.indexes.push(new Gf(a,b,c,d,e)),this.length=this._getLength(),this}removeLoops(){return this.indexes.length=0,this.length=0,this}_getLength(){let a=this.indexes[0]?.length;for(let b=1,c=this.indexes.length;b<c;b++)a*=this.indexes[b].length;return a??0}get progress(){return this.currentCount/this.length}get isEnd(){for(let a=this.indexes.length-1;a>=0;a--)if(!this.indexes[a].isEnd)return!1;return!0}next(){for(let a=this.indexes.length-1;a>=0;a--){const b=this.indexes[a],c=b.isEnd;b.next();if(!c)break}return this}getCurrent(a={}){for(let b=this.indexes.length-1;b>=0;b--){const c=this.indexes[b];a[c.key]=c.current}return a}getNext(a={}){return this.firstPass?this.firstPass=!1:this.next(),this.getCurrent(a),this.currentCount++,a}}const Li="tickstart";const Mi="tickend";const Ar=1e3/60;class vo extends Hf{constructor(a,{callback:b,scope:c,deltaPercentage:d=1}={}){super(a,arguments[1]);this.deltaPercentage=1;this.loopIndexGenerator=new wo();this.currentIndexes={};this.scene=a,this.setCallback(b,c),this.setDeltaPercentage(d),this.boot()}boot(){super.boot(),Ub(this.scene,"shutdown",this.destroy,this)}shutdown(){super.shutdown(),this.scene=void 0}destroy(){this.shutdown()}startTicking(){super.startTicking(),Ya(this.scene,"update",this.preupdate,this)}stopTicking(){super.stopTicking(),this.scene&&pb(this.scene,"update",this.preupdate,this)}setCallback(a,b){return this.callback=a,this.scope=b,this}setDeltaPercentage(a){return this.deltaPercentage=a,this}addNumberLoop(a,b,c,d){return this.loopIndexGenerator.addNumberLoop(a,b,c,d),this}addItemsLoop(a,b,c=!1){return this.loopIndexGenerator.addItemsLoop(a,b,c),this}addLoop(a){return this.loopIndexGenerator.addLoop(a),this}get curTime(){return new Date().getTime()}get progress(){return this.loopIndexGenerator.progress}preupdate(){if(!this.callback)return;const a=this.curTime,b=Ar*this.deltaPercentage;let c;this.emit(Li);do{if(this.loopIndexGenerator.isEnd){this.complete();return}this.currentIndexes=this.loopIndexGenerator.getNext(this.currentIndexes),this.scope?this.callback.call(this.scope,this.currentIndexes,this):this.callback(this.currentIndexes,this),c=this.curTime-a>=b}while(!c);this.emit(Mi)}}const Eqa=Ka(So());var Ti;(function(a){a[a.none=0]="none",a[a.base64=1]="base64",a[a.utf16=2]="utf16",a[a.uri=3]="uri"})(Ti||(Ti={}));let Lr=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i;function Ic(a){let b;return a===""?b=null:Lr.test(a)?b=parseFloat(a):a==="false"?b=!1:a==="true"?b=!0:b=a,b}const bma=Ka(wg());function xo(a,{delimiter:b=",",convert:c=!0,types:d={}}={}){const e=bma.default.parse(a,{header:!0,delimiter:b}).data,f=d.question??"q",g=d.option??"",i=c===!0?Ic:c,h=[];let k,n;for(let o=0,s=e.length;o<s;o++){let u=e[o],v=u.type;delete u.type,v===f?(k=u,k.key===""&&delete k.key,zo(k,i),k.options=[],h.push(k)):v===g&&(k&&(n=u,n.key===""&&delete n.key,zo(n,i),k.options.push(n)))}return h}function zo(a,b){const c=a;if(!b)return c;for(const d in a)c[d]=b(a[d],d);return c}function Oi(a,b,c){typeof b==="string"&&(b=xo(b,c));if(Array.isArray(b))for(let d=0,e=b.length;d<e;d++)yo(a,b[d]);else yo(a,b)}function yo(a,b){const c=b.options;if(c)for(let d=0,e=c.length;d<e;d++){let f=c[d];f.hasOwnProperty("key")||(f.key=`_${d}`)}b.hasOwnProperty("key")||(b.key=`_${a.questions.size}`),a.questions.set(b.key,b)}class Ni{constructor({questions:a}={}){this.questions=new Map();a&&Oi(this,a,arguments[0])}add(a,b){return Oi(this,a,b),this}remove(a){return this.questions.delete(a),this}removeAll(){return this.questions.clear(),this}has(a){return this.questions.has(a)}get(a){return this.questions.get(a)}getKeys(a=[]){const b=this.questions.keys();for(const c of b)a.push(c);return a}getOption(a,b){typeof a==="string"&&(a=this.get(a));if(!a)return null;const c=a.options;if(c)for(let d=0,e=c.length;d<e;d++){let f=c[d];if(f.key===b)return f}return null}}const If="quest";class Br extends va{constructor(a,{eventEmitter:b,shuffleQuestions:c=!1,shuffleOptions:d=!1}={}){super();this.questionKeys=[];this.setEventEmitter(b),Qe(a)&&(a=new Ni(a)),this.questionsManager=a,this.setShuffleQuestionsEnable(c),this.setShuffleOptionsEnable(d),this.init()}setShuffleQuestionsEnable(a=!0){return this.shuffleQuestionsEnable=a,this}setShuffleOptionsEnable(a=!0){return this.shuffleOptionsEnable=a,this}init(){return this.questionKeys.length=0,this.questionsManager.getKeys(this.questionKeys),this.shuffleQuestionsEnable&&hc(this.questionKeys),this.nextIndex=-1,this.nextKey=void 0,this}setNextKey(a){return a===void 0?(this.nextIndex++,this.nextKey=this.questionKeys[this.nextIndex]):this.questionsManager.has(a)&&(this.nextKey=a,this.nextIndex=this.questionKeys.indexOf(a)),this}setPrevKey(){return this.nextIndex--,this.nextKey=this.questionKeys[this.nextIndex],this}getQuestion(){const a=this.questionsManager.get(this.nextKey);if(a&&this.shuffleOptionsEnable){const b=a.options;b&&hc(b)}return a}getNextQuestion(a){return this.setNextKey(a).getQuestion()}getPrevQuestion(){return this.setPrevKey().getQuestion()}getOption(a,b){return b===void 0&&(b=a,a=this.getQuestion()),this.questionsManager.getOption(a,b)}next(a){const b=this.getNextQuestion(a);return b&&this.emit(If,b,this,this.questionsManager),this}prev(){const a=this.getPrevQuestion();return a&&this.emit(If,a,this,this.questionsManager),this}restart(a){return this.init(),this.next(a),this}get isLastQuestion(){return this.nextIndex===this.questionKeys.length-1}}var Tg;(function(a){a[a.ascending=0]="ascending",a[a.descending=1]="descending",a[a.logical_ascending=2]="logical_ascending",a[a.logical_descending=3]="logical_descending"})(Tg||(Tg={}));class Vo extends Od{constructor(){super();Vf("icon",{width:32,height:32,fillStyle:"white"});const a=new Uc.GridSizer({width:600,height:600,column:10,row:10,columnProportions:1,rowProportions:1,space:{left:10,right:10,top:10,bottom:10,column:10,row:10}});a.addBackground(fj("icon",void 0,1644912)),a.forEachEmptyGrid(function(c,d,e){e.add(fj("icon",void 0,Wf(0,16777216)),{column:c,row:d})}),a.layout().setPosition(400,300);const b=new Uf(this);uc(b,a)}}function fj(a,b,c){const d=new cb(0,0,a,b);return c!==void 0&&ej(c,d),d}new dj(Tf(),Sf(800,600),Qf("game"),Pf(2960685),Rf(Vo));})();
/* @license
Papa Parse
v5.2.0
https://github.com/mholt/PapaParse
License: MIT
*/
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

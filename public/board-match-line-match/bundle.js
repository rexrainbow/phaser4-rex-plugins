!function(){"use strict";let t,e=0,i=0;const r=()=>t,s=e=>{t=e},n=()=>e,h=t=>{e=t},o=t=>{i=t};let a=0;let l=800,u=600,d=1;function c(){return l}function f(){return u}function x(){return d}const y=[],g=t=>{y.push(t)},p=()=>y,m=()=>{y.length=0};let T;let b,v=0;function w(){return v}function E(t){let e;return t&&("string"==typeof t?e=document.getElementById(t):"object"==typeof t&&1===t.nodeType&&(e=t)),e||(e=document.body),e}function S(){return b}let _=[];let R,M={alpha:!1,antialias:!1,depth:!1,premultipliedAlpha:!1};class D{constructor(t){this.stack=[],this.current=null,this.renderer=t}reset(){this.stack=[],this.current=null;const t=this.renderer,e=t.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,t.width,t.height)}add(t,e=!0,i=0,r=0){this.stack.push({framebuffer:t,width:i,height:r}),this.set(t,e,i,r)}set(t,e=!0,i=0,r=0){const s=this.renderer.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),e&&(s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT)),i>0&&s.viewport(0,0,i,r),this.current=t}pop(){this.stack.pop();const t=this.stack.length;if(t>0){const e=this.stack[t-1];this.set(e.framebuffer,!1,e.width,e.height)}else this.reset()}rebind(){const t=this.renderer.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.current)}destroy(){this.stack=[]}}const A=()=>R,C=t=>{R=t};function k(t){const e=A();if(!e)return;const{parent:i,flipY:r,unpackPremultiplyAlpha:s,minFilter:n,magFilter:h,wrapS:o,wrapT:a,generateMipmap:l,isPOT:u}=t,d=i.image;let c=i.width,f=i.height;const x=e.createTexture();return e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,x),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),d?(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,d),c=d.width,f=d.height):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,c,f,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,h),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,a),l&&u&&e.generateMipmap(e.TEXTURE_2D),t.texture=x,x}function z(t){const e=A();e&&e.isTexture(t)&&e.deleteTexture(t)}class F{constructor(t,e={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1;const i=A();var r,s;this.parent=t,this.isPOT=(r=t.width,s=t.height,!(r<1||s<1)&&0==(r&r-1)&&0==(s&s-1));const{texture:n=null,framebuffer:h=null,unpackPremultiplyAlpha:o=!0,minFilter:a=i.LINEAR,magFilter:l=i.LINEAR,wrapS:u=i.CLAMP_TO_EDGE,wrapT:d=i.CLAMP_TO_EDGE,generateMipmap:c=this.isPOT,flipY:f=!1}=e;this.minFilter=a,this.magFilter=l,this.wrapS=u,this.wrapT=d,this.generateMipmap=c,this.flipY=f,this.unpackPremultiplyAlpha=o,h&&(this.framebuffer=h),n?this.texture=n:k(this)}setFilter(t){this.texture&&function(t,e=!0){const i=A();i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t);const r=e?i.LINEAR:i.NEAREST;i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,r)}(this.texture,t)}create(){const t=this.texture;return t&&z(t),k(this)}update(){return this.texture?function(t){const e=A(),i=t.parent.image,r=i.width,s=i.height;return r>0&&s>0&&(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t.texture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i)),t.texture}(this):k(this)}setIndex(t){this.dirtyIndex=t!==this.index,this.index=t}destroy(){z(this.texture),function(t){const e=A();e&&e.isFramebuffer(t)&&e.deleteFramebuffer(t)}(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}}class X{constructor(t,e,i,r,s){this.batchSize=t,this.dataSize=e,this.indexSize=i,this.vertexElementSize=r,this.quadIndexSize=s,this.vertexByteSize=r*e,this.quadByteSize=4*this.vertexByteSize,this.quadElementSize=4*r,this.bufferByteSize=t*this.quadByteSize,this.create()}create(){let t=[];for(let e=0;e<this.batchSize*this.indexSize;e+=this.indexSize)t.push(e+0,e+1,e+2,e+2,e+3,e+0);this.data=new ArrayBuffer(this.bufferByteSize),this.index=new Uint16Array(t),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const e=A();this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.data,e.DYNAMIC_DRAW),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.index,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),t=[]}destroy(){}}class B{constructor(t,e,i,r,s,n){this.trimmed=!1,this.texture=t,this.key=e,this.x=i,this.y=r,this.width=s,this.height=n,this.sourceSizeWidth=s,this.sourceSizeHeight=n,this.updateUVs()}setPivot(t,e){this.pivot={x:t,y:e}}setSize(t,e){this.width=t,this.height=e,this.sourceSizeWidth=t,this.sourceSizeHeight=e,this.updateUVs()}setSourceSize(t,e){this.sourceSizeWidth=t,this.sourceSizeHeight=e}setTrim(t,e,i,r,s,n){this.trimmed=!0,this.sourceSizeWidth=t,this.sourceSizeHeight=e,this.spriteSourceSizeX=i,this.spriteSourceSizeY=r,this.spriteSourceSizeWidth=s,this.spriteSourceSizeHeight=n}getExtent(t,e){const i=this.sourceSizeWidth,r=this.sourceSizeHeight;let s,n,h,o;return this.trimmed?(s=this.spriteSourceSizeX-t*i,n=s+this.spriteSourceSizeWidth,h=this.spriteSourceSizeY-e*r,o=h+this.spriteSourceSizeHeight):(s=-t*i,n=s+i,h=-e*r,o=h+r),{left:s,right:n,top:h,bottom:o}}setExtent(t){const e=t.transform,i=e.origin.x,r=e.origin.y,s=this.sourceSizeWidth,n=this.sourceSizeHeight;let h,o,a,l;this.trimmed?(h=this.spriteSourceSizeX-i*s,o=this.spriteSourceSizeY-r*n,a=this.spriteSourceSizeWidth,l=this.spriteSourceSizeHeight):(h=-i*s,o=-r*n,a=s,l=n),e.setExtent(h,o,a,l)}updateUVs(){const{x:t,y:e,width:i,height:r}=this,s=this.texture.width,n=this.texture.height;this.u0=t/s,this.v0=e/n,this.u1=(t+i)/s,this.v1=(e+r)/n}}class Y{constructor(t,e,i){this.key="",t&&(e=t.width,i=t.height),this.image=t,this.width=e,this.height=i,this.frames=new Map,this.data={},this.addFrame("__BASE",0,0,e,i),g(this)}addFrame(t,e,i,r,s){if(this.frames.has(t))return null;const n=new B(this,t,e,i,r,s);return this.frames.set(t,n),this.firstFrame&&"__BASE"!==this.firstFrame.key||(this.firstFrame=n),n}getFrame(t){if(!t)return this.firstFrame;t instanceof B&&(t=t.key);let e=this.frames.get(t);return e||(console.warn("Frame missing: "+t),e=this.firstFrame),e}setSize(t,e){this.width=t,this.height=e;this.frames.get("__BASE").setSize(t,e)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}}let N;const U=()=>N,I=t=>{N=t},O={fragmentShader:"\n#define SHADER_NAME SINGLE_QUAD_FRAG\n\nprecision highp float;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nuniform sampler2D uTexture;\n\nvoid main (void)\n{\n    vec4 color = texture2D(uTexture, vTextureCoord);\n\n    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\n}",vertexShader:"\n#define SHADER_NAME SINGLE_QUAD_VERT\n\nprecision highp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute float aTextureId;\nattribute vec4 aTintColor;\n\nuniform mat4 uProjectionMatrix;\nuniform mat4 uCameraMatrix;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nvoid main (void)\n{\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vTintColor = aTintColor;\n\n    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\n}"};class P{constructor(t={}){this.attribs={aVertexPosition:0,aTextureCoord:0,aTextureId:0,aTintColor:0},this.uniforms={uProjectionMatrix:0,uCameraMatrix:0,uTexture:0,uTime:0,uResolution:0},this.renderToFBO=!1,this.renderer=U();const{batchSize:e=4096,dataSize:i=4,indexSize:r=4,vertexElementSize:s=6,quadIndexSize:n=6,fragmentShader:h=O.fragmentShader,vertexShader:o=O.vertexShader,width:a=c(),height:l=f(),resolution:u=x(),renderToFBO:d=!1}=t;this.buffer=new X(e,i,r,s,n),this.createShaders(h,o),this.count=0,this.renderToFBO=d;const y=new Y(null,a*u,l*u),g=new F(y);y.binding=g,g.framebuffer=function(t,e){const i=A();e||(e=i.COLOR_ATTACHMENT0);const r=i.createFramebuffer();return i.bindFramebuffer(i.FRAMEBUFFER,r),i.framebufferTexture2D(i.FRAMEBUFFER,e,i.TEXTURE_2D,t,0),i.bindFramebuffer(i.FRAMEBUFFER,null),r}(g.texture),this.texture=y,this.framebuffer=g.framebuffer}createShaders(t,e){const i=this.renderer.gl,r=i.createShader(i.FRAGMENT_SHADER);i.shaderSource(r,t),i.compileShader(r);let s=!1,n=i.getShaderInfoLog(r);n.length>0&&(s=!0,console.error(n));const h=i.createShader(i.VERTEX_SHADER);if(i.shaderSource(h,e),i.compileShader(h),n=i.getShaderInfoLog(r),n.length>0&&(s=!0,console.error(n)),s)return;const o=i.createProgram();i.attachShader(o,h),i.attachShader(o,r),i.linkProgram(o),i.useProgram(o),this.program=o;for(const t of Object.keys(this.attribs)){const e=i.getAttribLocation(o,t);i.enableVertexAttribArray(e),this.attribs[t]=e}for(const t of Object.keys(this.uniforms))this.uniforms[t]=i.getUniformLocation(o,t)}bind(t,e,i){if(!this.program)return!1;const r=this.renderer,s=r.gl,n=this.uniforms;return s.useProgram(this.program),s.uniformMatrix4fv(n.uProjectionMatrix,!1,t),s.uniformMatrix4fv(n.uCameraMatrix,!1,e),s.uniform1i(n.uTexture,r.textures.textureIndex[i]),s.uniform1f(n.uTime,performance.now()),s.uniform2f(n.uResolution,r.width,r.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}bindBuffers(t,e){const i=this.renderer.gl,r=this.buffer.vertexByteSize,s=this.attribs;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),i.bindBuffer(i.ARRAY_BUFFER,e),i.vertexAttribPointer(s.aVertexPosition,2,i.FLOAT,!1,r,0),i.vertexAttribPointer(s.aTextureCoord,2,i.FLOAT,!1,r,8),i.vertexAttribPointer(s.aTextureId,1,i.FLOAT,!1,r,16),i.vertexAttribPointer(s.aTintColor,4,i.UNSIGNED_BYTE,!0,r,20),this.count=0}draw(t){const e=this.renderer,i=e.gl,r=this.buffer;if(t===r.batchSize)i.bufferData(i.ARRAY_BUFFER,r.data,i.DYNAMIC_DRAW);else{const e=r.vertexViewF32.subarray(0,t*r.quadElementSize);i.bufferSubData(i.ARRAY_BUFFER,0,e)}this.renderToFBO&&e.fbo.add(this.framebuffer,!0),i.drawElements(i.TRIANGLES,t*r.quadIndexSize,i.UNSIGNED_SHORT,0),this.renderToFBO&&e.fbo.pop()}flush(){const t=this.count;return 0!==t&&(this.draw(t),this.prevCount=t,this.count=0,!0)}}class L extends P{constructor(t={fragmentShader:"\n#define SHADER_NAME MULTI_QUAD_FRAG\n\nprecision highp float;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nuniform sampler2D uTexture[%count%];\n\nvoid main (void)\n{\n    vec4 color;\n\n    %forloop%\n\n    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\n}"}){super(t)}createShaders(t,e){const i=w();let r="";for(let t=1;t<i;t++)t>1&&(r+="\n\telse "),t<i-1&&(r+=`if (vTextureId < ${t}.5)`),r+="\n\t{",r+=`\n\t\tcolor = texture2D(uTexture[${t}], vTextureCoord);`,r+="\n\t}";t=(t=t.replace(/%count%/gi,""+i)).replace(/%forloop%/gi,r),super.createShaders(t,e)}bind(t,e){if(!this.program)return!1;const i=this.renderer,r=i.gl,s=this.uniforms;return r.useProgram(this.program),r.uniformMatrix4fv(s.uProjectionMatrix,!1,t),r.uniformMatrix4fv(s.uCameraMatrix,!1,e),r.uniform1iv(s.uTexture,i.textures.textureIndex),r.uniform1f(s.uTime,performance.now()),r.uniform2f(s.uResolution,i.width,i.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}}class W{constructor(t,e){this.renderer=t;const i={shader:new e};this.stack=[i],this.currentEntry=i,this.current=i.shader,this.singleQuadShader=new P}add(t,e){const i={shader:t,textureID:e};return this.stack.push(i),i}set(t,e){this.flush();const i=this.renderer,r=i.projectionMatrix,s=i.currentCamera.matrix,n=t.bind(r,s,e);if(n){const i=this.add(t,e);this.currentEntry=i,this.current=t}return n}setDefault(t){this.set(this.singleQuadShader,t)}pop(){this.flush();const t=this.stack;t.length>1&&t.pop(),this.currentEntry=t[t.length-1],this.current=this.currentEntry.shader}reset(){this.pop(),this.rebind()}flush(){return!!this.current.flush()&&(this.renderer.flushTotal++,!0)}rebind(){const t=this.renderer,e=t.projectionMatrix,i=t.currentCamera.matrix,r=this.currentEntry;r.shader.bind(e,i,r.textureID)}popAndRebind(){this.pop(),this.rebind()}clear(){}destroy(){}}const G=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function V(t){let e="";for(let i=0;i<t;++i)i>0&&(e+="\nelse "),i<t-1&&(e+=`if(test == ${i}.0){}`);return e}class H{constructor(t){this.startActiveTexture=0,this.renderer=t,this.tempTextures=[],this.textureIndex=[]}init(){const t=this.renderer.gl;let e=function(t,e){const i=e.createShader(e.FRAGMENT_SHADER);for(;;){const r=G.replace(/%forloop%/gi,V(t));if(e.shaderSource(i,r),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS))break;t=t/2|0}return t}(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),t);const i=w();0===i||i>0&&i>e?v=e:i>0&&i<e&&(e=Math.max(8,i));const r=this.tempTextures;r.length&&r.forEach(e=>{t.deleteTexture(e)});const s=[];for(let i=0;i<e;i++){const e=t.createTexture();t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),r[i]=e,s.push(i)}this.maxTextures=e,this.textureIndex=s,this.currentActiveTexture=1}update(){const t=p();for(let e=0;e<t.length;e++){const i=t[e];i.binding||(i.binding=new F(i))}m()}reset(){const t=this.renderer.gl,e=this.tempTextures;for(let i=0;i<e.length;i++)t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,e[i]);this.currentActiveTexture=1,this.startActiveTexture++}bind(t,e=0){const i=this.renderer.gl,r=t.binding;r.setIndex(e),i.activeTexture(i.TEXTURE0+e),i.bindTexture(i.TEXTURE_2D,r.texture)}unbind(t=0){const e=this.renderer.gl;e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this.tempTextures[t]),t>0&&this.startActiveTexture++}request(t){const e=this.renderer.gl,i=t.binding,r=this.currentActiveTexture;return!(i.indexCounter>=this.startActiveTexture)&&(i.indexCounter=this.startActiveTexture,r<this.maxTextures?(i.setIndex(r),e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,i.texture),this.currentActiveTexture++):(this.renderer.flush(),this.startActiveTexture++,i.indexCounter=this.startActiveTexture,i.setIndex(1),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,i.texture),this.currentActiveTexture=2),!0)}}class Z{constructor(){this.clearColor=[0,0,0,1],this.flushTotal=0,this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.currentCamera=null,this.width=c(),this.height=f(),this.resolution=x(),this.setBackgroundColor(a);const t=document.createElement("canvas");t.addEventListener("webglcontextlost",t=>this.onContextLost(t),!1),t.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=t,this.fbo=new D(this),this.textures=new H(this),this.initContext(),I(this),this.shaders=new W(this,L)}initContext(){const t=this.canvas.getContext("webgl",M);C(t),this.gl=t,t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),this.resize(this.width,this.height,this.resolution),this.textures.init()}resize(t,e,i=1){this.width=t*i,this.height=e*i,this.resolution=i;const r=this.canvas;r.width=this.width,r.height=this.height,this.autoResize&&(r.style.width=(this.width/i).toString()+"px",r.style.height=(this.height/i).toString()+"px"),this.gl.viewport(0,0,this.width,this.height),this.projectionMatrix=function(t,e,i=-1,r=1){return new Float32Array([1/-t*-2,0,0,0,0,1/e*-2,0,0,0,0,1/(i-r)*2,0,-1,1,0,1])}(t,e)}onContextLost(t){t.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(t){return function(t,e=[]){const i=t>>16&255,r=t>>8&255,s=255&t,n=t>16777215?t>>>24:255;e[0]=i/255,e[1]=r/255,e[2]=s/255,e[3]=n/255}(t,this.clearColor),this}reset(t=null,e=this.width,i=this.height){const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),r.viewport(0,0,e,i),r.enable(r.BLEND),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),this.flushTotal=0,this.currentCamera=null,this.textures.update()}render(t){if(this.contextLost)return;if(this.reset(),this.optimizeRedraw&&0===t.numDirtyFrames&&0===t.numDirtyCameras)return;const e=this.gl;if(this.clearBeforeRender){const t=this.clearColor;e.clearColor(t[0],t[1],t[2],t[3]),e.clear(e.COLOR_BUFFER_BIT)}const i=t.worldData;for(let t=0;t<i.length;t++){const{camera:e,renderList:n}=i[t];this.currentCamera&&(r=e.worldTransform,s=this.currentCamera.worldTransform,r.a===s.a&&r.b===s.b&&r.c===s.c&&r.d===s.d&&r.tx===s.tx&&r.ty===s.ty)||(this.flush(),this.currentCamera=e,this.shaders.rebind()),n.forEach(t=>{t.children.length?this.renderNode(t):t.node.renderGL(this)})}var r,s;this.flush()}renderNode(t){t.node.renderGL(this),t.children.forEach(t=>{t.children.length>0?this.renderNode(t):t.node.renderGL(this)}),t.node.postRenderGL(this)}flush(){this.shaders.flush()}destroy(){I(void 0)}}class j{constructor(t=1,e=0,i=0,r=1,s=0,n=0){this.set(t,e,i,r,s,n)}set(t=1,e=0,i=0,r=1,s=0,n=0){return this.a=t,this.b=e,this.c=i,this.d=r,this.tx=s,this.ty=n,this}identity(){return this.set()}toArray(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]}fromArray(t){return this.set(t[0],t[1],t[2],t[3],t[4],t[5])}}class Q{constructor(t=0,e=0,i=0,r=0){this.set(t,e,i,r)}set(t=0,e=0,i=0,r=0){return this.x=t,this.y=e,this.width=i,this.height=r,this}contains(t,e){return function(t,e,i){return!(t.width<=0||t.height<=0)&&(t.x<=e&&t.x+t.width>=e&&t.y<=i&&t.y+t.height>=i)}(this,t,e)}set right(t){t<=this.x?this.width=0:this.width=t-this.x}get right(){return this.x+this.width}set bottom(t){t<=this.y?this.height=0:this.height=t-this.y}get bottom(){return this.y+this.height}}function q(){}class ${constructor(t,e=0,i=0,r=!1){this.compareValue=!1,this._x=e,this._y=i,this.callback=t,this.compareValue=r}set(t=0,e=0){return this._x=t,this._y=e,this.callback(this),this}destroy(){this.callback=q}set x(t){(!this.compareValue||this.compareValue&&t!==this._x)&&(this._x=t,this.callback(this))}get x(){return this._x}set y(t){(!this.compareValue||this.compareValue&&t!==this._x)&&(this._y=t,this.callback(this))}get y(){return this._y}}class K{constructor(){this.type="StaticCamera",this.dirtyRender=!0;const t=r();this.renderer=t.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.bounds=new Q,this.worldTransform=new j,this.reset()}reset(){const t=this.renderer.width,e=this.renderer.height;this.width=t,this.height=e,this.bounds.set(0,0,t,e)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}function J(t,e){const i=function(t,e){return t.children.indexOf(e)}(t,e);return i>-1&&function(t,e){const i=t.children;let r;if(e>=0&&e<i.length){const t=i.splice(e,1);t[0]&&(r=t[0],r.parent=null)}}(t,i),e}function tt(t,e,...i){if(0===t.events.size||!t.events.has(e))return!1;const r=t.events.get(e);for(const t of r)t.callback.apply(t.context,i),t.once&&r.delete(t);return 0===r.size&&t.events.delete(e),!0}function et(t,...e){e.forEach(e=>{e.parent&&J(e.parent,e),e.parent=t});const i=t.world;return i&&function(t,...e){e.forEach(e=>{e.world&&(tt(e.world,"removedfromworld",e,e.world),tt(e,"removedfromworld",e,e.world)),e.world=t,tt(t,"addedtoworld",e,t),tt(e,"addedtoworld",e,t)})}(i,...function(t){const e=[t],i=[];for(;e.length>0;){const t=e.shift();i.push(t);const r=t.numChildren;if(r>0)for(let i=r-1;i>=0;i--)e.unshift(t.children[i])}return i.shift(),i}(t)),e}function it(t,e){return t.children.push(e),et(t,e),e.transform.updateWorld(),e}const rt=1,st=4,nt=16,ht=32,ot=64,at=256,lt=51;function ut(t,e=0,i){const r=t.children;void 0===i&&(i=r.length);const s=i-e;if(s>0&&s<=i){const t=r.splice(e,s);return t.forEach(t=>{t.parent=null}),t}return[]}class dt{constructor(t,e,i=!1){this.callback=t,this.context=e,this.once=i}}function ct(t,e,i,r,s){const n=t.events,h=n.get(e);if(i)if(i instanceof dt)h.delete(i);else{const t=!r,e=void 0!==s;for(const n of h)n.callback===i&&t&&n.context===r&&e&&n.once===s&&h.delete(n)}else n.delete(e);return 0===h.size&&n.delete(e),t}function ft(t,e,i,r=t,s=!1){if("function"!=typeof i)throw new TypeError("Listener not a function");const n=new dt(i,r,s),h=t.events.get(e);return h?h.add(n):t.events.set(e,new Set([n])),n}function xt(t,e,i,r=t){return ft(t,e,i,r,!0)}let yt;const gt=()=>yt,pt=t=>{yt=t};class mt{constructor(){this.scenes=new Map,this.sceneIndex=0,this.flush=!1,this.renderResult={gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]},this.game=r(),pt(this),xt(this.game,"boot",()=>this.boot())}boot(){_.forEach(t=>new t)}update(t,e){for(const i of this.scenes.values())tt(i,"update",t,e)}render(t){const e=this.renderResult;!function(t,e=0){t.gameFrame=e,t.numTotalFrames=0,t.numDirtyFrames=0,t.numDirtyCameras=0,t.worldData.length=0}(e,t);for(const t of this.scenes.values())tt(t,"render",e);return this.flush&&(e.numDirtyFrames++,this.flush=!1),e}}function Tt(t,e){const i=document.createElement("canvas");return i.width=t,i.height=e,i.getContext("2d")}let bt;const vt=()=>bt,wt=t=>{bt=t};class Et{constructor(){this.textures=new Map,this.createDefaultTextures(),wt(this)}createDefaultTextures(){this.add("__BLANK",new Y(Tt(32,32).canvas));const t=Tt(32,32);t.strokeStyle="#0f0",t.moveTo(0,0),t.lineTo(32,32),t.stroke(),t.strokeRect(.5,.5,31,31),this.add("__MISSING",new Y(t.canvas))}get(t){const e=this.textures;return e.has(t)?e.get(t):e.get("__MISSING")}has(t){return this.textures.has(t)}add(t,e){let i;const r=this.textures;return r.has(t)||(i=e instanceof Y?e:new Y(e),i.key=t,r.set(t,i)),i}}function St(t){const{a:e,b:i,c:r,d:s,tx:n,ty:h}=t.world,{x:o,y:a,right:l,bottom:u}=t.extent;return{x0:o*e+a*r+n,y0:o*i+a*s+h,x1:o*e+u*r+n,y1:o*i+u*s+h,x2:l*e+u*r+n,y2:l*i+u*s+h,x3:l*e+a*r+n,y3:l*i+a*s+h}}class _t{constructor(t){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=t,this.area=new Q}set(t,e,i,r){this.area.set(t,e,i,r)}get(){return this.entity.isDirty(ht)&&!this.fixed&&this.update(),this.area}updateLocal(){const{x0:t,y0:e,x1:i,y1:r,x2:s,y2:n,x3:h,y3:o}=St(this.entity.transform),a=Math.min(t,i,s,h),l=Math.min(e,r,n,o),u=Math.max(t,i,s,h),d=Math.max(e,r,n,o);return this.area.set(a,l,u-a,d-l)}update(){const t=this.updateLocal();if(this.entity.clearDirty(ht),!this.includeChildren||!this.entity.numChildren)return t;const e=this.visibleOnly,i=this.entity.children;let r=t.x,s=t.y,n=t.right,h=t.bottom;for(let t=0;t<i.length;t++){const o=i[t];if(!o||e&&!o.visible)continue;const a=o.bounds.get();a.x<r&&(r=a.x),a.y<s&&(s=a.y),a.right>n&&(n=a.right),a.bottom>h&&(h=a.bottom)}return t.set(r,s,n-r,h-s)}destroy(){this.entity=null,this.area=null}}class Rt{constructor(t){this.enabled=!1,this.enabledChildren=!0,this.entity=t}destroy(){this.entity=null,this.hitArea=null}}class Mt{constructor(t=0,e=0){this.set(t,e)}set(t=0,e=0){return this.x=t,this.y=e,this}getArray(){return[this.x,this.y]}fromArray(t){return this.set(t[0],t[1])}toString(){return`[x=${this.x}, y=${this.y}]`}}function Dt(t,e){return e.set(t.a,t.b,t.c,t.d,t.tx,t.ty)}class At{constructor(t,e=0,i=0){this.passthru=!1,this._rotation=0,this.entity=t,this.local=new j,this.world=new j,this.position=new $(()=>this.update(),e,i),this.scale=new $(()=>this.update(),1,1,!0),this.skew=new $(()=>this.update(),0,0,!0),this.origin=new $(()=>this.updateExtent(),.5,.5),this.extent=new Q}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(rt,ht),function(t){const e=t.local,i=t.position.x,r=t.position.y,s=t.rotation,n=t.scale.x,h=t.scale.y,o=t.skew.x,a=t.skew.y;e.set(Math.cos(s+a)*n,Math.sin(s+a)*n,-Math.sin(s-o)*h,Math.cos(s-o)*h,i,r)}(this)}updateWorld(){const t=this.entity;t.setDirty(rt,ht),function(t){const e=t.parent,i=t.transform,r=i.local,s=i.world;if(e)if(i.passthru)Dt(e.transform.world,s);else{const{a:t,b:i,c:n,d:h,tx:o,ty:a}=r,{a:l,b:u,c:d,d:c,tx:f,ty:x}=e.transform.world;s.set(t*l+i*d,t*u+i*c,n*l+h*d,n*u+h*c,o*l+a*d+f,o*u+a*c+x)}else Dt(r,s)}(t),t.numChildren&&this.updateChildren()}updateChildren(){const t=this.entity.children;for(let e=0;e<t.length;e++){t[e].transform.updateWorld()}}globalToLocal(t,e,i=new Mt){const{a:r,b:s,c:n,d:h,tx:o,ty:a}=this.world,l=1/(r*h+n*-s);return i.x=h*l*t+-n*l*e+(a*n-o*h)*l,i.y=r*l*e+-s*l*t+(-a*r+o*s)*l,i}localToGlobal(t,e,i=new Mt){const{a:r,b:s,c:n,d:h,tx:o,ty:a}=this.world;return i.x=r*t+n*e+o,i.y=s*t+h*e+a,i}setExtent(t,e,i,r){this.extent.set(t,e,i,r),this.entity.setDirty(rt,ht)}updateExtent(t,e){const i=this.extent,r=this.entity;void 0!==t&&(i.width=t),void 0!==e&&(i.height=e),i.x=-this.origin.x*i.width,i.y=-this.origin.y*i.height,r.setDirty(rt,ht)}set rotation(t){t!==this._rotation&&(this._rotation=t,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}}class Ct{constructor(t=0,e=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.events=new Map,this.transform=new At(this,t,e),this.bounds=new _t(this),this.input=new Rt(this),this.dirty=lt,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(t){return 0!=(this.dirty&t)}clearDirty(t){return this.isDirty(t)&&(this.dirty^=t),this}setDirty(t,e){return this.isDirty(t)||(this.dirty^=t,this.dirtyFrame=n()),this.isDirty(e)||(this.dirty^=e),this}update(t,e){if(this.willUpdateChildren){const i=this.children;for(let r=0;r<i.length;r++){const s=i[r];s&&s.willUpdate&&s.update(t,e)}}this.postUpdate(t,e)}postUpdate(t,e){}renderGL(t){}renderCanvas(t){}postRenderGL(t){}postRenderCanvas(t){}get numChildren(){return this.children.length}destroy(t){t?function(t,e,i=0,r){const s=ut(t,i,r);et(e,...s),s.forEach(t=>{t.transform.updateWorld()})}(this,t):function(t,e=0,i){ut(t,e,i).forEach(t=>{t.destroy()})}(this),tt(this,"destroy",this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}}class kt extends Ct{constructor(t=0,e=0){super(t,e),this._alpha=1,this.type="Container"}setSize(t,e=t){return this.transform.updateExtent(t,e),this}setPosition(t,e){return this.transform.position.set(t,e),this}setOrigin(t,e=t){return this.transform.origin.set(t,e),this}setSkew(t,e=t){return this.transform.skew.set(t,e),this}setScale(t,e=t){return this.transform.scale.set(t,e),this}setRotation(t){return this.transform.rotation=t,this}set width(t){this.transform.updateExtent(t)}get width(){return this.transform.extent.width}set height(t){this.transform.updateExtent(void 0,t)}get height(){return this.transform.extent.height}set x(t){this.transform.position.x=t}get x(){return this.transform.position.x}set y(t){this.transform.position.y=t}get y(){return this.transform.position.y}set originX(t){this.transform.origin.x=t}get originX(){return this.transform.origin.x}set originY(t){this.transform.origin.y=t}get originY(){return this.transform.origin.y}set skewX(t){this.transform.skew.x=t}get skewX(){return this.transform.skew.x}set skewY(t){this.transform.skew.y=t}get skewY(){return this.transform.skew.y}set scaleX(t){this.transform.scale.x=t}get scaleX(){return this.transform.scale.x}set scaleY(t){this.transform.scale.y=t}get scaleY(){return this.transform.scale.y}set rotation(t){this.transform.rotation=t}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t,this.setDirty(rt))}}function zt(t,e){return((255&(255*e|0))<<24|t)>>>0}function Ft(t){const e=t.vertexAlpha,i=t.vertexTint,r=t.vertexColor;return r[0]=zt(i[0],e[0]),r[1]=zt(i[1],e[1]),r[2]=zt(i[2],e[2]),r[3]=zt(i[3],e[3]),t}function Xt(t,e,...i){const r=t.getFrame(e),{u0:s,u1:n,v0:h,v1:o,pivot:a}=r;return i.forEach(t=>{if(!t||r===t.frame)return;t.frame=r,a&&t.setOrigin(a.x,a.y),t.frame.setExtent(t),t.hasTexture=!0;const e=t.vertexData;e[2]=s,e[3]=h,e[8]=s,e[9]=o,e[14]=n,e[15]=o,e[20]=n,e[21]=h}),i}class Bt extends kt{constructor(t,e,i,r){super(t,e),this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertexData=new Float32Array(24).fill(0),this.vertexColor=new Uint32Array(4).fill(4294967295),this.vertexAlpha=new Float32Array(4).fill(1),this.vertexTint=new Uint32Array(4).fill(16777215),this.setTexture(i,r)}setTexture(t,e){return function(t,e,...i){if(t){let r;r=t instanceof Y?t:vt().get(t),r?(i.forEach(t=>{t.texture=r}),Xt(r,e,...i)):console.warn("Invalid Texture key: "+t)}else i.forEach(t=>{t.texture=null,t.frame=null,t.hasTexture=!1})}(t,e,this),this}setFrame(t){return Xt(this.texture,t,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}preRender(){this.isDirty(nt)&&(Ft(this),this.clearDirty(nt)),this.isDirty(rt)&&(!function(t){const e=t.vertexData,{x0:i,y0:r,x1:s,y1:n,x2:h,y2:o,x3:a,y3:l}=St(t.transform);e[0]=i,e[1]=r,e[6]=s,e[7]=n,e[12]=h,e[13]=o,e[18]=a,e[19]=l}(this),this.clearDirty(rt))}renderGL(t){this.preRender(),function(t,e){const i=t.texture,r=e.shaders.current,s=r.buffer,n=i.binding;r.count===s.batchSize&&e.flush();const h=t.vertexData;e.textures.request(i);const o=n.index;h[4]=o,h[10]=o,h[16]=o,h[22]=o;const a=r.count*s.quadElementSize;s.vertexViewF32.set(h,a);const l=t.vertexColor,u=s.vertexViewU32;u[a+5]=l[0],u[a+11]=l[2],u[a+17]=l[3],u[a+23]=l[1],r.count++}(this,t)}renderCanvas(t){this.preRender(),function(t,e){const i=t.frame;if(!i)return;const r=e.ctx,s=t.transform,{a:n,b:h,c:o,d:a,tx:l,ty:u}=s.world,{x:d,y:c}=s.extent;r.save(),r.setTransform(n,h,o,a,l,u),r.globalAlpha=t.alpha,r.drawImage(i.texture.image,i.x,i.y,i.width,i.height,d,c,i.width,i.height),r.restore()}(this,t)}get alpha(){return this._alpha}set alpha(t){if(t!==this._alpha){this._alpha=t;const e=this.vertexAlpha;e[0]=t,e[1]=t,e[2]=t,e[3]=t,this.setDirty(at)}}get tint(){return this._tint}set tint(t){if(t!==this._tint){this._tint=t;const e=this.vertexTint;e[0]=t,e[1]=t,e[2]=t,e[3]=t,this.setDirty(nt)}}destroy(t){super.destroy(t),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertexData=null,this.vertexColor=null,this.vertexAlpha=null,this.vertexTint=null}}function Yt(t=32,e=32){const i=Tt(t,e);return new Y(i.canvas)}class Nt extends Bt{constructor(t,e,i="",s,n){super(t,e,Yt()),this.splitRegExp=/(?:\r\n|\r|\n)/,this.padding={left:0,right:0,top:0,bottom:0},this.verticalAlign="ascent",this.lineSpacing=0,this.font="16px monospace",this.fillStyle="#fff",this.strokeStyle="",this.backgroundStyle="",this.cornerRadius=0,this.textAlign="left",this.textBaseline="alphabetic",this.lineWidth=0,this.lineDash=[],this.antialias=!1,this.type="Text";const h=r();this.resolution=h.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),s&&(this.font=s),n&&(this.fillStyle=n),this.setText(i)}syncContext(t,e){this.preRenderCallback&&this.preRenderCallback(t,e),e.font=this.font,e.textBaseline=this.textBaseline,e.textAlign=this.textAlign,e.fillStyle=this.fillStyle,e.strokeStyle=this.strokeStyle,e.lineWidth=this.lineWidth,e.lineCap="round",e.lineJoin="round",e.setLineDash(this.lineDash),e.imageSmoothingEnabled=this.antialias}updateText(){const t=this.canvas,e=this.context,i=this.resolution,r=this._text.split(this.splitRegExp),s=this.padding,n=this.fillStyle,h=this.strokeStyle,o=this.lineWidth,a=this.lineSpacing,l=o>0?o/2:0;e.clearRect(0,0,t.width,t.height),this.syncContext(t,e),e.textAlign="start";let u=0,d=0,c=0;const f=[],x="ascent"===this.verticalAlign,y=e.measureText("|MÉq"),g=Math.ceil(Math.abs(y.actualBoundingBoxAscent)+Math.abs(y.actualBoundingBoxDescent))+o;for(let t=0;t<r.length;t++){const i=e.measureText(r[t]),s=i.actualBoundingBoxLeft,n=i.actualBoundingBoxRight;let h=i.actualBoundingBoxAscent,y=i.actualBoundingBoxDescent;(h||y)&&""!==r[t]||(h=g,y=0);const p=Math.ceil(Math.abs(s)+Math.abs(n))+o,m=Math.ceil(Math.abs(h)+Math.abs(y))+o;x?(c+=h+l,t>0&&(c+=a+l),d=c+y+l):(c=d+(m-y-l),d+=m,t<r.length-1&&(d+=a)),u=Math.max(u,p),f.push({lineWidth:p,lineHeight:m,ascent:h,descent:y,left:s,right:n,y:c})}u+=s.left+s.right,d+=s.top+s.bottom;const p=this.fixedWidth?this.fixedWidth:u,m=this.fixedHeight?this.fixedHeight:d,T=Math.ceil(p*i),b=Math.ceil(m*i);t.width===T&&t.height===b||(t.width=T,t.height=b,this.texture.setSize(p,m),this.setSize(p,m)),e.save(),e.scale(i,i),this.syncContext(t,e);const v=this.backgroundStyle;if(v){e.save(),e.fillStyle=v,e.strokeStyle=v;const t=this.cornerRadius,i=t>0?t/2:0;t&&(e.lineWidth=t,e.strokeRect(i,i,p-t,m-t)),e.fillRect(i,i,p-t,m-t),e.restore()}const w=this.textAlign,E="center"===w,S="right"===w||"end"===w,_=(m-d)/2+s.top;for(let t=0;t<r.length;t++){const i=r[t],o=f[t];let a=s.left+o.left+l;const u=_+o.y;E?a=p/2:S&&(a=p-l),h&&e.strokeText(i,a,u),n&&e.fillText(i,a,u)}return e.restore(),this.texture.binding&&this.texture.binding.update(),this.setDirty(ot),this}get text(){return this._text}set text(t){this.setText(t)}setText(t=""){return Array.isArray(t)&&(t=t.join("\n")),t!==this._text&&(this._text=t.toString(),this.updateText()),this}destroy(t){this.texture.destroy(),this.fillStyle=null,this.strokeStyle=null,this.backgroundStyle=null,this.canvas=null,this.context=null,super.destroy(t)}}function Ut(t,e){t.forEach(t=>{e||function(t){if(t.node.isDirty(st))return!0;const e=[t];for(;e.length>0;){const t=e.pop();if(t.node.isDirty(rt))return!0;const i=t.children.length;if(i>0)for(let r=0;r<i;r++)e.push(t.children[r])}return e.length=0,!1}(t)?t.node.setDirty(st):t.children.length=0})}function It(t){const e=[],i=function t(e,i,r=[]){for(let s=0;s<i.numChildren;s++){const n=i.children[s];if(n.isRenderable()){const i=[],s={node:n,children:i};r.push(s),n.willRenderChildren&&n.numChildren>0&&(n.willCacheChildren&&e.push(s),t(e,n,i))}}return r}(e,t,[]),r=t.renderData;e.length>0&&Ut(e,t.camera.dirtyRender),i.forEach(t=>{t.children.length?function t(e,i){i.numRendered++,i.numRenderable++,e.node.dirtyFrame>=i.gameFrame&&i.dirtyFrame++,e.children.forEach(e=>{e.children.length>0&&t(e,i)})}(t,r):(r.numRendered++,r.numRenderable++,t.node.dirtyFrame>=r.gameFrame&&r.dirtyFrame++)}),r.renderList=i,t.forceRefresh&&(r.dirtyFrame++,t.forceRefresh=!1)}function Ot(t,e){t.gameFrame=e,t.dirtyFrame=0,t.numRendered=0,t.numRenderable=0,t.renderList.length=0}class Pt extends Ct{constructor(t){super(),this.forceRefresh=!1,this.type="BaseWorld",this.scene=t,this.world=this,this.events=new Map,this._updateListener=ft(t,"update",(t,e)=>this.update(t,e)),this._renderListener=ft(t,"render",t=>this.render(t)),this._shutdownListener=ft(t,"shutdown",()=>this.shutdown()),xt(t,"destroy",()=>this.destroy())}update(t,e){this.willUpdate&&(tt(this,"update",t,e,this),super.update(t,e))}postUpdate(t,e){tt(this,"postupdate",t,e,this)}render(t){const e=this.renderData;Ot(e,t.gameFrame),this.willRender&&this.visible&&(It(this),tt(this,"worldrender",e,this),function(t,e){t.numDirtyFrames+=e.dirtyFrame,t.numTotalFrames+=e.numRendered,e.camera.dirtyRender&&t.numDirtyCameras++,t.worldData.push(e)}(t,e),this.camera&&(this.camera.dirtyRender=!1))}shutdown(){const t=this.scene;ct(t,"update",this._updateListener),ct(t,"render",this._renderListener),ct(t,"shutdown",this._shutdownListener),function(t,...e){e.forEach(e=>{J(t,e)})}(this),tt(this,"worldshutdown",this),Ot(this.renderData,0),this.camera&&this.camera.reset()}destroy(t){super.destroy(t),tt(this,"destroy",this),Ot(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}}class Lt extends Pt{constructor(t){super(t),this.type="StaticWorld",this.camera=new K,this.renderData={camera:this.camera,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0,renderList:[]}}}function Wt(t,e={}){const i=gt(),r=i.scenes.size,s=i.sceneIndex,n=0===r;"string"==typeof e?t.key=e:(e||!e&&n)&&(t.key=function(t,e,i){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:i}(e,"key","scene"+s.toString())),i.scenes.has(t.key)?console.warn("Scene key already in use: "+t.key):(i.scenes.set(t.key,t),i.flush=!0,i.sceneIndex++)}function Gt(t,...e){return e.forEach(e=>{const i=e.vertexAlpha;i[0]=t,i[1]=t,i[2]=t,i[3]=t,Ft(e)}),e}let Vt=function(t,e){return void 0===t||void 0===e?void 0:`${t}|${e}`};class Ht{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(t){return this.items.push(t),this}pushMultiple(t){return this.items.push.apply(this.items,t),t.length=0,this}clear(){return this.items.length=0,this}}let Zt=new Ht,jt=function(t){Zt.push(t)},Qt=function(t,e,i,r,s,n,h,o){if(i===n&&r===h&&s===o)return;let a=Vt(i,r),l=Vt(n,h);if(a){let i=e.get(a);if(i.delete(s),a===l)return void i.set(o,t);0===i.size&&(jt(i),e.delete(a))}if(l){let i=e.get(l);i?i.set(o,t):(i=function(){let t=Zt.pop();return null===t&&(t=new Map),t}(),i.set(o,t),e.set(l,i))}},qt=function(t,e,i,r){let s=Vt(e,i),n=t.get(s);n&&(void 0!==r?(n.delete(r),0===n.size&&(jt(n),t.delete(s))):(n.clear(),jt(n),t.delete(s)))},$t=new Ht,Kt=function(t){$t.push(t)},Jt=function(t,e,i,r){if(i!==r){if(void 0!==i){let r=e.get(i);r&&(r.delete(t),0===r.size&&(Kt(r),e.delete(i)))}if(void 0!==r){let i=e.get(r);i?i.add(t):(i=function(){let t=$t.pop();return null===t&&(t=new Set),t}(),i.add(t),e.set(r,i))}}},te=function(t,e,i){let r=t.get(e);r&&(r.delete(i),0===r.size&&(Kt(r),t.delete(e)))},ee=function(t,e,i,r){let s=t.XYToZMap.get(Vt(e,i));return void 0===s?null:void 0!==r?s.has(r)?s.get(r):null:s},ie=function(t){let e=-1/0;for(const[i,r]of t)e<i&&(e=i);return e},re=function(t){let e=1/0;for(const[i,r]of t)e>i&&(e=i);return e};class se{constructor(){this.chessToXYZ=new Map,this.XYToZMap=new Map,this.XToChessSet=new Map,this.YToChessSet=new Map,this.ZToChessSet=new Map,this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0}destroy(){this.clear()}clear(){return this.chessToXYZ.clear(),this.XYToZMap.clear(),this.XToChessSet.clear(),this.YToChessSet.clear(),this.ZToChessSet.clear(),this.clearBounds(),this}clearBounds(){return this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0,this}addChess(t,e,i,r){return function(t,e,i,r,s){let n=t.chessToXYZ.get(e),h=n?n.x:void 0,o=n?n.y:void 0,a=n?n.y:void 0;n?(n.x=i,n.y=r,n.z=s):t.chessToXYZ.set(e,{x:i,y:r,z:s}),Qt(e,t.XYToZMap,h,o,a,i,r,s),Jt(e,t.XToChessSet,h,i),Jt(e,t.YToChessSet,o,r),Jt(e,t.ZToChessSet,a,s)}(this,t,e,i,r),this.clearBounds(),this}getChess(t,e,i){return ee(this,t,e,i)}removeChess(t,e,i){return function(t,e,i,r){if(void 0!==r){let s=ee(t,e,i,r);if(void 0===s)return;t.chessToXYZ.delete(s),qt(t.XYToZMap,e,i,r),te(t.XToChessSet,e,s),te(t.YToChessSet,i,s),te(t.ZToChessSet,r,s)}else{let r=ee(t,e,i);if(r){for(const[s,n]of r)t.chessToXYZ.delete(n),te(t.XToChessSet,e,n),te(t.YToChessSet,i,n),te(t.ZToChessSet,s,n);qt(t.XYToZMap,e,i)}}}(this,t,e,i),this.clearBounds(),this}hasChess(t){return function(t,e){return t.chessToXYZ.has(e)}(this,t)}contains(t,e,i){return function(t,e,i,r){return null!==ee(t,e,i,r)}(this,t,e,i)}getXYZ(t){return function(t,e){return t.chessToXYZ.get(e)||null}(this,t)}get xMax(){return void 0===this._xMax&&(this._xMax=ie(this.XToChessSet)),this._xMax}get xMin(){return void 0===this._xMin&&(this._xMin=re(this.XToChessSet)),this._xMin}get yMax(){return void 0===this._yMax&&(this._yMax=ie(this.YToChessSet)),this._yMax}get yMin(){return void 0===this._yMin&&(this._yMin=re(this.YToChessSet)),this._yMin}}let ne=function(t,e){if(!t.infinityMode)if(void 0===t.height||t.height<=e)t.height=e;else{for(let i=0;i<t.width;i++)for(let i=e;i<t.height;i++);t.height=e}},he=function(t,e){if(!t.infinityMode)if(void 0===t.width||t.width<=e)t.width=e;else{for(let i=e;i<t.width;i++)for(let e=0;e<t.height;e++);t.width=e}},oe=function(t,e,i,r){return t.boardData.getChess(e,i,r)},ae=function(t,e){let i=t.boardData.getXYZ(e);return i||((r=e)&&(function(t){if("object"!=typeof t||t.nodeType||t===t.window)return!1;try{if(t.constructor&&!{}.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0}(r)||r.isTileXYZ)&&r.hasOwnProperty("x")&&r.hasOwnProperty("y")?e:null);var r},le=function(t,e,i,r){let s;return s=!!t.infinityMode||e>=0&&e<t.width&&i>=0&&i<t.height,s&&void 0!==r&&(s=t.boardData.contains(e,i,r)),s};class ue{constructor(t){this.parent=t,this.board=null,this.blocker=!1,this.boot()}boot(){"object"==typeof this.parent&&this.parent.on&&this.parent.on("destroy",this.destroy,this)}destroy(){this.board&&this.board.removeChess(this.parent),this.parent=void 0,this.board=null}setBoard(t){return this.board=t,this}get tileXYZ(){return null==this.board?null:ae(this.board,this.parent)}setTileZ(t){if(null==this.board)return this;let e=this.tileXYZ;return this.board.addChess(this.parent,e.x,e.y,t,!1),this}setBlocker(t=!0){return this.blocker=t,this}setBlockEdge(t,e=!0){"boolean"==typeof this.blocker&&(this.blocker={});let i=this.blocker;if("object"==typeof t){let e=t;for(let t in e)i[t]=e[t]}else i[t]=e;return this}getBlockEdge(t){return"boolean"!=typeof this.blocker&&(!!this.blocker.hasOwnProperty(t)&&this.blocker[t])}}let de=function(t){return t.hasOwnProperty("rexChess")||(t.rexChess=new ue(t)),t.rexChess},ce=function(t,e=[]){let i=t.boardData.chessToXYZ;for(const[t,r]of i)e.push(t);return e},fe=function(t,e,i,r){return t.grid.getWorldXY(e,i,r)},xe=function(t,e,i,r){if(void 0===e){let e=ce(t);for(let i=0,r=e.length;i<r;i++){let r=e[i],s=ae(t,r);fe(t,s.x,s.y,r)}}else{if(void 0===i){let s=ae(t,e);i=s.x,r=s.y}fe(t,i,r,e)}},ye=function(t,e,i,r,s,n=!1,h=!1){if(e){let n=ae(t,e);if(!n)return;i=n.x,r=n.y,s=n.z}else if(!(e=oe(t,i,r,s)))return;h||t.boardData.removeChess(i,r,s),t._isBoard&&de(e).setBoard(null),n&&e.destroy&&e.destroy()},ge=function(t,e,i,r,s,n=!0){if(!le(t,i,r))return;let h=ae(t,e);void 0===s&&(s=h?h.z:0),h&&h.x===i&&h.y===r&&h.z===s||(oe(t,i,r,s)&&ye(t,null,i,r,s),t.boardData.addChess(e,i,r,s),t._isBoard&&de(e).setBoard(t),n&&xe(t,e,i,r))};let pe=function(t,e,i){let r=ae(t,e),s=ae(t,i),n=fe(t,r.x,r.y,!0),h=n.x,o=n.y;return n=fe(t,s.x,s.y,!0),function(t,e,i,r){return Math.atan2(r-e,i-t)}(h,o,n.x,n.y)},me=function(t,e,i){let r=i-e;return e+((t-e)%r+r)%r},Te=function(t,e,i,r={x:0,y:0}){return!0===r&&(r=be),t.wrapMode?e=me(e,0,t.width):!t.infinityMode&&(e<0||e>=t.width)&&(e=null),t.wrapMode?i=me(i,0,t.height):!t.infinityMode&&(i<0||i>=t.height)&&(i=null),r.x=e,r.y=i,r},be={x:0,y:0},ve=function(t,e,i,r,s){let n=ae(t,e);if(null===n)return null;"string"==typeof i&&(i=-1===i.indexOf(",")?parseInt(i):i.split(".").map(t=>parseInt(t,10)));let h,o="number"==typeof i,a="number"==typeof r;if(o&&a){let e=t.grid.getTileXYAtDirection(n,i,r,s);return Te(t,e.x,e.y,e),null!==e.x&&null!==e.y||(e=null),e}if(Array.isArray(s)||(s=[]),null===i&&(i=t.grid.allDirections),o)if(Array.isArray(r))for(let e=0,o=r.length;e<o;e++)h=ve(t,n,i,r[e]),null!==h&&s.push(h);else{let e,o,a;if(({end:e=1,start:o=(e>0?1:-1),step:a=(e>=o?1:-1)}=r),o===e)h=ve(t,n,i,e),null!==h&&s.push(h);else if(o<e)for(let r=o;r<=e;r+=a)h=ve(t,n,i,r),null!==h&&s.push(h);else for(let r=o;r>=e;r+=a)h=ve(t,n,i,r),null!==h&&s.push(h)}else for(let e=0,o=i.length;e<o;e++)a?(h=ve(t,n,i[e],r),null!==h&&s.push(h)):ve(t,n,i[e],r,s);return s},we=function(t,e,i=null,r={x:0,y:0}){return ve(t,e,i,1,r)},Ee=function(t,e,i){void 0===e&&(e=Se);let r=t.wrapMode,s=t.infinityMode;t.wrapMode=!1,t.infinityMode=!0;let n=we(t,e,i,!0);return t.wrapMode=r,t.infinityMode=s,pe(t,e,n)},Se={x:0,y:0};const _e=180/Math.PI;let Re=function(t){return t*_e},Me=function(t,e){let i=e-t;return 0===i?0:i-360*Math.floor((i- -180)/360)},De=function(t,e,i){i=Re(i);let r=t.grid.allDirections,s=1/0,n=void 0;for(let h=0,o=r.length;h<o;h++){let o=Re(Ee(t,e,r[h])),a=Math.abs(Me(i,o));a<s&&(s=a,n=h)}return n},Ae=function(t,e,i){if(null===e||null===i)return null;if(e.x===i.x&&e.y===i.y)return null;let r=t.grid.getNeighborTileDirection(e,i);if(t.wrapMode&&null===r){let s=we(t,e,null);for(let t=0,e=s.length;t<e;t++){let e=s[t];if(i.x===e.x&&i.y===e.y){r=t;break}}}return r},Ce=function(t,e,i){let r=ae(t,e),s=ae(t,i);return Ae(t,r,s)},ke=function(t,e,i=1,r=[]){let s=t.grid.ringToTileXYArray(e,i);for(let e=0,i=s.length;e<i;e++){let i=s[e];le(t,i.x,i.y)&&r.push(i)}return r},ze=function(t,e,i,r,s={x:0,y:0}){return!0===s&&(s=Fe),0===i&&0===r?(s.x=e.x,s.y=e.y):t.grid.offset(e,i,r,s),s},Fe={x:0,y:0};var Xe;!function(t){t[t["x+,y+"]=0]="x+,y+",t[t["x-,y+"]=1]="x-,y+",t[t["y+,x+"]=2]="y+,x+",t[t["y-,x+"]=3]="y-,x+"}(Xe||(Xe={}));let Be=function(t,e=0,i=[]){if(Array.isArray(e)){let r=e;for(let e=0;e<t.height;e++)for(let s=0;s<t.width;s++){let n=!0;for(let i=0,h=r.length;i<h;i++)if(null!==oe(t,s,e,r[i])){n=!1;break}n&&i.push({x:s,y:e})}}else for(let r=0;r<t.height;r++)for(let s=0;s<t.width;s++)null===oe(t,s,r,e)&&i.push({x:s,y:r});return i},Ye=function(t,e,i,r=[]){let s=t.boardData.getChess(e,i);for(const[t,e]of s)r.push(e);return r},Ne=function(t,e,i,r=[]){let s,n,h=null!=i;for(let o=0,a=e.length;o<a;o++)s=e[o],h?(n=oe(t,s.x,s.y,i),null!==n&&r.push(n)):Ye(t,s.x,s.y,r);return r},Ue=function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},Ie=function(t,e=0,i=t.length){let r=e+Math.floor(Math.random()*i);return void 0===t[r]?null:t[r]},Oe={x:0,y:0},Pe=function(t,e){return!1===t||!0===t?t:!0===t[e]};const Le=2*Math.PI;let We=function(t,e,i,r,s){let n=ae(t,e),h=ae(t,i),o=pe(t,n,h);var a;a=o,o=(a%=Le)>=0?a:a+Le;let l=Math.abs(o-r);l=Math.min(l,Ge-l);let u=s/2;return function(t,e,i=1e-4){return Math.abs(t-e)<i}(l,u)||l<u};const Ge=2*Math.PI;let Ve=function(t,e,i,r={x:0,y:0}){return t.grid.getTileXY(e,i,r)};var He;!function(t){t[t.x=1]="x",t[t.horizontal=1]="horizontal",t[t.h=1]="h",t[t.y=2]="y",t[t.vertical=2]="vertical",t[t.v=2]="v",t[t.xy=3]="xy"}(He||(He={}));let Ze={x:0,y:0},je={x:0,y:0},Qe={x:0,y:0};var qe,$e;!function(t){t[t.orthogonal=0]="orthogonal",t[t.isometric=1]="isometric"}(qe||(qe={})),function(t){t[t["4dir"]=4]="4dir",t[t["8dir"]=8]="8dir"}($e||($e={}));const Ke=[[1,0],[0,1],[-1,0],[0,-1],[1,1],[-1,1],[-1,-1],[1,-1]],Je=Ke;let ti=function(t){let e,i,r,s={};for(let n in t)e=t[n],i=e[0],r=e[1],s.hasOwnProperty(i)||(s[i]={}),s[i][r]=parseInt(n);return s};ti(Ke),ti(Je);var ei,ii,ri;!function(t){t[t.ODD_R=0]="ODD_R",t[t.EVEN_R=1]="EVEN_R",t[t.ODD_Q=2]="ODD_Q",t[t.EVEN_Q=3]="EVEN_Q"}(ei||(ei={})),function(t){t[t.y=0]="y",t[t.flat=0]="flat",t[t.x=1]="x",t[t.pointy=1]="pointy"}(ii||(ii={})),function(t){t[t.even=0]="even",t[t.odd=1]="odd"}(ri||(ri={}));const si=Math.sqrt(3);function ni(t,e,i,r={x:0,y:0,z:0}){switch(!0===r&&(r=oi),t){case ei.ODD_R:r.x=e-(i-(1&i))/2,r.z=i;break;case ei.EVEN_R:r.x=e-(i+(1&i))/2,r.z=i;break;case ei.ODD_Q:r.x=e,r.z=i-(e-(1&e))/2;break;case ei.EVEN_Q:r.x=e,r.z=i-(e+(1&e))/2}return r.y=-r.x-r.z,r}function hi(t,e,i,r,s={x:0,y:0}){switch(!0===s&&(s=ai),t){case ei.ODD_R:s.x=e+(r-(1&r))/2,s.y=r;break;case ei.EVEN_R:s.x=e+(r+(1&r))/2,s.y=r;break;case ei.ODD_Q:s.x=e,s.y=r+(e-(1&e))/2;break;case ei.EVEN_Q:s.x=e,s.y=r+(e+(1&e))/2}return s}let oi={x:0,y:0,z:0},ai={x:0,y:0},li={x:0,y:0,z:0},ui={x:0,y:0,z:0},di={x:0,y:0,z:0},ci={x:0,y:0,z:0},fi=function(t,e,i,r={x:0,y:0}){"object"==typeof e&&(i=e.y,e=e.x),!0===r&&(r=xi);let s=e*t.width,n=i*t.height;switch(t.mode){case ei.ODD_R:1&i&&(s+=t._halfWidth),n*=.75;break;case ei.EVEN_R:1&i&&(s-=t._halfWidth),n*=.75;break;case ei.ODD_Q:s*=.75,1&e&&(n+=t._halfHeight);break;case ei.EVEN_Q:s*=.75,1&e&&(n-=t._halfHeight)}return s+=t.x,n+=t.y,r.x=s,r.y=n,r},xi={x:0,y:0};const yi=Math.PI/180;let gi=[];let pi=[[[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]]],[[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]],[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]]],[[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]],[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]]],[[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]],[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]]]],mi=function(t){let e,i,r={};for(let s in t)[e,i]=t[s],r.hasOwnProperty(e)||(r[e]={}),r[e][i]=parseInt(s);return r},Ti=[[mi(pi[0][0]),mi(pi[0][1])],[mi(pi[1][0]),mi(pi[1][1])],[mi(pi[2][0]),mi(pi[2][1])],[mi(pi[3][0]),mi(pi[3][1])]];function bi(t,e,i){let r;switch(t){case ei.ODD_R:case ei.EVEN_R:r=1&i;break;case ei.ODD_Q:case ei.EVEN_Q:r=1&e}return r}let vi=function(t,e,i,r,s={x:0,y:0}){!0===s&&(s=wi);let n=t.mode,h=e.x,o=e.y;if(1===r){let t=bi(n,h,o);s.x=h+pi[n][t][i][0],s.y=o+pi[n][t][i][1]}else if(0===r)s.x=h,s.y=o;else{let t,e,a,l=ni(n,h,o,!0);switch(i){case 1:t=l.x,e=l.y-r,a=l.z+r;break;case 2:t=l.x-r,e=l.y,a=l.z+r;break;case 3:t=l.x-r,e=l.y+r,a=l.z;break;case 4:t=l.x,e=l.y+r,a=l.z-r;break;case 5:t=l.x+r,e=l.y,a=l.z-r;break;default:t=l.x+r,e=l.y-r,a=l.z}hi(n,t,0,a,s)}return s},wi={x:0,y:0};let Ei=function(t,e,i,r={x:0,y:0}){let s,n;switch("object"==typeof e&&(i=e.y,e=e.x),!0===r&&(r=_i),e-=t.x,i-=t.y,t.mode){case ei.ODD_R:case ei.EVEN_R:n=i*(4/3)/t.height,s=e/t.width-2/3*(i/t.height);break;case ei.ODD_Q:case ei.EVEN_Q:n=i/t.height-2/3*(e/t.width),s=e*(4/3)/t.width}let h=function(t,e,i={x:0,y:0,z:0}){return!0===i&&(i=oi),i.x=t,i.y=-t-e,i.z=e,i}(s,n,Si);return function(t,e,i,r={x:0,y:0,z:0}){"number"!=typeof t&&(t=(r=t).x,e=r.y,i=r.z),!0===r&&(r=oi);let s=Math.round(t),n=Math.round(e),h=Math.round(i),o=Math.abs(s-t),a=Math.abs(n-e),l=Math.abs(h-i);o>a&&o>l?s=-n-h:a>l?n=-s-h:h=-s-n,r.x=s,r.y=n,r.z=h}(h),hi(t.mode,h.x,h.y,h.z,r),r},Si={x:0,y:0,z:0},_i={x:0,y:0},Ri={x:0,y:0},Mi={x:0,y:0},Di={x:0,y:0};class Ai extends class{constructor({x:t=0,y:e=0,radius:i,cellWidth:r=0,cellHeight:s=0,staggerAxis:n=ii.x,staggerIndex:h=ri.odd}={}){this.setType(n,h),this.setDirectionMode(),this.setOriginPosition(t,e),void 0!==i?this.setRadius(i):this.setCellSize(r,s)}fromJSON({x:t=0,y:e=0,radius:i,cellWidth:r=0,cellHeight:s=0,staggerAxis:n=ii.x,staggerIndex:h=ri.odd}={}){return this.setType(n,h),this.setDirectionMode(),this.setOriginPosition(t,e),void 0!==i?this.setRadius(i):this.setCellSize(r,s),this}toJSON(){return{x:this.x,y:this.y,radius:this.radius,cellWidth:this.cellWidth,cellHeight:this.cellHeight,staggerAxis:this.staggerAxis,staggerIndex:this.staggerIndex}}setOriginPosition(t,e){return this.x=t,this.y=e,this}get width(){return this._width}set width(t){this._width=t,this._halfWidth=t/2}get height(){return this._height}set height(t){this._height=t,this._halfHeight=t/2}setCellSize(t=0,e=0){return this.width=t,this.height=e,this.radius=void 0,this}get cellWidth(){return this.width}set cellWidth(t){this.width=t}get cellHeight(){return this.height}set cellHeight(t){this.height=t}setRadius(t=0){let e,i;return this.staggerAxis===ii.y?(e=2*t,i=si*t):(e=si*t,i=2*t),this.setCellSize(e,i),this.radius=t,this}setDirectionMode(){return this.directions=6,this}setType(t=1,e=1){return"string"==typeof t&&(t=ii[t]),"string"==typeof e&&(e=ri[e]),this.staggerAxis=t,this.staggerIndex=e,t===ii.y?this.mode=e===ri.even?ei.EVEN_Q:ei.ODD_Q:this.mode=e===ri.even?ei.EVEN_R:ei.ODD_R,this}}{get sides(){return 6}get allDirections(){return Ci}get halfDirections(){return ki}directionBetween(t,e,i=!0){return function(t,e,i,r=!0){let s;ni(t.mode,e.x,e.y,li),ni(t.mode,i.x,i.y,ui);let n=ui.x-li.x,h=ui.y-li.y,o=ui.z-li.z;return s=0===o?n>0?0:3:0===n?o>0?1:4:0===h?o>0?2:5:n>0&&h<0&&o>0?0+o/-h:n<0&&h<0&&o>0?1+-h/o:n<0&&h>0&&o>0?2+h/-n:n<0&&h>0&&o<0?3+-o/h:n>0&&h>0&&o<0?4+n/-o:5+-h/n,r&&(s=Math.round(s)),s}(this,t,e,i)}directionNormalize(t){return function(t,e){return function(t,e,i){let r=i-e;return e+((t-e)%r+r)%r}(e,0,t.directions)}(this,t)}getDistance(t,e,i=!1){return function(t,e,i,r=!1){ni(t.mode,e.x,e.y,di),ni(t.mode,i.x,i.y,ci);let s=ci.x-di.x,n=ci.y-di.y,h=ci.z-di.z;return(Math.abs(s)+Math.abs(n)+Math.abs(h))/2}(this,t,e,i)}getGridPoints(t=0,e=0,i=[]){return function(t,e=0,i=0,r=[]){if("object"==typeof e){let t=e;i=t.y,e=t.x}let s,n;if(!0===r&&(r=gi),function(t,e=[]){if(e.length===t);else if(e.length<t)for(let i=e.length;i<t;i++)e.push({x:0,y:0});else e.length=t}(6,r),({x:s,y:n}=fi(t,e,i)),void 0!==t.radius){let e=t.radius,i=t.staggerAxis===ii.flat?0:-30;for(let t=0;t<6;t++){let h=(60*t+i)*yi;r[t].x=s+e*Math.cos(h),r[t].y=n+e*Math.sin(h)}}else{let e=t._halfWidth,i=e/2,h=t._halfHeight,o=h/2;t.staggerAxis===ii.flat?(r[0].x=s+e,r[0].y=n,r[1].x=s+i,r[1].y=n+h,r[2].x=s-i,r[2].y=n+h,r[3].x=s-e,r[3].y=n,r[4].x=s-i,r[4].y=n-h,r[5].x=s+i,r[5].y=n-h):(r[0].x=s+e,r[0].y=n-o,r[1].x=s+e,r[1].y=n+o,r[2].x=s,r[2].y=n+h,r[3].x=s-e,r[3].y=n+o,r[4].x=s-e,r[4].y=n-o,r[5].x=s,r[5].y=n-h)}return r}(this,t,e,i)}getNeighborTileDirection(t,e){return function(t,e,i){let r=t.mode,s=bi(r,e.x,e.y),n=Ti[r][s],h=i.x-e.x,o=i.y-e.y;if(n.hasOwnProperty(h)){let t=n[h];if(t.hasOwnProperty(o))return t[o]}return null}(this,t,e)}getNeighborTileXY(t,e,i={x:0,y:0}){return function(t,e,i,r={x:0,y:0}){return vi(t,e,i,1,r)}(this,t,e,i)}getOppositeDirection(t,e,i){return function(t,e,i,r){return(r+3)%6}(0,0,0,i)}getTileXY(t,e,i={x:0,y:0}){return Ei(this,t,e,i)}getTileXYAtDirection(t,e,i,r={x:0,y:0}){return vi(this,t,e,i,r)}getWorldXY(t,e,i={x:0,y:0}){return fi(this,t,e,i)}mirror(t,e,i={x:0,y:0}){return function(t,e,i,r={x:0,y:0}){"string"==typeof i&&(i=He[i]),!0===r&&(r=Ri);let s,n,h,o=ni(t.mode,e.x,e.y,!0),a=t.mode===ei.ODD_R||t.mode===ei.EVEN_R;return 1&i&&(a?(s=o.y,n=o.x,h=o.z):(s=-o.x,n=-o.z,h=-o.y),o.x=s,o.y=n,o.z=h),2&i&&(a?(s=-o.y,n=-o.x,h=-o.z):(s=o.x,n=o.z,h=o.y)),hi(t.mode,s,0,h,r),r}(this,t,e,i)}offset(t,e,i,r={x:0,y:0}){return function(t,e,i,r,s={x:0,y:0}){!0===s&&(s=Mi);let n=e.x+i,h=e.y+r;switch(t.mode){case ei.ODD_R:0!=(1&r)&&0==(1&h)&&(n+=1);break;case ei.EVEN_R:0!=(1&r)&&0==(1&h)&&(n-=1);break;case ei.ODD_Q:0!=(1&i)&&0==(1&n)&&(h+=1);break;case ei.EVEN_Q:0!=(1&i)&&0==(1&n)&&(h-=1)}return s.x=n,s.y=h,s}(this,t,e,i,r)}ringToTileXYArray(t,e,i=[]){return function(t,e,i,r=[]){let s,n,h,o=ni(t.mode,e.x,e.y,!0),a=o.x,l=(o.y,o.z);for(h=i,s=0;s>=-i;s--)n=-s-h,r.push(hi(t.mode,a+s,0,l+h));for(s=-i,n=1;n<=i;n++)h=-s-n,r.push(hi(t.mode,a+s,0,l+h));for(n=i,h=-1;h>=-i;h--)s=-n-h,r.push(hi(t.mode,a+s,0,l+h));for(h=-i,s=1;s<=i;s++)n=-s-h,r.push(hi(t.mode,a+s,0,l+h));for(s=i,n=-1;n>=-i;n--)h=-s-n,r.push(hi(t.mode,a+s,0,l+h));for(n=-i,h=1;h<=i-1;h++)s=-n-h,r.push(hi(t.mode,a+s,0,l+h));return r}(this,t,e,i)}rotate(t,e,i={x:0,y:0}){return function(t,e,i,r={x:0,y:0}){!0===r&&(r=Di),i=me(i,0,5);let s,n,h,o=ni(t.mode,e.x,e.y,!0);switch(i){case 1:s=-o.z,n=-o.x,h=-o.y;break;case 2:s=o.y,n=o.z,h=o.x;break;case 3:s=-o.x,n=-o.y,h=-o.z;break;case 4:s=o.z,n=o.x,h=o.y;break;case 5:s=-o.y,n=-o.z,h=-o.x;break;default:s=o.x,n=o.y,h=o.z}return hi(t.mode,s,0,h,r),r}(this,t,e,i)}restoreOrigin(){var t;return(t=this).x=t._savedOriginX,t.y=t._savedOriginY,this}saveOrigin(){var t;return(t=this)._savedOriginX=t.x,t._savedOriginY=t.y,this}}const Ci=[0,1,2,3,4,5],ki=[0,1,2];var zi;!function(t){t[t.random=0]="random",t[t.diagonal=1]="diagonal",t[t.straight=2]="straight",t[t.line=3]="line",t[t.astar=10]="astar",t[t["astar-random"]=11]="astar-random",t[t["astar-line"]=12]="astar-line"}(zi||(zi={}));let Fi=function(t,e,i=[]){let r=e;for(;r.prevNodes.length>0;)i.push(r),r=r.prevNodes[0];return i.reverse()},Xi={};Xi[zi.astar]=Fi,Xi[zi["astar-line"]]=Fi,Xi[zi["astar-random"]]=Fi,Xi[zi.random]=function(t,e,i=[]){let r=e;for(;r.prevNodes.length>0;)i.push(r),r=1===r.prevNodes.length?r.prevNodes[0]:Ie(r.prevNodes);return i.reverse()},Xi[zi.line]=function(t,e,i=[]){let r=e,s=e.angleTo(t);for(;r.prevNodes.length>0;)if(i.push(r),1===r.prevNodes.length)r=r.prevNodes[0];else{let t=1/0;for(let i=1,n=r.prevNodes.length;i<n;i++){let n=r.prevNodes[i],h=Math.abs(e.angleTo(n)-s);h<t&&(t=h,r=n)}}return i.reverse()},Xi[zi.diagonal]=function(t,e,i=[]){let r,s=e;for(;s.prevNodes.length>0;)if(i.push(s),1===s.prevNodes.length||void 0===r){let t=s.prevNodes[0];r=t.logicDirTo(s),s=t}else{let t,e;for(let i=0,n=s.prevNodes.length;i<n&&(t=s.prevNodes[i],e=t.logicDirTo(s),e===r);i++);r=e,s=t}return i.reverse()},Xi[zi.straight]=function(t,e,i=[]){let r,s=e;for(;s.prevNodes.length>0;)if(i.push(s),1===s.prevNodes.length||void 0===r){let t=s.prevNodes[0];r=t.logicDirTo(s),s=t}else{let t,e;for(let i=0,n=s.prevNodes.length;i<n&&(t=s.prevNodes[i],e=t.logicDirTo(s),e!==r);i++);r=e,s=t}return i.reverse()};let Bi=function(t,e,i,r,s){let n,h,o="number"==typeof e;o?(n=e,h=null):n=e.length;let a,l,u=t.wildcard,d=t.board,c=[];for(let f=0;f<n;f++){if(void 0===l)l={x:i,y:r};else if(l=we(d,l,s,l),null===l)return!1;if(a=t.getSymbol(l.x,l.y),null==a)return!1;if(a!==u)if(o){if(null===h)h=a;else if(h!==a)return!1}else if(e[f]!==a)return!1;c.push({x:l.x,y:l.y})}return{tileXY:c,direction:s,pattern:e}},Yi=function(t,e,i,r,s=!1){let n,h,o=t.board,a=o.grid.halfDirections,l=t.dirMask,u=o.width,d=o.height;for(let c=0,f=a.length;c<f;c++)if(n=a[c],!1!==l[n])for(let a=0;a<d;a++)for(let l=0;l<u;l++)if(h=Bi(t,e,l,a,n),!1!==h&&(i&&(r?i.call(r,h,o):i(h,o)),s))return h};let Ni=new class{constructor(){this.data=[],this.visited=new Set}push(t,e){if(Array.isArray(t)){let e=t;for(let t=0,i=e.length;t<i;t++)this.push(e[t]);return this}if("object"==typeof t){let i=t;t=i.x,e=i.y}let i=`${t},${e}`;return this.visited.has(i)||(this.data.push({x:t,y:e}),this.visited.add(i)),this}pop(){return this.data.pop()}get length(){return this.data.length}clear(){return this.data.length=0,this.visited.clear(),this}};class Ui{constructor({board:t,wildcard:e,dirMask:i}={}){this.symbols=[],this.dirMask={},this.setBoard(t),this.setWildcard(e),void 0!==i&&this.setDirMask(i),this.boot()}boot(){}destroy(){this.board=void 0,this.symbols=void 0,this.dirMask=void 0}setBoard(t){return this.board=t,t&&this.clearSymbols(),this}setDirMask(t,e=!1){if("object"==typeof t){let e=t;for(let t in e)this.dirMask[t]=e[t]}else this.dirMask[t]=e;return this}setDirectionMode(t){return this.board.grid.setDirectionMode(t),this}clearSymbols(){return this.refreshSymbols(null),this}setSymbol(t,e,i){return le(this.board,t,e)?(this.symbols[this.tileXYToKey(t,e)]=i,this):this}getSymbol(t,e){return this.symbols[this.tileXYToKey(t,e)]}forEach(t,e){let i,r,s=this.board;for(let n=0,h=this.symbols.length;n<h;n++)r=this.symbols[n],i=this.keyToTileXY(n,!0),e?t.call(e,r,i,s):t(r,i,s);return this}refreshSymbols(t,e){let i,r,s=this.board,n=s.width,h=s.height;if(this.symbols.length=n*h,"function"==typeof t)for(let n=0,h=this.symbols.length;n<h;n++)r=this.keyToTileXY(n,!0),i=e?t.call(e,r,s):t(r,s),this.symbols[n]=i;else{i=t;for(let t=0,e=this.symbols.length;t<e;t++)this.symbols[t]=i}return this}setWildcard(t){return this.wildcard=t,this}tileXYToKey(t,e){return t+e*this.board.width}keyToTileXY(t,e={x:0,y:0}){!0===e&&(e=Ii);let i=this.board.width;return e.x=t%i,e.y=Math.floor(t/i),e}group(t,e,i=[]){return function(t,e,i,r=[]){let s,n,h=t.board,o=t.wildcard,a=t.getSymbol(e,i);if(null==a||a===o)return r;for(Ni.push(e,i);Ni.length;)s=Ni.pop(),n=t.getSymbol(s.x,s.y),n!==a&&n!==o||(r.push(s),Ni.push(we(h,s)));return Ni.clear(),r}(this,t,e,i)}match(t,e,i,r=!1){return Yi(this,t,e,i,r),this}matchAny(t){return function(t,e){let i=Yi(t,e,null,null,!0);return i||!1}(this,t)}matchAtDir(t,e,i,r){return Bi(this,t,e,i,r)}}let Ii={x:0,y:0},Oi=function(t,e,i){switch(typeof t){case"number":return"#"+t.toString(16);case"function":return t(e,i);default:return t}},Pi=function(t,{points:e,fillStyle:i,strokeStyle:r,lineWidth:s=2,lineJoin:n="round"}={points:[]}){return function(t,e,i,r=1){let s;if("string"==typeof t){let e=vt();e.has(t)||e.add(t,Yt()),s=e.get(t)}else s=t;let n=s.image,h=n.getContext("2d");return i?e.call(i,n,h):e(n,h),s.setSize(n.width/r,n.height/r),s.binding&&s.binding.update(),s}(t,(function(t,h){if(0===e.length)return t.width=1,void(t.height=1);r||(s=0);let o=Wi(e,"x"),a=Wi(e,"y"),l=Li(e,"x")-o,u=Li(e,"y")-a,d=l/2,c=u/2,f=s/2;t.width=Math.ceil(l),t.height=Math.ceil(u),h.beginPath(),h.lineJoin=n;let x=e[0];h.moveTo(Gi(x.x-o,d,f),Gi(x.y-a,c,f));for(let t=1,i=e.length;t<i;t++)x=e[t],h.lineTo(Gi(x.x-o,d,f),Gi(x.y-a,c,f));h.closePath(),i&&(h.fillStyle=Oi(i,t,h),h.fill()),r&&(h.strokeStyle=Oi(r,t,h),h.lineWidth=s,h.stroke())}))},Li=function(t,e){let i=-1/0;for(let r=0,s=t.length;r<s;r++)i=Math.max(i,t[r][e]);return i},Wi=function(t,e){let i=1/0;for(let r=0,s=t.length;r<s;r++)i=Math.min(i,t[r][e]);return i},Gi=function(t,e,i){return t<e?t+i:t>e?t-i:t};var Vi;!function(t){t[t.right=0]="right",t[t.down=1]="down",t[t.left=2]="left",t[t.up=3]="up"}(Vi||(Vi={}));const Hi=[16711680,65280,255,8388736,8421376,32896];class Zi extends Bt{constructor(){super(0,0,"chess")}setSymbol(t){return this.__symbol=t,function(t,...e){e.forEach(e=>{const i=e.vertexTint;i[0]=t,i[1]=t,i[2]=t,i[3]=t,Ft(e)})}(Hi[t],this),this}getSymbol(){return this.__symbol}}class ji extends class extends class extends class{constructor({grid:t,wrap:e=!1,inifinity:i=!1,width:r=0,height:s=0}={}){this.boardData=new se,this._isBoard=!0,this.setGrid(t),this.setWrapMode(e),this.setInfinityMode(i),this.setBoardSize(r,s)}destroy(){}setGrid(t){return this.grid=t,this}setWrapMode(t=!0){return this.wrapMode=t,this}setInfinityMode(t=!0){return this.infinityMode=t,this}setBoardSize(t=0,e=0){return he(this,t),ne(this,e),this}addChess(t,e,i,r,s=!0){return ge(this,t,e,i,r,s),this}removeChess(t,e,i,r,s=!1,n=!1){return ye(this,t,e,i,r,s,n),this}}{angleBetween(t,e){return pe(this,t,e)}angleSnapToDirection(t,e){return De(this,t,e)}angleToward(t,e){return Ee(this,t,e)}areNeighbors(t,e){return function(t,e,i){return null!==Ce(t,e,i)}(this,t,e)}chessToTileXYZ(t){return ae(this,t)}contains(t,e,i){return le(this,t,e,i)}directionBetween(t,e,i=!0){return function(t,e,i,r=!0){let s=ae(t,e),n=ae(t,i);return null===s||null===n?null:t.grid.directionBetween(s,n,r)}(this,t,e,i)}filledRingToTileXYArray(t,e,i=!0,r=[]){return function(t,e,i,r=!0,s=[]){for(let n=0;n<=i;n++){ke(t,e,r?n:i-n,s)}return s}(this,t,e,i,r)}fit(t){return function(t,e){let i,r=1/0,s=1/0;for(let t=0,n=e.length;t<n;t++)i=e[t],r=Math.min(r,i.x),s=Math.min(s,i.y);if(0!==r||0!==s)for(let n=0,h=e.length;n<h;n++)i=e[n],ze(t,i,-r,-s,i);let n=-1/0,h=-1/0;for(let t=0,r=e.length;t<r;t++)i=e[t],n=Math.max(n,i.x),h=Math.max(h,i.y);return he(t,n+1),ne(t,h+1),e}(this,t)}forEachTileXY(t,e,i=0){return function(t,e,i,r=Xe["x+,y+"]){let s={x:0,y:0};switch(r){case Xe["x+,y+"]:for(let r=0;r<t.height;r++)for(let n=0;n<t.width;n++)s.x=n,s.y=r,i?e.call(i,s,t):e(s,t);break;case Xe["x-,y+"]:for(let r=0;r<t.height;r++)for(let n=t.width-1;n>=0;n--)s.x=n,s.y=r,i?e.call(i,s,t):e(s,t);break;case Xe["y+,x+"]:for(let r=0;r<t.width;r++)for(let n=0;n<t.height;n++)s.x=r,s.y=n,i?e.call(i,s,t):e(s,t);break;case Xe["y-,x+"]:for(let r=0;r<t.width;r++)for(let n=t.height-1;n>=0;n--)s.x=r,s.y=n,i?e.call(i,s,t):e(s,t)}}(this,t,e,i),this}getAllChess(t=[]){return ce(this,t)}getChessData(t){return de(t)}getDistance(t,e,i=!1){return function(t,e,i,r){return t.grid.getDistance(e,i,r)}(this,t,e,i)}getEmptyTileXYArray(t=0,e=[]){return Be(this,t,e)}getGridPoints(t,e,i){return function(t,e,i,r){return t.grid.getGridPoints(e,i,r)}(this,t,e,i)}getNeighborChess(t,e,i,r){return function(t,e,i,r,s){let n=ae(t,e);if(null===n)return null;null==r&&(r=n.hasOwnProperty("z")?n.z:null);let h=we(t,n,i,!0);return null===h?null:Array.isArray(h)?(void 0===s&&(s=[]),Ne(t,h,r,s)):null==r?(void 0===s&&(s=[]),Ye(t,h.x,h.y,s)):oe(t,h.x,h.y,r)}(this,t,e,i,r)}getNeighborChessDirection(t,e){return Ce(this,t,e)}getNeighborTileDirection(t,e){return Ae(this,t,e)}getNeighborTileXY(t,e=null,i={x:0,y:0}){return we(this,t,e,i)}getNeighborTileXYAtAngle(t,e,i={x:0,y:0}){return function(t,e,i,r={x:0,y:0}){let s=De(t,e,i);return ve(t,e,s,1,r)}(this,t,e,i)}getOppositeDirection(t,e,i){return function(t,e,i,r){return t.grid.getOppositeDirection(e,i,r)}(this,t,e,i)}getRandomEmptyTileXY(t=0,e={x:0,y:0}){return function(t,e=0,i={x:0,y:0}){!0===i&&(i=Oe);let r=Math.floor(t.width*t.height*.3);for(let s=0;s<r;s++){let r=Ue(0,t.width-1),s=Ue(0,t.height-1);if(null===oe(t,r,s,e))return i.x=r,i.y=s,i}let s=Be(t,e);if(0===s.length)return null;{let t=Ie(s);return i.x=t.x,i.y=t.y,i}}(this,t,e)}getTileXYAtDirection(t,e,i,r){return ve(this,t,e,i,r)}getWrapTileXY(t,e,i={x:0,y:0}){return Te(this,t,e,i)}gridAlign(t,e,i){return xe(this,t,e,i),this}hasBlocker(t,e,i){return function(t,e,i,r){if(void 0===r){let r=Ye(t,e,i);for(let t=0,e=r.length;t<e;t++){if(!0===de(r[t]).blocker)return!0}return!1}{let s=oe(t,e,i,r);return null!==s&&!0===de(s).blocker}}(this,t,e,i)}hasChess(t){return function(t,e){return t.boardData.chessToXYZ.has(e)}(this,t)}hasEdgeBlocker(t,e,i,r){return function(t,e,i,r,s){if(void 0===r){let r=Ye(t,e,i);for(let t=0,e=r.length;t<e;t++)if(Pe(de(r[t]).blocker,s))return!0;return!1}{let n=oe(t,e,i,r);return null!==n&&Pe(de(n).blocker,s)}}(this,t,e,i,r)}isAngleInCone(t,e,i,r){return We(this,t,e,i,r)}isDirectionInCone(t,e,i,r){return function(t,e,i,r,s){let n=ae(t,e),h=ae(t,i),o=t.grid.directions;t.grid.directions=t.grid.sides;let a=t.grid.directionBetween(n,h,!1);t.grid.directions=o;let l=Math.abs(a-r);return l=Math.min(l,t.grid.directions-l),l<=s/2}(this,t,e,i,r)}isOverlappingPoint(t,e,i){return function(t,e,i,r){if(t.infinityMode&&void 0===r)return!0;let s=Ve(t,e,i,!0);return le(t,s.x,s.y,r)}(this,t,e,i)}mirror(t,e,i=null,r={x:0,y:0}){return function(t,e,i,r=null,s={x:0,y:0}){return!0===s&&(s=Ze),null!==r?ze(t,e,-r.x,-r.y,s):(s.x=e.x,s.y=e.y),t.grid.mirror(s,i,s),null!==r&&ze(t,s,r.x,r.y,s),s}(this,t,e,i,r)}offset(t,e,i,r){return ze(this,t,e,i,r)}removeAllChess(t=!1,e=!1){return function(t,e=!1,i=!1){let r=ce(t);for(let s=0,n=r.length;s<n;s++)ye(t,r[s],void 0,void 0,void 0,e,i)}(this,t,e),this}ringToTileXYArray(t,e=1,i=[]){return ke(this,t,e,i)}rotate(t,e,i=null,r={x:0,y:0}){return function(t,e,i,r=null,s={x:0,y:0}){return!0===s&&(s=je),null!==r?ze(t,e,-r.x,-r.y,s):(s.x=e.x,s.y=e.y),t.grid.rotate(s,i,s),null!==r&&ze(t,s,r.x,r.y,s),s}(this,t,e,i,r)}setBoardWidth(t=0){return he(this,t),this}setBoardHeight(t=0){return ne(this,t),this}swapChess(t,e,i=!0){return function(t,e,i,r=!0){let s=ae(t,e),n=ae(t,i);null!=s&&null!=n&&(ye(t,e),ye(t,i),ge(t,e,n.x,n.y,n.z,r),ge(t,i,s.x,s.y,s.z,r))}(this,t,e,i),this}tileXYArrayToChessArray(t,e,i=[]){return Ne(this,t,e,i)}tileXYToChessArray(t,e,i=[]){return Ye(this,t,e,i)}tileXYZToChess(t,e,i){return oe(this,t,e,i)}tileZToChessArray(t,e=[]){return function(t,e,i=[]){let r=t.boardData.ZToChessSet.get(e);if(r)for(const t of r)i.push(t);return i}(this,t,e)}tileXYArrayToWorldXYArray(t,e=[]){return function(t,e,i=[]){for(let r=0,s=e.length;r<s;r++){let s=e[r];i.push(fe(t,s.x,s.y))}return i}(this,t,e)}tileXYToWorldXY(t,e,i={x:0,y:0}){return fe(this,t,e,i)}worldXYSnapToGrid(t,e,i={x:0,y:0}){return function(t,e,i,r={x:0,y:0}){return!0===r&&(r=Qe),Ve(t,e,i,r),fe(t,r.x,r.y,r),r}(this,t,e,i)}worldXYToChess(t,e,i,r){return function(t,e,i,r,s){let n=Ve(t,e,i,!0);return void 0!==r?oe(t,n.x,n.y,r):Ye(t,n.x,n.y,s)}(this,t,e,i,r)}worldXYToTileXY(t,e,i){return Ve(this,t,e,i)}}{}{constructor(t){super(t),this.match=new Ui({board:this}),this.lastMatchedCount=0,Pi("tile",{points:this.getGridPoints(),strokeStyle:"white",lineWidth:2,lineJoin:"miter"}),Pi("chess",{points:this.getGridPoints(),fillStyle:"white"})}setWorld(t){return this.world=t,this}strokeGrid(){return this.forEachTileXY(t=>{let e=this.tileXYToWorldXY(t.x,t.y,!0),i=new Bt(e.x,e.y,"tile");it(this.world,i)}),this}fillChess(){return this.forEachTileXY(t=>{let e=new Zi;var i,r;e.setSymbol((i=0,r=Hi.length-1,Math.floor(Math.random()*(r-i+1)+i))),it(this.world,e),this.addChess(e,t.x,t.y,0)}),this}refreshSymbols(){return this.match.refreshSymbols(t=>{var e=this.tileXYZToChess(t.x,t.y,0);return null===e?null:e.getSymbol()}),this}match3(){let t=0;return this.refreshSymbols(),this.match.match(3,e=>{let i=this.tileXYArrayToChessArray(e.tileXY,0);for(let t=0,e=i.length;t<e;t++)Gt(.5,i[t]);t++}),this.lastMatchedCount=t,this}}var Qi,qi;new class extends class{constructor(){this.events=new Map}}{constructor(...t){super(),this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,s(this),function(t){const e=document.readyState;if("complete"===e||"interactive"===e)return void t();const i=()=>{document.removeEventListener("deviceready",i,!0),document.removeEventListener("DOMContentLoaded",i,!0),window.removeEventListener("load",i,!0),t()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",i,!0):(document.addEventListener("DOMContentLoaded",i,!0),window.addEventListener("load",i,!0)):window.setTimeout(i,20)}(()=>this.boot(t))}boot(t){t.forEach(t=>t());const e=T;this.renderer=new e,this.textureManager=new Et,this.sceneManager=new mt;const i=S();i&&function(t,e){E(e).appendChild(t)}(this.renderer.canvas,i),this.isBooted=!0,function(){{const t=" v"+r().VERSION;console.log(`%cPhaser${t}%c https://phaser4.io`,"padding: 4px 16px; color: #fff; background: linear-gradient(#3e0081 40%, #00bcc3)","")}}(),tt(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(t){const e=t-this.lastTick;this.lastTick=t,this.elapsed+=e,this.isPaused||(this.willUpdate&&(this.sceneManager.update(e,t),tt(this,"update",e,t)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,h(this.frame),o(this.elapsed),requestAnimationFrame(t=>this.step(t))}destroy(){}}(()=>{T=Z},function(t=800,e=600,i=1){return 0===i&&(i=window.devicePixelRatio),()=>{l=t,u=e,d=i}}(800,600),(qi="game",()=>{qi&&(b=E(qi))}),function(t=0){return()=>{a=t}}(2960685),(Qi=class extends class{constructor(t){this.game=r(),this.events=new Map,Wt(this,t)}}{constructor(){super();const t=new Lt(this),e=new ji({grid:new Ai({x:80,y:80,cellWidth:60,cellHeight:68}),width:8,height:8});e.setWorld(t).strokeGrid().fillChess().match3();const i=new Nt(0,580,"Match count= "+e.lastMatchedCount);i.setOrigin(0),it(t,i)}},()=>{_=[].concat(Qi)}))}();
//# sourceMappingURL=bundle.js.map

(()=>{var ph=Object.defineProperty,Ui=a=>ph(a,"__esModule",{value:!0}),Md=(a,b)=>{Ui(a);for(var c in b)ph(a,c,{get:b[c],enumerable:!0})};let Wd,Xd=0,Yd=0;const y={get:()=>Wd,set:a=>{Wd=a},getFrame:()=>Xd,setFrame:a=>{Xd=a},getElapsed:()=>Yd,setElapsed:a=>{Yd=a}};let $d=0;function Fc(a=0){return()=>{$d=a}}function xb(){return $d}let Sc="Phaser",uh="https://phaser4.io",vh="#fff",wh="linear-gradient(#3e0081 40%, #00bcc3)";function Pc(){if(Sc!==""){const a=y.get(),b=Sc==="Phaser"?" v"+a.VERSION:"";console.log(`%c${Sc}${b}%c ${uh}`,`padding: 4px 16px; color: ${vh}; background: ${wh}`,"")}}let ee=800,fe=600,ge=1;function Ic(a=800,b=600,c=1){return c===0&&(c=window.devicePixelRatio),()=>{ee=a,fe=b,ge=c}}function Aa(){return ee}function Ba(){return fe}function Ca(){return ge}const hd=[],Ga={add:a=>{hd.push(a)},get:()=>hd,clear:()=>{hd.length=0}};let de;function yb(a){de=a}function Qc(){return de}let Tc=.5,Uc=.5;let ae=0;function Vc(a){ae=a}function Ya(){return ae}function zb(a){let b;return a&&(typeof a==="string"?b=document.getElementById(a):typeof a==="object"&&a.nodeType===1&&(b=a)),b||(b=document.body),b}let be;function Gc(a){return()=>{a&&(be=zb(a))}}function Rc(){return be}let ce=[];function Hc(a){return()=>{ce=[].concat(a)}}function Wc(){return ce}let yh={alpha:!1,antialias:!1,depth:!1,premultipliedAlpha:!1};function Xc(){return yh}class Hf{constructor(a){this.stack=[],this.current=null,this.renderer=a}reset(){this.stack=[],this.current=null;const a=this.renderer,b=a.gl;b.bindFramebuffer(b.FRAMEBUFFER,null),b.viewport(0,0,a.width,a.height)}add(a,b=!0,c=0,d=0){this.stack.push({framebuffer:a,width:c,height:d}),this.set(a,b,c,d)}set(a,b=!0,c=0,d=0){const e=this.renderer,f=e.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),b&&(f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),c>0&&f.viewport(0,0,c,d),this.current=a}pop(){this.stack.pop();const a=this.stack.length;if(a>0){const b=this.stack[a-1];this.set(b.framebuffer,!1,b.width,b.height)}else this.reset()}rebind(){const a=this.renderer.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.current)}destroy(){this.stack=[]}}let Gf;const z={get:()=>Gf,set:a=>{Gf=a}};function If(a,b=[]){const c=a>>16&255,d=a>>8&255,e=a&255,f=a>16777215?a>>>24:255;return b[0]=c/255,b[1]=d/255,b[2]=e/255,b[3]=f/255,b}function Kb(a,b){return a.a===b.a&&a.b===b.b&&a.c===b.c&&a.d===b.d&&a.tx===b.tx&&a.ty===b.ty}function Pf(a,b){const c=z.get();b||(b=c.COLOR_ATTACHMENT0);const d=c.createFramebuffer();return c.bindFramebuffer(c.FRAMEBUFFER,d),c.framebufferTexture2D(c.FRAMEBUFFER,b,c.TEXTURE_2D,a,0),c.bindFramebuffer(c.FRAMEBUFFER,null),d}function Tb(a){const b=z.get();if(!b)return;const{parent:c,flipY:d,unpackPremultiplyAlpha:e,minFilter:f,magFilter:g,wrapS:h,wrapT:i,generateMipmap:j,isPOT:k}=a,l=c.image;let m=c.width,n=c.height;const s=b.createTexture();return b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,s),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,d),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),l?(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,l),m=l.width,n=l.height):b.texImage2D(b.TEXTURE_2D,0,b.RGBA,m,n,0,b.RGBA,b.UNSIGNED_BYTE,null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,g),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,h),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,i),j&&k&&b.generateMipmap(b.TEXTURE_2D),a.texture=s,s}function Qf(a){const b=z.get();b&&b.isFramebuffer(a)&&b.deleteFramebuffer(a)}function id(a){const b=z.get();if(!b)return;b.isTexture(a)&&b.deleteTexture(a)}function Qb(a,b){return a<1||b<1?!1:(a&a-1)===0&&(b&b-1)===0}function Tf(a,b=!0){const c=z.get();c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,a);const d=b?c.LINEAR:c.NEAREST;c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,d),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,d)}function Uf(a){const b=z.get(),c=a.parent.image,d=c.width,e=c.height;return d>0&&e>0&&(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,a.texture),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,a.flipY),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,c)),a.texture}class Sb{constructor(a,b={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1;const c=z.get();this.parent=a,this.isPOT=Qb(a.width,a.height);const{texture:d=null,framebuffer:e=null,unpackPremultiplyAlpha:f=!0,minFilter:g=c.LINEAR,magFilter:h=c.LINEAR,wrapS:i=c.CLAMP_TO_EDGE,wrapT:j=c.CLAMP_TO_EDGE,generateMipmap:k=this.isPOT,flipY:l=!1}=b;this.minFilter=g,this.magFilter=h,this.wrapS=i,this.wrapT=j,this.generateMipmap=k,this.flipY=l,this.unpackPremultiplyAlpha=f,e&&(this.framebuffer=e),d?this.texture=d:Tb(this)}setFilter(a){this.texture&&Tf(this.texture,a)}create(){const a=this.texture;return a&&id(a),Tb(this)}update(){const a=this.texture;return a?Uf(this):Tb(this)}setIndex(a){this.dirtyIndex=a!==this.index,this.index=a}destroy(){id(this.texture),Qf(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}}class Of{constructor(a,b,c,d,e){this.batchSize=a,this.dataSize=b,this.indexSize=c,this.vertexElementSize=d,this.quadIndexSize=e,this.vertexByteSize=d*b,this.quadByteSize=this.vertexByteSize*4,this.quadElementSize=d*4,this.bufferByteSize=a*this.quadByteSize,this.create()}create(){let a=[];for(let c=0;c<this.batchSize*this.indexSize;c+=this.indexSize)a.push(c+0,c+1,c+2,c+2,c+3,c+0);this.data=new ArrayBuffer(this.bufferByteSize),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const b=z.get();this.vertexBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.data,b.DYNAMIC_DRAW),this.indexBuffer=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.index,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,null),a=[]}destroy(){}}class jd{constructor(a,b,c,d,e,f){this.trimmed=!1,this.texture=a,this.key=b,this.x=c,this.y=d,this.width=e,this.height=f,this.sourceSizeWidth=e,this.sourceSizeHeight=f,this.updateUVs()}setPivot(a,b){this.pivot={x:a,y:b}}setSize(a,b){this.width=a,this.height=b,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.updateUVs()}setSourceSize(a,b){this.sourceSizeWidth=a,this.sourceSizeHeight=b}setTrim(a,b,c,d,e,f){this.trimmed=!0,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.spriteSourceSizeX=c,this.spriteSourceSizeY=d,this.spriteSourceSizeWidth=e,this.spriteSourceSizeHeight=f}getExtent(a,b){const c=this.sourceSizeWidth,d=this.sourceSizeHeight;let e,f,g,h;return this.trimmed?(e=this.spriteSourceSizeX-a*c,f=e+this.spriteSourceSizeWidth,g=this.spriteSourceSizeY-b*d,h=g+this.spriteSourceSizeHeight):(e=-a*c,f=e+c,g=-b*d,h=g+d),{left:e,right:f,top:g,bottom:h}}setExtent(a){const b=a.transform,c=b.origin.x,d=b.origin.y,e=this.sourceSizeWidth,f=this.sourceSizeHeight;let g,h,i,j;this.trimmed?(g=this.spriteSourceSizeX-c*e,h=this.spriteSourceSizeY-d*f,i=this.spriteSourceSizeWidth,j=this.spriteSourceSizeHeight):(g=-c*e,h=-d*f,i=e,j=f),b.setExtent(g,h,i,j)}updateUVs(){const{x:a,y:b,width:c,height:d}=this,e=this.texture.width,f=this.texture.height;this.u0=a/e,this.v0=b/f,this.u1=(a+c)/e,this.v1=(b+d)/f}}class U{constructor(a,b,c){this.key="",a&&(b=a.width,c=a.height),this.image=a,this.width=b,this.height=c,this.frames=new Map(),this.data={},this.addFrame("__BASE",0,0,b,c),Ga.add(this)}addFrame(a,b,c,d,e){if(this.frames.has(a))return null;const f=new jd(this,a,b,c,d,e);return this.frames.set(a,f),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=f),f}getFrame(a){if(!a)return this.firstFrame;a instanceof jd&&(a=a.key);let b=this.frames.get(a);return b||(console.warn(`Frame missing: ${a}`),b=this.firstFrame),b}setSize(a,b){this.width=a,this.height=b;const c=this.frames.get("__BASE");c.setSize(a,b)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}}let Nf;const eb={get:()=>Nf,set:a=>{Nf=a}};const Sf={fragmentShader:`\r
#define SHADER_NAME SINGLE_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture;\r
\r
void main (void)\r
{\r
    vec4 color = texture2D(uTexture, vTextureCoord);\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`,vertexShader:`\r
#define SHADER_NAME SINGLE_QUAD_VERT\r
\r
precision highp float;\r
\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
attribute float aTextureId;\r
attribute vec4 aTintColor;\r
\r
uniform mat4 uProjectionMatrix;\r
uniform mat4 uCameraMatrix;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
void main (void)\r
{\r
    vTextureCoord = aTextureCoord;\r
    vTextureId = aTextureId;\r
    vTintColor = aTintColor;\r
\r
    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\r
}`};class Rb{constructor(a={}){this.attribs={aVertexPosition:0,aTextureCoord:0,aTextureId:0,aTintColor:0},this.uniforms={uProjectionMatrix:0,uCameraMatrix:0,uTexture:0,uTime:0,uResolution:0},this.renderToFBO=!1,this.renderer=eb.get();const{batchSize:b=4096,dataSize:c=4,indexSize:d=4,vertexElementSize:e=6,quadIndexSize:f=6,fragmentShader:g=Sf.fragmentShader,vertexShader:h=Sf.vertexShader,width:i=Aa(),height:j=Ba(),resolution:k=Ca(),renderToFBO:l=!1}=a;this.buffer=new Of(b,c,d,e,f),this.createShaders(g,h),this.count=0,this.renderToFBO=l;const m=new U(null,i*k,j*k),n=new Sb(m);m.binding=n,n.framebuffer=Pf(n.texture),this.texture=m,this.framebuffer=n.framebuffer}createShaders(a,b){const c=this.renderer.gl,d=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(d,a),c.compileShader(d);let e=!1,f=c.getShaderInfoLog(d);f.length>0&&(e=!0,console.error(f));const g=c.createShader(c.VERTEX_SHADER);c.shaderSource(g,b),c.compileShader(g),f=c.getShaderInfoLog(d),f.length>0&&(e=!0,console.error(f));if(e)return;const h=c.createProgram();c.attachShader(h,g),c.attachShader(h,d),c.linkProgram(h),c.useProgram(h),this.program=h;for(const i of Object.keys(this.attribs)){const j=c.getAttribLocation(h,i);c.enableVertexAttribArray(j),this.attribs[i]=j}for(const i of Object.keys(this.uniforms))this.uniforms[i]=c.getUniformLocation(h,i)}bind(a,b,c){if(!this.program)return!1;const d=this.renderer,e=d.gl,f=this.uniforms;return e.useProgram(this.program),e.uniformMatrix4fv(f.uProjectionMatrix,!1,a),e.uniformMatrix4fv(f.uCameraMatrix,!1,b),e.uniform1i(f.uTexture,d.textures.textureIndex[c]),e.uniform1f(f.uTime,performance.now()),e.uniform2f(f.uResolution,d.width,d.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}bindBuffers(a,b){const c=this.renderer.gl,d=this.buffer.vertexByteSize,e=this.attribs;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a),c.bindBuffer(c.ARRAY_BUFFER,b),c.vertexAttribPointer(e.aVertexPosition,2,c.FLOAT,!1,d,0),c.vertexAttribPointer(e.aTextureCoord,2,c.FLOAT,!1,d,8),c.vertexAttribPointer(e.aTextureId,1,c.FLOAT,!1,d,16),c.vertexAttribPointer(e.aTintColor,4,c.UNSIGNED_BYTE,!0,d,20),this.count=0}draw(a){const b=this.renderer,c=b.gl,d=this.buffer;if(a===d.batchSize)c.bufferData(c.ARRAY_BUFFER,d.data,c.DYNAMIC_DRAW);else{const e=d.vertexViewF32.subarray(0,a*d.quadElementSize);c.bufferSubData(c.ARRAY_BUFFER,0,e)}this.renderToFBO&&b.fbo.add(this.framebuffer,!0),c.drawElements(c.TRIANGLES,a*d.quadIndexSize,c.UNSIGNED_SHORT,0),this.renderToFBO&&b.fbo.pop()}flush(){const a=this.count;return a===0?!1:(this.draw(a),this.prevCount=a,this.count=0,!0)}}const Uh=`\r
#define SHADER_NAME MULTI_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture[%count%];\r
\r
void main (void)\r
{\r
    vec4 color;\r
\r
    %forloop%\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`;class Jf extends Rb{constructor(a={fragmentShader:Uh}){super(a)}createShaders(a,b){const c=Ya();let d="";for(let e=1;e<c;e++)e>1&&(d+=`
	else `),e<c-1&&(d+=`if (vTextureId < ${e}.5)`),d+=`
	{`,d+=`
		color = texture2D(uTexture[${e}], vTextureCoord);`,d+=`
	}`;a=a.replace(/%count%/gi,`${c}`),a=a.replace(/%forloop%/gi,d),super.createShaders(a,b)}bind(a,b){if(!this.program)return!1;const c=this.renderer,d=c.gl,e=this.uniforms;return d.useProgram(this.program),d.uniformMatrix4fv(e.uProjectionMatrix,!1,a),d.uniformMatrix4fv(e.uCameraMatrix,!1,b),d.uniform1iv(e.uTexture,c.textures.textureIndex),d.uniform1f(e.uTime,performance.now()),d.uniform2f(e.uResolution,c.width,c.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}}function Kf(a,b,c=-1,d=1){const e=-2*(1/-a),f=-2*(1/b),g=2*(1/(c-d));return new Float32Array([e,0,0,0,0,f,0,0,0,0,g,0,-1,1,0,1])}class Lf{constructor(a,b){this.renderer=a;const c={shader:new b()};this.stack=[c],this.currentEntry=c,this.current=c.shader,this.singleQuadShader=new Rb()}add(a,b){const c={shader:a,textureID:b};return this.stack.push(c),c}set(a,b){this.flush();const c=this.renderer,d=c.projectionMatrix,e=c.currentCamera.matrix,f=a.bind(d,e,b);if(f){const g=this.add(a,b);this.currentEntry=g,this.current=a}return f}setDefault(a){this.set(this.singleQuadShader,a)}pop(){this.flush();const a=this.stack;a.length>1&&a.pop(),this.currentEntry=a[a.length-1],this.current=this.currentEntry.shader}reset(){this.pop(),this.rebind()}flush(){return this.current.flush()?(this.renderer.flushTotal++,!0):!1}rebind(){const a=this.renderer,b=a.projectionMatrix,c=a.currentCamera.matrix,d=this.currentEntry;d.shader.bind(b,c,d.textureID)}popAndRebind(){this.pop(),this.rebind()}clear(){}destroy(){}}const Sh=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Th(a){let b="";for(let c=0;c<a;++c)c>0&&(b+=`
else `),c<a-1&&(b+=`if(test == ${c}.0){}`);return b}function Rf(a,b){const c=b.createShader(b.FRAGMENT_SHADER);for(;;){const d=Sh.replace(/%forloop%/gi,Th(a));b.shaderSource(c,d),b.compileShader(c);if(!b.getShaderParameter(c,b.COMPILE_STATUS))a=a/2|0;else break}return a}class Mf{constructor(a){this.startActiveTexture=0,this.renderer=a,this.tempTextures=[],this.textureIndex=[]}init(){const a=this.renderer.gl;let b=Rf(a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),a);const c=Ya();c===0||c>0&&c>b?Vc(b):c>0&&c<b&&(b=Math.max(8,c));const d=this.tempTextures;d.length&&d.forEach(f=>{a.deleteTexture(f)});const e=[];for(let f=0;f<b;f++){const g=a.createTexture();a.activeTexture(a.TEXTURE0+f),a.bindTexture(a.TEXTURE_2D,g),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),d[f]=g,e.push(f)}this.maxTextures=b,this.textureIndex=e,this.currentActiveTexture=1}update(){const a=Ga.get();for(let b=0;b<a.length;b++){const c=a[b];c.binding||(c.binding=new Sb(c))}Ga.clear()}reset(){const a=this.renderer.gl,b=this.tempTextures;for(let c=0;c<b.length;c++)a.activeTexture(a.TEXTURE0+c),a.bindTexture(a.TEXTURE_2D,b[c]);this.currentActiveTexture=1,this.startActiveTexture++}bind(a,b=0){const c=this.renderer.gl,d=a.binding;d.setIndex(b),c.activeTexture(c.TEXTURE0+b),c.bindTexture(c.TEXTURE_2D,d.texture)}unbind(a=0){const b=this.renderer.gl;b.activeTexture(b.TEXTURE0+a),b.bindTexture(b.TEXTURE_2D,this.tempTextures[a]),a>0&&this.startActiveTexture++}request(a){const b=this.renderer.gl,c=a.binding,d=this.currentActiveTexture;return c.indexCounter>=this.startActiveTexture?!1:(c.indexCounter=this.startActiveTexture,d<this.maxTextures?(c.setIndex(d),b.activeTexture(b.TEXTURE0+d),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture++):(this.renderer.flush(),this.startActiveTexture++,c.indexCounter=this.startActiveTexture,c.setIndex(1),b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture=2),!0)}}class he{constructor(){this.clearColor=[0,0,0,1],this.flushTotal=0,this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.currentCamera=null,this.width=Aa(),this.height=Ba(),this.resolution=Ca(),this.setBackgroundColor(xb());const a=document.createElement("canvas");a.addEventListener("webglcontextlost",b=>this.onContextLost(b),!1),a.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=a,this.fbo=new Hf(this),this.textures=new Mf(this),this.initContext(),eb.set(this),this.shaders=new Lf(this,Jf)}initContext(){const a=this.canvas.getContext("webgl",Xc());z.set(a),this.gl=a,a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE),this.resize(this.width,this.height,this.resolution),this.textures.init()}resize(a,b,c=1){this.width=a*c,this.height=b*c,this.resolution=c;const d=this.canvas;d.width=this.width,d.height=this.height,this.autoResize&&(d.style.width=(this.width/c).toString()+"px",d.style.height=(this.height/c).toString()+"px"),this.gl.viewport(0,0,this.width,this.height),this.projectionMatrix=Kf(a,b)}onContextLost(a){a.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(a){return If(a,this.clearColor),this}reset(a=null,b=this.width,c=this.height){const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),d.viewport(0,0,b,c),d.enable(d.BLEND),d.blendFunc(d.ONE,d.ONE_MINUS_SRC_ALPHA),this.flushTotal=0,this.currentCamera=null,this.textures.update()}render(a){if(this.contextLost)return;this.reset();if(this.optimizeRedraw&&a.numDirtyFrames===0&&a.numDirtyCameras===0)return;const b=this.gl;if(this.clearBeforeRender){const d=this.clearColor;b.clearColor(d[0],d[1],d[2],d[3]),b.clear(b.COLOR_BUFFER_BIT)}const c=a.worldData;for(let d=0;d<c.length;d++){const{camera:e,renderList:f}=c[d];(!this.currentCamera||!Kb(e.worldTransform,this.currentCamera.worldTransform))&&(this.flush(),this.currentCamera=e,this.shaders.rebind()),f.forEach(g=>{g.children.length?this.renderNode(g):g.node.renderGL(this)})}this.flush()}renderNode(a){a.node.renderGL(this),a.children.forEach(b=>{b.children.length>0?this.renderNode(b):b.node.renderGL(this)}),a.node.postRenderGL(this)}flush(){this.shaders.flush()}destroy(){eb.set(void 0)}}function Jc(){return()=>{yb(he)}}function w(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);for(const e of d)e.callback.apply(e.context,c),e.once&&d.delete(e);return d.size===0&&a.events.delete(b),!0}function Rd(a,b){const c=zb(b);return c.appendChild(a),a}function Sd(a){const b=document.readyState;if(b==="complete"||b==="interactive"){a();return}const c=()=>{document.removeEventListener("deviceready",c,!0),document.removeEventListener("DOMContentLoaded",c,!0),window.removeEventListener("load",c,!0),a()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",c,!0):(document.addEventListener("DOMContentLoaded",c,!0),window.addEventListener("load",c,!0)):window.setTimeout(c,20)}class Td{constructor(){this.events=new Map()}}class Cb{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function Da(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new Cb(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function Eb(a,b,c,d=a){return Da(a,b,c,d,!0)}function Vf(){return{gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]}}function Yf(a,b=0){a.gameFrame=b,a.numTotalFrames=0,a.numDirtyFrames=0,a.numDirtyCameras=0,a.worldData.length=0}let Zf;const Ub={get:()=>Zf,set:a=>{Zf=a}};class Ud{constructor(){this.scenes=new Map(),this.sceneIndex=0,this.flush=!1,this.renderResult=Vf(),this.game=y.get(),Ub.set(this),Eb(this.game,"boot",()=>this.boot())}boot(){Wc().forEach(a=>new a())}update(a,b){for(const c of this.scenes.values())w(c,"update",a,b)}render(a){const b=this.renderResult;Yf(b,a);for(const c of this.scenes.values())w(c,"render",b);return this.flush&&(b.numDirtyFrames++,this.flush=!1),b}}function gb(a,b){const c=document.createElement("canvas");return c.width=a,c.height=b,c.getContext("2d")}let _f;const Ea={get:()=>_f,set:a=>{_f=a}};class Vd{constructor(){this.textures=new Map(),this.createDefaultTextures(),Ea.set(this)}createDefaultTextures(){this.add("__BLANK",new U(gb(32,32).canvas));const a=gb(32,32);a.strokeStyle="#0f0",a.moveTo(0,0),a.lineTo(32,32),a.stroke(),a.strokeRect(.5,.5,31,31),this.add("__MISSING",new U(a.canvas))}get(a){const b=this.textures;return b.has(a)?b.get(a):b.get("__MISSING")}has(a){return this.textures.has(a)}add(a,b){let c;const d=this.textures;return d.has(a)||(b instanceof U?c=b:c=new U(b),c.key=a,d.set(a,c)),c}}class Od extends Td{constructor(...a){super();this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,y.set(this),Sd(()=>this.boot(a))}boot(a){a.forEach(d=>d());const b=Qc();this.renderer=new b(),this.textureManager=new Vd(),this.sceneManager=new Ud();const c=Rc();c&&Rd(this.renderer.canvas,c),this.isBooted=!0,Pc(),w(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(a){const b=a-this.lastTick;this.lastTick=a,this.elapsed+=b,this.isPaused||(this.willUpdate&&(this.sceneManager.update(b,a),w(this,"update",b,a)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,y.setFrame(this.frame),y.setElapsed(this.elapsed),requestAnimationFrame(c=>this.step(c))}destroy(){}}function Wf(a,b,c){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:c}function Xf(a,b={}){const c=Ub.get(),d=c.scenes.size,e=c.sceneIndex,f=d===0;typeof b==="string"?a.key=b:(b||!b&&f)&&(a.key=Wf(b,"key","scene"+e.toString())),c.scenes.has(a.key)?console.warn("Scene key already in use: "+a.key):(c.scenes.set(a.key,a),c.flush=!0,c.sceneIndex++)}class Pd{constructor(a){this.game=y.get(),this.events=new Map(),Xf(this,a)}}class o{constructor(a=1,b=0,c=0,d=1,e=0,f=0){this.set(a,b,c,d,e,f)}set(a=1,b=0,c=0,d=1,e=0,f=0){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=e,this.ty=f,this}identity(){return this.set()}toArray(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]}fromArray(a){return this.set(a[0],a[1],a[2],a[3],a[4],a[5])}}function se(a,b,c){return a.width<=0||a.height<=0?!1:a.x<=b&&a.x+a.width>=b&&a.y<=c&&a.y+a.height>=c}class ba{constructor(a=0,b=0,c=0,d=0){this.set(a,b,c,d)}set(a=0,b=0,c=0,d=0){return this.x=a,this.y=b,this.width=c,this.height=d,this}contains(a,b){return se(this,a,b)}set right(a){a<=this.x?this.width=0:this.width=a-this.x}get right(){return this.x+this.width}set bottom(a){a<=this.y?this.height=0:this.height=a-this.y}get bottom(){return this.y+this.height}}function Ff(){}class S{constructor(a,b=0,c=0,d=!1){this.compareValue=!1,this._x=b,this._y=c,this.callback=a,this.compareValue=d}set(a=0,b=0){return this._x=a,this._y=b,this.callback(this),this}destroy(){this.callback=Ff}set x(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._x=a,this.callback(this))}get x(){return this._x}set y(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._y=a,this.callback(this))}get y(){return this._y}}function db(a,b,c){const d=c-b;return b+((a-b)%d+d)%d}function wb(a){return db(a,-Math.PI,Math.PI)}class Zd{constructor(){this._rotation=0,this.type="Camera",this.dirtyRender=!0;const a=y.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1]),this.bounds=new ba(),this.worldTransform=new o(),this.position=new S(()=>this.updateTransform(),0,0),this.scale=new S(()=>this.updateTransform(),1,1),this.origin=new S(()=>this.updateTransform(),.5,.5),this.reset()}updateTransform(){const a=this.matrix,b=this.position.x,c=this.position.y,d=this.scale.x,e=this.scale.y,f=-b+this.width*this.origin.x,g=-c+this.height*this.origin.y,h=Math.sin(this.rotation),i=Math.cos(this.rotation),j=h+h,k=h*j,l=i*j,m=(1-k)*d,n=l*d,s=-l*e,F=(1-k)*e;a[0]=m,a[1]=n,a[4]=s,a[5]=F,a[12]=b+f-(m*f+s*g),a[13]=c+g-(n*f+F*g),this.worldTransform.set(i*d,h*d,-h*e,i*e,-b,-c);const G=this.width*(1/d),H=this.height*(1/e);this.bounds.set(f-G/2,g-H/2,G,H),this.dirtyRender=!0}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}set rotation(a){a!==this._rotation&&(this._rotation=wb(a),this.updateTransform())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.origin.destroy(),this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}class _d{constructor(){this.type="StaticCamera",this.dirtyRender=!0;const a=y.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.bounds=new ba(),this.worldTransform=new o(),this.reset()}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}function ma(a){const b=[a],c=[];for(;b.length>0;){const d=b.shift();c.push(d);const e=d.numChildren;if(e>0)for(let f=e-1;f>=0;f--)b.unshift(d.children[f])}return c.shift(),c}function Z(a,b){return a.children.indexOf(b)}function Bb(a,b){const c=a.children;let d;if(b>=0&&b<c.length){const e=c.splice(b,1);e[0]&&(d=e[0],d.parent=null)}return d}function _a(a,b){const c=Z(a,b);return c>-1&&Bb(a,c),b}const ad="addedtoworld";const Fb="destroy";const oe="postupdate";const bd="removedfromworld";const pe="update";function $c(a,...b){return b.forEach(c=>{c.world&&(w(c.world,bd,c,c.world),w(c,bd,c,c.world)),c.world=a,w(a,ad,c,a),w(c,ad,c,a)}),b}function la(a,...b){b.forEach(d=>{d.parent&&_a(d.parent,d),d.parent=a});const c=a.world;return c&&$c(c,...ma(a)),b}const r={CLEAR:0,TRANSFORM:1,UPDATE:2,CHILD_CACHE:4,POST_RENDER:8,COLORS:16,BOUNDS:32,TEXTURE:64,FRAME:128,ALPHA:256,CHILD:512,DEFAULT:1+2+16+32,USER1:536870912,USER2:1073741824,USER3:2147483648,USER4:4294967296};function Za(a,b=0,c){const d=a.children;c===void 0&&(c=d.length);const e=c-b;if(e>0&&e<=c){const f=d.splice(b,e);return f.forEach(g=>{g.parent=null}),f}else return[]}function Yc(a,b=0,c){const d=Za(a,b,c);d.forEach(e=>{e.destroy()})}function Zc(a,...b){return b.forEach(c=>{_a(a,c)}),b}function _c(a,b,c=0,d){const e=Za(a,c,d);return la(b,...e),e.forEach(f=>{f.transform.updateWorld()}),e}function Db(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof Cb)g.delete(c);else{const h=!d,i=e!==void 0;for(const j of g)j.callback===c&&(h&&j.context===d)&&(i&&j.once===e)&&g.delete(j)}return g.size===0&&f.delete(b),a}function Hb(a){const{a:b,b:c,c:d,d:e,tx:f,ty:g}=a.world,{x:h,y:i,right:j,bottom:k}=a.extent,l=h*b+i*d+f,m=h*c+i*e+g,n=h*b+k*d+f,s=h*c+k*e+g,F=j*b+k*d+f,G=j*c+k*e+g,H=j*b+i*d+f,D=j*c+i*e+g;return{x0:l,y0:m,x1:n,y1:s,x2:F,y2:G,x3:H,y3:D}}class ie{constructor(a){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=a,this.area=new ba()}set(a,b,c,d){this.area.set(a,b,c,d)}get(){return this.entity.isDirty(r.BOUNDS)&&!this.fixed&&this.update(),this.area}updateLocal(){const{x0:a,y0:b,x1:c,y1:d,x2:e,y2:f,x3:g,y3:h}=Hb(this.entity.transform),i=Math.min(a,c,e,g),j=Math.min(b,d,f,h),k=Math.max(a,c,e,g),l=Math.max(b,d,f,h);return this.area.set(i,j,k-i,l-j)}update(){const a=this.updateLocal();this.entity.clearDirty(r.BOUNDS);if(!this.includeChildren||!this.entity.numChildren)return a;const b=this.visibleOnly,c=this.entity.children;let d=a.x,e=a.y,f=a.right,g=a.bottom;for(let h=0;h<c.length;h++){const i=c[h];if(!i||b&&!i.visible)continue;const j=i.bounds.get();j.x<d&&(d=j.x),j.y<e&&(e=j.y),j.right>f&&(f=j.right),j.bottom>g&&(g=j.bottom)}return a.set(d,e,f-d,g-e)}destroy(){this.entity=null,this.area=null}}class je{constructor(a){this.enabled=!1,this.enabledChildren=!0,this.entity=a}destroy(){this.entity=null,this.hitArea=null}}class T{constructor(a=0,b=0){this.set(a,b)}set(a=0,b=0){return this.x=a,this.y=b,this}getArray(){return[this.x,this.y]}fromArray(a){return this.set(a[0],a[1])}toString(){return`[x=${this.x}, y=${this.y}]`}}function le(a){const b=a.local,c=a.position.x,d=a.position.y,e=a.rotation,f=a.scale.x,g=a.scale.y,h=a.skew.x,i=a.skew.y;b.set(Math.cos(e+i)*f,Math.sin(e+i)*f,-Math.sin(e-h)*g,Math.cos(e-h)*g,c,d)}function $a(a,b){return b.set(a.a,a.b,a.c,a.d,a.tx,a.ty)}function me(a){const b=a.parent,c=a.transform,d=c.local,e=c.world;if(!b)$a(d,e);else if(c.passthru)$a(b.transform.world,e);else{const{a:f,b:g,c:h,d:i,tx:j,ty:k}=d,{a:l,b:m,c:n,d:s,tx:F,ty:G}=b.transform.world;e.set(f*l+g*n,f*m+g*s,h*l+i*n,h*m+i*s,j*l+k*n+F,j*m+k*s+G)}}class ke{constructor(a,b=0,c=0){this.passthru=!1,this._rotation=0,this.entity=a,this.local=new o(),this.world=new o(),this.position=new S(()=>this.update(),b,c),this.scale=new S(()=>this.update(),1,1,!0),this.skew=new S(()=>this.update(),0,0,!0),this.origin=new S(()=>this.updateExtent(),Tc,Uc),this.extent=new ba()}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(r.TRANSFORM,r.BOUNDS),le(this)}updateWorld(){const a=this.entity;a.setDirty(r.TRANSFORM,r.BOUNDS),me(a),a.numChildren&&this.updateChildren()}updateChildren(){const a=this.entity.children;for(let b=0;b<a.length;b++){const c=a[b];c.transform.updateWorld()}}globalToLocal(a,b,c=new T()){const{a:d,b:e,c:f,d:g,tx:h,ty:i}=this.world,j=1/(d*g+f*-e);return c.x=g*j*a+-f*j*b+(i*f-h*g)*j,c.y=d*j*b+-e*j*a+(-i*d+h*e)*j,c}localToGlobal(a,b,c=new T()){const{a:d,b:e,c:f,d:g,tx:h,ty:i}=this.world;return c.x=d*a+f*b+h,c.y=e*a+g*b+i,c}setExtent(a,b,c,d){this.extent.set(a,b,c,d),this.entity.setDirty(r.TRANSFORM,r.BOUNDS)}updateExtent(a,b){const c=this.extent,d=this.entity;a!==void 0&&(c.width=a),b!==void 0&&(c.height=b),c.x=-this.origin.x*c.width,c.y=-this.origin.y*c.height,d.setDirty(r.TRANSFORM,r.BOUNDS)}set rotation(a){a!==this._rotation&&(this._rotation=a,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}}class Gb{constructor(a=0,b=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.events=new Map(),this.transform=new ke(this,a,b),this.bounds=new ie(this),this.input=new je(this),this.dirty=r.DEFAULT,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(a){return(this.dirty&a)!==0}clearDirty(a){return this.isDirty(a)&&(this.dirty^=a),this}setDirty(a,b){return this.isDirty(a)||(this.dirty^=a,this.dirtyFrame=y.getFrame()),this.isDirty(b)||(this.dirty^=b),this}update(a,b){if(this.willUpdateChildren){const c=this.children;for(let d=0;d<c.length;d++){const e=c[d];e&&e.willUpdate&&e.update(a,b)}}this.postUpdate(a,b)}postUpdate(a,b){}renderGL(a){}renderCanvas(a){}postRenderGL(a){}postRenderCanvas(a){}get numChildren(){return this.children.length}destroy(a){a?_c(this,a):Yc(this),w(this,Fb,this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}}const Ob="worldrender";const Pb="worldshutdown";var Fh=Object.freeze({__proto__:null,WorldRenderEvent:Ob,WorldShutdownEvent:Pb});function Vb(a,b){b.numRendered++,b.numRenderable++,a.node.dirtyFrame>=b.gameFrame&&b.dirtyFrame++,a.children.forEach(c=>{c.children.length>0&&Vb(c,b)})}function nd(a){if(a.node.isDirty(r.CHILD_CACHE))return!0;const b=[a];for(;b.length>0;){const c=b.pop();if(c.node.isDirty(r.TRANSFORM))return!0;const d=c.children.length;if(d>0)for(let e=0;e<d;e++)b.push(c.children[e])}return b.length=0,!1}function md(a,b){a.forEach(c=>{b||nd(c)?c.node.setDirty(r.CHILD_CACHE):c.children.length=0})}function Wb(a,b,c=[]){for(let d=0;d<b.numChildren;d++){const e=b.children[d];if(e.isRenderable()){const f=[],g={node:e,children:f};c.push(g),e.willRenderChildren&&e.numChildren>0&&(e.willCacheChildren&&a.push(g),Wb(a,e,f))}}return c}function kd(a){const b=[],c=[],d=Wb(b,a,c),e=a.renderData;b.length>0&&md(b,a.camera.dirtyRender),d.forEach(f=>{f.children.length?Vb(f,e):(e.numRendered++,e.numRenderable++,f.node.dirtyFrame>=e.gameFrame&&e.dirtyFrame++)}),e.renderList=d,a.forceRefresh&&(e.dirtyFrame++,a.forceRefresh=!1)}function ld(a,b){a.numDirtyFrames+=b.dirtyFrame,a.numTotalFrames+=b.numRendered,b.camera.dirtyRender&&a.numDirtyCameras++,a.worldData.push(b)}function hb(a,b){a.gameFrame=b,a.dirtyFrame=0,a.numRendered=0,a.numRenderable=0,a.renderList.length=0}class ib extends Gb{constructor(a){super();this.forceRefresh=!1,this.type="BaseWorld",this.scene=a,this.world=this,this.events=new Map(),this._updateListener=Da(a,"update",(b,c)=>this.update(b,c)),this._renderListener=Da(a,"render",b=>this.render(b)),this._shutdownListener=Da(a,"shutdown",()=>this.shutdown()),Eb(a,"destroy",()=>this.destroy())}update(a,b){if(!this.willUpdate)return;w(this,pe,a,b,this),super.update(a,b)}postUpdate(a,b){w(this,oe,a,b,this)}render(a){const b=this.renderData;hb(b,a.gameFrame);if(!this.willRender||!this.visible)return;kd(this),w(this,Ob,b,this),ld(a,b),this.camera&&(this.camera.dirtyRender=!1)}shutdown(){const a=this.scene;Db(a,"update",this._updateListener),Db(a,"render",this._renderListener),Db(a,"shutdown",this._shutdownListener),Zc(this),w(this,Pb,this),hb(this.renderData,0),this.camera&&this.camera.reset()}destroy(a){super.destroy(a),w(this,Fb,this),hb(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}}function jb(a){return{camera:a,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0,renderList:[]}}class Kc extends ib{constructor(a){super(a);this.type="StaticWorld",this.camera=new _d(),this.renderData=jb(this.camera)}}class Vh extends ib{constructor(a){super(a);this.enableCameraCull=!0,this.type="World",this.camera=new Zd(),this.renderData=jb(this.camera)}}function ya(a,b){return a.children.push(b),la(a,b),b.transform.updateWorld(),b}function Ab(a,b){const c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)}function qe(a,b){const c=a.texture,d=b.shaders.current,e=d.buffer,f=c.binding;d.count===e.batchSize&&b.flush();const g=a.vertexData;b.textures.request(c);const h=f.index;g[4]=h,g[10]=h,g[16]=h,g[22]=h;const i=d.count*e.quadElementSize;e.vertexViewF32.set(g,i);const j=a.vertexColor,k=e.vertexViewU32;k[i+5]=j[0],k[i+11]=j[2],k[i+17]=j[3],k[i+23]=j[1],d.count++}class ne extends Gb{constructor(a=0,b=0){super(a,b);this._alpha=1,this.type="Container"}setSize(a,b=a){return this.transform.updateExtent(a,b),this}setPosition(a,b){return this.transform.position.set(a,b),this}setOrigin(a,b=a){return this.transform.origin.set(a,b),this}setSkew(a,b=a){return this.transform.skew.set(a,b),this}setScale(a,b=a){return this.transform.scale.set(a,b),this}setRotation(a){return this.transform.rotation=a,this}set width(a){this.transform.updateExtent(a)}get width(){return this.transform.extent.width}set height(a){this.transform.updateExtent(void 0,a)}get height(){return this.transform.extent.height}set x(a){this.transform.position.x=a}get x(){return this.transform.position.x}set y(a){this.transform.position.y=a}get y(){return this.transform.position.y}set originX(a){this.transform.origin.x=a}get originX(){return this.transform.origin.x}set originY(a){this.transform.origin.y=a}get originY(){return this.transform.origin.y}set skewX(a){this.transform.skew.x=a}get skewX(){return this.transform.skew.x}set skewY(a){this.transform.skew.y=a}get skewY(){return this.transform.skew.y}set scaleX(a){this.transform.scale.x=a}get scaleX(){return this.transform.scale.x}set scaleY(a){this.transform.scale.y=a}get scaleY(){return this.transform.scale.y}set rotation(a){this.transform.rotation=a}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(a){a!==this._alpha&&(this._alpha=a,this.setDirty(r.TRANSFORM))}}function re(a,b){const c=a.frame;if(!c)return;const d=b.ctx,e=a.transform,{a:f,b:g,c:h,d:i,tx:j,ty:k}=e.world,{x:l,y:m}=e.extent;d.save(),d.setTransform(f,g,h,i,j,k),d.globalAlpha=a.alpha,d.drawImage(c.texture.image,c.x,c.y,c.width,c.height,l,m,c.width,c.height),d.restore()}function fb(a,b){const c=(b*255|0)&255;return(c<<24|a)>>>0}function ca(a){const b=a.vertexAlpha,c=a.vertexTint,d=a.vertexColor;return d[0]=fb(c[0],b[0]),d[1]=fb(c[1],b[1]),d[2]=fb(c[2],b[2]),d[3]=fb(c[3],b[3]),a}function ab(a,b,...c){const d=a.getFrame(b),{u0:e,u1:f,v0:g,v1:h,pivot:i}=d;return c.forEach(j=>{if(!j||d===j.frame)return;j.frame=d,i&&j.setOrigin(i.x,i.y),j.frame.setExtent(j),j.hasTexture=!0;const k=j.vertexData;k[2]=e,k[3]=g,k[8]=e,k[9]=h,k[14]=f,k[15]=h,k[20]=f,k[21]=g}),c}function cd(a,b,...c){if(!a)c.forEach(d=>{d.texture=null,d.frame=null,d.hasTexture=!1});else{let d;a instanceof U?d=a:d=Ea.get().get(a),d?(c.forEach(e=>{e.texture=d}),ab(d,b,...c)):console.warn(`Invalid Texture key: ${a}`)}return c}function dd(a){const b=a.vertexData,{x0:c,y0:d,x1:e,y1:f,x2:g,y2:h,x3:i,y3:j}=Hb(a.transform);return b[0]=c,b[1]=d,b[6]=e,b[7]=f,b[12]=g,b[13]=h,b[18]=i,b[19]=j,a}class za extends ne{constructor(a,b,c,d){super(a,b);this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertexData=new Float32Array(24).fill(0),this.vertexColor=new Uint32Array(4).fill(4294967295),this.vertexAlpha=new Float32Array(4).fill(1),this.vertexTint=new Uint32Array(4).fill(16777215),this.setTexture(c,d)}setTexture(a,b){return cd(a,b,this),this}setFrame(a){return ab(this.texture,a,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}preRender(){this.isDirty(r.COLORS)&&(ca(this),this.clearDirty(r.COLORS)),this.isDirty(r.TRANSFORM)&&(dd(this),this.clearDirty(r.TRANSFORM))}renderGL(a){this.preRender(),qe(this,a)}renderCanvas(a){this.preRender(),re(this,a)}get alpha(){return this._alpha}set alpha(a){if(a!==this._alpha){this._alpha=a;const b=this.vertexAlpha;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(r.ALPHA)}}get tint(){return this._tint}set tint(a){if(a!==this._tint){this._tint=a;const b=this.vertexTint;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(r.COLORS)}}destroy(a){super.destroy(a),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertexData=null,this.vertexColor=null,this.vertexAlpha=null,this.vertexTint=null}}function Mc(a,...b){return b.forEach(c=>{const d=c.vertexAlpha;d[0]=a,d[1]=a,d[2]=a,d[3]=a,ca(c)}),b}function Lc(a,...b){return b.forEach(c=>{const d=c.vertexTint;d[0]=a,d[1]=a,d[2]=a,d[3]=a,ca(c)}),b}function Ib(a=32,b=32){const c=gb(a,b);return new U(c.canvas)}class Nc extends za{constructor(a,b,c="",d,e){super(a,b,Ib());this.splitRegExp=/(?:\r\n|\r|\n)/,this.padding={left:0,right:0,top:0,bottom:0},this.verticalAlign="ascent",this.lineSpacing=0,this.font="16px monospace",this.fillStyle="#fff",this.strokeStyle="",this.backgroundStyle="",this.cornerRadius=0,this.textAlign="left",this.textBaseline="alphabetic",this.lineWidth=0,this.lineDash=[],this.antialias=!1,this.type="Text";const f=y.get();this.resolution=f.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),d&&(this.font=d),e&&(this.fillStyle=e),this.setText(c)}syncContext(a,b){this.preRenderCallback&&this.preRenderCallback(a,b),b.font=this.font,b.textBaseline=this.textBaseline,b.textAlign=this.textAlign,b.fillStyle=this.fillStyle,b.strokeStyle=this.strokeStyle,b.lineWidth=this.lineWidth,b.lineCap="round",b.lineJoin="round",b.setLineDash(this.lineDash),b.imageSmoothingEnabled=this.antialias}updateText(){const a=this.canvas,b=this.context,c=this.resolution,d=this._text.split(this.splitRegExp),e=this.padding,f=this.fillStyle,g=this.strokeStyle,h=this.lineWidth,i=this.lineSpacing,j=h>0?h/2:0;b.clearRect(0,0,a.width,a.height),this.syncContext(a,b),b.textAlign="start";let k=0,l=0,m=0;const n=[],s=this.verticalAlign==="ascent",F=b.measureText("|MÉq"),G=Math.ceil(Math.abs(F.actualBoundingBoxAscent)+Math.abs(F.actualBoundingBoxDescent))+h;for(let v=0;v<d.length;v++){const R=b.measureText(d[v]),sb=R.actualBoundingBoxLeft,xa=R.actualBoundingBoxRight;let ka=R.actualBoundingBoxAscent,Wa=R.actualBoundingBoxDescent;(!ka&&!Wa||d[v]==="")&&(ka=G,Wa=0);const qh=Math.ceil(Math.abs(sb)+Math.abs(xa))+h,Nd=Math.ceil(Math.abs(ka)+Math.abs(Wa))+h;s?(m+=ka+j,v>0&&(m+=i+j),l=m+Wa+j):(m=l+(Nd-Wa-j),l+=Nd,v<d.length-1&&(l+=i)),k=Math.max(k,qh),n.push({lineWidth:qh,lineHeight:Nd,ascent:ka,descent:Wa,left:sb,right:xa,y:m})}k+=e.left+e.right,l+=e.top+e.bottom;const H=this.fixedWidth?this.fixedWidth:k,D=this.fixedHeight?this.fixedHeight:l,Ta=Math.ceil(H*c),ja=Math.ceil(D*c);(a.width!==Ta||a.height!==ja)&&(a.width=Ta,a.height=ja,this.texture.setSize(H,D),this.setSize(H,D)),b.save(),b.scale(c,c),this.syncContext(a,b);const Ua=this.backgroundStyle;if(Ua){b.save(),b.fillStyle=Ua,b.strokeStyle=Ua;const v=this.cornerRadius,R=v>0?v/2:0;v&&(b.lineWidth=v,b.strokeRect(R,R,H-v,D-v)),b.fillRect(R,R,H-v,D-v),b.restore()}const Va=this.textAlign,Vi=Va==="center",Wi=Va==="right"||Va==="end",Xi=(D-l)/2+e.top;for(let v=0;v<d.length;v++){const R=d[v],sb=n[v];let xa=e.left+sb.left+j;const ka=Xi+sb.y;Vi?xa=H/2:Wi&&(xa=H-j),g&&b.strokeText(R,xa,ka),f&&b.fillText(R,xa,ka)}return b.restore(),this.texture.binding&&this.texture.binding.update(),this.setDirty(r.TEXTURE),this}get text(){return this._text}set text(a){this.setText(a)}setText(a=""){return Array.isArray(a)&&(a=a.join(`
`)),a!==this._text&&(this._text=a.toString(),this.updateText()),this}destroy(a){this.texture.destroy(),this.fillStyle=null,this.strokeStyle=null,this.backgroundStyle=null,this.canvas=null,this.context=null,super.destroy(a)}}function Je(a,b,c,d){return Math.atan2(d-b,c-a)}function Ke(a,b){return Math.atan2(b.y-a.y,b.x-a.x)}function Le(a,b){return Math.atan2(b.x-a.x,b.y-a.y)}function Me(a,b,c,d){return Math.atan2(c-a,d-b)}const B={PI2:Math.PI*2,HALF_PI:Math.PI*.5,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};function Ne(a){return a>Math.PI&&(a-=B.PI2),Math.abs(((a+B.HALF_PI)%B.PI2-B.PI2)%B.PI2)}function Jb(a){return a=a%B.PI2,a>=0?a:a+B.PI2}function Oe(a){return Jb(a+Math.PI)}function Pe(a,b,c=.05){return a===b?a:(Math.abs(b-a)<=c||Math.abs(b-a)>=B.PI2-c?a=b:(Math.abs(b-a)>Math.PI&&(b<a?b+=B.PI2:b-=B.PI2),b>a?a+=c:b<a&&(a-=c)),a)}function Qe(a,b){const c=b-a;if(c===0)return 0;const d=Math.floor((c- -180)/360);return c-d*360}function Re(a){return db(a,-180,180)}var Dh=Object.freeze({__proto__:null,AngleBetween:Je,AngleBetweenPoints:Ke,AngleBetweenPointsY:Le,AngleBetweenY:Me,CounterClockwise:Ne,NormalizeAngle:Jb,ReverseAngle:Oe,RotateAngleTo:Pe,ShortestAngleBetween:Qe,WrapAngle:wb,WrapAngleDegrees:Re});var Gh=Object.freeze({__proto__:null,Vec2:T,Vec2Callback:S});function Oc(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function Ae(a,b,c,d){const e=a-c,f=b-d;return Math.sqrt(e*e+f*f)}function Se(a,b,c=new o()){const{a:d,b:e,c:f,d:g,tx:h,ty:i}=a,{a:j,b:k,c:l,d:m,tx:n,ty:s}=b;return c.set(j*d+k*f,j*e+k*g,l*d+m*f,l*e+m*g,n*d+s*f+h,n*e+s*g+i)}function gf(a,b,c,d=new T()){const{a:e,b:f,c:g,d:h,tx:i,ty:j}=a,k=1/(e*h+g*-f);return d.x=h*k*b+-g*k*c+(j*g-i*h)*k,d.y=e*k*c+-f*k*b+(-j*e+i*f)*k,d}function Be(a,b,c,d){return Math.max(Math.abs(a-c),Math.abs(b-d))}function Ce(a,b){const c=a.x-b.x,d=a.y-b.y;return c*c+d*d}function De(a,b,c,d,e=2){return Math.sqrt(Math.pow(c-a,e)+Math.pow(d-b,e))}function Ee(a,b,c,d){const e=a-c,f=b-d;return e*e+f*f}function Fe(a,b,c,d){return Math.abs(a-c)+Math.abs(b-d)}var Bh=Object.freeze({__proto__:null,ChebyshevDistance:Be,DistanceBetween:Ae,DistanceBetweenPoints:Ab,DistanceBetweenPointsSquared:Ce,DistancePower:De,DistanceSquared:Ee,SnakeDistance:Fe});function Af(a,b=1e-4){return Math.ceil(a-b)}function Bf(a,b,c=1e-4){return Math.abs(a-b)<c}function Cf(a,b=1e-4){return Math.floor(a+b)}function Df(a,b,c=1e-4){return a>b-c}function Ef(a,b,c=1e-4){return a<b+c}var Jh=Object.freeze({__proto__:null,FuzzyCeil:Af,FuzzyEqual:Bf,FuzzyFloor:Cf,FuzzyGreaterThan:Df,FuzzyLessThan:Ef});function bb(a){if(a===0)return 1;let b=a;for(;--a;)b*=a;return b}function ed(a,b){return bb(a)/bb(b)/bb(a-b)}function te(a,b){let c=0;const d=a.length-1;for(let e=0;e<=d;e++)c+=Math.pow(1-b,d-e)*Math.pow(b,e)*a[e]*ed(d,e);return c}function Fa(a,b,c,d,e){const f=(d-b)*.5,g=(e-c)*.5,h=a*a,i=a*h;return(2*c-2*d+f+g)*i+(-3*c+3*d-2*f-g)*h+f*a+c}function ue(a,b){const c=a.length-1;let d=c*b,e=Math.floor(d);return a[0]===a[c]?(b<0&&(e=Math.floor(d=c*(1+b))),Fa(d-e,a[(e-1+c)%c],a[e],a[(e+1)%c],a[(e+2)%c])):b<0?a[0]-(Fa(-d,a[0],a[0],a[1],a[1])-a[0]):b>1?a[c]-(Fa(d-c,a[c],a[c],a[c-1],a[c-1])-a[c]):Fa(d-e,a[e?e-1:0],a[e],a[c<e+1?c:e+1],a[c<e+2?c:e+2])}function Lh(a,b){const c=1-a;return c*c*c*b}function Mh(a,b){const c=1-a;return 3*c*c*a*b}function Nh(a,b){return 3*(1-a)*a*a*b}function Oh(a,b){return a*a*a*b}function ve(a,b,c,d,e){return Lh(a,b)+Mh(a,c)+Nh(a,d)+Oh(a,e)}function cb(a,b,c){return(b-a)*c+a}function we(a,b){const c=a.length-1,d=c*b,e=Math.floor(d);return b<0?cb(a[0],a[1],d):b>1?cb(a[c],a[c-1],c-d):cb(a[e],a[e+1>c?c:e+1],d-e)}function Ph(a,b){const c=1-a;return c*c*b}function Qh(a,b){return 2*(1-a)*a*b}function Rh(a,b){return a*a*b}function xe(a,b,c,d){return Ph(a,b)+Qh(a,c)+Rh(a,d)}function fd(a,b,c){return a<=b?0:a>=c?1:(a=(a-b)/(c-b),a*a*(3-2*a))}function ye(a,b,c){return b+(c-b)*fd(a,0,1)}function gd(a,b,c){return a=Math.max(0,Math.min(1,(a-b)/(c-b))),a*a*a*(a*(a*6-15)+10)}function ze(a,b,c){return b+(c-b)*gd(a,0,1)}var Ah=Object.freeze({__proto__:null,BezierInterpolation:te,CatmullRomInterpolation:ue,CubicBezierInterpolation:ve,LinearInterpolation:we,QuadraticBezierInterpolation:xe,SmoothStepInterpolation:ye,SmootherStepInterpolation:ze});function hf(a,b){return a.a+=b.a,a.b+=b.b,a.c+=b.c,a.d+=b.d,a.tx+=b.tx,a.ty+=b.ty,a}function jf(a,b){const{a:c,b:d,c:e,d:f,tx:g,ty:h}=a;return b.transform(c,d,e,f,g,h),b}function kf(a){const{a:b,b:c,c:d,d:e}=a;return b*e-c*d}function lf(a){return Math.hypot(a.a,a.b,a.c,a.d,a.tx,a.ty,1)}function mf(a,b,c,d,e,f){if(d===0)return a.set(1,0,0,1,b,c);{const g=Math.sin(d),h=Math.cos(d);return a.set(h*e,g*e,-g*f,h*f,b,c)}}function nf(a,b,c,d=0,e=1,f=1,g=0,h=0){return d===0?a.set(1,0,0,1,b,c):a.set(Math.cos(d+h)*e,Math.sin(d+h)*e,-Math.sin(d-g)*f,Math.cos(d-g)*f,b,c)}function of(a){const{a:b,b:c,c:d,d:e,tx:f,ty:g}=a;let h=b*e-c*d;return h&&(h=1/h,a.set(e*h,-c*h,-d*h,b*h,(d*g-e*f)*h,(c*f-b*g)*h)),a}function pf(a,b,c,d=new T()){const{a:e,b:f,c:g,d:h,tx:i,ty:j}=a;return d.x=e*b+g*c+i,d.y=f*b+h*c+j,d}function qf(a,b){const{a:c,b:d,c:e,d:f,tx:g,ty:h}=a,{a:i,b:j,c:k,d:l,tx:m,ty:n}=b;return a.a=c*i+e*j,a.b=d*i+f*j,a.c=c*k+e*l,a.d=d*k+f*l,a.tx=c*m+e*n+g,a.ty=d*m+f*n+h,a}function rf(a,b){return a.a*=b,a.b*=b,a.c*=b,a.d*=b,a.tx*=b,a.ty*=b,a}function sf(a,b,c){const{a:d,b:e,c:f,d:g,tx:h,ty:i}=b;return a.a+=d*c,a.b+=e*c,a.c+=f*c,a.d+=g*c,a.tx+=h*c,a.ty+=i*c,a}function tf(a,b){const{a:c,b:d,c:e,d:f,tx:g,ty:h}=a,i=Math.sin(b),j=Math.cos(b);return a.set(c*j+e*i,d*j+f*i,c*-i+e*j,d*-i+f*j,g,h)}function uf(a,b,c){return a.a*=b,a.b*=b,a.c*=c,a.d*=c,a}function vf(a,b){const{a:c,b:d,c:e,d:f,tx:g,ty:h}=a;return b.setTransform(c,d,e,f,g,h),b}function wf(a,b,c){return a.b+=Math.tan(b),a.c+=Math.tan(c),a}function xf(a,b){const{a:c,b:d,c:e,d:f,tx:g,ty:h}=b;return a.a-=c,a.b-=d,a.c-=e,a.d-=f,a.tx-=g,a.ty-=h,a}function yf(a,b,c){const{a:d,b:e,c:f,d:g,tx:h,ty:i}=a;return a.tx=d*b+f*c+h,a.ty=e*b+g*c+i,a}function zf(a){return a.set(0,0,0,0,0,0)}var Ih=Object.freeze({__proto__:null,Add:hf,Copy:$a,CopyToContext:jf,Determinant:kf,Frobenius:lf,GlobalToLocal:gf,Invert:of,ITRS:mf,ITRSS:nf,LocalToGlobal:pf,Matrix2D:o,Multiply:qf,MultiplyScalar:rf,MultiplyScalarAndAdd:sf,Rotate:tf,Scale:uf,SetToContext:vf,Skew:wf,Subtract:xf,Translate:yf,Zero:zf});function Te(a,b){return new o(a.a+b.a,a.b+b.b,a.c+b.c,a.c+b.c,a.tx+b.tx,a.ty+b.ty)}function Ue(a){return new o(a.a,a.b,a.c,a.d,a.tx,a.ty)}function Ve(a,b,c=1e-6){const{a:d,b:e,c:f,d:g,tx:h,ty:i}=a,{a:j,b:k,c:l,d:m,tx:n,ty:s}=b;return Math.abs(d-j)<=c*Math.max(1,Math.abs(d),Math.abs(j))&&Math.abs(e-k)<=c*Math.max(1,Math.abs(e),Math.abs(k))&&Math.abs(f-l)<=c*Math.max(1,Math.abs(f),Math.abs(l))&&Math.abs(g-m)<=c*Math.max(1,Math.abs(g),Math.abs(m))&&Math.abs(h-n)<=c*Math.max(1,Math.abs(h),Math.abs(n))&&Math.abs(i-s)<=c*Math.max(1,Math.abs(i),Math.abs(s))}function Lb(a,b){const{a:c,b:d,c:e,d:f}=a,g=Math.sin(b),h=Math.cos(b);return new o(c*h+e*g,d*h+f*g,c*-g+e*h,d*-g+f*h)}function We(a){return Lb(new o(),a)}function Mb(a,b,c){return new o(a.a*b,a.b*b,a.c*c,a.d*c)}function Xe(a,b=a){return Mb(new o(),a,b)}function Nb(a,b,c){const{a:d,b:e,c:f,d:g,tx:h,ty:i}=a,j=d*b+f*c+h,k=e*b+g*c+i;return new o(1,0,0,1,j,k)}function Ye(a,b){return Nb(new o(),a,b)}function Ze(){return new o()}function _e(a){const{a:b,b:c,c:d,d:e,tx:f,ty:g}=a;let h=b*e-c*d;return h?(h=1/h,new o(e*h,-c*h,-d*h,b*h,(d*g-e*f)*h,(c*f-b*g)*h)):null}function $e(a,b){const{a:c,b:d,c:e,d:f,tx:g,ty:h}=a,{a:i,b:j,c:k,d:l,tx:m,ty:n}=b;return new o(c*i+e*j,d*i+f*j,c*k+e*l,d*k+f*l,c*m+e*n+g,d*m+f*n+h)}function af(a,b){return new o(a.a*b,a.b*b,a.c*b,a.d*b,a.tx*b,a.ty*b)}function bf(a,b,c){return new o(a.a+b.a*c,a.b+b.b*c,a.c+b.c*c,a.d+b.d*c,a.tx+b.tx*c,a.ty+b.ty*c)}function cf(a,b){return new o(a.a-b.a,a.b-b.b,a.c-b.c,a.c-b.c,a.tx-b.tx,a.ty-b.ty)}function df(){return new o(0,0,0,0,0,0)}var Eh=Object.freeze({__proto__:null,Add:Te,Append:Se,Clone:Ue,Equals:Ve,ExactEquals:Kb,FromRotation:We,FromScaling:Xe,FromTranslation:Ye,Identity:Ze,Invert:_e,Multiply:$e,MultiplyScalar:af,MultiplyScalarAndAdd:bf,Rotate:Lb,Scale:Mb,Subtract:cf,Translate:Nb,Zero:df});function ef(a){const b=Math.log(a)/.6931471805599453;return 1<<Math.ceil(b)}function ff(a){return a>0&&(a&a-1)===0}var Hh=Object.freeze({__proto__:null,GetPowerOfTwo:ef,IsSizePowerOfTwo:Qb,IsValuePowerOfTwo:ff});function Ge(a,b,c=0,d=!1){return b===0?a:(a-=c,a=b*Math.ceil(a/b),d?(c+a)/b:c+a)}function He(a,b,c=0,d=!1){return b===0?a:(a-=c,a=b*Math.floor(a/b),d?(c+a)/b:c+a)}function Ie(a,b,c=0,d=!1){return b===0?a:(a-=c,a=b*Math.round(a/b),d?(c+a)/b:c+a)}var Ch=Object.freeze({__proto__:null,SnapCeil:Ge,SnapFloor:He,SnapTo:Ie});function M(a,b){return a===void 0||b===void 0?void 0:`${a}|${b}`}function bh(a,b){let c=a.split("|");return b===void 0&&(b=Qi),b.x=parseInt(c[0]),b.y=parseInt(c[1]),b}let Qi={x:0,y:0};class qb{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(a){return this.items.push(a),this}pushMultiple(a){return this.items.push.apply(this.items,a),a.length=0,this}clear(){return this.items.length=0,this}}let nh=new qb();function hg(){let a=nh.pop();return a===null&&(a=new Map()),a}function mc(a){nh.push(a)}function fg(a,b,c,d,e,f,g,h){if(c===f&&d===g&&e===h)return;let i=M(c,d),j=M(f,g);if(i){let k=b.get(i);k.delete(e);if(i===j){k.set(h,a);return}else k.size===0&&(mc(k),b.delete(i))}if(j){let k=b.get(j);k?k.set(h,a):(k=hg(),k.set(h,a),b.set(j,k))}}function Gd(a,b,c,d){let e=M(b,c),f=a.get(e);f&&(d!==void 0?(f.delete(d),f.size===0&&(mc(f),a.delete(e))):(f.clear(),mc(f),a.delete(e)))}let oh=new qb();function gg(){let a=oh.pop();return a===null&&(a=new Set()),a}function Fd(a){oh.push(a)}function lc(a,b,c,d){if(c===d)return;if(c!==void 0){let e=b.get(c);e&&(e.delete(a),e.size===0&&(Fd(e),b.delete(c)))}if(d!==void 0){let e=b.get(d);e?e.add(a):(e=gg(),e.add(a),b.set(d,e))}}function qa(a,b,c){let d=a.get(b);d&&(d.delete(c),d.size===0&&(Fd(d),a.delete(b)))}function ag(a,b,c,d,e){let f=a.chessToXYZ.get(b),g=f?f.x:void 0,h=f?f.y:void 0,i=f?f.y:void 0;f?(f.x=c,f.y=d,f.z=e):a.chessToXYZ.set(b,{x:c,y:d,z:e}),fg(b,a.XYToZMap,g,h,i,c,d,e),lc(b,a.XToChessSet,g,c),lc(b,a.YToChessSet,h,d),lc(b,a.ZToChessSet,i,e)}function pa(a,b,c,d){let e=a.XYToZMap.get(M(b,c));return e===void 0?null:d!==void 0?e.has(d)?e.get(d):null:e}function bg(a,b,c,d){if(d!==void 0){let e=pa(a,b,c,d);if(e===void 0)return;a.chessToXYZ.delete(e),Gd(a.XYToZMap,b,c,d),qa(a.XToChessSet,b,e),qa(a.YToChessSet,c,e),qa(a.ZToChessSet,d,e)}else{let e=pa(a,b,c);if(e){for(const[f,g]of e)a.chessToXYZ.delete(g),qa(a.XToChessSet,b,g),qa(a.YToChessSet,c,g),qa(a.ZToChessSet,f,g);Gd(a.XYToZMap,b,c)}}}function cg(a,b){return a.chessToXYZ.has(b)}function dg(a,b,c,d){return pa(a,b,c,d)!==null}function eg(a,b){return a.chessToXYZ.get(b)||null}function Dd(a){let b=-Infinity;for(const[c,d]of a)b<c&&(b=c);return b}function Ed(a){let b=Infinity;for(const[c,d]of a)b>c&&(b=c);return b}class od{constructor(){this.chessToXYZ=new Map();this.XYToZMap=new Map();this.XToChessSet=new Map();this.YToChessSet=new Map();this.ZToChessSet=new Map();this._xMax=void 0;this._xMin=void 0;this._yMax=void 0;this._yMin=void 0}destroy(){this.clear()}clear(){return this.chessToXYZ.clear(),this.XYToZMap.clear(),this.XToChessSet.clear(),this.YToChessSet.clear(),this.ZToChessSet.clear(),this.clearBounds(),this}clearBounds(){return this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0,this}addChess(a,b,c,d){return ag(this,a,b,c,d),this.clearBounds(),this}getChess(a,b,c){return pa(this,a,b,c)}removeChess(a,b,c){return bg(this,a,b,c),this.clearBounds(),this}hasChess(a){return cg(this,a)}contains(a,b,c){return dg(this,a,b,c)}getXYZ(a){return eg(this,a)}get xMax(){return this._xMax===void 0&&(this._xMax=Dd(this.XToChessSet)),this._xMax}get xMin(){return this._xMin===void 0&&(this._xMin=Ed(this.XToChessSet)),this._xMin}get yMax(){return this._yMax===void 0&&(this._yMax=Dd(this.YToChessSet)),this._yMax}get yMin(){return this._yMin===void 0&&(this._yMin=Ed(this.YToChessSet)),this._yMin}}function V(a,b=[]){let c=a.boardData.chessToXYZ;for(const[d,e]of c)b.push(d);return b}function ch(a){if(typeof a!=="object"||a.nodeType||a===a.window)return!1;try{if(a.constructor&&!{}.hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0}function nb(a){return ch(a)?!0:typeof a==="object"?a.isTileXYZ:!1}function p(a,b){let c=a.boardData.getXYZ(b);return c?c:nb(b)?b:null}function u(a,b,c,d){return a.boardData.getChess(b,c,d)}class ig{constructor(a){this.board=null;this.blocker=!1;this.parent=a,this.boot()}boot(){typeof this.parent==="object"&&this.parent.on&&this.parent.on("destroy",this.destroy,this)}destroy(){if(this.board){let a=this.tileXYZ;this.board.boardData.removeChess(a.x,a.y,a.z)}this.parent=void 0,this.board=null}setBoard(a){return this.board=a,this}get tileXYZ(){return this.board==null?null:this.board.boardData.getXYZ(this.parent)}setBlocker(a=!0){return this.blocker=a,this}setBlockEdge(a,b=!0){typeof this.blocker==="boolean"&&(this.blocker={});let c=this.blocker;if(typeof a==="object"){let d=a;for(let e in d)c[e]=d[e]}else c[a]=b;return this}getBlockEdge(a){return typeof this.blocker==="boolean"?!1:this.blocker.hasOwnProperty(a)?this.blocker[a]:!1}}function P(a){return a.hasOwnProperty("rexChess")||(a.rexChess=new ig(a)),a.rexChess}function J(a,b,c,d,e,f=!1,g=!1){if(b){let h=p(a,b);if(h)c=h.x,d=h.y,e=h.z;else return}else{b=u(a,c,d,e);if(!b)return}g||a.boardData.removeChess(c,d,e),a._isBoard&&P(b).setBoard(null),f&&b.destroy&&b.destroy()}function oa(a,b){if(a.infinityMode)return;if(a.height===void 0||a.height<=b){a.height=b;return}let c=V(a);c.forEach(d=>{let e=p(a,d);e.y>b&&J(a,d)}),a.height=b}function na(a,b){if(a.infinityMode)return;if(a.width===void 0||a.width<=b){a.width=b;return}let c=V(a);c.forEach(d=>{let e=p(a,d);e.x>b&&J(a,d)}),a.width=b}class Xb{constructor({grid:a=void 0,wrap:b=!1,inifinity:c=!1,width:d=0,height:e=0}={}){this.boardData=new od(),this._isBoard=!0,this.setGrid(a),this.setWrapMode(b),this.setInfinityMode(c),this.setBoardSize(d,e)}destroy(){}setGrid(a){return this.grid=a,this}setWrapMode(a=!0){return this.wrapMode=a,this}setInfinityMode(a=!0){return this.infinityMode=a,this}setBoardSize(a=0,b=0){return na(this,a),oa(this,b),this}}function O(a,b,c,d){let e;return a.infinityMode?e=!0:e=b>=0&&b<a.width&&c>=0&&c<a.height,e&&d!==void 0&&(e=a.boardData.contains(b,c,d)),e}function C(a,b,c,d){return a.grid.getWorldXY(b,c,d)}function Na(a,b,c,d){if(b===void 0){let e=V(a);for(let f=0,g=e.length;f<g;f++){let h=e[f],i=p(a,h);C(a,i.x,i.y,h)}}else{if(c===void 0){let e=p(a,b);c=e.x,d=e.y}C(a,c,d,b)}}function da(a,b,c,d,e,f=!0){if(!O(a,c,d))return;let g=p(a,b);e===void 0&&(g?e=g.z:e=0);if(g&&g.x===c&&g.y===d&&g.z===e)return;let h=u(a,c,d,e);h&&(J(a,null,c,d,e),console.warn(`Chess at (${c},${d},${e}) has been removed because of overlapped`)),a.boardData.addChess(b,c,d,e),a._isBoard&&P(b).setBoard(a),f&&Na(a,b,c,d)}function ta(a,b,c,d){return Math.atan2(d-b,c-a)}function ea(a,b,c){let d=p(a,b),e=p(a,c),f=C(a,d.x,d.y,!0),g=f.x,h=f.y;f=C(a,e.x,e.y,!0);let i=f.x,j=f.y;return ta(g,h,i,j)}function $(a,b,c){let d=c-b;return b+((a-b)%d+d)%d}function Ma(a,b,c,d={x:0,y:0}){return d===!0&&(d=$h),a.wrapMode?b=$(b,0,a.width):!a.infinityMode&&(b<0||b>=a.width)&&(b=null),a.wrapMode?c=$(c,0,a.height):!a.infinityMode&&(c<0||c>=a.height)&&(c=null),d.x=b,d.y=c,d}let $h={x:0,y:0};function I(a,b,c,d,e){let f=p(a,b);if(f===null)return null;typeof c==="string"&&(c.includes(",")?c=c.split(".").map(j=>parseInt(j,10)):c=parseInt(c));let g=typeof c==="number",h=typeof d==="number";if(g&&h){let j=a.grid.getTileXYAtDirection(f,c,d,e);return Ma(a,j.x,j.y,j),(j.x===null||j.y===null)&&(j=null),j}Array.isArray(e)||(e=[]),c===null&&(c=a.grid.allDirections);let i;if(g)if(Array.isArray(d))for(let j=0,k=d.length;j<k;j++)i=I(a,f,c,d[j]),i!==null&&e.push(i);else{let j,k,l;({end:j=1,start:k=j>0?1:-1,step:l=j>=k?1:-1}=d);if(k===j)i=I(a,f,c,j),i!==null&&e.push(i);else if(k<j)for(let m=k;m<=j;m+=l)i=I(a,f,c,m),i!==null&&e.push(i);else for(let m=k;m>=j;m+=l)i=I(a,f,c,m),i!==null&&e.push(i)}else for(let j=0,k=c.length;j<k;j++)h?(i=I(a,f,c[j],d),i!==null&&e.push(i)):I(a,f,c[j],d,e);return e}function Y(a,b,c=null,d={x:0,y:0}){return I(a,b,c,1,d)}function Ia(a,b,c){b===void 0&&(b=di);let d=a.wrapMode,e=a.infinityMode;a.wrapMode=!1,a.infinityMode=!0;let f=Y(a,b,c,!0);return a.wrapMode=d,a.infinityMode=e,ea(a,b,f)}let di={x:0,y:0};const Ti=180/Math.PI;function Pa(a){return a*Ti}function mg(a,b){let c=b-a;if(c===0)return 0;let d=Math.floor((c- -180)/360);return c-d*360}function Ha(a,b,c){c=Pa(c);let d=a.grid.allDirections,e=Infinity,f;for(let g=0,h=d.length;g<h;g++){let i=Pa(Ia(a,b,d[g])),j=Math.abs(mg(c,i));j<e&&(e=j,f=g)}return f}function La(a,b,c){if(b===null||c===null)return null;if(b.x===c.x&&b.y===c.y)return null;let d=a.grid.getNeighborTileDirection(b,c);if(a.wrapMode&&d===null){let e=Y(a,b,null);for(let f=0,g=e.length;f<g;f++){let h=e[f];if(c.x===h.x&&c.y===h.y){d=f;break}}}return d}function Ka(a,b,c){let d=p(a,b),e=p(a,c);return La(a,d,e)}function Zb(a,b,c){return Ka(a,b,c)!==null}function _b(a,b,c,d=!0){let e=p(a,b),f=p(a,c);return e===null||f===null?null:a.grid.directionBetween(e,f,d)}function lb(a,b,c=1,d=[]){let e=a.grid.ringToTileXYArray(b,c);for(let f=0,g=e.length;f<g;f++){let h=e[f];O(a,h.x,h.y)&&d.push(h)}return d}function pd(a,b,c,d=!0,e=[]){for(let f=0;f<=c;f++){let g=d?f:c-f;lb(a,b,g,e)}return e}function W(a,b,c,d,e={x:0,y:0}){return e===!0&&(e=bi),c===0&&d===0?(e.x=b.x,e.y=b.y):a.grid.offset(b,c,d,e),e}let bi={x:0,y:0};function qd(a,b){let c=Infinity,d=Infinity,e;for(let h=0,i=b.length;h<i;h++)e=b[h],c=Math.min(c,e.x),d=Math.min(d,e.y);if(c!==0||d!==0)for(let h=0,i=b.length;h<i;h++)e=b[h],W(a,e,-c,-d,e);let f=-Infinity,g=-Infinity;for(let h=0,i=b.length;h<i;h++)e=b[h],f=Math.max(f,e.x),g=Math.max(g,e.y);return na(a,f+1),oa(a,g+1),b}var ra;(function(a){a[a["x+,y+"]=0]="x+,y+",a[a["x-,y+"]=1]="x-,y+",a[a["y+,x+"]=2]="y+,x+",a[a["y-,x+"]=3]="y-,x+"})(ra||(ra={}));function $b(a,b,c,d=0){let e={x:0,y:0};switch(d){case 0:for(let f=0;f<a.height;f++)for(let g=0;g<a.width;g++)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 1:for(let f=0;f<a.height;f++)for(let g=a.width-1;g>=0;g--)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 2:for(let f=0;f<a.width;f++)for(let g=0;g<a.height;g++)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a);break;case 3:for(let f=0;f<a.width;f++)for(let g=a.height-1;g>=0;g--)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a)}}function ac(a,b,c,d){return a.grid.getDistance(b,c,d)}function kb(a,b=0,c=[]){if(Array.isArray(b)){let d=b;for(let e=0;e<a.height;e++)for(let f=0;f<a.width;f++){let g=!0;for(let h=0,i=d.length;h<i;h++)if(u(a,f,e,d[h])!==null){g=!1;break}g&&c.push({x:f,y:e})}}else for(let d=0;d<a.height;d++)for(let e=0;e<a.width;e++)u(a,e,d,b)===null&&c.push({x:e,y:d});return c}function Ja(a,b,c,d){return a.grid.getGridPoints(b,c,d)}function K(a,b,c,d=[]){let e=a.boardData.getChess(b,c);for(const[f,g]of e)d.push(g);return d}function Oa(a,b,c,d=[]){let e=c!=null,f,g;for(let h=0,i=b.length;h<i;h++)f=b[h],e?(g=u(a,f.x,f.y,c),g!==null&&d.push(g)):K(a,f.x,f.y,d);return d}function bc(a,b,c,d,e){let f=p(a,b);if(f===null)return null;d==null&&(d=f.hasOwnProperty("z")?f.z:null);let g=Y(a,f,c,!0);return g===null?null:Array.isArray(g)?(e===void 0&&(e=[]),Oa(a,g,d,e)):d==null?(e===void 0&&(e=[]),K(a,g.x,g.y,e)):u(a,g.x,g.y,d)}function cc(a,b,c,d={x:0,y:0}){let e=Ha(a,b,c);return I(a,b,e,1,d)}function dc(a,b,c,d){return a.grid.getOppositeDirection(b,c,d)}function Hd(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function nc(a,b=0,c=a.length){let d=b+Math.floor(Math.random()*c);return a[d]===void 0?null:a[d]}function rd(a,b=0,c={x:0,y:0}){c===!0&&(c=Yh);let d=Math.floor(a.width*a.height*.3);for(let f=0;f<d;f++){let g=Hd(0,a.width-1),h=Hd(0,a.height-1);if(u(a,g,h,b)===null)return c.x=g,c.y=h,c}let e=kb(a,b);if(e.length===0)return null;{let f=nc(e);return c.x=f.x,c.y=f.y,c}}let Yh={x:0,y:0};function sd(a,b,c,d){if(d===void 0){let e=K(a,b,c);for(let f=0,g=e.length;f<g;f++){let h=P(e[f]).blocker;if(h===!0)return!0}return!1}else{let e=u(a,b,c,d);if(e===null)return!1;let f=P(e).blocker;return f===!0}}function td(a,b){return a.boardData.chessToXYZ.has(b)}function ud(a,b,c,d,e){if(d===void 0){let f=K(a,b,c);for(let g=0,h=f.length;g<h;g++)if($f(P(f[g]).blocker,e))return!0;return!1}else{let f=u(a,b,c,d);return f===null?!1:$f(P(f).blocker,e)}}function $f(a,b){return a===!1||a===!0?a:a[b]===!0}function Jd(a){return a=a%mh,a>=0?a:a+mh}const mh=Math.PI*2;function ng(a,b,c=1e-4){return Math.abs(a-b)<c}function ec(a,b,c,d,e){let f=p(a,b),g=p(a,c),h=ea(a,f,g);h=Jd(h);let i=Math.abs(h-d);i=Math.min(i,ei-i);let j=e/2;return ng(i,j)||i<j}const ei=Math.PI*2;function fc(a,b,c,d,e){let f=p(a,b),g=p(a,c),h=a.grid.directions;a.grid.directions=a.grid.sides;let i=a.grid.directionBetween(f,g,!1);a.grid.directions=h;let j=Math.abs(i-d);return j=Math.min(j,a.grid.directions-j),j<=e/2}function E(a,b,c,d={x:0,y:0}){return a.grid.getTileXY(b,c,d)}function gc(a,b,c,d){if(a.infinityMode&&d===void 0)return!0;let e=E(a,b,c,!0);return O(a,e.x,e.y,d)}function lg(a,b,c,d){let e=a-c,f=b-d;return Math.sqrt(e*e+f*f)}function Id(a,b,c){return(b-a)*c+a}function vd(a,b,c,d,e,f=[]){let g=lg(b,c,d,e),h=Math.min(a.grid.width,a.grid.height),i=Math.ceil(g/(h/4)),j;for(let k=0;k<=i;k++){let l=k/i,m=Id(b,d,l),n=Id(c,e,l),s=E(a,m,n);if(!O(a,s.x,s.y))continue;if(j&&j.x===s.x&&j.y===s.y)continue;f.push(s),j=s}return f}var sa;(function(a){a[a.x=1]="x",a[a.horizontal=1]="horizontal",a[a.h=1]="h",a[a.y=2]="y",a[a.vertical=2]="vertical",a[a.v=2]="v",a[a.xy=3]="xy"})(sa||(sa={}));function wd(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=ai),d!==null?W(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.mirror(e,c,e),d!==null&&W(a,e,d.x,d.y,e),e}let ai={x:0,y:0};function xd(a,b=!1,c=!1){let d=V(a);for(let e=0,f=d.length;e<f;e++)J(a,d[e],void 0,void 0,void 0,b,c)}function yd(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=ci),d!==null?W(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.rotate(e,c,e),d!==null&&W(a,e,d.x,d.y,e),e}let ci={x:0,y:0};function zd(a,b,c){let d=p(a,b);if(d===null)return;da(a,b,d.x,d.y,c)}function mb(a,b,c){return Math.max(b,Math.min(c,a))}function Ad(a,b,c,d=[]){let e=E(a,b.left,b.top,!0),f=e.x-1,g=e.y-1,h=E(a,b.right,b.bottom,!0),i=h.x+1,j=h.y+1;a.infinityMode||(f=mb(f,0,a.width-1),g=mb(g,0,a.height-1),i=mb(i,0,a.width-1),j=mb(j,0,a.height-1));for(let k=f;k<=i;k++)for(let l=g;l<=j;l++){let m=C(a,k,l,!0);c(b,m.x,m.y)&&d.push({x:k,y:l})}return d}function Bd(a,b,c,d=!0){let e=p(a,b),f=p(a,c);if(e==null||f==null)return;J(a,b),J(a,c),da(a,b,f.x,f.y,f.z,d),da(a,c,e.x,e.y,e.z,d)}function hc(a,b,c=[]){let d=a.boardData.ZToChessSet.get(b);if(d)for(const e of d)c.push(e);return c}function ic(a,b,c=[]){for(let d=0,e=b.length;d<e;d++){let f=b[d];c.push(C(a,f.x,f.y))}return c}function jc(a,b,c,d={x:0,y:0}){return d===!0&&(d=fi),E(a,b,c,d),C(a,d.x,d.y,d),d}let fi={x:0,y:0};function kc(a,b,c,d,e){let f=E(a,b,c,!0);return d!==void 0?u(a,f.x,f.y,d):K(a,f.x,f.y,e)}class Yb extends Xb{addChess(a,b,c,d,e=!0){return da(this,a,b,c,d,e),this}angleBetween(a,b){return ea(this,a,b)}angleSnapToDirection(a,b){return Ha(this,a,b)}angleToward(a,b){return Ia(this,a,b)}areNeighbors(a,b){return Zb(this,a,b)}chessToTileXYZ(a){return p(this,a)}contains(a,b,c){return O(this,a,b,c)}directionBetween(a,b,c=!0){return _b(this,a,b,c)}filledRingToTileXYArray(a,b,c=!0,d=[]){return pd(this,a,b,c,d)}fit(a){return qd(this,a)}forEachTileXY(a,b,c=0){return $b(this,a,b,c),this}getAllChess(a=[]){return V(this,a)}getChessData(a){return P(a)}getDistance(a,b,c=!1){return ac(this,a,b,c)}getEmptyTileXYArray(a=0,b=[]){return kb(this,a,b)}getGridPoints(a,b,c){return Ja(this,a,b,c)}getNeighborChess(a,b,c,d){return bc(this,a,b,c,d)}getNeighborChessDirection(a,b){return Ka(this,a,b)}getNeighborTileDirection(a,b){return La(this,a,b)}getNeighborTileXY(a,b=null,c={x:0,y:0}){return Y(this,a,b,c)}getNeighborTileXYAtAngle(a,b,c={x:0,y:0}){return cc(this,a,b,c)}getOppositeDirection(a,b,c){return dc(this,a,b,c)}getRandomEmptyTileXY(a=0,b={x:0,y:0}){return rd(this,a,b)}getTileXYAtDirection(a,b,c,d){return I(this,a,b,c,d)}getWrapTileXY(a,b,c={x:0,y:0}){return Ma(this,a,b,c)}gridAlign(a,b,c){return Na(this,a,b,c),this}hasBlocker(a,b,c){return sd(this,a,b,c)}hasChess(a){return td(this,a)}hasEdgeBlocker(a,b,c,d){return ud(this,a,b,c,d)}isAngleInCone(a,b,c,d){return ec(this,a,b,c,d)}isDirectionInCone(a,b,c,d){return fc(this,a,b,c,d)}isOverlappingPoint(a,b,c){return gc(this,a,b,c)}lineToTileXYArray(a,b,c,d,e=[]){return vd(this,a,b,c,d,e)}mirror(a,b,c=null,d={x:0,y:0}){return wd(this,a,b,c,d)}offset(a,b,c,d){return W(this,a,b,c,d)}removeAllChess(a=!1,b=!1){return xd(this,a,b),this}removeChess(a,b,c,d,e=!1,f=!1){return J(this,a,b,c,d,e,f),this}ringToTileXYArray(a,b=1,c=[]){return lb(this,a,b,c)}rotate(a,b,c=null,d={x:0,y:0}){return yd(this,a,b,c,d)}setBoardWidth(a=0){return na(this,a),this}setBoardHeight(a=0){return oa(this,a),this}setTileZ(a,b){return zd(this,a,b),this}shapeToTileXYArray(a,b,c=[]){return Ad(this,a,b,c)}swapChess(a,b,c=!0){return Bd(this,a,b,c),this}tileXYArrayToChessArray(a,b,c=[]){return Oa(this,a,b,c)}tileXYToChessArray(a,b,c=[]){return K(this,a,b,c)}tileXYZToChess(a,b,c){return u(this,a,b,c)}tileZToChessArray(a,b=[]){return hc(this,a,b)}tileXYArrayToWorldXYArray(a,b=[]){return ic(this,a,b)}tileXYToWorldXY(a,b,c={x:0,y:0}){return C(this,a,b,c)}worldXYSnapToGrid(a,b,c={x:0,y:0}){return jc(this,a,b,c)}worldXYToChess(a,b,c,d){return kc(this,a,b,c,d)}worldXYToTileXY(a,b,c){return E(this,a,b,c)}}class tb extends Yb{}const N={};Md(N,{ChessToTileXYZ:()=>p,Contains:()=>O,DirectionBetween:()=>_b,ForEachTileXY:()=>$b,GetDistance:()=>ac,GetOppositeDirection:()=>dc,GetTileXYAtDirection:()=>I,GetWrapTileXY:()=>Ma,IsDirectionInCone:()=>fc,TileXYArrayToChessArray:()=>Oa,TileXYToChessArray:()=>K,TileXYZToChess:()=>u,TileZToChessArray:()=>hc});const fa={};Md(fa,{AngleBetween:()=>ea,AngleSnapToDirection:()=>Ha,AngleToward:()=>Ia,GetGridPoints:()=>Ja,GridAlign:()=>Na,IsAngleInCone:()=>ec,IsOverlappingPoint:()=>gc,TileXYArrayToWorldXYArray:()=>ic,TileXYToWorldXY:()=>C,WorldXYSnapToGrid:()=>jc,WorldXYToChess:()=>kc,WorldXYToTileXY:()=>E});const _={};Md(_,{AreNeighbors:()=>Zb,GetNeighborChess:()=>bc,GetNeighborChessDirection:()=>Ka,GetNeighborTileDirection:()=>La,GetNeighborTileXY:()=>Y,GetNeighborTileXYAtAngle:()=>cc});var t;(function(a){a[a.orthogonal=0]="orthogonal",a[a.isometric=1]="isometric"})(t||(t={}));var aa;(function(a){a[a["4dir"]=4]="4dir",a[a["8dir"]=8]="8dir"})(aa||(aa={}));class Ug{constructor({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=t.orthogonal,dir:f=aa["4dir"]}={}){this.setOriginPosition(a,b),this.setCellSize(c,d),this.setType(e),this.setDirectionMode(f)}fromJSON({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=t.orthogonal,dir:f=aa["4dir"]}={}){return this.setType(e),this.setDirectionMode(f),this.setOriginPosition(a,b),this.setCellSize(c,d),this}toJSON(){return{x:this.x,y:this.y,cellWidth:this.cellWidth,cellHeight:this.cellHeight,type:this.mode,dir:this.directions}}setOriginPosition(a=0,b=0){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setType(a=t.orthogonal){return typeof a==="string"&&(a=t[a]),this.mode=a,this}setDirectionMode(a=aa["4dir"]){return typeof a==="string"&&(a=aa[a]),this.directions=a,this}}function Mg(a,b,c,d=!0){let e;switch(a.mode){case t.orthogonal:case t.isometric:if(b.y===c.y)e=c.x>=b.x?0:2;else if(b.x===c.x)e=c.y>=b.y?1:3;else if(a.directions===aa["4dir"]){let f=Pa(ta(b.x,b.y,c.x,c.y));f<0&&(f+=360),e=f/90,d&&(e=Math.round(e))}else{let f=c.x-b.x,g=c.y-b.y;if(f===g)e=f>0?4:6;else if(f===-g)e=f>0?7:5;else{let h=Pa(Math.atan2(g,f));h<0&&(h+=360);let i=h/45;d&&(i=Math.round(i)),i>=0&&i<1?e=i:i>=1&&i<2?e=i+3:i>=2&&i<3?e=i-1:i>=3&&i<4?e=i+2:i>=4&&i<5?e=i-2:i>=5&&i<6?e=i+1:i>=6&&i<7?e=i-3:e=i}}break}return e===a.directions&&(e=0),e}function xc(a,b){return $(b,0,a.directions)}function Ng(a,b,c,d=!1){let e=c.x-b.x,f=c.y-b.y,g;return d?g=Math.abs(e)+Math.abs(f):g=Math.sqrt(e*e+f*f),g}function tc(a,b=[]){if(!(b.length===a))if(b.length<a)for(let c=b.length;c<a;c++)b.push({x:0,y:0});else b.length=a;return b}function Ac(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Ai);let e,f;switch(a.mode){case t.orthogonal:e=b*a.width,f=c*a.height;break;case t.isometric:e=(b-c)*a._halfWidth,f=(b+c)*a._halfHeight;break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let Ai={x:0,y:0};function Og(a,b=0,c=0,d=[]){if(typeof b==="object"){let i=b;c=i.y,b=i.x}d===!0&&(d=wi),tc(4,d);let e,f;({x:e,y:f}=Ac(a,b,c));let g=a._halfWidth,h=a._halfHeight;switch(a.mode){case t.orthogonal:d[0].x=e+g,d[0].y=f-h,d[1].x=e+g,d[1].y=f+h,d[2].x=e-g,d[2].y=f+h,d[3].x=e-g,d[3].y=f-h;break;case t.isometric:d[0].x=e+g,d[0].y=f,d[1].x=e,d[1].y=f+h,d[2].x=e-g,d[2].y=f,d[3].x=e,d[3].y=f-h;break}return d}let wi=[];const Qa=[[1,0],[0,1],[-1,0],[0,-1],[1,1],[-1,1],[-1,-1],[1,-1]],ob=Qa;function Jg(a){let b={},c,d,e;for(let f in a)c=a[f],d=c[0],e=c[1],b.hasOwnProperty(d)||(b[d]={}),b[d][e]=parseInt(f);return b}const Kg=Jg(Qa),Lg=Jg(ob);function Pg(a,b,c){let d;switch(a.mode){case t.orthogonal:d=Kg;break;case t.isometric:d=Lg;break}let e=c.x-b.x,f=c.y-b.y;if(d.hasOwnProperty(e)){let g=d[e];if(g.hasOwnProperty(f))return g[f]}return null}function Bc(a,b,c,d,e={x:0,y:0}){e===!0&&(e=zi);let f,g;switch(a.mode){case t.orthogonal:f=Qa[c][0],g=Qa[c][1];break;case t.isometric:f=ob[c][0],g=ob[c][1];break}return d===1?(e.x=b.x+f,e.y=b.y+g):(e.x=b.x+d*f,e.y=b.y+d*g),e}let zi={x:0,y:0};function Qg(a,b,c,d={x:0,y:0}){return Bc(a,b,c,1,d)}function Rg(a,b,c,d){return xi[d]}const xi={0:2,1:3,2:0,3:1,4:6,5:7,6:4,7:5};function Sg(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=yi),b-=a.x,c-=a.y;let e=b/a.width,f=c/a.height;switch(a.mode){case t.orthogonal:d.x=Math.round(e),d.y=Math.round(f);break;case t.isometric:d.x=Math.round(+e+f),d.y=Math.round(-e+f);break}return d}let yi={x:0,y:0};function Tg(a,b,c,d={x:0,y:0}){return typeof c==="string"&&(c=sa[c]),d===!0&&(d=Bi),d.x=c&1?-b.x:b.x,d.y=c&2?-b.y:b.y,d}let Bi={x:0,y:0};function ua(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Ci);let f=b.x+c,g=b.y+d;return e.x=f,e.y=g,e}let Ci={x:0,y:0};function Vg(a,b,c,d=[]){let e,f;for(e=c,f=-c;f<=c;f++)d.push(ua(a,b,e,f));for(f=c,e=c-1;e>=-c;e--)d.push(ua(a,b,e,f));for(e=-c,f=c-1;f>=-c;f--)d.push(ua(a,b,e,f));for(f=-c,e=-c+1;e<=c-1;e++)d.push(ua(a,b,e,f));return d}function Wg(a,b,c,d={x:0,y:0}){d===!0&&(d=Hi),c=$(c,0,3);let e,f;switch(c){case 1:e=-b.y,f=b.x;break;case 2:e=-b.x,f=-b.y;break;case 3:e=b.y,f=-b.x;break;default:e=b.x,f=b.y;break}return d.x=e,d.y=f,d}let Hi={x:0,y:0};function yc(a){a._savedOriginX=a.x,a._savedOriginY=a.y}function zc(a){a.x=a._savedOriginX,a.y=a._savedOriginY}class Ig extends Ug{get sides(){return 4}get allDirections(){return this.directions===4?Di:Ei}get halfDirections(){return this.directions===4?Fi:Gi}directionBetween(a,b,c=!0){return Mg(this,a,b,c)}directionNormalize(a){return xc(this,a)}getDistance(a,b,c=!1){return Ng(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return Og(this,a,b,c)}getNeighborTileDirection(a,b){return Pg(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return Qg(this,a,b,c)}getOppositeDirection(a,b,c){return Rg(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return Sg(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return Bc(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return Ac(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return Tg(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return ua(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return Vg(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return Wg(this,a,b,c)}restoreOrigin(){return zc(this),this}saveOrigin(){return yc(this),this}}const Di=[0,1,2,3],Ei=[0,1,2,3,4,5,6,7],Fi=[0,1],Gi=[0,1,4,5];var q;(function(a){a[a.ODD_R=0]="ODD_R",a[a.EVEN_R=1]="EVEN_R",a[a.ODD_Q=2]="ODD_Q",a[a.EVEN_Q=3]="EVEN_Q"})(q||(q={}));var X;(function(a){a[a.y=0]="y",a[a.flat=0]="flat",a[a.x=1]="x",a[a.pointy=1]="pointy"})(X||(X={}));var ia;(function(a){a[a.even=0]="even",a[a.odd=1]="odd"})(ia||(ia={}));class Cg{constructor({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=X.x,staggerIndex:g=ia.odd}={}){this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e)}fromJSON({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=X.x,staggerIndex:g=ia.odd}={}){return this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e),this}toJSON(){return{x:this.x,y:this.y,radius:this.radius,cellWidth:this.cellWidth,cellHeight:this.cellHeight,staggerAxis:this.staggerAxis,staggerIndex:this.staggerIndex}}setOriginPosition(a,b){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this.radius=void 0,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setRadius(a=0){let b,c;return this.staggerAxis===X.y?(b=2*a,c=Hg*a):(b=Hg*a,c=2*a),this.setCellSize(b,c),this.radius=a,this}setDirectionMode(){return this.directions=6,this}setType(a=1,b=1){return typeof a==="string"&&(a=X[a]),typeof b==="string"&&(b=ia[b]),this.staggerAxis=a,this.staggerIndex=b,a===X.y?this.mode=b===ia.even?q.EVEN_Q:q.ODD_Q:this.mode=b===ia.even?q.EVEN_R:q.ODD_R,this}}const Hg=Math.sqrt(3);function L(a,b,c,d={x:0,y:0,z:0}){d===!0&&(d=Kd);switch(a){case q.ODD_R:d.x=b-(c-(c&1))/2,d.z=c;break;case q.EVEN_R:d.x=b-(c+(c&1))/2,d.z=c;break;case q.ODD_Q:d.x=b,d.z=c-(b-(b&1))/2;break;case q.EVEN_Q:d.x=b,d.z=c-(b+(b&1))/2;break}return d.y=-d.x-d.z,d}function qg(a,b,c,d={x:0,y:0,z:0}){typeof a!=="number"&&(d=a,a=d.x,b=d.y,c=d.z),d===!0&&(d=Kd);let e=Math.round(a),f=Math.round(b),g=Math.round(c),h=Math.abs(e-a),i=Math.abs(f-b),j=Math.abs(g-c);return h>i&&h>j?e=-f-g:i>j?f=-e-g:g=-e-f,d.x=e,d.y=f,d.z=g,d}function A(a,b,c,d,e={x:0,y:0}){e===!0&&(e=hi);switch(a){case q.ODD_R:e.x=b+(d-(d&1))/2,e.y=d;break;case q.EVEN_R:e.x=b+(d+(d&1))/2,e.y=d;break;case q.ODD_Q:e.x=b,e.y=d+(b-(b&1))/2;break;case q.EVEN_Q:e.x=b,e.y=d+(b+(b&1))/2;break}return e}function rg(a,b,c={x:0,y:0,z:0}){return c===!0&&(c=Kd),c.x=a,c.y=-a-b,c.z=b,c}let Kd={x:0,y:0,z:0},hi={x:0,y:0};function tg(a,b,c,d=!0){let e;L(a.mode,b.x,b.y,pc),L(a.mode,c.x,c.y,qc);let f=qc.x-pc.x,g=qc.y-pc.y,h=qc.z-pc.z;return h===0?e=f>0?0:3:f===0?e=h>0?1:4:g===0?e=h>0?2:5:f>0&&g<0&&h>0?e=0+h/-g:f<0&&g<0&&h>0?e=1+-g/h:f<0&&g>0&&h>0?e=2+g/-f:f<0&&g>0&&h<0?e=3+-h/g:f>0&&g>0&&h<0?e=4+f/-h:e=5+-g/f,d&&(e=Math.round(e)),e}let pc={x:0,y:0,z:0},qc={x:0,y:0,z:0};function ug(a,b,c,d=!1){L(a.mode,b.x,b.y,rc),L(a.mode,c.x,c.y,sc);let e=sc.x-rc.x,f=sc.y-rc.y,g=sc.z-rc.z;return(Math.abs(e)+Math.abs(f)+Math.abs(g))/2}let rc={x:0,y:0,z:0},sc={x:0,y:0,z:0};function uc(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=qi);let e=b*a.width,f=c*a.height;switch(a.mode){case q.ODD_R:c&1&&(e+=a._halfWidth),f*=.75;break;case q.EVEN_R:c&1&&(e-=a._halfWidth),f*=.75;break;case q.ODD_Q:e*=.75,b&1&&(f+=a._halfHeight);break;case q.EVEN_Q:e*=.75,b&1&&(f-=a._halfHeight);break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let qi={x:0,y:0};const Si=Math.PI/180;function ga(a){return a*Si}function vg(a,b=0,c=0,d=[]){if(typeof b==="object"){let g=b;c=g.y,b=g.x}d===!0&&(d=mi),tc(6,d);let e,f;({x:e,y:f}=uc(a,b,c));if(a.radius!==void 0){let g=a.radius,h=a.staggerAxis===X.flat?0:-30;for(let i=0;i<6;i++){let j=60*i+h,k=ga(j);d[i].x=e+g*Math.cos(k),d[i].y=f+g*Math.sin(k)}}else{let g=a._halfWidth,h=g/2,i=a._halfHeight,j=i/2;a.staggerAxis===X.flat?(d[0].x=e+g,d[0].y=f,d[1].x=e+h,d[1].y=f+i,d[2].x=e-h,d[2].y=f+i,d[3].x=e-g,d[3].y=f,d[4].x=e-h,d[4].y=f-i,d[5].x=e+h,d[5].y=f-i):(d[0].x=e+g,d[0].y=f-j,d[1].x=e+g,d[1].y=f+j,d[2].x=e,d[2].y=f+i,d[3].x=e-g,d[3].y=f+j,d[4].x=e-g,d[4].y=f-j,d[5].x=e,d[5].y=f-i)}return d}let mi=[];const ii=[[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]]],ji=[[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]],[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]]],ki=[[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]],[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]]],li=[[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]],[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]]],Q=[ii,ji,ki,li];function ha(a){let b={},c,d;for(let e in a)[c,d]=a[e],b.hasOwnProperty(c)||(b[c]={}),b[c][d]=parseInt(e);return b}const sg=[[ha(Q[0][0]),ha(Q[0][1])],[ha(Q[1][0]),ha(Q[1][1])],[ha(Q[2][0]),ha(Q[2][1])],[ha(Q[3][0]),ha(Q[3][1])]];function vc(a,b,c){let d;switch(a){case q.ODD_R:case q.EVEN_R:d=c&1;break;case q.ODD_Q:case q.EVEN_Q:d=b&1;break}return d}function wg(a,b,c){let d=a.mode,e=vc(d,b.x,b.y),f=sg[d][e],g=c.x-b.x,h=c.y-b.y;if(f.hasOwnProperty(g)){let i=f[g];if(i.hasOwnProperty(h))return i[h]}return null}function wc(a,b,c,d,e={x:0,y:0}){e===!0&&(e=pi);let f=a.mode,g=b.x,h=b.y;if(d===1){let i=vc(f,g,h);e.x=g+Q[f][i][c][0],e.y=h+Q[f][i][c][1]}else if(d===0)e.x=g,e.y=h;else{let i=L(f,g,h,!0),j,k,l;switch(c){case 1:j=i.x,k=i.y-d,l=i.z+d;break;case 2:j=i.x-d,k=i.y,l=i.z+d;break;case 3:j=i.x-d,k=i.y+d,l=i.z;break;case 4:j=i.x,k=i.y+d,l=i.z-d;break;case 5:j=i.x+d,k=i.y,l=i.z-d;break;default:j=i.x+d,k=i.y-d,l=i.z;break}A(f,j,k,l,e)}return e}let pi={x:0,y:0};function xg(a,b,c,d={x:0,y:0}){return wc(a,b,c,1,d)}function yg(a,b,c,d){return(d+3)%6}const zg=4/3,Ag=2/3;function Bg(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=oi),b-=a.x,c-=a.y;let e,f;switch(a.mode){case q.ODD_R:case q.EVEN_R:f=c*zg/a.height,e=b/a.width-Ag*(c/a.height);break;case q.ODD_Q:case q.EVEN_Q:f=c/a.height-Ag*(b/a.width),e=b*zg/a.width;break}let g=rg(e,f,ni);return qg(g),A(a.mode,g.x,g.y,g.z,d),d}let ni={x:0,y:0,z:0},oi={x:0,y:0};function Dg(a,b,c,d={x:0,y:0}){typeof c==="string"&&(c=sa[c]),d===!0&&(d=ti);let e=L(a.mode,b.x,b.y,!0),f=a.mode===q.ODD_R||a.mode===q.EVEN_R,g,h,i;return c&1&&(f?(g=e.y,h=e.x,i=e.z):(g=-e.x,h=-e.z,i=-e.y),e.x=g,e.y=h,e.z=i),c&2&&(f?(g=-e.y,h=-e.x,i=-e.z):(g=e.x,h=e.z,i=e.y)),A(a.mode,g,h,i,d),d}let ti={x:0,y:0};function Eg(a,b,c,d,e={x:0,y:0}){e===!0&&(e=ui);let f=b.x+c,g=b.y+d;switch(a.mode){case q.ODD_R:(d&1)!==0&&((g&1)===0&&(f+=1));break;case q.EVEN_R:(d&1)!==0&&((g&1)===0&&(f-=1));break;case q.ODD_Q:(c&1)!==0&&((f&1)==0&&(g+=1));break;case q.EVEN_Q:(c&1)!==0&&((f&1)==0&&(g-=1));break}return e.x=f,e.y=g,e}let ui={x:0,y:0};function Fg(a,b,c,d=[]){let e=L(a.mode,b.x,b.y,!0),f=e.x,g=e.y,h=e.z,i,j,k;for(k=c,i=0;i>=-c;i--)j=-i-k,d.push(A(a.mode,f+i,g+j,h+k));for(i=-c,j=1;j<=c;j++)k=-i-j,d.push(A(a.mode,f+i,g+j,h+k));for(j=c,k=-1;k>=-c;k--)i=-j-k,d.push(A(a.mode,f+i,g+j,h+k));for(k=-c,i=1;i<=c;i++)j=-i-k,d.push(A(a.mode,f+i,g+j,h+k));for(i=c,j=-1;j>=-c;j--)k=-i-j,d.push(A(a.mode,f+i,g+j,h+k));for(j=-c,k=1;k<=c-1;k++)i=-j-k,d.push(A(a.mode,f+i,g+j,h+k));return d}function Gg(a,b,c,d={x:0,y:0}){d===!0&&(d=vi),c=$(c,0,5);let e=L(a.mode,b.x,b.y,!0),f,g,h;switch(c){case 1:f=-e.z,g=-e.x,h=-e.y;break;case 2:f=e.y,g=e.z,h=e.x;break;case 3:f=-e.x,g=-e.y,h=-e.z;break;case 4:f=e.z,g=e.x,h=e.y;break;case 5:f=-e.y,g=-e.z,h=-e.x;break;default:f=e.x,g=e.y,h=e.z;break}return A(a.mode,f,g,h,d),d}let vi={x:0,y:0};class ub extends Cg{get sides(){return 6}get allDirections(){return ri}get halfDirections(){return si}directionBetween(a,b,c=!0){return tg(this,a,b,c)}directionNormalize(a){return xc(this,a)}getDistance(a,b,c=!1){return ug(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return vg(this,a,b,c)}getNeighborTileDirection(a,b){return wg(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return xg(this,a,b,c)}getOppositeDirection(a,b,c){return yg(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return Bg(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return wc(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return uc(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return Dg(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return Eg(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return Fg(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return Gg(this,a,b,c)}restoreOrigin(){return zc(this),this}saveOrigin(){return yc(this),this}}const ri=[0,1,2,3,4,5],si=[0,1,2];var x;(function(a){a[a.random=0]="random",a[a.diagonal=1]="diagonal",a[a.straight=2]="straight",a[a.line=3]="line",a[a.astar=10]="astar",a[a["astar-random"]=11]="astar-random",a[a["astar-line"]=12]="astar-line"})(x||(x={}));const va=null;class gh{constructor(a){this.content=[],this.scoreFunction=a}clear(){this.content.length=0}push(a){this.content.push(a),this.sinkDown(this.content.length-1)}pop(){let a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.bubbleUp(0)),a}remove(a){const b=this.content.indexOf(a);let c=this.content.pop();b!==this.content.length-1&&(this.content[b]=c,this.scoreFunction(c)<this.scoreFunction(a)?this.sinkDown(b):this.bubbleUp(b))}get size(){return this.content.length}rescoreElement(a){this.sinkDown(this.content.indexOf(a))}sinkDown(a){let b=this.content[a];for(;a>0;){let c=(a+1>>1)-1,d=this.content[c];if(this.scoreFunction(b)<this.scoreFunction(d))this.content[c]=b,this.content[a]=d,a=c;else break}}bubbleUp(a){let b=this.content.length,c=this.content[a],d=this.scoreFunction(c);for(;;){let e=a+1<<1,f=e-1,g=null,h;if(f<b){let i=this.content[f];h=this.scoreFunction(i),h<d&&(g=f)}if(e<b){let i=this.content[e],j=this.scoreFunction(i);j<(g===null?d:h)&&(g=e)}if(g!==null)this.content[a]=this.content[g],this.content[g]=c,a=g;else break}}}let tX=new gh(a=>a.f);const Ec=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d=d.prevNodes[0];return c.reverse()};const jh=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d.prevNodes.length===1?d=d.prevNodes[0]:d=nc(d.prevNodes);return c.reverse()};const ih=function(a,b,c=[]){let d=b,e=b.angleTo(a);for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1)d=d.prevNodes[0];else{let f=Infinity;for(let g=1,h=d.prevNodes.length;g<h;g++){let i=d.prevNodes[g],j=Math.abs(b.angleTo(i)-e);j<f&&(f=j,d=i)}}}return c.reverse()};const hh=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let h=0,i=d.prevNodes.length;h<i;h++){f=d.prevNodes[h],g=f.logicDirTo(d);if(g!==e)break}e=g,d=f}}return c.reverse()};const kh=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let h=0,i=d.prevNodes.length;h<i;h++){f=d.prevNodes[h],g=f.logicDirTo(d);if(g===e)break}e=g,d=f}}return c.reverse()};let wa={};wa[x.astar]=Ec;wa[x["astar-line"]]=Ec;wa[x["astar-random"]]=Ec;wa[x.random]=jh;wa[x.line]=ih;wa[x.diagonal]=hh;wa[x.straight]=kh;class $g{constructor(){this.prevNodes=[]}shutdown(){this.key=void 0,this.prevNodes.length=0}destroy(){this.shutdown()}reset(a){this.key=a,this.f=0,this.g=0,this.h=void 0,this.closerH=void 0,this.visited=!1,this.closed=!1}heuristic(a,b,c){if(b===null)return 0;let d,e=this.distanceTo(a)*this.manager.weight;switch(b){case x.astar:d=e;break;case x["astar-line"]:if(c!==void 0){let f=a.angleTo(c)-this.angleTo(c);d=e+Math.abs(f)}else d=e;case x["astar-random"]:d=e+Math.random();break;default:d=e;break}return d}getNextNodes(){return[]}getCost(a){return va}distanceTo(a){return 0}angleTo(a){return 0}logicDirTo(a){return 0}getNode(a,b=!1){return this.manager.getNode(a,b)}}function ah(a){for(let b=a.length-1;b>0;b--){let c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a}class Pi extends $g{constructor(a){super();this.isTileXYZ=!0;this.pathFinder=a}reset(a){super.reset(a),this.key=a,bh(a,this),this._px=void 0,this._py=void 0,this.cost=void 0}getNextNodes(){let a=_.GetNeighborTileXY(this.board,this);this.pathFinder.shuffleNeighbors&&ah(a);let b=[];return a.forEach(c=>{let d=this.getNode(M(c.x,c.y),!0);b.push(d)}),b}getCost(a){return this.pathFinder.cacheCost?this.cost===void 0&&(this.cost=this.pathFinder.getCost(this,a)):this.cost=this.pathFinder.getCost(this,a),this.cost}distanceTo(a){return N.GetDistance(this.board,this,a,!0)}angleTo(a){return ta(this.worldX,this.wroldY,a.worldX,a.worldX)}logicDirTo(a){return _.GetNeighborTileDirection(this.board,this,a)}get board(){return this.pathFinder.board}get worldX(){if(this._px===void 0){let a=fa.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._px}get wroldY(){if(this._py===void 0){let a=fa.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._py}}function Cc(a,b,c,d,e){let f=typeof b==="number",g,h;f?(g=b,h=null):g=b.length;let i,j=a.wildcard,k,l=a.board,m=[];for(let n=0;n<g;n++){if(k===void 0)k={x:c,y:d};else{k=_.GetNeighborTileXY(l,k,e,k);if(k===null)return!1}i=a.getSymbol(k.x,k.y);if(i==null)return!1;if(i!==j){if(f){if(h===null)h=i;else if(h!==i)return!1}else if(b[n]!==i)return!1}m.push({x:k.x,y:k.y})}return{tileXY:m,direction:e,pattern:b}}function Ld(a,b,c,d,e=!1){let f=a.board,g=f.grid,h=g.halfDirections,i,j=a.dirMask,k=f.width,l=f.height,m;for(let n=0,s=h.length;n<s;n++){i=h[n];if(j[i]===!1)continue;for(let F=0;F<l;F++)for(let G=0;G<k;G++){m=Cc(a,b,G,F,i);if(m===!1)continue;c&&(d?c.call(d,m,f):c(m,f));if(e)return m}}}function Yg(a,b){let c=Ld(a,b,null,null,!0);return c?c:!1}function Xg(a,b,c,d=[]){let e=a.board,f=a.wildcard,g=a.getSymbol(b,c);if(g==null||g===f)return d;let h,i;for(pb.push(b,c);pb.length;)h=pb.pop(),i=a.getSymbol(h.x,h.y),(i===g||i===f)&&(d.push(h),pb.push(_.GetNeighborTileXY(e,h)));return pb.clear(),d}class Ki{constructor(){this.data=[];this.visited=new Set()}push(a,b){if(Array.isArray(a)){let d=a;for(let e=0,f=d.length;e<f;e++)this.push(d[e]);return this}if(typeof a==="object"){let d=a;a=d.x,b=d.y}let c=`${a},${b}`;return this.visited.has(c)?this:(this.data.push({x:a,y:b}),this.visited.add(c),this)}pop(){return this.data.pop()}get length(){return this.data.length}clear(){return this.data.length=0,this.visited.clear(),this}}let pb=new Ki();class vb{constructor({board:a,wildcard:b,dirMask:c}={}){this.symbols=[];this.dirMask={};this.setBoard(a),this.setWildcard(b),c!==void 0&&this.setDirMask(c),this.boot()}boot(){}destroy(){this.board=void 0,this.symbols=void 0,this.dirMask=void 0}setBoard(a){return this.board=a,a&&this.clearSymbols(),this}setDirMask(a,b=!1){if(typeof a==="object"){let c=a;for(let d in c)this.dirMask[d]=c[d]}else this.dirMask[a]=b;return this}setDirectionMode(a){return this.board.grid.setDirectionMode(a),this}clearSymbols(){return this.refreshSymbols(null),this}setSymbol(a,b,c){return N.Contains(this.board,a,b)?(this.symbols[this.tileXYToKey(a,b)]=c,this):this}getSymbol(a,b){return this.symbols[this.tileXYToKey(a,b)]}forEach(a,b){let c=this.board,d,e;for(let f=0,g=this.symbols.length;f<g;f++)e=this.symbols[f],d=this.keyToTileXY(f,!0),b?a.call(b,e,d,c):a(e,d,c);return this}refreshSymbols(a,b){let c=this.board,d=c.width,e=c.height;this.symbols.length=d*e;let f,g;if(typeof a==="function")for(let h=0,i=this.symbols.length;h<i;h++)g=this.keyToTileXY(h,!0),b?f=a.call(b,g,c):f=a(g,c),this.symbols[h]=f;else{f=a;for(let h=0,i=this.symbols.length;h<i;h++)this.symbols[h]=f}return this}setWildcard(a){return this.wildcard=a,this}tileXYToKey(a,b){return a+b*this.board.width}keyToTileXY(a,b={x:0,y:0}){b===!0&&(b=Li);let c=this.board.width;return b.x=a%c,b.y=Math.floor(a/c),b}group(a,b,c=[]){return Xg(this,a,b,c)}match(a,b,c,d=!1){return Ld(this,a,b,c,d),this}matchAny(a){return Yg(this,a)}matchAtDir(a,b,c,d){return Cc(this,a,b,c,d)}}let Li={x:0,y:0};var oc;(function(a){a[a.direction=0]="direction",a[a.angle=1]="angle"})(oc||(oc={}));function Ra(a,b,c,d=1){let e;if(typeof a==="string"){let h=Ea.get();h.has(a)||h.add(a,Ib()),e=h.get(a)}else e=a;let f=e.image,g=f.getContext("2d");return c?b.call(c,f,g):b(f,g),e.setSize(f.width/d,f.height/d),e.binding&&e.binding.update(),e}var rb;(function(a){a[a.left=1]="left",a[a.right=2]="right",a[a.both=3]="both"})(rb||(rb={}));function lh(a,b=0,c=" ",d=1){a=a.toString();let e=0;if(b+1>=a.length)switch(d){case 1:a=new Array(b+1-a.length).join(c)+a;break;case 3:e=b-a.length;let f=Math.ceil(e/2),g=e-f;a=new Array(g+1).join(c)+a+new Array(f+1).join(c);break;default:a=a+new Array(b+1-a.length).join(c);break}return a}function Sa(a,b,c){switch(typeof a){case"number":return`#${lh(Math.floor(a).toString(16),6,"0",rb.left)}`;case"function":return a(b,c);default:return a}}const MX=ga(0),NX=ga(90),OX=ga(180),PX=ga(270);function dh(a,b,c,d,e,f=2,g="round"){b.beginPath(),b.lineJoin=g;let h=c[0];b.moveTo(h.x,h.y);for(let i=1,j=c.length;i<j;i++)h=c[i],b.lineTo(h.x,h.y);b.closePath(),d!==void 0&&(b.fillStyle=d,b.fill()),e!==void 0&&(b.strokeStyle=e,b.lineWidth=f,b.stroke())}function Dc(a,{points:b,fillStyle:c,strokeStyle:d,lineWidth:e=2,lineJoin:f="round"}={}){return Ra(a,function(g,h){if(!b||b.length===0){g.width=1,g.height=1;return}d||(e=0);let i=Infinity,j=Infinity,k=-Infinity,l=-Infinity;for(let D=0,Ta=b.length;D<Ta;D++){const ja=b[D],Ua=ja.x,Va=ja.y;i=Math.min(i,Ua),j=Math.min(j,Va),k=Math.max(k,Ua),l=Math.max(l,Va)}const m=k-i,n=l-j,s=m/2,F=n/2,G=e/2;g.width=Math.ceil(m),g.height=Math.ceil(n);let H=[];for(let D=0,Ta=b.length;D<Ta;D++){const ja=b[D];H.push({x:eh(ja.x-i,s,G),y:eh(ja.y-j,F,G)})}dh(g,h,H,Sa(c,g,h),Sa(d,g,h),e,f)})}function eh(a,b,c){return a<b?a+c:a>b?a-c:a}var fh;(function(a){a[a.right=0]="right",a[a.down=1]="down",a[a.left=2]="left",a[a.up=3]="up"})(fh||(fh={}));function Xa(a,b,c,d,e,f="miter"){Dc(b,{points:Ja(a,0,0,!0),fillStyle:c,strokeStyle:d,lineWidth:e,lineJoin:f})}const Qd=[16711680,65280,255,8388736,8421376,32896];class rh extends za{constructor(){super(0,0,"chess")}setSymbol(a){return this.__symbol=a,Lc(Qd[a],this),this}getSymbol(){return this.__symbol}}class sh extends tb{constructor(a){super(a);this.match=new vb({board:this}),this.lastMatchedCount=0,Xa(this,"tile",void 0,"white",2),Xa(this,"chess","white")}setWorld(a){return this.world=a,this}strokeGrid(){return this.forEachTileXY(a=>{let b=this.tileXYToWorldXY(a.x,a.y,!0),c=new za(b.x,b.y,"tile");ya(this.world,c)}),this}fillChess(){return this.forEachTileXY(a=>{let b=new rh();b.setSymbol(Oc(0,Qd.length-1)),ya(this.world,b),this.addChess(b,a.x,a.y,0)}),this}refreshSymbols(){return this.match.refreshSymbols(a=>{var b=this.tileXYZToChess(a.x,a.y,0);return b===null?null:b.getSymbol()}),this}match3(){let a=0;return this.refreshSymbols(),this.match.match(3,b=>{let c=this.tileXYArrayToChessArray(b.tileXY,0);for(let d=0,e=c.length;d<e;d++)Mc(.5,c[d]);a++}),this.lastMatchedCount=a,this}}class th extends Pd{constructor(){super();const a=new Kc(this),b=new sh({grid:new ub({x:80,y:80,cellWidth:60,cellHeight:68}),width:8,height:8});b.setWorld(a).strokeGrid().fillChess().match3();const c=new Nc(0,580,`Match count= ${b.lastMatchedCount}`);c.setOrigin(0),ya(a,c)}}new Od(Jc(),Ic(800,600),Gc("game"),Fc(2960685),Hc(th));})();

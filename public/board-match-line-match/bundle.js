(()=>{var ui=Object.defineProperty,ml=a=>ui(a,"__esModule",{value:!0}),hg=(a,b)=>{ml(a);for(var c in b)ui(a,c,{get:b[c],enumerable:!0})};const v={AUTO:"Auto",BACKGROUND_COLOR:"BackgroundColor",BANNER:"Banner",BATCH_SIZE:"BatchSize",CANVAS_CONTEXT:"CanvasContext",CANVAS:"Canvas",DEFAULT_ORIGIN:"DefaultOrigin",GLOBAL_VAR:"GlobalVar",MAX_TEXTURES:"MaxTextures",PARENT:"Parent",RENDERER:"Renderer",SCENES:"Scenes",SIZE:"Size",WEBGL_CONTEXT:"WebGLContext",WEBGL:"WebGL"};const u=new Map();function mc(a){u.set(v.BACKGROUND_COLOR,a)}function Bd(a){return()=>{mc(a)}}function nc(a="",b="",c="",d="#fff",e="linear-gradient(#3e0081 40%, #00bcc3)"){u.set(v.BANNER,{title:a,version:b,url:c,color:d,background:e})}function Pd(a){u.set(v.BATCH_SIZE,a)}function sa(){return u.get(v.SIZE).height}function ta(){return u.get(v.SIZE).resolution}function ua(){return u.get(v.SIZE).width}function vb(a=800,b=600,c=1){c===0&&(c=window.devicePixelRatio),u.set(v.SIZE,{width:a,height:b,resolution:c})}function gc(a=800,b=600,c=1){return()=>{vb(a,b,c)}}const We=[],eb={add:(a,b)=>{We.push({texture:a,glConfig:b})},get:()=>We,clear:()=>{We.length=0}};function Qd(){return u.get(v.BACKGROUND_COLOR)}function pc(a){u.set(v.RENDERER,a)}function oc(a=.5,b=a){u.set(v.DEFAULT_ORIGIN,{x:a,y:b})}function ab(a){u.set(v.MAX_TEXTURES,a)}function xb(a){let b;return a&&(typeof a==="string"?b=document.getElementById(a):typeof a==="object"&&a.nodeType===1&&(b=a)),b||(b=document.body),b}function Td(a){a&&u.set(v.PARENT,xb(a))}function ec(a){return()=>{Td(a)}}function Vd(a){u.set(v.SCENES,[].concat(a))}function fc(a){return()=>{Vd(a)}}function Ac(a,b,c){return a.width<=0||a.height<=0?!1:a.x<=b&&a.x+a.width>=b&&a.y<=c&&a.y+a.height>=c}class K{constructor(a=0,b=0,c=0,d=0){this.set(a,b,c,d)}set(a=0,b=0,c=0,d=0){return this.x=a,this.y=b,this.width=c,this.height=d,this}contains(a,b){return Ac(this,a,b)}set right(a){a<=this.x?this.width=0:this.width=a-this.x}get right(){return this.x+this.width}set bottom(a){a<=this.y?this.height=0:this.height=a-this.y}get bottom(){return this.y+this.height}}function kf(a,b=0,c=0,d=0,e=0){const f=new K(b,c,d,e);return a.viewportStack.push(f),f}let h;const Mg={get:()=>h,set:a=>{h=a}};function Ma(a,b){if(!b){b=a.currentViewport;if(!b)return}const c=h.getParameter(h.VIEWPORT);(c[0]!==b.x||c[1]!==b.y||c[2]!==b.width||c[3]!==b.height)&&h.viewport(b.x,b.y,b.width,b.height)}function mf(a,b=0,c=0,d=0,e=0){const f=kf(a,b,c,d,e);Ma(a,f),a.currentViewport=f}function Ka(a,b=!0,c){c||(c=a.currentFramebuffer);const{framebuffer:d,viewport:e}=c;h.bindFramebuffer(h.FRAMEBUFFER,d),b&&(h.clearColor(0,0,0,0),h.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT)),e&&mf(a,e.x,e.y,e.width,e.height)}function qf(a){const b=a.viewportStack;b.length>1&&b.pop(),a.currentViewport=b[b.length-1],Ma(a)}function Ha(a){const b=a.framebufferStack;b.length>1&&(a.currentFramebuffer.viewport&&qf(a),b.pop()),a.currentFramebuffer=b[b.length-1],Ka(a,!1)}function gf(a,b,c){const d={framebuffer:b,viewport:c};return a.framebufferStack.push(d),d}function cb(a,b,c=!0,d){const e=gf(a,b,d);Ka(a,c,e),a.currentFramebuffer=e}function pf(a){const b=a.count;if(b===0)return;const c=a.currentVertexBuffer,d=a.currentShader,e=d.shader.renderToFramebuffer;e&&cb(a,d.shader.framebuffer,!0);if(b===c.batchSize){const f=c.isDynamic?h.DYNAMIC_DRAW:h.STATIC_DRAW;h.bufferData(h.ARRAY_BUFFER,c.data,f)}else{const f=c.indexed?b*c.entryElementSize:b*c.vertexElementSize,g=c.vertexViewF32.subarray(0,f);h.bufferSubData(h.ARRAY_BUFFER,0,g)}c.indexed?h.drawElements(h.TRIANGLES,b*c.entryIndexSize,h.UNSIGNED_SHORT,0):h.drawArrays(h.TRIANGLES,0,b),e&&Ha(a)}function M(a,b){b&&(a.count=b);const c=a.count;return c===0?!1:(pf(a),a.prevCount=c,a.count=0,a.flushTotal++,!0)}function Xe(a){M(a)}function Og(a,b=[]){const c=a>>16&255,d=a>>8&255,e=a&255,f=a>16777215?a>>>24:255;return b[0]=c/255,b[1]=d/255,b[2]=e/255,b[3]=f/255,b}function xg(){return u.get(v.WEBGL_CONTEXT)}function Pc(a){const{parent:b,flipY:c,unpackPremultiplyAlpha:d,minFilter:e,magFilter:f,wrapS:g,wrapT:i,generateMipmap:j,isPOT:k}=a,l=b.image;let m=b.width,p=b.height;const n=h.createTexture();return h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,n),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,c),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,d),l?(h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,l),m=l.width,p=l.height):h.texImage2D(h.TEXTURE_2D,0,h.RGBA,m,p,0,h.RGBA,h.UNSIGNED_BYTE,null),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,f),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,g),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),j&&k&&h.generateMipmap(h.TEXTURE_2D),a.texture=n,n}function oa(a){h&&h.isFramebuffer(a)&&h.deleteFramebuffer(a)}function Tb(a){h.isTexture(a)&&h.deleteTexture(a)}function Je(a,b){return a<1||b<1?!1:(a&a-1)===0&&(b&b-1)===0}function Wg(a,b=!0){h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,a);const c=b?h.LINEAR:h.NEAREST;h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,c),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,c)}function Xg(a){const b=a.parent.image,c=b.width,d=b.height;return c>0&&d>0&&(h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,a.texture),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,a.flipY),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,b)),a.texture}class db{constructor(a,b={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1,this.parent=a,this.isPOT=Je(a.width,a.height);const{texture:c=null,framebuffer:d=null,depthbuffer:e=null,unpackPremultiplyAlpha:f=!0,minFilter:g=this.isPOT?h.LINEAR_MIPMAP_LINEAR:h.LINEAR,magFilter:i=h.LINEAR,wrapS:j=h.CLAMP_TO_EDGE,wrapT:k=h.CLAMP_TO_EDGE,generateMipmap:l=this.isPOT,flipY:m=!1}=b;this.minFilter=g,this.magFilter=i,this.wrapS=j,this.wrapT=k,this.generateMipmap=l,this.flipY=m,this.unpackPremultiplyAlpha=f,d&&(this.framebuffer=d),e&&(this.depthbuffer=e),c?this.texture=c:Pc(this)}setFilter(a){this.texture&&Wg(this.texture,a)}create(){const a=this.texture;return a&&Tb(a),Pc(this)}update(){const a=this.texture;return a?Xg(this):Pc(this)}setIndex(a){this.dirtyIndex=a!==this.index,this.index=a}destroy(){Tb(this.texture),oa(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}}function Ye(){const a=eb.get();a.forEach(b=>{const{texture:c,glConfig:d}=b;c.binding||(c.binding=new db(c,d))}),eb.clear()}function wb(){return u.get(v.MAX_TEXTURES)}const dk=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function ek(a){let b="";for(let c=0;c<a;++c)c>0&&(b+=`
else `),c<a-1&&(b+=`if(test == ${c}.0){}`);return b}function nf(a){const b=h.createShader(h.FRAGMENT_SHADER);for(;;){const c=dk.replace(/%forloop%/gi,ek(a));h.shaderSource(b,c),h.compileShader(b);if(!h.getShaderParameter(b,h.COMPILE_STATUS))a=a/2|0;else break}return a}function of(a){let b=nf(h.getParameter(h.MAX_TEXTURE_IMAGE_UNITS));const c=wb();c===0||c>0&&c>b?ab(b):c>0&&c<b&&(b=Math.max(8,c));const d=a.tempTextures;d.length&&d.forEach(f=>{h.deleteTexture(f)});const e=[];for(let f=0;f<b;f++){const g=h.createTexture();h.activeTexture(h.TEXTURE0+f),h.bindTexture(h.TEXTURE_2D,g),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,1,1,0,h.RGBA,h.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),d[f]=g,e.push(f)}a.maxTextures=b,a.textureIndex=e,a.currentActiveTexture=1}function vg(){return u.get(v.BATCH_SIZE)}function Pb(a){h.isBuffer(a)&&h.deleteBuffer(a)}class Qg{constructor(a={}){this.indexed=!1,this.isDynamic=!1,this.count=0,this.offset=0;const{batchSize:b=1,dataSize:c=4,isDynamic:d=!0,elementsPerEntry:e=4,vertexElementSize:f=6}=a;this.batchSize=b,this.dataSize=c,this.vertexElementSize=f,this.isDynamic=d,this.elementsPerEntry=e,this.vertexByteSize=f*c,this.entryByteSize=this.vertexByteSize*e,this.bufferByteSize=b*this.entryByteSize,this.create()}resize(a){this.batchSize=a,this.bufferByteSize=a*this.entryByteSize,this.vertexBuffer&&Pb(this.vertexBuffer),this.create()}create(){const a=new ArrayBuffer(this.bufferByteSize);this.data=a,this.vertexViewF32=new Float32Array(a),this.vertexViewU32=new Uint32Array(a),this.vertexBuffer=h.createBuffer(),h.bindBuffer(h.ARRAY_BUFFER,this.vertexBuffer);const b=this.isDynamic?h.DYNAMIC_DRAW:h.STATIC_DRAW;h.bufferData(h.ARRAY_BUFFER,a,b),h.bindBuffer(h.ARRAY_BUFFER,null)}add(a){this.count+=a,this.offset+=this.vertexElementSize*a}reset(){this.count=0,this.offset=0}canContain(a){return this.count+a<=this.batchSize}free(){return Math.max(0,1-this.count/this.batchSize)}bind(){h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,null),h.bindBuffer(h.ARRAY_BUFFER,this.vertexBuffer)}destroy(){Pb(this.vertexBuffer),this.data=null,this.vertexViewF32=null,this.vertexViewU32=null,this.vertexBuffer=null}}class af extends Qg{constructor(a={}){super(a);const{indexSize:b=4,entryIndexSize:c=6,indexLayout:d=null}=a;this.indexed=!0,this.indexSize=b,this.entryIndexSize=c,this.entryElementSize=this.vertexElementSize*this.elementsPerEntry;const e=[];if(d){this.indexLayout=d;for(let f=0;f<this.batchSize*b;f+=b)for(let g=0;g<d.length;g++)e.push(f+d[g])}this.create(),this.createIndexBuffer(e)}createIndexBuffer(a){this.index=new Uint16Array(a),this.indexBuffer=h.createBuffer(),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.indexBuffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,this.index,h.STATIC_DRAW),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,null),a=[]}bind(){h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.indexBuffer),h.bindBuffer(h.ARRAY_BUFFER,this.vertexBuffer)}destroy(){super.destroy(),Pb(this.indexBuffer),this.index=null,this.indexLayout=null,this.indexBuffer=null}}const dh="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",jk=new Uint8Array(256);for(let a=0;a<dh.length;a++)jk[dh.charCodeAt(a)]=a;function ca(){}class w{constructor(a){const b=new Float32Array(16);this.data=b,this.onChange=ca,a?Array.isArray(a)?this.fromArray(a):this.fromArray(a.data):(b[0]=1,b[5]=1,b[10]=1,b[15]=1)}set(a,b,c,d,e,f,g,i,j,k,l,m,p,n,s,B){const q=this.data;return q[0]=a,q[1]=b,q[2]=c,q[3]=d,q[4]=e,q[5]=f,q[6]=g,q[7]=i,q[8]=j,q[9]=k,q[10]=l,q[11]=m,q[12]=p,q[13]=n,q[14]=s,q[15]=B,this.onChange(this),this}toArray(a=[],b=0){const c=this.data;for(let d=0;d<16;d++)a[b+d]=c[d];return a}fromArray(a,b=0){const c=this.data;for(let d=0;d<16;d++)c[d]=a[b+d];return this.onChange(this),this}toString(){return"[ mat4="+this.data.join(", ")+" ]"}destroy(){this.onChange=ca,this.data=null}}function Ie(a,b,c,d,e,f,g=new w()){const i=1/(a-b),j=1/(c-d),k=1/(e-f);return g.set(-2*i,0,0,0,0,-2*j,0,0,0,0,2*k,0,(a+b)*i,(d+c)*j,(f+e)*k,1)}function xf(a,b){const c=new Map(),d={size:1,type:h.FLOAT,normalized:!1,stride:0,offset:0},e=h.getProgramParameter(a,h.ACTIVE_ATTRIBUTES);for(let f=0;f<e;f++){const g=h.getActiveAttrib(a,f);if(!g)break;const i=g.name,j=h.getAttribLocation(a,i);h.enableVertexAttribArray(j);const k=b.hasOwnProperty(i)?b[i]:{},{size:l=d.size,type:m=d.type,normalized:p=d.normalized,stride:n=d.stride,offset:s=d.offset}=k;c.set(i,{index:j,size:l,type:m,normalized:p,stride:n,offset:s})}return c}function Sb(...a){a.forEach(b=>{h.deleteShader(b)})}function yf(...a){const b=h.createProgram();a.forEach(d=>{h.attachShader(b,d)}),h.linkProgram(b);const c=h.getProgramParameter(b,h.LINK_STATUS);if(!c){const d=h.getProgramInfoLog(b);return console.error(`Error linking program: ${d}`),h.deleteProgram(b),Sb(...a),null}return b}function Oc(a,b){const c=h.createShader(b);h.shaderSource(c,a),h.compileShader(c);const d=h.getShaderParameter(c,h.COMPILE_STATUS);if(!d){const e=h.getShaderInfoLog(c),f=a.split(`
`).map((g,i)=>`${i}: ${g}`);return console.error(`Error compiling shader: ${e}`,f.join(`
`)),h.deleteShader(c),null}return c}function zf(a,b,c=!1){switch(a.type){case h.INT:case h.BOOL:return c?d=>{h.uniform1iv(b,d)}:d=>{h.uniform1i(b,d)};case h.INT_VEC2:case h.BOOL_VEC2:return d=>{h.uniform2iv(b,d)};case h.INT_VEC3:case h.BOOL_VEC3:return d=>{h.uniform3iv(b,d)};case h.INT_VEC4:case h.BOOL_VEC4:return d=>{h.uniform4iv(b,d)};case h.FLOAT:return c?d=>{h.uniform1fv(b,d)}:d=>{h.uniform1f(b,d)};case h.FLOAT_VEC2:return d=>{h.uniform2fv(b,d)};case h.FLOAT_VEC3:return d=>{h.uniform3fv(b,d)};case h.FLOAT_VEC4:return d=>{h.uniform4fv(b,d)};case h.FLOAT_MAT2:return d=>{h.uniformMatrix2fv(b,!1,d)};case h.FLOAT_MAT3:return d=>{h.uniformMatrix3fv(b,!1,d)};case h.FLOAT_MAT4:return d=>{h.uniformMatrix4fv(b,!1,d)};case h.SAMPLER_2D:case h.SAMPLER_CUBE:return a.size>1?d=>{h.uniform1iv(b,d)}:d=>{h.uniform1i(b,d)}}}function Af(a){const b=new Map(),c=h.getProgramParameter(a,h.ACTIVE_UNIFORMS);for(let d=0;d<c;d++){const e=h.getActiveUniform(a,d);let f=e.name;if(f.startsWith("gl_")||f.startsWith("webgl_"))continue;const g=h.getUniformLocation(a,e.name);if(g){let i=!1;f.substr(-3)==="[0]"&&(f=f.substr(0,f.length-3),i=e.size>1),b.set(f,zf(e,g,i))}}return b}const Ng=5121,Lc=5126;const Oa={aVertexPosition:{size:2,type:Lc,normalized:!1,offset:0},aTextureCoord:{size:2,type:Lc,normalized:!1,offset:8},aTextureId:{size:1,type:Lc,normalized:!1,offset:16},aTintColor:{size:4,type:Ng,normalized:!0,offset:20}};const Bf={uProjectionMatrix:new Float32Array(),uCameraMatrix:new Float32Array(),uTexture:0};function Sg(a,b,c){h.bindFramebuffer(h.FRAMEBUFFER,a);const d=h.createRenderbuffer();return h.bindRenderbuffer(h.RENDERBUFFER,d),h.renderbufferStorage(h.RENDERBUFFER,h.DEPTH_COMPONENT16,b,c),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,d),h.bindFramebuffer(h.FRAMEBUFFER,null),d}function yc(a,b){b||(b=h.COLOR_ATTACHMENT0);const c=h.createFramebuffer();return h.bindFramebuffer(h.FRAMEBUFFER,c),h.framebufferTexture2D(h.FRAMEBUFFER,b,h.TEXTURE_2D,a,0),h.bindFramebuffer(h.FRAMEBUFFER,null),c}const Ug=`#define SHADER_NAME SINGLE_QUAD_FRAG

precision highp float;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

uniform sampler2D uTexture;

void main (void)
{
    vec4 color = texture2D(uTexture, vTextureCoord);

    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);
}`;const Vg=`#define SHADER_NAME SINGLE_QUAD_VERT

precision highp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute float aTextureId;
attribute vec4 aTintColor;

uniform mat4 uProjectionMatrix;
uniform mat4 uCameraMatrix;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

void main (void)
{
    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vTintColor = aTintColor;

    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);
}`;class Df{constructor(a,b,c,d,e,f){this.trimmed=!1,this.texture=a,this.key=b,this.x=c,this.y=d,this.width=e,this.height=f,this.sourceSizeWidth=e,this.sourceSizeHeight=f,this.updateUVs()}setPivot(a,b){this.pivot={x:a,y:b}}setSize(a,b){this.width=a,this.height=b,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.updateUVs()}setSourceSize(a,b){this.sourceSizeWidth=a,this.sourceSizeHeight=b}setTrim(a,b,c,d,e,f){this.trimmed=!0,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.spriteSourceSizeX=c,this.spriteSourceSizeY=d,this.spriteSourceSizeWidth=e,this.spriteSourceSizeHeight=f}getExtent(a,b){const c=this.sourceSizeWidth,d=this.sourceSizeHeight;let e,f,g,i;return this.trimmed?(e=this.spriteSourceSizeX-a*c,f=e+this.spriteSourceSizeWidth,g=this.spriteSourceSizeY-b*d,i=g+this.spriteSourceSizeHeight):(e=-a*c,f=e+c,g=-b*d,i=g+d),{left:e,right:f,top:g,bottom:i}}copyToExtent(a){const b=a.transform,c=b.origin.x,d=b.origin.y,e=this.sourceSizeWidth,f=this.sourceSizeHeight;let g,i,j,k;return this.trimmed?(g=this.spriteSourceSizeX-c*e,i=this.spriteSourceSizeY-d*f,j=this.spriteSourceSizeWidth,k=this.spriteSourceSizeHeight):(g=-c*e,i=-d*f,j=e,k=f),b.setExtent(g,i,j,k),this}copyToVertices(a,b=0){const{u0:c,u1:d,v0:e,v1:f}=this;return a[b+0].setUV(c,e),a[b+1].setUV(c,f),a[b+2].setUV(d,f),a[b+3].setUV(d,e),this}updateUVs(){const{x:a,y:b,width:c,height:d}=this,e=this.texture.width,f=this.texture.height;this.u0=a/e,this.v0=b/f,this.u1=(a+c)/e,this.v1=(b+d)/f}}class O{constructor(a,b,c,d){this.key="",a&&(b=a.width,c=a.height),this.image=a,this.width=b,this.height=c,this.frames=new Map(),this.data={},this.addFrame("__BASE",0,0,b,c),eb.add(this,d)}addFrame(a,b,c,d,e){if(this.frames.has(a))return null;const f=new Df(this,a,b,c,d,e);return this.frames.set(a,f),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=f),f}getFrame(a){if(!a)return this.firstFrame;a instanceof Df&&(a=a.key);let b=this.frames.get(a);return b||(console.warn(`Frame missing: ${a}`),b=this.firstFrame),b}setSize(a,b){this.width=a,this.height=b;const c=this.frames.get("__BASE");c.setSize(a,b)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}}class Cf{constructor(a){this.renderToFramebuffer=!1,this.renderToDepthbuffer=!1,a&&this.fromConfig(a)}fromConfig(a){const{attributes:b=Oa,fragmentShader:c=Ug,height:d=sa(),renderToFramebuffer:e=!1,renderToDepthbuffer:f=!1,resolution:g=ta(),vertexShader:i=Vg,width:j=ua(),uniforms:k=Bf}=a;this.create(c,i,k,b);if(e){this.renderToFramebuffer=!0;const l=new O(null,j*g,d*g),m=new db(l);l.binding=m,m.framebuffer=yc(m.texture),f&&(this.renderToDepthbuffer=!0,m.depthbuffer=Sg(m.framebuffer,l.width,l.height)),this.texture=l,this.framebuffer=m.framebuffer}}create(a,b,c,d){const e=Oc(a,h.FRAGMENT_SHADER),f=Oc(b,h.VERTEX_SHADER);if(!e||!f)return;const g=yf(e,f);if(!g)return;const i=h.getParameter(h.CURRENT_PROGRAM);h.useProgram(g),this.program=g,this.uniformSetters=Af(g),this.uniforms=new Map();for(const[j,k]of Object.entries(c))this.uniforms.set(j,k);this.attributes=xf(g,d),h.useProgram(i)}updateUniforms(a){}bind(a){return this.updateUniforms(a),this.setUniforms(a)}setUniform(a,b){const c=this.uniforms;if(c.has(a)){c.set(a,b);const d=this.uniformSetters.get(a);d(b)}}setUniforms(a){if(!this.program)return!1;h.useProgram(this.program);const b=this.uniforms;for(const[c,d]of this.uniformSetters.entries())d(b.get(c));return!0}setAttributes(a){if(this.program){const b=a.currentVertexBuffer.vertexByteSize;this.attributes.forEach(c=>{h.vertexAttribPointer(c.index,c.size,c.type,c.normalized,b,c.offset)})}}destroy(){Sb(this.program),Tb(this.texture),oa(this.framebuffer),this.uniforms.clear(),this.uniformSetters.clear(),this.attributes.clear(),this.program=null,this.texture=null,this.framebuffer=null}}class Na extends Cf{constructor(a={}){const b=a;b.attributes=b.attributes?b.attributes:Oa,super(b)}bind(a){const b=this.uniforms;return b.set("uProjectionMatrix",a.projectionMatrix.data),b.set("uCameraMatrix",a.cameraMatrix.data),super.bind(a)}}class fk extends Na{constructor(a={}){const b=a;b.attributes=b.attributes?b.attributes:Oa,b.renderToFramebuffer=!0,super(b)}bind(a){const b=a.renderer;return this.uniforms.set("uTime",performance.now()),this.uniforms.set("uResolution",[b.width,b.height]),super.bind(a)}}const Tg=`#define SHADER_NAME MULTI_QUAD_FRAG

precision highp float;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

uniform sampler2D uTexture[%count%];

void main (void)
{
    vec4 color;

    %forloop%

    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);
}`;class rf extends Na{constructor(a={}){a.fragmentShader||(a.fragmentShader=Tg),super(a)}create(a,b,c,d){const e=wb();let f="";for(let g=1;g<e;g++)g>1&&(f+=`
	else `),g<e-1&&(f+=`if (vTextureId < ${g}.5)`),f+=`
	{`,f+=`
		color = texture2D(uTexture[${g}], vTextureCoord);`,f+=`
	}`;a=a.replace(/%count%/gi,`${e}`),a=a.replace(/%forloop%/gi,f),super.create(a,b,c,d)}bind(a){return this.uniforms.set("uTexture",a.textureIndex),super.bind(a)}}function sf(a,b,c,d){const e={enable:b,sfactor:c,dfactor:d};a.blendModeStack[0]=e,a.currentBlendMode=e,a.defaultBlendMode=e}function tf(a,b=null,c){const d={framebuffer:b,viewport:c};a.framebufferStack[0]=d,a.currentFramebuffer=d,a.defaultFramebuffer=d}function uf(a,b,c){const d={shader:b,textureID:c};a.shaderStack[0]=d,a.currentShader=d,a.defaultShader=d}function vf(a,b){a.vertexBufferStack[0]=b,a.currentVertexBuffer=b,a.defaultVertexBuffer=b}function wf(a,b=0,c=0,d=0,e=0){const f=new K(b,c,d,e);a.viewportStack[0]=f,a.currentViewport=f,a.defaultViewport=f}let sg,tg=0,ug=0;const N={get:()=>sg,set:a=>{sg=a},getFrame:()=>tg,setFrame:a=>{tg=a},getElapsed:()=>ug,setElapsed:a=>{ug=a}};class o{constructor(a=0,b=0,c=0){this.set(a,b,c)}set(a=0,b=0,c=0){return this.x=a,this.y=b,this.z=c,this}toArray(a=[],b=0){const{x:c,y:d,z:e}=this;return a[b]=c,a[b+1]=d,a[b+2]=e,a}fromArray(a,b=0){return this.set(a[b],a[b+1],a[b+2])}toString(){const{x:a,y:b,z:c}=this;return`{ x=${a}, y=${b}, z=${c} }`}}function $a(a=new w()){return a.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}class D{constructor(a=1,b=0,c=0,d=1,e=0,f=0){this.set(a,b,c,d,e,f)}set(a=1,b=0,c=0,d=1,e=0,f=0){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=e,this.ty=f,this}identity(){return this.set()}toArray(){const{a,b,c,d,tx:e,ty:f}=this;return[a,b,c,d,e,f]}fromArray(a){return this.set(a[0],a[1],a[2],a[3],a[4],a[5])}}class ga{constructor(a,b=0,c=0){this._x=b,this._y=c,this.onChange=a}destroy(){this.onChange=ca}set(a=0,b=0){return this._x=a,this._y=b,this.onChange&&this.onChange(this),this}get x(){return this._x}set x(a){const b=this._x;this._x=a,b!==a&&this.onChange(this)}get y(){return this._y}set y(a){const b=this._y;this._y=a,b!==a&&this.onChange(this)}toArray(a=[],b=0){const{x:c,y:d}=this;return a[b]=c,a[b+1]=d,a}fromArray(a,b=0){return this.set(a[b],a[b+1])}toString(){const{x:a,y:b}=this;return`{ x=${a}, y=${b} }`}}const Ia={PI2:Math.PI*2,HALF_PI:Math.PI*.5,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};function Dc(a,b,c){const d=c-b;return b+((a-b)%d+d)%d}function Nd(a){return Dc(a,-Math.PI,Math.PI)}class Od{constructor(){this._rotation=0,this.type="Camera",this.dirtyRender=!0;const a=N.get();this.renderer=a.renderer,this.matrix=$a(),this.bounds=new K(),this.worldTransform=new D(),this.position=new ga(()=>this.updateTransform(),0,0),this.scale=new ga(()=>this.updateTransform(),1,1),this.origin=new ga(()=>this.updateTransform(),.5,.5),this.reset()}updateTransform(){const a=this.matrix.data,b=this.position.x,c=this.position.y,d=this.scale.x,e=this.scale.y,f=-b+this.width*this.origin.x,g=-c+this.height*this.origin.y,i=Math.sin(this.rotation),j=Math.cos(this.rotation),k=i+i,l=i*k,m=j*k,p=(1-l)*d,n=m*d,s=-m*e,B=(1-l)*e;a[0]=p,a[1]=n,a[4]=s,a[5]=B,a[12]=b+f-(p*f+s*g),a[13]=c+g-(n*f+B*g),this.worldTransform.set(j*d,i*d,-i*e,j*e,-b,-c);const q=this.width*(1/d),E=this.height*(1/e);this.bounds.set(f-q/2,g-E/2,q,E),this.dirtyRender=!0}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}set rotation(a){a!==this._rotation&&(this._rotation=Nd(a),this.updateTransform())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.origin.destroy(),this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}class ub{constructor(){this.type="StaticCamera",this.dirtyRender=!0;const a=N.get();this.renderer=a.renderer,this.matrix=$a(),this.bounds=new K(),this.worldTransform=new D(),this.reset()}reset(){const a=this.renderer;if(a){const b=a.width,c=a.height;this.width=b,this.height=c}this.bounds.set(0,0,this.width,this.height)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}class Ze{constructor(a){this.count=0,this.prevCount=0,this.flushTotal=0,this.maxTextures=0,this.currentActiveTexture=0,this.startActiveTexture=0,this.tempTextures=[],this.textureIndex=[],this.framebufferStack=[],this.currentFramebuffer=null,this.defaultFramebuffer=null,this.vertexBufferStack=[],this.currentVertexBuffer=null,this.defaultVertexBuffer=null,this.shaderStack=[],this.currentShader=null,this.defaultShader=null,this.viewportStack=[],this.currentViewport=null,this.defaultViewport=null,this.blendModeStack=[],this.currentBlendMode=null,this.defaultBlendMode=null,this.renderer=a,this.projectionMatrix=new w(),this.reset()}reset(){const a=this.renderer.gl,b=[0,1,2,2,3,0];this.quadShader=new Na(),this.quadBuffer=new af({isDynamic:!1,indexLayout:b}),this.quadCamera=new ub(),of(this),tf(this),sf(this,!0,a.ONE,a.ONE_MINUS_SRC_ALPHA),vf(this,new af({batchSize:vg(),indexLayout:b})),uf(this,new rf())}resize(a,b){Ie(0,a,b,0,-1e3,1e3,this.projectionMatrix),this.quadCamera.reset(),wf(this,0,0,a,b)}}function hf(a,b,c){const d={shader:b,textureID:c};return a.shaderStack.push(d),d}function jf(a,b){return a.vertexBufferStack.push(b),b}function Ja(a,b){b||(b=a.currentShader);const c=b.shader.bind(a,b.textureID);c&&b.shader.setAttributes(a)}function lf(a,b){a.current2DCamera=b,a.cameraMatrix=b.matrix,Ja(a)}function Rb(a,b){b||(b=a.currentBlendMode),b.enable?(h.enable(h.BLEND),h.blendFunc(b.sfactor,b.dfactor)):h.disable(h.BLEND)}function cf(a,b=0){const c=a.binding;c.setIndex(b),h.activeTexture(h.TEXTURE0+b),h.bindTexture(h.TEXTURE_2D,c.texture)}function La(a,b){b||(b=a.currentVertexBuffer);const c=b.indexed?b.indexBuffer:null;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,c),h.bindBuffer(h.ARRAY_BUFFER,b.vertexBuffer)}function Mc(a){const b=a.vertexBufferStack;b.length>1&&b.pop(),a.currentVertexBuffer=b[b.length-1],La(a)}function Nc(a,b){const c=jf(a,b);La(a,c),a.currentVertexBuffer=c}function Qb(a,b=0){const c=a.currentVertexBuffer;a.count+b>=c.batchSize&&M(a);const d=c.indexed?a.count*c.entryElementSize:a.count*c.vertexElementSize;return a.count+=b,{buffer:c,F32:c.vertexViewF32,U32:c.vertexViewU32,offset:d}}function df(a){const b=a.shaderStack;b.length>1&&b.pop(),a.currentShader=b[b.length-1],Ja(a)}function ef(a,b,c){const d=hf(a,b,c);Ja(a,d),a.currentShader=d}function bf(a,b){const c=b.binding,d=a.currentActiveTexture;return c.indexCounter<a.startActiveTexture&&(c.indexCounter=a.startActiveTexture,d<a.maxTextures?(c.setIndex(d),h.activeTexture(h.TEXTURE0+d),h.bindTexture(h.TEXTURE_2D,c.texture),a.currentActiveTexture++):(M(a),a.startActiveTexture++,c.indexCounter=a.startActiveTexture,c.setIndex(1),h.activeTexture(h.TEXTURE1),h.bindTexture(h.TEXTURE_2D,c.texture),a.currentActiveTexture=2)),c.index}function _e(a){a.current2DCamera=a.quadCamera,a.cameraMatrix=a.quadCamera.matrix,a.count=0,a.flushTotal=0,Ka(a,!1,a.defaultFramebuffer),Rb(a,a.defaultBlendMode),Ma(a,a.defaultViewport),La(a,a.defaultVertexBuffer)}function ff(a,b=0){h.activeTexture(h.TEXTURE0+b),h.bindTexture(h.TEXTURE_2D,a.tempTextures[b]),b>0&&a.startActiveTexture++}let Pg;const $e={get:()=>Pg,set:a=>{Pg=a}};class wg{constructor(){this.clearColor=[0,0,0,1],this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.width=ua(),this.height=sa(),this.resolution=ta(),this.setBackgroundColor(Qd());const a=document.createElement("canvas");a.addEventListener("webglcontextlost",b=>this.onContextLost(b),!1),a.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=a,this.initContext(),$e.set(this),this.renderPass=new Ze(this),this.resize(this.width,this.height,this.resolution)}initContext(){const a=this.canvas.getContext("webgl",xg());Mg.set(a),this.gl=a,a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE)}resize(a,b,c=1){const d=a*c,e=b*c;this.width=d,this.height=e,this.resolution=c;const f=this.canvas;f.width=d,f.height=e,this.autoResize&&(f.style.width=a.toString()+"px",f.style.height=b.toString()+"px"),this.renderPass.resize(d,e)}onContextLost(a){a.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(a){return Og(a,this.clearColor),this}reset(){}render(a){if(this.contextLost)return;const b=this.gl,c=this.renderPass;Ye();if(this.optimizeRedraw&&a.numDirtyFrames===0&&a.numDirtyCameras===0)return;if(this.clearBeforeRender){const e=this.clearColor;b.clearColor(e[0],e[1],e[2],e[3]),b.clear(b.COLOR_BUFFER_BIT)}const d=a.worldData;_e(c);for(let e=0;e<d.length;e++){const{world:f}=d[e];f.renderGL(c),f.postRenderGL(c)}Xe(c)}destroy(){$e.set(void 0)}}function Cd(){return()=>{pc(wg)}}function Gd(a,b){const c=xb(b);return c.appendChild(a),a}function Hd(a){const b=document.readyState;if(b==="complete"||b==="interactive"){a();return}const c=()=>{document.removeEventListener("deviceready",c,!0),document.removeEventListener("DOMContentLoaded",c,!0),window.removeEventListener("load",c,!0),a()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",c,!0):(document.addEventListener("DOMContentLoaded",c,!0),window.addEventListener("load",c,!0)):window.setTimeout(c,20)}function H(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);for(const e of d)e.callback.apply(e.context,c),e.once&&d.delete(e);return d.size===0&&a.events.delete(b),!0}class Id{constructor(){this.events=new Map()}}class Ab{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function Bb(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof Ab)g.delete(c);else{const i=!d,j=e!==void 0;for(const k of g)k.callback===c&&(i&&k.context===d)&&(j&&k.once===e)&&g.delete(k)}return g.size===0&&f.delete(b),a}function Ea(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new Ab(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function Cb(a,b,c,d=a){return Ea(a,b,c,d,!0)}function Jd(){const{title:a,version:b,url:c,color:d,background:e}=u.get(v.BANNER);if(a!==""){const f=b!==""?a+" "+b:a;console.log(`%c${f}%c ${c}`,`padding: 4px 16px; color: ${d}; background: ${e}`,"")}}function Kd(){return u.get(v.GLOBAL_VAR)}function Ld(){return u.get(v.PARENT)}function Md(){return u.get(v.RENDERER)}function Yg(){return{gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]}}function Ud(){return u.get(v.SCENES)}function $g(a,b=0){a.gameFrame=b,a.numTotalFrames=0,a.numDirtyFrames=0,a.numDirtyCameras=0,a.worldData.length=0}let ah;const Qc={get:()=>ah,set:a=>{ah=a}};class pg{constructor(){this.scenes=new Map(),this.sceneIndex=0,this.flush=!1,this.renderResult=Yg(),this.game=N.get(),Qc.set(this),Cb(this.game,"boot",()=>this.boot())}boot(){Ud().forEach(a=>new a())}update(a,b){for(const c of this.scenes.values())H(c,"update",a,b)}render(a){const b=this.renderResult;$g(b,a);for(const c of this.scenes.values())H(c,"render",b);return this.flush&&(b.numDirtyFrames++,this.flush=!1),b}}function qg(){mc(0),Pd(4096),nc("Phaser","4.0.0","https://phaser4.io"),ab(0),oc(.5,.5),vb(800,600,1)}function fb(a,b){const c=document.createElement("canvas");return c.width=a,c.height=b,c.getContext("2d")}let bh;const ha={get:()=>bh,set:a=>{bh=a}};class rg{constructor(){this.textures=new Map(),this.createDefaultTextures(),ha.set(this)}createDefaultTextures(){this.add("__BLANK",new O(fb(32,32).canvas));const a=fb(32,32);a.strokeStyle="#0f0",a.moveTo(0,0),a.lineTo(32,32),a.stroke(),a.strokeRect(.5,.5,31,31),this.add("__MISSING",new O(a.canvas));const b=fb(32,32);b.fillStyle="#fff",b.fillRect(0,0,32,32),this.add("__WHITE",new O(b.canvas))}get(a){const b=this.textures;return b.has(a)?b.get(a):b.get("__MISSING")}has(a){return this.textures.has(a)}add(a,b,c){let d;const e=this.textures;return e.has(a)||(b instanceof O?d=b:d=new O(b,0,0,c),d.key=a,e.set(a,d)),d}}class mg extends Id{constructor(...a){super();this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,N.set(this),qg(),Hd(()=>this.boot(a))}boot(a){a.forEach(e=>e());const b=Md();this.renderer=new b(),this.textureManager=new rg(),this.sceneManager=new pg();const c=Ld();c&&Gd(this.renderer.canvas,c);const d=Kd();d&&window&&(window[d]=this),this.isBooted=!0,Jd(),H(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(a){const b=a-this.lastTick;this.lastTick=a,this.elapsed+=b,this.isPaused||(this.willUpdate&&(this.sceneManager.update(b,a),H(this,"update",b,a)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,N.setFrame(this.frame),N.setElapsed(this.elapsed),requestAnimationFrame(c=>this.step(c))}destroy(){}}function Zg(a,b,c){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:c}function _g(a,b={}){const c=Qc.get(),d=c.scenes.size,e=c.sceneIndex,f=d===0;typeof b==="string"?a.key=b:(b||!b&&f)&&(a.key=Zg(b,"key","scene"+e.toString())),c.scenes.has(a.key)?console.warn("Scene key already in use: "+a.key):(c.scenes.set(a.key,a),c.flush=!0,c.sceneIndex++)}class ng{constructor(a){this.game=N.get(),this.events=new Map(),_g(this,a)}}const Hf="worldrender";const If="worldshutdown";const rc="addedtoworld";const Db="destroy";const he="postupdate";const sc="removedfromworld";const ie="update";function Rc(a,b){b.numRendered++,b.numRenderable++,a.node.dirtyFrame>=b.gameFrame&&b.dirtyFrame++,a.children.forEach(c=>{c.children.length>0&&Rc(c,b)})}const t={CLEAR:0,TRANSFORM:1,UPDATE:2,CHILD_CACHE:4,POST_RENDER:8,COLORS:16,BOUNDS:32,TEXTURE:64,FRAME:128,ALPHA:256,CHILD:512,DEFAULT:1+2+16+32,USER1:536870912,USER2:1073741824,USER3:2147483648,USER4:4294967296};function Kf(a){if(a.node.isDirty(t.CHILD_CACHE))return!0;const b=[a];for(;b.length>0;){const c=b.pop();if(c.node.isDirty(t.TRANSFORM))return!0;const d=c.children.length;if(d>0)for(let e=0;e<d;e++)b.push(c.children[e])}return b.length=0,!1}function Jf(a,b){a.forEach(c=>{b||Kf(c)?c.node.setDirty(t.CHILD_CACHE):c.children.length=0})}function Sc(a,b,c=[]){for(let d=0;d<b.numChildren;d++){const e=b.children[d];if(e.isRenderable()){const f=[],g={node:e,children:f};c.push(g),e.willRenderChildren&&e.numChildren>0&&(e.willCacheChildren&&a.push(g),Sc(a,e,f))}}return c}function Ff(a){const b=[],c=[],d=Sc(b,a,c),e=a.renderData;b.length>0&&Jf(b,a.camera.dirtyRender),d.forEach(f=>{f.children.length>0?Rc(f,e):(e.numRendered++,e.numRenderable++,f.node.dirtyFrame>=e.gameFrame&&e.dirtyFrame++)}),a.renderList=d,a.forceRefresh&&(e.dirtyFrame++,a.forceRefresh=!1)}function Eb(a){const{a:b,b:c,c:d,d:e,tx:f,ty:g}=a.world,{x:i,y:j,right:k,bottom:l}=a.extent,m=i*b+j*d+f,p=i*c+j*e+g,n=i*b+l*d+f,s=i*c+l*e+g,B=k*b+l*d+f,q=k*c+l*e+g,E=k*b+j*d+f,I=k*c+j*e+g;return{x0:m,y0:p,x1:n,y1:s,x2:B,y2:q,x3:E,y3:I}}class $d{constructor(a){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=a,this.area=new K()}set(a,b,c,d){this.area.set(a,b,c,d)}get(){return this.entity.isDirty(t.BOUNDS)&&!this.fixed&&this.update(),this.area}updateLocal(){const{x0:a,y0:b,x1:c,y1:d,x2:e,y2:f,x3:g,y3:i}=Eb(this.entity.transform),j=Math.min(a,c,e,g),k=Math.min(b,d,f,i),l=Math.max(a,c,e,g),m=Math.max(b,d,f,i);return this.area.set(j,k,l-j,m-k)}update(){const a=this.updateLocal();this.entity.clearDirty(t.BOUNDS);if(!this.includeChildren||!this.entity.numChildren)return a;const b=this.visibleOnly,c=this.entity.children;let d=a.x,e=a.y,f=a.right,g=a.bottom;for(let i=0;i<c.length;i++){const j=c[i];if(!j||b&&!j.visible)continue;const k=j.bounds.get();k.x<d&&(d=k.x),k.y<e&&(e=k.y),k.right>f&&(f=k.right),k.bottom>g&&(g=k.bottom)}return a.set(d,e,f-d,g-e)}destroy(){this.entity=null,this.area=null}}class ae{constructor(a){this.enabled=!1,this.enabledChildren=!0,this.entity=a}destroy(){this.entity=null,this.hitArea=null}}function uc(a,b,c,d,e,f,g=0,i=1,j=1,k=0,l=0){const m=Math.cos(g+l)*i,p=Math.sin(g+l)*i,n=-Math.sin(g-k)*j,s=Math.cos(g-k)*j,B=a*m+c*n+e,q=a*p+c*s+f,E=a*m+d*n+e,I=a*p+d*s+f,ja=b*m+d*n+e,$=b*p+d*s+f,ka=b*m+c*n+e,la=b*p+c*s+f;return{x0:B,y0:q,x1:E,y1:I,x2:ja,y2:$,x3:ka,y3:la}}function yg(a){a.forEach(b=>{b.packColor()})}function ce(a){const b=a.vertices,{x0:c,y0:d,x1:e,y1:f,x2:g,y2:i,x3:j,y3:k}=Eb(a.transform);return b[0].setPosition(c,d),b[1].setPosition(e,f),b[2].setPosition(g,i),b[3].setPosition(j,k),a}function Ga(a){return a.isDirty(t.COLORS)&&(yg(a.vertices),a.clearDirty(t.COLORS)),a.isDirty(t.TRANSFORM)&&(ce(a),a.clearDirty(t.TRANSFORM)),a}function Rd(){return u.get(v.DEFAULT_ORIGIN).x}function Sd(){return u.get(v.DEFAULT_ORIGIN).y}class r{constructor(a=0,b=0){this.set(a,b)}set(a=0,b=0){return this.x=a,this.y=b,this}toArray(a=[],b=0){const{x:c,y:d}=this;return a[b]=c,a[b+1]=d,a}fromArray(a,b=0){return this.set(a[b],a[b+1])}toString(){const{x:a,y:b}=this;return`{ x=${a}, y=${b} }`}}function V(a,b,c){return Math.max(b,Math.min(c,a))}function ic(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function fe(a,b=new r()){return b.set(a.width,a.height)}function de(a){const b=a.local,c=a.position.x,d=a.position.y,e=a.rotation,f=a.scale.x,g=a.scale.y,i=a.skew.x,j=a.skew.y;b.set(Math.cos(e+j)*f,Math.sin(e+j)*f,-Math.sin(e-i)*g,Math.cos(e-i)*g,c,d)}function vc(a,b){const{a:c,b:d,c:e,d:f,tx:g,ty:i}=a;return b.set(c,d,e,f,g,i)}function ee(a){const b=a.parent,c=a.transform,d=c.local,e=c.world;if(!b)vc(d,e);else if(c.passthru)vc(b.transform.world,e);else{const{a:f,b:g,c:i,d:j,tx:k,ty:l}=d,{a:m,b:p,c:n,d:s,tx:B,ty:q}=b.transform.world;e.set(f*m+g*n,f*p+g*s,i*m+j*n,i*p+j*s,k*m+l*n+B,k*p+l*s+q)}}class be{constructor(a,b=0,c=0){this.passthru=!1,this._rotation=0,this.entity=a,this.local=new D(),this.world=new D();const d=()=>this.update(),e=()=>this.updateExtent();this.position=new ga(d,b,c),this.scale=new ga(d,1,1),this.skew=new ga(d),this.origin=new ga(e,Rd(),Sd()),this.extent=new K()}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(t.TRANSFORM,t.BOUNDS),de(this)}updateWorld(){const a=this.entity;a.setDirty(t.TRANSFORM,t.BOUNDS),ee(a),a.numChildren&&this.updateChildren()}updateChildren(){const a=this.entity.children;for(let b=0;b<a.length;b++){const c=a[b];c.transform.updateWorld()}}globalToLocal(a,b,c=new r()){const{a:d,b:e,c:f,d:g,tx:i,ty:j}=this.world,k=1/(d*g+f*-e);return c.x=g*k*a+-f*k*b+(j*f-i*g)*k,c.y=d*k*b+-e*k*a+(-j*d+i*e)*k,c}localToGlobal(a,b,c=new r()){const{a:d,b:e,c:f,d:g,tx:i,ty:j}=this.world;return c.x=d*a+f*b+i,c.y=e*a+g*b+j,c}setExtent(a,b,c,d){this.extent.set(a,b,c,d),this.entity.setDirty(t.TRANSFORM,t.BOUNDS)}updateExtent(a,b){const c=this.extent,d=this.entity;a!==void 0&&(c.width=a),b!==void 0&&(c.height=b),c.x=-this.origin.x*c.width,c.y=-this.origin.y*c.height,d.setDirty(t.TRANSFORM,t.BOUNDS)}set rotation(a){a!==this._rotation&&(this._rotation=a,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}}function tc(a,b){const c=(b*255|0)&255;return(c<<24|a)>>>0}class ba{constructor(a=0,b=0,c=0){this.x=0,this.y=0,this.z=0,this.u=0,this.v=0,this.texture=0,this.tint=16777215,this.alpha=1,this.color=4294967295,this.x=a,this.y=b,this.z=c}setPosition(a,b,c=0){return this.x=a,this.y=b,this.z=c,this}setUV(a,b){return this.u=a,this.v=b,this}setColor(a,b=1){return this.tint=a,this.alpha=b,this.packColor(),this}setAlpha(a){return this.alpha=a,this}setTint(a){return this.tint=a,this}packColor(){this.color=tc(this.tint,this.alpha)}}function wc(a,b,c){const{F32:d,U32:e,offset:f}=Qb(c,1),g=bf(c,a);let i=f;b.forEach(j=>{d[i+0]=j.x,d[i+1]=j.y,d[i+2]=j.u,d[i+3]=j.v,d[i+4]=g,e[i+5]=j.color,i+=6})}function yb(a,b=0,c){const d=a.children;c===void 0&&(c=d.length);const e=c-b;if(e>0&&e<=c){const f=d.splice(b,e);return f.forEach(g=>{g.parent=null}),f}else return[]}function Wd(a,b=0,c){const d=yb(a,b,c);d.forEach(e=>{e.destroy()})}function Da(a){const b=[a],c=[];for(;b.length>0;){const d=b.shift();c.push(d);const e=d.numChildren;if(e>0)for(let f=e-1;f>=0;f--)b.unshift(d.children[f])}return c.shift(),c}function na(a,b){return a.children.indexOf(b)}function qc(a,b){const c=a.children;let d;if(b>=0&&b<c.length){const e=c.splice(b,1);e[0]&&(d=e[0],d.parent=null)}return d}function zb(a,b){const c=na(a,b);return c>-1&&qc(a,c),b}function _d(a,...b){return b.forEach(c=>{c.world&&(H(c.world,sc,c,c.world),H(c,sc,c,c.world)),c.world=a,H(a,rc,c,a),H(c,rc,c,a)}),b}function Ca(a,...b){b.forEach(d=>{d.parent&&zb(d.parent,d),d.parent=a});const c=a.world;return c&&_d(c,...Da(a)),b}function Zd(a,b,c=0,d){const e=yb(a,c,d);return Ca(b,...e),e.forEach(f=>{f.transform.updateWorld()}),e}class Fa{constructor(a=0,b=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.vertices=[],this.events=new Map(),this.transform=new be(this,a,b),this.bounds=new $d(this),this.input=new ae(this),this.dirty=t.DEFAULT,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(a){return(this.dirty&a)!==0}clearDirty(a){return this.isDirty(a)&&(this.dirty^=a),this}setDirty(a,b){return this.isDirty(a)||(this.dirty^=a,this.dirtyFrame=N.getFrame()),this.isDirty(b)||(this.dirty^=b),this}update(a,b){if(this.willUpdateChildren){const c=this.children;for(let d=0;d<c.length;d++){const e=c[d];e&&e.willUpdate&&e.update(a,b)}}this.postUpdate(a,b)}postUpdate(a,b){}renderGL(a){}renderCanvas(a){}postRenderGL(a){}postRenderCanvas(a){}get numChildren(){return this.children.length}getBounds(){return this.bounds.get()}destroy(a){a?Zd(this,a):Wd(this),H(this,Db,this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null,this.vertices=[]}}class Fb extends Fa{constructor(a=0,b=0){super(a,b);this._alpha=1,this.type="Container"}setSize(a,b=a){return this.transform.updateExtent(a,b),this}getSize(a=new r()){return fe(this.transform.extent,a)}setPosition(a,b){return this.transform.position.set(a,b),this}getPosition(a=new r()){const b=this.transform.position;return a.set(b.x,b.y)}setOrigin(a,b=a){return this.transform.origin.set(a,b),this}getOrigin(a=new r()){const b=this.transform.origin;return a.set(b.x,b.y)}setSkew(a,b=a){return this.transform.skew.set(a,b),this}getSkew(a=new r()){const b=this.transform.skew;return a.set(b.x,b.y)}setScale(a,b=a){return this.transform.scale.set(a,b),this}getScale(a=new r()){const b=this.transform.scale;return a.set(b.x,b.y)}setRotation(a){return this.transform.rotation=a,this}getRotation(){return this.transform.rotation}set width(a){this.transform.updateExtent(a)}get width(){return this.transform.extent.width}set height(a){this.transform.updateExtent(void 0,a)}get height(){return this.transform.extent.height}set x(a){this.transform.position.x=a}get x(){return this.transform.position.x}set y(a){this.transform.position.y=a}get y(){return this.transform.position.y}set originX(a){this.transform.origin.x=a}get originX(){return this.transform.origin.x}set originY(a){this.transform.origin.y=a}get originY(){return this.transform.origin.y}set skewX(a){this.transform.skew.x=a}get skewX(){return this.transform.skew.x}set skewY(a){this.transform.skew.y=a}get skewY(){return this.transform.skew.y}set scaleX(a){this.transform.scale.x=a}get scaleX(){return this.transform.scale.x}set scaleY(a){this.transform.scale.y=a}get scaleY(){return this.transform.scale.y}set rotation(a){this.transform.rotation=a}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(a){a!==this._alpha&&(this._alpha=a,this.vertices.forEach(b=>{b.setAlpha(a)}),this.setDirty(t.COLORS))}}function xc(a,b,c,d){if(!a)return;const e=d.ctx,{a:f,b:g,c:i,d:j,tx:k,ty:l}=c.world,{x:m,y:p}=c.extent;e.save(),e.setTransform(f,g,i,j,k,l),e.globalAlpha=b,e.drawImage(a.texture.image,a.x,a.y,a.width,a.height,m,p,a.width,a.height),e.restore()}function Hb(a,b,...c){const d=a.getFrame(b),e=d.pivot;return c.forEach(f=>{if(!f||d===f.frame)return;f.frame=d,f.hasTexture=!0,e&&f.setOrigin(e.x,e.y),d.copyToExtent(f),d.copyToVertices(f.vertices)}),c}function je(a,b,...c){if(!a)c.forEach(d=>{d.texture=null,d.frame=null,d.hasTexture=!1});else{let d;a instanceof O?d=a:d=ha.get().get(a),d?(c.forEach(e=>{e.texture=d}),Hb(d,b,...c)):console.warn(`Invalid Texture key: ${a}`)}return c}class ma extends Fb{constructor(a,b,c,d){super(a,b);this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertices=[new ba(),new ba(),new ba(),new ba()],this.setTexture(c,d)}setTexture(a,b){return je(a,b,this),this}setFrame(a){return Hb(this.texture,a,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}renderGL(a){Ga(this),wc(this.texture,this.vertices,a)}renderCanvas(a){Ga(this),xc(this.frame,this.alpha,this.transform,a)}get tint(){return this._tint}set tint(a){a!==this._tint&&(this._tint=a,this.vertices.forEach(b=>{b.setTint(a)}),this.setDirty(t.COLORS))}destroy(a){super.destroy(a),this.texture=null,this.frame=null,this.hasTexture=!1}}class Gi extends ma{constructor(a,b,c,d){super(a,b,c,d);this.type="AnimatedSprite",this.anims=new Map(),this.animData={currentAnim:"",currentFrames:[],frameIndex:0,animSpeed:0,nextFrameTime:0,repeatCount:0,isPlaying:!1,yoyo:!1,pendingStart:!1,playingForward:!0,delay:0,repeatDelay:0,onStart:null,onRepeat:null,onComplete:null}}stop(){const a=this.animData;a.isPlaying=!1,a.currentAnim="",a.onComplete&&a.onComplete(this,a.currentAnim)}nextFrame(){const a=this.animData;a.frameIndex++;if(a.frameIndex===a.currentFrames.length)if(a.yoyo)a.frameIndex--,a.playingForward=!1;else if(a.repeatCount===-1||a.repeatCount>0)a.frameIndex=0,a.repeatCount!==-1&&a.repeatCount--,a.onRepeat&&a.onRepeat(this,a.currentAnim),a.nextFrameTime+=a.repeatDelay;else return a.frameIndex--,this.stop();this.setFrame(a.currentFrames[a.frameIndex]),a.nextFrameTime+=a.animSpeed}prevFrame(){const a=this.animData;a.frameIndex--;if(a.frameIndex===-1)if(a.repeatCount===-1||a.repeatCount>0)a.frameIndex=0,a.playingForward=!0,a.repeatCount!==-1&&a.repeatCount--,a.onRepeat&&a.onRepeat(this,a.currentAnim),a.nextFrameTime+=a.repeatDelay;else return a.frameIndex=0,this.stop();this.setFrame(a.currentFrames[a.frameIndex]),a.nextFrameTime+=a.animSpeed}update(a,b){super.update(a,b);const c=this.animData;if(!c.isPlaying)return;c.nextFrameTime-=a*1e3,c.nextFrameTime=Math.max(c.nextFrameTime,0),c.nextFrameTime===0&&(c.pendingStart?(c.onStart&&c.onStart(this,c.currentAnim),c.pendingStart=!1,c.nextFrameTime=c.animSpeed):c.playingForward?this.nextFrame():this.prevFrame())}get isPlaying(){return this.animData.isPlaying}get isPlayingForward(){return this.animData.isPlaying&&this.animData.playingForward}get currentAnimation(){return this.animData.currentAnim}destroy(a){super.destroy(a),this.anims.clear(),this.animData=null}}function Rg(a,b,c,d,e,f,g,i,j,k=0,l=4294967295){const{F32:m,U32:p,offset:n}=Qb(a,1);m[n+0]=b,m[n+1]=c,m[n+2]=f,m[n+3]=j,m[n+4]=k,p[n+5]=l,m[n+6]=b,m[n+7]=c+e,m[n+8]=f,m[n+9]=g,m[n+10]=k,p[n+11]=l,m[n+12]=b+d,m[n+13]=c+e,m[n+14]=i,m[n+15]=g,m[n+16]=k,p[n+17]=l,m[n+18]=b+d,m[n+19]=c,m[n+20]=i,m[n+21]=j,m[n+22]=k,p[n+23]=l}function bb(a,b,c){c||(c=a.quadShader);const{u0:d,v0:e,u1:f,v1:g}=b.firstFrame;cf(b,0),Nc(a,a.quadBuffer),ef(a,c,0),Rg(a,0,0,b.width,b.height,d,e,f,g,0),M(a),Mc(a),df(a),ff(a)}class Gb extends Fa{constructor(){super();this.type="Layer",this.transform.passthru=!0,this.willRender=!1}}class ge extends Gb{constructor(){super();this.type="RenderLayer",this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!0,this.setDirty(t.CHILD_CACHE);const a=ua(),b=sa(),c=ta(),d=new O(null,a*c,b*c),e=new db(d);d.binding=e,e.framebuffer=yc(e.texture),this.texture=d,this.framebuffer=e.framebuffer}renderGL(a){this.numChildren>0&&(M(a),!this.willCacheChildren||this.isDirty(t.CHILD_CACHE)?(cb(a,this.framebuffer,!0),this.clearDirty(t.CHILD_CACHE)):(cb(a,this.framebuffer,!1),this.postRenderGL(a)))}postRenderGL(a){M(a),Ha(a),bb(a,this.texture),this.clearDirty(t.TRANSFORM)}}class Li extends ge{constructor(...a){super();this.shaders=[],this.type="EffectLayer",Array.isArray(a)&&(this.shaders=a)}postRenderGL(a){const b=this.shaders,c=this.texture;M(a),Ha(a);if(b.length===0)bb(a,c);else{let d=c;for(let e=0;e<b.length;e++){const f=b[e];bb(a,d,f),d=f.texture}bb(a,d)}this.clearDirty(t.TRANSFORM)}}class Mi extends Fb{constructor(a,b,c=64,d=64,e=16777215){super(a,b);this._color=16777215,this.type="Rectangle",this.vertices=[new ba(),new ba(),new ba(),new ba()],this.color=e,this.setWhiteTexture(),this.setSize(c,d)}setWhiteTexture(){this.texture=ha.get().get("__WHITE"),this.frame=this.texture.getFrame(),this.frame.copyToExtent(this),this.frame.copyToVertices(this.vertices)}setColor(a){return this.color=a,this}isRenderable(){return this.visible&&this.willRender&&this.alpha>0}renderGL(a){Ga(this),wc(this.texture,this.vertices,a)}renderCanvas(a){Ga(this),xc(this.frame,this.alpha,this.transform,a)}get color(){return this._color}set color(a){a!==this._color&&(this._color=a,this.vertices.forEach(b=>{b.setTint(a)}),this.setDirty(t.COLORS))}destroy(a){super.destroy(a),this.texture=null,this.frame=null}}function zg(a,b){}class Ni extends Gb{constructor(a,b){super();this.glTextureIndex=0,this.hasTexture=!1,this.type="SpriteBatch",this.willRender=!0,this.setTexture(b),this.setMaxSize(a)}resetBuffers(){let a=[];for(let b=0;b<this.maxSize*4;b+=4)a.push(b+0,b+1,b+2,b+2,b+3,b+0);this.data=new ArrayBuffer(this.maxSize*96),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data),h&&(oa(this.vertexBuffer),oa(this.indexBuffer),this.vertexBuffer=h.createBuffer(),this.indexBuffer=h.createBuffer(),h.bindBuffer(h.ARRAY_BUFFER,this.vertexBuffer),h.bufferData(h.ARRAY_BUFFER,this.data,h.STATIC_DRAW),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.indexBuffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,this.index,h.STATIC_DRAW),h.bindBuffer(h.ARRAY_BUFFER,null)),a=[],this.count=0}setMaxSize(a){return this.maxSize=V(a,0,65535),this.resetBuffers(),this}setTexture(a){let b;return a instanceof O?b=a:b=ha.get().get(a),b?(this.texture=b,this.hasTexture=!0,this.glTextureIndex=-1):console.warn(`Invalid Texture key: ${a}`),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.count>0}clear(){return this.count=0,this}addToBatch(a,b,c,d,e,f,g,i,j,k){if(this.count>=this.maxSize)return console.warn("SpriteBatch full"),this;const{u0:l,u1:m,v0:p,v1:n}=a,s=this.vertexViewF32,B=this.vertexViewU32,q=this.count*24,E=this.texture.binding?this.texture.binding.index:0;return s[q+0]=c,s[q+1]=d,s[q+2]=l,s[q+3]=p,s[q+4]=E,B[q+5]=b,s[q+6]=e,s[q+7]=f,s[q+8]=l,s[q+9]=n,s[q+10]=E,B[q+11]=b,s[q+12]=g,s[q+13]=i,s[q+14]=m,s[q+15]=n,s[q+16]=E,B[q+17]=b,s[q+18]=j,s[q+19]=k,s[q+20]=m,s[q+21]=p,s[q+22]=E,B[q+23]=b,this.setDirty(t.TRANSFORM),this.count++,this}add(a){const{frame:b=null,x:c=0,y:d=0,rotation:e=0,scaleX:f=1,scaleY:g=1,skewX:i=0,skewY:j=0,originX:k=0,originY:l=0,alpha:m=1,tint:p=16777215}=a,n=this.texture.getFrame(b),{left:s,right:B,top:q,bottom:E}=n.getExtent(k,l),{x0:I,y0:ja,x1:$,y1:ka,x2:la,y2:ig,x3:jg,y3:kg}=uc(s,B,q,E,c,d,e,f,g,i,j),G=tc(p,m);return this.addToBatch(n,G,I,ja,$,ka,la,ig,jg,kg)}addXY(a,b,c){const d=this.texture.getFrame(c),{left:e,right:f,top:g,bottom:i}=d.getExtent(0,0),{x0:j,y0:k,x1:l,y1:m,x2:p,y2:n,x3:s,y3:B}=uc(e,f,g,i,a,b);return this.addToBatch(d,4294967295,j,k,l,m,p,n,s,B)}updateTextureIndex(){const a=this.texture.binding.index;if(a===this.glTextureIndex)return;const b=this.vertexViewF32;this.glTextureIndex=a;for(let c=0;c<this.count;c++)b[c*24+4]=a,b[c*24+10]=a,b[c*24+16]=a,b[c*24+22]=a}renderGL(a){zg(this,a)}destroy(){super.destroy(),oa(this.vertexBuffer),oa(this.indexBuffer),this.data=null,this.vertexViewF32=null,this.vertexViewU32=null,this.index=null,this.texture=null,this.hasTexture=!1}}function zc(a=32,b=32){const c=fb(a,b);return new O(c.canvas)}class hc extends ma{constructor(a,b,c="",d,e){super(a,b,zc());this.splitRegExp=/(?:\r\n|\r|\n)/,this.padding={left:0,right:0,top:0,bottom:0},this.verticalAlign="ascent",this.lineSpacing=0,this.font="16px monospace",this.fillStyle="#fff",this.strokeStyle="",this.backgroundStyle="",this.cornerRadius=0,this.textAlign="left",this.textBaseline="alphabetic",this.lineWidth=0,this.lineDash=[],this.antialias=!1,this.type="Text";const f=N.get();this.resolution=f.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),d&&(this.font=d),e&&(this.fillStyle=e),this.setText(c)}syncContext(a,b){this.preRenderCallback&&this.preRenderCallback(a,b),b.font=this.font,b.textBaseline=this.textBaseline,b.textAlign=this.textAlign,b.fillStyle=this.fillStyle,b.strokeStyle=this.strokeStyle,b.lineWidth=this.lineWidth,b.lineCap="round",b.lineJoin="round",b.setLineDash(this.lineDash),b.imageSmoothingEnabled=this.antialias}updateText(){const a=this.canvas,b=this.context,c=this.resolution,d=this._text.split(this.splitRegExp),e=this.padding,f=this.fillStyle,g=this.strokeStyle,i=this.lineWidth,j=this.lineSpacing,k=i>0?i/2:0;b.clearRect(0,0,a.width,a.height),this.syncContext(a,b),b.textAlign="start";let l=0,m=0,p=0;const n=[],s=this.verticalAlign==="ascent",B=b.measureText("|MÉq"),q=Math.ceil(Math.abs(B.actualBoundingBoxAscent)+Math.abs(B.actualBoundingBoxDescent))+i;for(let G=0;G<d.length;G++){const aa=b.measureText(d[G]),dc=aa.actualBoundingBoxLeft,Za=aa.actualBoundingBoxRight;let Ba=aa.actualBoundingBoxAscent,sb=aa.actualBoundingBoxDescent;(!Ba&&!sb||d[G]==="")&&(Ba=q,sb=0);const vi=Math.ceil(Math.abs(dc)+Math.abs(Za))+i,lg=Math.ceil(Math.abs(Ba)+Math.abs(sb))+i;s?(p+=Ba+k,G>0&&(p+=j+k),m=p+sb+k):(p=m+(lg-sb-k),m+=lg,G<d.length-1&&(m+=j)),l=Math.max(l,vi),n.push({lineWidth:vi,lineHeight:lg,ascent:Ba,descent:sb,left:dc,right:Za,y:p})}l+=e.left+e.right,m+=e.top+e.bottom;const E=this.fixedWidth?this.fixedWidth:l,I=this.fixedHeight?this.fixedHeight:m,ja=Math.ceil(E*c),$=Math.ceil(I*c);(a.width!==ja||a.height!==$)&&(a.width=ja,a.height=$,this.texture.setSize(E,I),this.setSize(E,I)),b.save(),b.scale(c,c),this.syncContext(a,b);const ka=this.backgroundStyle;if(ka){b.save(),b.fillStyle=ka,b.strokeStyle=ka;const G=this.cornerRadius,aa=G>0?G/2:0;G&&(b.lineWidth=G,b.strokeRect(aa,aa,E-G,I-G)),b.fillRect(aa,aa,E-G,I-G),b.restore()}const la=this.textAlign,ig=la==="center",jg=la==="right"||la==="end",kg=(I-m)/2+e.top;for(let G=0;G<d.length;G++){const aa=d[G],dc=n[G];let Za=e.left+dc.left+k;const Ba=kg+dc.y;ig?Za=E/2:jg&&(Za=E-k),g&&b.strokeText(aa,Za,Ba),f&&b.fillText(aa,Za,Ba)}return b.restore(),this.texture.binding&&this.texture.binding.update(),this.setDirty(t.TEXTURE),this}get text(){return this._text}set text(a){this.setText(a)}setText(a=""){return Array.isArray(a)&&(a=a.join(`
`)),a!==this._text&&(this._text=a.toString(),this.updateText()),this}destroy(a){this.texture.destroy(),this.fillStyle=null,this.strokeStyle=null,this.backgroundStyle=null,this.canvas=null,this.context=null,super.destroy(a)}}function He(a,b){return a.a===b.a&&a.b===b.b&&a.c===b.c&&a.d===b.d&&a.tx===b.tx&&a.ty===b.ty}function Gf(a,b){a.numDirtyFrames+=b.dirtyFrame,a.numTotalFrames+=b.numRendered,b.camera.dirtyRender&&a.numDirtyCameras++,a.worldData.push(b)}function _a(a,b){return a.children.push(b),Ca(a,b),b.transform.updateWorld(),b}function Yd(a,...b){return b.forEach(c=>{zb(a,c)}),b}function Ub(a,b){a.gameFrame=b,a.dirtyFrame=0,a.numRendered=0,a.numRenderable=0}class Vb extends Fa{constructor(a){super();this.forceRefresh=!1,this.is3D=!1,this.type="BaseWorld",this.scene=a,this.world=this,this.events=new Map(),this.renderList=[],this._updateListener=Ea(a,"update",(b,c)=>this.update(b,c)),this._renderListener=Ea(a,"render",b=>this.render(b)),this._shutdownListener=Ea(a,"shutdown",()=>this.shutdown()),Cb(a,"destroy",()=>this.destroy())}update(a,b){if(!this.willUpdate)return;H(this,ie,a,b,this),super.update(a,b)}postUpdate(a,b){H(this,he,a,b,this)}render(a){const b=this.renderData;Ub(b,a.gameFrame);if(!this.willRender||!this.visible)return;Ff(this),H(this,Hf,b,this),Gf(a,b),this.camera.dirtyRender=!1}renderGL(a){const b=a.current2DCamera,c=this.camera;(!b||!He(c.worldTransform,b.worldTransform))&&M(a),lf(a,c),this.renderList.forEach(d=>{d.children.length>0?this.renderNode(d,a):d.node.renderGL(a)})}renderNode(a,b){a.node.renderGL(b),a.children.forEach(c=>{c.children.length>0?this.renderNode(c,b):c.node.renderGL(b)}),a.node.postRenderGL(b)}postRenderGL(a){}shutdown(){const a=this.scene;Bb(a,"update",this._updateListener),Bb(a,"render",this._renderListener),Bb(a,"shutdown",this._shutdownListener),Yd(this),H(this,If,this),Ub(this.renderData,0),this.camera&&this.camera.reset()}destroy(a){super.destroy(a),H(this,Db,this),Ub(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}}function Wb(a,b){return{world:a,camera:b,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0}}class Dd extends Vb{constructor(a){super(a);this.type="StaticWorld",this.camera=new ub(),this.renderData=Wb(this,this.camera)}}class mk extends Vb{constructor(a){super(a);this.enableCameraCull=!0,this.type="World",this.camera=new Od(),this.renderData=Wb(this,this.camera)}}function Fd(a,...b){return b.forEach(c=>{c.alpha=a}),b}function Ed(a,...b){return b.forEach(c=>{c.tint=a}),b}function ve(a,b=1.70158){return a*a*((b+1)*a-b)}function Fe(a,b=1.70158){const c=b*1.525;return(a*=2)<1?.5*(a*a*((c+1)*a-c)):.5*((a-=2)*a*((c+1)*a+c)+2)}function Ic(a,b=1.70158){return--a*a*((b+1)*a+b)+1}function we(a){return a=1-a,a<1/2.75?1-7.5625*a*a:a<2/2.75?1-(7.5625*(a-=1.5/2.75)*a+.75):a<2.5/2.75?1-(7.5625*(a-=2.25/2.75)*a+.9375):1-(7.5625*(a-=2.625/2.75)*a+.984375)}function Ge(a){let b=!1;return a<.5?(a=1-a*2,b=!0):a=a*2-1,a<1/2.75?a=7.5625*a*a:a<2/2.75?a=7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?a=7.5625*(a-=2.25/2.75)*a+.9375:a=7.5625*(a-=2.625/2.75)*a+.984375,b?(1-a)*.5:a*.5+.5}function Jc(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375}function te(a){return 1-Math.sqrt(1-a*a)}function De(a){return(a*=2)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}function Gc(a){return Math.sqrt(1- --a*a)}function oe(a){return a*a*a}function ye(a){return(a*=2)<1?.5*a*a*a:.5*((a-=2)*a*a+2)}function Lb(a){return--a*a*a+1}function ue(a,b=.1,c=.1){if(a===0)return 0;{if(a===1)return 1;{let d=c/4;return b<1?b=1:d=c*Math.asin(1/b)/(2*Math.PI),-(b*Math.pow(2,10*(a-=1))*Math.sin((a-d)*(2*Math.PI)/c))}}}function Ee(a,b=.1,c=.1){if(a===0)return 0;{if(a===1)return 1;{let d=c/4;return b<1?b=1:d=c*Math.asin(1/b)/(2*Math.PI),(a*=2)<1?-.5*(b*Math.pow(2,10*(a-=1))*Math.sin((a-d)*(2*Math.PI)/c)):b*Math.pow(2,-10*(a-=1))*Math.sin((a-d)*(2*Math.PI)/c)*.5+1}}}function Hc(a,b=.1,c=.1){if(a===0)return 0;{if(a===1)return 1;{let d=c/4;return b<1?b=1:d=c*Math.asin(1/b)/(2*Math.PI),b*Math.pow(2,-10*a)*Math.sin((a-d)*(2*Math.PI)/c)+1}}}function se(a){return Math.pow(2,10*(a-1))-.001}function Ce(a){return a==0?0:a==1?1:(a*=2)<1?.5*Math.pow(2,10*(a-1)):.5*(2-Math.pow(2,-10*(a-1)))}function Fc(a){return 1-Math.pow(2,-10*a)}function ne(a){return a*a}function xe(a){return(a*=2)<1?.5*a*a:-.5*(--a*(a-2)-1)}function Kb(a){return a*(2-a)}function pe(a){return a*a*a*a}function ze(a){return(a*=2)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}function Mb(a){return-(--a*a*a*a-1)}function qe(a){return a*a*a*a*a}function Ae(a){return(a*=2)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}function Nb(a){return(a=a-1)*a*a*a*a+1}function re(a){return a===0?0:a===1?1:1-Math.cos(a*Math.PI/2)}function Be(a){return a===0?0:a===1?1:.5*(1-Math.cos(Math.PI*a))}function Ec(a){return a===0?0:a===1?1:Math.sin(a*Math.PI/2)}function me(a){return a}function Bg(a,b=1){return a<=0?0:a>=1?1:((b*a|0)+1)*(1/b)}const LB=new Map([["power0",me],["power1",Kb],["power2",Lb],["power3",Mb],["power4",Nb],["linear",me],["quad",Kb],["cubic",Lb],["quart",Mb],["quint",Nb],["sine",Ec],["expo",Fc],["circ",Gc],["elastic",Hc],["back",Ic],["bounce",Jc],["stepped",Bg],["quad.in",ne],["cubic.in",oe],["quart.in",pe],["quint.in",qe],["sine.in",re],["expo.in",se],["circ.in",te],["elastic.in",ue],["back.in",ve],["bounce.in",we],["quad.out",Kb],["cubic.out",Lb],["quart.out",Mb],["quint.out",Nb],["sine.out",Ec],["expo.out",Fc],["circ.out",Gc],["elastic.out",Hc],["back.out",Ic],["bounce.out",Jc],["quad.inout",xe],["cubic.inout",ye],["quart.inout",ze],["quint.inout",Ae],["sine.inout",Be],["expo.inout",Ce],["circ.inout",De],["elastic.inout",Ee],["back.inout",Fe],["bounce.inout",Ge]]);function Ne(){return new o(0,0,-1)}function Oe(){return new o(0,-1,0)}function Pe(){return new o(0,0,1)}function Qe(){return new o(-1,0,0)}function Re(){return new o(1,0,0)}function Se(){return new o(0,1,0)}function Te(){return new o(0,0,0)}const Tj=Se(),Uj=Oe(),Vj=Qe(),Wj=Re(),Xj=Pe(),Yj=Ne(),Zj=Te();class Me{constructor(a,b=0,c=0,d=0){this._x=b,this._y=c,this._z=d,this.onChange=a}destroy(){this.onChange=ca}set(a=0,b=0,c=0){return this._x=a,this._y=b,this._z=c,this.onChange&&this.onChange(this),this}get x(){return this._x}set x(a){const b=this._x;this._x=a,b!==a&&this.onChange(this)}get y(){return this._y}set y(a){const b=this._y;this._y=a,b!==a&&this.onChange(this)}get z(){return this._z}set z(a){const b=this._z;this._z=a,b!==a&&this.onChange(this)}toArray(a=[],b=0){const{x:c,y:d,z:e}=this;return a[b]=c,a[b+1]=d,a[b+2]=e,a}fromArray(a,b=0){return this.set(a[b],a[b+1],a[b+2])}toString(){const{x:a,y:b,z:c}=this;return`{ x=${a}, y=${b}, z=${c} }`}}class Pj extends Me{constructor(a,b=0,c=0,d=0){super(a,b,c,d)}set r(a){this.x=a}get r(){return this.x}set g(a){this.y=a}get g(){return this.y}set b(a){this.z=a}get b(){return this.z}toString(){const{x:a,y:b,z:c}=this;return`[ r=${a}, g=${b}, b=${c} ]`}}const bT=new w(),cT=new w();const gU=new w(),hU=new o();class Ue{constructor(a,b=0,c=0,d=0,e=0){this._x=b,this._y=c,this._z=d,this._w=e,this.onChange=a}destroy(){this.onChange=ca}set(a=0,b=0,c=0,d=0){return this._x=a,this._y=b,this._z=c,this._w=d,this.onChange&&this.onChange(this),this}get x(){return this._x}set x(a){const b=this._x;this._x=a,b!==a&&this.onChange(this)}get y(){return this._y}set y(a){const b=this._y;this._y=a,b!==a&&this.onChange(this)}get z(){return this._z}set z(a){const b=this._z;this._z=a,b!==a&&this.onChange(this)}get w(){return this._w}set w(a){const b=this._w;this._w=a,b!==a&&this.onChange(this)}toArray(a=[],b=0){const{x:c,y:d,z:e,w:f}=this;return a[b]=c,a[b+1]=d,a[b+2]=e,a[b+3]=f,a}fromArray(a,b=0){return this.set(a[b],a[b+1],a[b+2],a[b+3])}toString(){const{x:a,y:b,z:c,w:d}=this;return`{ x=${a}, y=${b}, z=${c}, w=${d} }`}}class $j extends Ue{constructor(a,b=0,c=0,d=0,e=1){super(a,b,c,d,e)}set r(a){this.x=a}get r(){return this.x}set g(a){this.y=a}get g(){return this.y}set b(a){this.z=a}get b(){return this.z}set a(a){this.w=a}get a(){return this.w}toString(){const{x:a,y:b,z:c,w:d}=this;return`[ r=${a}, g=${b}, b=${c}, a=${d} ]`}}function W(a,b){return a===void 0||b===void 0?void 0:`${a}|${b}`}function gi(a,b){let c=a.split("|");return b===void 0&&(b=il),b.x=parseInt(c[0]),b.y=parseInt(c[1]),b}let il={x:0,y:0};class bc{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(a){return this.items.push(a),this}pushMultiple(a){return this.items.push.apply(this.items,a),a.length=0,this}clear(){return this.items.length=0,this}}let si=new bc();function mh(){let a=si.pop();return a===null&&(a=new Map()),a}function id(a){si.push(a)}function kh(a,b,c,d,e,f,g,i){if(c===f&&d===g&&e===i)return;let j=W(c,d),k=W(f,g);if(j){let l=b.get(j);l.delete(e);if(j===k){l.set(i,a);return}else l.size===0&&(id(l),b.delete(j))}if(k){let l=b.get(k);l?l.set(i,a):(l=mh(),l.set(i,a),b.set(k,l))}}function bg(a,b,c,d){let e=W(b,c),f=a.get(e);f&&(d!==void 0?(f.delete(d),f.size===0&&(id(f),a.delete(e))):(f.clear(),id(f),a.delete(e)))}let ti=new bc();function lh(){let a=ti.pop();return a===null&&(a=new Set()),a}function ag(a){ti.push(a)}function hd(a,b,c,d){if(c===d)return;if(c!==void 0){let e=b.get(c);e&&(e.delete(a),e.size===0&&(ag(e),b.delete(c)))}if(d!==void 0){let e=b.get(d);e?e.add(a):(e=lh(),e.add(a),b.set(d,e))}}function Sa(a,b,c){let d=a.get(b);d&&(d.delete(c),d.size===0&&(ag(d),a.delete(b)))}function fh(a,b,c,d,e){let f=a.chessToXYZ.get(b),g=f?f.x:void 0,i=f?f.y:void 0,j=f?f.y:void 0;f?(f.x=c,f.y=d,f.z=e):a.chessToXYZ.set(b,{x:c,y:d,z:e}),kh(b,a.XYToZMap,g,i,j,c,d,e),hd(b,a.XToChessSet,g,c),hd(b,a.YToChessSet,i,d),hd(b,a.ZToChessSet,j,e)}function Ra(a,b,c,d){let e=a.XYToZMap.get(W(b,c));return e===void 0?null:d!==void 0?e.has(d)?e.get(d):null:e}function gh(a,b,c,d){if(d!==void 0){let e=Ra(a,b,c,d);if(e===void 0)return;a.chessToXYZ.delete(e),bg(a.XYToZMap,b,c,d),Sa(a.XToChessSet,b,e),Sa(a.YToChessSet,c,e),Sa(a.ZToChessSet,d,e)}else{let e=Ra(a,b,c);if(e){for(const[f,g]of e)a.chessToXYZ.delete(g),Sa(a.XToChessSet,b,g),Sa(a.YToChessSet,c,g),Sa(a.ZToChessSet,f,g);bg(a.XYToZMap,b,c)}}}function hh(a,b){return a.chessToXYZ.has(b)}function ih(a,b,c,d){return Ra(a,b,c,d)!==null}function jh(a,b){return a.chessToXYZ.get(b)||null}function _f(a){let b=-Infinity;for(const[c,d]of a)b<c&&(b=c);return b}function $f(a){let b=Infinity;for(const[c,d]of a)b>c&&(b=c);return b}class Lf{constructor(){this.chessToXYZ=new Map();this.XYToZMap=new Map();this.XToChessSet=new Map();this.YToChessSet=new Map();this.ZToChessSet=new Map();this._xMax=void 0;this._xMin=void 0;this._yMax=void 0;this._yMin=void 0}destroy(){this.clear()}clear(){return this.chessToXYZ.clear(),this.XYToZMap.clear(),this.XToChessSet.clear(),this.YToChessSet.clear(),this.ZToChessSet.clear(),this.clearBounds(),this}clearBounds(){return this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0,this}addChess(a,b,c,d){return fh(this,a,b,c,d),this.clearBounds(),this}getChess(a,b,c){return Ra(this,a,b,c)}removeChess(a,b,c){return gh(this,a,b,c),this.clearBounds(),this}hasChess(a){return hh(this,a)}contains(a,b,c){return ih(this,a,b,c)}getXYZ(a){return jh(this,a)}get xMax(){return this._xMax===void 0&&(this._xMax=_f(this.XToChessSet)),this._xMax}get xMin(){return this._xMin===void 0&&(this._xMin=$f(this.XToChessSet)),this._xMin}get yMax(){return this._yMax===void 0&&(this._yMax=_f(this.YToChessSet)),this._yMax}get yMin(){return this._yMin===void 0&&(this._yMin=$f(this.YToChessSet)),this._yMin}}function da(a,b=[]){let c=a.boardData.chessToXYZ;for(const[d,e]of c)b.push(d);return b}function hi(a){if(typeof a!=="object"||a.nodeType||a===a.window)return!1;try{if(a.constructor&&!{}.hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0}function _b(a){return hi(a)?!0:typeof a==="object"?a.isTileXYZ:!1}function x(a,b){let c=a.boardData.getXYZ(b);return c?c:_b(b)?b:null}function F(a,b,c,d){return a.boardData.getChess(b,c,d)}class nh{constructor(a){this.board=null;this.blocker=!1;this.parent=a,this.boot()}boot(){typeof this.parent==="object"&&this.parent.on&&this.parent.on("destroy",this.destroy,this)}destroy(){if(this.board){let a=this.tileXYZ;this.board.boardData.removeChess(a.x,a.y,a.z)}this.parent=void 0,this.board=null}setBoard(a){return this.board=a,this}get tileXYZ(){return this.board==null?null:this.board.boardData.getXYZ(this.parent)}setBlocker(a=!0){return this.blocker=a,this}setBlockEdge(a,b=!0){typeof this.blocker==="boolean"&&(this.blocker={});let c=this.blocker;if(typeof a==="object"){let d=a;for(let e in d)c[e]=d[e]}else c[a]=b;return this}getBlockEdge(a){return typeof this.blocker==="boolean"?!1:this.blocker.hasOwnProperty(a)?this.blocker[a]:!1}}function Z(a){return a.hasOwnProperty("rexChess")||(a.rexChess=new nh(a)),a.rexChess}function S(a,b,c,d,e,f=!1,g=!1){if(b){let i=x(a,b);if(i)c=i.x,d=i.y,e=i.z;else return}else{b=F(a,c,d,e);if(!b)return}g||a.boardData.removeChess(c,d,e),a._isBoard&&Z(b).setBoard(null),f&&b.destroy&&b.destroy()}function Qa(a,b){if(a.infinityMode)return;if(a.height===void 0||a.height<=b){a.height=b;return}let c=da(a);c.forEach(d=>{let e=x(a,d);e.y>b&&S(a,d)}),a.height=b}function Pa(a,b){if(a.infinityMode)return;if(a.width===void 0||a.width<=b){a.width=b;return}let c=da(a);c.forEach(d=>{let e=x(a,d);e.x>b&&S(a,d)}),a.width=b}class Tc{constructor({grid:a=void 0,wrap:b=!1,inifinity:c=!1,width:d=0,height:e=0}={}){this.boardData=new Lf(),this._isBoard=!0,this.setGrid(a),this.setWrapMode(b),this.setInfinityMode(c),this.setBoardSize(d,e)}destroy(){}setGrid(a){return this.grid=a,this}setWrapMode(a=!0){return this.wrapMode=a,this}setInfinityMode(a=!0){return this.infinityMode=a,this}setBoardSize(a=0,b=0){return Pa(this,a),Qa(this,b),this}}function Y(a,b,c,d){let e;return a.infinityMode?e=!0:e=b>=0&&b<a.width&&c>=0&&c<a.height,e&&d!==void 0&&(e=a.boardData.contains(b,c,d)),e}function P(a,b,c,d){return a.grid.getWorldXY(b,c,d)}function mb(a,b,c,d){if(b===void 0){let e=da(a);for(let f=0,g=e.length;f<g;f++){let i=e[f],j=x(a,i);P(a,j.x,j.y,i)}}else{if(c===void 0){let e=x(a,b);c=e.x,d=e.y}P(a,c,d,b)}}function va(a,b,c,d,e,f=!0){if(!Y(a,c,d))return;let g=x(a,b);e===void 0&&(g?e=g.z:e=0);if(g&&g.x===c&&g.y===d&&g.z===e)return;let i=F(a,c,d,e);i&&(S(a,null,c,d,e),console.warn(`Chess at (${c},${d},${e}) has been removed because of overlapped`)),a.boardData.addChess(b,c,d,e),a._isBoard&&Z(b).setBoard(a),f&&mb(a,b,c,d)}function Va(a,b,c,d){return Math.atan2(d-b,c-a)}function wa(a,b,c){let d=x(a,b),e=x(a,c),f=P(a,d.x,d.y,!0),g=f.x,i=f.y;f=P(a,e.x,e.y,!0);let j=f.x,k=f.y;return Va(g,i,j,k)}function qa(a,b,c){let d=c-b;return b+((a-b)%d+d)%d}function lb(a,b,c,d={x:0,y:0}){return d===!0&&(d=tk),a.wrapMode?b=qa(b,0,a.width):!a.infinityMode&&(b<0||b>=a.width)&&(b=null),a.wrapMode?c=qa(c,0,a.height):!a.infinityMode&&(c<0||c>=a.height)&&(c=null),d.x=b,d.y=c,d}let tk={x:0,y:0};function R(a,b,c,d,e){let f=x(a,b);if(f===null)return null;typeof c==="string"&&(c.includes(",")?c=c.split(".").map(k=>parseInt(k,10)):c=parseInt(c));let g=typeof c==="number",i=typeof d==="number";if(g&&i){let k=a.grid.getTileXYAtDirection(f,c,d,e);return lb(a,k.x,k.y,k),(k.x===null||k.y===null)&&(k=null),k}Array.isArray(e)||(e=[]),c===null&&(c=a.grid.allDirections);let j;if(g)if(Array.isArray(d))for(let k=0,l=d.length;k<l;k++)j=R(a,f,c,d[k]),j!==null&&e.push(j);else{let k,l,m;({end:k=1,start:l=k>0?1:-1,step:m=k>=l?1:-1}=d);if(l===k)j=R(a,f,c,k),j!==null&&e.push(j);else if(l<k)for(let p=l;p<=k;p+=m)j=R(a,f,c,p),j!==null&&e.push(j);else for(let p=l;p>=k;p+=m)j=R(a,f,c,p),j!==null&&e.push(j)}else for(let k=0,l=c.length;k<l;k++)i?(j=R(a,f,c[k],d),j!==null&&e.push(j)):R(a,f,c[k],d,e);return e}function ia(a,b,c=null,d={x:0,y:0}){return R(a,b,c,1,d)}function hb(a,b,c){b===void 0&&(b=xk);let d=a.wrapMode,e=a.infinityMode;a.wrapMode=!1,a.infinityMode=!0;let f=ia(a,b,c,!0);return a.wrapMode=d,a.infinityMode=e,wa(a,b,f)}let xk={x:0,y:0};const ll=180/Math.PI;function ob(a){return a*ll}function rh(a,b){let c=b-a;if(c===0)return 0;let d=Math.floor((c- -180)/360);return c-d*360}function gb(a,b,c){c=ob(c);let d=a.grid.allDirections,e=Infinity,f;for(let g=0,i=d.length;g<i;g++){let j=ob(hb(a,b,d[g])),k=Math.abs(rh(c,j));k<e&&(e=k,f=g)}return f}function kb(a,b,c){if(b===null||c===null)return null;if(b.x===c.x&&b.y===c.y)return null;let d=a.grid.getNeighborTileDirection(b,c);if(a.wrapMode&&d===null){let e=ia(a,b,null);for(let f=0,g=e.length;f<g;f++){let i=e[f];if(c.x===i.x&&c.y===i.y){d=f;break}}}return d}function jb(a,b,c){let d=x(a,b),e=x(a,c);return kb(a,d,e)}function Vc(a,b,c){return jb(a,b,c)!==null}function Wc(a,b,c,d=!0){let e=x(a,b),f=x(a,c);return e===null||f===null?null:a.grid.directionBetween(e,f,d)}function Yb(a,b,c=1,d=[]){let e=a.grid.ringToTileXYArray(b,c);for(let f=0,g=e.length;f<g;f++){let i=e[f];Y(a,i.x,i.y)&&d.push(i)}return d}function Mf(a,b,c,d=!0,e=[]){for(let f=0;f<=c;f++){let g=d?f:c-f;Yb(a,b,g,e)}return e}function ea(a,b,c,d,e={x:0,y:0}){return e===!0&&(e=vk),c===0&&d===0?(e.x=b.x,e.y=b.y):a.grid.offset(b,c,d,e),e}let vk={x:0,y:0};function Nf(a,b){let c=Infinity,d=Infinity,e;for(let i=0,j=b.length;i<j;i++)e=b[i],c=Math.min(c,e.x),d=Math.min(d,e.y);if(c!==0||d!==0)for(let i=0,j=b.length;i<j;i++)e=b[i],ea(a,e,-c,-d,e);let f=-Infinity,g=-Infinity;for(let i=0,j=b.length;i<j;i++)e=b[i],f=Math.max(f,e.x),g=Math.max(g,e.y);return Pa(a,f+1),Qa(a,g+1),b}var Ta;(function(a){a[a["x+,y+"]=0]="x+,y+",a[a["x-,y+"]=1]="x-,y+",a[a["y+,x+"]=2]="y+,x+",a[a["y-,x+"]=3]="y-,x+"})(Ta||(Ta={}));function Xc(a,b,c,d=0){let e={x:0,y:0};switch(d){case 0:for(let f=0;f<a.height;f++)for(let g=0;g<a.width;g++)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 1:for(let f=0;f<a.height;f++)for(let g=a.width-1;g>=0;g--)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 2:for(let f=0;f<a.width;f++)for(let g=0;g<a.height;g++)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a);break;case 3:for(let f=0;f<a.width;f++)for(let g=a.height-1;g>=0;g--)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a)}}function Yc(a,b,c,d){return a.grid.getDistance(b,c,d)}function Xb(a,b=0,c=[]){if(Array.isArray(b)){let d=b;for(let e=0;e<a.height;e++)for(let f=0;f<a.width;f++){let g=!0;for(let i=0,j=d.length;i<j;i++)if(F(a,f,e,d[i])!==null){g=!1;break}g&&c.push({x:f,y:e})}}else for(let d=0;d<a.height;d++)for(let e=0;e<a.width;e++)F(a,e,d,b)===null&&c.push({x:e,y:d});return c}function ib(a,b,c,d){return a.grid.getGridPoints(b,c,d)}function T(a,b,c,d=[]){let e=a.boardData.getChess(b,c);for(const[f,g]of e)d.push(g);return d}function nb(a,b,c,d=[]){let e=c!=null,f,g;for(let i=0,j=b.length;i<j;i++)f=b[i],e?(g=F(a,f.x,f.y,c),g!==null&&d.push(g)):T(a,f.x,f.y,d);return d}function Zc(a,b,c,d,e){let f=x(a,b);if(f===null)return null;d==null&&(d=f.hasOwnProperty("z")?f.z:null);let g=ia(a,f,c,!0);return g===null?null:Array.isArray(g)?(e===void 0&&(e=[]),nb(a,g,d,e)):d==null?(e===void 0&&(e=[]),T(a,g.x,g.y,e)):F(a,g.x,g.y,d)}function _c(a,b,c,d={x:0,y:0}){let e=gb(a,b,c);return R(a,b,e,1,d)}function $c(a,b,c,d){return a.grid.getOppositeDirection(b,c,d)}function cg(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function jd(a,b=0,c=a.length){let d=b+Math.floor(Math.random()*c);return a[d]===void 0?null:a[d]}function Of(a,b=0,c={x:0,y:0}){c===!0&&(c=qk);let d=Math.floor(a.width*a.height*.3);for(let f=0;f<d;f++){let g=cg(0,a.width-1),i=cg(0,a.height-1);if(F(a,g,i,b)===null)return c.x=g,c.y=i,c}let e=Xb(a,b);if(e.length===0)return null;{let f=jd(e);return c.x=f.x,c.y=f.y,c}}let qk={x:0,y:0};function Pf(a,b,c,d){if(d===void 0){let e=T(a,b,c);for(let f=0,g=e.length;f<g;f++){let i=Z(e[f]).blocker;if(i===!0)return!0}return!1}else{let e=F(a,b,c,d);if(e===null)return!1;let f=Z(e).blocker;return f===!0}}function Qf(a,b){return a.boardData.chessToXYZ.has(b)}function Rf(a,b,c,d,e){if(d===void 0){let f=T(a,b,c);for(let g=0,i=f.length;g<i;g++)if(eh(Z(f[g]).blocker,e))return!0;return!1}else{let f=F(a,b,c,d);return f===null?!1:eh(Z(f).blocker,e)}}function eh(a,b){return a===!1||a===!0?a:a[b]===!0}function eg(a){return a=a%ri,a>=0?a:a+ri}const ri=Math.PI*2;function sh(a,b,c=1e-4){return Math.abs(a-b)<c}function ad(a,b,c,d,e){let f=x(a,b),g=x(a,c),i=wa(a,f,g);i=eg(i);let j=Math.abs(i-d);j=Math.min(j,yk-j);let k=e/2;return sh(j,k)||j<k}const yk=Math.PI*2;function bd(a,b,c,d,e){let f=x(a,b),g=x(a,c),i=a.grid.directions;a.grid.directions=a.grid.sides;let j=a.grid.directionBetween(f,g,!1);a.grid.directions=i;let k=Math.abs(j-d);return k=Math.min(k,a.grid.directions-k),k<=e/2}function Q(a,b,c,d={x:0,y:0}){return a.grid.getTileXY(b,c,d)}function cd(a,b,c,d){if(a.infinityMode&&d===void 0)return!0;let e=Q(a,b,c,!0);return Y(a,e.x,e.y,d)}function qh(a,b,c,d){let e=a-c,f=b-d;return Math.sqrt(e*e+f*f)}function dg(a,b,c){return(b-a)*c+a}function Sf(a,b,c,d,e,f=[]){let g=qh(b,c,d,e),i=Math.min(a.grid.width,a.grid.height),j=Math.ceil(g/(i/4)),k;for(let l=0;l<=j;l++){let m=l/j,p=dg(b,d,m),n=dg(c,e,m),s=Q(a,p,n);if(!Y(a,s.x,s.y))continue;if(k&&k.x===s.x&&k.y===s.y)continue;f.push(s),k=s}return f}var Ua;(function(a){a[a.x=1]="x",a[a.horizontal=1]="horizontal",a[a.h=1]="h",a[a.y=2]="y",a[a.vertical=2]="vertical",a[a.v=2]="v",a[a.xy=3]="xy"})(Ua||(Ua={}));function Tf(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=uk),d!==null?ea(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.mirror(e,c,e),d!==null&&ea(a,e,d.x,d.y,e),e}let uk={x:0,y:0};function Uf(a,b=!1,c=!1){let d=da(a);for(let e=0,f=d.length;e<f;e++)S(a,d[e],void 0,void 0,void 0,b,c)}function Vf(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=wk),d!==null?ea(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.rotate(e,c,e),d!==null&&ea(a,e,d.x,d.y,e),e}let wk={x:0,y:0};function Wf(a,b,c){let d=x(a,b);if(d===null)return;va(a,b,d.x,d.y,c)}function Zb(a,b,c){return Math.max(b,Math.min(c,a))}function Xf(a,b,c,d=[]){let e=Q(a,b.left,b.top,!0),f=e.x-1,g=e.y-1,i=Q(a,b.right,b.bottom,!0),j=i.x+1,k=i.y+1;a.infinityMode||(f=Zb(f,0,a.width-1),g=Zb(g,0,a.height-1),j=Zb(j,0,a.width-1),k=Zb(k,0,a.height-1));for(let l=f;l<=j;l++)for(let m=g;m<=k;m++){let p=P(a,l,m,!0);c(b,p.x,p.y)&&d.push({x:l,y:m})}return d}function Yf(a,b,c,d=!0){let e=x(a,b),f=x(a,c);if(e==null||f==null)return;S(a,b),S(a,c),va(a,b,f.x,f.y,f.z,d),va(a,c,e.x,e.y,e.z,d)}function dd(a,b,c=[]){let d=a.boardData.ZToChessSet.get(b);if(d)for(const e of d)c.push(e);return c}function ed(a,b,c=[]){for(let d=0,e=b.length;d<e;d++){let f=b[d];c.push(P(a,f.x,f.y))}return c}function fd(a,b,c,d={x:0,y:0}){return d===!0&&(d=zk),Q(a,b,c,d),P(a,d.x,d.y,d),d}let zk={x:0,y:0};function gd(a,b,c,d,e){let f=Q(a,b,c,!0);return d!==void 0?F(a,f.x,f.y,d):T(a,f.x,f.y,e)}class Uc extends Tc{addChess(a,b,c,d,e=!0){return va(this,a,b,c,d,e),this}angleBetween(a,b){return wa(this,a,b)}angleSnapToDirection(a,b){return gb(this,a,b)}angleToward(a,b){return hb(this,a,b)}areNeighbors(a,b){return Vc(this,a,b)}chessToTileXYZ(a){return x(this,a)}contains(a,b,c){return Y(this,a,b,c)}directionBetween(a,b,c=!0){return Wc(this,a,b,c)}filledRingToTileXYArray(a,b,c=!0,d=[]){return Mf(this,a,b,c,d)}fit(a){return Nf(this,a)}forEachTileXY(a,b,c=0){return Xc(this,a,b,c),this}getAllChess(a=[]){return da(this,a)}getChessData(a){return Z(a)}getDistance(a,b,c=!1){return Yc(this,a,b,c)}getEmptyTileXYArray(a=0,b=[]){return Xb(this,a,b)}getGridPoints(a,b,c){return ib(this,a,b,c)}getNeighborChess(a,b,c,d){return Zc(this,a,b,c,d)}getNeighborChessDirection(a,b){return jb(this,a,b)}getNeighborTileDirection(a,b){return kb(this,a,b)}getNeighborTileXY(a,b=null,c={x:0,y:0}){return ia(this,a,b,c)}getNeighborTileXYAtAngle(a,b,c={x:0,y:0}){return _c(this,a,b,c)}getOppositeDirection(a,b,c){return $c(this,a,b,c)}getRandomEmptyTileXY(a=0,b={x:0,y:0}){return Of(this,a,b)}getTileXYAtDirection(a,b,c,d){return R(this,a,b,c,d)}getWrapTileXY(a,b,c={x:0,y:0}){return lb(this,a,b,c)}gridAlign(a,b,c){return mb(this,a,b,c),this}hasBlocker(a,b,c){return Pf(this,a,b,c)}hasChess(a){return Qf(this,a)}hasEdgeBlocker(a,b,c,d){return Rf(this,a,b,c,d)}isAngleInCone(a,b,c,d){return ad(this,a,b,c,d)}isDirectionInCone(a,b,c,d){return bd(this,a,b,c,d)}isOverlappingPoint(a,b,c){return cd(this,a,b,c)}lineToTileXYArray(a,b,c,d,e=[]){return Sf(this,a,b,c,d,e)}mirror(a,b,c=null,d={x:0,y:0}){return Tf(this,a,b,c,d)}offset(a,b,c,d){return ea(this,a,b,c,d)}removeAllChess(a=!1,b=!1){return Uf(this,a,b),this}removeChess(a,b,c,d,e=!1,f=!1){return S(this,a,b,c,d,e,f),this}ringToTileXYArray(a,b=1,c=[]){return Yb(this,a,b,c)}rotate(a,b,c=null,d={x:0,y:0}){return Vf(this,a,b,c,d)}setBoardWidth(a=0){return Pa(this,a),this}setBoardHeight(a=0){return Qa(this,a),this}setTileZ(a,b){return Wf(this,a,b),this}shapeToTileXYArray(a,b,c=[]){return Xf(this,a,b,c)}swapChess(a,b,c=!0){return Yf(this,a,b,c),this}tileXYArrayToChessArray(a,b,c=[]){return nb(this,a,b,c)}tileXYToChessArray(a,b,c=[]){return T(this,a,b,c)}tileXYZToChess(a,b,c){return F(this,a,b,c)}tileZToChessArray(a,b=[]){return dd(this,a,b)}tileXYArrayToWorldXYArray(a,b=[]){return ed(this,a,b)}tileXYToWorldXY(a,b,c={x:0,y:0}){return P(this,a,b,c)}worldXYSnapToGrid(a,b,c={x:0,y:0}){return fd(this,a,b,c)}worldXYToChess(a,b,c,d){return gd(this,a,b,c,d)}worldXYToTileXY(a,b,c){return Q(this,a,b,c)}}class jc extends Uc{}const X={};hg(X,{ChessToTileXYZ:()=>x,Contains:()=>Y,DirectionBetween:()=>Wc,ForEachTileXY:()=>Xc,GetDistance:()=>Yc,GetOppositeDirection:()=>$c,GetTileXYAtDirection:()=>R,GetWrapTileXY:()=>lb,IsDirectionInCone:()=>bd,TileXYArrayToChessArray:()=>nb,TileXYToChessArray:()=>T,TileXYZToChess:()=>F,TileZToChessArray:()=>dd});const xa={};hg(xa,{AngleBetween:()=>wa,AngleSnapToDirection:()=>gb,AngleToward:()=>hb,GetGridPoints:()=>ib,GridAlign:()=>mb,IsAngleInCone:()=>ad,IsOverlappingPoint:()=>cd,TileXYArrayToWorldXYArray:()=>ed,TileXYToWorldXY:()=>P,WorldXYSnapToGrid:()=>fd,WorldXYToChess:()=>gd,WorldXYToTileXY:()=>Q});const pa={};hg(pa,{AreNeighbors:()=>Vc,GetNeighborChess:()=>Zc,GetNeighborChessDirection:()=>jb,GetNeighborTileDirection:()=>kb,GetNeighborTileXY:()=>ia,GetNeighborTileXYAtAngle:()=>_c});var C;(function(a){a[a.orthogonal=0]="orthogonal",a[a.isometric=1]="isometric"})(C||(C={}));var ra;(function(a){a[a["4dir"]=4]="4dir",a[a["8dir"]=8]="8dir"})(ra||(ra={}));class Zh{constructor({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=C.orthogonal,dir:f=ra["4dir"]}={}){this.setOriginPosition(a,b),this.setCellSize(c,d),this.setType(e),this.setDirectionMode(f)}fromJSON({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=C.orthogonal,dir:f=ra["4dir"]}={}){return this.setType(e),this.setDirectionMode(f),this.setOriginPosition(a,b),this.setCellSize(c,d),this}toJSON(){return{x:this.x,y:this.y,cellWidth:this.cellWidth,cellHeight:this.cellHeight,type:this.mode,dir:this.directions}}setOriginPosition(a=0,b=0){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setType(a=C.orthogonal){return typeof a==="string"&&(a=C[a]),this.mode=a,this}setDirectionMode(a=ra["4dir"]){return typeof a==="string"&&(a=ra[a]),this.directions=a,this}}function Rh(a,b,c,d=!0){let e;switch(a.mode){case C.orthogonal:case C.isometric:if(b.y===c.y)e=c.x>=b.x?0:2;else if(b.x===c.x)e=c.y>=b.y?1:3;else if(a.directions===ra["4dir"]){let f=ob(Va(b.x,b.y,c.x,c.y));f<0&&(f+=360),e=f/90,d&&(e=Math.round(e))}else{let f=c.x-b.x,g=c.y-b.y;if(f===g)e=f>0?4:6;else if(f===-g)e=f>0?7:5;else{let i=ob(Math.atan2(g,f));i<0&&(i+=360);let j=i/45;d&&(j=Math.round(j)),j>=0&&j<1?e=j:j>=1&&j<2?e=j+3:j>=2&&j<3?e=j-1:j>=3&&j<4?e=j+2:j>=4&&j<5?e=j-2:j>=5&&j<6?e=j+1:j>=6&&j<7?e=j-3:e=j}}break}return e===a.directions&&(e=0),e}function td(a,b){return qa(b,0,a.directions)}function Sh(a,b,c,d=!1){let e=c.x-b.x,f=c.y-b.y,g;return d?g=Math.abs(e)+Math.abs(f):g=Math.sqrt(e*e+f*f),g}function pd(a,b=[]){if(!(b.length===a))if(b.length<a)for(let c=b.length;c<a;c++)b.push({x:0,y:0});else b.length=a;return b}function wd(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Uk);let e,f;switch(a.mode){case C.orthogonal:e=b*a.width,f=c*a.height;break;case C.isometric:e=(b-c)*a._halfWidth,f=(b+c)*a._halfHeight;break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let Uk={x:0,y:0};function Th(a,b=0,c=0,d=[]){if(typeof b==="object"){let j=b;c=j.y,b=j.x}d===!0&&(d=Qk),pd(4,d);let e,f;({x:e,y:f}=wd(a,b,c));let g=a._halfWidth,i=a._halfHeight;switch(a.mode){case C.orthogonal:d[0].x=e+g,d[0].y=f-i,d[1].x=e+g,d[1].y=f+i,d[2].x=e-g,d[2].y=f+i,d[3].x=e-g,d[3].y=f-i;break;case C.isometric:d[0].x=e+g,d[0].y=f,d[1].x=e,d[1].y=f+i,d[2].x=e-g,d[2].y=f,d[3].x=e,d[3].y=f-i;break}return d}let Qk=[];const pb=[[1,0],[0,1],[-1,0],[0,-1],[1,1],[-1,1],[-1,-1],[1,-1]],$b=pb;function Oh(a){let b={},c,d,e;for(let f in a)c=a[f],d=c[0],e=c[1],b.hasOwnProperty(d)||(b[d]={}),b[d][e]=parseInt(f);return b}const Ph=Oh(pb),Qh=Oh($b);function Uh(a,b,c){let d;switch(a.mode){case C.orthogonal:d=Ph;break;case C.isometric:d=Qh;break}let e=c.x-b.x,f=c.y-b.y;if(d.hasOwnProperty(e)){let g=d[e];if(g.hasOwnProperty(f))return g[f]}return null}function xd(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Tk);let f,g;switch(a.mode){case C.orthogonal:f=pb[c][0],g=pb[c][1];break;case C.isometric:f=$b[c][0],g=$b[c][1];break}return d===1?(e.x=b.x+f,e.y=b.y+g):(e.x=b.x+d*f,e.y=b.y+d*g),e}let Tk={x:0,y:0};function Vh(a,b,c,d={x:0,y:0}){return xd(a,b,c,1,d)}function Wh(a,b,c,d){return Rk[d]}const Rk={0:2,1:3,2:0,3:1,4:6,5:7,6:4,7:5};function Xh(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Sk),b-=a.x,c-=a.y;let e=b/a.width,f=c/a.height;switch(a.mode){case C.orthogonal:d.x=Math.round(e),d.y=Math.round(f);break;case C.isometric:d.x=Math.round(+e+f),d.y=Math.round(-e+f);break}return d}let Sk={x:0,y:0};function Yh(a,b,c,d={x:0,y:0}){return typeof c==="string"&&(c=Ua[c]),d===!0&&(d=Vk),d.x=c&1?-b.x:b.x,d.y=c&2?-b.y:b.y,d}let Vk={x:0,y:0};function Wa(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Wk);let f=b.x+c,g=b.y+d;return e.x=f,e.y=g,e}let Wk={x:0,y:0};function _h(a,b,c,d=[]){let e,f;for(e=c,f=-c;f<=c;f++)d.push(Wa(a,b,e,f));for(f=c,e=c-1;e>=-c;e--)d.push(Wa(a,b,e,f));for(e=-c,f=c-1;f>=-c;f--)d.push(Wa(a,b,e,f));for(f=-c,e=-c+1;e<=c-1;e++)d.push(Wa(a,b,e,f));return d}function $h(a,b,c,d={x:0,y:0}){d===!0&&(d=$k),c=qa(c,0,3);let e,f;switch(c){case 1:e=-b.y,f=b.x;break;case 2:e=-b.x,f=-b.y;break;case 3:e=b.y,f=-b.x;break;default:e=b.x,f=b.y;break}return d.x=e,d.y=f,d}let $k={x:0,y:0};function ud(a){a._savedOriginX=a.x,a._savedOriginY=a.y}function vd(a){a.x=a._savedOriginX,a.y=a._savedOriginY}class Nh extends Zh{get sides(){return 4}get allDirections(){return this.directions===4?Xk:Yk}get halfDirections(){return this.directions===4?Zk:_k}directionBetween(a,b,c=!0){return Rh(this,a,b,c)}directionNormalize(a){return td(this,a)}getDistance(a,b,c=!1){return Sh(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return Th(this,a,b,c)}getNeighborTileDirection(a,b){return Uh(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return Vh(this,a,b,c)}getOppositeDirection(a,b,c){return Wh(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return Xh(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return xd(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return wd(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return Yh(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return Wa(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return _h(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return $h(this,a,b,c)}restoreOrigin(){return vd(this),this}saveOrigin(){return ud(this),this}}const Xk=[0,1,2,3],Yk=[0,1,2,3,4,5,6,7],Zk=[0,1],_k=[0,1,4,5];var y;(function(a){a[a.ODD_R=0]="ODD_R",a[a.EVEN_R=1]="EVEN_R",a[a.ODD_Q=2]="ODD_Q",a[a.EVEN_Q=3]="EVEN_Q"})(y||(y={}));var fa;(function(a){a[a.y=0]="y",a[a.flat=0]="flat",a[a.x=1]="x",a[a.pointy=1]="pointy"})(fa||(fa={}));var Aa;(function(a){a[a.even=0]="even",a[a.odd=1]="odd"})(Aa||(Aa={}));class Hh{constructor({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=fa.x,staggerIndex:g=Aa.odd}={}){this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e)}fromJSON({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=fa.x,staggerIndex:g=Aa.odd}={}){return this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e),this}toJSON(){return{x:this.x,y:this.y,radius:this.radius,cellWidth:this.cellWidth,cellHeight:this.cellHeight,staggerAxis:this.staggerAxis,staggerIndex:this.staggerIndex}}setOriginPosition(a,b){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this.radius=void 0,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setRadius(a=0){let b,c;return this.staggerAxis===fa.y?(b=2*a,c=Mh*a):(b=Mh*a,c=2*a),this.setCellSize(b,c),this.radius=a,this}setDirectionMode(){return this.directions=6,this}setType(a=1,b=1){return typeof a==="string"&&(a=fa[a]),typeof b==="string"&&(b=Aa[b]),this.staggerAxis=a,this.staggerIndex=b,a===fa.y?this.mode=b===Aa.even?y.EVEN_Q:y.ODD_Q:this.mode=b===Aa.even?y.EVEN_R:y.ODD_R,this}}const Mh=Math.sqrt(3);function U(a,b,c,d={x:0,y:0,z:0}){d===!0&&(d=fg);switch(a){case y.ODD_R:d.x=b-(c-(c&1))/2,d.z=c;break;case y.EVEN_R:d.x=b-(c+(c&1))/2,d.z=c;break;case y.ODD_Q:d.x=b,d.z=c-(b-(b&1))/2;break;case y.EVEN_Q:d.x=b,d.z=c-(b+(b&1))/2;break}return d.y=-d.x-d.z,d}function vh(a,b,c,d={x:0,y:0,z:0}){typeof a!=="number"&&(d=a,a=d.x,b=d.y,c=d.z),d===!0&&(d=fg);let e=Math.round(a),f=Math.round(b),g=Math.round(c),i=Math.abs(e-a),j=Math.abs(f-b),k=Math.abs(g-c);return i>j&&i>k?e=-f-g:j>k?f=-e-g:g=-e-f,d.x=e,d.y=f,d.z=g,d}function L(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Bk);switch(a){case y.ODD_R:e.x=b+(d-(d&1))/2,e.y=d;break;case y.EVEN_R:e.x=b+(d+(d&1))/2,e.y=d;break;case y.ODD_Q:e.x=b,e.y=d+(b-(b&1))/2;break;case y.EVEN_Q:e.x=b,e.y=d+(b+(b&1))/2;break}return e}function wh(a,b,c={x:0,y:0,z:0}){return c===!0&&(c=fg),c.x=a,c.y=-a-b,c.z=b,c}let fg={x:0,y:0,z:0},Bk={x:0,y:0};function yh(a,b,c,d=!0){let e;U(a.mode,b.x,b.y,ld),U(a.mode,c.x,c.y,md);let f=md.x-ld.x,g=md.y-ld.y,i=md.z-ld.z;return i===0?e=f>0?0:3:f===0?e=i>0?1:4:g===0?e=i>0?2:5:f>0&&g<0&&i>0?e=0+i/-g:f<0&&g<0&&i>0?e=1+-g/i:f<0&&g>0&&i>0?e=2+g/-f:f<0&&g>0&&i<0?e=3+-i/g:f>0&&g>0&&i<0?e=4+f/-i:e=5+-g/f,d&&(e=Math.round(e)),e}let ld={x:0,y:0,z:0},md={x:0,y:0,z:0};function zh(a,b,c,d=!1){U(a.mode,b.x,b.y,nd),U(a.mode,c.x,c.y,od);let e=od.x-nd.x,f=od.y-nd.y,g=od.z-nd.z;return(Math.abs(e)+Math.abs(f)+Math.abs(g))/2}let nd={x:0,y:0,z:0},od={x:0,y:0,z:0};function qd(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Kk);let e=b*a.width,f=c*a.height;switch(a.mode){case y.ODD_R:c&1&&(e+=a._halfWidth),f*=.75;break;case y.EVEN_R:c&1&&(e-=a._halfWidth),f*=.75;break;case y.ODD_Q:e*=.75,b&1&&(f+=a._halfHeight);break;case y.EVEN_Q:e*=.75,b&1&&(f-=a._halfHeight);break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let Kk={x:0,y:0};const kl=Math.PI/180;function ya(a){return a*kl}function Ah(a,b=0,c=0,d=[]){if(typeof b==="object"){let g=b;c=g.y,b=g.x}d===!0&&(d=Gk),pd(6,d);let e,f;({x:e,y:f}=qd(a,b,c));if(a.radius!==void 0){let g=a.radius,i=a.staggerAxis===fa.flat?0:-30;for(let j=0;j<6;j++){let k=60*j+i,l=ya(k);d[j].x=e+g*Math.cos(l),d[j].y=f+g*Math.sin(l)}}else{let g=a._halfWidth,i=g/2,j=a._halfHeight,k=j/2;a.staggerAxis===fa.flat?(d[0].x=e+g,d[0].y=f,d[1].x=e+i,d[1].y=f+j,d[2].x=e-i,d[2].y=f+j,d[3].x=e-g,d[3].y=f,d[4].x=e-i,d[4].y=f-j,d[5].x=e+i,d[5].y=f-j):(d[0].x=e+g,d[0].y=f-k,d[1].x=e+g,d[1].y=f+k,d[2].x=e,d[2].y=f+j,d[3].x=e-g,d[3].y=f+k,d[4].x=e-g,d[4].y=f-k,d[5].x=e,d[5].y=f-j)}return d}let Gk=[];const Ck=[[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]]],Dk=[[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]],[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]]],Ek=[[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]],[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]]],Fk=[[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]],[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]]],_=[Ck,Dk,Ek,Fk];function za(a){let b={},c,d;for(let e in a)[c,d]=a[e],b.hasOwnProperty(c)||(b[c]={}),b[c][d]=parseInt(e);return b}const xh=[[za(_[0][0]),za(_[0][1])],[za(_[1][0]),za(_[1][1])],[za(_[2][0]),za(_[2][1])],[za(_[3][0]),za(_[3][1])]];function rd(a,b,c){let d;switch(a){case y.ODD_R:case y.EVEN_R:d=c&1;break;case y.ODD_Q:case y.EVEN_Q:d=b&1;break}return d}function Bh(a,b,c){let d=a.mode,e=rd(d,b.x,b.y),f=xh[d][e],g=c.x-b.x,i=c.y-b.y;if(f.hasOwnProperty(g)){let j=f[g];if(j.hasOwnProperty(i))return j[i]}return null}function sd(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Jk);let f=a.mode,g=b.x,i=b.y;if(d===1){let j=rd(f,g,i);e.x=g+_[f][j][c][0],e.y=i+_[f][j][c][1]}else if(d===0)e.x=g,e.y=i;else{let j=U(f,g,i,!0),k,l,m;switch(c){case 1:k=j.x,l=j.y-d,m=j.z+d;break;case 2:k=j.x-d,l=j.y,m=j.z+d;break;case 3:k=j.x-d,l=j.y+d,m=j.z;break;case 4:k=j.x,l=j.y+d,m=j.z-d;break;case 5:k=j.x+d,l=j.y,m=j.z-d;break;default:k=j.x+d,l=j.y-d,m=j.z;break}L(f,k,l,m,e)}return e}let Jk={x:0,y:0};function Ch(a,b,c,d={x:0,y:0}){return sd(a,b,c,1,d)}function Dh(a,b,c,d){return(d+3)%6}const Eh=4/3,Fh=2/3;function Gh(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Ik),b-=a.x,c-=a.y;let e,f;switch(a.mode){case y.ODD_R:case y.EVEN_R:f=c*Eh/a.height,e=b/a.width-Fh*(c/a.height);break;case y.ODD_Q:case y.EVEN_Q:f=c/a.height-Fh*(b/a.width),e=b*Eh/a.width;break}let g=wh(e,f,Hk);return vh(g),L(a.mode,g.x,g.y,g.z,d),d}let Hk={x:0,y:0,z:0},Ik={x:0,y:0};function Ih(a,b,c,d={x:0,y:0}){typeof c==="string"&&(c=Ua[c]),d===!0&&(d=Nk);let e=U(a.mode,b.x,b.y,!0),f=a.mode===y.ODD_R||a.mode===y.EVEN_R,g,i,j;return c&1&&(f?(g=e.y,i=e.x,j=e.z):(g=-e.x,i=-e.z,j=-e.y),e.x=g,e.y=i,e.z=j),c&2&&(f?(g=-e.y,i=-e.x,j=-e.z):(g=e.x,i=e.z,j=e.y)),L(a.mode,g,i,j,d),d}let Nk={x:0,y:0};function Jh(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Ok);let f=b.x+c,g=b.y+d;switch(a.mode){case y.ODD_R:(d&1)!==0&&((g&1)===0&&(f+=1));break;case y.EVEN_R:(d&1)!==0&&((g&1)===0&&(f-=1));break;case y.ODD_Q:(c&1)!==0&&((f&1)==0&&(g+=1));break;case y.EVEN_Q:(c&1)!==0&&((f&1)==0&&(g-=1));break}return e.x=f,e.y=g,e}let Ok={x:0,y:0};function Kh(a,b,c,d=[]){let e=U(a.mode,b.x,b.y,!0),f=e.x,g=e.y,i=e.z,j,k,l;for(l=c,j=0;j>=-c;j--)k=-j-l,d.push(L(a.mode,f+j,g+k,i+l));for(j=-c,k=1;k<=c;k++)l=-j-k,d.push(L(a.mode,f+j,g+k,i+l));for(k=c,l=-1;l>=-c;l--)j=-k-l,d.push(L(a.mode,f+j,g+k,i+l));for(l=-c,j=1;j<=c;j++)k=-j-l,d.push(L(a.mode,f+j,g+k,i+l));for(j=c,k=-1;k>=-c;k--)l=-j-k,d.push(L(a.mode,f+j,g+k,i+l));for(k=-c,l=1;l<=c-1;l++)j=-k-l,d.push(L(a.mode,f+j,g+k,i+l));return d}function Lh(a,b,c,d={x:0,y:0}){d===!0&&(d=Pk),c=qa(c,0,5);let e=U(a.mode,b.x,b.y,!0),f,g,i;switch(c){case 1:f=-e.z,g=-e.x,i=-e.y;break;case 2:f=e.y,g=e.z,i=e.x;break;case 3:f=-e.x,g=-e.y,i=-e.z;break;case 4:f=e.z,g=e.x,i=e.y;break;case 5:f=-e.y,g=-e.z,i=-e.x;break;default:f=e.x,g=e.y,i=e.z;break}return L(a.mode,f,g,i,d),d}let Pk={x:0,y:0};class kc extends Hh{get sides(){return 6}get allDirections(){return Lk}get halfDirections(){return Mk}directionBetween(a,b,c=!0){return yh(this,a,b,c)}directionNormalize(a){return td(this,a)}getDistance(a,b,c=!1){return zh(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return Ah(this,a,b,c)}getNeighborTileDirection(a,b){return Bh(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return Ch(this,a,b,c)}getOppositeDirection(a,b,c){return Dh(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return Gh(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return sd(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return qd(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return Ih(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return Jh(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return Kh(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return Lh(this,a,b,c)}restoreOrigin(){return vd(this),this}saveOrigin(){return ud(this),this}}const Lk=[0,1,2,3,4,5],Mk=[0,1,2];var J;(function(a){a[a.random=0]="random",a[a.diagonal=1]="diagonal",a[a.straight=2]="straight",a[a.line=3]="line",a[a.astar=10]="astar",a[a["astar-random"]=11]="astar-random",a[a["astar-line"]=12]="astar-line"})(J||(J={}));const Xa=null;class li{constructor(a){this.content=[],this.scoreFunction=a}clear(){this.content.length=0}push(a){this.content.push(a),this.sinkDown(this.content.length-1)}pop(){let a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.bubbleUp(0)),a}remove(a){const b=this.content.indexOf(a);let c=this.content.pop();b!==this.content.length-1&&(this.content[b]=c,this.scoreFunction(c)<this.scoreFunction(a)?this.sinkDown(b):this.bubbleUp(b))}get size(){return this.content.length}rescoreElement(a){this.sinkDown(this.content.indexOf(a))}sinkDown(a){let b=this.content[a];for(;a>0;){let c=(a+1>>1)-1,d=this.content[c];if(this.scoreFunction(b)<this.scoreFunction(d))this.content[c]=b,this.content[a]=d,a=c;else break}}bubbleUp(a){let b=this.content.length,c=this.content[a],d=this.scoreFunction(c);for(;;){let e=a+1<<1,f=e-1,g=null,i;if(f<b){let j=this.content[f];i=this.scoreFunction(j),i<d&&(g=f)}if(e<b){let j=this.content[e],k=this.scoreFunction(j);k<(g===null?d:i)&&(g=e)}if(g!==null)this.content[a]=this.content[g],this.content[g]=c,a=g;else break}}}let dha=new li(a=>a.f);const Ad=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d=d.prevNodes[0];return c.reverse()};const oi=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d.prevNodes.length===1?d=d.prevNodes[0]:d=jd(d.prevNodes);return c.reverse()};const ni=function(a,b,c=[]){let d=b,e=b.angleTo(a);for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1)d=d.prevNodes[0];else{let f=Infinity;for(let g=1,i=d.prevNodes.length;g<i;g++){let j=d.prevNodes[g],k=Math.abs(b.angleTo(j)-e);k<f&&(f=k,d=j)}}}return c.reverse()};const mi=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let i=0,j=d.prevNodes.length;i<j;i++){f=d.prevNodes[i],g=f.logicDirTo(d);if(g!==e)break}e=g,d=f}}return c.reverse()};const pi=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let i=0,j=d.prevNodes.length;i<j;i++){f=d.prevNodes[i],g=f.logicDirTo(d);if(g===e)break}e=g,d=f}}return c.reverse()};let Ya={};Ya[J.astar]=Ad;Ya[J["astar-line"]]=Ad;Ya[J["astar-random"]]=Ad;Ya[J.random]=oi;Ya[J.line]=ni;Ya[J.diagonal]=mi;Ya[J.straight]=pi;class ei{constructor(){this.prevNodes=[]}shutdown(){this.key=void 0,this.prevNodes.length=0}destroy(){this.shutdown()}reset(a){this.key=a,this.f=0,this.g=0,this.h=void 0,this.closerH=void 0,this.visited=!1,this.closed=!1}heuristic(a,b,c){if(b===null)return 0;let d,e=this.distanceTo(a)*this.manager.weight;switch(b){case J.astar:d=e;break;case J["astar-line"]:if(c!==void 0){let f=a.angleTo(c)-this.angleTo(c);d=e+Math.abs(f)}else d=e;case J["astar-random"]:d=e+Math.random();break;default:d=e;break}return d}getNextNodes(){return[]}getCost(a){return Xa}distanceTo(a){return 0}angleTo(a){return 0}logicDirTo(a){return 0}getNode(a,b=!1){return this.manager.getNode(a,b)}}function fi(a){for(let b=a.length-1;b>0;b--){let c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a}class hl extends ei{constructor(a){super();this.isTileXYZ=!0;this.pathFinder=a}reset(a){super.reset(a),this.key=a,gi(a,this),this._px=void 0,this._py=void 0,this.cost=void 0}getNextNodes(){let a=pa.GetNeighborTileXY(this.board,this);this.pathFinder.shuffleNeighbors&&fi(a);let b=[];return a.forEach(c=>{let d=this.getNode(W(c.x,c.y),!0);b.push(d)}),b}getCost(a){return this.pathFinder.cacheCost?this.cost===void 0&&(this.cost=this.pathFinder.getCost(this,a)):this.cost=this.pathFinder.getCost(this,a),this.cost}distanceTo(a){return X.GetDistance(this.board,this,a,!0)}angleTo(a){return Va(this.worldX,this.wroldY,a.worldX,a.worldX)}logicDirTo(a){return pa.GetNeighborTileDirection(this.board,this,a)}get board(){return this.pathFinder.board}get worldX(){if(this._px===void 0){let a=xa.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._px}get wroldY(){if(this._py===void 0){let a=xa.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._py}}function yd(a,b,c,d,e){let f=typeof b==="number",g,i;f?(g=b,i=null):g=b.length;let j,k=a.wildcard,l,m=a.board,p=[];for(let n=0;n<g;n++){if(l===void 0)l={x:c,y:d};else{l=pa.GetNeighborTileXY(m,l,e,l);if(l===null)return!1}j=a.getSymbol(l.x,l.y);if(j==null)return!1;if(j!==k){if(f){if(i===null)i=j;else if(i!==j)return!1}else if(b[n]!==j)return!1}p.push({x:l.x,y:l.y})}return{tileXY:p,direction:e,pattern:b}}function gg(a,b,c,d,e=!1){let f=a.board,g=f.grid,i=g.halfDirections,j,k=a.dirMask,l=f.width,m=f.height,p;for(let n=0,s=i.length;n<s;n++){j=i[n];if(k[j]===!1)continue;for(let B=0;B<m;B++)for(let q=0;q<l;q++){p=yd(a,b,q,B,j);if(p===!1)continue;c&&(d?c.call(d,p,f):c(p,f));if(e)return p}}}function bi(a,b){let c=gg(a,b,null,null,!0);return c?c:!1}function ai(a,b,c,d=[]){let e=a.board,f=a.wildcard,g=a.getSymbol(b,c);if(g==null||g===f)return d;let i,j;for(ac.push(b,c);ac.length;)i=ac.pop(),j=a.getSymbol(i.x,i.y),(j===g||j===f)&&(d.push(i),ac.push(pa.GetNeighborTileXY(e,i)));return ac.clear(),d}class cl{constructor(){this.data=[];this.visited=new Set()}push(a,b){if(Array.isArray(a)){let d=a;for(let e=0,f=d.length;e<f;e++)this.push(d[e]);return this}if(typeof a==="object"){let d=a;a=d.x,b=d.y}let c=`${a},${b}`;return this.visited.has(c)?this:(this.data.push({x:a,y:b}),this.visited.add(c),this)}pop(){return this.data.pop()}get length(){return this.data.length}clear(){return this.data.length=0,this.visited.clear(),this}}let ac=new cl();class lc{constructor({board:a,wildcard:b,dirMask:c}={}){this.symbols=[];this.dirMask={};this.setBoard(a),this.setWildcard(b),c!==void 0&&this.setDirMask(c),this.boot()}boot(){}destroy(){this.board=void 0,this.symbols=void 0,this.dirMask=void 0}setBoard(a){return this.board=a,a&&this.clearSymbols(),this}setDirMask(a,b=!1){if(typeof a==="object"){let c=a;for(let d in c)this.dirMask[d]=c[d]}else this.dirMask[a]=b;return this}setDirectionMode(a){return this.board.grid.setDirectionMode(a),this}clearSymbols(){return this.refreshSymbols(null),this}setSymbol(a,b,c){return X.Contains(this.board,a,b)?(this.symbols[this.tileXYToKey(a,b)]=c,this):this}getSymbol(a,b){return this.symbols[this.tileXYToKey(a,b)]}forEach(a,b){let c=this.board,d,e;for(let f=0,g=this.symbols.length;f<g;f++)e=this.symbols[f],d=this.keyToTileXY(f,!0),b?a.call(b,e,d,c):a(e,d,c);return this}refreshSymbols(a,b){let c=this.board,d=c.width,e=c.height;this.symbols.length=d*e;let f,g;if(typeof a==="function")for(let i=0,j=this.symbols.length;i<j;i++)g=this.keyToTileXY(i,!0),b?f=a.call(b,g,c):f=a(g,c),this.symbols[i]=f;else{f=a;for(let i=0,j=this.symbols.length;i<j;i++)this.symbols[i]=f}return this}setWildcard(a){return this.wildcard=a,this}tileXYToKey(a,b){return a+b*this.board.width}keyToTileXY(a,b={x:0,y:0}){b===!0&&(b=dl);let c=this.board.width;return b.x=a%c,b.y=Math.floor(a/c),b}group(a,b,c=[]){return ai(this,a,b,c)}match(a,b,c,d=!1){return gg(this,a,b,c,d),this}matchAny(a){return bi(this,a)}matchAtDir(a,b,c,d){return yd(this,a,b,c,d)}}let dl={x:0,y:0};var kd;(function(a){a[a.direction=0]="direction",a[a.angle=1]="angle"})(kd||(kd={}));function qb(a,b,c,d=1){let e;if(typeof a==="string"){let i=ha.get();i.has(a)||i.add(a,zc()),e=i.get(a)}else e=a;let f=e.image,g=f.getContext("2d");return c?b.call(c,f,g):b(f,g),e.setSize(f.width/d,f.height/d),e.binding&&e.binding.update(),e}var cc;(function(a){a[a.left=1]="left",a[a.right=2]="right",a[a.both=3]="both"})(cc||(cc={}));function qi(a,b=0,c=" ",d=1){a=a.toString();let e=0;if(b+1>=a.length)switch(d){case 1:a=new Array(b+1-a.length).join(c)+a;break;case 3:e=b-a.length;let f=Math.ceil(e/2),g=e-f;a=new Array(g+1).join(c)+a+new Array(f+1).join(c);break;default:a=a+new Array(b+1-a.length).join(c);break}return a}function rb(a,b,c){switch(typeof a){case"number":return`#${qi(Math.floor(a).toString(16),6,"0",cc.left)}`;case"function":return a(b,c);default:return a}}const wha=ya(0),xha=ya(90),yha=ya(180),zha=ya(270);function ii(a,b,c,d,e,f=2,g="round"){b.beginPath(),b.lineJoin=g;let i=c[0];b.moveTo(i.x,i.y);for(let j=1,k=c.length;j<k;j++)i=c[j],b.lineTo(i.x,i.y);b.closePath(),d!==void 0&&(b.fillStyle=d,b.fill()),e!==void 0&&(b.strokeStyle=e,b.lineWidth=f,b.stroke())}function zd(a,{points:b,fillStyle:c,strokeStyle:d,lineWidth:e=2,lineJoin:f="round"}={}){return qb(a,function(g,i){if(!b||b.length===0){g.width=1,g.height=1;return}d||(e=0);let j=Infinity,k=Infinity,l=-Infinity,m=-Infinity;for(let I=0,ja=b.length;I<ja;I++){const $=b[I],ka=$.x,la=$.y;j=Math.min(j,ka),k=Math.min(k,la),l=Math.max(l,ka),m=Math.max(m,la)}const p=l-j,n=m-k,s=p/2,B=n/2,q=e/2;g.width=Math.ceil(p),g.height=Math.ceil(n);let E=[];for(let I=0,ja=b.length;I<ja;I++){const $=b[I];E.push({x:ji($.x-j,s,q),y:ji($.y-k,B,q)})}ii(g,i,E,rb(c,g,i),rb(d,g,i),e,f)})}function ji(a,b,c){return a<b?a+c:a>b?a-c:a}var ki;(function(a){a[a.right=0]="right",a[a.down=1]="down",a[a.left=2]="left",a[a.up=3]="up"})(ki||(ki={}));function tb(a,b,c,d,e,f="miter"){zd(b,{points:ib(a,0,0,!0),fillStyle:c,strokeStyle:d,lineWidth:e,lineJoin:f})}const og=[16711680,65280,255,8388736,8421376,32896];class wi extends ma{constructor(){super(0,0,"chess")}setSymbol(a){return this.__symbol=a,Ed(og[a],this),this}getSymbol(){return this.__symbol}}class xi extends jc{constructor(a){super(a);this.match=new lc({board:this}),this.lastMatchedCount=0,tb(this,"tile",void 0,"white",2),tb(this,"chess","white")}setWorld(a){return this.world=a,this}strokeGrid(){return this.forEachTileXY(a=>{let b=this.tileXYToWorldXY(a.x,a.y,!0),c=new ma(b.x,b.y,"tile");_a(this.world,c)}),this}fillChess(){return this.forEachTileXY(a=>{let b=new wi();b.setSymbol(ic(0,og.length-1)),_a(this.world,b),this.addChess(b,a.x,a.y,0)}),this}refreshSymbols(){return this.match.refreshSymbols(a=>{var b=this.tileXYZToChess(a.x,a.y,0);return b===null?null:b.getSymbol()}),this}match3(){let a=0;return this.refreshSymbols(),this.match.match(3,b=>{let c=this.tileXYArrayToChessArray(b.tileXY,0);for(let d=0,e=c.length;d<e;d++)Fd(.5,c[d]);a++}),this.lastMatchedCount=a,this}}class yi extends ng{constructor(){super();const a=new Dd(this),b=new xi({grid:new kc({x:80,y:80,cellWidth:60,cellHeight:68}),width:8,height:8});b.setWorld(a).strokeGrid().fillChess().match3();const c=new hc(0,580,`Match count= ${b.lastMatchedCount}`);c.setOrigin(0),_a(a,c)}}new mg(Cd(),gc(800,600),ec("game"),Bd(2960685),fc(yi));})();
/**
 * @author       Niklas von Hertzen (https://github.com/niklasvh/base64-arraybuffer)
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2020 Photon Storm Ltd.
 * @license      {@link https://opensource.org/licenses/MIT|MIT License}
 */
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2020 Photon Storm Ltd.
 * @license      {@link https://opensource.org/licenses/MIT|MIT License}
 */

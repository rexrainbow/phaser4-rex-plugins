(()=>{const s={AUTO:"Auto",BACKGROUND_COLOR:"BackgroundColor",BANNER:"Banner",BATCH_SIZE:"BatchSize",CANVAS_CONTEXT:"CanvasContext",CANVAS:"Canvas",DEFAULT_ORIGIN:"DefaultOrigin",GLOBAL_VAR:"GlobalVar",MAX_TEXTURES:"MaxTextures",PARENT:"Parent",RENDERER:"Renderer",SCENES:"Scenes",SIZE:"Size",WEBGL_CONTEXT:"WebGLContext",WEBGL:"WebGL"};const r=new Map();function Za(a){r.set(s.BACKGROUND_COLOR,a)}function wb(a){return()=>{Za(a)}}function _a(a="",b="",c="",d="#fff",f="linear-gradient(#3e0081 40%, #00bcc3)"){r.set(s.BANNER,{title:a,version:b,url:c,color:d,background:f})}function Ib(a){r.set(s.BATCH_SIZE,a)}function M(){return r.get(s.SIZE).height}function N(){return r.get(s.SIZE).resolution}function O(){return r.get(s.SIZE).width}function wa(a=800,b=600,c=1){c===0&&(c=window.devicePixelRatio),r.set(s.SIZE,{width:a,height:b,resolution:c})}function Ya(a=800,b=600,c=1){return()=>{wa(a,b,c)}}const hc=[],ma={add:(a,b)=>{hc.push({texture:a,glConfig:b})},get:()=>hc,clear:()=>{hc.length=0}};function Jb(){return r.get(s.BACKGROUND_COLOR)}function ab(a){r.set(s.RENDERER,a)}function $a(a=.5,b=a){r.set(s.DEFAULT_ORIGIN,{x:a,y:b})}function ha(a){r.set(s.MAX_TEXTURES,a)}function ya(a){let b;return a&&(typeof a==="string"?b=document.getElementById(a):typeof a==="object"&&a.nodeType===1&&(b=a)),b||(b=document.body),b}function Mb(a){a&&r.set(s.PARENT,ya(a))}function Wa(a){return()=>{Mb(a)}}function Ob(a){r.set(s.SCENES,[].concat(a))}function Xa(a){return()=>{Ob(a)}}function kb(a,b,c){return a.width<=0||a.height<=0?!1:a.x<=b&&a.x+a.width>=b&&a.y<=c&&a.y+a.height>=c}class B{constructor(a=0,b=0,c=0,d=0){this.set(a,b,c,d)}set(a=0,b=0,c=0,d=0){return this.x=a,this.y=b,this.width=c,this.height=d,this}contains(a,b){return kb(this,a,b)}set right(a){a<=this.x?this.width=0:this.width=a-this.x}get right(){return this.x+this.width}set bottom(a){a<=this.y?this.height=0:this.height=a-this.y}get bottom(){return this.y+this.height}}function wc(a,b=0,c=0,d=0,f=0){const g=new B(b,c,d,f);return a.viewportStack.push(g),g}let e;const zd={get:()=>e,set:a=>{e=a}};function $(a,b){if(!b){b=a.currentViewport;if(!b)return}const c=e.getParameter(e.VIEWPORT);(c[0]!==b.x||c[1]!==b.y||c[2]!==b.width||c[3]!==b.height)&&e.viewport(b.x,b.y,b.width,b.height)}function yc(a,b=0,c=0,d=0,f=0){const g=wc(a,b,c,d,f);$(a,g),a.currentViewport=g}function Z(a,b=!0,c){c||(c=a.currentFramebuffer);const{framebuffer:d,viewport:f}=c;e.bindFramebuffer(e.FRAMEBUFFER,d),b&&(e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)),f&&yc(a,f.x,f.y,f.width,f.height)}function Cc(a){const b=a.viewportStack;b.length>1&&b.pop(),a.currentViewport=b[b.length-1],$(a)}function W(a){const b=a.framebufferStack;b.length>1&&(a.currentFramebuffer.viewport&&Cc(a),b.pop()),a.currentFramebuffer=b[b.length-1],Z(a,!1)}function tc(a,b,c){const d={framebuffer:b,viewport:c};return a.framebufferStack.push(d),d}function ja(a,b,c=!0,d){const f=tc(a,b,d);Z(a,c,f),a.currentFramebuffer=f}function Bc(a){const b=a.count;if(b===0)return;const c=a.currentVertexBuffer,d=a.currentShader,f=d.shader.renderToFramebuffer;f&&ja(a,d.shader.framebuffer,!0);if(b===c.batchSize){const g=c.isDynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW;e.bufferData(e.ARRAY_BUFFER,c.data,g)}else{const g=c.indexed?b*c.entryElementSize:b*c.vertexElementSize,h=c.vertexViewF32.subarray(0,g);e.bufferSubData(e.ARRAY_BUFFER,0,h)}c.indexed?e.drawElements(e.TRIANGLES,b*c.entryIndexSize,e.UNSIGNED_SHORT,0):e.drawArrays(e.TRIANGLES,0,b),f&&W(a)}function C(a,b){b&&(a.count=b);const c=a.count;return c===0?!1:(Bc(a),a.prevCount=c,a.count=0,a.flushTotal++,!0)}function ic(a){C(a)}function Bd(a,b=[]){const c=a>>16&255,d=a>>8&255,f=a&255,g=a>16777215?a>>>24:255;return b[0]=c/255,b[1]=d/255,b[2]=f/255,b[3]=g/255,b}function qd(){return r.get(s.WEBGL_CONTEXT)}function pb(a){const{parent:b,flipY:c,unpackPremultiplyAlpha:d,minFilter:f,magFilter:g,wrapS:h,wrapT:i,generateMipmap:k,isPOT:j}=a,o=b.image;let l=b.width,u=b.height;const n=e.createTexture();return e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,n),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,c),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,d),o?(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,o),l=o.width,u=o.height):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,l,u,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,f),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,g),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,h),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,i),k&&j&&e.generateMipmap(e.TEXTURE_2D),a.texture=n,n}function L(a){e&&e.isFramebuffer(a)&&e.deleteFramebuffer(a)}function Qa(a){e.isTexture(a)&&e.deleteTexture(a)}function vd(a,b){return a<1||b<1?!1:(a&a-1)===0&&(b&b-1)===0}function Jd(a,b=!0){e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,a);const c=b?e.LINEAR:e.NEAREST;e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,c),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,c)}function Kd(a){const b=a.parent.image,c=b.width,d=b.height;return c>0&&d>0&&(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,a.texture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,a.flipY),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,b)),a.texture}class ka{constructor(a,b={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1,this.parent=a,this.isPOT=vd(a.width,a.height);const{texture:c=null,framebuffer:d=null,depthbuffer:f=null,unpackPremultiplyAlpha:g=!0,minFilter:h=this.isPOT?e.LINEAR_MIPMAP_LINEAR:e.LINEAR,magFilter:i=e.LINEAR,wrapS:k=e.CLAMP_TO_EDGE,wrapT:j=e.CLAMP_TO_EDGE,generateMipmap:o=this.isPOT,flipY:l=!1}=b;this.minFilter=h,this.magFilter=i,this.wrapS=k,this.wrapT=j,this.generateMipmap=o,this.flipY=l,this.unpackPremultiplyAlpha=g,d&&(this.framebuffer=d),f&&(this.depthbuffer=f),c?this.texture=c:pb(this)}setFilter(a){this.texture&&Jd(this.texture,a)}create(){const a=this.texture;return a&&Qa(a),pb(this)}update(){const a=this.texture;return a?Kd(this):pb(this)}setIndex(a){this.dirtyIndex=a!==this.index,this.index=a}destroy(){Qa(this.texture),L(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}}function jc(){const a=ma.get();a.forEach(b=>{const{texture:c,glConfig:d}=b;c.binding||(c.binding=new ka(c,d))}),ma.clear()}function xa(){return r.get(s.MAX_TEXTURES)}const ze=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Ae(a){let b="";for(let c=0;c<a;++c)c>0&&(b+=`
else `),c<a-1&&(b+=`if(test == ${c}.0){}`);return b}function zc(a){const b=e.createShader(e.FRAGMENT_SHADER);for(;;){const c=ze.replace(/%forloop%/gi,Ae(a));e.shaderSource(b,c),e.compileShader(b);if(!e.getShaderParameter(b,e.COMPILE_STATUS))a=a/2|0;else break}return a}function Ac(a){let b=zc(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS));const c=xa();c===0||c>0&&c>b?ha(b):c>0&&c<b&&(b=Math.max(8,c));const d=a.tempTextures;d.length&&d.forEach(g=>{e.deleteTexture(g)});const f=[];for(let g=0;g<b;g++){const h=e.createTexture();e.activeTexture(e.TEXTURE0+g),e.bindTexture(e.TEXTURE_2D,h),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),d[g]=h,f.push(g)}a.maxTextures=b,a.textureIndex=f,a.currentActiveTexture=1}function od(){return r.get(s.BATCH_SIZE)}function Ma(a){e.isBuffer(a)&&e.deleteBuffer(a)}class Dd{constructor(a={}){this.indexed=!1,this.isDynamic=!1,this.count=0,this.offset=0;const{batchSize:b=1,dataSize:c=4,isDynamic:d=!0,elementsPerEntry:f=4,vertexElementSize:g=6}=a;this.batchSize=b,this.dataSize=c,this.vertexElementSize=g,this.isDynamic=d,this.elementsPerEntry=f,this.vertexByteSize=g*c,this.entryByteSize=this.vertexByteSize*f,this.bufferByteSize=b*this.entryByteSize,this.create()}resize(a){this.batchSize=a,this.bufferByteSize=a*this.entryByteSize,this.vertexBuffer&&Ma(this.vertexBuffer),this.create()}create(){const a=new ArrayBuffer(this.bufferByteSize);this.data=a,this.vertexViewF32=new Float32Array(a),this.vertexViewU32=new Uint32Array(a),this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer);const b=this.isDynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW;e.bufferData(e.ARRAY_BUFFER,a,b),e.bindBuffer(e.ARRAY_BUFFER,null)}add(a){this.count+=a,this.offset+=this.vertexElementSize*a}reset(){this.count=0,this.offset=0}canContain(a){return this.count+a<=this.batchSize}free(){return Math.max(0,1-this.count/this.batchSize)}bind(){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer)}destroy(){Ma(this.vertexBuffer),this.data=null,this.vertexViewF32=null,this.vertexViewU32=null,this.vertexBuffer=null}}class nc extends Dd{constructor(a={}){super(a);const{indexSize:b=4,entryIndexSize:c=6,indexLayout:d=null}=a;this.indexed=!0,this.indexSize=b,this.entryIndexSize=c,this.entryElementSize=this.vertexElementSize*this.elementsPerEntry;const f=[];if(d){this.indexLayout=d;for(let g=0;g<this.batchSize*b;g+=b)for(let h=0;h<d.length;h++)f.push(g+d[h])}this.create(),this.createIndexBuffer(f)}createIndexBuffer(a){this.index=new Uint16Array(a),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.index,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),a=[]}bind(){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer)}destroy(){super.destroy(),Ma(this.indexBuffer),this.index=null,this.indexLayout=null,this.indexBuffer=null}}const Sd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Fe=new Uint8Array(256);for(let a=0;a<Sd.length;a++)Fe[Sd.charCodeAt(a)]=a;function X(){}class v{constructor(a){const b=new Float32Array(16);this.data=b,this.onChange=X,a?Array.isArray(a)?this.fromArray(a):this.fromArray(a.data):(b[0]=1,b[5]=1,b[10]=1,b[15]=1)}set(a,b,c,d,f,g,h,i,k,j,o,l,u,n,t,w){const p=this.data;return p[0]=a,p[1]=b,p[2]=c,p[3]=d,p[4]=f,p[5]=g,p[6]=h,p[7]=i,p[8]=k,p[9]=j,p[10]=o,p[11]=l,p[12]=u,p[13]=n,p[14]=t,p[15]=w,this.onChange(this),this}toArray(a=[],b=0){const c=this.data;for(let d=0;d<16;d++)a[b+d]=c[d];return a}fromArray(a,b=0){const c=this.data;for(let d=0;d<16;d++)c[d]=a[b+d];return this.onChange(this),this}toString(){return"[ mat4="+this.data.join(", ")+" ]"}destroy(){this.onChange=X,this.data=null}}function gc(a,b,c,d,f,g,h=new v()){const i=1/(a-b),k=1/(c-d),j=1/(f-g);return h.set(-2*i,0,0,0,0,-2*k,0,0,0,0,2*j,0,(a+b)*i,(d+c)*k,(g+f)*j,1)}function Jc(a,b){const c=new Map(),d={size:1,type:e.FLOAT,normalized:!1,stride:0,offset:0},f=e.getProgramParameter(a,e.ACTIVE_ATTRIBUTES);for(let g=0;g<f;g++){const h=e.getActiveAttrib(a,g);if(!h)break;const i=h.name,k=e.getAttribLocation(a,i);e.enableVertexAttribArray(k);const j=b.hasOwnProperty(i)?b[i]:{},{size:o=d.size,type:l=d.type,normalized:u=d.normalized,stride:n=d.stride,offset:t=d.offset}=j;c.set(i,{index:k,size:o,type:l,normalized:u,stride:n,offset:t})}return c}function Pa(...a){a.forEach(b=>{e.deleteShader(b)})}function Kc(...a){const b=e.createProgram();a.forEach(d=>{e.attachShader(b,d)}),e.linkProgram(b);const c=e.getProgramParameter(b,e.LINK_STATUS);if(!c){const d=e.getProgramInfoLog(b);return console.error(`Error linking program: ${d}`),e.deleteProgram(b),Pa(...a),null}return b}function ob(a,b){const c=e.createShader(b);e.shaderSource(c,a),e.compileShader(c);const d=e.getShaderParameter(c,e.COMPILE_STATUS);if(!d){const f=e.getShaderInfoLog(c),g=a.split(`
`).map((h,i)=>`${i}: ${h}`);return console.error(`Error compiling shader: ${f}`,g.join(`
`)),e.deleteShader(c),null}return c}function Lc(a,b,c=!1){switch(a.type){case e.INT:case e.BOOL:return c?d=>{e.uniform1iv(b,d)}:d=>{e.uniform1i(b,d)};case e.INT_VEC2:case e.BOOL_VEC2:return d=>{e.uniform2iv(b,d)};case e.INT_VEC3:case e.BOOL_VEC3:return d=>{e.uniform3iv(b,d)};case e.INT_VEC4:case e.BOOL_VEC4:return d=>{e.uniform4iv(b,d)};case e.FLOAT:return c?d=>{e.uniform1fv(b,d)}:d=>{e.uniform1f(b,d)};case e.FLOAT_VEC2:return d=>{e.uniform2fv(b,d)};case e.FLOAT_VEC3:return d=>{e.uniform3fv(b,d)};case e.FLOAT_VEC4:return d=>{e.uniform4fv(b,d)};case e.FLOAT_MAT2:return d=>{e.uniformMatrix2fv(b,!1,d)};case e.FLOAT_MAT3:return d=>{e.uniformMatrix3fv(b,!1,d)};case e.FLOAT_MAT4:return d=>{e.uniformMatrix4fv(b,!1,d)};case e.SAMPLER_2D:case e.SAMPLER_CUBE:return a.size>1?d=>{e.uniform1iv(b,d)}:d=>{e.uniform1i(b,d)}}}function Mc(a){const b=new Map(),c=e.getProgramParameter(a,e.ACTIVE_UNIFORMS);for(let d=0;d<c;d++){const f=e.getActiveUniform(a,d);let g=f.name;if(g.startsWith("gl_")||g.startsWith("webgl_"))continue;const h=e.getUniformLocation(a,f.name);if(h){let i=!1;g.substr(-3)==="[0]"&&(g=g.substr(0,g.length-3),i=f.size>1),b.set(g,Lc(f,h,i))}}return b}const Ad=5121,lb=5126;const ba={aVertexPosition:{size:2,type:lb,normalized:!1,offset:0},aTextureCoord:{size:2,type:lb,normalized:!1,offset:8},aTextureId:{size:1,type:lb,normalized:!1,offset:16},aTintColor:{size:4,type:Ad,normalized:!0,offset:20}};const Nc={uProjectionMatrix:new Float32Array(),uCameraMatrix:new Float32Array(),uTexture:0};function Fd(a,b,c){e.bindFramebuffer(e.FRAMEBUFFER,a);const d=e.createRenderbuffer();return e.bindRenderbuffer(e.RENDERBUFFER,d),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,b,c),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,d),e.bindFramebuffer(e.FRAMEBUFFER,null),d}function ib(a,b){b||(b=e.COLOR_ATTACHMENT0);const c=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,c),e.framebufferTexture2D(e.FRAMEBUFFER,b,e.TEXTURE_2D,a,0),e.bindFramebuffer(e.FRAMEBUFFER,null),c}const Hd=`#define SHADER_NAME SINGLE_QUAD_FRAG

precision highp float;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

uniform sampler2D uTexture;

void main (void)
{
    vec4 color = texture2D(uTexture, vTextureCoord);

    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);
}`;const Id=`#define SHADER_NAME SINGLE_QUAD_VERT

precision highp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute float aTextureId;
attribute vec4 aTintColor;

uniform mat4 uProjectionMatrix;
uniform mat4 uCameraMatrix;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

void main (void)
{
    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vTintColor = aTintColor;

    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);
}`;class Pc{constructor(a,b,c,d,f,g){this.trimmed=!1,this.texture=a,this.key=b,this.x=c,this.y=d,this.width=f,this.height=g,this.sourceSizeWidth=f,this.sourceSizeHeight=g,this.updateUVs()}setPivot(a,b){this.pivot={x:a,y:b}}setSize(a,b){this.width=a,this.height=b,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.updateUVs()}setSourceSize(a,b){this.sourceSizeWidth=a,this.sourceSizeHeight=b}setTrim(a,b,c,d,f,g){this.trimmed=!0,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.spriteSourceSizeX=c,this.spriteSourceSizeY=d,this.spriteSourceSizeWidth=f,this.spriteSourceSizeHeight=g}getExtent(a,b){const c=this.sourceSizeWidth,d=this.sourceSizeHeight;let f,g,h,i;return this.trimmed?(f=this.spriteSourceSizeX-a*c,g=f+this.spriteSourceSizeWidth,h=this.spriteSourceSizeY-b*d,i=h+this.spriteSourceSizeHeight):(f=-a*c,g=f+c,h=-b*d,i=h+d),{left:f,right:g,top:h,bottom:i}}copyToExtent(a){const b=a.transform,c=b.origin.x,d=b.origin.y,f=this.sourceSizeWidth,g=this.sourceSizeHeight;let h,i,k,j;return this.trimmed?(h=this.spriteSourceSizeX-c*f,i=this.spriteSourceSizeY-d*g,k=this.spriteSourceSizeWidth,j=this.spriteSourceSizeHeight):(h=-c*f,i=-d*g,k=f,j=g),b.setExtent(h,i,k,j),this}copyToVertices(a,b=0){const{u0:c,u1:d,v0:f,v1:g}=this;return a[b+0].setUV(c,f),a[b+1].setUV(c,g),a[b+2].setUV(d,g),a[b+3].setUV(d,f),this}updateUVs(){const{x:a,y:b,width:c,height:d}=this,f=this.texture.width,g=this.texture.height;this.u0=a/f,this.v0=b/g,this.u1=(a+c)/f,this.v1=(b+d)/g}}class D{constructor(a,b,c,d){this.key="",a&&(b=a.width,c=a.height),this.image=a,this.width=b,this.height=c,this.frames=new Map(),this.data={},this.addFrame("__BASE",0,0,b,c),ma.add(this,d)}addFrame(a,b,c,d,f){if(this.frames.has(a))return null;const g=new Pc(this,a,b,c,d,f);return this.frames.set(a,g),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=g),g}getFrame(a){if(!a)return this.firstFrame;a instanceof Pc&&(a=a.key);let b=this.frames.get(a);return b||(console.warn(`Frame missing: ${a}`),b=this.firstFrame),b}setSize(a,b){this.width=a,this.height=b;const c=this.frames.get("__BASE");c.setSize(a,b)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}}class Oc{constructor(a){this.renderToFramebuffer=!1,this.renderToDepthbuffer=!1,a&&this.fromConfig(a)}fromConfig(a){const{attributes:b=ba,fragmentShader:c=Hd,height:d=M(),renderToFramebuffer:f=!1,renderToDepthbuffer:g=!1,resolution:h=N(),vertexShader:i=Id,width:k=O(),uniforms:j=Nc}=a;this.create(c,i,j,b);if(f){this.renderToFramebuffer=!0;const o=new D(null,k*h,d*h),l=new ka(o);o.binding=l,l.framebuffer=ib(l.texture),g&&(this.renderToDepthbuffer=!0,l.depthbuffer=Fd(l.framebuffer,o.width,o.height)),this.texture=o,this.framebuffer=l.framebuffer}}create(a,b,c,d){const f=ob(a,e.FRAGMENT_SHADER),g=ob(b,e.VERTEX_SHADER);if(!f||!g)return;const h=Kc(f,g);if(!h)return;const i=e.getParameter(e.CURRENT_PROGRAM);e.useProgram(h),this.program=h,this.uniformSetters=Mc(h),this.uniforms=new Map();for(const[k,j]of Object.entries(c))this.uniforms.set(k,j);this.attributes=Jc(h,d),e.useProgram(i)}updateUniforms(a){}bind(a){return this.updateUniforms(a),this.setUniforms(a)}setUniform(a,b){const c=this.uniforms;if(c.has(a)){c.set(a,b);const d=this.uniformSetters.get(a);d(b)}}setUniforms(a){if(!this.program)return!1;e.useProgram(this.program);const b=this.uniforms;for(const[c,d]of this.uniformSetters.entries())d(b.get(c));return!0}setAttributes(a){if(this.program){const b=a.currentVertexBuffer.vertexByteSize;this.attributes.forEach(c=>{e.vertexAttribPointer(c.index,c.size,c.type,c.normalized,b,c.offset)})}}destroy(){Pa(this.program),Qa(this.texture),L(this.framebuffer),this.uniforms.clear(),this.uniformSetters.clear(),this.attributes.clear(),this.program=null,this.texture=null,this.framebuffer=null}}class aa extends Oc{constructor(a={}){const b=a;b.attributes=b.attributes?b.attributes:ba,super(b)}bind(a){const b=this.uniforms;return b.set("uProjectionMatrix",a.projectionMatrix.data),b.set("uCameraMatrix",a.cameraMatrix.data),super.bind(a)}}class Be extends aa{constructor(a={}){const b=a;b.attributes=b.attributes?b.attributes:ba,b.renderToFramebuffer=!0,super(b)}bind(a){const b=a.renderer;return this.uniforms.set("uTime",performance.now()),this.uniforms.set("uResolution",[b.width,b.height]),super.bind(a)}}const Gd=`#define SHADER_NAME MULTI_QUAD_FRAG

precision highp float;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

uniform sampler2D uTexture[%count%];

void main (void)
{
    vec4 color;

    %forloop%

    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);
}`;class Dc extends aa{constructor(a={}){a.fragmentShader||(a.fragmentShader=Gd),super(a)}create(a,b,c,d){const f=xa();let g="";for(let h=1;h<f;h++)h>1&&(g+=`
	else `),h<f-1&&(g+=`if (vTextureId < ${h}.5)`),g+=`
	{`,g+=`
		color = texture2D(uTexture[${h}], vTextureCoord);`,g+=`
	}`;a=a.replace(/%count%/gi,`${f}`),a=a.replace(/%forloop%/gi,g),super.create(a,b,c,d)}bind(a){return this.uniforms.set("uTexture",a.textureIndex),super.bind(a)}}function Ec(a,b,c,d){const f={enable:b,sfactor:c,dfactor:d};a.blendModeStack[0]=f,a.currentBlendMode=f,a.defaultBlendMode=f}function Fc(a,b=null,c){const d={framebuffer:b,viewport:c};a.framebufferStack[0]=d,a.currentFramebuffer=d,a.defaultFramebuffer=d}function Gc(a,b,c){const d={shader:b,textureID:c};a.shaderStack[0]=d,a.currentShader=d,a.defaultShader=d}function Hc(a,b){a.vertexBufferStack[0]=b,a.currentVertexBuffer=b,a.defaultVertexBuffer=b}function Ic(a,b=0,c=0,d=0,f=0){const g=new B(b,c,d,f);a.viewportStack[0]=g,a.currentViewport=g,a.defaultViewport=g}let ld,md=0,nd=0;const A={get:()=>ld,set:a=>{ld=a},getFrame:()=>md,setFrame:a=>{md=a},getElapsed:()=>nd,setElapsed:a=>{nd=a}};function ga(a=new v()){return a.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}class Q{constructor(a=1,b=0,c=0,d=1,f=0,g=0){this.set(a,b,c,d,f,g)}set(a=1,b=0,c=0,d=1,f=0,g=0){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=f,this.ty=g,this}identity(){return this.set()}toArray(){const{a,b,c,d,tx:f,ty:g}=this;return[a,b,c,d,f,g]}fromArray(a){return this.set(a[0],a[1],a[2],a[3],a[4],a[5])}}class J{constructor(a,b=0,c=0){this._x=b,this._y=c,this.onChange=a}destroy(){this.onChange=X}set(a=0,b=0){return this._x=a,this._y=b,this.onChange&&this.onChange(this),this}get x(){return this._x}set x(a){const b=this._x;this._x=a,b!==a&&this.onChange(this)}get y(){return this._y}set y(a){const b=this._y;this._y=a,b!==a&&this.onChange(this)}toArray(a=[],b=0){const{x:c,y:d}=this;return a[b]=c,a[b+1]=d,a}fromArray(a,b=0){return this.set(a[b],a[b+1])}toString(){const{x:a,y:b}=this;return`{ x=${a}, y=${b} }`}}const La={PI2:Math.PI*2,HALF_PI:Math.PI*.5,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};function fc(a,b,c){const d=c-b;return b+((a-b)%d+d)%d}function Gb(a){return fc(a,-Math.PI,Math.PI)}class Hb{constructor(){this._rotation=0,this.type="Camera",this.dirtyRender=!0;const a=A.get();this.renderer=a.renderer,this.matrix=ga(),this.bounds=new B(),this.worldTransform=new Q(),this.position=new J(()=>this.updateTransform(),0,0),this.scale=new J(()=>this.updateTransform(),1,1),this.origin=new J(()=>this.updateTransform(),.5,.5),this.reset()}updateTransform(){const a=this.matrix.data,b=this.position.x,c=this.position.y,d=this.scale.x,f=this.scale.y,g=-b+this.width*this.origin.x,h=-c+this.height*this.origin.y,i=Math.sin(this.rotation),k=Math.cos(this.rotation),j=i+i,o=i*j,l=k*j,u=(1-o)*d,n=l*d,t=-l*f,w=(1-o)*f;a[0]=u,a[1]=n,a[4]=t,a[5]=w,a[12]=b+g-(u*g+t*h),a[13]=c+h-(n*g+w*h),this.worldTransform.set(k*d,i*d,-i*f,k*f,-b,-c);const p=this.width*(1/d),y=this.height*(1/f);this.bounds.set(g-p/2,h-y/2,p,y),this.dirtyRender=!0}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}set rotation(a){a!==this._rotation&&(this._rotation=Gb(a),this.updateTransform())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.origin.destroy(),this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}class va{constructor(){this.type="StaticCamera",this.dirtyRender=!0;const a=A.get();this.renderer=a.renderer,this.matrix=ga(),this.bounds=new B(),this.worldTransform=new Q(),this.reset()}reset(){const a=this.renderer;if(a){const b=a.width,c=a.height;this.width=b,this.height=c}this.bounds.set(0,0,this.width,this.height)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}class kc{constructor(a){this.count=0,this.prevCount=0,this.flushTotal=0,this.maxTextures=0,this.currentActiveTexture=0,this.startActiveTexture=0,this.tempTextures=[],this.textureIndex=[],this.framebufferStack=[],this.currentFramebuffer=null,this.defaultFramebuffer=null,this.vertexBufferStack=[],this.currentVertexBuffer=null,this.defaultVertexBuffer=null,this.shaderStack=[],this.currentShader=null,this.defaultShader=null,this.viewportStack=[],this.currentViewport=null,this.defaultViewport=null,this.blendModeStack=[],this.currentBlendMode=null,this.defaultBlendMode=null,this.renderer=a,this.projectionMatrix=new v(),this.reset()}reset(){const a=this.renderer.gl,b=[0,1,2,2,3,0];this.quadShader=new aa(),this.quadBuffer=new nc({isDynamic:!1,indexLayout:b}),this.quadCamera=new va(),Ac(this),Fc(this),Ec(this,!0,a.ONE,a.ONE_MINUS_SRC_ALPHA),Hc(this,new nc({batchSize:od(),indexLayout:b})),Gc(this,new Dc())}resize(a,b){gc(0,a,b,0,-1e3,1e3,this.projectionMatrix),this.quadCamera.reset(),Ic(this,0,0,a,b)}}function uc(a,b,c){const d={shader:b,textureID:c};return a.shaderStack.push(d),d}function vc(a,b){return a.vertexBufferStack.push(b),b}function Y(a,b){b||(b=a.currentShader);const c=b.shader.bind(a,b.textureID);c&&b.shader.setAttributes(a)}function xc(a,b){a.current2DCamera=b,a.cameraMatrix=b.matrix,Y(a)}function Oa(a,b){b||(b=a.currentBlendMode),b.enable?(e.enable(e.BLEND),e.blendFunc(b.sfactor,b.dfactor)):e.disable(e.BLEND)}function pc(a,b=0){const c=a.binding;c.setIndex(b),e.activeTexture(e.TEXTURE0+b),e.bindTexture(e.TEXTURE_2D,c.texture)}function _(a,b){b||(b=a.currentVertexBuffer);const c=b.indexed?b.indexBuffer:null;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,c),e.bindBuffer(e.ARRAY_BUFFER,b.vertexBuffer)}function mb(a){const b=a.vertexBufferStack;b.length>1&&b.pop(),a.currentVertexBuffer=b[b.length-1],_(a)}function nb(a,b){const c=vc(a,b);_(a,c),a.currentVertexBuffer=c}function Na(a,b=0){const c=a.currentVertexBuffer;a.count+b>=c.batchSize&&C(a);const d=c.indexed?a.count*c.entryElementSize:a.count*c.vertexElementSize;return a.count+=b,{buffer:c,F32:c.vertexViewF32,U32:c.vertexViewU32,offset:d}}function qc(a){const b=a.shaderStack;b.length>1&&b.pop(),a.currentShader=b[b.length-1],Y(a)}function rc(a,b,c){const d=uc(a,b,c);Y(a,d),a.currentShader=d}function oc(a,b){const c=b.binding,d=a.currentActiveTexture;return c.indexCounter<a.startActiveTexture&&(c.indexCounter=a.startActiveTexture,d<a.maxTextures?(c.setIndex(d),e.activeTexture(e.TEXTURE0+d),e.bindTexture(e.TEXTURE_2D,c.texture),a.currentActiveTexture++):(C(a),a.startActiveTexture++,c.indexCounter=a.startActiveTexture,c.setIndex(1),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,c.texture),a.currentActiveTexture=2)),c.index}function lc(a){a.current2DCamera=a.quadCamera,a.cameraMatrix=a.quadCamera.matrix,a.count=0,a.flushTotal=0,Z(a,!1,a.defaultFramebuffer),Oa(a,a.defaultBlendMode),$(a,a.defaultViewport),_(a,a.defaultVertexBuffer)}function sc(a,b=0){e.activeTexture(e.TEXTURE0+b),e.bindTexture(e.TEXTURE_2D,a.tempTextures[b]),b>0&&a.startActiveTexture++}let Cd;const mc={get:()=>Cd,set:a=>{Cd=a}};class pd{constructor(){this.clearColor=[0,0,0,1],this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.width=O(),this.height=M(),this.resolution=N(),this.setBackgroundColor(Jb());const a=document.createElement("canvas");a.addEventListener("webglcontextlost",b=>this.onContextLost(b),!1),a.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=a,this.initContext(),mc.set(this),this.renderPass=new kc(this),this.resize(this.width,this.height,this.resolution)}initContext(){const a=this.canvas.getContext("webgl",qd());zd.set(a),this.gl=a,a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE)}resize(a,b,c=1){const d=a*c,f=b*c;this.width=d,this.height=f,this.resolution=c;const g=this.canvas;g.width=d,g.height=f,this.autoResize&&(g.style.width=a.toString()+"px",g.style.height=b.toString()+"px"),this.renderPass.resize(d,f)}onContextLost(a){a.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(a){return Bd(a,this.clearColor),this}reset(){}render(a){if(this.contextLost)return;const b=this.gl,c=this.renderPass;jc();if(this.optimizeRedraw&&a.numDirtyFrames===0&&a.numDirtyCameras===0)return;if(this.clearBeforeRender){const f=this.clearColor;b.clearColor(f[0],f[1],f[2],f[3]),b.clear(b.COLOR_BUFFER_BIT)}const d=a.worldData;lc(c);for(let f=0;f<d.length;f++){const{world:g}=d[f];g.renderGL(c),g.postRenderGL(c)}ic(c)}destroy(){mc.set(void 0)}}function xb(){return()=>{ab(pd)}}function zb(a,b){const c=ya(b);return c.appendChild(a),a}function Ab(a){const b=document.readyState;if(b==="complete"||b==="interactive"){a();return}const c=()=>{document.removeEventListener("deviceready",c,!0),document.removeEventListener("DOMContentLoaded",c,!0),window.removeEventListener("load",c,!0),a()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",c,!0):(document.addEventListener("DOMContentLoaded",c,!0),window.addEventListener("load",c,!0)):window.setTimeout(c,20)}function z(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);for(const f of d)f.callback.apply(f.context,c),f.once&&d.delete(f);return d.size===0&&a.events.delete(b),!0}class Bb{constructor(){this.events=new Map()}}class Ba{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function Ca(a,b,c,d,f){const g=a.events,h=g.get(b);if(!c)g.delete(b);else if(c instanceof Ba)h.delete(c);else{const i=!d,k=f!==void 0;for(const j of h)j.callback===c&&(i&&j.context===d)&&(k&&j.once===f)&&h.delete(j)}return h.size===0&&g.delete(b),a}function T(a,b,c,d=a,f=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const g=new Ba(c,d,f),h=a.events.get(b);return h?h.add(g):a.events.set(b,new Set([g])),g}function Da(a,b,c,d=a){return T(a,b,c,d,!0)}function Cb(){const{title:a,version:b,url:c,color:d,background:f}=r.get(s.BANNER);if(a!==""){const g=b!==""?a+" "+b:a;console.log(`%c${g}%c ${c}`,`padding: 4px 16px; color: ${d}; background: ${f}`,"")}}function Db(){return r.get(s.GLOBAL_VAR)}function Eb(){return r.get(s.PARENT)}function Fb(){return r.get(s.RENDERER)}function Ld(){return{gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]}}function Nb(){return r.get(s.SCENES)}function Od(a,b=0){a.gameFrame=b,a.numTotalFrames=0,a.numDirtyFrames=0,a.numDirtyCameras=0,a.worldData.length=0}let Pd;const qb={get:()=>Pd,set:a=>{Pd=a}};class id{constructor(){this.scenes=new Map(),this.sceneIndex=0,this.flush=!1,this.renderResult=Ld(),this.game=A.get(),qb.set(this),Da(this.game,"boot",()=>this.boot())}boot(){Nb().forEach(a=>new a())}update(a,b){for(const c of this.scenes.values())z(c,"update",a,b)}render(a){const b=this.renderResult;Od(b,a);for(const c of this.scenes.values())z(c,"render",b);return this.flush&&(b.numDirtyFrames++,this.flush=!1),b}}function jd(){Za(0),Ib(4096),_a("Phaser","4.0.0","https://phaser4.io"),ha(0),$a(.5,.5),wa(800,600,1)}function na(a,b){const c=document.createElement("canvas");return c.width=a,c.height=b,c.getContext("2d")}let Qd;const E={get:()=>Qd,set:a=>{Qd=a}};class kd{constructor(){this.textures=new Map(),this.createDefaultTextures(),E.set(this)}createDefaultTextures(){this.add("__BLANK",new D(na(32,32).canvas));const a=na(32,32);a.strokeStyle="#0f0",a.moveTo(0,0),a.lineTo(32,32),a.stroke(),a.strokeRect(.5,.5,31,31),this.add("__MISSING",new D(a.canvas));const b=na(32,32);b.fillStyle="#fff",b.fillRect(0,0,32,32),this.add("__WHITE",new D(b.canvas))}get(a){const b=this.textures;return b.has(a)?b.get(a):b.get("__MISSING")}has(a){return this.textures.has(a)}add(a,b,c){let d;const f=this.textures;return f.has(a)||(b instanceof D?d=b:d=new D(b,0,0,c),d.key=a,f.set(a,d)),d}}class gd extends Bb{constructor(...a){super();this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,A.set(this),jd(),Ab(()=>this.boot(a))}boot(a){a.forEach(f=>f());const b=Fb();this.renderer=new b(),this.textureManager=new kd(),this.sceneManager=new id();const c=Eb();c&&zb(this.renderer.canvas,c);const d=Db();d&&window&&(window[d]=this),this.isBooted=!0,Cb(),z(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(a){const b=a-this.lastTick;this.lastTick=a,this.elapsed+=b,this.isPaused||(this.willUpdate&&(this.sceneManager.update(b,a),z(this,"update",b,a)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,A.setFrame(this.frame),A.setElapsed(this.elapsed),requestAnimationFrame(c=>this.step(c))}destroy(){}}function Md(a,b,c){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:c}function Nd(a,b={}){const c=qb.get(),d=c.scenes.size,f=c.sceneIndex,g=d===0;typeof b==="string"?a.key=b:(b||!b&&g)&&(a.key=Md(b,"key","scene"+f.toString())),c.scenes.has(a.key)?console.warn("Scene key already in use: "+a.key):(c.scenes.set(a.key,a),c.flush=!0,c.sceneIndex++)}class hd{constructor(a){this.game=A.get(),this.events=new Map(),Nd(this,a)}}function S(a){const b=[a],c=[];for(;b.length>0;){const d=b.shift();c.push(d);const f=d.numChildren;if(f>0)for(let g=f-1;g>=0;g--)b.unshift(d.children[g])}return c.shift(),c}function K(a,b){return a.children.indexOf(b)}function bb(a,b){const c=a.children;let d;if(b>=0&&b<c.length){const f=c.splice(b,1);f[0]&&(d=f[0],d.parent=null)}return d}function Aa(a,b){const c=K(a,b);return c>-1&&bb(a,c),b}const cb="addedtoworld";const Ea="destroy";const bc="postupdate";const db="removedfromworld";const cc="update";function Tb(a,...b){return b.forEach(c=>{c.world&&(z(c.world,db,c,c.world),z(c,db,c,c.world)),c.world=a,z(a,cb,c,a),z(c,cb,c,a)}),b}function R(a,...b){b.forEach(d=>{d.parent&&Aa(d.parent,d),d.parent=a});const c=a.world;return c&&Tb(c,...S(a)),b}function ra(a,b){return a.children.push(b),R(a,b),b.transform.updateWorld(),b}const q={CLEAR:0,TRANSFORM:1,UPDATE:2,CHILD_CACHE:4,POST_RENDER:8,COLORS:16,BOUNDS:32,TEXTURE:64,FRAME:128,ALPHA:256,CHILD:512,DEFAULT:1+2+16+32,USER1:536870912,USER2:1073741824,USER3:2147483648,USER4:4294967296};function za(a,b=0,c){const d=a.children;c===void 0&&(c=d.length);const f=c-b;if(f>0&&f<=c){const g=d.splice(b,f);return g.forEach(h=>{h.parent=null}),g}else return[]}function Pb(a,b=0,c){const d=za(a,b,c);d.forEach(f=>{f.destroy()})}function Rb(a,...b){return b.forEach(c=>{Aa(a,c)}),b}function Sb(a,b,c=0,d){const f=za(a,c,d);return R(b,...f),f.forEach(g=>{g.transform.updateWorld()}),f}const Tc="worldrender";const Uc="worldshutdown";function rb(a,b){b.numRendered++,b.numRenderable++,a.node.dirtyFrame>=b.gameFrame&&b.dirtyFrame++,a.children.forEach(c=>{c.children.length>0&&rb(c,b)})}function Wc(a){if(a.node.isDirty(q.CHILD_CACHE))return!0;const b=[a];for(;b.length>0;){const c=b.pop();if(c.node.isDirty(q.TRANSFORM))return!0;const d=c.children.length;if(d>0)for(let f=0;f<d;f++)b.push(c.children[f])}return b.length=0,!1}function Vc(a,b){a.forEach(c=>{b||Wc(c)?c.node.setDirty(q.CHILD_CACHE):c.children.length=0})}function sb(a,b,c=[]){for(let d=0;d<b.numChildren;d++){const f=b.children[d];if(f.isRenderable()){const g=[],h={node:f,children:g};c.push(h),f.willRenderChildren&&f.numChildren>0&&(f.willCacheChildren&&a.push(h),sb(a,f,g))}}return c}function Rc(a){const b=[],c=[],d=sb(b,a,c),f=a.renderData;b.length>0&&Vc(b,a.camera.dirtyRender),d.forEach(g=>{g.children.length>0?rb(g,f):(f.numRendered++,f.numRenderable++,g.node.dirtyFrame>=f.gameFrame&&f.dirtyFrame++)}),a.renderList=d,a.forceRefresh&&(f.dirtyFrame++,a.forceRefresh=!1)}function Fa(a){const{a:b,b:c,c:d,d:f,tx:g,ty:h}=a.world,{x:i,y:k,right:j,bottom:o}=a.extent,l=i*b+k*d+g,u=i*c+k*f+h,n=i*b+o*d+g,t=i*c+o*f+h,w=j*b+o*d+g,p=j*c+o*f+h,y=j*b+k*d+g,F=j*c+k*f+h;return{x0:l,y0:u,x1:n,y1:t,x2:w,y2:p,x3:y,y3:F}}class Ub{constructor(a){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=a,this.area=new B()}set(a,b,c,d){this.area.set(a,b,c,d)}get(){return this.entity.isDirty(q.BOUNDS)&&!this.fixed&&this.update(),this.area}updateLocal(){const{x0:a,y0:b,x1:c,y1:d,x2:f,y2:g,x3:h,y3:i}=Fa(this.entity.transform),k=Math.min(a,c,f,h),j=Math.min(b,d,g,i),o=Math.max(a,c,f,h),l=Math.max(b,d,g,i);return this.area.set(k,j,o-k,l-j)}update(){const a=this.updateLocal();this.entity.clearDirty(q.BOUNDS);if(!this.includeChildren||!this.entity.numChildren)return a;const b=this.visibleOnly,c=this.entity.children;let d=a.x,f=a.y,g=a.right,h=a.bottom;for(let i=0;i<c.length;i++){const k=c[i];if(!k||b&&!k.visible)continue;const j=k.bounds.get();j.x<d&&(d=j.x),j.y<f&&(f=j.y),j.right>g&&(g=j.right),j.bottom>h&&(h=j.bottom)}return a.set(d,f,g-d,h-f)}destroy(){this.entity=null,this.area=null}}class Vb{constructor(a){this.enabled=!1,this.enabledChildren=!0,this.entity=a}destroy(){this.entity=null,this.hitArea=null}}function fb(a,b,c,d,f,g,h=0,i=1,k=1,j=0,o=0){const l=Math.cos(h+o)*i,u=Math.sin(h+o)*i,n=-Math.sin(h-j)*k,t=Math.cos(h-j)*k,w=a*l+c*n+f,p=a*u+c*t+g,y=a*l+d*n+f,F=a*u+d*t+g,oa=b*l+d*n+f,pa=b*u+d*t+g,da=b*l+c*n+f,ea=b*u+c*t+g;return{x0:w,y0:p,x1:y,y1:F,x2:oa,y2:pa,x3:da,y3:ea}}function rd(a){a.forEach(b=>{b.packColor()})}function Xb(a){const b=a.vertices,{x0:c,y0:d,x1:f,y1:g,x2:h,y2:i,x3:k,y3:j}=Fa(a.transform);return b[0].setPosition(c,d),b[1].setPosition(f,g),b[2].setPosition(h,i),b[3].setPosition(k,j),a}function V(a){return a.isDirty(q.COLORS)&&(rd(a.vertices),a.clearDirty(q.COLORS)),a.isDirty(q.TRANSFORM)&&(Xb(a),a.clearDirty(q.TRANSFORM)),a}function Kb(){return r.get(s.DEFAULT_ORIGIN).x}function Lb(){return r.get(s.DEFAULT_ORIGIN).y}class m{constructor(a=0,b=0){this.set(a,b)}set(a=0,b=0){return this.x=a,this.y=b,this}toArray(a=[],b=0){const{x:c,y:d}=this;return a[b]=c,a[b+1]=d,a}fromArray(a,b=0){return this.set(a[b],a[b+1])}toString(){const{x:a,y:b}=this;return`{ x=${a}, y=${b} }`}}function jb(a,b,c){return Math.max(b,Math.min(c,a))}function $b(a,b=new m()){return b.set(a.width,a.height)}function Yb(a){const b=a.local,c=a.position.x,d=a.position.y,f=a.rotation,g=a.scale.x,h=a.scale.y,i=a.skew.x,k=a.skew.y;b.set(Math.cos(f+k)*g,Math.sin(f+k)*g,-Math.sin(f-i)*h,Math.cos(f-i)*h,c,d)}function _b(a,b){const{a:c,b:d,c:f,d:g,tx:h,ty:i}=a;return b.set(c,d,f,g,h,i)}function Zb(a){const b=a.parent,c=a.transform,d=c.local,f=c.world;if(!b)_b(d,f);else if(c.passthru)_b(b.transform.world,f);else{const{a:g,b:h,c:i,d:k,tx:j,ty:o}=d,{a:l,b:u,c:n,d:t,tx:w,ty:p}=b.transform.world;f.set(g*l+h*n,g*u+h*t,i*l+k*n,i*u+k*t,j*l+o*n+w,j*u+o*t+p)}}class Wb{constructor(a,b=0,c=0){this.passthru=!1,this._rotation=0,this.entity=a,this.local=new Q(),this.world=new Q();const d=()=>this.update(),f=()=>this.updateExtent();this.position=new J(d,b,c),this.scale=new J(d,1,1),this.skew=new J(d),this.origin=new J(f,Kb(),Lb()),this.extent=new B()}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(q.TRANSFORM,q.BOUNDS),Yb(this)}updateWorld(){const a=this.entity;a.setDirty(q.TRANSFORM,q.BOUNDS),Zb(a),a.numChildren&&this.updateChildren()}updateChildren(){const a=this.entity.children;for(let b=0;b<a.length;b++){const c=a[b];c.transform.updateWorld()}}globalToLocal(a,b,c=new m()){const{a:d,b:f,c:g,d:h,tx:i,ty:k}=this.world,j=1/(d*h+g*-f);return c.x=h*j*a+-g*j*b+(k*g-i*h)*j,c.y=d*j*b+-f*j*a+(-k*d+i*f)*j,c}localToGlobal(a,b,c=new m()){const{a:d,b:f,c:g,d:h,tx:i,ty:k}=this.world;return c.x=d*a+g*b+i,c.y=f*a+h*b+k,c}setExtent(a,b,c,d){this.extent.set(a,b,c,d),this.entity.setDirty(q.TRANSFORM,q.BOUNDS)}updateExtent(a,b){const c=this.extent,d=this.entity;a!==void 0&&(c.width=a),b!==void 0&&(c.height=b),c.x=-this.origin.x*c.width,c.y=-this.origin.y*c.height,d.setDirty(q.TRANSFORM,q.BOUNDS)}set rotation(a){a!==this._rotation&&(this._rotation=a,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}}function eb(a,b){const c=(b*255|0)&255;return(c<<24|a)>>>0}class H{constructor(a=0,b=0,c=0){this.x=0,this.y=0,this.z=0,this.u=0,this.v=0,this.texture=0,this.tint=16777215,this.alpha=1,this.color=4294967295,this.x=a,this.y=b,this.z=c}setPosition(a,b,c=0){return this.x=a,this.y=b,this.z=c,this}setUV(a,b){return this.u=a,this.v=b,this}setColor(a,b=1){return this.tint=a,this.alpha=b,this.packColor(),this}setAlpha(a){return this.alpha=a,this}setTint(a){return this.tint=a,this}packColor(){this.color=eb(this.tint,this.alpha)}}function gb(a,b,c){const{F32:d,U32:f,offset:g}=Na(c,1),h=oc(c,a);let i=g;b.forEach(k=>{d[i+0]=k.x,d[i+1]=k.y,d[i+2]=k.u,d[i+3]=k.v,d[i+4]=h,f[i+5]=k.color,i+=6})}class U{constructor(a=0,b=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.vertices=[],this.events=new Map(),this.transform=new Wb(this,a,b),this.bounds=new Ub(this),this.input=new Vb(this),this.dirty=q.DEFAULT,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(a){return(this.dirty&a)!==0}clearDirty(a){return this.isDirty(a)&&(this.dirty^=a),this}setDirty(a,b){return this.isDirty(a)||(this.dirty^=a,this.dirtyFrame=A.getFrame()),this.isDirty(b)||(this.dirty^=b),this}update(a,b){if(this.willUpdateChildren){const c=this.children;for(let d=0;d<c.length;d++){const f=c[d];f&&f.willUpdate&&f.update(a,b)}}this.postUpdate(a,b)}postUpdate(a,b){}renderGL(a){}renderCanvas(a){}postRenderGL(a){}postRenderCanvas(a){}get numChildren(){return this.children.length}getBounds(){return this.bounds.get()}destroy(a){a?Sb(this,a):Pb(this),z(this,Ea,this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null,this.vertices=[]}}class Ga extends U{constructor(a=0,b=0){super(a,b);this._alpha=1,this.type="Container"}setSize(a,b=a){return this.transform.updateExtent(a,b),this}getSize(a=new m()){return $b(this.transform.extent,a)}setPosition(a,b){return this.transform.position.set(a,b),this}getPosition(a=new m()){const b=this.transform.position;return a.set(b.x,b.y)}setOrigin(a,b=a){return this.transform.origin.set(a,b),this}getOrigin(a=new m()){const b=this.transform.origin;return a.set(b.x,b.y)}setSkew(a,b=a){return this.transform.skew.set(a,b),this}getSkew(a=new m()){const b=this.transform.skew;return a.set(b.x,b.y)}setScale(a,b=a){return this.transform.scale.set(a,b),this}getScale(a=new m()){const b=this.transform.scale;return a.set(b.x,b.y)}setRotation(a){return this.transform.rotation=a,this}getRotation(){return this.transform.rotation}set width(a){this.transform.updateExtent(a)}get width(){return this.transform.extent.width}set height(a){this.transform.updateExtent(void 0,a)}get height(){return this.transform.extent.height}set x(a){this.transform.position.x=a}get x(){return this.transform.position.x}set y(a){this.transform.position.y=a}get y(){return this.transform.position.y}set originX(a){this.transform.origin.x=a}get originX(){return this.transform.origin.x}set originY(a){this.transform.origin.y=a}get originY(){return this.transform.origin.y}set skewX(a){this.transform.skew.x=a}get skewX(){return this.transform.skew.x}set skewY(a){this.transform.skew.y=a}get skewY(){return this.transform.skew.y}set scaleX(a){this.transform.scale.x=a}get scaleX(){return this.transform.scale.x}set scaleY(a){this.transform.scale.y=a}get scaleY(){return this.transform.scale.y}set rotation(a){this.transform.rotation=a}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(a){a!==this._alpha&&(this._alpha=a,this.vertices.forEach(b=>{b.setAlpha(a)}),this.setDirty(q.COLORS))}}function hb(a,b,c,d){if(!a)return;const f=d.ctx,{a:g,b:h,c:i,d:k,tx:j,ty:o}=c.world,{x:l,y:u}=c.extent;f.save(),f.setTransform(g,h,i,k,j,o),f.globalAlpha=b,f.drawImage(a.texture.image,a.x,a.y,a.width,a.height,l,u,a.width,a.height),f.restore()}function Ia(a,b,...c){const d=a.getFrame(b),f=d.pivot;return c.forEach(g=>{if(!g||d===g.frame)return;g.frame=d,g.hasTexture=!0,f&&g.setOrigin(f.x,f.y),d.copyToExtent(g),d.copyToVertices(g.vertices)}),c}function dc(a,b,...c){if(!a)c.forEach(d=>{d.texture=null,d.frame=null,d.hasTexture=!1});else{let d;a instanceof D?d=a:d=E.get().get(a),d?(c.forEach(f=>{f.texture=d}),Ia(d,b,...c)):console.warn(`Invalid Texture key: ${a}`)}return c}class I extends Ga{constructor(a,b,c,d){super(a,b);this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertices=[new H(),new H(),new H(),new H()],this.setTexture(c,d)}setTexture(a,b){return dc(a,b,this),this}setFrame(a){return Ia(this.texture,a,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}renderGL(a){V(this),gb(this.texture,this.vertices,a)}renderCanvas(a){V(this),hb(this.frame,this.alpha,this.transform,a)}get tint(){return this._tint}set tint(a){a!==this._tint&&(this._tint=a,this.vertices.forEach(b=>{b.setTint(a)}),this.setDirty(q.COLORS))}destroy(a){super.destroy(a),this.texture=null,this.frame=null,this.hasTexture=!1}}class ce extends I{constructor(a,b,c,d){super(a,b,c,d);this.type="AnimatedSprite",this.anims=new Map(),this.animData={currentAnim:"",currentFrames:[],frameIndex:0,animSpeed:0,nextFrameTime:0,repeatCount:0,isPlaying:!1,yoyo:!1,pendingStart:!1,playingForward:!0,delay:0,repeatDelay:0,onStart:null,onRepeat:null,onComplete:null}}stop(){const a=this.animData;a.isPlaying=!1,a.currentAnim="",a.onComplete&&a.onComplete(this,a.currentAnim)}nextFrame(){const a=this.animData;a.frameIndex++;if(a.frameIndex===a.currentFrames.length)if(a.yoyo)a.frameIndex--,a.playingForward=!1;else if(a.repeatCount===-1||a.repeatCount>0)a.frameIndex=0,a.repeatCount!==-1&&a.repeatCount--,a.onRepeat&&a.onRepeat(this,a.currentAnim),a.nextFrameTime+=a.repeatDelay;else return a.frameIndex--,this.stop();this.setFrame(a.currentFrames[a.frameIndex]),a.nextFrameTime+=a.animSpeed}prevFrame(){const a=this.animData;a.frameIndex--;if(a.frameIndex===-1)if(a.repeatCount===-1||a.repeatCount>0)a.frameIndex=0,a.playingForward=!0,a.repeatCount!==-1&&a.repeatCount--,a.onRepeat&&a.onRepeat(this,a.currentAnim),a.nextFrameTime+=a.repeatDelay;else return a.frameIndex=0,this.stop();this.setFrame(a.currentFrames[a.frameIndex]),a.nextFrameTime+=a.animSpeed}update(a,b){super.update(a,b);const c=this.animData;if(!c.isPlaying)return;c.nextFrameTime-=a*1e3,c.nextFrameTime=Math.max(c.nextFrameTime,0),c.nextFrameTime===0&&(c.pendingStart?(c.onStart&&c.onStart(this,c.currentAnim),c.pendingStart=!1,c.nextFrameTime=c.animSpeed):c.playingForward?this.nextFrame():this.prevFrame())}get isPlaying(){return this.animData.isPlaying}get isPlayingForward(){return this.animData.isPlaying&&this.animData.playingForward}get currentAnimation(){return this.animData.currentAnim}destroy(a){super.destroy(a),this.anims.clear(),this.animData=null}}function Ed(a,b,c,d,f,g,h,i,k,j=0,o=4294967295){const{F32:l,U32:u,offset:n}=Na(a,1);l[n+0]=b,l[n+1]=c,l[n+2]=g,l[n+3]=k,l[n+4]=j,u[n+5]=o,l[n+6]=b,l[n+7]=c+f,l[n+8]=g,l[n+9]=h,l[n+10]=j,u[n+11]=o,l[n+12]=b+d,l[n+13]=c+f,l[n+14]=i,l[n+15]=h,l[n+16]=j,u[n+17]=o,l[n+18]=b+d,l[n+19]=c,l[n+20]=i,l[n+21]=k,l[n+22]=j,u[n+23]=o}function ia(a,b,c){c||(c=a.quadShader);const{u0:d,v0:f,u1:g,v1:h}=b.firstFrame;pc(b,0),nb(a,a.quadBuffer),rc(a,c,0),Ed(a,0,0,b.width,b.height,d,f,g,h,0),C(a),mb(a),qc(a),sc(a)}class Ha extends U{constructor(){super();this.type="Layer",this.transform.passthru=!0,this.willRender=!1}}class ac extends Ha{constructor(){super();this.type="RenderLayer",this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!0,this.setDirty(q.CHILD_CACHE);const a=O(),b=M(),c=N(),d=new D(null,a*c,b*c),f=new ka(d);d.binding=f,f.framebuffer=ib(f.texture),this.texture=d,this.framebuffer=f.framebuffer}renderGL(a){this.numChildren>0&&(C(a),!this.willCacheChildren||this.isDirty(q.CHILD_CACHE)?(ja(a,this.framebuffer,!0),this.clearDirty(q.CHILD_CACHE)):(ja(a,this.framebuffer,!1),this.postRenderGL(a)))}postRenderGL(a){C(a),W(a),ia(a,this.texture),this.clearDirty(q.TRANSFORM)}}class he extends ac{constructor(...a){super();this.shaders=[],this.type="EffectLayer",Array.isArray(a)&&(this.shaders=a)}postRenderGL(a){const b=this.shaders,c=this.texture;C(a),W(a);if(b.length===0)ia(a,c);else{let d=c;for(let f=0;f<b.length;f++){const g=b[f];ia(a,d,g),d=g.texture}ia(a,d)}this.clearDirty(q.TRANSFORM)}}class ie extends Ga{constructor(a,b,c=64,d=64,f=16777215){super(a,b);this._color=16777215,this.type="Rectangle",this.vertices=[new H(),new H(),new H(),new H()],this.color=f,this.setWhiteTexture(),this.setSize(c,d)}setWhiteTexture(){this.texture=E.get().get("__WHITE"),this.frame=this.texture.getFrame(),this.frame.copyToExtent(this),this.frame.copyToVertices(this.vertices)}setColor(a){return this.color=a,this}isRenderable(){return this.visible&&this.willRender&&this.alpha>0}renderGL(a){V(this),gb(this.texture,this.vertices,a)}renderCanvas(a){V(this),hb(this.frame,this.alpha,this.transform,a)}get color(){return this._color}set color(a){a!==this._color&&(this._color=a,this.vertices.forEach(b=>{b.setTint(a)}),this.setDirty(q.COLORS))}destroy(a){super.destroy(a),this.texture=null,this.frame=null}}function sd(a,b){}class je extends Ha{constructor(a,b){super();this.glTextureIndex=0,this.hasTexture=!1,this.type="SpriteBatch",this.willRender=!0,this.setTexture(b),this.setMaxSize(a)}resetBuffers(){let a=[];for(let b=0;b<this.maxSize*4;b+=4)a.push(b+0,b+1,b+2,b+2,b+3,b+0);this.data=new ArrayBuffer(this.maxSize*96),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data),e&&(L(this.vertexBuffer),L(this.indexBuffer),this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.data,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.index,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null)),a=[],this.count=0}setMaxSize(a){return this.maxSize=jb(a,0,65535),this.resetBuffers(),this}setTexture(a){let b;return a instanceof D?b=a:b=E.get().get(a),b?(this.texture=b,this.hasTexture=!0,this.glTextureIndex=-1):console.warn(`Invalid Texture key: ${a}`),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.count>0}clear(){return this.count=0,this}addToBatch(a,b,c,d,f,g,h,i,k,j){if(this.count>=this.maxSize)return console.warn("SpriteBatch full"),this;const{u0:o,u1:l,v0:u,v1:n}=a,t=this.vertexViewF32,w=this.vertexViewU32,p=this.count*24,y=this.texture.binding?this.texture.binding.index:0;return t[p+0]=c,t[p+1]=d,t[p+2]=o,t[p+3]=u,t[p+4]=y,w[p+5]=b,t[p+6]=f,t[p+7]=g,t[p+8]=o,t[p+9]=n,t[p+10]=y,w[p+11]=b,t[p+12]=h,t[p+13]=i,t[p+14]=l,t[p+15]=n,t[p+16]=y,w[p+17]=b,t[p+18]=k,t[p+19]=j,t[p+20]=l,t[p+21]=u,t[p+22]=y,w[p+23]=b,this.setDirty(q.TRANSFORM),this.count++,this}add(a){const{frame:b=null,x:c=0,y:d=0,rotation:f=0,scaleX:g=1,scaleY:h=1,skewX:i=0,skewY:k=0,originX:j=0,originY:o=0,alpha:l=1,tint:u=16777215}=a,n=this.texture.getFrame(b),{left:t,right:w,top:p,bottom:y}=n.getExtent(j,o),{x0:F,y0:oa,x1:pa,y1:da,x2:ea,y2:cd,x3:dd,y3:ed}=fb(t,w,p,y,c,d,f,g,h,i,k),x=eb(u,l);return this.addToBatch(n,x,F,oa,pa,da,ea,cd,dd,ed)}addXY(a,b,c){const d=this.texture.getFrame(c),{left:f,right:g,top:h,bottom:i}=d.getExtent(0,0),{x0:k,y0:j,x1:o,y1:l,x2:u,y2:n,x3:t,y3:w}=fb(f,g,h,i,a,b);return this.addToBatch(d,4294967295,k,j,o,l,u,n,t,w)}updateTextureIndex(){const a=this.texture.binding.index;if(a===this.glTextureIndex)return;const b=this.vertexViewF32;this.glTextureIndex=a;for(let c=0;c<this.count;c++)b[c*24+4]=a,b[c*24+10]=a,b[c*24+16]=a,b[c*24+22]=a}renderGL(a){sd(this,a)}destroy(){super.destroy(),L(this.vertexBuffer),L(this.indexBuffer),this.data=null,this.vertexViewF32=null,this.vertexViewU32=null,this.index=null,this.texture=null,this.hasTexture=!1}}function la(a=32,b=32){const c=na(a,b);return new D(c.canvas)}class ke extends I{constructor(a,b,c="",d,f){super(a,b,la());this.splitRegExp=/(?:\r\n|\r|\n)/,this.padding={left:0,right:0,top:0,bottom:0},this.verticalAlign="ascent",this.lineSpacing=0,this.font="16px monospace",this.fillStyle="#fff",this.strokeStyle="",this.backgroundStyle="",this.cornerRadius=0,this.textAlign="left",this.textBaseline="alphabetic",this.lineWidth=0,this.lineDash=[],this.antialias=!1,this.type="Text";const g=A.get();this.resolution=g.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),d&&(this.font=d),f&&(this.fillStyle=f),this.setText(c)}syncContext(a,b){this.preRenderCallback&&this.preRenderCallback(a,b),b.font=this.font,b.textBaseline=this.textBaseline,b.textAlign=this.textAlign,b.fillStyle=this.fillStyle,b.strokeStyle=this.strokeStyle,b.lineWidth=this.lineWidth,b.lineCap="round",b.lineJoin="round",b.setLineDash(this.lineDash),b.imageSmoothingEnabled=this.antialias}updateText(){const a=this.canvas,b=this.context,c=this.resolution,d=this._text.split(this.splitRegExp),f=this.padding,g=this.fillStyle,h=this.strokeStyle,i=this.lineWidth,k=this.lineSpacing,j=i>0?i/2:0;b.clearRect(0,0,a.width,a.height),this.syncContext(a,b),b.textAlign="start";let o=0,l=0,u=0;const n=[],t=this.verticalAlign==="ascent",w=b.measureText("|Mq"),p=Math.ceil(Math.abs(w.actualBoundingBoxAscent)+Math.abs(w.actualBoundingBoxDescent))+i;for(let x=0;x<d.length;x++){const G=b.measureText(d[x]),Va=G.actualBoundingBoxLeft,fa=G.actualBoundingBoxRight;let P=G.actualBoundingBoxAscent,qa=G.actualBoundingBoxDescent;(!P&&!qa||d[x]==="")&&(P=p,qa=0);const Vd=Math.ceil(Math.abs(Va)+Math.abs(fa))+i,fd=Math.ceil(Math.abs(P)+Math.abs(qa))+i;t?(u+=P+j,x>0&&(u+=k+j),l=u+qa+j):(u=l+(fd-qa-j),l+=fd,x<d.length-1&&(l+=k)),o=Math.max(o,Vd),n.push({lineWidth:Vd,lineHeight:fd,ascent:P,descent:qa,left:Va,right:fa,y:u})}o+=f.left+f.right,l+=f.top+f.bottom;const y=this.fixedWidth?this.fixedWidth:o,F=this.fixedHeight?this.fixedHeight:l,oa=Math.ceil(y*c),pa=Math.ceil(F*c);(a.width!==oa||a.height!==pa)&&(a.width=oa,a.height=pa,this.texture.setSize(y,F),this.setSize(y,F)),b.save(),b.scale(c,c),this.syncContext(a,b);const da=this.backgroundStyle;if(da){b.save(),b.fillStyle=da,b.strokeStyle=da;const x=this.cornerRadius,G=x>0?x/2:0;x&&(b.lineWidth=x,b.strokeRect(G,G,y-x,F-x)),b.fillRect(G,G,y-x,F-x),b.restore()}const ea=this.textAlign,cd=ea==="center",dd=ea==="right"||ea==="end",ed=(F-l)/2+f.top;for(let x=0;x<d.length;x++){const G=d[x],Va=n[x];let fa=f.left+Va.left+j;const P=ed+Va.y;cd?fa=y/2:dd&&(fa=y-j),h&&b.strokeText(G,fa,P),g&&b.fillText(G,fa,P)}return b.restore(),this.texture.binding&&this.texture.binding.update(),this.setDirty(q.TEXTURE),this}get text(){return this._text}set text(a){this.setText(a)}setText(a=""){return Array.isArray(a)&&(a=a.join(`
`)),a!==this._text&&(this._text=a.toString(),this.updateText()),this}destroy(a){this.texture.destroy(),this.fillStyle=null,this.strokeStyle=null,this.backgroundStyle=null,this.canvas=null,this.context=null,super.destroy(a)}}function ud(a,b){return a.a===b.a&&a.b===b.b&&a.c===b.c&&a.d===b.d&&a.tx===b.tx&&a.ty===b.ty}function Sc(a,b){a.numDirtyFrames+=b.dirtyFrame,a.numTotalFrames+=b.numRendered,b.camera.dirtyRender&&a.numDirtyCameras++,a.worldData.push(b)}function Ra(a,b){a.gameFrame=b,a.dirtyFrame=0,a.numRendered=0,a.numRenderable=0}class Sa extends U{constructor(a){super();this.forceRefresh=!1,this.is3D=!1,this.type="BaseWorld",this.scene=a,this.world=this,this.events=new Map(),this.renderList=[],this._updateListener=T(a,"update",(b,c)=>this.update(b,c)),this._renderListener=T(a,"render",b=>this.render(b)),this._shutdownListener=T(a,"shutdown",()=>this.shutdown()),Da(a,"destroy",()=>this.destroy())}update(a,b){if(!this.willUpdate)return;z(this,cc,a,b,this),super.update(a,b)}postUpdate(a,b){z(this,bc,a,b,this)}render(a){const b=this.renderData;Ra(b,a.gameFrame);if(!this.willRender||!this.visible)return;Rc(this),z(this,Tc,b,this),Sc(a,b),this.camera.dirtyRender=!1}renderGL(a){const b=a.current2DCamera,c=this.camera;(!b||!ud(c.worldTransform,b.worldTransform))&&C(a),xc(a,c),this.renderList.forEach(d=>{d.children.length>0?this.renderNode(d,a):d.node.renderGL(a)})}renderNode(a,b){a.node.renderGL(b),a.children.forEach(c=>{c.children.length>0?this.renderNode(c,b):c.node.renderGL(b)}),a.node.postRenderGL(b)}postRenderGL(a){}shutdown(){const a=this.scene;Ca(a,"update",this._updateListener),Ca(a,"render",this._renderListener),Ca(a,"shutdown",this._shutdownListener),Rb(this),z(this,Uc,this),Ra(this.renderData,0),this.camera&&this.camera.reset()}destroy(a){super.destroy(a),z(this,Ea,this),Ra(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}}function Ta(a,b){return{world:a,camera:b,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0}}class yb extends Sa{constructor(a){super(a);this.type="StaticWorld",this.camera=new va(),this.renderData=Ta(this,this.camera)}}class Ie extends Sa{constructor(a){super(a);this.enableCameraCull=!0,this.type="World",this.camera=new Hb(),this.renderData=Ta(this,this.camera)}}function tb(a,b,c){const d=Math.ceil(b*a.resolution),f=Math.ceil(c*a.resolution),g=a.canvas;if(g.width===d&&g.height===f){ub(a);return}g.width=d,g.height=f,a.texture.setSize(b,c),a.setSize(b,c),a.updateTexture()}function ub(a){a.context.clearRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function ta(a,b="#fff"){let c=a.context;c.fillStyle=b,c.fillRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function vb(a,b,c){const d=new Image();d.onload=function(){const f=a.resolution,g=d.width/f,h=d.height/f;tb(a,g,h),a.context.drawImage(d,0,0),a.updateTexture(),c&&c(),d.onload=null,d.src="",d.remove()},d.src=b}function Xc(a,b){return new Promise(function(c,d){vb(a,b,c)})}function Yc(a,b,c){return a.canvas.toDataURL(b,c)}function Zc(a,b,c,d=[0,0,0,0]){const f=a.context.getImageData(b,c,1,1).data;return d[0]=f[0],d[1]=f[1],d[2]=f[2],d[3]=f[3],d}function _c(a,b,c,d,f,g,h){h===void 0&&(h=d!==0||f!==0||g!==0?255:0);const i=a.context.createImageData(1,1);i.data[0]=d,i.data[1]=f,i.data[2]=g,i.data[3]=h,a.context.putImageData(i,b,c),a.updateTexture()}class sa extends I{constructor(a=0,b=0,c=32,d=32){super(a,b,la());this.type="rexCanvas";const f=A.get();this.resolution=f.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.resize(c,d)}updateTexture(){return this.texture.binding&&this.texture.binding.update(),this.setDirty(q.TEXTURE),this}destroy(a){this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}resize(a,b){return tb(this,a,b),this}clear(){return ub(this),this}}function ca(a,b,c,d=1){let f;if(typeof a==="string"){let i=E.get();i.has(a)||i.add(a,la()),f=i.get(a)}else f=a;let g=f.image,h=g.getContext("2d");return c?b.call(c,g,h):b(g,h),f.setSize(g.width/d,g.height/d),f.binding&&f.binding.update(),f}var bd;(function(a){a[a.left=1]="left",a[a.right=2]="right",a[a.both=3]="both"})(bd||(bd={}));const Me=Math.PI/180;function Ua(a){return a*Me}const RJ=Ua(0),SJ=Ua(90),TJ=Ua(180),UJ=Ua(270);var Ud;(function(a){a[a.right=0]="right",a[a.down=1]="down",a[a.left=2]="left",a[a.up=3]="up"})(Ud||(Ud={}));function Td(a,b){b.width!==a.width&&(b.width=a.width),b.height!==a.height&&(b.height=a.height);let c=b.getContext("2d");return c.drawImage(a.texture.image,a.x,a.y,a.width,a.height),b}function ua(a,b,c=0,d=0,f=a.width,g=a.height){const h=a.resolution,i=a.canvas,k=Math.ceil(f*h),j=Math.ceil(g*h);ca(b,function(o,l){o.width!==k&&(o.width=k),o.height!==j&&(o.height=j),l.clearRect(0,0,k,j),l.drawImage(i,c,d,k,j)},void 0,a.resolution)}function $c(a,b,c){const d=E.get();if(!d.has(b))return;Td(d.get(b).getFrame(c),a.canvas);const f=a.canvas.width,g=a.canvas.height,h=a.resolution,i=f/h,k=g/h;a.texture.setSize(i,k),a.setSize(i,k),a.updateTexture()}class Ke extends sa{fill(a="#fff"){return ta(this,a),this}getCanvas(){return this.canvas}getContext(){return this.context}getDataURL(a,b){return Yc(this,a,b)}getPixel(a,b,c=[0,0,0,0]){return Zc(this,a,b,c)}generateTexture(a,b=0,c=0,d=this.width,f=this.height){return ua(this,a,b,c,d,f),this}loadFromURL(a,b){return vb(this,a,b),this}loadFromURLPromise(a){return Xc(this,a)}loadTexture(a,b){return $c(this,a,b),this}setPixel(a,b,c,d,f,g){return _c(this,a,b,c,d,f,g),this}}class Wd extends hd{constructor(){super();const a=new yb(this),b=new sa(400,300,200,100);ra(a,b);const c=b.context.createLinearGradient(0,50,200,50);c.addColorStop(0,"blue"),c.addColorStop(1,"red"),ta(b,c),ua(b,"rect");const d=new I(0,0,"rect");d.setOrigin(0),ra(a,d)}}new gd(xb(),Ya(800,600),Wa("game"),wb(2960685),Xa(Wd));})();
/**
 * @author       Niklas von Hertzen (https://github.com/niklasvh/base64-arraybuffer)
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2020 Photon Storm Ltd.
 * @license      {@link https://opensource.org/licenses/MIT|MIT License}
 */
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2020 Photon Storm Ltd.
 * @license      {@link https://opensource.org/licenses/MIT|MIT License}
 */

(()=>{var We=Object.defineProperty,An=Object.prototype.hasOwnProperty,mb=(a,b)=>()=>(b||(b={exports:{}},a(b.exports,b)),b.exports),Bn=a=>We(a,"__esModule",{value:!0}),ec=(a,b)=>{Bn(a);for(var c in b)We(a,c,{get:b[c],enumerable:!0})},nq=(a,b)=>{Bn(a);if(typeof b==="object"||typeof b==="function")for(let c in b)An.call(b,c)&&!An.call(a,c)&&c!=="default"&&We(a,c,{get:()=>b[c],enumerable:!0});return a},Ha=a=>a&&a.__esModule?a:nq(We({},"default",{value:a,enumerable:!0}),a);var Ff=mb((a,b)=>{!function(c,d){"function"==typeof define&&define.amd?define([],d):"object"==typeof b&&"undefined"!=typeof a?b.exports=d():c.Papa=d()}(a,function c(){"use strict";var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==d?d:{},e=!d.document&&!!d.postMessage,f=e&&/blob:/i.test((d.location||{}).protocol),g={},j=0,i={parse:function(q,r){var h=(r=r||{}).dynamicTyping||!1;K(h)&&(r.dynamicTypingFunction=h,h={});if(r.dynamicTyping=h,r.transform=!!K(r.transform)&&r.transform,r.worker&&i.WORKERS_SUPPORTED){var m=function(){if(!i.WORKERS_SUPPORTED)return!1;var p=(o=d.URL||d.webkitURL||null,E=c.toString(),i.BLOB_URL||(i.BLOB_URL=o.createObjectURL(new Blob(["(",E,")();"],{type:"text/javascript"})))),u=new d.Worker(p),o,E;return u.onmessage=L,u.id=j++,g[u.id]=u}();return m.userStep=r.step,m.userChunk=r.chunk,m.userComplete=r.complete,m.userError=r.error,r.step=K(r.step),r.chunk=K(r.chunk),r.complete=K(r.complete),r.error=K(r.error),delete r.worker,void m.postMessage({input:q,config:r,workerId:m.id})}var l=null;return i.NODE_STREAM_INPUT,"string"==typeof q?l=r.download?new s(r):new y(r):!0===q.readable&&K(q.read)&&K(q.on)?l=new B(r):(d.File&&q instanceof File||q instanceof Object)&&(l=new w(r)),l.stream(q)},unparse:function(q,r){var h=!1,m=!0,l=",",p=`\r
`,u='"',o=u+u,E=!1,F=null,Y=!1;!function(){if("object"!=typeof r)return;"string"!=typeof r.delimiter||i.BAD_DELIMITERS.filter(function(I){return-1!==r.delimiter.indexOf(I)}).length||(l=r.delimiter),("boolean"==typeof r.quotes||"function"==typeof r.quotes||Array.isArray(r.quotes))&&(h=r.quotes),"boolean"!=typeof r.skipEmptyLines&&"string"!=typeof r.skipEmptyLines||(E=r.skipEmptyLines),"string"==typeof r.newline&&(p=r.newline),"string"==typeof r.quoteChar&&(u=r.quoteChar),"boolean"==typeof r.header&&(m=r.header);if(Array.isArray(r.columns)){if(0===r.columns.length)throw new Error("Option columns is empty");F=r.columns}void 0!==r.escapeChar&&(o=r.escapeChar+u),"boolean"==typeof r.escapeFormulae&&(Y=r.escapeFormulae)}();var z=new RegExp(H(u),"g");"string"==typeof q&&(q=JSON.parse(q));if(Array.isArray(q)){if(!q.length||Array.isArray(q[0]))return M(null,q,E);if("object"==typeof q[0])return M(F||Z(q[0]),q,E)}else if("object"==typeof q)return"string"==typeof q.data&&(q.data=JSON.parse(q.data)),Array.isArray(q.data)&&(q.fields||(q.fields=q.meta&&q.meta.fields),q.fields||(q.fields=Array.isArray(q.data[0])?q.fields:Z(q.data[0])),Array.isArray(q.data[0])||"object"==typeof q.data[0]||(q.data=[q.data])),M(q.fields||[],q.data||[],E);throw new Error("Unable to serialize unrecognized input");function Z(I){if("object"!=typeof I)return[];var U=[];for(var fa in I)U.push(fa);return U}function M(I,U,fa){var la="";"string"==typeof I&&(I=JSON.parse(I)),"string"==typeof U&&(U=JSON.parse(U));var ma=Array.isArray(I)&&0<I.length,ra=!Array.isArray(U[0]);if(ma&&m){for(var V=0;V<I.length;V++)0<V&&(la+=l),la+=D(I[V],V);0<U.length&&(la+=p)}for(var $=0;$<U.length;$++){var ia=ma?I.length:U[$].length,ja=!1,N=ma?0===Object.keys(U[$]).length:0===U[$].length;if(fa&&!ma&&(ja="greedy"===fa?""===U[$].join("").trim():1===U[$].length&&0===U[$][0].length),"greedy"===fa&&ma){for(var T=[],ea=0;ea<ia;ea++){var Q=ra?I[ea]:ea;T.push(U[$][Q])}ja=""===T.join("").trim()}if(!ja){for(var aa=0;aa<ia;aa++){0<aa&&!N&&(la+=l);var na=ma&&ra?I[aa]:aa;la+=D(U[$][na],aa)}$<U.length-1&&(!fa||0<ia&&!N)&&(la+=p)}}return la}function D(I,U){if(null==I)return"";if(I.constructor===Date)return JSON.stringify(I).slice(1,25);!0===Y&&"string"==typeof I&&null!==I.match(/^[=+\-@].*$/)&&(I="'"+I);var fa=I.toString().replace(z,o),la="boolean"==typeof h&&h||"function"==typeof h&&h(I,U)||Array.isArray(h)&&h[U]||function(ma,ra){for(var V=0;V<ra.length;V++)if(-1<ma.indexOf(ra[V]))return!0;return!1}(fa,i.BAD_DELIMITERS)||-1<fa.indexOf(l)||" "===fa.charAt(0)||" "===fa.charAt(fa.length-1);return la?u+fa+u:fa}}};if(i.RECORD_SEP=String.fromCharCode(30),i.UNIT_SEP=String.fromCharCode(31),i.BYTE_ORDER_MARK="ï»¿",i.BAD_DELIMITERS=["\r",`
`,'"',i.BYTE_ORDER_MARK],i.WORKERS_SUPPORTED=!e&&!!d.Worker,i.NODE_STREAM_INPUT=1,i.LocalChunkSize=10485760,i.RemoteChunkSize=5242880,i.DefaultDelimiter=",",i.Parser=R,i.ParserHandle=G,i.NetworkStreamer=s,i.FileStreamer=w,i.StringStreamer=y,i.ReadableStreamStreamer=B,d.jQuery){var k=d.jQuery;k.fn.parse=function(q){var r=q.config||{},h=[];return this.each(function(p){if(!("INPUT"===k(this).prop("tagName").toUpperCase()&&"file"===k(this).attr("type").toLowerCase()&&d.FileReader)||!this.files||0===this.files.length)return!0;for(var u=0;u<this.files.length;u++)h.push({file:this.files[u],inputElem:this,instanceConfig:k.extend({},r)})}),m(),this;function m(){if(0!==h.length){var p,u,o,E,F=h[0];if(K(q.before)){var Y=q.before(F.file,F.inputElem);if("object"==typeof Y){if("abort"===Y.action)return p="AbortError",u=F.file,o=F.inputElem,E=Y.reason,void(K(q.error)&&q.error({name:p},u,o,E));if("skip"===Y.action)return void l();"object"==typeof Y.config&&(F.instanceConfig=k.extend(F.instanceConfig,Y.config))}else if("skip"===Y)return void l()}var z=F.instanceConfig.complete;F.instanceConfig.complete=function(Z){K(z)&&z(Z,F.file,F.inputElem),l()},i.parse(F.file,F.instanceConfig)}else K(q.complete)&&q.complete()}function l(){h.splice(0,1),m()}}}function n(q){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(r){var h=W(r);h.chunkSize=parseInt(h.chunkSize),r.step||r.chunk||(h.chunkSize=null),this._handle=new G(h),(this._handle.streamer=this)._config=h}.call(this,q),this.parseChunk=function(r,h){if(this.isFirstChunk&&K(this._config.beforeFirstChunk)){var m=this._config.beforeFirstChunk(r);void 0!==m&&(r=m)}this.isFirstChunk=!1,this._halted=!1;var l=this._partialLine+r;this._partialLine="";var p=this._handle.parse(l,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var u=p.meta.cursor;this._finished||(this._partialLine=l.substring(u-this._baseIndex),this._baseIndex=u),p&&p.data&&(this._rowCount+=p.data.length);var o=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(f)d.postMessage({results:p,workerId:i.WORKER_ID,finished:o});else if(K(this._config.chunk)&&!h){if(this._config.chunk(p,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);p=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(p.data),this._completeResults.errors=this._completeResults.errors.concat(p.errors),this._completeResults.meta=p.meta),this._completed||!o||!K(this._config.complete)||p&&p.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),o||p&&p.meta.paused||this._nextChunk(),p}this._halted=!0},this._sendError=function(r){K(this._config.error)?this._config.error(r):f&&this._config.error&&d.postMessage({workerId:i.WORKER_ID,error:r,finished:!1})}}function s(q){var r;(q=q||{}).chunkSize||(q.chunkSize=i.RemoteChunkSize),n.call(this,q),this._nextChunk=e?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(h){this._input=h,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(r=new XMLHttpRequest(),this._config.withCredentials&&(r.withCredentials=this._config.withCredentials),e||(r.onload=X(this._chunkLoaded,this),r.onerror=X(this._chunkError,this)),r.open(this._config.downloadRequestBody?"POST":"GET",this._input,!e),this._config.downloadRequestHeaders){var h=this._config.downloadRequestHeaders;for(var m in h)r.setRequestHeader(m,h[m])}if(this._config.chunkSize){var l=this._start+this._config.chunkSize-1;r.setRequestHeader("Range","bytes="+this._start+"-"+l)}try{r.send(this._config.downloadRequestBody)}catch(p){this._chunkError(p.message)}e&&0===r.status&&this._chunkError()}},this._chunkLoaded=function(){4===r.readyState&&(r.status<200||400<=r.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:r.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(h){var m=h.getResponseHeader("Content-Range");return null===m?-1:parseInt(m.substring(m.lastIndexOf("/")+1))}(r),this.parseChunk(r.responseText)))},this._chunkError=function(h){var m=r.statusText||h;this._sendError(new Error(m))}}function w(q){var r,h;(q=q||{}).chunkSize||(q.chunkSize=i.LocalChunkSize),n.call(this,q);var m="undefined"!=typeof FileReader;this.stream=function(l){this._input=l,h=l.slice||l.webkitSlice||l.mozSlice,m?((r=new FileReader()).onload=X(this._chunkLoaded,this),r.onerror=X(this._chunkError,this)):r=new FileReaderSync(),this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var l=this._input;if(this._config.chunkSize){var p=Math.min(this._start+this._config.chunkSize,this._input.size);l=h.call(l,this._start,p)}var u=r.readAsText(l,this._config.encoding);m||this._chunkLoaded({target:{result:u}})},this._chunkLoaded=function(l){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(l.target.result)},this._chunkError=function(){this._sendError(r.error)}}function y(q){var r;n.call(this,q=q||{}),this.stream=function(h){return r=h,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var h,m=this._config.chunkSize;return m?(h=r.substring(0,m),r=r.substring(m)):(h=r,r=""),this._finished=!r,this.parseChunk(h)}}}function B(q){n.call(this,q=q||{});var r=[],h=!0,m=!1;this.pause=function(){n.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){n.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(l){this._input=l,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){m&&1===r.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),r.length?this.parseChunk(r.shift()):h=!0},this._streamData=X(function(l){try{r.push("string"==typeof l?l:l.toString(this._config.encoding)),h&&(h=!1,this._checkIsFinished(),this.parseChunk(r.shift()))}catch(p){this._streamError(p)}},this),this._streamError=X(function(l){this._streamCleanUp(),this._sendError(l)},this),this._streamEnd=X(function(){this._streamCleanUp(),m=!0,this._streamData("")},this),this._streamCleanUp=X(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function G(q){var r,h,m,l=Math.pow(2,53),p=-l,u=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)(e[-+]?\d+)?\s*$/,o=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,E=this,F=0,Y=0,z=!1,Z=!1,M=[],D={data:[],errors:[],meta:{}};if(K(q.step)){var I=q.step;q.step=function(V){if(D=V,la())fa();else{if(fa(),0===D.data.length)return;F+=V.data.length,q.preview&&F>q.preview?h.abort():(D.data=D.data[0],I(D,E))}}}function U(V){return"greedy"===q.skipEmptyLines?""===V.join("").trim():1===V.length&&0===V[0].length}function fa(){if(D&&m&&(ra("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+i.DefaultDelimiter+"'"),m=!1),q.skipEmptyLines)for(var V=0;V<D.data.length;V++)U(D.data[V])&&D.data.splice(V--,1);return la()&&function(){if(!D)return;function $(ja,N){K(q.transformHeader)&&(ja=q.transformHeader(ja,N)),M.push(ja)}if(Array.isArray(D.data[0])){for(var ia=0;la()&&ia<D.data.length;ia++)D.data[ia].forEach($);D.data.splice(0,1)}else D.data.forEach($)}(),function(){if(!D||!q.header&&!q.dynamicTyping&&!q.transform)return D;function $(ja,N){var T,ea=q.header?{}:[];for(T=0;T<ja.length;T++){var Q=T,aa=ja[T];q.header&&(Q=T>=M.length?"__parsed_extra":M[T]),q.transform&&(aa=q.transform(aa,Q)),aa=ma(Q,aa),"__parsed_extra"===Q?(ea[Q]=ea[Q]||[],ea[Q].push(aa)):ea[Q]=aa}return q.header&&(T>M.length?ra("FieldMismatch","TooManyFields","Too many fields: expected "+M.length+" fields but parsed "+T,Y+N):T<M.length&&ra("FieldMismatch","TooFewFields","Too few fields: expected "+M.length+" fields but parsed "+T,Y+N)),ea}var ia=1;return!D.data.length||Array.isArray(D.data[0])?(D.data=D.data.map($),ia=D.data.length):D.data=$(D.data,0),q.header&&D.meta&&(D.meta.fields=M),Y+=ia,D}()}function la(){return q.header&&0===M.length}function ma(V,$){return ia=V,q.dynamicTypingFunction&&void 0===q.dynamicTyping[ia]&&(q.dynamicTyping[ia]=q.dynamicTypingFunction(ia)),!0===(q.dynamicTyping[ia]||q.dynamicTyping)?"true"===$||"TRUE"===$||"false"!==$&&"FALSE"!==$&&(function(ja){if(u.test(ja)){var N=parseFloat(ja);if(p<N&&N<l)return!0}return!1}($)?parseFloat($):o.test($)?new Date($):""===$?null:$):$;var ia}function ra(V,$,ia,ja){var N={type:V,code:$,message:ia};void 0!==ja&&(N.row=ja),D.errors.push(N)}this.parse=function(V,$,ia){var ja=q.quoteChar||'"';if(q.newline||(q.newline=function(ea,Q){ea=ea.substring(0,1048576);var aa=new RegExp(H(Q)+"([^]*?)"+H(Q),"gm"),na=(ea=ea.replace(aa,"")).split("\r"),sa=ea.split(`
`),za=1<sa.length&&sa[0].length<na[0].length;if(1===na.length||za)return`
`;for(var O=0,Aa=0;Aa<na.length;Aa++)`
`===na[Aa][0]&&O++;return O>=na.length/2?`\r
`:"\r"}(V,ja)),m=!1,q.delimiter)K(q.delimiter)&&(q.delimiter=q.delimiter(V),D.meta.delimiter=q.delimiter);else{var N=function(ea,Q,aa,na,sa){var za,O,Aa,x;sa=sa||[",","	","|",";",i.RECORD_SEP,i.UNIT_SEP];for(var t=0;t<sa.length;t++){var A=sa[t],C=0,v=0,P=0;Aa=void 0;for(var _=new R({comments:na,delimiter:A,newline:Q,preview:10}).parse(ea),ha=0;ha<_.data.length;ha++)if(aa&&U(_.data[ha]))P++;else{var ga=_.data[ha].length;v+=ga,void 0!==Aa?0<ga&&(C+=Math.abs(ga-Aa),Aa=ga):Aa=ga}0<_.data.length&&(v/=_.data.length-P),(void 0===O||C<=O)&&(void 0===x||x<v)&&1.99<v&&(O=C,za=A,x=v)}return{successful:!!(q.delimiter=za),bestDelimiter:za}}(V,q.newline,q.skipEmptyLines,q.comments,q.delimitersToGuess);N.successful?q.delimiter=N.bestDelimiter:(m=!0,q.delimiter=i.DefaultDelimiter),D.meta.delimiter=q.delimiter}var T=W(q);return q.preview&&q.header&&T.preview++,r=V,h=new R(T),D=h.parse(r,$,ia),fa(),z?{meta:{paused:!0}}:D||{meta:{paused:!1}}},this.paused=function(){return z},this.pause=function(){z=!0,h.abort(),r=K(q.chunk)?"":r.substring(h.getCharIndex())},this.resume=function(){E.streamer._halted?(z=!1,E.streamer.parseChunk(r,!0)):setTimeout(E.resume,3)},this.aborted=function(){return Z},this.abort=function(){Z=!0,h.abort(),D.meta.aborted=!0,K(q.complete)&&q.complete(D),r=""}}function H(q){return q.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function R(q){var r,h=(q=q||{}).delimiter,m=q.newline,l=q.comments,p=q.step,u=q.preview,o=q.fastMode,E=r=void 0===q.quoteChar?'"':q.quoteChar;if(void 0!==q.escapeChar&&(E=q.escapeChar),("string"!=typeof h||-1<i.BAD_DELIMITERS.indexOf(h))&&(h=","),l===h)throw new Error("Comment character same as delimiter");!0===l?l="#":("string"!=typeof l||-1<i.BAD_DELIMITERS.indexOf(l))&&(l=!1),`
`!==m&&"\r"!==m&&`\r
`!==m&&(m=`
`);var F=0,Y=!1;this.parse=function(z,Z,M){if("string"!=typeof z)throw new Error("Input must be a string");var D=z.length,I=h.length,U=m.length,fa=l.length,la=K(p),ma=[],ra=[],V=[],$=F=0;if(!z)return t();if(o||!1!==o&&-1===z.indexOf(r)){for(var ia=z.split(m),ja=0;ja<ia.length;ja++){if(V=ia[ja],F+=V.length,ja!==ia.length-1)F+=m.length;else if(M)return t();if(!l||V.substring(0,fa)!==l){if(la){if(ma=[],za(V.split(h)),A(),Y)return t()}else za(V.split(h));if(u&&u<=ja)return ma=ma.slice(0,u),t(!0)}}return t()}for(var N=z.indexOf(h,F),T=z.indexOf(m,F),ea=new RegExp(H(E)+H(r),"g"),Q=z.indexOf(r,F);;)if(z[F]!==r)if(l&&0===V.length&&z.substring(F,F+fa)===l){if(-1===T)return t();F=T+U,T=z.indexOf(m,F),N=z.indexOf(h,F)}else{if(-1!==N&&(N<T||-1===T)){if(!(N<Q)){V.push(z.substring(F,N)),F=N+I,N=z.indexOf(h,F);continue}var aa=C(N,Q,T);if(aa&&void 0!==aa.nextDelim){N=aa.nextDelim,Q=aa.quoteSearch,V.push(z.substring(F,N)),F=N+I,N=z.indexOf(h,F);continue}}if(-1===T)break;if(V.push(z.substring(F,T)),x(T+U),la&&(A(),Y))return t();if(u&&ma.length>=u)return t(!0)}else for(Q=F,F++;;){if(-1===(Q=z.indexOf(r,Q+1)))return M||ra.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:ma.length,index:F}),Aa();if(Q===D-1)return Aa(z.substring(F,Q).replace(ea,r));if(r!==E||z[Q+1]!==E){if(r===E||0===Q||z[Q-1]!==E){-1!==N&&N<Q+1&&(N=z.indexOf(h,Q+1)),-1!==T&&T<Q+1&&(T=z.indexOf(m,Q+1));var na=O(-1===T?N:Math.min(N,T));if(z[Q+1+na]===h){V.push(z.substring(F,Q).replace(ea,r)),z[F=Q+1+na+I]!==r&&(Q=z.indexOf(r,F)),N=z.indexOf(h,F),T=z.indexOf(m,F);break}var sa=O(T);if(z.substring(Q+1+sa,Q+1+sa+U)===m){if(V.push(z.substring(F,Q).replace(ea,r)),x(Q+1+sa+U),N=z.indexOf(h,F),Q=z.indexOf(r,F),la&&(A(),Y))return t();if(u&&ma.length>=u)return t(!0);break}ra.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:ma.length,index:F}),Q++}}else Q++}return Aa();function za(v){ma.push(v),$=F}function O(v){var P=0;if(-1!==v){var _=z.substring(Q+1,v);_&&""===_.trim()&&(P=_.length)}return P}function Aa(v){return M||(void 0===v&&(v=z.substring(F)),V.push(v),F=D,za(V),la&&A()),t()}function x(v){F=v,za(V),V=[],T=z.indexOf(m,F)}function t(v){return{data:ma,errors:ra,meta:{delimiter:h,linebreak:m,aborted:Y,truncated:!!v,cursor:$+(Z||0)}}}function A(){p(t()),ma=[],ra=[]}function C(v,P,_){var ha={nextDelim:void 0,quoteSearch:void 0},ga=z.indexOf(r,P+1);if(P<v&&v<ga&&(ga<_||-1===_)){var ka=z.indexOf(h,ga);if(-1===ka)return ha;ga<ka&&(ga=z.indexOf(r,ga+1)),ha=C(ka,ga,_)}else ha={nextDelim:v,quoteSearch:P};return ha}},this.abort=function(){Y=!0},this.getCharIndex=function(){return F}}function L(q){var r=q.data,h=g[r.workerId],m=!1;if(r.error)h.userError(r.error,r.file);else if(r.results&&r.results.data){var l={abort:function(){m=!0,S(r.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:J,resume:J};if(K(h.userStep)){for(var p=0;p<r.results.data.length&&(h.userStep({data:r.results.data[p],errors:r.results.errors,meta:r.results.meta},l),!m);p++);delete r.results}else K(h.userChunk)&&(h.userChunk(r.results,l,r.file),delete r.results)}r.finished&&!m&&S(r.workerId,r.results)}function S(q,r){var h=g[q];K(h.userComplete)&&h.userComplete(r),h.terminate(),delete g[q]}function J(){throw new Error("Not implemented.")}function W(q){if("object"!=typeof q||null===q)return q;var r=Array.isArray(q)?[]:{};for(var h in q)r[h]=W(q[h]);return r}function X(q,r){return function(){q.apply(r,arguments)}}function K(q){return"function"==typeof q}return f&&(d.onmessage=function(q){var r=q.data;void 0===i.WORKER_ID&&r&&(i.WORKER_ID=r.workerId);if("string"==typeof r.input)d.postMessage({workerId:i.WORKER_ID,results:i.parse(r.input,r.config),finished:!0});else if(d.File&&r.input instanceof File||r.input instanceof Object){var h=i.parse(r.input,r.config);h&&d.postMessage({workerId:i.WORKER_ID,results:h,finished:!0})}}),(s.prototype=Object.create(n.prototype)).constructor=s,(w.prototype=Object.create(n.prototype)).constructor=w,(y.prototype=Object.create(y.prototype)).constructor=y,(B.prototype=Object.create(n.prototype)).constructor=B,i})});var qi=mb(q=>{ec(q,{__assign:()=>c,__asyncDelegator:()=>R,__asyncGenerator:()=>H,__asyncValues:()=>L,__await:()=>G,__awaiter:()=>j,__classPrivateFieldGet:()=>X,__classPrivateFieldSet:()=>K,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>W,__importStar:()=>J,__makeTemplateObject:()=>S,__metadata:()=>g,__param:()=>f,__read:()=>w,__rest:()=>d,__spread:()=>y,__spreadArrays:()=>B,__values:()=>s});var a=function(h,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,p){l.__proto__=p}||function(l,p){for(var u in p)p.hasOwnProperty(u)&&(l[u]=p[u])},a(h,m)};function b(h,m){a(h,m);function l(){this.constructor=h}h.prototype=m===null?Object.create(m):(l.prototype=m.prototype,new l())}var c=function(){return c=Object.assign||function h(m){for(var l,p=1,u=arguments.length;p<u;p++){l=arguments[p];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(m[o]=l[o])}return m},c.apply(this,arguments)};function d(h,m){var l={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&m.indexOf(p)<0&&(l[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var u=0,p=Object.getOwnPropertySymbols(h);u<p.length;u++)m.indexOf(p[u])<0&&Object.prototype.propertyIsEnumerable.call(h,p[u])&&(l[p[u]]=h[p[u]]);return l}function e(h,m,l,p){var u=arguments.length,o=u<3?m:p===null?p=Object.getOwnPropertyDescriptor(m,l):p,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(h,m,l,p);else for(var F=h.length-1;F>=0;F--)(E=h[F])&&(o=(u<3?E(o):u>3?E(m,l,o):E(m,l))||o);return u>3&&o&&Object.defineProperty(m,l,o),o}function f(h,m){return function(l,p){m(l,p,h)}}function g(h,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,m)}function j(h,m,l,p){function u(o){return o instanceof l?o:new l(function(E){E(o)})}return new(l||(l=Promise))(function(o,E){function F(Z){try{z(p.next(Z))}catch(M){E(M)}}function Y(Z){try{z(p.throw(Z))}catch(M){E(M)}}function z(Z){Z.done?o(Z.value):u(Z.value).then(F,Y)}z((p=p.apply(h,m||[])).next())})}function i(h,m){var l={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},p,u,o,E;return E={next:F(0),throw:F(1),return:F(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function F(z){return function(Z){return Y([z,Z])}}function Y(z){if(p)throw new TypeError("Generator is already executing.");for(;l;)try{if(p=1,u&&(o=z[0]&2?u.return:z[0]?u.throw||((o=u.return)&&o.call(u),0):u.next)&&!(o=o.call(u,z[1])).done)return o;(u=0,o)&&(z=[z[0]&2,o.value]);switch(z[0]){case 0:case 1:o=z;break;case 4:return l.label++,{value:z[1],done:!1};case 5:l.label++,u=z[1],z=[0];continue;case 7:z=l.ops.pop(),l.trys.pop();continue;default:if(!(o=l.trys,o=o.length>0&&o[o.length-1])&&(z[0]===6||z[0]===2)){l=0;continue}if(z[0]===3&&(!o||z[1]>o[0]&&z[1]<o[3])){l.label=z[1];break}if(z[0]===6&&l.label<o[1]){l.label=o[1],o=z;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(z);break}o[2]&&l.ops.pop(),l.trys.pop();continue}z=m.call(h,l)}catch(Z){z=[6,Z],u=0}finally{p=o=0}if(z[0]&5)throw z[1];return{value:z[0]?z[1]:void 0,done:!0}}}function k(h,m,l,p){p===void 0&&(p=l),h[p]=m[l]}function n(h,m){for(var l in h)l!=="default"&&!m.hasOwnProperty(l)&&(m[l]=h[l])}function s(h){var m=typeof Symbol==="function"&&Symbol.iterator,l=m&&h[m],p=0;if(l)return l.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function w(h,m){var l=typeof Symbol==="function"&&h[Symbol.iterator];if(!l)return h;var p=l.call(h),u,o=[],E;try{for(;(m===void 0||m-- >0)&&!(u=p.next()).done;)o.push(u.value)}catch(F){E={error:F}}finally{try{u&&!u.done&&(l=p.return)&&l.call(p)}finally{if(E)throw E.error}}return o}function y(){for(var h=[],m=0;m<arguments.length;m++)h=h.concat(w(arguments[m]));return h}function B(){for(var h=0,m=0,l=arguments.length;m<l;m++)h+=arguments[m].length;for(var p=Array(h),u=0,m=0;m<l;m++)for(var o=arguments[m],E=0,F=o.length;E<F;E++,u++)p[u]=o[E];return p}function G(h){return this instanceof G?(this.v=h,this):new G(h)}function H(h,m,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=l.apply(h,m||[]),u,o=[];return u={},E("next"),E("throw"),E("return"),u[Symbol.asyncIterator]=function(){return this},u;function E(D){p[D]&&(u[D]=function(I){return new Promise(function(U,fa){o.push([D,I,U,fa])>1||F(D,I)})})}function F(D,I){try{Y(p[D](I))}catch(U){M(o[0][3],U)}}function Y(D){D.value instanceof G?Promise.resolve(D.value.v).then(z,Z):M(o[0][2],D)}function z(D){F("next",D)}function Z(D){F("throw",D)}function M(D,I){(D(I),o.shift(),o.length)&&F(o[0][0],o[0][1])}}function R(h){var m,l;return m={},p("next"),p("throw",function(u){throw u}),p("return"),m[Symbol.iterator]=function(){return this},m;function p(u,o){m[u]=h[u]?function(E){return(l=!l)?{value:G(h[u](E)),done:u==="return"}:o?o(E):E}:o}}function L(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=h[Symbol.asyncIterator],l;return m?m.call(h):(h=typeof s==="function"?s(h):h[Symbol.iterator](),l={},p("next"),p("throw"),p("return"),l[Symbol.asyncIterator]=function(){return this},l);function p(o){l[o]=h[o]&&function(E){return new Promise(function(F,Y){E=h[o](E),u(F,Y,E.done,E.value)})}}function u(o,E,F,Y){Promise.resolve(Y).then(function(z){o({value:z,done:F})},E)}}function S(h,m){return Object.defineProperty?Object.defineProperty(h,"raw",{value:m}):h.raw=m,h}function J(h){if(h&&h.__esModule)return h;var m={};if(h!=null)for(var l in h)Object.hasOwnProperty.call(h,l)&&(m[l]=h[l]);return m.default=h,m}function W(h){return h&&h.__esModule?h:{default:h}}function X(h,m){if(!m.has(h))throw new TypeError("attempted to get private field on non-instance");return m.get(h)}function K(h,m,l){if(!m.has(h))throw new TypeError("attempted to set private field on non-instance");return m.set(h,l),l}});var ui=mb(q=>{ec(q,{__assign:()=>c,__asyncDelegator:()=>R,__asyncGenerator:()=>H,__asyncValues:()=>L,__await:()=>G,__awaiter:()=>j,__classPrivateFieldGet:()=>X,__classPrivateFieldSet:()=>K,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>W,__importStar:()=>J,__makeTemplateObject:()=>S,__metadata:()=>g,__param:()=>f,__read:()=>w,__rest:()=>d,__spread:()=>y,__spreadArrays:()=>B,__values:()=>s});var a=function(h,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,p){l.__proto__=p}||function(l,p){for(var u in p)p.hasOwnProperty(u)&&(l[u]=p[u])},a(h,m)};function b(h,m){a(h,m);function l(){this.constructor=h}h.prototype=m===null?Object.create(m):(l.prototype=m.prototype,new l())}var c=function(){return c=Object.assign||function h(m){for(var l,p=1,u=arguments.length;p<u;p++){l=arguments[p];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(m[o]=l[o])}return m},c.apply(this,arguments)};function d(h,m){var l={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&m.indexOf(p)<0&&(l[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var u=0,p=Object.getOwnPropertySymbols(h);u<p.length;u++)m.indexOf(p[u])<0&&Object.prototype.propertyIsEnumerable.call(h,p[u])&&(l[p[u]]=h[p[u]]);return l}function e(h,m,l,p){var u=arguments.length,o=u<3?m:p===null?p=Object.getOwnPropertyDescriptor(m,l):p,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(h,m,l,p);else for(var F=h.length-1;F>=0;F--)(E=h[F])&&(o=(u<3?E(o):u>3?E(m,l,o):E(m,l))||o);return u>3&&o&&Object.defineProperty(m,l,o),o}function f(h,m){return function(l,p){m(l,p,h)}}function g(h,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,m)}function j(h,m,l,p){function u(o){return o instanceof l?o:new l(function(E){E(o)})}return new(l||(l=Promise))(function(o,E){function F(Z){try{z(p.next(Z))}catch(M){E(M)}}function Y(Z){try{z(p.throw(Z))}catch(M){E(M)}}function z(Z){Z.done?o(Z.value):u(Z.value).then(F,Y)}z((p=p.apply(h,m||[])).next())})}function i(h,m){var l={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},p,u,o,E;return E={next:F(0),throw:F(1),return:F(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function F(z){return function(Z){return Y([z,Z])}}function Y(z){if(p)throw new TypeError("Generator is already executing.");for(;l;)try{if(p=1,u&&(o=z[0]&2?u.return:z[0]?u.throw||((o=u.return)&&o.call(u),0):u.next)&&!(o=o.call(u,z[1])).done)return o;(u=0,o)&&(z=[z[0]&2,o.value]);switch(z[0]){case 0:case 1:o=z;break;case 4:return l.label++,{value:z[1],done:!1};case 5:l.label++,u=z[1],z=[0];continue;case 7:z=l.ops.pop(),l.trys.pop();continue;default:if(!(o=l.trys,o=o.length>0&&o[o.length-1])&&(z[0]===6||z[0]===2)){l=0;continue}if(z[0]===3&&(!o||z[1]>o[0]&&z[1]<o[3])){l.label=z[1];break}if(z[0]===6&&l.label<o[1]){l.label=o[1],o=z;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(z);break}o[2]&&l.ops.pop(),l.trys.pop();continue}z=m.call(h,l)}catch(Z){z=[6,Z],u=0}finally{p=o=0}if(z[0]&5)throw z[1];return{value:z[0]?z[1]:void 0,done:!0}}}function k(h,m,l,p){p===void 0&&(p=l),h[p]=m[l]}function n(h,m){for(var l in h)l!=="default"&&!m.hasOwnProperty(l)&&(m[l]=h[l])}function s(h){var m=typeof Symbol==="function"&&Symbol.iterator,l=m&&h[m],p=0;if(l)return l.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function w(h,m){var l=typeof Symbol==="function"&&h[Symbol.iterator];if(!l)return h;var p=l.call(h),u,o=[],E;try{for(;(m===void 0||m-- >0)&&!(u=p.next()).done;)o.push(u.value)}catch(F){E={error:F}}finally{try{u&&!u.done&&(l=p.return)&&l.call(p)}finally{if(E)throw E.error}}return o}function y(){for(var h=[],m=0;m<arguments.length;m++)h=h.concat(w(arguments[m]));return h}function B(){for(var h=0,m=0,l=arguments.length;m<l;m++)h+=arguments[m].length;for(var p=Array(h),u=0,m=0;m<l;m++)for(var o=arguments[m],E=0,F=o.length;E<F;E++,u++)p[u]=o[E];return p}function G(h){return this instanceof G?(this.v=h,this):new G(h)}function H(h,m,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=l.apply(h,m||[]),u,o=[];return u={},E("next"),E("throw"),E("return"),u[Symbol.asyncIterator]=function(){return this},u;function E(D){p[D]&&(u[D]=function(I){return new Promise(function(U,fa){o.push([D,I,U,fa])>1||F(D,I)})})}function F(D,I){try{Y(p[D](I))}catch(U){M(o[0][3],U)}}function Y(D){D.value instanceof G?Promise.resolve(D.value.v).then(z,Z):M(o[0][2],D)}function z(D){F("next",D)}function Z(D){F("throw",D)}function M(D,I){(D(I),o.shift(),o.length)&&F(o[0][0],o[0][1])}}function R(h){var m,l;return m={},p("next"),p("throw",function(u){throw u}),p("return"),m[Symbol.iterator]=function(){return this},m;function p(u,o){m[u]=h[u]?function(E){return(l=!l)?{value:G(h[u](E)),done:u==="return"}:o?o(E):E}:o}}function L(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=h[Symbol.asyncIterator],l;return m?m.call(h):(h=typeof s==="function"?s(h):h[Symbol.iterator](),l={},p("next"),p("throw"),p("return"),l[Symbol.asyncIterator]=function(){return this},l);function p(o){l[o]=h[o]&&function(E){return new Promise(function(F,Y){E=h[o](E),u(F,Y,E.done,E.value)})}}function u(o,E,F,Y){Promise.resolve(Y).then(function(z){o({value:z,done:F})},E)}}function S(h,m){return Object.defineProperty?Object.defineProperty(h,"raw",{value:m}):h.raw=m,h}function J(h){if(h&&h.__esModule)return h;var m={};if(h!=null)for(var l in h)Object.hasOwnProperty.call(h,l)&&(m[l]=h[l]);return m.default=h,m}function W(h){return h&&h.__esModule?h:{default:h}}function X(h,m){if(!m.has(h))throw new TypeError("attempted to get private field on non-instance");return m.get(h)}function K(h,m,l){if(!m.has(h))throw new TypeError("attempted to set private field on non-instance");return m.set(h,l),l}});var cf=mb(O=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});var a=ui();var b={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};var c=function(x,t){if(!x)throw d(t)},d=function(x){return new Error("Firebase Database ("+b.SDK_VERSION+") INTERNAL ASSERT FAILED: "+x)};var e=function(x){for(var t=[],A=0,C=0;C<x.length;C++){var v=x.charCodeAt(C);v<128?t[A++]=v:v<2048?(t[A++]=v>>6|192,t[A++]=v&63|128):(v&64512)===55296&&C+1<x.length&&(x.charCodeAt(C+1)&64512)===56320?(v=65536+((v&1023)<<10)+(x.charCodeAt(++C)&1023),t[A++]=v>>18|240,t[A++]=v>>12&63|128,t[A++]=v>>6&63|128,t[A++]=v&63|128):(t[A++]=v>>12|224,t[A++]=v>>6&63|128,t[A++]=v&63|128)}return t},f=function(x){for(var t=[],A=0,C=0;A<x.length;){var v=x[A++];if(v<128)t[C++]=String.fromCharCode(v);else if(v>191&&v<224){var P=x[A++];t[C++]=String.fromCharCode((v&31)<<6|P&63)}else if(v>239&&v<365){var P=x[A++],_=x[A++],ha=x[A++],ga=((v&7)<<18|(P&63)<<12|(_&63)<<6|ha&63)-65536;t[C++]=String.fromCharCode(55296+(ga>>10)),t[C++]=String.fromCharCode(56320+(ga&1023))}else{var P=x[A++],_=x[A++];t[C++]=String.fromCharCode((v&15)<<12|(P&63)<<6|_&63)}}return t.join("")},g={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob==="function",encodeByteArray:function(x,t){if(!Array.isArray(x))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var A=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,C=[],v=0;v<x.length;v+=3){var P=x[v],_=v+1<x.length,ha=_?x[v+1]:0,ga=v+2<x.length,ka=ga?x[v+2]:0,Va=P>>2,Sa=(P&3)<<4|ha>>4,Ia=(ha&15)<<2|ka>>6,Xe=ka&63;ga||(Xe=64,_||(Ia=64)),C.push(A[Va],A[Sa],A[Ia],A[Xe])}return C.join("")},encodeString:function(x,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(x):this.encodeByteArray(e(x),t)},decodeString:function(x,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(x):f(this.decodeStringToByteArray(x,t))},decodeStringToByteArray:function(x,t){this.init_();for(var A=t?this.charToByteMapWebSafe_:this.charToByteMap_,C=[],v=0;v<x.length;){var P=A[x.charAt(v++)],_=v<x.length,ha=_?A[x.charAt(v)]:0;++v;var ga=v<x.length,ka=ga?A[x.charAt(v)]:64;++v;var Va=v<x.length,Sa=Va?A[x.charAt(v)]:64;++v;if(P==null||ha==null||ka==null||Sa==null)throw Error();var Ia=P<<2|ha>>4;C.push(Ia);if(ka!==64){var Xe=ha<<4&240|ka>>2;C.push(Xe);if(Sa!==64){var oq=ka<<6&192|Sa;C.push(oq)}}}return C},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var x=0;x<this.ENCODED_VALS.length;x++)this.byteToCharMap_[x]=this.ENCODED_VALS.charAt(x),this.charToByteMap_[this.byteToCharMap_[x]]=x,this.byteToCharMapWebSafe_[x]=this.ENCODED_VALS_WEBSAFE.charAt(x),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[x]]=x,x>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(x)]=x,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(x)]=x)}}},j=function(x){var t=e(x);return g.encodeByteArray(t,!0)},i=function(x){try{return g.decodeString(x,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function k(x){return n(void 0,x)}function n(x,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:var A=t;return new Date(A.getTime());case Object:x===void 0&&(x={});break;case Array:x=[];break;default:return t}for(var C in t){if(!t.hasOwnProperty(C))continue;x[C]=n(x[C],t[C])}return x}var s=function(){function x(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(A,C){t.resolve=A,t.reject=C})}return x.prototype.wrapCallback=function(t){var A=this;return function(C,v){C?A.reject(C):A.resolve(v),typeof t==="function"&&(A.promise.catch(function(){}),t.length===1?t(C):t(C,v))}},x}();function w(){return typeof navigator!=="undefined"&&typeof navigator.userAgent==="string"?navigator.userAgent:""}function y(){return typeof window!=="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(w())}function B(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(x){return!1}}function G(){return typeof self==="object"&&self.self===self}function H(){var x=typeof chrome==="object"?chrome.runtime:typeof browser==="object"?browser.runtime:void 0;return typeof x==="object"&&x.id!==void 0}function R(){return typeof navigator==="object"&&navigator.product==="ReactNative"}function L(){return w().indexOf("Electron/")>=0}function S(){var x=w();return x.indexOf("MSIE ")>=0||x.indexOf("Trident/")>=0}function J(){return w().indexOf("MSAppHost/")>=0}function W(){return b.NODE_CLIENT===!0||b.NODE_ADMIN===!0}function X(){return!B()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function K(){return"indexedDB"in self&&indexedDB!==null}function q(){return new Promise(function(x,t){try{var A=!0,C="validate-browser-context-for-indexeddb-analytics-module",v=window.indexedDB.open(C);v.onsuccess=function(){v.result.close(),A||window.indexedDB.deleteDatabase(C),x(!0)},v.onupgradeneeded=function(){A=!1},v.onerror=function(){var P;t(((P=v.error)===null||P===void 0?void 0:P.message)||"")}}catch(P){t(P)}})}function r(){return!navigator||!navigator.cookieEnabled?!1:!0}var h="FirebaseError",m=function(x){a.__extends(t,x);function t(A,C){var v=x.call(this,C)||this;return v.code=A,v.name=h,Object.setPrototypeOf(v,t.prototype),Error.captureStackTrace&&Error.captureStackTrace(v,l.prototype.create),v}return t}(Error),l=function(){function x(t,A,C){this.service=t,this.serviceName=A,this.errors=C}return x.prototype.create=function(t){for(var A=[],C=1;C<arguments.length;C++)A[C-1]=arguments[C];for(var v=A[0]||{},P=this.service+"/"+t,_=this.errors[t],ha=_?p(_,v):"Error",ga=this.serviceName+": "+ha+" ("+P+").",ka=new m(P,ga),Va=0,Sa=Object.keys(v);Va<Sa.length;Va++){var Ia=Sa[Va];Ia.slice(-1)!=="_"&&(Ia in ka&&console.warn('Overwriting FirebaseError base field "'+Ia+'" can cause unexpected behavior.'),ka[Ia]=v[Ia])}return ka},x}();function p(x,t){return x.replace(u,function(A,C){var v=t[C];return v!=null?String(v):"<"+C+"?>"})}var u=/\{\$([^}]+)}/g;function o(x){return JSON.parse(x)}function E(x){return JSON.stringify(x)}var F=function(x){var t={},A={},C={},v="";try{var P=x.split(".");t=o(i(P[0])||""),A=o(i(P[1])||""),v=P[2],C=A.d||{},delete A.d}catch(_){}return{header:t,claims:A,data:C,signature:v}},Y=function(x){var t=F(x).claims,A=Math.floor(new Date().getTime()/1e3),C=0,v=0;return typeof t==="object"&&(t.hasOwnProperty("nbf")?C=t.nbf:t.hasOwnProperty("iat")&&(C=t.iat),t.hasOwnProperty("exp")?v=t.exp:v=C+86400),!!A&&!!C&&!!v&&A>=C&&A<=v},z=function(x){var t=F(x).claims;return typeof t==="object"&&t.hasOwnProperty("iat")?t.iat:null},Z=function(x){var t=F(x),A=t.claims;return!!A&&typeof A==="object"&&A.hasOwnProperty("iat")},M=function(x){var t=F(x).claims;return typeof t==="object"&&t.admin===!0};function D(x,t){return Object.prototype.hasOwnProperty.call(x,t)}function I(x,t){return Object.prototype.hasOwnProperty.call(x,t)?x[t]:void 0}function U(x){for(var t in x)if(Object.prototype.hasOwnProperty.call(x,t))return!1;return!0}function fa(x,t,A){var C={};for(var v in x)Object.prototype.hasOwnProperty.call(x,v)&&(C[v]=t.call(A,x[v],v,x));return C}function la(x){for(var t=[],A=function(ga,ka){Array.isArray(ka)?ka.forEach(function(Va){t.push(encodeURIComponent(ga)+"="+encodeURIComponent(Va))}):t.push(encodeURIComponent(ga)+"="+encodeURIComponent(ka))},C=0,v=Object.entries(x);C<v.length;C++){var P=v[C],_=P[0],ha=P[1];A(_,ha)}return t.length?"&"+t.join("&"):""}function ma(x){var t={},A=x.replace(/^\?/,"").split("&");return A.forEach(function(C){if(C){var v=C.split("=");t[v[0]]=v[1]}}),t}var ra=function(){function x(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}return x.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},x.prototype.compress_=function(t,A){A||(A=0);var C=this.W_;if(typeof t==="string")for(var v=0;v<16;v++)C[v]=t.charCodeAt(A)<<24|t.charCodeAt(A+1)<<16|t.charCodeAt(A+2)<<8|t.charCodeAt(A+3),A+=4;else for(var v=0;v<16;v++)C[v]=t[A]<<24|t[A+1]<<16|t[A+2]<<8|t[A+3],A+=4;for(var v=16;v<80;v++){var P=C[v-3]^C[v-8]^C[v-14]^C[v-16];C[v]=(P<<1|P>>>31)&4294967295}for(var _=this.chain_[0],ha=this.chain_[1],ga=this.chain_[2],ka=this.chain_[3],Va=this.chain_[4],Sa,Ia,v=0;v<80;v++){v<40?v<20?(Sa=ka^ha&(ga^ka),Ia=1518500249):(Sa=ha^ga^ka,Ia=1859775393):v<60?(Sa=ha&ga|ka&(ha|ga),Ia=2400959708):(Sa=ha^ga^ka,Ia=3395469782);var P=(_<<5|_>>>27)+Sa+Va+Ia+C[v]&4294967295;Va=ka,ka=ga,ga=(ha<<30|ha>>>2)&4294967295,ha=_,_=P}this.chain_[0]=this.chain_[0]+_&4294967295,this.chain_[1]=this.chain_[1]+ha&4294967295,this.chain_[2]=this.chain_[2]+ga&4294967295,this.chain_[3]=this.chain_[3]+ka&4294967295,this.chain_[4]=this.chain_[4]+Va&4294967295},x.prototype.update=function(t,A){if(t==null)return;A===void 0&&(A=t.length);for(var C=A-this.blockSize,v=0,P=this.buf_,_=this.inbuf_;v<A;){if(_===0)for(;v<=C;)this.compress_(t,v),v+=this.blockSize;if(typeof t==="string")for(;v<A;){P[_]=t.charCodeAt(v),++_,++v;if(_===this.blockSize){this.compress_(P),_=0;break}}else for(;v<A;){P[_]=t[v],++_,++v;if(_===this.blockSize){this.compress_(P),_=0;break}}}this.inbuf_=_,this.total_+=A},x.prototype.digest=function(){var t=[],A=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var C=this.blockSize-1;C>=56;C--)this.buf_[C]=A&255,A/=256;this.compress_(this.buf_);for(var v=0,C=0;C<5;C++)for(var P=24;P>=0;P-=8)t[v]=this.chain_[C]>>P&255,++v;return t},x}();function V(x,t){var A=new $(x,t);return A.subscribe.bind(A)}var $=function(){function x(t,A){var C=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=A,this.task.then(function(){t(C)}).catch(function(v){C.error(v)})}return x.prototype.next=function(t){this.forEachObserver(function(A){A.next(t)})},x.prototype.error=function(t){this.forEachObserver(function(A){A.error(t)}),this.close(t)},x.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},x.prototype.subscribe=function(t,A,C){var v=this,P;if(t===void 0&&A===void 0&&C===void 0)throw new Error("Missing Observer.");ja(t,["next","error","complete"])?P=t:P={next:t,error:A,complete:C},P.next===void 0&&(P.next=N),P.error===void 0&&(P.error=N),P.complete===void 0&&(P.complete=N);var _=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{v.finalError?P.error(v.finalError):P.complete()}catch(ha){}return}),this.observers.push(P),_},x.prototype.unsubscribeOne=function(t){if(this.observers===void 0||this.observers[t]===void 0)return;delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this)},x.prototype.forEachObserver=function(t){if(this.finalized)return;for(var A=0;A<this.observers.length;A++)this.sendOne(A,t)},x.prototype.sendOne=function(t,A){var C=this;this.task.then(function(){if(C.observers!==void 0&&C.observers[t]!==void 0)try{A(C.observers[t])}catch(v){typeof console!=="undefined"&&console.error&&console.error(v)}})},x.prototype.close=function(t){var A=this;if(this.finalized)return;this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(function(){A.observers=void 0,A.onNoObservers=void 0})},x}();function ia(x,t){return function(){for(var A=[],C=0;C<arguments.length;C++)A[C]=arguments[C];Promise.resolve(!0).then(function(){x.apply(void 0,A)}).catch(function(v){t&&t(v)})}}function ja(x,t){if(typeof x!=="object"||x===null)return!1;for(var A=0,C=t;A<C.length;A++){var v=C[A];if(v in x&&typeof x[v]==="function")return!0}return!1}function N(){}var T=function(x,t,A,C){var v;C<t?v="at least "+t:C>A&&(v=A===0?"none":"no more than "+A);if(v){var P=x+" failed: Was called with "+C+(C===1?" argument.":" arguments.")+" Expects "+v+".";throw new Error(P)}};function ea(x,t,A){var C="";switch(t){case 1:C=A?"first":"First";break;case 2:C=A?"second":"Second";break;case 3:C=A?"third":"Third";break;case 4:C=A?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var v=x+" failed: ";return v+=C+" argument ",v}function Q(x,t,A,C){if(C&&!A)return;if(typeof A!=="string")throw new Error(ea(x,t,C)+"must be a valid firebase namespace.")}function aa(x,t,A,C){if(C&&!A)return;if(typeof A!=="function")throw new Error(ea(x,t,C)+"must be a valid function.")}function na(x,t,A,C){if(C&&!A)return;if(typeof A!=="object"||A===null)throw new Error(ea(x,t,C)+"must be a valid context object.")}var sa=function(x){for(var t=[],A=0,C=0;C<x.length;C++){var v=x.charCodeAt(C);if(v>=55296&&v<=56319){var P=v-55296;C++,c(C<x.length,"Surrogate pair missing trail surrogate.");var _=x.charCodeAt(C)-56320;v=65536+(P<<10)+_}v<128?t[A++]=v:v<2048?(t[A++]=v>>6|192,t[A++]=v&63|128):v<65536?(t[A++]=v>>12|224,t[A++]=v>>6&63|128,t[A++]=v&63|128):(t[A++]=v>>18|240,t[A++]=v>>12&63|128,t[A++]=v>>6&63|128,t[A++]=v&63|128)}return t},za=function(x){for(var t=0,A=0;A<x.length;A++){var C=x.charCodeAt(A);C<128?t++:C<2048?t+=2:C>=55296&&C<=56319?(t+=4,A++):t+=3}return t};O.CONSTANTS=b;O.Deferred=s;O.ErrorFactory=l;O.FirebaseError=m;O.Sha1=ra;O.areCookiesEnabled=r;O.assert=c;O.assertionError=d;O.async=ia;O.base64=g;O.base64Decode=i;O.base64Encode=j;O.contains=D;O.createSubscribe=V;O.decode=F;O.deepCopy=k;O.deepExtend=n;O.errorPrefix=ea;O.getUA=w;O.isAdmin=M;O.isBrowser=G;O.isBrowserExtension=H;O.isElectron=L;O.isEmpty=U;O.isIE=S;O.isIndexedDBAvailable=K;O.isMobileCordova=y;O.isNode=B;O.isNodeSdk=W;O.isReactNative=R;O.isSafari=X;O.isUWP=J;O.isValidFormat=Z;O.isValidTimestamp=Y;O.issuedAtTime=z;O.jsonEval=o;O.map=fa;O.querystring=la;O.querystringDecode=ma;O.safeGet=I;O.stringLength=za;O.stringToByteArray=sa;O.stringify=E;O.validateArgCount=T;O.validateCallback=aa;O.validateContextObject=na;O.validateIndexedDBOpenable=q;O.validateNamespace=Q});var si=mb(q=>{ec(q,{__assign:()=>c,__asyncDelegator:()=>R,__asyncGenerator:()=>H,__asyncValues:()=>L,__await:()=>G,__awaiter:()=>j,__classPrivateFieldGet:()=>X,__classPrivateFieldSet:()=>K,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>W,__importStar:()=>J,__makeTemplateObject:()=>S,__metadata:()=>g,__param:()=>f,__read:()=>w,__rest:()=>d,__spread:()=>y,__spreadArrays:()=>B,__values:()=>s});var a=function(h,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,p){l.__proto__=p}||function(l,p){for(var u in p)p.hasOwnProperty(u)&&(l[u]=p[u])},a(h,m)};function b(h,m){a(h,m);function l(){this.constructor=h}h.prototype=m===null?Object.create(m):(l.prototype=m.prototype,new l())}var c=function(){return c=Object.assign||function h(m){for(var l,p=1,u=arguments.length;p<u;p++){l=arguments[p];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(m[o]=l[o])}return m},c.apply(this,arguments)};function d(h,m){var l={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&m.indexOf(p)<0&&(l[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var u=0,p=Object.getOwnPropertySymbols(h);u<p.length;u++)m.indexOf(p[u])<0&&Object.prototype.propertyIsEnumerable.call(h,p[u])&&(l[p[u]]=h[p[u]]);return l}function e(h,m,l,p){var u=arguments.length,o=u<3?m:p===null?p=Object.getOwnPropertyDescriptor(m,l):p,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(h,m,l,p);else for(var F=h.length-1;F>=0;F--)(E=h[F])&&(o=(u<3?E(o):u>3?E(m,l,o):E(m,l))||o);return u>3&&o&&Object.defineProperty(m,l,o),o}function f(h,m){return function(l,p){m(l,p,h)}}function g(h,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,m)}function j(h,m,l,p){function u(o){return o instanceof l?o:new l(function(E){E(o)})}return new(l||(l=Promise))(function(o,E){function F(Z){try{z(p.next(Z))}catch(M){E(M)}}function Y(Z){try{z(p.throw(Z))}catch(M){E(M)}}function z(Z){Z.done?o(Z.value):u(Z.value).then(F,Y)}z((p=p.apply(h,m||[])).next())})}function i(h,m){var l={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},p,u,o,E;return E={next:F(0),throw:F(1),return:F(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function F(z){return function(Z){return Y([z,Z])}}function Y(z){if(p)throw new TypeError("Generator is already executing.");for(;l;)try{if(p=1,u&&(o=z[0]&2?u.return:z[0]?u.throw||((o=u.return)&&o.call(u),0):u.next)&&!(o=o.call(u,z[1])).done)return o;(u=0,o)&&(z=[z[0]&2,o.value]);switch(z[0]){case 0:case 1:o=z;break;case 4:return l.label++,{value:z[1],done:!1};case 5:l.label++,u=z[1],z=[0];continue;case 7:z=l.ops.pop(),l.trys.pop();continue;default:if(!(o=l.trys,o=o.length>0&&o[o.length-1])&&(z[0]===6||z[0]===2)){l=0;continue}if(z[0]===3&&(!o||z[1]>o[0]&&z[1]<o[3])){l.label=z[1];break}if(z[0]===6&&l.label<o[1]){l.label=o[1],o=z;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(z);break}o[2]&&l.ops.pop(),l.trys.pop();continue}z=m.call(h,l)}catch(Z){z=[6,Z],u=0}finally{p=o=0}if(z[0]&5)throw z[1];return{value:z[0]?z[1]:void 0,done:!0}}}function k(h,m,l,p){p===void 0&&(p=l),h[p]=m[l]}function n(h,m){for(var l in h)l!=="default"&&!m.hasOwnProperty(l)&&(m[l]=h[l])}function s(h){var m=typeof Symbol==="function"&&Symbol.iterator,l=m&&h[m],p=0;if(l)return l.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function w(h,m){var l=typeof Symbol==="function"&&h[Symbol.iterator];if(!l)return h;var p=l.call(h),u,o=[],E;try{for(;(m===void 0||m-- >0)&&!(u=p.next()).done;)o.push(u.value)}catch(F){E={error:F}}finally{try{u&&!u.done&&(l=p.return)&&l.call(p)}finally{if(E)throw E.error}}return o}function y(){for(var h=[],m=0;m<arguments.length;m++)h=h.concat(w(arguments[m]));return h}function B(){for(var h=0,m=0,l=arguments.length;m<l;m++)h+=arguments[m].length;for(var p=Array(h),u=0,m=0;m<l;m++)for(var o=arguments[m],E=0,F=o.length;E<F;E++,u++)p[u]=o[E];return p}function G(h){return this instanceof G?(this.v=h,this):new G(h)}function H(h,m,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=l.apply(h,m||[]),u,o=[];return u={},E("next"),E("throw"),E("return"),u[Symbol.asyncIterator]=function(){return this},u;function E(D){p[D]&&(u[D]=function(I){return new Promise(function(U,fa){o.push([D,I,U,fa])>1||F(D,I)})})}function F(D,I){try{Y(p[D](I))}catch(U){M(o[0][3],U)}}function Y(D){D.value instanceof G?Promise.resolve(D.value.v).then(z,Z):M(o[0][2],D)}function z(D){F("next",D)}function Z(D){F("throw",D)}function M(D,I){(D(I),o.shift(),o.length)&&F(o[0][0],o[0][1])}}function R(h){var m,l;return m={},p("next"),p("throw",function(u){throw u}),p("return"),m[Symbol.iterator]=function(){return this},m;function p(u,o){m[u]=h[u]?function(E){return(l=!l)?{value:G(h[u](E)),done:u==="return"}:o?o(E):E}:o}}function L(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=h[Symbol.asyncIterator],l;return m?m.call(h):(h=typeof s==="function"?s(h):h[Symbol.iterator](),l={},p("next"),p("throw"),p("return"),l[Symbol.asyncIterator]=function(){return this},l);function p(o){l[o]=h[o]&&function(E){return new Promise(function(F,Y){E=h[o](E),u(F,Y,E.done,E.value)})}}function u(o,E,F,Y){Promise.resolve(Y).then(function(z){o({value:z,done:F})},E)}}function S(h,m){return Object.defineProperty?Object.defineProperty(h,"raw",{value:m}):h.raw=m,h}function J(h){if(h&&h.__esModule)return h;var m={};if(h!=null)for(var l in h)Object.hasOwnProperty.call(h,l)&&(m[l]=h[l]);return m.default=h,m}function W(h){return h&&h.__esModule?h:{default:h}}function X(h,m){if(!m.has(h))throw new TypeError("attempted to get private field on non-instance");return m.get(h)}function K(h,m,l){if(!m.has(h))throw new TypeError("attempted to set private field on non-instance");return m.set(h,l),l}});var ri=mb(i=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=si(),b=cf(),c=function(){function n(s,w,y){this.name=s,this.instanceFactory=w,this.type=y,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return n.prototype.setInstantiationMode=function(s){return this.instantiationMode=s,this},n.prototype.setMultipleInstances=function(s){return this.multipleInstances=s,this},n.prototype.setServiceProps=function(s){return this.serviceProps=s,this},n}();var d="[DEFAULT]";var e=function(){function n(s,w){this.name=s,this.container=w,this.component=null,this.instances=new Map(),this.instancesDeferred=new Map()}return n.prototype.get=function(s){s===void 0&&(s=d);var w=this.normalizeInstanceIdentifier(s);if(!this.instancesDeferred.has(w)){var y=new b.Deferred();this.instancesDeferred.set(w,y);try{var B=this.getOrInitializeService(w);B&&y.resolve(B)}catch(G){}}return this.instancesDeferred.get(w).promise},n.prototype.getImmediate=function(s){var w=a.__assign({identifier:d,optional:!1},s),y=w.identifier,B=w.optional,G=this.normalizeInstanceIdentifier(y);try{var H=this.getOrInitializeService(G);if(!H){if(B)return null;throw Error("Service "+this.name+" is not available")}return H}catch(R){if(B)return null;throw R}},n.prototype.getComponent=function(){return this.component},n.prototype.setComponent=function(s){var w,y;if(s.name!==this.name)throw Error("Mismatching Component "+s.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");this.component=s;if(g(s))try{this.getOrInitializeService(d)}catch(W){}try{for(var B=a.__values(this.instancesDeferred.entries()),G=B.next();!G.done;G=B.next()){var H=a.__read(G.value,2),R=H[0],L=H[1],S=this.normalizeInstanceIdentifier(R);try{var J=this.getOrInitializeService(S);L.resolve(J)}catch(W){}}}catch(W){w={error:W}}finally{try{G&&!G.done&&(y=B.return)&&y.call(B)}finally{if(w)throw w.error}}},n.prototype.clearInstance=function(s){s===void 0&&(s=d),this.instancesDeferred.delete(s),this.instances.delete(s)},n.prototype.delete=function(){return a.__awaiter(this,void 0,void 0,function(){var s;return a.__generator(this,function(w){switch(w.label){case 0:return s=Array.from(this.instances.values()),[4,Promise.all(s.filter(function(y){return"INTERNAL"in y}).map(function(y){return y.INTERNAL.delete()}))];case 1:return w.sent(),[2]}})})},n.prototype.isComponentSet=function(){return this.component!=null},n.prototype.getOrInitializeService=function(s){var w=this.instances.get(s);return!w&&this.component&&(w=this.component.instanceFactory(this.container,f(s)),this.instances.set(s,w)),w||null},n.prototype.normalizeInstanceIdentifier=function(s){return this.component?this.component.multipleInstances?s:d:s},n}();function f(n){return n===d?void 0:n}function g(n){return n.instantiationMode==="EAGER"}var j=function(){function n(s){this.name=s,this.providers=new Map()}return n.prototype.addComponent=function(s){var w=this.getProvider(s.name);if(w.isComponentSet())throw new Error("Component "+s.name+" has already been registered with "+this.name);w.setComponent(s)},n.prototype.addOrOverwriteComponent=function(s){var w=this.getProvider(s.name);w.isComponentSet()&&this.providers.delete(s.name),this.addComponent(s)},n.prototype.getProvider=function(s){if(this.providers.has(s))return this.providers.get(s);var w=new e(s,this);return this.providers.set(s,w),w},n.prototype.getProviders=function(){return Array.from(this.providers.values())},n}();i.Component=c;i.ComponentContainer=j;i.Provider=e});var ti=mb(s=>{ec(s,{LogLevel:()=>d,Logger:()=>i,setLogLevel:()=>k,setUserLogHandler:()=>n});function a(){for(var y=0,B=0,G=arguments.length;B<G;B++)y+=arguments[B].length;for(var H=Array(y),R=0,B=0;B<G;B++)for(var L=arguments[B],S=0,J=L.length;S<J;S++,R++)H[R]=L[S];return H}var b,c=[],d;(function(y){y[y.DEBUG=0]="DEBUG",y[y.VERBOSE=1]="VERBOSE",y[y.INFO=2]="INFO",y[y.WARN=3]="WARN",y[y.ERROR=4]="ERROR",y[y.SILENT=5]="SILENT"})(d||(d={}));var e={debug:d.DEBUG,verbose:d.VERBOSE,info:d.INFO,warn:d.WARN,error:d.ERROR,silent:d.SILENT},f=d.INFO,g=(b={},b[d.DEBUG]="log",b[d.VERBOSE]="log",b[d.INFO]="info",b[d.WARN]="warn",b[d.ERROR]="error",b),j=function(y,B){for(var G=[],H=2;H<arguments.length;H++)G[H-2]=arguments[H];if(B<y.logLevel)return;var R=new Date().toISOString(),L=g[B];if(L)console[L].apply(console,a(["["+R+"]  "+y.name+":"],G));else throw new Error("Attempted to log a message with an invalid logType (value: "+B+")")},i=function(){function y(B){this.name=B,this._logLevel=f,this._logHandler=j,this._userLogHandler=null,c.push(this)}return Object.defineProperty(y.prototype,"logLevel",{get:function(){return this._logLevel},set:function(B){if(!(B in d))throw new TypeError('Invalid value "'+B+'" assigned to `logLevel`');this._logLevel=B},enumerable:!1,configurable:!0}),y.prototype.setLogLevel=function(B){this._logLevel=typeof B==="string"?e[B]:B},Object.defineProperty(y.prototype,"logHandler",{get:function(){return this._logHandler},set:function(B){if(typeof B!=="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=B},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(B){this._userLogHandler=B},enumerable:!1,configurable:!0}),y.prototype.debug=function(){for(var B=[],G=0;G<arguments.length;G++)B[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.DEBUG],B)),this._logHandler.apply(this,a([this,d.DEBUG],B))},y.prototype.log=function(){for(var B=[],G=0;G<arguments.length;G++)B[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.VERBOSE],B)),this._logHandler.apply(this,a([this,d.VERBOSE],B))},y.prototype.info=function(){for(var B=[],G=0;G<arguments.length;G++)B[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.INFO],B)),this._logHandler.apply(this,a([this,d.INFO],B))},y.prototype.warn=function(){for(var B=[],G=0;G<arguments.length;G++)B[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.WARN],B)),this._logHandler.apply(this,a([this,d.WARN],B))},y.prototype.error=function(){for(var B=[],G=0;G<arguments.length;G++)B[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.ERROR],B)),this._logHandler.apply(this,a([this,d.ERROR],B))},y}();function k(y){c.forEach(function(B){B.setLogLevel(y)})}function n(y,B){for(var G=function(S){var J=null;B&&B.level&&(J=e[B.level]),y===null?S.userLogHandler=null:S.userLogHandler=function(W,X){for(var K=[],q=2;q<arguments.length;q++)K[q-2]=arguments[q];var r=K.map(function(h){if(h==null)return null;{if(typeof h==="string")return h;{if(typeof h==="number"||typeof h==="boolean")return h.toString();{if(h instanceof Error)return h.message;try{return JSON.stringify(h)}catch(m){return null}}}}}).filter(function(h){return h}).join(" ");X>=(J!==null&&J!==void 0?J:W.logLevel)&&y({level:d[X].toLowerCase(),message:r,args:K,type:W.name})}},H=0,R=c;H<R.length;H++){var L=R[H];G(L)}}});var pi=mb(z=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0});var a=qi(),b=cf(),c=ri(),d=ti();var e,f=(e={},e["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",e["bad-app-name"]="Illegal App name: '{$appName}",e["duplicate-app"]="Firebase App named '{$appName}' already exists",e["app-deleted"]="Firebase App named '{$appName}' already deleted",e["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",e["invalid-log-argument"]="First argument to `onLog` must be null or a function.",e),g=new b.ErrorFactory("app","Firebase",f),j="@firebase/app",i="0.6.10",k="@firebase/analytics",n="@firebase/auth",s="@firebase/database",w="@firebase/functions",y="@firebase/installations",B="@firebase/messaging",G="@firebase/performance",H="@firebase/remote-config",R="@firebase/storage",L="@firebase/firestore",S="firebase-wrapper";var J,W="[DEFAULT]",X=(J={},J[j]="fire-core",J[k]="fire-analytics",J[n]="fire-auth",J[s]="fire-rtdb",J[w]="fire-fn",J[y]="fire-iid",J[B]="fire-fcm",J[G]="fire-perf",J[H]="fire-rc",J[R]="fire-gcs",J[L]="fire-fst",J["fire-js"]="fire-js",J[S]="fire-js-all",J);var K=new d.Logger("@firebase/app");var q=function(){function M(D,I,U){var fa,la,ma=this;this.firebase_=U,this.isDeleted_=!1,this.name_=I.name,this.automaticDataCollectionEnabled_=I.automaticDataCollectionEnabled||!1,this.options_=b.deepCopy(D),this.container=new c.ComponentContainer(I.name),this._addComponent(new c.Component("app",function(){return ma},"PUBLIC"));try{for(var ra=a.__values(this.firebase_.INTERNAL.components.values()),V=ra.next();!V.done;V=ra.next()){var $=V.value;this._addComponent($)}}catch(ia){fa={error:ia}}finally{try{V&&!V.done&&(la=ra.return)&&la.call(ra)}finally{if(fa)throw fa.error}}}return Object.defineProperty(M.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(D){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=D},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),M.prototype.delete=function(){var D=this;return new Promise(function(I){D.checkDestroyed_(),I()}).then(function(){return D.firebase_.INTERNAL.removeApp(D.name_),Promise.all(D.container.getProviders().map(function(I){return I.delete()}))}).then(function(){D.isDeleted_=!0})},M.prototype._getService=function(D,I){return I===void 0&&(I=W),this.checkDestroyed_(),this.container.getProvider(D).getImmediate({identifier:I})},M.prototype._removeServiceInstance=function(D,I){I===void 0&&(I=W),this.container.getProvider(D).clearInstance(I)},M.prototype._addComponent=function(D){try{this.container.addComponent(D)}catch(I){K.debug("Component "+D.name+" failed to register with FirebaseApp "+this.name,I)}},M.prototype._addOrOverwriteComponent=function(D){this.container.addOrOverwriteComponent(D)},M.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw g.create("app-deleted",{appName:this.name_})},M}();q.prototype.name&&q.prototype.options||q.prototype.delete||console.log("dc");var r="7.18.0";function h(M){var D={},I=new Map(),U={__esModule:!0,initializeApp:ma,app:la,registerVersion:$,setLogLevel:d.setLogLevel,onLog:ia,apps:null,SDK_VERSION:r,INTERNAL:{registerComponent:V,removeApp:fa,components:I,useAsService:ja}};U.default=U,Object.defineProperty(U,"apps",{get:ra});function fa(N){delete D[N]}function la(N){N=N||W;if(!b.contains(D,N))throw g.create("no-app",{appName:N});return D[N]}la.App=M;function ma(N,T){T===void 0&&(T={});if(typeof T!=="object"||T===null){var ea=T;T={name:ea}}var Q=T;Q.name===void 0&&(Q.name=W);var aa=Q.name;if(typeof aa!=="string"||!aa)throw g.create("bad-app-name",{appName:String(aa)});if(b.contains(D,aa))throw g.create("duplicate-app",{appName:aa});var na=new M(N,Q,U);return D[aa]=na,na}function ra(){return Object.keys(D).map(function(N){return D[N]})}function V(N){var T,ea,Q=N.name;if(I.has(Q))return K.debug("There were multiple attempts to register component "+Q+"."),N.type==="PUBLIC"?U[Q]:null;I.set(Q,N);if(N.type==="PUBLIC"){var aa=function(O){O===void 0&&(O=la());if(typeof O[Q]!=="function")throw g.create("invalid-app-argument",{appName:Q});return O[Q]()};N.serviceProps!==void 0&&b.deepExtend(aa,N.serviceProps),U[Q]=aa,M.prototype[Q]=function(){for(var O=[],Aa=0;Aa<arguments.length;Aa++)O[Aa]=arguments[Aa];var x=this._getService.bind(this,Q);return x.apply(this,N.multipleInstances?O:[])}}try{for(var na=a.__values(Object.keys(D)),sa=na.next();!sa.done;sa=na.next()){var za=sa.value;D[za]._addComponent(N)}}catch(O){T={error:O}}finally{try{sa&&!sa.done&&(ea=na.return)&&ea.call(na)}finally{if(T)throw T.error}}return N.type==="PUBLIC"?U[Q]:null}function $(N,T,ea){var Q,aa=(Q=X[N])!==null&&Q!==void 0?Q:N;ea&&(aa+="-"+ea);var na=aa.match(/\s|\//),sa=T.match(/\s|\//);if(na||sa){var za=['Unable to register library "'+aa+'" with version "'+T+'":'];na&&za.push('library name "'+aa+'" contains illegal characters (whitespace or "/")'),na&&sa&&za.push("and"),sa&&za.push('version name "'+T+'" contains illegal characters (whitespace or "/")'),K.warn(za.join(" "));return}V(new c.Component(aa+"-version",function(){return{library:aa,version:T}},"VERSION"))}function ia(N,T){if(N!==null&&typeof N!=="function")throw g.create("invalid-log-argument",{appName:name});d.setUserLogHandler(N,T)}function ja(N,T){if(T==="serverAuth")return null;var ea=T;return ea}return U}function m(){var M=h(q);M.INTERNAL=a.__assign(a.__assign({},M.INTERNAL),{createFirebaseNamespace:m,extendNamespace:D,createSubscribe:b.createSubscribe,ErrorFactory:b.ErrorFactory,deepExtend:b.deepExtend});function D(I){b.deepExtend(M,I)}return M}var l=m();var p=function(){function M(D){this.container=D}return M.prototype.getPlatformInfoString=function(){var D=this.container.getProviders();return D.map(function(I){if(u(I)){var U=I.getImmediate();return U.library+"/"+U.version}else return null}).filter(function(I){return I}).join(" ")},M}();function u(M){var D=M.getComponent();return(D===null||D===void 0?void 0:D.type)==="VERSION"}function o(M,D){M.INTERNAL.registerComponent(new c.Component("platform-logger",function(I){return new p(I)},"PRIVATE")),M.registerVersion(j,i,D),M.registerVersion("fire-js","")}if(b.isBrowser()&&self.firebase!==void 0){K.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);var E=self.firebase.SDK_VERSION;E&&E.indexOf("LITE")>=0&&K.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}var F=l.initializeApp;l.initializeApp=function(){for(var M=[],D=0;D<arguments.length;D++)M[D]=arguments[D];return b.isNode()&&K.warn(`
      Warning: This is a browser-targeted Firebase bundle but it appears it is being
      run in a Node environment.  If running in a Node environment, make sure you
      are using the bundle specified by the "main" field in package.json.
      
      If you are using Webpack, you can specify "main" as the first item in
      "resolve.mainFields":
      https://webpack.js.org/configuration/resolve/#resolvemainfields
      
      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"
      as the first item in "mainFields", e.g. ['main', 'module'].
      https://github.com/rollup/rollup-plugin-node-resolve
      `),F.apply(void 0,M)};var Y=l;o(Y);z.default=Y;z.firebase=Y});var Ma=mb((e,f)=>{"use strict";function a(g){return g&&typeof g==="object"&&"default"in g?g.default:g}var b=a(pi()),c="firebase",d="7.19.0";b.registerVersion(c,d,"app");f.exports=b});var zn=mb((b,c)=>{var a=function(){function d(k,n){if(!j[k]){j[k]={};for(var s=0;s<k.length;s++)j[k][k.charAt(s)]=s}return j[k][n]}var e=String.fromCharCode,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",j={},i={compressToBase64:function(k){if(null==k)return"";var n=i._compress(k,6,function(s){return f.charAt(s)});switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(k){return null==k?"":""==k?null:i._decompress(k.length,32,function(n){return d(f,k.charAt(n))})},compressToUTF16:function(k){return null==k?"":i._compress(k,15,function(n){return e(n+32)})+" "},decompressFromUTF16:function(k){return null==k?"":""==k?null:i._decompress(k.length,16384,function(n){return k.charCodeAt(n)-32})},compressToUint8Array:function(k){for(var n=i.compress(k),s=new Uint8Array(2*n.length),w=0,y=n.length;y>w;w++){var B=n.charCodeAt(w);s[2*w]=B>>>8,s[2*w+1]=B%256}return s},decompressFromUint8Array:function(k){if(null===k||void 0===k)return i.decompress(k);for(var n=new Array(k.length/2),s=0,w=n.length;w>s;s++)n[s]=256*k[2*s]+k[2*s+1];var y=[];return n.forEach(function(B){y.push(e(B))}),i.decompress(y.join(""))},compressToEncodedURIComponent:function(k){return null==k?"":i._compress(k,6,function(n){return g.charAt(n)})},decompressFromEncodedURIComponent:function(k){return null==k?"":""==k?null:(k=k.replace(/ /g,"+"),i._decompress(k.length,32,function(n){return d(g,k.charAt(n))}))},compress:function(k){return i._compress(k,16,function(n){return e(n)})},_compress:function(k,n,s){if(null==k)return"";var w,y,B,G={},H={},R="",L="",S="",J=2,W=3,X=2,K=[],q=0,r=0;for(B=0;B<k.length;B+=1)if(R=k.charAt(B),Object.prototype.hasOwnProperty.call(G,R)||(G[R]=W++,H[R]=!0),L=S+R,Object.prototype.hasOwnProperty.call(G,L))S=L;else{if(Object.prototype.hasOwnProperty.call(H,S)){if(S.charCodeAt(0)<256){for(w=0;X>w;w++)q<<=1,r==n-1?(r=0,K.push(s(q)),q=0):r++;for(y=S.charCodeAt(0),w=0;8>w;w++)q=q<<1|1&y,r==n-1?(r=0,K.push(s(q)),q=0):r++,y>>=1}else{for(y=1,w=0;X>w;w++)q=q<<1|y,r==n-1?(r=0,K.push(s(q)),q=0):r++,y=0;for(y=S.charCodeAt(0),w=0;16>w;w++)q=q<<1|1&y,r==n-1?(r=0,K.push(s(q)),q=0):r++,y>>=1}J--,0==J&&(J=Math.pow(2,X),X++),delete H[S]}else for(y=G[S],w=0;X>w;w++)q=q<<1|1&y,r==n-1?(r=0,K.push(s(q)),q=0):r++,y>>=1;J--,0==J&&(J=Math.pow(2,X),X++),G[L]=W++,S=String(R)}if(""!==S){if(Object.prototype.hasOwnProperty.call(H,S)){if(S.charCodeAt(0)<256){for(w=0;X>w;w++)q<<=1,r==n-1?(r=0,K.push(s(q)),q=0):r++;for(y=S.charCodeAt(0),w=0;8>w;w++)q=q<<1|1&y,r==n-1?(r=0,K.push(s(q)),q=0):r++,y>>=1}else{for(y=1,w=0;X>w;w++)q=q<<1|y,r==n-1?(r=0,K.push(s(q)),q=0):r++,y=0;for(y=S.charCodeAt(0),w=0;16>w;w++)q=q<<1|1&y,r==n-1?(r=0,K.push(s(q)),q=0):r++,y>>=1}J--,0==J&&(J=Math.pow(2,X),X++),delete H[S]}else for(y=G[S],w=0;X>w;w++)q=q<<1|1&y,r==n-1?(r=0,K.push(s(q)),q=0):r++,y>>=1;J--,0==J&&(J=Math.pow(2,X),X++)}for(y=2,w=0;X>w;w++)q=q<<1|1&y,r==n-1?(r=0,K.push(s(q)),q=0):r++,y>>=1;for(;;){if(q<<=1,r==n-1){K.push(s(q));break}r++}return K.join("")},decompress:function(k){return null==k?"":""==k?null:i._decompress(k.length,32768,function(n){return k.charCodeAt(n)})},_decompress:function(k,n,s){var w,y,B,G,H,R,L,S,J=[],W=4,X=4,K=3,q="",r=[],h={val:s(0),position:n,index:1};for(y=0;3>y;y+=1)J[y]=y;for(G=0,R=Math.pow(2,2),L=1;L!=R;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=s(h.index++)),G|=(H>0?1:0)*L,L<<=1;switch(w=G){case 0:for(G=0,R=Math.pow(2,8),L=1;L!=R;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=s(h.index++)),G|=(H>0?1:0)*L,L<<=1;S=e(G);break;case 1:for(G=0,R=Math.pow(2,16),L=1;L!=R;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=s(h.index++)),G|=(H>0?1:0)*L,L<<=1;S=e(G);break;case 2:return""}for(J[3]=S,B=S,r.push(S);;){if(h.index>k)return"";for(G=0,R=Math.pow(2,K),L=1;L!=R;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=s(h.index++)),G|=(H>0?1:0)*L,L<<=1;switch(S=G){case 0:for(G=0,R=Math.pow(2,8),L=1;L!=R;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=s(h.index++)),G|=(H>0?1:0)*L,L<<=1;J[X++]=e(G),S=X-1,W--;break;case 1:for(G=0,R=Math.pow(2,16),L=1;L!=R;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=s(h.index++)),G|=(H>0?1:0)*L,L<<=1;J[X++]=e(G),S=X-1,W--;break;case 2:return r.join("")}if(0==W&&(W=Math.pow(2,K),K++),J[S])q=J[S];else{if(S!==X)return null;q=B+B.charAt(0)}r.push(q),J[X++]=B+q.charAt(0),W--,B=q,0==W&&(W=Math.pow(2,K),K++)}}};return i}();"function"==typeof define&&define.amd?define(function(){return a}):"undefined"!=typeof c&&null!=c&&(c.exports=a)});let zi,Ai=0,Bi=0;const wa={get:()=>zi,set:a=>{zi=a},getFrame:()=>Ai,setFrame:a=>{Ai=a},getElapsed:()=>Bi,setElapsed:a=>{Bi=a}};let Fi=0;function Ye(a=0){return()=>{Fi=a}}function kd(){return Fi}let hf="Phaser",Dn="https://phaser4.io",En="#fff",Fn="linear-gradient(#3e0081 40%, #00bcc3)";function df(){if(hf!==""){const a=wa.get(),b=hf==="Phaser"?" v"+a.VERSION:"";console.log(`%c${hf}${b}%c ${Dn}`,`padding: 4px 16px; color: ${En}; background: ${Fn}`,"")}}let Ki=800,Li=600,Mi=1;function $e(a=800,b=600,c=1){return c===0&&(c=window.devicePixelRatio),()=>{Ki=a,Li=b,Mi=c}}function fc(){return Ki}function gc(){return Li}function hc(){return Mi}const yf=[],kc={add:a=>{yf.push(a)},get:()=>yf,clear:()=>{yf.length=0}};let Ji;function ld(a){Ji=a}function ef(){return Ji}let jf=.5,kf=.5;let Gi=0;function lf(a){Gi=a}function Dc(){return Gi}function md(a){let b;return a&&(typeof a==="string"?b=document.getElementById(a):typeof a==="object"&&a.nodeType===1&&(b=a)),b||(b=document.body),b}let Hi;function Ze(a){return()=>{a&&(Hi=md(a))}}function ff(){return Hi}let Ii=[];function _e(a){return()=>{Ii=[].concat(a)}}function mf(){return Ii}let Hn={alpha:!1,antialias:!1,depth:!1,premultipliedAlpha:!1};function nf(){return Hn}class gj{constructor(a){this.stack=[],this.current=null,this.renderer=a}reset(){this.stack=[],this.current=null;const a=this.renderer,b=a.gl;b.bindFramebuffer(b.FRAMEBUFFER,null),b.viewport(0,0,a.width,a.height)}add(a,b=!0,c=0,d=0){this.stack.push({framebuffer:a,width:c,height:d}),this.set(a,b,c,d)}set(a,b=!0,c=0,d=0){const e=this.renderer,f=e.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),b&&(f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),c>0&&f.viewport(0,0,c,d),this.current=a}pop(){this.stack.pop();const a=this.stack.length;if(a>0){const b=this.stack[a-1];this.set(b.framebuffer,!1,b.width,b.height)}else this.reset()}rebind(){const a=this.renderer.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.current)}destroy(){this.stack=[]}}let fj;const Ba={get:()=>fj,set:a=>{fj=a}};function hj(a,b=[]){const c=a>>16&255,d=a>>8&255,e=a&255,f=a>16777215?a>>>24:255;return b[0]=c/255,b[1]=d/255,b[2]=e/255,b[3]=f/255,b}function cj(a,b){return a.a===b.a&&a.b===b.b&&a.c===b.c&&a.d===b.d&&a.tx===b.tx&&a.ty===b.ty}function oj(a,b){const c=Ba.get();b||(b=c.COLOR_ATTACHMENT0);const d=c.createFramebuffer();return c.bindFramebuffer(c.FRAMEBUFFER,d),c.framebufferTexture2D(c.FRAMEBUFFER,b,c.TEXTURE_2D,a,0),c.bindFramebuffer(c.FRAMEBUFFER,null),d}function vd(a){const b=Ba.get();if(!b)return;const{parent:c,flipY:d,unpackPremultiplyAlpha:e,minFilter:f,magFilter:g,wrapS:j,wrapT:i,generateMipmap:k,isPOT:n}=a,s=c.image;let w=c.width,y=c.height;const B=b.createTexture();return b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,B),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,d),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),s?(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,s),w=s.width,y=s.height):b.texImage2D(b.TEXTURE_2D,0,b.RGBA,w,y,0,b.RGBA,b.UNSIGNED_BYTE,null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,g),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,j),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,i),k&&n&&b.generateMipmap(b.TEXTURE_2D),a.texture=B,B}function pj(a){const b=Ba.get();b&&b.isFramebuffer(a)&&b.deleteFramebuffer(a)}function zf(a){const b=Ba.get();if(!b)return;b.isTexture(a)&&b.deleteTexture(a)}function dj(a,b){return a<1||b<1?!1:(a&a-1)===0&&(b&b-1)===0}function sj(a,b=!0){const c=Ba.get();c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,a);const d=b?c.LINEAR:c.NEAREST;c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,d),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,d)}function tj(a){const b=Ba.get(),c=a.parent.image,d=c.width,e=c.height;return d>0&&e>0&&(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,a.texture),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,a.flipY),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,c)),a.texture}class ud{constructor(a,b={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1;const c=Ba.get();this.parent=a,this.isPOT=dj(a.width,a.height);const{texture:d=null,framebuffer:e=null,unpackPremultiplyAlpha:f=!0,minFilter:g=c.LINEAR,magFilter:j=c.LINEAR,wrapS:i=c.CLAMP_TO_EDGE,wrapT:k=c.CLAMP_TO_EDGE,generateMipmap:n=this.isPOT,flipY:s=!1}=b;this.minFilter=g,this.magFilter=j,this.wrapS=i,this.wrapT=k,this.generateMipmap=n,this.flipY=s,this.unpackPremultiplyAlpha=f,e&&(this.framebuffer=e),d?this.texture=d:vd(this)}setFilter(a){this.texture&&sj(this.texture,a)}create(){const a=this.texture;return a&&zf(a),vd(this)}update(){const a=this.texture;return a?tj(this):vd(this)}setIndex(a){this.dirtyIndex=a!==this.index,this.index=a}destroy(){zf(this.texture),pj(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}}class nj{constructor(a,b,c,d,e){this.batchSize=a,this.dataSize=b,this.indexSize=c,this.vertexElementSize=d,this.quadIndexSize=e,this.vertexByteSize=d*b,this.quadByteSize=this.vertexByteSize*4,this.quadElementSize=d*4,this.bufferByteSize=a*this.quadByteSize,this.create()}create(){let a=[];for(let c=0;c<this.batchSize*this.indexSize;c+=this.indexSize)a.push(c+0,c+1,c+2,c+2,c+3,c+0);this.data=new ArrayBuffer(this.bufferByteSize),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const b=Ba.get();this.vertexBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.data,b.DYNAMIC_DRAW),this.indexBuffer=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.index,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,null),a=[]}destroy(){}}class Af{constructor(a,b,c,d,e,f){this.trimmed=!1,this.texture=a,this.key=b,this.x=c,this.y=d,this.width=e,this.height=f,this.sourceSizeWidth=e,this.sourceSizeHeight=f,this.updateUVs()}setPivot(a,b){this.pivot={x:a,y:b}}setSize(a,b){this.width=a,this.height=b,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.updateUVs()}setSourceSize(a,b){this.sourceSizeWidth=a,this.sourceSizeHeight=b}setTrim(a,b,c,d,e,f){this.trimmed=!0,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.spriteSourceSizeX=c,this.spriteSourceSizeY=d,this.spriteSourceSizeWidth=e,this.spriteSourceSizeHeight=f}getExtent(a,b){const c=this.sourceSizeWidth,d=this.sourceSizeHeight;let e,f,g,j;return this.trimmed?(e=this.spriteSourceSizeX-a*c,f=e+this.spriteSourceSizeWidth,g=this.spriteSourceSizeY-b*d,j=g+this.spriteSourceSizeHeight):(e=-a*c,f=e+c,g=-b*d,j=g+d),{left:e,right:f,top:g,bottom:j}}setExtent(a){const b=a.transform,c=b.origin.x,d=b.origin.y,e=this.sourceSizeWidth,f=this.sourceSizeHeight;let g,j,i,k;this.trimmed?(g=this.spriteSourceSizeX-c*e,j=this.spriteSourceSizeY-d*f,i=this.spriteSourceSizeWidth,k=this.spriteSourceSizeHeight):(g=-c*e,j=-d*f,i=e,k=f),b.setExtent(g,j,i,k)}updateUVs(){const{x:a,y:b,width:c,height:d}=this,e=this.texture.width,f=this.texture.height;this.u0=a/e,this.v0=b/f,this.u1=(a+c)/e,this.v1=(b+d)/f}}class db{constructor(a,b,c){this.key="",a&&(b=a.width,c=a.height),this.image=a,this.width=b,this.height=c,this.frames=new Map(),this.data={},this.addFrame("__BASE",0,0,b,c),kc.add(this)}addFrame(a,b,c,d,e){if(this.frames.has(a))return null;const f=new Af(this,a,b,c,d,e);return this.frames.set(a,f),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=f),f}getFrame(a){if(!a)return this.firstFrame;a instanceof Af&&(a=a.key);let b=this.frames.get(a);return b||(console.warn(`Frame missing: ${a}`),b=this.firstFrame),b}setSize(a,b){this.width=a,this.height=b;const c=this.frames.get("__BASE");c.setSize(a,b)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}}let mj;const Kc={get:()=>mj,set:a=>{mj=a}};const rj={fragmentShader:`\r
#define SHADER_NAME SINGLE_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture;\r
\r
void main (void)\r
{\r
    vec4 color = texture2D(uTexture, vTextureCoord);\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`,vertexShader:`\r
#define SHADER_NAME SINGLE_QUAD_VERT\r
\r
precision highp float;\r
\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
attribute float aTextureId;\r
attribute vec4 aTintColor;\r
\r
uniform mat4 uProjectionMatrix;\r
uniform mat4 uCameraMatrix;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
void main (void)\r
{\r
    vTextureCoord = aTextureCoord;\r
    vTextureId = aTextureId;\r
    vTintColor = aTintColor;\r
\r
    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\r
}`};class td{constructor(a={}){this.attribs={aVertexPosition:0,aTextureCoord:0,aTextureId:0,aTintColor:0},this.uniforms={uProjectionMatrix:0,uCameraMatrix:0,uTexture:0,uTime:0,uResolution:0},this.renderToFBO=!1,this.renderer=Kc.get();const{batchSize:b=4096,dataSize:c=4,indexSize:d=4,vertexElementSize:e=6,quadIndexSize:f=6,fragmentShader:g=rj.fragmentShader,vertexShader:j=rj.vertexShader,width:i=fc(),height:k=gc(),resolution:n=hc(),renderToFBO:s=!1}=a;this.buffer=new nj(b,c,d,e,f),this.createShaders(g,j),this.count=0,this.renderToFBO=s;const w=new db(null,i*n,k*n),y=new ud(w);w.binding=y,y.framebuffer=oj(y.texture),this.texture=w,this.framebuffer=y.framebuffer}createShaders(a,b){const c=this.renderer.gl,d=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(d,a),c.compileShader(d);let e=!1,f=c.getShaderInfoLog(d);f.length>0&&(e=!0,console.error(f));const g=c.createShader(c.VERTEX_SHADER);c.shaderSource(g,b),c.compileShader(g),f=c.getShaderInfoLog(d),f.length>0&&(e=!0,console.error(f));if(e)return;const j=c.createProgram();c.attachShader(j,g),c.attachShader(j,d),c.linkProgram(j),c.useProgram(j),this.program=j;for(const i of Object.keys(this.attribs)){const k=c.getAttribLocation(j,i);c.enableVertexAttribArray(k),this.attribs[i]=k}for(const i of Object.keys(this.uniforms))this.uniforms[i]=c.getUniformLocation(j,i)}bind(a,b,c){if(!this.program)return!1;const d=this.renderer,e=d.gl,f=this.uniforms;return e.useProgram(this.program),e.uniformMatrix4fv(f.uProjectionMatrix,!1,a),e.uniformMatrix4fv(f.uCameraMatrix,!1,b),e.uniform1i(f.uTexture,d.textures.textureIndex[c]),e.uniform1f(f.uTime,performance.now()),e.uniform2f(f.uResolution,d.width,d.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}bindBuffers(a,b){const c=this.renderer.gl,d=this.buffer.vertexByteSize,e=this.attribs;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a),c.bindBuffer(c.ARRAY_BUFFER,b),c.vertexAttribPointer(e.aVertexPosition,2,c.FLOAT,!1,d,0),c.vertexAttribPointer(e.aTextureCoord,2,c.FLOAT,!1,d,8),c.vertexAttribPointer(e.aTextureId,1,c.FLOAT,!1,d,16),c.vertexAttribPointer(e.aTintColor,4,c.UNSIGNED_BYTE,!0,d,20),this.count=0}draw(a){const b=this.renderer,c=b.gl,d=this.buffer;if(a===d.batchSize)c.bufferData(c.ARRAY_BUFFER,d.data,c.DYNAMIC_DRAW);else{const e=d.vertexViewF32.subarray(0,a*d.quadElementSize);c.bufferSubData(c.ARRAY_BUFFER,0,e)}this.renderToFBO&&b.fbo.add(this.framebuffer,!0),c.drawElements(c.TRIANGLES,a*d.quadIndexSize,c.UNSIGNED_SHORT,0),this.renderToFBO&&b.fbo.pop()}flush(){const a=this.count;return a===0?!1:(this.draw(a),this.prevCount=a,this.count=0,!0)}}const Rn=`\r
#define SHADER_NAME MULTI_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture[%count%];\r
\r
void main (void)\r
{\r
    vec4 color;\r
\r
    %forloop%\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`;class ij extends td{constructor(a={fragmentShader:Rn}){super(a)}createShaders(a,b){const c=Dc();let d="";for(let e=1;e<c;e++)e>1&&(d+=`
	else `),e<c-1&&(d+=`if (vTextureId < ${e}.5)`),d+=`
	{`,d+=`
		color = texture2D(uTexture[${e}], vTextureCoord);`,d+=`
	}`;a=a.replace(/%count%/gi,`${c}`),a=a.replace(/%forloop%/gi,d),super.createShaders(a,b)}bind(a,b){if(!this.program)return!1;const c=this.renderer,d=c.gl,e=this.uniforms;return d.useProgram(this.program),d.uniformMatrix4fv(e.uProjectionMatrix,!1,a),d.uniformMatrix4fv(e.uCameraMatrix,!1,b),d.uniform1iv(e.uTexture,c.textures.textureIndex),d.uniform1f(e.uTime,performance.now()),d.uniform2f(e.uResolution,c.width,c.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}}function jj(a,b,c=-1,d=1){const e=-2*(1/-a),f=-2*(1/b),g=2*(1/(c-d));return new Float32Array([e,0,0,0,0,f,0,0,0,0,g,0,-1,1,0,1])}class kj{constructor(a,b){this.renderer=a;const c={shader:new b()};this.stack=[c],this.currentEntry=c,this.current=c.shader,this.singleQuadShader=new td()}add(a,b){const c={shader:a,textureID:b};return this.stack.push(c),c}set(a,b){this.flush();const c=this.renderer,d=c.projectionMatrix,e=c.currentCamera.matrix,f=a.bind(d,e,b);if(f){const g=this.add(a,b);this.currentEntry=g,this.current=a}return f}setDefault(a){this.set(this.singleQuadShader,a)}pop(){this.flush();const a=this.stack;a.length>1&&a.pop(),this.currentEntry=a[a.length-1],this.current=this.currentEntry.shader}reset(){this.pop(),this.rebind()}flush(){return this.current.flush()?(this.renderer.flushTotal++,!0):!1}rebind(){const a=this.renderer,b=a.projectionMatrix,c=a.currentCamera.matrix,d=this.currentEntry;d.shader.bind(b,c,d.textureID)}popAndRebind(){this.pop(),this.rebind()}clear(){}destroy(){}}const Pn=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Qn(a){let b="";for(let c=0;c<a;++c)c>0&&(b+=`
else `),c<a-1&&(b+=`if(test == ${c}.0){}`);return b}function qj(a,b){const c=b.createShader(b.FRAGMENT_SHADER);for(;;){const d=Pn.replace(/%forloop%/gi,Qn(a));b.shaderSource(c,d),b.compileShader(c);if(!b.getShaderParameter(c,b.COMPILE_STATUS))a=a/2|0;else break}return a}class lj{constructor(a){this.startActiveTexture=0,this.renderer=a,this.tempTextures=[],this.textureIndex=[]}init(){const a=this.renderer.gl;let b=qj(a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),a);const c=Dc();c===0||c>0&&c>b?lf(b):c>0&&c<b&&(b=Math.max(8,c));const d=this.tempTextures;d.length&&d.forEach(f=>{a.deleteTexture(f)});const e=[];for(let f=0;f<b;f++){const g=a.createTexture();a.activeTexture(a.TEXTURE0+f),a.bindTexture(a.TEXTURE_2D,g),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),d[f]=g,e.push(f)}this.maxTextures=b,this.textureIndex=e,this.currentActiveTexture=1}update(){const a=kc.get();for(let b=0;b<a.length;b++){const c=a[b];c.binding||(c.binding=new ud(c))}kc.clear()}reset(){const a=this.renderer.gl,b=this.tempTextures;for(let c=0;c<b.length;c++)a.activeTexture(a.TEXTURE0+c),a.bindTexture(a.TEXTURE_2D,b[c]);this.currentActiveTexture=1,this.startActiveTexture++}bind(a,b=0){const c=this.renderer.gl,d=a.binding;d.setIndex(b),c.activeTexture(c.TEXTURE0+b),c.bindTexture(c.TEXTURE_2D,d.texture)}unbind(a=0){const b=this.renderer.gl;b.activeTexture(b.TEXTURE0+a),b.bindTexture(b.TEXTURE_2D,this.tempTextures[a]),a>0&&this.startActiveTexture++}request(a){const b=this.renderer.gl,c=a.binding,d=this.currentActiveTexture;return c.indexCounter>=this.startActiveTexture?!1:(c.indexCounter=this.startActiveTexture,d<this.maxTextures?(c.setIndex(d),b.activeTexture(b.TEXTURE0+d),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture++):(this.renderer.flush(),this.startActiveTexture++,c.indexCounter=this.startActiveTexture,c.setIndex(1),b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture=2),!0)}}class Ni{constructor(){this.clearColor=[0,0,0,1],this.flushTotal=0,this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.currentCamera=null,this.width=fc(),this.height=gc(),this.resolution=hc(),this.setBackgroundColor(kd());const a=document.createElement("canvas");a.addEventListener("webglcontextlost",b=>this.onContextLost(b),!1),a.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=a,this.fbo=new gj(this),this.textures=new lj(this),this.initContext(),Kc.set(this),this.shaders=new kj(this,ij)}initContext(){const a=this.canvas.getContext("webgl",nf());Ba.set(a),this.gl=a,a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE),this.resize(this.width,this.height,this.resolution),this.textures.init()}resize(a,b,c=1){this.width=a*c,this.height=b*c,this.resolution=c;const d=this.canvas;d.width=this.width,d.height=this.height,this.autoResize&&(d.style.width=(this.width/c).toString()+"px",d.style.height=(this.height/c).toString()+"px"),this.gl.viewport(0,0,this.width,this.height),this.projectionMatrix=jj(a,b)}onContextLost(a){a.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(a){return hj(a,this.clearColor),this}reset(a=null,b=this.width,c=this.height){const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),d.viewport(0,0,b,c),d.enable(d.BLEND),d.blendFunc(d.ONE,d.ONE_MINUS_SRC_ALPHA),this.flushTotal=0,this.currentCamera=null,this.textures.update()}render(a){if(this.contextLost)return;this.reset();if(this.optimizeRedraw&&a.numDirtyFrames===0&&a.numDirtyCameras===0)return;const b=this.gl;if(this.clearBeforeRender){const d=this.clearColor;b.clearColor(d[0],d[1],d[2],d[3]),b.clear(b.COLOR_BUFFER_BIT)}const c=a.worldData;for(let d=0;d<c.length;d++){const{camera:e,renderList:f}=c[d];(!this.currentCamera||!cj(e.worldTransform,this.currentCamera.worldTransform))&&(this.flush(),this.currentCamera=e,this.shaders.rebind()),f.forEach(g=>{g.children.length?this.renderNode(g):g.node.renderGL(this)})}this.flush()}renderNode(a){a.node.renderGL(this),a.children.forEach(b=>{b.children.length>0?this.renderNode(b):b.node.renderGL(this)}),a.node.postRenderGL(this)}flush(){this.shaders.flush()}destroy(){Kc.set(void 0)}}function af(){return()=>{ld(Ni)}}function xa(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);for(const e of d)e.callback.apply(e.context,c),e.once&&d.delete(e);return d.size===0&&a.events.delete(b),!0}function vi(a,b){const c=md(b);return c.appendChild(a),a}function wi(a){const b=document.readyState;if(b==="complete"||b==="interactive"){a();return}const c=()=>{document.removeEventListener("deviceready",c,!0),document.removeEventListener("DOMContentLoaded",c,!0),window.removeEventListener("load",c,!0),a()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",c,!0):(document.addEventListener("DOMContentLoaded",c,!0),window.addEventListener("load",c,!0)):window.setTimeout(c,20)}class gf{constructor(){this.events=new Map()}}class Gc{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function Wa(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new Gc(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function Nb(a,b,c,d=a){return Wa(a,b,c,d,!0)}function uj(){return{gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]}}function xj(a,b=0){a.gameFrame=b,a.numTotalFrames=0,a.numDirtyFrames=0,a.numDirtyCameras=0,a.worldData.length=0}let yj;const wd={get:()=>yj,set:a=>{yj=a}};class xi{constructor(){this.scenes=new Map(),this.sceneIndex=0,this.flush=!1,this.renderResult=uj(),this.game=wa.get(),wd.set(this),Nb(this.game,"boot",()=>this.boot())}boot(){mf().forEach(a=>new a())}update(a,b){for(const c of this.scenes.values())xa(c,"update",a,b)}render(a){const b=this.renderResult;xj(b,a);for(const c of this.scenes.values())xa(c,"render",b);return this.flush&&(b.numDirtyFrames++,this.flush=!1),b}}function Mc(a,b){const c=document.createElement("canvas");return c.width=a,c.height=b,c.getContext("2d")}let zj;const Ea={get:()=>zj,set:a=>{zj=a}};class yi{constructor(){this.textures=new Map(),this.createDefaultTextures(),Ea.set(this)}createDefaultTextures(){this.add("__BLANK",new db(Mc(32,32).canvas));const a=Mc(32,32);a.strokeStyle="#0f0",a.moveTo(0,0),a.lineTo(32,32),a.stroke(),a.strokeRect(.5,.5,31,31),this.add("__MISSING",new db(a.canvas))}get(a){const b=this.textures;return b.has(a)?b.get(a):b.get("__MISSING")}has(a){return this.textures.has(a)}add(a,b){let c;const d=this.textures;return d.has(a)||(b instanceof db?c=b:c=new db(b),c.key=a,d.set(a,c)),c}}class ni extends gf{constructor(...a){super();this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,wa.set(this),wi(()=>this.boot(a))}boot(a){a.forEach(d=>d());const b=ef();this.renderer=new b(),this.textureManager=new yi(),this.sceneManager=new xi();const c=ff();c&&vi(this.renderer.canvas,c),this.isBooted=!0,df(),xa(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(a){const b=a-this.lastTick;this.lastTick=a,this.elapsed+=b,this.isPaused||(this.willUpdate&&(this.sceneManager.update(b,a),xa(this,"update",b,a)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,wa.setFrame(this.frame),wa.setElapsed(this.elapsed),requestAnimationFrame(c=>this.step(c))}destroy(){}}function vj(a,b,c){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:c}function wj(a,b={}){const c=wd.get(),d=c.scenes.size,e=c.sceneIndex,f=d===0;typeof b==="string"?a.key=b:(b||!b&&f)&&(a.key=vj(b,"key","scene"+e.toString())),c.scenes.has(a.key)?console.warn("Scene key already in use: "+a.key):(c.scenes.set(a.key,a),c.flush=!0,c.sceneIndex++)}class jd{constructor(a){this.game=wa.get(),this.events=new Map(),wj(this,a)}}function Mb(a){const b=[a],c=[];for(;b.length>0;){const d=b.shift();c.push(d);const e=d.numChildren;if(e>0)for(let f=e-1;f>=0;f--)b.unshift(d.children[f])}return c.shift(),c}function pb(a,b){return a.children.indexOf(b)}function nd(a,b){const c=a.children;let d;if(b>=0&&b<c.length){const e=c.splice(b,1);e[0]&&(d=e[0],d.parent=null)}return d}function Fc(a,b){const c=pb(a,b);return c>-1&&nd(a,c),b}const sf="addedtoworld";const tf="removedfromworld";function rf(a,...b){return b.forEach(c=>{c.world&&(xa(c.world,tf,c,c.world),xa(c,tf,c,c.world)),c.world=a,xa(a,sf,c,a),xa(c,sf,c,a)}),b}function Lb(a,...b){b.forEach(d=>{d.parent&&Fc(d.parent,d),d.parent=a});const c=a.world;return c&&rf(c,...Mb(a)),b}function ib(a,b){return a.children.push(b),Lb(a,b),b.transform.updateWorld(),b}const ba={CLEAR:0,TRANSFORM:1,UPDATE:2,CHILD_CACHE:4,POST_RENDER:8,COLORS:16,BOUNDS:32,TEXTURE:64,FRAME:128,ALPHA:256,CHILD:512,DEFAULT:1+2+16+32,USER1:536870912,USER2:1073741824,USER3:2147483648,USER4:4294967296};function Ec(a,b=0,c){const d=a.children;c===void 0&&(c=d.length);const e=c-b;if(e>0&&e<=c){const f=d.splice(b,e);return f.forEach(g=>{g.parent=null}),f}else return[]}function of(a,b=0,c){const d=Ec(a,b,c);d.forEach(e=>{e.destroy()})}function pf(a,...b){return b.forEach(c=>{Fc(a,c)}),b}function qf(a,b,c=0,d){const e=Ec(a,c,d);return Lb(b,...e),e.forEach(f=>{f.transform.updateWorld()}),e}class _i{constructor(a,b,c){this.responseType="text",this.crossOrigin=void 0,this.skipCache=!1,this.hasLoaded=!1,this.key=a,this.url=b,this.config=c}}function $i(a,b,c,d){return b||(b=a+c),/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/.exec(b)?b:d?d.baseURL+d.path+b:b}function aj(a){return a.data=new Image(),a.crossOrigin&&(a.data.crossOrigin=a.crossOrigin),new Promise((b,c)=>{a.data.onload=()=>{a.data.onload&&(a.data.onload=null,a.data.onerror=null,b(a))},a.data.onerror=d=>{a.data.onload&&(a.data.onload=null,a.data.onerror=null,a.error=d,c(a))},a.data.src=a.url,a.data.complete&&a.data.width&&a.data.height&&(a.data.onload=null,a.data.onerror=null,b(a))})}function oi(a,b){const c=new _i(a,b);return c.load=()=>(c.url=$i(c.key,c.url,".png",c.loader),c.loader&&(c.crossOrigin=c.loader.crossOrigin),new Promise((d,e)=>{const f=Ea.get();f.has(c.key)?d(c):aj(c).then(g=>{f.add(g.key,g.data),d(g)}).catch(g=>{e(g)})})),c}class Kb{constructor(a=1,b=0,c=0,d=1,e=0,f=0){this.set(a,b,c,d,e,f)}set(a=1,b=0,c=0,d=1,e=0,f=0){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=e,this.ty=f,this}identity(){return this.set()}toArray(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]}fromArray(a){return this.set(a[0],a[1],a[2],a[3],a[4],a[5])}}function qd(a,b,c){return a.width<=0||a.height<=0?!1:a.x<=b&&a.x+a.width>=b&&a.y<=c&&a.y+a.height>=c}class Ja{constructor(a=0,b=0,c=0,d=0){this.set(a,b,c,d)}set(a=0,b=0,c=0,d=0){return this.x=a,this.y=b,this.width=c,this.height=d,this}contains(a,b){return qd(this,a,b)}set right(a){a<=this.x?this.width=0:this.width=a-this.x}get right(){return this.x+this.width}set bottom(a){a<=this.y?this.height=0:this.height=a-this.y}get bottom(){return this.y+this.height}}function ej(){}class ob{constructor(a,b=0,c=0,d=!1){this.compareValue=!1,this._x=b,this._y=c,this.callback=a,this.compareValue=d}set(a=0,b=0){return this._x=a,this._y=b,this.callback(this),this}destroy(){this.callback=ej}set x(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._x=a,this.callback(this))}get x(){return this._x}set y(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._y=a,this.callback(this))}get y(){return this._y}}function bj(a,b,c){const d=c-b;return b+((a-b)%d+d)%d}function Ci(a){return bj(a,-Math.PI,Math.PI)}class Di{constructor(){this._rotation=0,this.type="Camera",this.dirtyRender=!0;const a=wa.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1]),this.bounds=new Ja(),this.worldTransform=new Kb(),this.position=new ob(()=>this.updateTransform(),0,0),this.scale=new ob(()=>this.updateTransform(),1,1),this.origin=new ob(()=>this.updateTransform(),.5,.5),this.reset()}updateTransform(){const a=this.matrix,b=this.position.x,c=this.position.y,d=this.scale.x,e=this.scale.y,f=-b+this.width*this.origin.x,g=-c+this.height*this.origin.y,j=Math.sin(this.rotation),i=Math.cos(this.rotation),k=j+j,n=j*k,s=i*k,w=(1-n)*d,y=s*d,B=-s*e,G=(1-n)*e;a[0]=w,a[1]=y,a[4]=B,a[5]=G,a[12]=b+f-(w*f+B*g),a[13]=c+g-(y*f+G*g),this.worldTransform.set(i*d,j*d,-j*e,i*e,-b,-c);const H=this.width*(1/d),R=this.height*(1/e);this.bounds.set(f-H/2,g-R/2,H,R),this.dirtyRender=!0}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}set rotation(a){a!==this._rotation&&(this._rotation=Ci(a),this.updateTransform())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.origin.destroy(),this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}class Ei{constructor(){this.type="StaticCamera",this.dirtyRender=!0;const a=wa.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.bounds=new Ja(),this.worldTransform=new Kb(),this.reset()}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}const od="destroy";const Ui="postupdate";const Vi="update";function qb(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof Gc)g.delete(c);else{const j=!d,i=e!==void 0;for(const k of g)k.callback===c&&(j&&k.context===d)&&(i&&k.once===e)&&g.delete(k)}return g.size===0&&f.delete(b),a}function pd(a){const{a:b,b:c,c:d,d:e,tx:f,ty:g}=a.world,{x:j,y:i,right:k,bottom:n}=a.extent,s=j*b+i*d+f,w=j*c+i*e+g,y=j*b+n*d+f,B=j*c+n*e+g,G=k*b+n*d+f,H=k*c+n*e+g,R=k*b+i*d+f,L=k*c+i*e+g;return{x0:s,y0:w,x1:y,y1:B,x2:G,y2:H,x3:R,y3:L}}class Oi{constructor(a){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=a,this.area=new Ja()}set(a,b,c,d){this.area.set(a,b,c,d)}get(){return this.entity.isDirty(ba.BOUNDS)&&!this.fixed&&this.update(),this.area}updateLocal(){const{x0:a,y0:b,x1:c,y1:d,x2:e,y2:f,x3:g,y3:j}=pd(this.entity.transform),i=Math.min(a,c,e,g),k=Math.min(b,d,f,j),n=Math.max(a,c,e,g),s=Math.max(b,d,f,j);return this.area.set(i,k,n-i,s-k)}update(){const a=this.updateLocal();this.entity.clearDirty(ba.BOUNDS);if(!this.includeChildren||!this.entity.numChildren)return a;const b=this.visibleOnly,c=this.entity.children;let d=a.x,e=a.y,f=a.right,g=a.bottom;for(let j=0;j<c.length;j++){const i=c[j];if(!i||b&&!i.visible)continue;const k=i.bounds.get();k.x<d&&(d=k.x),k.y<e&&(e=k.y),k.right>f&&(f=k.right),k.bottom>g&&(g=k.bottom)}return a.set(d,e,f-d,g-e)}destroy(){this.entity=null,this.area=null}}class Pi{constructor(a){this.enabled=!1,this.enabledChildren=!0,this.entity=a}destroy(){this.entity=null,this.hitArea=null}}class cb{constructor(a=0,b=0){this.set(a,b)}set(a=0,b=0){return this.x=a,this.y=b,this}getArray(){return[this.x,this.y]}fromArray(a){return this.set(a[0],a[1])}toString(){return`[x=${this.x}, y=${this.y}]`}}function Ri(a){const b=a.local,c=a.position.x,d=a.position.y,e=a.rotation,f=a.scale.x,g=a.scale.y,j=a.skew.x,i=a.skew.y;b.set(Math.cos(e+i)*f,Math.sin(e+i)*f,-Math.sin(e-j)*g,Math.cos(e-j)*g,c,d)}function uf(a,b){return b.set(a.a,a.b,a.c,a.d,a.tx,a.ty)}function Si(a){const b=a.parent,c=a.transform,d=c.local,e=c.world;if(!b)uf(d,e);else if(c.passthru)uf(b.transform.world,e);else{const{a:f,b:g,c:j,d:i,tx:k,ty:n}=d,{a:s,b:w,c:y,d:B,tx:G,ty:H}=b.transform.world;e.set(f*s+g*y,f*w+g*B,j*s+i*y,j*w+i*B,k*s+n*y+G,k*w+n*B+H)}}class Qi{constructor(a,b=0,c=0){this.passthru=!1,this._rotation=0,this.entity=a,this.local=new Kb(),this.world=new Kb(),this.position=new ob(()=>this.update(),b,c),this.scale=new ob(()=>this.update(),1,1,!0),this.skew=new ob(()=>this.update(),0,0,!0),this.origin=new ob(()=>this.updateExtent(),jf,kf),this.extent=new Ja()}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(ba.TRANSFORM,ba.BOUNDS),Ri(this)}updateWorld(){const a=this.entity;a.setDirty(ba.TRANSFORM,ba.BOUNDS),Si(a),a.numChildren&&this.updateChildren()}updateChildren(){const a=this.entity.children;for(let b=0;b<a.length;b++){const c=a[b];c.transform.updateWorld()}}globalToLocal(a,b,c=new cb()){const{a:d,b:e,c:f,d:g,tx:j,ty:i}=this.world,k=1/(d*g+f*-e);return c.x=g*k*a+-f*k*b+(i*f-j*g)*k,c.y=d*k*b+-e*k*a+(-i*d+j*e)*k,c}localToGlobal(a,b,c=new cb()){const{a:d,b:e,c:f,d:g,tx:j,ty:i}=this.world;return c.x=d*a+f*b+j,c.y=e*a+g*b+i,c}setExtent(a,b,c,d){this.extent.set(a,b,c,d),this.entity.setDirty(ba.TRANSFORM,ba.BOUNDS)}updateExtent(a,b){const c=this.extent,d=this.entity;a!==void 0&&(c.width=a),b!==void 0&&(c.height=b),c.x=-this.origin.x*c.width,c.y=-this.origin.y*c.height,d.setDirty(ba.TRANSFORM,ba.BOUNDS)}set rotation(a){a!==this._rotation&&(this._rotation=a,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}}class ic{constructor(a=0,b=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.events=new Map(),this.transform=new Qi(this,a,b),this.bounds=new Oi(this),this.input=new Pi(this),this.dirty=ba.DEFAULT,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(a){return(this.dirty&a)!==0}clearDirty(a){return this.isDirty(a)&&(this.dirty^=a),this}setDirty(a,b){return this.isDirty(a)||(this.dirty^=a,this.dirtyFrame=wa.getFrame()),this.isDirty(b)||(this.dirty^=b),this}update(a,b){if(this.willUpdateChildren){const c=this.children;for(let d=0;d<c.length;d++){const e=c[d];e&&e.willUpdate&&e.update(a,b)}}this.postUpdate(a,b)}postUpdate(a,b){}renderGL(a){}renderCanvas(a){}postRenderGL(a){}postRenderCanvas(a){}get numChildren(){return this.children.length}destroy(a){a?qf(this,a):of(this),xa(this,od,this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}}const rd="worldrender";const sd="worldshutdown";var On=Object.freeze({__proto__:null,WorldRenderEvent:rd,WorldShutdownEvent:sd});function xd(a,b){b.numRendered++,b.numRenderable++,a.node.dirtyFrame>=b.gameFrame&&b.dirtyFrame++,a.children.forEach(c=>{c.children.length>0&&xd(c,b)})}function Ef(a){if(a.node.isDirty(ba.CHILD_CACHE))return!0;const b=[a];for(;b.length>0;){const c=b.pop();if(c.node.isDirty(ba.TRANSFORM))return!0;const d=c.children.length;if(d>0)for(let e=0;e<d;e++)b.push(c.children[e])}return b.length=0,!1}function Df(a,b){a.forEach(c=>{b||Ef(c)?c.node.setDirty(ba.CHILD_CACHE):c.children.length=0})}function yd(a,b,c=[]){for(let d=0;d<b.numChildren;d++){const e=b.children[d];if(e.isRenderable()){const f=[],g={node:e,children:f};c.push(g),e.willRenderChildren&&e.numChildren>0&&(e.willCacheChildren&&a.push(g),yd(a,e,f))}}return c}function Bf(a){const b=[],c=[],d=yd(b,a,c),e=a.renderData;b.length>0&&Df(b,a.camera.dirtyRender),d.forEach(f=>{f.children.length?xd(f,e):(e.numRendered++,e.numRenderable++,f.node.dirtyFrame>=e.gameFrame&&e.dirtyFrame++)}),e.renderList=d,a.forceRefresh&&(e.dirtyFrame++,a.forceRefresh=!1)}function Cf(a,b){a.numDirtyFrames+=b.dirtyFrame,a.numTotalFrames+=b.numRendered,b.camera.dirtyRender&&a.numDirtyCameras++,a.worldData.push(b)}function Nc(a,b){a.gameFrame=b,a.dirtyFrame=0,a.numRendered=0,a.numRenderable=0,a.renderList.length=0}class Ob extends ic{constructor(a){super();this.forceRefresh=!1,this.type="BaseWorld",this.scene=a,this.world=this,this.events=new Map(),this._updateListener=Wa(a,"update",(b,c)=>this.update(b,c)),this._renderListener=Wa(a,"render",b=>this.render(b)),this._shutdownListener=Wa(a,"shutdown",()=>this.shutdown()),Nb(a,"destroy",()=>this.destroy())}update(a,b){if(!this.willUpdate)return;xa(this,Vi,a,b,this),super.update(a,b)}postUpdate(a,b){xa(this,Ui,a,b,this)}render(a){const b=this.renderData;Nc(b,a.gameFrame);if(!this.willRender||!this.visible)return;Bf(this),xa(this,rd,b,this),Cf(a,b),this.camera&&(this.camera.dirtyRender=!1)}shutdown(){const a=this.scene;qb(a,"update",this._updateListener),qb(a,"render",this._renderListener),qb(a,"shutdown",this._shutdownListener),pf(this),xa(this,sd,this),Nc(this.renderData,0),this.camera&&this.camera.reset()}destroy(a){super.destroy(a),xa(this,od,this),Nc(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}}function Oc(a){return{camera:a,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0,renderList:[]}}class bf extends Ob{constructor(a){super(a);this.type="StaticWorld",this.camera=new Ei(),this.renderData=Oc(this.camera)}}class Sn extends Ob{constructor(a){super(a);this.enableCameraCull=!0,this.type="World",this.camera=new Di(),this.renderData=Oc(this.camera)}}function Wi(a,b){const c=a.texture,d=b.shaders.current,e=d.buffer,f=c.binding;d.count===e.batchSize&&b.flush();const g=a.vertexData;b.textures.request(c);const j=f.index;g[4]=j,g[10]=j,g[16]=j,g[22]=j;const i=d.count*e.quadElementSize;e.vertexViewF32.set(g,i);const k=a.vertexColor,n=e.vertexViewU32;n[i+5]=k[0],n[i+11]=k[2],n[i+17]=k[3],n[i+23]=k[1],d.count++}class Ti extends ic{constructor(a=0,b=0){super(a,b);this._alpha=1,this.type="Container"}setSize(a,b=a){return this.transform.updateExtent(a,b),this}setPosition(a,b){return this.transform.position.set(a,b),this}setOrigin(a,b=a){return this.transform.origin.set(a,b),this}setSkew(a,b=a){return this.transform.skew.set(a,b),this}setScale(a,b=a){return this.transform.scale.set(a,b),this}setRotation(a){return this.transform.rotation=a,this}set width(a){this.transform.updateExtent(a)}get width(){return this.transform.extent.width}set height(a){this.transform.updateExtent(void 0,a)}get height(){return this.transform.extent.height}set x(a){this.transform.position.x=a}get x(){return this.transform.position.x}set y(a){this.transform.position.y=a}get y(){return this.transform.position.y}set originX(a){this.transform.origin.x=a}get originX(){return this.transform.origin.x}set originY(a){this.transform.origin.y=a}get originY(){return this.transform.origin.y}set skewX(a){this.transform.skew.x=a}get skewX(){return this.transform.skew.x}set skewY(a){this.transform.skew.y=a}get skewY(){return this.transform.skew.y}set scaleX(a){this.transform.scale.x=a}get scaleX(){return this.transform.scale.x}set scaleY(a){this.transform.scale.y=a}get scaleY(){return this.transform.scale.y}set rotation(a){this.transform.rotation=a}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(a){a!==this._alpha&&(this._alpha=a,this.setDirty(ba.TRANSFORM))}}function Xi(a,b){const c=a.frame;if(!c)return;const d=b.ctx,e=a.transform,{a:f,b:g,c:j,d:i,tx:k,ty:n}=e.world,{x:s,y:w}=e.extent;d.save(),d.setTransform(f,g,j,i,k,n),d.globalAlpha=a.alpha,d.drawImage(c.texture.image,c.x,c.y,c.width,c.height,s,w,c.width,c.height),d.restore()}function Lc(a,b){const c=(b*255|0)&255;return(c<<24|a)>>>0}function jc(a){const b=a.vertexAlpha,c=a.vertexTint,d=a.vertexColor;return d[0]=Lc(c[0],b[0]),d[1]=Lc(c[1],b[1]),d[2]=Lc(c[2],b[2]),d[3]=Lc(c[3],b[3]),a}function Hc(a,b,...c){const d=a.getFrame(b),{u0:e,u1:f,v0:g,v1:j,pivot:i}=d;return c.forEach(k=>{if(!k||d===k.frame)return;k.frame=d,i&&k.setOrigin(i.x,i.y),k.frame.setExtent(k),k.hasTexture=!0;const n=k.vertexData;n[2]=e,n[3]=g,n[8]=e,n[9]=j,n[14]=f,n[15]=j,n[20]=f,n[21]=g}),c}function vf(a,b,...c){if(!a)c.forEach(d=>{d.texture=null,d.frame=null,d.hasTexture=!1});else{let d;a instanceof db?d=a:d=Ea.get().get(a),d?(c.forEach(e=>{e.texture=d}),Hc(d,b,...c)):console.warn(`Invalid Texture key: ${a}`)}return c}function wf(a){const b=a.vertexData,{x0:c,y0:d,x1:e,y1:f,x2:g,y2:j,x3:i,y3:k}=pd(a.transform);return b[0]=c,b[1]=d,b[6]=e,b[7]=f,b[12]=g,b[13]=j,b[18]=i,b[19]=k,a}class Jb extends Ti{constructor(a,b,c,d){super(a,b);this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertexData=new Float32Array(24).fill(0),this.vertexColor=new Uint32Array(4).fill(4294967295),this.vertexAlpha=new Float32Array(4).fill(1),this.vertexTint=new Uint32Array(4).fill(16777215),this.setTexture(c,d)}setTexture(a,b){return vf(a,b,this),this}setFrame(a){return Hc(this.texture,a,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}preRender(){this.isDirty(ba.COLORS)&&(jc(this),this.clearDirty(ba.COLORS)),this.isDirty(ba.TRANSFORM)&&(wf(this),this.clearDirty(ba.TRANSFORM))}renderGL(a){this.preRender(),Wi(this,a)}renderCanvas(a){this.preRender(),Xi(this,a)}get alpha(){return this._alpha}set alpha(a){if(a!==this._alpha){this._alpha=a;const b=this.vertexAlpha;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(ba.ALPHA)}}get tint(){return this._tint}set tint(a){if(a!==this._tint){this._tint=a;const b=this.vertexTint;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(ba.COLORS)}}destroy(a){super.destroy(a),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertexData=null,this.vertexColor=null,this.vertexAlpha=null,this.vertexTint=null}}var ci;(function(a){a[a.IDLE=0]="IDLE",a[a.UPDATING=1]="UPDATING"})(ci||(ci={}));function lc(a=32,b=32){const c=Mc(a,b);return new db(c.canvas)}var Da;(function(a){a[a.none=0]="none",a[a.word=1]="word",a[a.char=2]="char"})(Da||(Da={}));var va;(function(a){a[a.none=0]="none",a[a.raw=1]="raw",a[a.wrapped=2]="wrapped"})(va||(va={}));const Mh=/(?:\r\n|\r|\n)/;function Km(a,b,c,d,e,f=0){e<=0&&(d=0);let g=[];if(!a||!a.length)return g;let j=a.split(Mh),i=j.length-1;a.slice(-1)===`
`&&(j.length-=1);let k;for(let n=0,s=j.length;n<s;n++){let w=j[n],y=n===i?0:1;if(d===0){g.push(id(w,b(w,c),y));continue}n===0?k=e-f:k=e;if(w.length<=100){let L=b(w,c);if(L<=k){g.push(id(w,L,y));continue}}let B;d===1?B=w.split(" "):B=w;let G="",H="",R=0;for(let L=0,S=B.length;L<S;L++){let J=B[L];d===1?(G+=J,L<S-1&&(G+=" ")):G+=J;let W=b(G,c);W>k&&(L===0?g.push(id("",0,2)):(g.push(id(H,R,2)),G=J,d===1&&(L<S-1&&(G+=" ")),W=b(G,c)),k=e),H=G,R=W}g.push(id(H,R,y))}return g}let id=function(a,b,c){return{text:a,width:b,newLineMode:c}};var $a;(function(a){a[a.left=0]="left",a[a.center=1]="center",a[a.right=2]="right"})($a||($a={}));var ab;(function(a){a[a.top=0]="top",a[a.center=1]="center",a[a.bottom=2]="bottom"})(ab||(ab={}));class bc{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(a){return this.items.push(a),this}pushMultiple(a){return this.items.push.apply(this.items,a),a.length=0,this}clear(){return this.items.length=0,this}}class Ph{constructor(){this.pens=[]}destroy(){this.pens.length=0}addPen(a){return this.pens.push(a),this}get firstPen(){return this.pens[0]}get lastPen(){return this.pens[this.pens.length-1]}hasPen(){return this.pens.length>0}get pensCount(){return this.pens.length}get startIndex(){let a=this.pens[0];return a?a.startIndex:0}get width(){let a=this.lastPen;return a?a.lastX:0}}function Ve(a){if(Array.isArray(a))a.length=0;else for(let b in a)delete a[b]}function cc(a,b=Array.isArray(a)?[]:{}){Ve(b);if(Array.isArray(a)){b.length=a.length;for(let c=0,d=a.length;c<d;c++)b[c]=a[c]}else for(let c in a)b[c]=a[c];return b}class Qh{constructor(){this.text="";this.x=0;this.y=0;this.width=0;this.height=0;this.ascent=0;this.descent=0;this.prop={};this.newLineMode=va.none;this.startIndex=0}set(a="",b=0,c=0,d=0,e=0,f=0,g=0,j={},i=va.none,k=0){return this.text=a,this.x=b,this.y=c,this.width=d,this.height=e,this.ascent=f,this.descent=g,this.prop=j,this.newLineMode=i,this.startIndex=k,this}clone(){let a=new Qh();return a.set(this.text,this.x,this.y,this.width,this.height,this.ascent,this.descent,cc(this.prop),this.newLineMode,this.startIndex),a}get plainText(){return this.newLineMode===va.raw?`${this.text}
`:this.text}get wrapText(){return this.newLineMode!==va.none?`${this.text}
`:this.text}get plainTextLength(){let a=this.text.length;return this.newLineMode===va.raw&&(a+=1),a}get endIndex(){return this.startIndex+this.plainTextLength}get lastX(){return this.x+this.width}get isTextPen(){return this.text!==""}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}}class fd{constructor({penPool:a}){this.pens=[];this.lines=[];this.pens=[],this.lines=[],this.penPool=a}destroy(){this.freePens()}freePens(){return this.penPool.pushMultiple(this.pens),this.lines.forEach(a=>{a.destroy()}),this.lines.length=0,this.maxLineWidth=0,this.totalLineHeight=0,this}addTextPen(a,b,c,d,e,f,g,j,i=va.none){let k=this.penPool.pop();return k==null&&(k=new Qh()),k.set(a,b,c,d,e,f,g,j,i),this.addPen(k),this}addImagePen(a,b,c,d,e){return this.addTextPen("",a,b,c,d,d,0,e,va.none),this}addNewLinePen(a){let b=this.lastPen;return b&&b.newLineMode===va.none&&(b.newLineMode=a),this}addPen(a){let b=this.lastPen;b==null?a.startIndex=0:a.startIndex=b.endIndex,this.pens.push(a);let c=this.lastLine;return c==null&&(c=new Ph(),this.lines.push(c)),c.addPen(a),a.newLineMode!==va.none&&(c=new Ph(),this.lines.push(c)),this}clone(a){a==null&&(a=new fd({penPool:this.penPool})),a.freePens();const b=this.pens;for(let e=0,f=b.length;e<f;e++)a.addPen(b[e].clone());const c=this.lines,d=a.lines;for(let e=0,f=c.length;e<f;e++){const g=c[e],j=d[e];j.y=g.y,j.height=g.height}return a}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(a){if(a>=this.lines.length)return this.getLineEndIndex(a);{let b=this.lines[a];if(!b)return 0;let c=b.firstPen;return c?c.startIndex:0}}getLineEndIndex(a){let b=this.lines.length;a>=b&&(a=b-1);for(let c=a;c>=0;c--){let d=this.lines[c];if(d&&d.hasPen())return d.lastPen.endIndex}return 0}getLineWidth(a){let b=this.lines[a];return b?b.width:0}getLineHeights(a=[]){return this.lines.forEach(function(b){a.push(b.height)}),a}get lineCount(){return this.lines.length}get plainText(){let a=[],b=this.pens;for(let c=0,d=b.length;c<d;c++)a.push(b[c].plainText);return a.join()}get plainTextLength(){let a=0;for(let b=0,c=this.pens.length;b<c;b++)a+=this.pens[b].plainTextLength;return a}getSliceTagText(a,b,c=0,d,e=!1){if(d===void 0){let k=this.lastPen;if(!k)return"";d=k.endIndex}let f=[],g;for(var j=0,i=this.pens.length;j<i;j++){let k=this.pens[j],n=k.endIndex;if(n<=c)continue;let s=e?k.wrapText:k.plainText,w=k.prop,y=k.startIndex,B=y>=c&&n<=d;B||(s=s.substring(c-y,d-y)),b?f.push(a.call(b,s,w,g)):f.push(a(s,w,g)),g=w;if(n>=d)break}return f.join()}}function Hm(a,b,c){let d=cc(a,c);for(let e in b)d.hasOwnProperty(e)&&(d[e]=b[e]);return d}function Je(a,b,c={key:b}){c=Hm(Ep,c);let d=Ea.get(),e=d.get(c.key);if(!e)return;let f=e.getFrame(c.frame);if(!f)return;let g=c.width,j=c.height;(g===void 0||j===void 0)&&(g===void 0&&j===void 0?(c.width=f.width,c.height=f.height):g===void 0?c.width=f.width*(j/f.height):j===void 0&&(c.height=f.height*(g/f.width))),a.images.set(b,c)}const Ep={key:void 0,frame:void 0,width:void 0,height:void 0,y:0,left:0,right:0,top:0,bottom:0};class Dm{constructor(){this.images=new Map()}destroy(){this.images.clear()}add(a,b){if(typeof a==="string")Je(this,a,b);else if(Array.isArray(a)){let c=a;for(let d=0,e=c.length;d<e;d++)Je(this,c[d])}else{let c=a;for(a in c)Je(this,a,c[a])}return this}remove(a){return this.images.delete(a),this}get(a){return this.images.get(a)}getOuterWidth(a){let b=this.images.get(a);return b?b.width+b.left+b.right:0}getOuterHeight(a){let b=this.images.get(a);return b?b.height+b.top+b.bottom:0}getFrame(a){let b=this.images.get(a);if(!b)return;let c=Ea.get(),d=c.get(b.key);if(!d)return;let e=d.getFrame(b.frame);return e}hasTexture(a){return!!this.getFrame(a)}}function He(a,b){a.font=b.font}function Ie(a,b){a.textBaseline="alphabetic",a.textAlign="start",a.fillStyle=b.fillStyle,a.strokeStyle=b.strokeStyle,a.lineWidth=b.strokeThickness,a.lineCap="round",a.lineJoin="round",a.imageSmoothingEnabled=b.antialias}function Nh(a,b,c){c?(a.shadowColor=b.shadowColor,a.shadowBlur=b.shadowBlur,a.shadowOffsetX=b.shadowOffsetX,a.shadowOffsetY=b.shadowOffsetY):(a.shadowColor="#000",a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0)}function Im(a,b){return b.measureText(a).width}function Jm(a,b,c=0){let d=b.measureText(a),e=d.actualBoundingBoxAscent,f=d.actualBoundingBoxDescent;return(!e&&!f||a==="")&&(e=c,f=0),Ne.ascent=e,Ne.descent=f,Ne.height=Math.ceil(Math.abs(e)+Math.abs(f)),Ne}let Ne={ascent:0,descent:0,height:0};function Em(a,b,c,d,e){a.freePens();if(b==="")return a;let f=c.canvas,g=c.context,j=c.parent,i=c.parser.splitText(b),k,n,s=0;for(var w=0,y=i.length;w<y;w++){let L=c.parser.tagTextToProp(i[w],k),S=L.text;k=L.prop;if(k.img){let J,W;c.imageManager?(J=c.imageManager.getOuterWidth(k.img),W=c.imageManager.getOuterHeight(k.img)):(J=0,W=0),e>0&&d!==Da.none&&(e<s+J&&(a.addNewLinePen(va.wrapped),s=0)),a.addImagePen(s,0,J,W,cc(k)),s+=J}else if(S!==""){g.save();let J=c.parser.propToStyle(j,k);He(g,J),Ie(g,J);let W=J.strokeThickness,X=W/2;n=Km(S,Im,g,d,e,s);let K=Jm("|MÃq",g);for(let q=0,r=n.length;q<r;q++){const h=n[q],m=K.height+W,l=K.ascent+X,p=K.descent+X;a.addTextPen(h.text,s,0,h.width,m,l,p,cc(k),h.newLineMode),h.newLineMode!==va.none?s=0:s+=h.width}g.restore()}}let B=a.lines,G=c.parent.lineSpacing,H=0,R=0;for(let L=0,S=B.length;L<S;L++){const J=B[L],W=J.pens,X=W.length;let K=0,q=0;for(let m=0;m<X;m++){const l=W[m];K=Math.max(K,l.ascent),q=Math.max(q,l.descent)}const r=K+q,h=R+K;for(let m=0;m<X;m++)W[m].y+=h;J.y=h,J.height=r,H=Math.max(H,J.width),R+=r+G}return a.maxLineWidth=H,a.totalLineHeight=R-G,a}const Zi={PI2:Math.PI*2,HALF_PI:Math.PI*.5,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};class Dp extends Ja{constructor(a,b,c,d,e){super(a,b,c,d);this.name=e}}class Gm{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return this.hitAreas.length=0,this}add(a,b,c,d,e){let f=new Dp(b,c,d,e,a);return this.hitAreas.push(f),this}getFirstHitArea(a,b){for(let c=0,d=this.hitAreas.length;c<d;c++){let e=this.hitAreas[c];if(e.contains(a,b))return e}return null}}class nn{constructor(a=0,b=a,c=0,d=c,e=0){this._width=0;this._height=0;this.cornerRadius={tl:bb(0),tr:bb(0),bl:bb(0),br:bb(0)};this.setTo(a,b,c,d,e)}setTo(a=0,b=a,c=0,d=c,e=0){return this.setPosition(a,b),this.setRadius(e),this.setSize(c,d),this}setPosition(a=0,b=a){return this.x=a,this.y=b,this}setRadius(a=0){let b=this.cornerRadius;if(typeof a==="number"){const c=a,d=a;b.tl=bb(void 0,c,d),b.tr=bb(void 0,c,d),b.bl=bb(void 0,c,d),b.br=bb(void 0,c,d)}else{const c=a.x??0,d=a.y??0;b.tl=bb(a.tl,c,d),b.tr=bb(a.tr,c,d),b.bl=bb(a.bl,c,d),b.br=bb(a.br,c,d)}return this}setSize(a=0,b=a){return this.width=a,this.height=b,this}get minWidth(){let a=this.cornerRadius;return Math.max(a.tl.x+a.tr.x,a.bl.x+a.br.x)}get minHeight(){let a=this.cornerRadius;return Math.max(a.tl.y+a.bl.y,a.tr.y+a.br.y)}get width(){return this._width}set width(a){a==null&&(a=0),this._width=Math.max(a,this.minWidth)}get height(){return this._height}set height(a){a==null&&(a=0),this._height=Math.max(a,this.minHeight)}get radius(){let a=this.cornerRadius,b=Math.max(a.tl.x,a.tl.y,a.tr.x,a.tr.y,a.bl.x,a.bl.y,a.br.x,a.br.y);return b}}function bb(a,b,c){return a===void 0?{x:b,y:c}:typeof a==="number"?{x:a,y:a}:a}const iq=Math.PI/180;function zb(a){return a*iq}const on=zb(0),pn=zb(90),qn=zb(180),rn=zb(270);function De(a,b,c,d,e,f){const g=new nn(b,c,d,e,f),j=g.minWidth,i=g.minHeight,k=d>=j?1:d/j,n=e>=i?1:e/i,s=g.cornerRadius;let w,y,B,G,H;a.beginPath(),a.translate(b,c),w=s.br,y=w.x*k,B=w.y*n,G=g.width-y,H=g.height-B,Te(w)?a.ellipse(G,H,y,B,0,on,pn):(a.moveTo(g.width,H),a.lineTo(g.width,g.height),a.lineTo(G,g.height)),w=s.bl,y=w.x*k,B=w.y*n,G=y,H=g.height-B,a.lineTo(y,g.height),Te(w)?a.ellipse(G,H,y,B,0,pn,qn):(a.lineTo(0,g.height),a.lineTo(0,H)),w=s.tl,y=w.x*k,B=w.y*n,G=y,H=B,a.lineTo(0,H),Te(w)?a.ellipse(G,H,y,B,0,qn,rn):(a.lineTo(0,0),a.lineTo(G,0)),w=s.tr,y=w.x*k,B=w.y*n,G=g.width-y,H=B,a.lineTo(G,0),Te(w)?a.ellipse(G,H,y,B,0,rn,on):(a.lineTo(g.width,0),a.lineTo(g.width,H)),a.closePath()}function Te(a){return a.x!==0&&a.y!==0}function Oh(a,b,c,d,e,f,g,j,i,k){De(b,c,d,e,f,g),j&&(b.fillStyle=j,b.fill()),i&&(b.strokeStyle=i,b.lineWidth=k,b.stroke())}function Fm(a,b,c,d,e,f=0,g=0,j=a.penManager){a.hitAreaManager&&a.hitAreaManager.clear();let i=j.totalLineHeight;if(i===0)return;const k=d<a.textWidth||e<a.textHeight;let n=a.context;n.save();let s=a.parent;yp(a,s),zp(a,s),k&&(n.beginPath(),n.rect(b,c,d,e),n.clip());const w=s.hAlign,y=s.vAlign;let B=c+g;switch(y){case ab.center:B+=(e-i)/2;break;case ab.bottom:B+=e-i-2;break}let G=j.lines,H=B;const R=b+e;for(let L=0,S=G.length;L<S;L++){let J=G[L];if(H>R)break;const W=H+J.height;if(W<c){H=W;continue}let X=J.width;if(X===0){H=W;continue}let K=b+f;switch(w){case $a.center:K+=(d-X)/2;break;case $a.right:K+=d-X;break}let q=J.pens;for(let r=0,h=q.length;r<h;r++)xp(a,q[r],K,B);H=W}n.restore()}function xp(a,b,c,d){c+=b.x,d+=b.y;let e=a.canvas,f=a.context,g=a.parent;f.save();let j=a.parser.propToStyle(g,b.prop);He(f,j),Ie(f,j),j.underlineThickness>0&&b.width>0&&Ap(a,c,d,b.width,j),b.isTextPen&&Bp(a,c,d,b.text,j),b.isImagePen&&Cp(a,c,d,b.prop.img,j),f.restore(),b.hasAreaMarker&&b.width>0&&(a.hitAreaManager||(a.hitAreaManager=new Gm()),a.hitAreaManager.add(b.prop.area,c,d,b.width,b.height))}function yp(a,b){let c=a.canvas,d=a.context;d.clearRect(0,0,c.width,c.height)}function zp(a,b){let c=a.canvas,d=a.context;d.clearRect(0,0,c.width,c.height);const e=b.backgroundFillStyle,f=b.backgroundStrokeStyle;if(e||f){const g=b.backgroundStrokeThickness,j=g/2,i=b.cornerRadius,k=j,n=j,s=c.width-g,w=c.height-g;Oh(c,d,k,n,s,w,i,e,f,g)}else d.clearRect(0,0,c.width,c.height)}function Ap(a,b,c,d,e){c+=e.underlineOffsetY-e.underlineThickness/2;let f=a.context,g=f.lineCap;f.lineCap="butt",f.beginPath(),f.strokeStyle=e.underlineStyle,f.lineWidth=e.underlineThickness,f.moveTo(b,c),f.lineTo(b+d,c),f.stroke(),f.lineCap=g}function Bp(a,b,c,d,e){let f=a.context;e.strokeStyle&&e.strokeStyle!=="none"&&e.strokeThickness>0&&(Nh(f,e,e.shadowStroke),f.strokeText(d,b,c)),e.fillStyle&&e.fillStyle!=="none"&&(Nh(f,e,e.shadowFill),f.fillText(d,b,c))}function Cp(a,b,c,d,e){let f=a.imageManager;if(!f)return;let g=f.get(d),j=f.getFrame(d);b+=g.left,c+=g.y-g.height;let i=a.context;i.drawImage(j.texture.image,j.x,j.y,j.width,j.height,b,c,g.width,g.height)}class um{constructor({canvas:a,context:b,parent:c,parser:d,penPool:e=new bc()}){this.textOffsetX=0;this.textOffsetY=0;this.canvas=a,this.context=b,this.parser=d,this.parent=c,this.penPool=e,this.penManager=new fd({penPool:e})}destroy(){this.parser.destroy(),this.canvas=null,this.context=null,this.parser=null,this.parent=null,this.penManager&&(this.penManager.destroy(),this.penManager=null),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=null),this.imageManager&&(this.imageManager.destroy(),this.imageManager=null),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=null)}get textWidth(){return this.penManager.maxLineWidth}get textHeight(){return this.penManager.totalLineHeight}updatePenManager(a,b,c,d=this.penManager){return Em(d,a,this,b,c)}draw(a,b,c,d,e=0,f=0){return Fm(this,a,b,c,d,e,f,this.penManager),this}get lines(){return this.penManager.lines}get tmpPenManager(){return this._tmpPenManager===null&&(this._tmpPenManager=new fd({penPool:this.penPool})),this._tmpPenManager}getPlainText(a,b,c){let d;return a==null?d=this.penManager.plainText:d=this.parser.splitText(a,!0).join(""),(b!=null||c!=null)&&(b==null&&(b=0),c==null&&(c=d.length),d=d.substring(b,c)),d}getPenManager(a,b){return a===void 0?this.clonePenManager(b,this.penManager):(b===void 0&&(b=new fd({penPool:this.penPool})),this.updatePenManager(a,this.parent.wrapMode,this.parent.wrapWidth,b),b)}getText(a,b,c,d){if(a==null)return this.penManager.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d);let e=this.tmpPenManager;return this.updatePenManager(a,this.parent.wrapMode,this.parent.wrapWidth,e),e.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d)}clonePenManager(a,b=this.penManager){return b.clone(a)}getLastPen(a=this.penManager){return a.lastPen}addImageInfo(a,b){return this.imageManager===void 0&&(this.imageManager=new Dm()),this.imageManager.add(a,b),this}}function zh(a,b=!0,c=!0){let d=a.canvasText;b&&d.updatePenManager(a.text,a.wrapMode,a.wrapWidth);if(c){let e=a.padding,f,g,j,i;a.fixedWidth===0?(f=d.textWidth,j=f+e.left+e.right):(j=a.fixedWidth,f=j-e.left-e.right,f>d.textWidth&&(f=d.textWidth)),a.fixedHeight===0?(g=d.textHeight,i=g+e.top+e.bottom):(i=a.fixedHeight,g=i-e.top-e.bottom,g>d.textHeight&&(g=d.textHeight));let k=a.resolution,n=Math.ceil(j*k),s=Math.ceil(i*k),w=a.canvas;(w.width!==n||w.height!==s)&&(w.width=n,w.height=s,a.texture.setSize(j,i),a.setSize(j,i));let y=a.context;y.save(),y.scale(k,k),d.draw(e.left,e.top,f,g,0,a.textOffsetY),y.restore(),a.texture.binding&&a.texture.binding.update(),a.setDirty(ba.TEXTURE)}}function Ee(a,b=0,c=0){a.fixedWidth=b,a.fixedHeight=c,Ge(a)}function Ah(a,b,c,d,e){const f=a.padding;if(typeof b==="number")f.left=b,f.right=c===void 0?b:c,f.top=d===void 0?b:d,f.bottom=e===void 0?b:e;else{let g=b;f.left=g.left??0,f.right=g.right??0,f.top=g.top??0,f.bottom=g.bottom??0}Ge(a)}function Ge(a){const b=a.fixedWidth;if(a.wrapMode!==Da.none){const c=a.padding,d=b-c.left-c.right;a.wrapWidth=Math.max(d,0)}else a.wrapWidth=0}function vm(a,b,c=!1){c?a.textOffsetYPercentage=b:a.textOffsetY=b}function Bh(a,b=$a.left){typeof b==="string"&&(b=$a[b]),a.hAlign=b}function Ch(a,b=ab.top){typeof b==="string"&&(b=ab[b]),a.vAlign=b}function Dh(a,b=0){a.lineSpacing=b}function Eh(a,b,c,d=0,e=0){c||(d=0),a.backgroundFillStyle=b,a.backgroundStrokeStyle=c,a.backgroundStrokeThickness=d,a.cornerRadius=e}function wm(a,b,c){b&&Fh(a,b),c&&Gh(a,c)}function Fh(a,b){a.fontFamily=b}function Gh(a,b){typeof b==="number"&&(b=`${b}px`),a.fontSize=b}function Hh(a,b){a.fillStyle=b}function Ih(a,b,c=2){a.strokeStyle=b,a.strokeThickness=c}function Jh(a,b="#000",c=5,d=0,e=0,f=!1,g=!1){a.shadowColor=b,a.shadowBlur=c,a.shadowOffsetX=d,a.shadowOffsetY=e,a.shadowFill=f,a.shadowStroke=g}function Kh(a,b,c){typeof b==="string"&&(b=Da[b]),a.wrapMode=b,c===void 0?Ge(a):a.wrapWidth=c}function Lh(a,b,c=2,d=0){a.underlineStyle=b,a.underlineThickness=c,a.underlineOffsetY=d}function yh(a,b,c){a.canvasText.addImageInfo(b,c)}function xm(a,b,c,d){return b=a.canvasText.getText(b,c,d,!0),b.split(Mh)}function ym(a,b,c,d){return a.canvasText.getPlainText(b,c,d)}function zm(a,b,c,d){return a.canvasText.getText(b,c,d,!1)}function Am(a,b,c,d){return a.canvasText.getText(b,c,d,!1)}function Bm(a,b){return a.canvasText.clonePenManager(b)}function Cm(a,b,c){return a.canvasText.getPenManager(b,c)}class Fe extends Jb{constructor(a,b,c="",{width:d=0,height:e=0,padding:f,wrapMode:g=Da.none,backgroundFillStyle:j,backgroundStrokeStyle:i,backgroundStrokeThickness:k,cornerRadius:n=0,hAlign:s=$a.left,vAlign:w=ab.top,lineSpacing:y=0,fontFamily:B="monospace",fontSize:G="16px",fillStyle:H="#fff",strokeStyle:R,strokeThickness:L=1,shadowColor:S="#000",shadowBlur:J=4,shadowOffsetX:W=0,shadowOffsetY:X=0,shadowFill:K=!1,shadowStroke:q=!1,underlineStyle:r="#fff",underlineThickness:h=1,underlineOffsetY:m=0,images:l}={},p){super(a,b,lc());this.antialias=!1;this.fontFamily="monospace";this.fontSize="16px";this.fillStyle="#fff";this.strokeThickness=1;this.shadowStroke=!1;this.shadowFill=!1;this.shadowColor="#000";this.shadowBlur=4;this.shadowOffsetX=0;this.shadowOffsetY=0;this.underlineStyle="#fff";this.underlineThickness=1;this.underlineOffsetY=0;this.hAlign=$a.left;this.vAlign=ab.top;this.lineSpacing=0;this.wrapMode=Da.none;this.wrapWidth=0;this.fixedWidth=0;this.fixedHeight=0;this.padding={left:0,right:0,top:0,bottom:0};this._textOffsetY=0;this.type="rexText";const u=wa.get();this.resolution=u.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.canvasText=new um({canvas:this.canvas,context:this.context,parent:this,parser:p}),Ee(this,d,e),f&&Ah(this,f),Kh(this,g),Bh(this,s),Ch(this,w),Dh(this,y),Eh(this,j,i,k,n),Fh(this,B),Gh(this,G),Hh(this,H),R&&Ih(this,R,L),Jh(this,S,J,W,X,K,q),Lh(this,r,h,m),l&&yh(this,l),this.setText(c)}destroy(a){this.canvasText.destroy(),this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}updateText(a=!0,b=!0){return zh(this,a,b),this}get text(){return this._text}set text(a){this.setText(a)}setText(a="",b=!0){return Array.isArray(a)&&(a=a.join(`
`)),a!==this._text&&(this._text=a.toString(),b&&this.updateText()),this}setBackgroundStyle(a,b,c=2,d=0){return Eh(this,a,b,c,d),this}setFixedSize(a,b){return Ee(this,a,b),this}setPadding(a,b,c,d){return Ah(this,a,b,c,d),this}setTextOffsetY(a,b=!1){return vm(this,a,b),this}setHAlign(a=$a.left){return Bh(this,a),this}setVAlign(a=ab.top){return Ch(this,a),this}setLineSpacing(a=0){return Dh(this,a),this}setFont(a,b){return wm(this,a,b),this}setFillStyle(a){return Hh(this,a),this}setStrokeStyle(a,b=2){return Ih(this,a,b),this}setShadow(a="#000",b=5,c=0,d=0,e=!1,f=!1){return Jh(this,a,b,c,d,e,f),this}resize(a,b){return Ee(this,a,b),zh(this),this}setWrapMode(a,b=0){return Kh(this,a,b),this}setUnderline(a,b=2,c=0){return Lh(this,a,b,c),this}addImageInfo(a,b){return yh(this,a,b),this}getWrappedText(a,b,c){return xm(this,a,b,c)}getPlainText(a,b,c){return ym(this,a,b,c)}getText(a,b,c){return zm(this,a,b,c)}getSubString(a,b,c){return Am(this,a,b,c)}clonePenManager(a){return Bm(this,a)}getPenManager(a,b){return Cm(this,a,b)}get textOffsetY(){return this._textOffsetY}set textOffsetY(a){this._textOffsetY=a}get textOffsetYPercentage(){return-this._textOffsetY/(this.totalTextHeight-this.displayTextHeight)}set textOffsetYPercentage(a){const b=this.displayTextHeight,c=this.totalTextHeight;c<=b?this._textOffsetY=0:this._textOffsetY=-(c-b)*a}get totalTextHeight(){return this.canvasText.textHeight}get displayTextHeight(){const a=this.padding;return this.height-a.top-a.bottom}}class Ke{destroy(){}}const Le={text:null,prop:null},Me={font:void 0,fontFamily:void 0,fontStyle:void 0,fontSize:void 0,fillStyle:void 0,strokeStyle:void 0,strokeThickness:void 0,shadowColor:void 0,shadowOffsetX:void 0,shadowOffsetY:void 0,shadowBlur:void 0,shadowStroke:void 0,shadowFill:void 0,underlineStyle:void 0,underlineThickness:void 0,underlineOffsetY:void 0,image:void 0};class Lm extends Ke{splitText(a,b=!1){const c=[];let d=0;for(;;){const f=Rh.exec(a);if(!f)break;const g=f[0],j=Rh.lastIndex-g.length;d<j&&c.push(a.substring(d,j)),b||c.push(g),d=Rh.lastIndex}const e=a.length;return d<e&&c.push(a.substring(d,e)),c}tagTextToProp(a,b){let c,d;b==null&&(b={}),b.img&&ua(b,kb,"img"),Hp.test(a)?(ua(b,Ua,"b",!0),c=""):Ip.test(a)?(ua(b,kb,"b"),c=""):Jp.test(a)?(ua(b,Ua,"i",!0),c=""):Kp.test(a)?(ua(b,kb,"i"),c=""):Nm.test(a)?(d=a.match(Nm),ua(b,Ua,"size",d[1]+"px"),c=""):Lp.test(a)?(ua(b,kb,"size"),c=""):Om.test(a)?(d=a.match(Om),ua(b,Ua,"color",d[1]),c=""):Mp.test(a)?(ua(b,kb,"color"),c=""):Pm.test(a)?(d=a.match(Pm),ua(b,Ua,"u",!0),c=""):Qm.test(a)?(d=a.match(Qm),ua(b,Ua,"u",d[1]),c=""):Np.test(a)?(ua(b,kb,"u"),c=""):Op.test(a)?(ua(b,Ua,"shadow",!0),c=""):Rm.test(a)?(d=a.match(Rm),ua(b,Ua,"shadow",d[1]),c=""):Pp.test(a)?(ua(b,kb,"shadow"),c=""):Qp.test(a)?(ua(b,Ua,"stroke",!0),c=""):Sm.test(a)?(d=a.match(Sm),ua(b,Ua,"stroke",d[1]),c=""):Rp.test(a)?(ua(b,kb,"stroke"),c=""):Tm.test(a)?(d=a.match(Tm),ua(b,Ua,"img",d[1]),c=""):Sp.test(a)?(ua(b,kb,"img"),c=""):Um.test(a)?(d=a.match(Um),ua(b,Ua,"area",d[1]),c=""):Tp.test(a)?(ua(b,kb,"area"),c=""):c=a;const e=Le;return e.text=c,e.prop=b,e}propToStyle(a,b){const c=Me;return b.hasOwnProperty("img")?c.image=b.img:(c.image=null,c.fontFamily=a.fontFamily,c.fontSize=b.size??a.fontSize,c.fontStyle=Fp(b.b,b.i),c.font=`${c.fontStyle} ${c.fontSize} ${c.fontFamily}`,c.fillStyle=b.color??a.fillStyle,b.hasOwnProperty("stroke")?b.stroke===!0?(c.strokeStyle=a.strokeStyle,c.strokeThickness=a.strokeThickness):(c.strokeStyle=b.stroke,c.strokeThickness=a.strokeThickness):(c.strokeStyle=a.strokeStyle,c.strokeThickness=0)),b.hasOwnProperty("shadow")?b.shadow===!0?(c.shadowColor=a.shadowColor,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor=b.shadow,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor="#000",c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=0,c.shadowStroke=!1,c.shadowFill=!1),b.hasOwnProperty("u")?b.u===!0?(c.underlineStyle=a.underlineStyle,c.underlineThickness=a.underlineThickness,c.underlineOffsetY=a.underlineOffsetY):(c.underlineStyle=b.u,c.underlineThickness=a.underlineThickness,c.underlineOffsetY=a.underlineOffsetY):(c.underlineStyle="#000",c.underlineThickness=0,c.underlineOffsetY=0),c}propToTagText(a,b,c){c==null&&(c=Gp);let d=[];for(const f in c){if(b.hasOwnProperty(f))continue;d.push(`[/${f}]`)}a=`${d.join()}${a}`;let e=[];for(const f in b){if(c[f]===b[f])continue;switch(f){case"size":const g=b.size.replace("px","");e.push(`[size=${g}]`);break;case"color":case"img":case"area":e.push(`[${f}=${b[f]}]`);break;case"stroke":case"u":b[f]===!0?e.push(`[${f}]`):e.push(`[${f}=${b[f]}]`);break;default:e.push(`[${f}]`);break}}return a=`${a}${e.join()}`,a}}const ua=function(a,b,c,d){return b===Ua?a[c]=d:a.hasOwnProperty(c)&&delete a[c],a};var Fp=function(a,b){return a&&b?"bold italic":a?"bold":b?"italic":""};const Gp={},Rh=/\[b\]|\[\/b\]|\[i\]|\[\/i\]|\[size=(\d+)\]|\[\/size\]|\[color=([a-z]+|#[0-9abcdef]+)\]|\[\/color\]|\[u\]|\[u=([a-z]+|#[0-9abcdef]+)\]|\[\/u\]|\[shadow\]|\[shadow=([a-z]+|#[0-9abcdef]+)\]|\[\/shadow\]|\[stroke\]|\[stroke=([a-z]+|#[0-9abcdef]+)\]|\[\/stroke\]|\[img=([^\]]+)\]|\[\/img\]|\[area=([^\]]+)\]|\[\/area\]/ig;var Hp=/\[b\]/i,Ip=/\[\/b\]/i,Jp=/\[i\]/i,Kp=/\[\/i\]/i,Nm=/\[size=(\d+)\]/i,Lp=/\[\/size\]/i,Om=/\[color=([a-z]+|#[0-9abcdef]+)\]/i,Mp=/\[\/color\]/i,Pm=/\[u\]/i,Qm=/\[u=([a-z]+|#[0-9abcdef]+)\]/i,Np=/\[\/u\]/i,Op=/\[shadow\]/i,Rm=/\[shadow=([a-z]+|#[0-9abcdef]+)\]/i,Pp=/\[\/shadow\]/i,Qp=/\[stroke\]/i,Sm=/\[stroke=([a-z]+|#[0-9abcdef]+)\]/i,Rp=/\[\/stroke\]/i,Tm=/\[img=([^\]]+)\]/i,Sp=/\[\/img\]/i,Um=/\[area=([^\]]+)\]/i,Tp=/\[\/area\]/i;const kb=!1,Ua=!0;class Mm extends Fe{constructor(a,b,c="",d){super(a,b,c,d,new Lm());this.type="rexBBcodeText"}}class Wm extends Ke{constructor(a){super();this.tags=new Map();if(a)for(const b in a)this.addTag(b,a[b])}destroy(){this.tags.clear()}addTag(a,b){return this.tags.set(a,b),this}isTextTag(a){const b=this.tags.get(a);return b?b.img==null:!1}splitText(a,b=!1){const c=[];let d=0;for(;;){const f=Sh.exec(a);if(!f)break;const g=f[0],j=Sh.lastIndex-g.length;d<j&&c.push(a.substring(d,j));if(!b)c.push(g);else if(Ym.test(g)){const i=g.match(Zm);c.push(i[2])}else if(_m.test(g)){const i=g.match($m);c.push(i[2])}d=Sh.lastIndex}const e=a.length;return d<e&&c.push(a.substring(d,e)),c}tagTextToProp(a,b){let c,d;if(Ym.test(a)){const f=a.match(Zm);if(f!=null){const g=f[1],j=this.tags;d=j.get(g)??{},d._class=g,c=f[2]}}else if(_m.test(a)){const f=a.match($m);if(f!=null){const g=f[1];d=Up(g),d._style=g,c=f[2]}}c===void 0&&(c=a),d===void 0&&(d={});const e=Le;return e.text=c,e.prop=d,e}propToStyle(a,b){const c=Me;if(b.hasOwnProperty("img"))c.image=b.img;else{c.image=null,c.fontFamily=b.family??b.fontFamily??b["font-family"]??a.fontFamily;let d=b.size??b.fontSize??b["font-size"]??a.fontSize;typeof d==="number"&&(d=`${d}px`),c.fontSize=d,c.fontStyle=b.style??b.fontStyle??b["font-style"]??"",c.font=`${c.fontStyle} ${c.fontSize} ${c.fontFamily}`,c.fillStyle=b.color??b["font-color"]??a.fillStyle;if(b.hasOwnProperty("stroke")){const e=b.stroke;c.strokeStyle=e.color??a.strokeStyle,c.strokeThickness=e.thinkness??a.strokeThickness}else c.strokeStyle=a.strokeStyle,c.strokeThickness=a.strokeThickness}if(b.hasOwnProperty("shadow")){const d=b.shadow;c.shadowColor=d.color??a.shadowColor,c.shadowOffsetX=d.offsetX??a.shadowOffsetX,c.shadowOffsetY=d.offsetY??a.shadowOffsetY,c.shadowBlur=d.blur??a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0}else c.shadowColor=a.shadowColor,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=a.shadowStroke,c.shadowFill=a.shadowFill;if(b.hasOwnProperty("u")||b.hasOwnProperty("underline")){const d=b.u??b.underline;c.underlineStyle=d.color??a.underlineStyle,c.underlineThickness=d.thinkness??a.underlineThickness,c.underlineOffsetY=d.offset??a.underlineOffsetY}else c.underlineStyle="#000",c.underlineThickness=0,c.underlineOffsetY=0;return c}propToTagText(a,b,c){if(b.hasOwnProperty("_class")){if(a===""){if(this.isTextTag(b._class))return""}return`<class=${b._class}>${a}</class>`}else if(b.hasOwnProperty("_style"))return`<style=${b._style}>${a}</style>`}}function Up(a){const b=a.split(";"),c={};for(var d=0,e=b.length;d<e;d++){const[f,g]=b[d].split(":");if(Xm(f)||Xm(g))continue;if(f==="stroke"){const j=g.split(" "),i={},k=j.length;k>=1&&(i.color=j[0]),k>=2&&(i.thinkness=parseInt(j[1].replace("px",""))),c.stroke=i}else if(f==="shadow"){const j=g.split(" "),i={},k=j.length;k>=1&&(i.color=j[0]),k>=2&&(i.offsetX=parseInt(j[1].replace("px",""))),k>=3&&(i.offsetY=parseInt(j[2].replace("px",""))),k>=4&&(i.blur=parseInt(j[3].replace("px",""))),c.shadow=i}else if(f==="u"||f==="underline"){const j=g.split(" "),i={},k=j.length;k>=1&&(i.color=j[0]),k>=2&&(i.thinkness=parseInt(j[1].replace("px",""))),k>=3&&(i.offset=parseInt(j[2].replace("px",""))),c[f]=i}else c[f]=g}return c}function Xm(a){return a=a.replace(Vp,""),a.length===0}const Sh=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,Ym=/<\s*class=/i,Zm=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,_m=/<\s*style=/i,$m=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,Vp=/^\s+|\s+$/;class Vm extends Fe{constructor(a,b,c="",d){const e=d?d.tags:void 0;super(a,b,c,d,new Wm(e));this.type="rexTagText"}get parser(){return this.canvasText.parser}addTag(a,b){return this.parser.addTag(a,b),this}addTags(a){for(const b in a)this.parser.addTag(b,a[b]);return this}}function Ta(a,b){return a===void 0||b===void 0?void 0:`${a}|${b}`}function Bk(a,b){let c=a.split("|");return b===void 0&&(b=Qo),b.x=parseInt(c[0]),b.y=parseInt(c[1]),b}let Qo={x:0,y:0};let xn=new bc();function Jj(){let a=xn.pop();return a===null&&(a=new Map()),a}function Rd(a){xn.push(a)}function Hj(a,b,c,d,e,f,g,j){if(c===f&&d===g&&e===j)return;let i=Ta(c,d),k=Ta(f,g);if(i){let n=b.get(i);n.delete(e);if(i===k){n.set(j,a);return}else n.size===0&&(Rd(n),b.delete(i))}if(k){let n=b.get(k);n?n.set(j,a):(n=Jj(),n.set(j,a),b.set(k,n))}}function Yf(a,b,c,d){let e=Ta(b,c),f=a.get(e);f&&(d!==void 0?(f.delete(d),f.size===0&&(Rd(f),a.delete(e))):(f.clear(),Rd(f),a.delete(e)))}let yn=new bc();function Ij(){let a=yn.pop();return a===null&&(a=new Set()),a}function Xf(a){yn.push(a)}function Qd(a,b,c,d){if(c===d)return;if(c!==void 0){let e=b.get(c);e&&(e.delete(a),e.size===0&&(Xf(e),b.delete(c)))}if(d!==void 0){let e=b.get(d);e?e.add(a):(e=Ij(),e.add(a),b.set(d,e))}}function Sb(a,b,c){let d=a.get(b);d&&(d.delete(c),d.size===0&&(Xf(d),a.delete(b)))}function Cj(a,b,c,d,e){let f=a.chessToXYZ.get(b),g=f?f.x:void 0,j=f?f.y:void 0,i=f?f.y:void 0;f?(f.x=c,f.y=d,f.z=e):a.chessToXYZ.set(b,{x:c,y:d,z:e}),Hj(b,a.XYToZMap,g,j,i,c,d,e),Qd(b,a.XToChessSet,g,c),Qd(b,a.YToChessSet,j,d),Qd(b,a.ZToChessSet,i,e)}function Rb(a,b,c,d){let e=a.XYToZMap.get(Ta(b,c));return e===void 0?null:d!==void 0?e.has(d)?e.get(d):null:e}function Dj(a,b,c,d){if(d!==void 0){let e=Rb(a,b,c,d);if(e===void 0)return;a.chessToXYZ.delete(e),Yf(a.XYToZMap,b,c,d),Sb(a.XToChessSet,b,e),Sb(a.YToChessSet,c,e),Sb(a.ZToChessSet,d,e)}else{let e=Rb(a,b,c);if(e){for(const[f,g]of e)a.chessToXYZ.delete(g),Sb(a.XToChessSet,b,g),Sb(a.YToChessSet,c,g),Sb(a.ZToChessSet,f,g);Yf(a.XYToZMap,b,c)}}}function Ej(a,b){return a.chessToXYZ.has(b)}function Fj(a,b,c,d){return Rb(a,b,c,d)!==null}function Gj(a,b){return a.chessToXYZ.get(b)||null}function Vf(a){let b=-Infinity;for(const[c,d]of a)b<c&&(b=c);return b}function Wf(a){let b=Infinity;for(const[c,d]of a)b>c&&(b=c);return b}class Gf{constructor(){this.chessToXYZ=new Map(),this.XYToZMap=new Map(),this.XToChessSet=new Map(),this.YToChessSet=new Map(),this.ZToChessSet=new Map(),this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0}destroy(){this.clear()}clear(){return this.chessToXYZ.clear(),this.XYToZMap.clear(),this.XToChessSet.clear(),this.YToChessSet.clear(),this.ZToChessSet.clear(),this.clearBounds(),this}clearBounds(){return this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0,this}addChess(a,b,c,d){return Cj(this,a,b,c,d),this.clearBounds(),this}getChess(a,b,c){return Rb(this,a,b,c)}removeChess(a,b,c){return Dj(this,a,b,c),this.clearBounds(),this}hasChess(a){return Ej(this,a)}contains(a,b,c){return Fj(this,a,b,c)}getXYZ(a){return Gj(this,a)}get xMax(){return this._xMax===void 0&&(this._xMax=Vf(this.XToChessSet)),this._xMax}get xMin(){return this._xMin===void 0&&(this._xMin=Wf(this.XToChessSet)),this._xMin}get yMax(){return this._yMax===void 0&&(this._yMax=Vf(this.YToChessSet)),this._yMax}get yMin(){return this._yMin===void 0&&(this._yMin=Wf(this.YToChessSet)),this._yMin}}function eb(a,b=[]){let c=a.boardData.chessToXYZ;for(const[d,e]of c)b.push(d);return b}function ee(a){if(typeof a!=="object"||a.nodeType||a===a.window)return!1;try{if(a.constructor&&!{}.hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0}function Tc(a){return ee(a)?!0:typeof a==="object"?a.isTileXYZ:!1}function ca(a,b){let c=a.boardData.getXYZ(b);return c?c:Tc(b)?b:null}function pa(a,b,c,d){return a.boardData.getChess(b,c,d)}class Kj{constructor(a){this.parent=a,this.board=null,this.blocker=!1,this.boot()}boot(){typeof this.parent==="object"&&this.parent.on&&this.parent.on("destroy",this.destroy,this)}destroy(){if(this.board){let a=this.tileXYZ;this.board.boardData.removeChess(a.x,a.y,a.z)}this.parent=void 0,this.board=null}setBoard(a){return this.board=a,this}get tileXYZ(){return this.board==null?null:this.board.boardData.getXYZ(this.parent)}setBlocker(a=!0){return this.blocker=a,this}setBlockEdge(a,b=!0){typeof this.blocker==="boolean"&&(this.blocker={});let c=this.blocker;if(typeof a==="object"){let d=a;for(let e in d)c[e]=d[e]}else c[a]=b;return this}getBlockEdge(a){return typeof this.blocker==="boolean"?!1:this.blocker.hasOwnProperty(a)?this.blocker[a]:!1}}function Ya(a){return a.hasOwnProperty("rexChess")||(a.rexChess=new Kj(a)),a.rexChess}function Oa(a,b,c,d,e,f=!1,g=!1){if(b){let j=ca(a,b);if(j)c=j.x,d=j.y,e=j.z;else return}else{b=pa(a,c,d,e);if(!b)return}g||a.boardData.removeChess(c,d,e),a._isBoard&&Ya(b).setBoard(null),f&&b.destroy&&b.destroy()}function Qb(a,b){if(a.infinityMode)return;if(a.height===void 0||a.height<=b){a.height=b;return}let c=eb(a);c.forEach(d=>{let e=ca(a,d);e.y>b&&Oa(a,d)}),a.height=b}function Pb(a,b){if(a.infinityMode)return;if(a.width===void 0||a.width<=b){a.width=b;return}let c=eb(a);c.forEach(d=>{let e=ca(a,d);e.x>b&&Oa(a,d)}),a.width=b}class zd{constructor({grid:a=void 0,wrap:b=!1,inifinity:c=!1,width:d=0,height:e=0}={}){this.boardData=new Gf(),this._isBoard=!0,this.setGrid(a),this.setWrapMode(b),this.setInfinityMode(c),this.setBoardSize(d,e)}destroy(){}setGrid(a){return this.grid=a,this}setWrapMode(a=!0){return this.wrapMode=a,this}setInfinityMode(a=!0){return this.infinityMode=a,this}setBoardSize(a=0,b=0){return Pb(this,a),Qb(this,b),this}}function Xa(a,b,c,d){let e;return a.infinityMode?e=!0:e=b>=0&&b<a.width&&c>=0&&c<a.height,e&&d!==void 0&&(e=a.boardData.contains(b,c,d)),e}function Fa(a,b,c,d){return a.grid.getWorldXY(b,c,d)}function rc(a,b,c,d){if(b===void 0){let e=eb(a);for(let f=0,g=e.length;f<g;f++){let j=e[f],i=ca(a,j);Fa(a,i.x,i.y,j)}}else{if(c===void 0){let e=ca(a,b);c=e.x,d=e.y}Fa(a,c,d,b)}}function wb(a,b,c,d,e,f=!0){if(!Xa(a,c,d))return;let g=ca(a,b);e===void 0&&(g?e=g.z:e=0);if(g&&g.x===c&&g.y===d&&g.z===e)return;let j=pa(a,c,d,e);j&&(Oa(a,null,c,d,e),console.warn(`Chess at (${c},${d},${e}) has been removed because of overlapped`)),a.boardData.addChess(b,c,d,e),a._isBoard&&Ya(b).setBoard(a),f&&rc(a,b,c,d)}function Wb(a,b,c,d){return Math.atan2(d-b,c-a)}function xb(a,b,c){let d=ca(a,b),e=ca(a,c),f=Fa(a,d.x,d.y,!0),g=f.x,j=f.y;f=Fa(a,e.x,e.y,!0);let i=f.x,k=f.y;return Wb(g,j,i,k)}function rb(a,b,c){let d=c-b;return b+((a-b)%d+d)%d}function qc(a,b,c,d={x:0,y:0}){return d===!0&&(d=Yn),a.wrapMode?b=rb(b,0,a.width):!a.infinityMode&&(b<0||b>=a.width)&&(b=null),a.wrapMode?c=rb(c,0,a.height):!a.infinityMode&&(c<0||c>=a.height)&&(c=null),d.x=b,d.y=c,d}let Yn={x:0,y:0};function Na(a,b,c,d,e){let f=ca(a,b);if(f===null)return null;typeof c==="string"&&(c.indexOf(",")===-1?c=parseInt(c):c=c.split(".").map(k=>parseInt(k,10)));let g=typeof c==="number",j=typeof d==="number";if(g&&j){let k=a.grid.getTileXYAtDirection(f,c,d,e);return qc(a,k.x,k.y,k),(k.x===null||k.y===null)&&(k=null),k}Array.isArray(e)||(e=[]),c===null&&(c=a.grid.allDirections);let i;if(g)if(Array.isArray(d))for(let k=0,n=d.length;k<n;k++)i=Na(a,f,c,d[k]),i!==null&&e.push(i);else{let k,n,s;({end:k=1,start:n=k>0?1:-1,step:s=k>=n?1:-1}=d);if(n===k)i=Na(a,f,c,k),i!==null&&e.push(i);else if(n<k)for(let w=n;w<=k;w+=s)i=Na(a,f,c,w),i!==null&&e.push(i);else for(let w=n;w>=k;w+=s)i=Na(a,f,c,w),i!==null&&e.push(i)}else for(let k=0,n=c.length;k<n;k++)j?(i=Na(a,f,c[k],d),i!==null&&e.push(i)):Na(a,f,c[k],d,e);return e}function jb(a,b,c=null,d={x:0,y:0}){return Na(a,b,c,1,d)}function nc(a,b,c){b===void 0&&(b=ao);let d=a.wrapMode,e=a.infinityMode;a.wrapMode=!1,a.infinityMode=!0;let f=jb(a,b,c,!0);return a.wrapMode=d,a.infinityMode=e,xb(a,b,f)}let ao={x:0,y:0};const jq=180/Math.PI;function uc(a){return a*jq}function Oj(a,b){let c=b-a;if(c===0)return 0;let d=Math.floor((c- -180)/360);return c-d*360}function mc(a,b,c){c=uc(c);let d=a.grid.allDirections,e=Infinity,f;for(let g=0,j=d.length;g<j;g++){let i=uc(nc(a,b,d[g])),k=Math.abs(Oj(c,i));k<e&&(e=k,f=g)}return f}function pc(a,b,c){if(b===null||c===null)return null;if(b.x===c.x&&b.y===c.y)return null;let d=a.grid.getNeighborTileDirection(b,c);if(a.wrapMode&&d===null){let e=jb(a,b,null);for(let f=0,g=e.length;f<g;f++){let j=e[f];if(c.x===j.x&&c.y===j.y){d=f;break}}}return d}function oc(a,b,c){let d=ca(a,b),e=ca(a,c);return pc(a,d,e)}function Bd(a,b,c){return oc(a,b,c)!==null}function Cd(a,b,c,d=!0){let e=ca(a,b),f=ca(a,c);return e===null||f===null?null:a.grid.directionBetween(e,f,d)}function Qc(a,b,c=1,d=[]){let e=a.grid.ringToTileXYArray(b,c);for(let f=0,g=e.length;f<g;f++){let j=e[f];Xa(a,j.x,j.y)&&d.push(j)}return d}function Hf(a,b,c,d=!0,e=[]){for(let f=0;f<=c;f++){let g=d?f:c-f;Qc(a,b,g,e)}return e}function fb(a,b,c,d,e={x:0,y:0}){return e===!0&&(e=_n),c===0&&d===0?(e.x=b.x,e.y=b.y):a.grid.offset(b,c,d,e),e}let _n={x:0,y:0};function If(a,b){let c=Infinity,d=Infinity,e;for(let j=0,i=b.length;j<i;j++)e=b[j],c=Math.min(c,e.x),d=Math.min(d,e.y);if(c!==0||d!==0)for(let j=0,i=b.length;j<i;j++)e=b[j],fb(a,e,-c,-d,e);let f=-Infinity,g=-Infinity;for(let j=0,i=b.length;j<i;j++)e=b[j],f=Math.max(f,e.x),g=Math.max(g,e.y);return Pb(a,f+1),Qb(a,g+1),b}var Ub;(function(a){a[a["x+,y+"]=0]="x+,y+",a[a["x-,y+"]=1]="x-,y+",a[a["y+,x+"]=2]="y+,x+",a[a["y-,x+"]=3]="y-,x+"})(Ub||(Ub={}));function Dd(a,b,c,d=0){let e={x:0,y:0};switch(d){case 0:for(let f=0;f<a.height;f++)for(let g=0;g<a.width;g++)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 1:for(let f=0;f<a.height;f++)for(let g=a.width-1;g>=0;g--)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 2:for(let f=0;f<a.width;f++)for(let g=0;g<a.height;g++)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a);break;case 3:for(let f=0;f<a.width;f++)for(let g=a.height-1;g>=0;g--)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a)}}function Ed(a,b,c,d){return a.grid.getDistance(b,c,d)}function Pc(a,b=0,c=[]){if(Array.isArray(b)){let d=b;for(let e=0;e<a.height;e++)for(let f=0;f<a.width;f++){let g=!0;for(let j=0,i=d.length;j<i;j++)if(pa(a,f,e,d[j])!==null){g=!1;break}g&&c.push({x:f,y:e})}}else for(let d=0;d<a.height;d++)for(let e=0;e<a.width;e++)pa(a,e,d,b)===null&&c.push({x:e,y:d});return c}function Fd(a,b,c,d){return a.grid.getGridPoints(b,c,d)}function Pa(a,b,c,d=[]){let e=a.boardData.getChess(b,c);for(const[f,g]of e)d.push(g);return d}function sc(a,b,c,d=[]){let e=c!=null,f,g;for(let j=0,i=b.length;j<i;j++)f=b[j],e?(g=pa(a,f.x,f.y,c),g!==null&&d.push(g)):Pa(a,f.x,f.y,d);return d}function Gd(a,b,c,d,e){let f=ca(a,b);if(f===null)return null;d==null&&(d=f.hasOwnProperty("z")?f.z:null);let g=jb(a,f,c,!0);return g===null?null:Array.isArray(g)?(e===void 0&&(e=[]),sc(a,g,d,e)):d==null?(e===void 0&&(e=[]),Pa(a,g.x,g.y,e)):pa(a,g.x,g.y,d)}function Hd(a,b,c,d={x:0,y:0}){let e=mc(a,b,c);return Na(a,b,e,1,d)}function Id(a,b,c,d){return a.grid.getOppositeDirection(b,c,d)}function Rc(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function tc(a,b=0,c=a.length){let d=b+Math.floor(Math.random()*c);return a[d]===void 0?null:a[d]}function Jf(a,b=0,c={x:0,y:0}){c===!0&&(c=Vn);let d=Math.floor(a.width*a.height*.3);for(let f=0;f<d;f++){let g=Rc(0,a.width-1),j=Rc(0,a.height-1);if(pa(a,g,j,b)===null)return c.x=g,c.y=j,c}let e=Pc(a,b);if(e.length===0)return null;{let f=tc(e);return c.x=f.x,c.y=f.y,c}}let Vn={x:0,y:0};function Kf(a,b,c,d){if(d===void 0){let e=Pa(a,b,c);for(let f=0,g=e.length;f<g;f++){let j=Ya(e[f]).blocker;if(j===!0)return!0}return!1}else{let e=pa(a,b,c,d);if(e===null)return!1;let f=Ya(e).blocker;return f===!0}}function Lf(a,b){return a.boardData.chessToXYZ.has(b)}function Mf(a,b,c,d,e){if(d===void 0){let f=Pa(a,b,c);for(let g=0,j=f.length;g<j;g++)if(Bj(Ya(f[g]).blocker,e))return!0;return!1}else{let f=pa(a,b,c,d);return f===null?!1:Bj(Ya(f).blocker,e)}}function Bj(a,b){return a===!1||a===!0?a:a[b]===!0}function _f(a){return a=a%tn,a>=0?a:a+tn}const tn=Math.PI*2;function Pj(a,b,c=1e-4){return Math.abs(a-b)<c}function Jd(a,b,c,d,e){let f=ca(a,b),g=ca(a,c),j=xb(a,f,g);j=_f(j);let i=Math.abs(j-d);i=Math.min(i,bo-i);let k=e/2;return Pj(i,k)||i<k}const bo=Math.PI*2;function Kd(a,b,c,d,e){let f=ca(a,b),g=ca(a,c),j=a.grid.directions;a.grid.directions=a.grid.sides;let i=a.grid.directionBetween(f,g,!1);a.grid.directions=j;let k=Math.abs(i-d);return k=Math.min(k,a.grid.directions-k),k<=e/2}function Ka(a,b,c,d={x:0,y:0}){return a.grid.getTileXY(b,c,d)}function Ld(a,b,c,d){if(a.infinityMode&&d===void 0)return!0;let e=Ka(a,b,c,!0);return Xa(a,e.x,e.y,d)}function Nj(a,b,c,d){let e=a-c,f=b-d;return Math.sqrt(e*e+f*f)}function Zf(a,b,c){return(b-a)*c+a}function Nf(a,b,c,d,e,f=[]){let g=Nj(b,c,d,e),j=Math.min(a.grid.width,a.grid.height),i=Math.ceil(g/(j/4)),k;for(let n=0;n<=i;n++){let s=n/i,w=Zf(b,d,s),y=Zf(c,e,s),B=Ka(a,w,y);if(!Xa(a,B.x,B.y))continue;if(k&&k.x===B.x&&k.y===B.y)continue;f.push(B),k=B}return f}var Vb;(function(a){a[a.x=1]="x",a[a.horizontal=1]="horizontal",a[a.h=1]="h",a[a.y=2]="y",a[a.vertical=2]="vertical",a[a.v=2]="v",a[a.xy=3]="xy"})(Vb||(Vb={}));function Of(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=Zn),d!==null?fb(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.mirror(e,c,e),d!==null&&fb(a,e,d.x,d.y,e),e}let Zn={x:0,y:0};function Pf(a,b=!1,c=!1){let d=eb(a);for(let e=0,f=d.length;e<f;e++)Oa(a,d[e],void 0,void 0,void 0,b,c)}function Qf(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=$n),d!==null?fb(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.rotate(e,c,e),d!==null&&fb(a,e,d.x,d.y,e),e}let $n={x:0,y:0};function Rf(a,b,c){let d=ca(a,b);if(d===null)return;wb(a,b,d.x,d.y,c)}function Sc(a,b,c){return Math.max(b,Math.min(c,a))}function Sf(a,b,c,d=[]){let e=Ka(a,b.left,b.top,!0),f=e.x-1,g=e.y-1,j=Ka(a,b.right,b.bottom,!0),i=j.x+1,k=j.y+1;a.infinityMode||(f=Sc(f,0,a.width-1),g=Sc(g,0,a.height-1),i=Sc(i,0,a.width-1),k=Sc(k,0,a.height-1));for(let n=f;n<=i;n++)for(let s=g;s<=k;s++){let w=Fa(a,n,s,!0);c(b,w.x,w.y)&&d.push({x:n,y:s})}return d}function Tf(a,b,c,d=!0){let e=ca(a,b),f=ca(a,c);if(e==null||f==null)return;Oa(a,b),Oa(a,c),wb(a,b,f.x,f.y,f.z,d),wb(a,c,e.x,e.y,e.z,d)}function Md(a,b,c=[]){let d=a.boardData.ZToChessSet.get(b);if(d)for(const e of d)c.push(e);return c}function Nd(a,b,c=[]){for(let d=0,e=b.length;d<e;d++){let f=b[d];c.push(Fa(a,f.x,f.y))}return c}function Od(a,b,c,d={x:0,y:0}){return d===!0&&(d=co),Ka(a,b,c,d),Fa(a,d.x,d.y,d),d}let co={x:0,y:0};function Pd(a,b,c,d,e){let f=Ka(a,b,c,!0);return d!==void 0?pa(a,f.x,f.y,d):Pa(a,f.x,f.y,e)}class Ad extends zd{addChess(a,b,c,d,e=!0){return wb(this,a,b,c,d,e),this}angleBetween(a,b){return xb(this,a,b)}angleSnapToDirection(a,b){return mc(this,a,b)}angleToward(a,b){return nc(this,a,b)}areNeighbors(a,b){return Bd(this,a,b)}chessToTileXYZ(a){return ca(this,a)}contains(a,b,c){return Xa(this,a,b,c)}directionBetween(a,b,c=!0){return Cd(this,a,b,c)}filledRingToTileXYArray(a,b,c=!0,d=[]){return Hf(this,a,b,c,d)}fit(a){return If(this,a)}forEachTileXY(a,b,c=0){return Dd(this,a,b,c),this}getAllChess(a=[]){return eb(this,a)}getChessData(a){return Ya(a)}getDistance(a,b,c=!1){return Ed(this,a,b,c)}getEmptyTileXYArray(a=0,b=[]){return Pc(this,a,b)}getGridPoints(a,b,c){return Fd(this,a,b,c)}getNeighborChess(a,b,c,d){return Gd(this,a,b,c,d)}getNeighborChessDirection(a,b){return oc(this,a,b)}getNeighborTileDirection(a,b){return pc(this,a,b)}getNeighborTileXY(a,b=null,c={x:0,y:0}){return jb(this,a,b,c)}getNeighborTileXYAtAngle(a,b,c={x:0,y:0}){return Hd(this,a,b,c)}getOppositeDirection(a,b,c){return Id(this,a,b,c)}getRandomEmptyTileXY(a=0,b={x:0,y:0}){return Jf(this,a,b)}getTileXYAtDirection(a,b,c,d){return Na(this,a,b,c,d)}getWrapTileXY(a,b,c={x:0,y:0}){return qc(this,a,b,c)}gridAlign(a,b,c){return rc(this,a,b,c),this}hasBlocker(a,b,c){return Kf(this,a,b,c)}hasChess(a){return Lf(this,a)}hasEdgeBlocker(a,b,c,d){return Mf(this,a,b,c,d)}isAngleInCone(a,b,c,d){return Jd(this,a,b,c,d)}isDirectionInCone(a,b,c,d){return Kd(this,a,b,c,d)}isOverlappingPoint(a,b,c){return Ld(this,a,b,c)}lineToTileXYArray(a,b,c,d,e=[]){return Nf(this,a,b,c,d,e)}mirror(a,b,c=null,d={x:0,y:0}){return Of(this,a,b,c,d)}offset(a,b,c,d){return fb(this,a,b,c,d)}removeAllChess(a=!1,b=!1){return Pf(this,a,b),this}removeChess(a,b,c,d,e=!1,f=!1){return Oa(this,a,b,c,d,e,f),this}ringToTileXYArray(a,b=1,c=[]){return Qc(this,a,b,c)}rotate(a,b,c=null,d={x:0,y:0}){return Qf(this,a,b,c,d)}setBoardWidth(a=0){return Pb(this,a),this}setBoardHeight(a=0){return Qb(this,a),this}setTileZ(a,b){return Rf(this,a,b),this}shapeToTileXYArray(a,b,c=[]){return Sf(this,a,b,c)}swapChess(a,b,c=!0){return Tf(this,a,b,c),this}tileXYArrayToChessArray(a,b,c=[]){return sc(this,a,b,c)}tileXYToChessArray(a,b,c=[]){return Pa(this,a,b,c)}tileXYZToChess(a,b,c){return pa(this,a,b,c)}tileZToChessArray(a,b=[]){return Md(this,a,b)}tileXYArrayToWorldXYArray(a,b=[]){return Nd(this,a,b)}tileXYToWorldXY(a,b,c={x:0,y:0}){return Fa(this,a,b,c)}worldXYSnapToGrid(a,b,c={x:0,y:0}){return Od(this,a,b,c)}worldXYToChess(a,b,c,d){return Pd(this,a,b,c,d)}worldXYToTileXY(a,b,c){return Ka(this,a,b,c)}}class Aj extends Ad{}const Za={};ec(Za,{ChessToTileXYZ:()=>ca,Contains:()=>Xa,DirectionBetween:()=>Cd,ForEachTileXY:()=>Dd,GetDistance:()=>Ed,GetOppositeDirection:()=>Id,GetTileXYAtDirection:()=>Na,GetWrapTileXY:()=>qc,IsDirectionInCone:()=>Kd,TileXYArrayToChessArray:()=>sc,TileXYToChessArray:()=>Pa,TileXYZToChess:()=>pa,TileZToChessArray:()=>Md});const yb={};ec(yb,{AngleBetween:()=>xb,AngleSnapToDirection:()=>mc,AngleToward:()=>nc,GetGridPoints:()=>Fd,GridAlign:()=>rc,IsAngleInCone:()=>Jd,IsOverlappingPoint:()=>Ld,TileXYArrayToWorldXYArray:()=>Nd,TileXYToWorldXY:()=>Fa,WorldXYSnapToGrid:()=>Od,WorldXYToChess:()=>Pd,WorldXYToTileXY:()=>Ka});const Tb={};ec(Tb,{AreNeighbors:()=>Bd,GetNeighborChess:()=>Gd,GetNeighborChessDirection:()=>oc,GetNeighborTileDirection:()=>pc,GetNeighborTileXY:()=>jb,GetNeighborTileXYAtAngle:()=>Hd});var oa;(function(a){a[a.orthogonal=0]="orthogonal",a[a.isometric=1]="isometric"})(oa||(oa={}));var sb;(function(a){a[a["4dir"]=4]="4dir",a[a["8dir"]=8]="8dir"})(sb||(sb={}));class vk{constructor({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=oa.orthogonal,dir:f=sb["4dir"]}={}){this.setOriginPosition(a,b),this.setCellSize(c,d),this.setType(e),this.setDirectionMode(f)}fromJSON({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=oa.orthogonal,dir:f=sb["4dir"]}={}){return this.setType(e),this.setDirectionMode(f),this.setOriginPosition(a,b),this.setCellSize(c,d),this}toJSON(){return{x:this.x,y:this.y,cellWidth:this.cellWidth,cellHeight:this.cellHeight,type:this.mode,dir:this.directions}}setOriginPosition(a=0,b=0){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setType(a=oa.orthogonal){return typeof a==="string"&&(a=oa[a]),this.mode=a,this}setDirectionMode(a=sb["4dir"]){return typeof a==="string"&&(a=sb[a]),this.directions=a,this}}function nk(a,b,c,d=!0){let e;switch(a.mode){case oa.orthogonal:case oa.isometric:if(b.y===c.y)e=c.x>=b.x?0:2;else if(b.x===c.x)e=c.y>=b.y?1:3;else if(a.directions===sb["4dir"]){let f=uc(Wb(b.x,b.y,c.x,c.y));f<0&&(f+=360),e=f/90,d&&(e=Math.round(e))}else{let f=c.x-b.x,g=c.y-b.y;if(f===g)e=f>0?4:6;else if(f===-g)e=f>0?7:5;else{let j=uc(Math.atan2(g,f));j<0&&(j+=360);let i=j/45;d&&(i=Math.round(i)),i>=0&&i<1?e=i:i>=1&&i<2?e=i+3:i>=2&&i<3?e=i-1:i>=3&&i<4?e=i+2:i>=4&&i<5?e=i-2:i>=5&&i<6?e=i+1:i>=6&&i<7?e=i-3:e=i}}break}return e===a.directions&&(e=0),e}function $d(a,b){return rb(b,0,a.directions)}function ok(a,b,c,d=!1){let e=c.x-b.x,f=c.y-b.y,g;return d?g=Math.abs(e)+Math.abs(f):g=Math.sqrt(e*e+f*f),g}function Xd(a,b=[]){if(!(b.length===a))if(b.length<a)for(let c=b.length;c<a;c++)b.push({x:0,y:0});else b.length=a;return b}function ce(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=yo);let e,f;switch(a.mode){case oa.orthogonal:e=b*a.width,f=c*a.height;break;case oa.isometric:e=(b-c)*a._halfWidth,f=(b+c)*a._halfHeight;break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let yo={x:0,y:0};function pk(a,b=0,c=0,d=[]){if(typeof b==="object"){let i=b;c=i.y,b=i.x}d===!0&&(d=uo),Xd(4,d);let e,f;({x:e,y:f}=ce(a,b,c));let g=a._halfWidth,j=a._halfHeight;switch(a.mode){case oa.orthogonal:d[0].x=e+g,d[0].y=f-j,d[1].x=e+g,d[1].y=f+j,d[2].x=e-g,d[2].y=f+j,d[3].x=e-g,d[3].y=f-j;break;case oa.isometric:d[0].x=e+g,d[0].y=f,d[1].x=e,d[1].y=f+j,d[2].x=e-g,d[2].y=f,d[3].x=e,d[3].y=f-j;break}return d}let uo=[];const vc=[[1,0],[0,1],[-1,0],[0,-1],[1,1],[-1,1],[-1,-1],[1,-1]],Uc=vc;function kk(a){let b={},c,d,e;for(let f in a)c=a[f],d=c[0],e=c[1],b.hasOwnProperty(d)||(b[d]={}),b[d][e]=parseInt(f);return b}const lk=kk(vc),mk=kk(Uc);function qk(a,b,c){let d;switch(a.mode){case oa.orthogonal:d=lk;break;case oa.isometric:d=mk;break}let e=c.x-b.x,f=c.y-b.y;if(d.hasOwnProperty(e)){let g=d[e];if(g.hasOwnProperty(f))return g[f]}return null}function de(a,b,c,d,e={x:0,y:0}){e===!0&&(e=xo);let f,g;switch(a.mode){case oa.orthogonal:f=vc[c][0],g=vc[c][1];break;case oa.isometric:f=Uc[c][0],g=Uc[c][1];break}return d===1?(e.x=b.x+f,e.y=b.y+g):(e.x=b.x+d*f,e.y=b.y+d*g),e}let xo={x:0,y:0};function rk(a,b,c,d={x:0,y:0}){return de(a,b,c,1,d)}function sk(a,b,c,d){return vo[d]}const vo={0:2,1:3,2:0,3:1,4:6,5:7,6:4,7:5};function tk(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=wo),b-=a.x,c-=a.y;let e=b/a.width,f=c/a.height;switch(a.mode){case oa.orthogonal:d.x=Math.round(e),d.y=Math.round(f);break;case oa.isometric:d.x=Math.round(+e+f),d.y=Math.round(-e+f);break}return d}let wo={x:0,y:0};function uk(a,b,c,d={x:0,y:0}){return typeof c==="string"&&(c=Vb[c]),d===!0&&(d=zo),d.x=c&1?-b.x:b.x,d.y=c&2?-b.y:b.y,d}let zo={x:0,y:0};function Xb(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Ao);let f=b.x+c,g=b.y+d;return e.x=f,e.y=g,e}let Ao={x:0,y:0};function wk(a,b,c,d=[]){let e,f;for(e=c,f=-c;f<=c;f++)d.push(Xb(a,b,e,f));for(f=c,e=c-1;e>=-c;e--)d.push(Xb(a,b,e,f));for(e=-c,f=c-1;f>=-c;f--)d.push(Xb(a,b,e,f));for(f=-c,e=-c+1;e<=c-1;e++)d.push(Xb(a,b,e,f));return d}function xk(a,b,c,d={x:0,y:0}){d===!0&&(d=Fo),c=rb(c,0,3);let e,f;switch(c){case 1:e=-b.y,f=b.x;break;case 2:e=-b.x,f=-b.y;break;case 3:e=b.y,f=-b.x;break;default:e=b.x,f=b.y;break}return d.x=e,d.y=f,d}let Fo={x:0,y:0};function ae(a){a._savedOriginX=a.x,a._savedOriginY=a.y}function be(a){a.x=a._savedOriginX,a.y=a._savedOriginY}class jk extends vk{get sides(){return 4}get allDirections(){return this.directions===4?Bo:Co}get halfDirections(){return this.directions===4?Do:Eo}directionBetween(a,b,c=!0){return nk(this,a,b,c)}directionNormalize(a){return $d(this,a)}getDistance(a,b,c=!1){return ok(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return pk(this,a,b,c)}getNeighborTileDirection(a,b){return qk(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return rk(this,a,b,c)}getOppositeDirection(a,b,c){return sk(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return tk(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return de(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return ce(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return uk(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return Xb(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return wk(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return xk(this,a,b,c)}restoreOrigin(){return be(this),this}saveOrigin(){return ae(this),this}}const Bo=[0,1,2,3],Co=[0,1,2,3,4,5,6,7],Do=[0,1],Eo=[0,1,4,5];var da;(function(a){a[a.ODD_R=0]="ODD_R",a[a.EVEN_R=1]="EVEN_R",a[a.ODD_Q=2]="ODD_Q",a[a.EVEN_Q=3]="EVEN_Q"})(da||(da={}));var gb;(function(a){a[a.y=0]="y",a[a.flat=0]="flat",a[a.x=1]="x",a[a.pointy=1]="pointy"})(gb||(gb={}));var Bb;(function(a){a[a.even=0]="even",a[a.odd=1]="odd"})(Bb||(Bb={}));class ck{constructor({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=gb.x,staggerIndex:g=Bb.odd}={}){this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e)}fromJSON({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=gb.x,staggerIndex:g=Bb.odd}={}){return this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e),this}toJSON(){return{x:this.x,y:this.y,radius:this.radius,cellWidth:this.cellWidth,cellHeight:this.cellHeight,staggerAxis:this.staggerAxis,staggerIndex:this.staggerIndex}}setOriginPosition(a,b){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this.radius=void 0,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setRadius(a=0){let b,c;return this.staggerAxis===gb.y?(b=2*a,c=ik*a):(b=ik*a,c=2*a),this.setCellSize(b,c),this.radius=a,this}setDirectionMode(){return this.directions=6,this}setType(a=1,b=1){return typeof a==="string"&&(a=gb[a]),typeof b==="string"&&(b=Bb[b]),this.staggerAxis=a,this.staggerIndex=b,a===gb.y?this.mode=b===Bb.even?da.EVEN_Q:da.ODD_Q:this.mode=b===Bb.even?da.EVEN_R:da.ODD_R,this}}const ik=Math.sqrt(3);function Qa(a,b,c,d={x:0,y:0,z:0}){d===!0&&(d=$f);switch(a){case da.ODD_R:d.x=b-(c-(c&1))/2,d.z=c;break;case da.EVEN_R:d.x=b-(c+(c&1))/2,d.z=c;break;case da.ODD_Q:d.x=b,d.z=c-(b-(b&1))/2;break;case da.EVEN_Q:d.x=b,d.z=c-(b+(b&1))/2;break}return d.y=-d.x-d.z,d}function Sj(a,b,c,d={x:0,y:0,z:0}){typeof a!=="number"&&(d=a,a=d.x,b=d.y,c=d.z),d===!0&&(d=$f);let e=Math.round(a),f=Math.round(b),g=Math.round(c),j=Math.abs(e-a),i=Math.abs(f-b),k=Math.abs(g-c);return j>i&&j>k?e=-f-g:i>k?f=-e-g:g=-e-f,d.x=e,d.y=f,d.z=g,d}function Ca(a,b,c,d,e={x:0,y:0}){e===!0&&(e=fo);switch(a){case da.ODD_R:e.x=b+(d-(d&1))/2,e.y=d;break;case da.EVEN_R:e.x=b+(d+(d&1))/2,e.y=d;break;case da.ODD_Q:e.x=b,e.y=d+(b-(b&1))/2;break;case da.EVEN_Q:e.x=b,e.y=d+(b+(b&1))/2;break}return e}function Tj(a,b,c={x:0,y:0,z:0}){return c===!0&&(c=$f),c.x=a,c.y=-a-b,c.z=b,c}let $f={x:0,y:0,z:0},fo={x:0,y:0};function Vj(a,b,c,d=!0){let e;Qa(a.mode,b.x,b.y,Td),Qa(a.mode,c.x,c.y,Ud);let f=Ud.x-Td.x,g=Ud.y-Td.y,j=Ud.z-Td.z;return j===0?e=f>0?0:3:f===0?e=j>0?1:4:g===0?e=j>0?2:5:f>0&&g<0&&j>0?e=0+j/-g:f<0&&g<0&&j>0?e=1+-g/j:f<0&&g>0&&j>0?e=2+g/-f:f<0&&g>0&&j<0?e=3+-j/g:f>0&&g>0&&j<0?e=4+f/-j:e=5+-g/f,d&&(e=Math.round(e)),e}let Td={x:0,y:0,z:0},Ud={x:0,y:0,z:0};function Wj(a,b,c,d=!1){Qa(a.mode,b.x,b.y,Vd),Qa(a.mode,c.x,c.y,Wd);let e=Wd.x-Vd.x,f=Wd.y-Vd.y,g=Wd.z-Vd.z;return(Math.abs(e)+Math.abs(f)+Math.abs(g))/2}let Vd={x:0,y:0,z:0},Wd={x:0,y:0,z:0};function Yd(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=oo);let e=b*a.width,f=c*a.height;switch(a.mode){case da.ODD_R:c&1&&(e+=a._halfWidth),f*=.75;break;case da.EVEN_R:c&1&&(e-=a._halfWidth),f*=.75;break;case da.ODD_Q:e*=.75,b&1&&(f+=a._halfHeight);break;case da.EVEN_Q:e*=.75,b&1&&(f-=a._halfHeight);break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let oo={x:0,y:0};function Xj(a,b=0,c=0,d=[]){if(typeof b==="object"){let g=b;c=g.y,b=g.x}d===!0&&(d=ko),Xd(6,d);let e,f;({x:e,y:f}=Yd(a,b,c));if(a.radius!==void 0){let g=a.radius,j=a.staggerAxis===gb.flat?0:-30;for(let i=0;i<6;i++){let k=60*i+j,n=zb(k);d[i].x=e+g*Math.cos(n),d[i].y=f+g*Math.sin(n)}}else{let g=a._halfWidth,j=g/2,i=a._halfHeight,k=i/2;a.staggerAxis===gb.flat?(d[0].x=e+g,d[0].y=f,d[1].x=e+j,d[1].y=f+i,d[2].x=e-j,d[2].y=f+i,d[3].x=e-g,d[3].y=f,d[4].x=e-j,d[4].y=f-i,d[5].x=e+j,d[5].y=f-i):(d[0].x=e+g,d[0].y=f-k,d[1].x=e+g,d[1].y=f+k,d[2].x=e,d[2].y=f+i,d[3].x=e-g,d[3].y=f+k,d[4].x=e-g,d[4].y=f-k,d[5].x=e,d[5].y=f-i)}return d}let ko=[];const go=[[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]]],ho=[[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]],[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]]],io=[[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]],[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]]],jo=[[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]],[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]]],_a=[go,ho,io,jo];function Ab(a){let b={},c,d;for(let e in a)[c,d]=a[e],b.hasOwnProperty(c)||(b[c]={}),b[c][d]=parseInt(e);return b}const Uj=[[Ab(_a[0][0]),Ab(_a[0][1])],[Ab(_a[1][0]),Ab(_a[1][1])],[Ab(_a[2][0]),Ab(_a[2][1])],[Ab(_a[3][0]),Ab(_a[3][1])]];function Zd(a,b,c){let d;switch(a){case da.ODD_R:case da.EVEN_R:d=c&1;break;case da.ODD_Q:case da.EVEN_Q:d=b&1;break}return d}function Yj(a,b,c){let d=a.mode,e=Zd(d,b.x,b.y),f=Uj[d][e],g=c.x-b.x,j=c.y-b.y;if(f.hasOwnProperty(g)){let i=f[g];if(i.hasOwnProperty(j))return i[j]}return null}function _d(a,b,c,d,e={x:0,y:0}){e===!0&&(e=no);let f=a.mode,g=b.x,j=b.y;if(d===1){let i=Zd(f,g,j);e.x=g+_a[f][i][c][0],e.y=j+_a[f][i][c][1]}else if(d===0)e.x=g,e.y=j;else{let i=Qa(f,g,j,!0),k,n,s;switch(c){case 1:k=i.x,n=i.y-d,s=i.z+d;break;case 2:k=i.x-d,n=i.y,s=i.z+d;break;case 3:k=i.x-d,n=i.y+d,s=i.z;break;case 4:k=i.x,n=i.y+d,s=i.z-d;break;case 5:k=i.x+d,n=i.y,s=i.z-d;break;default:k=i.x+d,n=i.y-d,s=i.z;break}Ca(f,k,n,s,e)}return e}let no={x:0,y:0};function Zj(a,b,c,d={x:0,y:0}){return _d(a,b,c,1,d)}function _j(a,b,c,d){return(d+3)%6}const $j=4/3,ak=2/3;function bk(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=mo),b-=a.x,c-=a.y;let e,f;switch(a.mode){case da.ODD_R:case da.EVEN_R:f=c*$j/a.height,e=b/a.width-ak*(c/a.height);break;case da.ODD_Q:case da.EVEN_Q:f=c/a.height-ak*(b/a.width),e=b*$j/a.width;break}let g=Tj(e,f,lo);return Sj(g),Ca(a.mode,g.x,g.y,g.z,d),d}let lo={x:0,y:0,z:0},mo={x:0,y:0};function dk(a,b,c,d={x:0,y:0}){typeof c==="string"&&(c=Vb[c]),d===!0&&(d=ro);let e=Qa(a.mode,b.x,b.y,!0),f=a.mode===da.ODD_R||a.mode===da.EVEN_R,g,j,i;return c&1&&(f?(g=e.y,j=e.x,i=e.z):(g=-e.x,j=-e.z,i=-e.y),e.x=g,e.y=j,e.z=i),c&2&&(f?(g=-e.y,j=-e.x,i=-e.z):(g=e.x,j=e.z,i=e.y)),Ca(a.mode,g,j,i,d),d}let ro={x:0,y:0};function ek(a,b,c,d,e={x:0,y:0}){e===!0&&(e=so);let f=b.x+c,g=b.y+d;switch(a.mode){case da.ODD_R:(d&1)!==0&&((g&1)===0&&(f+=1));break;case da.EVEN_R:(d&1)!==0&&((g&1)===0&&(f-=1));break;case da.ODD_Q:(c&1)!==0&&((f&1)==0&&(g+=1));break;case da.EVEN_Q:(c&1)!==0&&((f&1)==0&&(g-=1));break}return e.x=f,e.y=g,e}let so={x:0,y:0};function fk(a,b,c,d=[]){let e=Qa(a.mode,b.x,b.y,!0),f=e.x,g=e.y,j=e.z,i,k,n;for(n=c,i=0;i>=-c;i--)k=-i-n,d.push(Ca(a.mode,f+i,g+k,j+n));for(i=-c,k=1;k<=c;k++)n=-i-k,d.push(Ca(a.mode,f+i,g+k,j+n));for(k=c,n=-1;n>=-c;n--)i=-k-n,d.push(Ca(a.mode,f+i,g+k,j+n));for(n=-c,i=1;i<=c;i++)k=-i-n,d.push(Ca(a.mode,f+i,g+k,j+n));for(i=c,k=-1;k>=-c;k--)n=-i-k,d.push(Ca(a.mode,f+i,g+k,j+n));for(k=-c,n=1;n<=c-1;n++)i=-k-n,d.push(Ca(a.mode,f+i,g+k,j+n));return d}function gk(a,b,c,d={x:0,y:0}){d===!0&&(d=to),c=rb(c,0,5);let e=Qa(a.mode,b.x,b.y,!0),f,g,j;switch(c){case 1:f=-e.z,g=-e.x,j=-e.y;break;case 2:f=e.y,g=e.z,j=e.x;break;case 3:f=-e.x,g=-e.y,j=-e.z;break;case 4:f=e.z,g=e.x,j=e.y;break;case 5:f=-e.y,g=-e.z,j=-e.x;break;default:f=e.x,g=e.y,j=e.z;break}return Ca(a.mode,f,g,j,d),d}let to={x:0,y:0};class hk extends ck{get sides(){return 6}get allDirections(){return po}get halfDirections(){return qo}directionBetween(a,b,c=!0){return Vj(this,a,b,c)}directionNormalize(a){return $d(this,a)}getDistance(a,b,c=!1){return Wj(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return Xj(this,a,b,c)}getNeighborTileDirection(a,b){return Yj(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return Zj(this,a,b,c)}getOppositeDirection(a,b,c){return _j(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return bk(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return _d(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return Yd(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return dk(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return ek(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return fk(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return gk(this,a,b,c)}restoreOrigin(){return be(this),this}saveOrigin(){return ae(this),this}}const po=[0,1,2,3,4,5],qo=[0,1,2];var ya;(function(a){a[a.random=0]="random",a[a.diagonal=1]="diagonal",a[a.straight=2]="straight",a[a.line=3]="line",a[a.astar=10]="astar",a[a["astar-random"]=11]="astar-random",a[a["astar-line"]=12]="astar-line"})(ya||(ya={}));const Yb=null;class hn{constructor(a){this.content=[],this.scoreFunction=a}clear(){this.content.length=0}push(a){this.content.push(a),this.sinkDown(this.content.length-1)}pop(){let a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.bubbleUp(0)),a}remove(a){let b=this.content.indexOf(a),c=this.content.pop();b!==this.content.length-1&&(this.content[b]=c,this.scoreFunction(c)<this.scoreFunction(a)?this.sinkDown(b):this.bubbleUp(b))}get size(){return this.content.length}rescoreElement(a){this.sinkDown(this.content.indexOf(a))}sinkDown(a){let b=this.content[a];for(;a>0;){let c=(a+1>>1)-1,d=this.content[c];if(this.scoreFunction(b)<this.scoreFunction(d))this.content[c]=b,this.content[a]=d,a=c;else break}}bubbleUp(a){let b=this.content.length,c=this.content[a],d=this.scoreFunction(c);for(;;){let e=a+1<<1,f=e-1,g=null,j;if(f<b){let i=this.content[f];j=this.scoreFunction(i),j<d&&(g=f)}if(e<b){let i=this.content[e],k=this.scoreFunction(i);k<(g===null?d:j)&&(g=e)}if(g!==null)this.content[a]=this.content[g],this.content[g]=c,a=g;else break}}}let Kea=new hn(a=>a.f);const Se=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d=d.prevNodes[0];return c.reverse()};const ln=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d.prevNodes.length===1?d=d.prevNodes[0]:d=tc(d.prevNodes);return c.reverse()};const kn=function(a,b,c=[]){let d=b,e=b.angleTo(a);for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1)d=d.prevNodes[0];else{let f=Infinity;for(let g=1,j=d.prevNodes.length;g<j;g++){let i=d.prevNodes[g],k=Math.abs(b.angleTo(i)-e);k<f&&(f=k,d=i)}}}return c.reverse()};const jn=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let j=0,i=d.prevNodes.length;j<i;j++){f=d.prevNodes[j],g=f.logicDirTo(d);if(g!==e)break}e=g,d=f}}return c.reverse()};const mn=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let j=0,i=d.prevNodes.length;j<i;j++){f=d.prevNodes[j],g=f.logicDirTo(d);if(g===e)break}e=g,d=f}}return c.reverse()};let dc={};dc[ya.astar]=Se;dc[ya["astar-line"]]=Se;dc[ya["astar-random"]]=Se;dc[ya.random]=ln;dc[ya.line]=kn;dc[ya.diagonal]=jn;dc[ya.straight]=mn;class Ak{constructor(){this.prevNodes=[]}shutdown(){this.key=void 0,this.prevNodes.length=0}destroy(){this.shutdown()}reset(a){this.key=a,this.f=0,this.g=0,this.h=void 0,this.closerH=void 0,this.visited=!1,this.closed=!1}heuristic(a,b,c){if(b===null)return 0;let d,e=this.distanceTo(a)*this.manager.weight;switch(b){case ya.astar:d=e;break;case ya["astar-line"]:if(c!==void 0){let f=a.angleTo(c)-this.angleTo(c);d=e+Math.abs(f)}else d=e;case ya["astar-random"]:d=e+Math.random();break;default:d=e;break}return d}getNextNodes(){return[]}getCost(a){return Yb}distanceTo(a){return 0}angleTo(a){return 0}logicDirTo(a){return 0}getNode(a,b=!1){return this.manager.getNode(a,b)}}function Zb(a){for(let b=a.length-1;b>0;b--){let c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a}class Po extends Ak{constructor(a){super();this.isTileXYZ=!0;this.pathFinder=a}reset(a){super.reset(a),this.key=a,Bk(a,this),this._px=void 0,this._py=void 0,this.cost=void 0}getNextNodes(){let a=Tb.GetNeighborTileXY(this.board,this);this.pathFinder.shuffleNeighbors&&Zb(a);let b=[];return a.forEach(c=>{let d=this.getNode(Ta(c.x,c.y),!0);b.push(d)}),b}getCost(a){return this.pathFinder.cacheCost?this.cost===void 0&&(this.cost=this.pathFinder.getCost(this,a)):this.cost=this.pathFinder.getCost(this,a),this.cost}distanceTo(a){return Za.GetDistance(this.board,this,a,!0)}angleTo(a){return Wb(this.worldX,this.wroldY,a.worldX,a.worldX)}logicDirTo(a){return Tb.GetNeighborTileDirection(this.board,this,a)}get board(){return this.pathFinder.board}get worldX(){if(this._px===void 0){let a=yb.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._px}get wroldY(){if(this._py===void 0){let a=yb.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._py}}class Ko{constructor(){this.data=[];this.visited=new Set()}push(a,b){if(Array.isArray(a)){let d=a;for(let e=0,f=d.length;e<f;e++)this.push(d[e]);return this}if(typeof a==="object"){let d=a;a=d.x,b=d.y}let c=`${a},${b}`;return this.visited.has(c)?this:(this.data.push({x:a,y:b}),this.visited.add(c),this)}pop(){return this.data.pop()}get length(){return this.data.length}clear(){return this.data.length=0,this.visited.clear(),this}}let DW=new Ko();var Sd;(function(a){a[a.direction=0]="direction",a[a.angle=1]="angle"})(Sd||(Sd={}));function Ae(a,b,c){const d=Math.ceil(b*a.resolution),e=Math.ceil(c*a.resolution),f=a.canvas;if(f.width===d||f.height===e){Be(a);return}f.width=d,f.height=e,a.texture.setSize(b,c),a.setSize(b,c),a.updateTexture()}function Be(a){a.context.clearRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function rh(a,b="#fff"){let c=a.context;c.fillStyle=b,c.fillRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function Ce(a,b,c){const d=new Image();d.onload=function(){const e=a.resolution,f=d.width/e,g=d.height/e;Ae(a,f,g),a.context.drawImage(d,0,0),a.updateTexture(),c&&c(),d.onload=null,d.src="",d.remove()},d.src=b}function sh(a,b){return new Promise(function(c,d){Ce(a,b,c)})}function th(a,b,c){return a.canvas.toDataURL(b,c)}function uh(a,b,c,d=[0,0,0,0]){const e=a.context.getImageData(b,c,1,1).data;return d[0]=e[0],d[1]=e[1],d[2]=e[2],d[3]=e[3],d}function vh(a,b,c,d,e,f,g){g===void 0&&(g=d!==0||e!==0||f!==0?255:0);const j=a.context.createImageData(1,1);j.data[0]=d,j.data[1]=e,j.data[2]=f,j.data[3]=g,a.context.putImageData(j,b,c),a.updateTexture()}class ed extends Jb{constructor(a=0,b=0,c=32,d=32){super(a,b,lc());this.type="rexCanvas";const e=wa.get();this.resolution=e.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.resize(c,d)}updateTexture(){return this.texture.binding&&this.texture.binding.update(),this.setDirty(ba.TEXTURE),this}destroy(a){this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}resize(a,b){return Ae(this,a,b),this}clear(){return Be(this),this}}function Hb(a,b,c,d=1){let e;if(typeof a==="string"){let j=Ea.get();j.has(a)||j.add(a,lc()),e=j.get(a)}else e=a;let f=e.image,g=f.getContext("2d");return c?b.call(c,f,g):b(f,g),e.setSize(f.width/d,f.height/d),e.binding&&e.binding.update(),e}var gn;(function(a){a[a.right=0]="right",a[a.down=1]="down",a[a.left=2]="left",a[a.up=3]="up"})(gn||(gn={}));function tm(a,b){b.width!==a.width&&(b.width=a.width),b.height!==a.height&&(b.height=a.height);let c=b.getContext("2d");return c.drawImage(a.texture.image,a.x,a.y,a.width,a.height),b}function wh(a,b,c=0,d=0,e=a.width,f=a.height){const g=a.resolution,j=a.canvas,i=Math.ceil(e*g),k=Math.ceil(f*g);Hb(b,function(n,s){n.width!==i&&(n.width=i),n.height!==k&&(n.height=k),s.clearRect(0,0,i,k),s.drawImage(j,c,d,i,k)},void 0,a.resolution)}function xh(a,b,c){const d=Ea.get();if(!d.has(b))return;tm(d.get(b).getFrame(c),a.canvas);const e=a.canvas.width,f=a.canvas.height,g=a.resolution,j=e/g,i=f/g;a.texture.setSize(j,i),a.setSize(j,i),a.updateTexture()}class sm extends ed{fill(a="#fff"){return rh(this,a),this}getCanvas(){return this.canvas}getContext(){return this.context}getDataURL(a,b){return th(this,a,b)}getPixel(a,b,c=[0,0,0,0]){return uh(this,a,b,c)}generateTexture(a,b=0,c=0,d=this.width,e=this.height){return wh(this,a,b,c,d,e),this}loadFromURL(a,b){return Ce(this,a,b),this}loadFromURLPromise(a){return sh(this,a)}loadTexture(a,b){return xh(this,a,b),this}setPixel(a,b,c,d,e,f){return vh(this,a,b,c,d,e,f),this}}function hi(a,b){return a.events.delete(b),a}function gi(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);let e=d.size;for(const f of d){f.callback.apply(f.context,c),f.once&&d.delete(f),e--;if(e===0)break}return d.size===0&&a.events.delete(b),!0}class hd{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function ji(a){return[...a.events.keys()]}function ii(a,b){const c=a.events.get(b);return c?c.size:0}function ki(a,b){const c=[],d=a.events.get(b);return d.forEach(e=>{c.push(e.callback)}),c}function fi(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof hd)g.delete(c);else{const j=!d,i=e!==void 0;for(const k of g)k.callback===c&&(j&&k.context===d)&&(i&&k.once===e)&&g.delete(k)}return g.size===0&&f.delete(b),a}function gd(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new hd(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function ei(a,b,c,d=a){return gd(a,b,c,d,!0)}function Ue(a,b){b?a.events.delete(b):a.events.clear()}function sn(a){return class extends a{constructor(){super(...arguments);this.events=null}setEventEmitter(b){return this.destroyEventEmitter(),this.privateEE=b===void 0,this.privateEE?this.events=new Map():b?this.events=b.events:this.events=null,this.lastEventInstance=null,this}getEventEmitter(){return this}clearEventEmitter(){return this.setEventEmitter(null),this}destroyEventEmitter(){return this.lastEventInstance=null,this.events&&this.privateEE&&(Ue(this),this.events=null),this}on(b,c,d=this,e=!1){return this.lastEventInstance=null,this.events&&(this.lastEventInstance=gd(this,b,c,d,e)),this}once(b,c,d=this){return this.lastEventInstance=null,this.events&&(this.lastEventInstance=ei(this,b,c,d)),this}off(b,c,d,e){return this.lastEventInstance=null,this.events&&fi(this,b,c,d,e),this}emit(b,...c){return this.lastEventInstance=null,this.events&&gi(this,b,...c),this}removeAllListeners(b){return this.lastEventInstance=null,this.events&&Ue(this,b),this}clearEvent(b){return this.lastEventInstance=null,this.events&&hi(this,b),this}getListenerCount(b){return this.lastEventInstance=null,this.events?ii(this,b):0}getEventNames(){return this.lastEventInstance=null,this.events?ji(this):[]}getListeners(b){return this.lastEventInstance=null,this.events?ki(this,b):[]}}}const ta=sn(class{});var lb;(function(a){a[a.no=0]="no",a[a.lazy=1]="lazy",a[a.always=2]="always"})(lb||(lb={}));const mi="complete";class Qe extends ta{constructor(a,{eventEmitter:b,tickingMode:c=lb.lazy}={}){super();this._isRunning=!1;this.tickingState=!1;this.parent=a,this.setEventEmitter(b),this.setTickingMode(c)}boot(){this.tickingMode===lb.always&&!this.tickingState&&this.startTicking()}shutdown(){this.destroyEventEmitter(),this.tickingState&&this.stopTicking()}setTickingMode(a){typeof a==="string"&&(a=lb[a]),this.tickingMode=a}startTicking(){this.tickingState=!0}stopTicking(){this.tickingState=!1}get isRunning(){return this._isRunning}set isRunning(a){if(this._isRunning===a)return;this._isRunning=a,this.tickingMode===lb.lazy&&a!=this.tickingState&&(a?this.startTicking():this.stopTicking())}start(){return this.isRunning=!0,this}pause(){return this.isRunning=!1,this}resume(){return this.isRunning=!0,this}stop(){return this.isRunning=!1,this}complete(a=mi){this.isRunning=!1,this.emit(a,this.parent,this)}}class Oe extends Qe{constructor(a,{updater:b=a,isRunning:c=!1,timeScale:d=1,now:e=0,tickingMode:f=lb.lazy}={}){super(a,arguments[1]);this.updater=null;this.timeScale=1;this.now=0;this.parent=a,this.setUpdater(b),this.isRunning=c,this.timeScale=d,this.now=e,this.setTickingMode(f),this.boot()}resetFromJSON({isRunning:a=!1,timeScale:b=1,now:c=0,tickingMode:d=lb.lazy}={}){return this.isRunning=a,this.timeScale=b,this.now=c,this.setTickingMode(d),this}toJSON(){return{isRunning:this.isRunning,timeScale:this.timeScale,now:this.now,tickingMode:this.tickingMode}}boot(){super.boot(),Wa(this.parent,"destroy",this.destroy,this)}shutdown(){super.shutdown(),this.parent=void 0,this.updater=void 0}destroy(){this.shutdown()}setUpdater(a){return a instanceof ic&&(a=a.world),a instanceof jd||a instanceof Ob?this.updater=a:this.updater=null,this}startTicking(){this.update===null&&this.setUpdater(this.parent);if(this.update===null)return;super.startTicking(),this.updater&&Wa(this.updater,"update",this.update,this)}stopTicking(){super.stopTicking(),this.updater&&qb(this.updater,"update",this.update,this)}start(a=0){return this.now=a,super.start(),this}seek(a){return this.now=a,this}update(a){return!this.isRunning||this.timeScale===0?this:(this.now+=a*this.timeScale,this)}}const tga=Ha(Ff());const cg="receive";const Dk={receive:cg};function Ek(a,b){(!a.sendToRef||a.sendToRef.key!==a.receiverID)&&(a.sendToRef=a.database.ref(a.rootPath).child(a.receiverID));if(b===void 0)return a.sendToRef.remove();let c={message:b,senderID:a.userID,stamp:a.stamp};return a.userName!==void 0&&(c.senderName=a.userName),a.skipFirst=!1,a.stamp=!a.stamp,a.sendToRef.set(c)}function Fk(a){if(a.isReceiving&&a.receiverRef.key===a.receiverID)return;bg(a),a.isReceiving=!0,a.skipFirst=!0,a.receiverRef=a.database.ref(a.rootPath).child(a.receiverID),a.receiverRef.on("value",Hk,a),a.receiverRef.onDisconnect().remove()}function bg(a){if(!a.isReceiving)return;a.isReceiving=!1,a.receiverRef.off("value",Hk,a),a.receiverRef.remove(),a.receiverRef.onDisconnect().cancel()}function Hk(a){if(this.skipFirst){this.skipFirst=!1;return}let b=a.val();if(b==null)return;delete b.stamp,this.history.add(b),this.emit(this.eventNames.receive,b)}class Gk{constructor({maxLength:a=-1}={}){this.maxLength=a,this.records=[]}add(a){return this.maxLength===0?this:(this.records.push(a),this.maxLength>0&&this.records.length>this.maxLength&&this.records.shift(),this)}clear(){return this.records.length=0,this}changeUserName(a,b){return this.maxLength===0?this:(this.records.forEach(c=>{c.senderID===a&&(c.senderName=b)}),this)}}const IZ=Ha(Ma());class xc extends ta{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d,receiverID:e="",history:f=0,eventNames:g=Dk}={}){super();this.setEventEmitter(a),this.eventNames=g,this.database=IZ.database(),this.setRootPath(b),this.skipFirst=!0,this.stamp=!1,this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.isReceiving=!1,f===!0?f=-1:f===!1&&(f=0),this.history=new Gk({maxLength:f})}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.sendToRef=void 0,this.receiverRef=void 0,this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.receiverID=a,this}changeUserName(a,b){return a===this.userID&&(this.userName=b),this.history.changeUserName(a,b),this}getHistory(){return this.history.records}clearHistory(){return this.history.clear(),this}send(a){return Ek(this,a)}startReceiving(){return Fk(this),this}stopReceiving(){return bg(this),this}}const lq="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function le(a,b,c=lq){let d=b===void 0?a:Rc(a,b),e="";for(let f=0;f<d;f++)e+=tc(Array.from(c));return e}const U5=Ha(Ma());var qa;(function(a){a[a["1d"]=1]="1d",a[a["2d"]=2]="2d",a[a["3d"]=3]="3d"})(qa||(qa={}));const jg="init";const kg="update";const dg="addkey0";const eg="addkey1";const fg="addkey2";const lg="removekey0";const mg="removekey1";const ng="removekey2";const gg="changekey0";const hg="changekey1";const ig="changekey2";const Ik={init:jg,update:kg,addkey0:dg,removekey0:lg,changekey0:gg,addkey1:eg,removekey1:mg,changekey1:hg,addkey2:fg,removekey2:ng,changekey2:ig};function vn(a){return a==null||a===""||a.length===0}function kq(a,b,c={}){let d=a;if(!vn(b)){typeof b==="string"&&(b=b.split("."));let e;for(let f=0,g=b.length;f<g;f++){e=b[f];if(d[e]==null||typeof d[e]!=="object"){let j;f===g-1?j=c:j={},d[e]=j}d=d[e]}}return d}function wn(a,b,c){if(typeof a!=="object")return;if(vn(b)){if(c==null)return;typeof c==="object"&&(a=c)}else{typeof b==="string"&&(b=b.split("."));let d=b.pop(),e=kq(a,b);e[d]=c}return a}function un(a){return JSON.parse(JSON.stringify(a))}class Jk{constructor(){this.data={}}setValue(a,b){return a==null?this.clear():typeof a==="object"?this.data=a:wn(this.data,a,b),this}getValue(a){if(a==null)return this.data;{typeof a==="string"&&(a=a.split("."));let b=this.data;for(let c=0,d=a.length;c<d;c++){if(!li(b))return;b=b[a[c]]}return b}}cloneValue(a){return un(this.getValue(a))}removeKey(a){if(a==null)this.clear();else{typeof a==="string"&&(a=a.split("."));let b=a.pop(),c=this.data;for(let d=0,e=a.length;d<e;d++){if(!li(c))return this;c=c[a[d]]}li(c)&&delete c[b]}return this}clear(){return Ve(this.data),this}incValue(a,b=1){let c=this.getValue(a);return typeof c!=="number"&&(c=0),this.setValue(a,c+b),this}mulValue(a,b){let c=this.getValue(a);return typeof c!=="number"&&(c=1),this.setValue(a,c*b),this}}function li(a){return a!=null&&typeof a==="object"}const Z_=Ha(Ma());class _b extends ta{constructor({eventEmitter:a,parent:b,key:c,type:d,eventNames:e,table:f}={}){super();this.setEventEmitter(a),this.parent=b,this.children=new Map(),this.key=c,this.parent?this.fullKeyPath=Tk(this.parent.fullKeyPath,this.key):this.fullKeyPath="",this.type=d,this.eventNames=e,this.table=f,this.database=Z_.database(),this.setRootPath()}destroy(){this.stopUpdate().clear().destroyEventEmitter()}setRootPath(a){if(a===void 0){let b=this.parent?this.parent.rootPath:"";a=`${b}/${this.key}`}this.rootPath=a,this.rootRef=a!==""?this.database.ref(a):void 0;for(const[b,c]of this.children)c instanceof _b&&c.setRootPath();return this}setData(a,b){if(arguments.length===0)this.clear();else if(typeof a=="string")this.setChildData(a,b);else{let c=a;for(const[d,e]of this.children)c.hasOwnProperty(d)||this.removeChild(d);for(let d in c)this.setChildData(d,c[d])}return this}clear(){this.table.removeKey(this.fullKeyPath);for(const[a,b]of this.children)this.removeChild(a);return this}get childClass(){return null}setChildData(a,b){const c=Tk(this.fullKeyPath,a);this.table.setValue(c,b);if(!(typeof b!=="object")){if(this.children.has(a))this.children.get(a).setData(b);else if(this.childClass){let d=new this.childClass({parent:this,key:a,type:this.type,eventEmitter:this.eventEmitter,eventNames:this.eventNames,table:this.table});d.startUpdate(),this.children.set(a,d)}}return this}removeChild(a){return this.children.has(a)&&(this.children.get(a).destroy(),this.children.delete(a)),this}startUpdate(){return this}stopUpdate(){return this}}function Tk(a,b){return a==null||a===""?b:b==null||b===""?a:`${a}.${b}`}class Vc extends _b{startUpdate(){return this.rootRef.on("child_added",this.addCol,this),this.rootRef.on("child_removed",this.removeCol,this),this.rootRef.on("child_changed",this.changeColValue,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addCol,this),this.rootRef.off("child_removed",this.removeCol,this),this.rootRef.off("child_changed",this.changeColValue,this),this}addCol(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case qa["1d"]:this.emit(this.eventNames.addkey0,b,c);break;case qa["2d"]:this.emit(this.eventNames.addkey1,this.key,b,c);break;default:this.emit(this.eventNames.addkey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}removeCol(a){const b=a.key;this.removeChild(b);switch(this.type){case qa["1d"]:this.emit(this.eventNames.removekey0,b);break;case qa["2d"]:this.emit(this.eventNames.removekey1,this.key,b);break;default:this.emit(this.eventNames.removekey2,this.pageKey,this.key,b);break}this.emit(this.eventNames.update,this.table.data)}changeColValue(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case qa["1d"]:this.emit(this.eventNames.changekey0,b,c);break;case qa["2d"]:this.emit(this.eventNames.changekey1,this.key,b,c);break;default:this.emit(this.eventNames.changekey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}get pageKey(){return this.parent.key}}class Wc extends _b{startUpdate(){return this.rootRef.on("child_added",this.addRow,this),this.rootRef.on("child_removed",this.removeRow,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addRow,this),this.rootRef.off("child_removed",this.removeRow,this),this}addRow(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case qa["2d"]:this.emit(this.eventNames.addkey0,b,c);break;default:this.emit(this.eventNames.addkey1,this.key,b,c);break}}removeRow(a){const b=a.key;this.removeChild(b);switch(this.type){case qa["2d"]:this.emit(this.eventNames.removekey0,b);break;default:this.emit(this.eventNames.removekey1,this.key,b);break}}get childClass(){return Vc}}class og extends _b{startUpdate(){return this.rootRef.on("child_added",this.addPage,this),this.rootRef.on("child_removed",this.removePage,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addPage,this),this.rootRef.off("child_removed",this.removePage,this),this}addPage(a){const b=a.key,c=a.val();this.setData(b,c),this.emit(this.eventNames.addkey0,b,c)}removePage(a){const b=a.key;this.removeChild(b),this.emit(this.eventNames.removekey0,b)}get childClass(){return Wc}}const he={};he[qa["1d"]]=Vc;he[qa["2d"]]=Wc;he[qa["3d"]]=og;function Kk(a){return new he[a.tableType]({type:a.tableType,eventEmitter:a.eventEmitter,eventNames:a.eventNames,table:a.table})}function Lk(a){return a.updater.clear(),a.initialFlag=!1,a.rootRef.once("value").then(function(b){let c=b.val()??{};return a.table.setValue(c),a.emit(a.eventNames.init,c),a.initialFlag=!0,Promise.resolve(c)})}function Ga(a,b,c,d){let e=a.rootRef;return e=b?e.child(b):e,e=c?e.child(c):e,e=d?e.child(d):e,e}function Mk(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ga(a,c,d,e).set(f)}function Nk(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;default:c=b[0];break}return Ga(a,c,d,e).remove()}function Ok(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ga(a,c,d,e).transaction(function(g){return g===null&&(g=0),g+f})}function Pk(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ga(a,c,d,e).transaction(f)}function Qk(a,b){return Ga(a).update(b)}function Rk(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;case 1:c=b[0];break}return Ga(a,c,d,e).onDisconnect().remove()}function Sk(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ga(a,c,d,e).onDisconnect().set(f)}const a_=Ha(Ma());class yc extends ta{constructor({eventEmitter:a,root:b="",type:c=qa["3d"],eventNames:d=Ik}={}){super();this.setEventEmitter(a),this.eventNames=d,this.database=a_.database(),this.table=new Jk(),this.setTableType(c),this.setRootPath(b),this.initialFlag=!1}destroy(){this.updater.destroy(),this.destroyEventEmitter().stopUpdate()}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):null,this.updater.setRootPath(a),this}setTableType(a){return typeof a==="string"&&(a=qa[a]),this.tableType=a,this.updater&&this.updater.destroy(),this.updater=Kk(this),this}startUpdate(){return Lk(this),this.updater.startUpdate(),this}stopUpdate(){return this.updater.stopUpdate(),this}clear(){return this.updater.clear(),this}getData(){return this.table.getValue(...arguments)}cloneData(){return this.table.cloneValue(...arguments)}getItemRef(a,b,c){return Ga(this,a,b,c)}setData(...a){return Mk(this,...a)}removeData(...a){return Nk(this,...a)}incValue(...a){return Ok(this,...a)}transaction(...a){return Pk(this,...a)}updateData(a){return Qk(this,a)}removeDataOnDisconnect(...a){return Rk(this,...a)}setDataOnDisconnect(...a){return Sk(this,...a)}}const c5=Ha(Ma());var mh;(function(a){a.d="d",a.w="w",a.m="m",a.y="y",a.day="d",a.week="w",a.month="m",a.year="y"})(mh||(mh={}));var cd;(function(a){a.d="tagD",a.w="tagW",a.m="tagM",a.y="tagY"})(cd||(cd={}));var dd;(function(a){a.d="scoreD",a.w="scoreW",a.m="scoreM",a.y="scoreY"})(dd||(dd={}));var $l;(function(a){a.d="day",a.w="week",a.m="month",a.y="year"})($l||($l={}));function qh({query:a,totalLines:b=Infinity,linesPerPage:c=1e3,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g}){return rm({query:a,remainderLines:b,linesPerPage:c,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g})}function rm(a){let b=a.query;a.startDocRef&&(b=b[a.startMode](a.startDocRef));let c=Math.min(a.remainderLines,a.linesPerPage);return a.remainderLines-=c,b.limit(c).get().then(function(d){let e=a.remainderLines===0||d.size<c,f=!1;a.forEachPageCallback&&(f=a.forEachPageCallback(d)||!1),e=e||f;if(e){let g;return a.resolveCallback&&(g=a.resolveCallback()),Promise.resolve(g)}else return a.startDocRef=d.docs[d.size-1],a.startMode="startAfter",rm(a)})}function La(a,b=Infinity,c=0,d,e){let f=[],g=0;return qh({query:a,totalLines:c+b,startDocRef:d,startMode:e,forEachPageCallback:function(j){let i,k=j.size,n=c-g;n<=0?i=j.docs:n<k&&(i=j.docs.slice(n,k)),i&&f.push(...i),g+=k},resolveCallback:function(){return f}})}const h8=Ha(Ma());function im(a,b,c=0){return La(a.nextQuery,b,c,a.baselineDocRef,a.baselineMode).then(function(d){let e=d.length;return a.cacheItems=d,a.pageIndex=void 0,a.startItemIndex=c,a.endItemIndex=a.startItemIndex+e-1,a.isFullPage=b===void 0?!0:e===b,Promise.resolve(a.cacheItems)})}const H7=Ha(Ma());class ze{constructor({query:a={next:void 0,previous:void 0},itemCount:b=100,baselineDoc:c,baselineMode:d="startAt"}={}){this.setQuery(a),this.setItemCount(b),this.setBaselineDoc(c,d),this.pageIndex=void 0,this.baselineDocRef=void 0,this.baselineMode="startAt",this.startItemIndex=void 0,this.endItemIndex=void 0,this.cacheItems=void 0,this.isFullPage=void 0}setQuery(a,b){if(a instanceof H7.firestore.Query)this.nextQuery=a,this.prevQuery=b;else{var c=a;this.nextQuery=c.next,this.prevQuery=c.previous}return this.pageIndex=null,this.isFullPage=!0,this}setItemCount(a){return this.itemCount=a,this}setBaselineDoc(a,b){return a?(this.baselineDocRef=a.ref,this.baselineMode=b):this.baselineDocRef=void 0,this}load(a,b=0){return im(this,a,b)}loadFirstPage(){return this._loadFirstPage()}loadNextPage(){return this.pageIndex==null?this._loadFirstPage():this._loadNextPage()}loadPreviousPage(){return this.pageIndex==null||this.pageIndex===1?this._loadFirstPage():this._loadPreviousPage()}loadCurrentPage(){return this.pageIndex==null||this.pageIndex===0?this._loadFirstPage():this._loadCurrentPage()}}function om(a){return La(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=null,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function jm(a){return La(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,Promise.resolve(a.cacheItems)})}function pm(a){return La(a.nextQuery,a.itemCount,0,a.currPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=a.currPageEndDocRef,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function km(a){let b=(a.pageIndex+1)*a.itemCount;return La(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function qm(a){return La(a.prevQuery,a.itemCount+1,0,a.currPageStartDocRef,"startAfter").then(function(b){let c=b.length-1;return a.cacheItems=b,a.cacheItems.pop(),a.cacheItems.reverse(),a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-c+1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=b[c].ref,a.currPageStartDocRef=b[c-1].ref,a.currPageEndDocRef=b[0].ref,Promise.resolve(a.cacheItems)})}function lm(a){let b=(a.pageIndex-1)*a.itemCount;return La(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-d+1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function nm(a){return La(a.nextQuery,a.itemCount,0,a.prevPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function mm(a){let b=a.pageIndex*a.itemCount;return La(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}class nh extends ze{_loadFirstPage(){return jm(this)}_loadNextPage(){return km(this)}_loadPreviousPage(){return lm(this)}_loadCurrentPage(){return mm(this)}}const H6=Ha(Ma());class ye extends ze{_loadFirstPage(){return om(this)}_loadNextPage(){return pm(this)}_loadPreviousPage(){return qm(this)}_loadCurrentPage(){return nm(this)}}const A7=Ha(Ma());function bm(a,b){let c={senderID:a.userID,message:b,timestamp:A7.firestore.FieldValue.serverTimestamp()};return a.userName!==void 0&&(c.senderName=a.userName),a.receiverID!==void 0&&(c.receiverID=a.receiverID),a.rootRef.add(c)}function oh(a,b=a.receiverID){let c=a.rootRef;return c=b!==void 0?c.where("receiverID","==",b):c,c}function am(a,b=a.receiverID){let c=oh(a,b),d=c.orderBy("timestamp"),e=c.orderBy("timestamp","desc");return{next:d,previous:e}}const ph="receive";function cm(a){let b=oh(a).orderBy("timestamp","desc").limit(1);a.unsubscribe=b.onSnapshot({includeMetadataChanges:!0},function(c){if(c.size>0){let d=c.docs[0];if(d.metadata.hasPendingWrites){a.skipFirst&&(a.skipFirst=!1);return}gm(a,a.receiverID,d);if(a.skipFirst)a.skipFirst=!1;else{let e=hm(d);a.cacheMessages.push(e),a.emit(ph,e)}}else a.skipFirst&&(a.skipFirst=!1)},function(c){debugger})}function dm(a){a.unsubscribe&&a.unsubscribe(),a.resetQueryFlag=!0,a.cacheMessages.length=0}function em(a){return gm(a),a.page.loadNextPage().then(function(b){let c=[];for(let d=0,e=b.length;d<e;d++)c.push(hm(b[d]));return a.cacheMessages.splice(0,0,...c),Promise.resolve(c)})}function gm(a,b=a.receiverID,c){if(!a.resetQueryFlag)return;a.resetQueryFlag=!1;let d=a.skipFirst?"startAt":"startAfter";a.page.setBaselineDoc(c,d).setQuery(am(a,b));return}function hm(a){let b=a.data();return b.timestamp=b.timestamp.toDate(),b}const r7=Ha(Ma());class fm extends ta{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d="",receiverID:e,pageItemCount:f=100}={}){super();this.setEventEmitter(a),this.database=r7.firestore(),this.setRootPath(b),this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.skipFirst=!0,this.unsubscribe=void 0,this.page=new ye(),this.setPageItemCount(f),this.resetQueryFlag=!0,this.cacheMessages=[]}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.resetQueryFlag=this.resetQueryFlag||this.rootPath!==a,this.rootPath=a,this.rootRef=this.database.collection(a),this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.resetQueryFlag=this.resetQueryFlag||this.receiverID!==a,this.receiverID=a,this}setPageItemCount(a){return this.page.setItemCount(a),this}get hasPreviousMessage(){return this.page.isFullPage!==!1}send(a){return bm(this,a)}startReceiving(){return cm(this),this}stopReceiving(){return dm(this),this}loadPreviousMessages(){return em(this)}}const sg="join";const tg="leave";const vg="init";const ug="update";const rg="changename";const qg="change";const Yk={join:sg,leave:tg,update:ug,change:qg,init:vg,changename:rg};var vb;(function(a){a[a.once=0]="once",a[a.child=1]="child",a[a.all=2]="all"})(vb||(vb={}));const dh="add";const fh="remove";const eh="change";const gh="update";const Ql={add:dh,remove:fh,update:gh,change:eh};function we(a){a.items.length=0,a.itemID2Index.clear()}function Rl(a){return a.items}function Sl(a,b){return a.itemID2Index.has(b)}function ch(a,b){return b==null?null:a.itemID2Index.get(b)}function Tl(a,b){if(b==null)return null;let c=ch(a,b);return c==null?null:a.items[c]}function Ul(a,b,c){a.items.forEach(b,c)}function Gb(a){a.itemID2Index.clear();let b=a.items;for(var c=0,d=b.length;c<d;c++){let e=b[c][a.keyItemID];a.itemID2Index.set(e,c)}}function Vl(a,b){if(b>=a.length)return;let c=a.length-1,d=a[b];for(let e=b;e<c;e++)a[e]=a[e+1];return a.length=c,d}function hh(a,b){let c=jh.call(this,a,b);Gb(this),this.emit(this.eventNames.add,c),this.emit(this.eventNames.update,this.items)}function ad(a,b){let c=Wl.call(this,a);Gb(this);let d=jh.call(this,a,b);Gb(this),this.emit(this.eventNames.change,d,c),this.emit(this.eventNames.update,this.items)}function ih(a){let b=Wl.call(this,a);Gb(this),this.emit(this.eventNames.remove,b),this.emit(this.eventNames.update,this.items)}function bd(a){we(this),a.forEach(function(b){jh.call(this,b,null,!0)}.bind(this)),Gb(this),this.emit(this.eventNames.update,this.items)}function jh(a,b,c=!1){let d,e=this.getItemCallback,f=this.getItemCallbackScope;f?d=e.call(f,a):d=e(a);if(c)return this.items.push(d),d;if(b==null)this.items.unshift(d);else{let g=this.itemID2Index.get(b);g===this.items.length-1?this.items.push(d):this.items.splice(g+1,0,d)}return d}function Wl(a){let b=this.itemID2Index.get(a.key),c=Vl(this.items,b);return c}const Zl={start(a,b){a.isUpdating=!1,b.once("value",bd,a)},stop(a){}};const Yl={start(a,b){b.on("child_added",hh,a),b.on("child_removed",ih,a),b.on("child_moved",ad,a),b.on("child_changed",ad,a)},stop(a){a.query.off("child_added",hh,a),a.query.off("child_removed",ih,a),a.query.off("child_moved",ad,a),a.query.off("child_changed",ad,a)}};const Xl={start(a,b){b.on("value",bd,a)},stop(a){a.query.off("value",bd,a)}};const $c={};$c[vb.all]=Xl;$c[vb.child]=Yl;$c[vb.once]=Zl;class $b extends ta{constructor({eventEmitter:a,itemIDKey:b="__itemID__",mode:c=vb.child,getItemCallback:d=jp,getItemCallbackScope:e,query:f,eventNames:g=Ql}={}){super();this.setEventEmitter(a),this.eventNames=g,this.isUpdating=!1,this.items=[],this.itemID2Index=new Map(),this.setItemIDKey(b),this.setMode(c),e===void 0&&(e=this),this.setGetitemCallback(d,e),this.setQuery(f)}destroy(){this.stopUpdate().clear()}setItemIDKey(a){return this.keyItemID=a,this}setMode(a){return typeof a==="string"&&(a=vb[a]),this.mode=a,this.updater=$c[a],this}setGetitemCallback(a,b){return this.getItemCallback=a,this.getItemCallbackScope=b,this}setQuery(a){return this.query=a,this}startUpdate(a){if(a)this.setQuery(a);else if(this.query)a=this.query;else return this;return this.stopUpdate().clear(),this.isUpdating=!0,this.updater.start(this,a),this}stopUpdate(){return!this.query||!this.isUpdating?this:(this.isUpdating=!1,this.updater.stop(this),this)}clear(){return we(this),this}getItems(){return Rl(this)}hasItem(a){return Sl(this,a)}getItemIndexFromItemID(a){return ch(this,a)}getItemFromItemID(a){return Tl(this,a)}forEach(a,b){return Ul(this,a,b),this}updateItemID2Index(){return Gb(this),this}}const jp=function(a){let b=a.val();return b[this.keyItemID]=a.key,b};function Cb(a,b=a.userID){return a.userID2ItemID.has(b)}function ie(a,b=a.userID){if(!Cb(a,b))return null;let c=a.userID2ItemID.get(b);return a.rootRef.child(c)}function Zk(a,b=a.userID){if(!Cb(a,b))return null;let c=a.userID2ItemID.get(b);return a.userList.getItemFromItemID(c)}function pg(a){return a.userList.getItems()}function _k(a){a.userList.clear()}function $k(a,b,c){a.userList.forEach(b,c)}function al(a,b=a.userID){let c=a.userList.getItems()[0];return c&&c.userID===b}function bl(a){return a.maxUsers===0?!1:a.userList.getItems().length>=a.maxUsers}function Vk(a=0,b){return new Promise(function(c,d){setTimeout(function(){c(b)},a)})}function Wk(a,b=a.userID,c=a.userName){if(Cb(a,b))return Promise.resolve();let d={userID:b,userName:c},e=a.maxUsers,f=a.database.ref(a.rootPath),g=f.push();return g.onDisconnect().remove().then(function(){return g.set(d)}).then(function(){return Vk(0)}).then(function(){return e===0?(a.isInList=!0,Promise.resolve()):f.limitToFirst(e).once("value").then(function(j){return Zo(j,b)?(a.isInList=!0,Promise.resolve()):(a.isInList=!1,g.remove().then(function(){return g.onDisconnect().cancel()}).then(function(){return Promise.reject()}))})})}function Zo(a,b){let c=!1;return a.forEach(function(d){let e=d.val();if(e.userID===b)return c=!0,!0}),c}function Xk(a,b=a.userID){if(!Cb(a,b))return Promise.resolve();let c=a.userID2ItemID.get(b),d=a.database.ref(a.rootPath).child(c);return d.remove()}function Uk(a,b){return new Promise(function(c,d){let e=ie(a);if(e)return c(e);{let f=a.rootRef.orderByChild("userID").equalTo(a.userID);f.once("child_added").then(function(g){return c(g.ref)})}}).then(function(c){return c.child("userName").set(b)}).then(function(){return a.userName=b,Promise.resolve()})}const J$=Ha(Ma());class zc extends ta{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,eventNames:f=Yk}={}){super();this.setEventEmitter(a),this.eventNames=f,this.database=J$.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.setMaxUsers(e),this.userList=new $b({eventEmitter:this.eventEmitter,itemIDKey:"joinAt",eventNames:{add:f.join,remove:f.leave,update:f.update,change:f.change}}),this.isInList=!1,this.userID2ItemID=new Map(),this.userList.on(this.eventNames.join,function(g){this.userID2ItemID.set(g.userID,g.joinAt),g.userID===this.userInfo.userID&&this.emit(this.eventNames.init,pg(this))},this).on(this.eventNames.leave,function(g){this.userID2ItemID.delete(g.userID),g.userID===this.userID&&(this.isInList=!1)},this).on(this.eventNames.change,function(g,j){let i=g.userID,k=g.userName,n=j.userName;k!==n&&this.emit(this.eventNames.changename,i,k,n)},this)}destroy(){this.stopUpdate().destroyEventEmitter().leave(),this.userList.destroy()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setMaxUsers(a){return this.maxUsers=a,this}clear(){return _k(this),this}forEach(a,b){return $k(this,a,b),this}isFull(){return bl(this)}isFirstUser(a=this.userID){return al(this,a)}getUser(a=this.userID){return Zk(this,a)}getUsers(){return pg(this)}getUserRef(a=this.userID){return ie(this,a)}contains(a=this.userID){return Cb(this,a)}join(a=this.userID,b=this.userName){return Wk(this,a,b)}leave(a=this.userID){return Xk(this,a)}changeUserName(a){return Uk(this,a)}startUpdate(){let a=this.rootRef;return this.maxUsers>0&&(a=a.limitToFirst(this.maxUsers)),this.userList.startUpdate(a),this}stopUpdate(){return this.userList.stopUpdate(),this}}const ac="room.join";const Eb="room.leave";const Lg="userlist.join";const Mg="userlist.leave";const Og="userlist.init";const Ng="userlist.update";const Yc="userlist.changename";const wg="broadcast.receive";function Ag(a){return`tables.${a}.init`}function Bg(a){return`tables.${a}.update`}function Cg(a){return`tables.${a}.addkey0`}function Dg(a){return`tables.${a}.addkey1`}function Eg(a){return`tables.${a}.addkey2`}function Fg(a){return`tables.${a}.removekey0`}function Gg(a){return`tables.${a}.removekey1`}function Hg(a){return`tables.${a}.removekey2`}function Ig(a){return`tables.${a}.changekey0`}function Jg(a){return`tables.${a}.changekey1`}function Kg(a){return`tables.${a}.changekey2`}const xg="roomlist.add";const yg="roomlist.remove";const zg="roomlist.update";function ol(a){const b=new zc({eventEmitter:a.eventEmitter,eventNames:{join:Lg,leave:Mg,update:Ng,change:"userlist.change",init:Og,changename:Yc},userID:a.userInfo});return b.on("userlist.leave",function(c){c.userID===a.userID&&cp(a)}),a.on(ac,function(){b.startUpdate()}).on(Eb,function(){b.stopUpdate().clear()}),b}function cp(a){a.emit(Eb),setTimeout(function(){a.roomID=void 0,a.roomName=void 0,a.doorState=void 0,a.leftRoomFlag=!1},0)}function ll(a){const b=new $b({eventEmitter:a.eventEmitter,itemIDKey:"roomID",eventNames:{update:zg,add:xg,remove:yg,change:"roomlist.change"},mode:"once"});return b}function vl(a){return a.split("|")[0]}function ul(a){return a.split("|")[1]}function Ac(a,b=""){return`${a}|${b}`}function hb(a,b){let c=a.rootRef;return b&&(c=c.child(b)),c}function Zc(a,b,c){let d=hb(a,"rooms");return b!==void 0&&(d=d.child(b),c!==void 0&&(d=d.child(c))),d}function kl(a,b){return Zc(a,b,"alive")}function pl(a,b){return Zc(a,b,"users")}function Xc(a,b){let c=hb(a,"room-filters");return b!==void 0&&(c=c.child(b)),c}function Bc(a,b){let c=hb(a,"room-metadata");return b!==void 0&&(c=c.child(b)),c}function ke(a,b,c){let d=`${a.rootPath}/rooms/${b}`;return c&&(d+=`/${c}`),d}function ne(a,b){return ke(a,b,"users")}function ml(a,b,c){let d=ke(a,b,"tables");return c&&(d+=`/${c}`),d}function ql(a,b,c="open"){let d=Xc(a);return d=d.orderByChild("filter"),b===void 0?d=d.startAt(c).endAt(`${c}~`):d=d.equalTo(Ac(c,b)),d}function hl(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new xc({eventEmitter:a.eventEmitter,eventNames:{receive:wg},receiverID:"boradcast",senderID:a.userInfo,history:b.history});return a.on(ac,function(d){c.setRootPath(ke(a,d.roomID)).startReceiving()}).on(Eb,function(){c.stopReceiving()}).on(Yc,function(d,e){c.changeUserName(d,e)}),c}function nl(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,bp(a,d))}),a.on(ac,function(d){for(const[e,f]of c)f.setRootPath(ml(a,d.roomID,e)).startUpdate()}).on(Eb,function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function bp(a,{key:b,type:c=qa["1d"]}){const d=new yc({eventEmitter:a.eventEmitter,type:c,eventNames:{init:Ag(b),update:Bg(b),addkey0:Cg(b),removekey0:Fg(b),changekey0:Ig(b),addkey1:Dg(b),removekey1:Gg(b),changekey1:Jg(b),addkey2:Eg(b),removekey2:Hg(b),changekey2:Kg(b)}});return d}function Ra(a,b=a.roomID,c=a.roomName){return{roomID:b,roomName:c}}function re(a,b){return b===void 0?a.roomID!==void 0:a.roomID===b}function yl(a){return a.userList.isFull()}function zl(a,b=a.userID){return a.userList.isFirstUser(b)}function Al(a){return a.userList.getUsers()}function oe(a,b,c,d){a.roomID=b,a.roomName=c,a.roomType=d,a.emit("room.join",Ra(a))}function me(a,b={}){return b.roomID==null&&(b.roomID=Zc(a).push().key),$o(a,b.roomID).then(function(){return ap(a,b)})}function $o(a,b){return kl(a,b).transaction(function(c){return c===null?!0:void 0})}function ap(a,{roomID:b,roomName:c="",roomType:d="",maxUsers:e=0,presisted:f=!1,door:g="open",join:j=!0,filterData:i}){let k=Zc(a,b),n=Xc(a,b),s=Bc(a,b);a.isRemoveRoomWhenLeft=!f,a.isRemoveRoomWhenLeft&&(k.onDisconnect().remove(),n.onDisconnect().remove(),s.onDisconnect().remove());const w=Ac(g,d),y={},B={filter:w,name:c};i&&(B.data=i),y[`room-filters/${b}`]=B;const G={name:c,filter:w,maxUsers:e,moderators:{}};return G.moderators[a.userID]=a.userName,y[`room-metadata/${b}`]=G,new Promise(function(H,R){if(j){const L=a.userList.setRootPath(ne(a,b)).setMaxUsers(0).join();return a.userList.setMaxUsers(e),L.then(H,R)}else return H()}).then(function(){return hb(a).update(y)}).then(function(){return a.isRoomCreator=!0,j&&oe(a,b,c,d),Promise.resolve(Ra(a))})}function il(a,{digits:b=10,candidates:c="0123456789",retry:d=1e3}){let e=arguments[1];return jl(a,b,c,d,e)}function jl(a,b,c,d,e){return e.roomID=le(b,b,c),d<=0?Promise.reject(e):(d--,me(a,e).catch(function(){return jl(a,b,c,d,e)}))}function se(a,b=a.roomID){const c={};c[`room-filter/${b}`]=null,c[`room-metadata/${b}`]=null,c[`rooms/${b}`]=null;const d=Ra(a);return hb(a).update(c).then(function(){return Promise.resolve(d)})}function Cc(a){if(!re(a))return Promise.resolve(Ra(a));a.leftRoomFlag=!0;if(a.isRemoveRoomWhenLeft)return se(a);{const b=Ra(a);return a.userList.leave().then(function(){return Promise.resolve(b)})}}function qe(a,{leftThenJoin:b=!0,roomID:c}){return b?Cc(a).then(function(){return wl(a,c)}):wl(a,c)}function wl(a,b){return b==null?Promise.reject(Ra(a,b,"")):(a.isRemoveRoomWhenLeft=!1,dp(a,b).then(function(c){return a.userList.setRootPath(ne(a,b)).setMaxUsers(c.maxUsers).join().then(function(){return Promise.resolve(c)})}).then(function(c){return oe(a,b,c.name,ul(c.filter)),Promise.resolve(Ra(a))}))}function dp(a,b){return Bc(a,b).once("value").then(function(c){let d=c.val();return ep(a,d)?Promise.resolve(d):Promise.reject()})}function ep(a,b){if(b==null)return!1;if(vl(b.filter)==="closed")return!1;const c=a.userID;if(b.moderators[c])return!0;switch(b.permission){case"blocklist":const d=b.blocklist;return!(d&&d[c]);case"allowlist":const e=b.allowlist;return e&&e[c];default:return!0}}function pe(a,b,c){return new Promise(function(d,e){a.roomList.once("roomlist.update",function(f){d(f)}).startUpdate(ql(a,b,c))})}function sl(a,{roomType:b="",leftThenJoin:c=!0}={}){return pe(a,b,"open").then(function(d){if(d.length===0)return Promise.reject("No filtered room");Zb(d);const e={leftThenJoin:c,roomID:""};return tl(a,e,d)})}function tl(a,b,c,d=0){return d===c.length?Promise.reject("Can't join any room"):(b.roomID=c[d].roomID,d++,qe(a,b).catch(function(){return tl(a,b,c,d)}))}function xl(a,b){return a.userList.contains(b)?b===a.userID?Cc(a):a.userList.leave(b):Promise.resolve()}function Db(a,b){return b===a.roomID?Promise.resolve(!0):Bc(a,b).once("value").then(function(c){const d=c.val()!==null;return Promise.resolve(d)})}function je(a,b,c=a.roomID){return Db(a,c).then(function(d){if(!d)return Promise.resolve();const e=Ac(b,a.roomType),f={};return f[`room-filters/${c}/filter`]=e,f[`room-metadata/${c}/filter`]=e,hb(a).update(f)})}function el(a,b=a.roomID){return je(a,"open",b)}function fl(a,b=a.roomID){return je(a,"closed",b)}function cl(a,b,c=a.roomID){return Db(a,c).then(function(d){return d?Xc(a,c).child("data").update(b):Promise.resolve()})}function gl(a,b){return a.userList.changeUserName(b)}function dl(a,b,c=a.roomID){return Db(a,c).then(function(d){if(!d)return Promise.resolve();const e={};return e[`room-filters/${c}/name`]=b,e[`room-metadata/${c}/name`]=b,hb(a).update(e)})}function rl(a,b=a.roomID){return b===a.roomID?a.userList.getUsers():new Promise(function(c,d){const e=new $b({itemIDKey:"joinAt",mode:"once"});e.once("update",function(f){c(f)}).startUpdate(pl(a,b))})}const u1=Ha(Ma());class Bl extends ta{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",broadcast:e=!0,tables:f=!1}={}){super();this.setEventEmitter(a),this.database=u1.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.isRoomCreator=!1,this.roomID=void 0,this.roomName=void 0,this.roomType=void 0,this.doorState=void 0,this.leftRoomFlag=!1,this.isRemoveRoomWhenLeft=void 0,this.userList=ol(this),this.roomList=ll(this),this.broadcast=hl(this,e),this.tables=nl(this,f)}destroy(){var a=this;this.destroyEventEmitter().leaveRoom().then(function(){a.userList.destroy(),a.userList=void 0,a.roomList.destroy(),a.roomList=void 0,a.broadcast.destroy(),a.broadcast=void 0})}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}getRoomInfo(a,b){return Ra(this,a,b)}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(a){return re(this,a)}isFull(){return yl(this)}isFirstUser(a=this.userID){return zl(this,a)}getUsers(){return Al(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}createRoom(a){return me(this,a)}createRandomRoom(a={}){return il(this,a)}joinRoom(a){return qe(this,a)}joinRandomRoom(a={}){return sl(this,a)}leaveRoom(){return Cc(this)}removeRoom(a=this.roomID){return se(this,a)}kickUser(a){return xl(this,a)}changeRoomState(a,b=this.roomID){return je(this,a,b)}openRoom(a=this.roomID){return el(this,a)}closeRoom(a=this.roomID){return fl(this,a)}changeUserName(a){return gl(this,a)}changeFilterData(a,b=this.roomID){return cl(this,a,b)}changeRoomName(a,b,c=a.roomID){return dl(this,b,c)}getUserList(a=this.roomID){return rl(this,a)}getRoomList(a,b){return pe(this,a,b)}HasRoom(a){return Db(this,a)}}function Il(a,b){let c=a.rootPath;return b&&(c+=`/${b}`),c}function Gl(a){return Il(a,"users")}function El(a,b){return`${Il(a,"tables")}/${b}`}const ub="room.join";const Fb="room.leave";const $g="userlist.join";const te="userlist.leave";const bh="userlist.init";const ah="userlist.update";const _c="userlist.changename";const Pg="broadcast.receive";function Qg(a){return`tables.${a}.init`}function Rg(a){return`tables.${a}.update`}function Sg(a){return`tables.${a}.addkey0`}function Tg(a){return`tables.${a}.addkey1`}function Ug(a){return`tables.${a}.addkey2`}function Vg(a){return`tables.${a}.removekey0`}function Wg(a){return`tables.${a}.removekey1`}function Xg(a){return`tables.${a}.removekey2`}function Yg(a){return`tables.${a}.changekey0`}function Zg(a){return`tables.${a}.changekey1`}function _g(a){return`tables.${a}.changekey2`}function Hl(a,b=0){const c=new zc({eventEmitter:a.eventEmitter,eventNames:{join:$g,leave:te,update:ah,change:"userlist.change",init:bh,changename:_c},root:Gl(a),userID:a.userInfo,maxUsers:b});return c.on(te,function(d){d.userID===a.userID&&hp(a)}),a.on(ub,function(){c.startUpdate()}).on(Fb,function(){c.stopUpdate().clear()}),c}function hp(a){a.emit(Fb),setTimeout(function(){a.leftRoomFlag=!1},0)}function Dl(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new xc({eventEmitter:a.eventEmitter,eventNames:{receive:Pg},receiverID:"broadcast",senderID:a.userInfo,history:b.history});return a.on(ub,function(){c.setRootPath(a.rootPath).startReceiving()}).on(Fb,function(){c.stopReceiving()}).on(_c,function(d,e){c.changeUserName(d,e)}),c}function Fl(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,gp(a,d))}),a.on(ub,function(){for(const[d,e]of c)e.setRootPath(El(a,d)).startUpdate()}).on(Fb,function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function gp(a,{key:b,type:c=qa["1d"]}){const d=new yc({eventEmitter:a.eventEmitter,type:c,eventNames:{init:Qg(b),update:Rg(b),addkey0:Sg(b),removekey0:Vg(b),changekey0:Yg(b),addkey1:Tg(b),removekey1:Wg(b),changekey1:Zg(b),addkey2:Ug(b),removekey2:Xg(b),changekey2:_g(b)}});return d}function ve(a){return a.userList.isInList}function Ml(a){return a.userList.isFull()}function Nl(a,b=a.userID){return a.userList.isFirstUser(b)}function Ol(a){return a.userList.getUsers()}function Kl(a){return a.userList.join().then(function(){return a.emit(ub),Promise.resolve()})}function ue(a){return ve(a)?(a.leftRoomFlag=!0,a.userList.leave()):Promise.resolve()}function Jl(a){return a.userList.getUsers()}function Ll(a,b){return a.userList.contains(b)?b===a.userID?ue(a):a.userList.leave(b):Promise.resolve()}function Cl(a,b){return a.userList.changeUserName(b)}const g3=Ha(Ma());class Pl extends ta{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,broadcast:f=!0,tables:g=!1}={}){const j=arguments[0];super();this.setEventEmitter(a),this.database=g3.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.leftRoomFlag=!1,this.userList=Hl(this,e),this.broadcast=Dl(this,f),this.tables=Fl(this,g)}shutdown(){}destroy(){this.shutdown()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(){return ve(this)}isFull(){return Ml(this)}isFirstUser(a=this.userID){return Nl(this,a)}getUsers(){return Ol(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}joinRoom(){return Kl(this)}leaveRoom(){return ue(this)}getUserList(){return Jl(this)}kickUser(a){return Ll(this,a)}changeUserName(a){return Cl(this,a)}}const Uh="statechange";function Vh(a){return`exit_${a}`}function Wh(a){return`enter_${a}`}class Th extends ta{constructor({eventEmitter:a}={}){super();this.enable=!0;this.setEventEmitter(a)}destroy(){this.destroyEventEmitter()}toJSON(){return{curState:this.state,prevState:this.prevState,enable:this.enable,start:this._start}}setEnable(a=!0){return this.enable=a,this}set state(a){if(!this.enable||this._stateLock)return;if(this._state===a)return;this._prevState=this._state,this._state=a,this._stateLock=!0,this.emit(Uh,this);if(this._prevState!=null){let b=Vh(this._prevState),c=this[b];c&&c.call(this),this.emit(b,this)}this._stateLock=!1;if(this._state!=null){let b=Wh(this._state),c=this[b];c&&c.call(this),this.emit(b,this)}}get state(){return this._state}get prevState(){return this._prevState}start(a){return this._start=a,this._prevState=void 0,this._state=a,this}goto(a){return a!=null&&(this.state=a),this}next(){let a,b=this["next_"+this.state];return b?(typeof b==="string"?a=b:a=b.call(this),this.goto(a),this):this}update(a,b,c="update"){let d=this[`${c}_${this.state}`];d&&d.call(this,a,b)}preupdate(a,b){this.update(a,b,"preupdate")}postupdate(a,b){this.update(a,b,"postupdate")}addState(a,{next:b,exit:c,enter:d}){return b&&(this[`next_${a}`]=b),c&&(this[`exit_${a}`]=c),d&&(this[`enter_${a}`]=d),this}addStates(a){for(const b in a)this.addState(b,a[b]);return this}}var $h;(function(a){a[a.shuffle=0]="shuffle",a[a.random=1]="random"})($h||($h={}));const di="die";class an extends Oe{constructor(a,{lifeTime:b=1e3,destroy:c=!0}={}){super(a,arguments[1]);this.setLifeTime(b),this.setDestroyMode(c)}resetFromJSON({lifeTime:a=1e3,destroy:b=!0}={}){return super.resetFromJSON(arguments[0]),this.setLifeTime(a),this.setDestroyMode(b),this}toJSON(){const a=super.toJSON();return a.lifeTime=this.lifeTime,a.destroy=this.destroyMode,a}setLifeTime(a){return this.lifeTime=a,this}addToLifeTime(a){return this.lifeTime+=a,this}setDestroyMode(a=!0){return this.destroyMode=a,this}get isAlive(){return this.now<this.lifeTime}get remainder(){let a=this.lifeTime-this.now;return a<0&&(a=0),a}update(a){return this.isRunning?(super.update(a),this.isAlive||(this.complete(di),this.destroyMode&&this.gameObject.destroy&&this.gameObject.destroy()),this):this}get gameObject(){return this.parent}}class Pe{constructor(a,b,c,d,e){this.key=a,this.start=b,this.end=c,this.step=d,this.items=e,this._current=b}reset(){this._current=this.start}get isEnd(){return this.step>=0?this._current>=this.end:this._current<=this.end}get length(){return this.step>=0&&this.start>this.end||this.step<0&&this.start<this.end?0:Math.floor(this.end-this.start)+1}next(){return this.isEnd?this._current=this.start:this._current+=this.step,this}get current(){return this.items?this.items[this._current]:this._current}}class cn{constructor(){this.indexes=[];this.length=0;this.firstPass=!0;this.currentCount=0}reset(){for(let a=0,b=this.indexes.length;a<b;a++)this.indexes[a].reset();return this.firstPass=!0,this.currentCount=0,this}addNumberLoop(a,b,c,d=c>=b?1:-1){return this.indexes.push(new Pe(a,b,c,d)),this.length=this._getLength(),this}addItemsLoop(a,b,c=!1){const d=b.length-1,e=c?d:0,f=c?0:d,g=c?-1:1;return this.indexes.push(new Pe(a,e,f,g,b)),this.length=this._getLength(),this}addLoop({key:a,start:b,end:c,step:d,items:e}){return this.indexes.push(new Pe(a,b,c,d,e)),this.length=this._getLength(),this}removeLoops(){return this.indexes.length=0,this.length=0,this}_getLength(){let a=this.indexes[0]?.length;for(let b=1,c=this.indexes.length;b<c;b++)a*=this.indexes[b].length;return a??0}get progress(){return this.currentCount/this.length}get isEnd(){for(let a=this.indexes.length-1;a>=0;a--)if(!this.indexes[a].isEnd)return!1;return!0}next(){for(let a=this.indexes.length-1;a>=0;a--){const b=this.indexes[a],c=b.isEnd;b.next();if(!c)break}return this}getCurrent(a={}){for(let b=this.indexes.length-1;b>=0;b--){const c=this.indexes[b];a[c.key]=c.current}return a}getNext(a={}){return this.firstPass?this.firstPass=!1:this.next(),this.getCurrent(a),this.currentCount++,a}}const Xh="tickstart";const Yh="tickend";const cq=1e3/60;class bn extends Qe{constructor(a,{callback:b,scope:c,deltaPercentage:d=1}={}){super(a,arguments[1]);this.deltaPercentage=1;this.loopIndexGenerator=new cn();this.currentIndexes={};this.scene=a,this.setCallback(b,c),this.setDeltaPercentage(d),this.boot()}boot(){super.boot(),Nb(this.scene,"shutdown",this.destroy,this)}shutdown(){super.shutdown(),this.scene=void 0}destroy(){this.shutdown()}startTicking(){super.startTicking(),Wa(this.scene,"update",this.preupdate,this)}stopTicking(){super.stopTicking(),this.scene&&qb(this.scene,"update",this.preupdate,this)}setCallback(a,b){return this.callback=a,this.scope=b,this}setDeltaPercentage(a){return this.deltaPercentage=a,this}addNumberLoop(a,b,c,d){return this.loopIndexGenerator.addNumberLoop(a,b,c,d),this}addItemsLoop(a,b,c=!1){return this.loopIndexGenerator.addItemsLoop(a,b,c),this}addLoop(a){return this.loopIndexGenerator.addLoop(a),this}get curTime(){return new Date().getTime()}get progress(){return this.loopIndexGenerator.progress}preupdate(){if(!this.callback)return;const a=this.curTime,b=cq*this.deltaPercentage;let c;this.emit(Xh);do{if(this.loopIndexGenerator.isEnd){this.complete();return}this.currentIndexes=this.loopIndexGenerator.getNext(this.currentIndexes),this.scope?this.callback.call(this.scope,this.currentIndexes,this):this.callback(this.currentIndexes,this),c=this.curTime-a>=b}while(!c);this.emit(Yh)}}const rga=Ha(zn());var ai;(function(a){a[a.none=0]="none",a[a.base64=1]="base64",a[a.utf16=2]="utf16",a[a.uri=3]="uri"})(ai||(ai={}));var Ib;(function(a){a[a.circle=0]="circle",a[a.ellipse=1]="ellipse",a[a.roundRectangle=2]="roundRectangle"})(Ib||(Ib={}));class nb extends ed{constructor(a,b,c,d,e=Ib.circle){super(a,b);this.type="rexMaskedImage",this.maskImage(c,d,e)}maskImage(a,b,c=Ib.circle){let d,e,f;typeof c==="object"?{maskType:d,backgroundStyle:e,radius:f}=c:d=c,typeof d==="string"&&(d=Ib[d]);const g=this.canvas,j=this.context,i=Ea.get();if(!i.has(a))return;const k=i.get(a).getFrame(b),n=k.width,s=k.height;g.width!==n&&(g.width=n),g.height!==s&&(g.height=s),j.clearRect(0,0,n,s),e&&(j.fillStyle=e,j.fillRect(0,0,n,s)),j.beginPath();switch(d){case Ib.roundRectangle:De(j,0,0,n,s,f);break;default:const w=Math.floor(n/2),y=Math.floor(s/2);d===Ib.circle?j.arc(w,y,Math.min(w,y),0,2*Math.PI):j.ellipse(w,y,w,y,0,0,2*Math.PI);break}j.clip(),j.drawImage(k.texture.image,k.x,k.y,k.width,k.height),this.texture.setSize(n,s),this.setSize(n,s),this.updateTexture()}}let mq=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i;function wc(a){let b;return a===""?b=null:mq.test(a)?b=parseFloat(a):a==="false"?b=!1:a==="true"?b=!0:b=a,b}const eca=Ha(Ff());function dn(a,{delimiter:b=",",convert:c=!0,types:d={}}={}){const e=eca.default.parse(a,{header:!0,delimiter:b}).data,f=d.question??"q",g=d.option??"",j=c===!0?wc:c,i=[];let k,n;for(let s=0,w=e.length;s<w;s++){let y=e[s],B=y.type;delete y.type,B===f?(k=y,k.key===""&&delete k.key,fn(k,j),k.options=[],i.push(k)):B===g&&(k&&(n=y,n.key===""&&delete n.key,fn(n,j),k.options.push(n)))}return i}function fn(a,b){const c=a;if(!b)return c;for(const d in a)c[d]=b(a[d],d);return c}function _h(a,b,c){typeof b==="string"&&(b=dn(b,c));if(Array.isArray(b))for(let d=0,e=b.length;d<e;d++)en(a,b[d]);else en(a,b)}function en(a,b){const c=b.options;if(c)for(let d=0,e=c.length;d<e;d++){let f=c[d];f.hasOwnProperty("key")||(f.key=`_${d}`)}b.hasOwnProperty("key")||(b.key=`_${a.questions.size}`),a.questions.set(b.key,b)}class Zh{constructor({questions:a}={}){this.questions=new Map();a&&_h(this,a,arguments[0])}add(a,b){return _h(this,a,b),this}remove(a){return this.questions.delete(a),this}removeAll(){return this.questions.clear(),this}has(a){return this.questions.has(a)}get(a){return this.questions.get(a)}getKeys(a=[]){const b=this.questions.keys();for(const c of b)a.push(c);return a}getOption(a,b){typeof a==="string"&&(a=this.get(a));if(!a)return null;const c=a.options;if(c)for(let d=0,e=c.length;d<e;d++){let f=c[d];if(f.key===b)return f}return null}}const Re="quest";class dq extends ta{constructor(a,{eventEmitter:b,shuffleQuestions:c=!1,shuffleOptions:d=!1}={}){super();this.questionKeys=[];this.setEventEmitter(b),ee(a)&&(a=new Zh(a)),this.questionsManager=a,this.setShuffleQuestionsEnable(c),this.setShuffleOptionsEnable(d),this.init()}setShuffleQuestionsEnable(a=!0){return this.shuffleQuestionsEnable=a,this}setShuffleOptionsEnable(a=!0){return this.shuffleOptionsEnable=a,this}init(){return this.questionKeys.length=0,this.questionsManager.getKeys(this.questionKeys),this.shuffleQuestionsEnable&&Zb(this.questionKeys),this.nextIndex=-1,this.nextKey=void 0,this}setNextKey(a){return a===void 0?(this.nextIndex++,this.nextKey=this.questionKeys[this.nextIndex]):this.questionsManager.has(a)&&(this.nextKey=a,this.nextIndex=this.questionKeys.indexOf(a)),this}setPrevKey(){return this.nextIndex--,this.nextKey=this.questionKeys[this.nextIndex],this}getQuestion(){const a=this.questionsManager.get(this.nextKey);if(a&&this.shuffleOptionsEnable){const b=a.options;b&&Zb(b)}return a}getNextQuestion(a){return this.setNextKey(a).getQuestion()}getPrevQuestion(){return this.setPrevKey().getQuestion()}getOption(a,b){return b===void 0&&(b=a,a=this.getQuestion()),this.questionsManager.getOption(a,b)}next(a){const b=this.getNextQuestion(a);return b&&this.emit(Re,b,this,this.questionsManager),this}prev(){const a=this.getPrevQuestion();return a&&this.emit(Re,a,this,this.questionsManager),this}restart(a){return this.init(),this.next(a),this}get isLastQuestion(){return this.nextIndex===this.questionKeys.length-1}}var ag;(function(a){a[a.ascending=0]="ascending",a[a.descending=1]="descending",a[a.logical_ascending=2]="logical_ascending",a[a.logical_descending=3]="logical_descending"})(ag||(ag={}));class Cn extends jd{constructor(){super();oi("img","../assets/rectangle128x96.jpg").load().then(()=>{this.create()})}create(){const a=new bf(this),b=new Jb(0,0,"img");b.setOrigin(0),ib(a,b);const c=new nb(200,200,"img");ib(a,c);const d=new nb(400,200,"img",void 0,"ellipse");ib(a,d);const e=new nb(600,200,"img",void 0,{maskType:"roundRectangle",radius:20});ib(a,e);const f=new nb(200,400,"img",void 0,{maskType:"circle",backgroundStyle:"yellow"});ib(a,f);const g=new nb(400,400,"img",void 0,{maskType:"ellipse",backgroundStyle:"yellow"});ib(a,g);const j=new nb(600,400,"img",void 0,{maskType:"roundRectangle",radius:20,backgroundStyle:"yellow"});ib(a,j)}}new ni(af(),$e(800,600),Ze("game"),Ye(2960685),_e(Cn));})();
/* @license
Papa Parse
v5.3.0
https://github.com/mholt/PapaParse
License: MIT
*/
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

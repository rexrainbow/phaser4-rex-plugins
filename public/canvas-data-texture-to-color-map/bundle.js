(()=>{const s={AUTO:"Auto",BACKGROUND_COLOR:"BackgroundColor",BANNER:"Banner",BATCH_SIZE:"BatchSize",CANVAS_CONTEXT:"CanvasContext",CANVAS:"Canvas",DEFAULT_ORIGIN:"DefaultOrigin",GLOBAL_VAR:"GlobalVar",MAX_TEXTURES:"MaxTextures",PARENT:"Parent",RENDERER:"Renderer",SCENES:"Scenes",SIZE:"Size",WEBGL_CONTEXT:"WebGLContext",WEBGL:"WebGL"};const r=new Map();function Ya(a){r.set(s.BACKGROUND_COLOR,a)}function vb(a){return()=>{Ya(a)}}function Za(a="",b="",c="",d="#fff",f="linear-gradient(#3e0081 40%, #00bcc3)"){r.set(s.BANNER,{title:a,version:b,url:c,color:d,background:f})}function Jb(a){r.set(s.BATCH_SIZE,a)}function M(){return r.get(s.SIZE).height}function N(){return r.get(s.SIZE).resolution}function O(){return r.get(s.SIZE).width}function ta(a=800,b=600,c=1){c===0&&(c=window.devicePixelRatio),r.set(s.SIZE,{width:a,height:b,resolution:c})}function Xa(a=800,b=600,c=1){return()=>{ta(a,b,c)}}const ic=[],ma={add:(a,b)=>{ic.push({texture:a,glConfig:b})},get:()=>ic,clear:()=>{ic.length=0}};function Kb(){return r.get(s.BACKGROUND_COLOR)}function $a(a){r.set(s.RENDERER,a)}function _a(a=.5,b=a){r.set(s.DEFAULT_ORIGIN,{x:a,y:b})}function ia(a){r.set(s.MAX_TEXTURES,a)}function va(a){let b;return a&&(typeof a==="string"?b=document.getElementById(a):typeof a==="object"&&a.nodeType===1&&(b=a)),b||(b=document.body),b}function Nb(a){a&&r.set(s.PARENT,va(a))}function Va(a){return()=>{Nb(a)}}function Pb(a){r.set(s.SCENES,[].concat(a))}function Wa(a){return()=>{Pb(a)}}function kb(a,b,c){return a.width<=0||a.height<=0?!1:a.x<=b&&a.x+a.width>=b&&a.y<=c&&a.y+a.height>=c}class A{constructor(a=0,b=0,c=0,d=0){this.set(a,b,c,d)}set(a=0,b=0,c=0,d=0){return this.x=a,this.y=b,this.width=c,this.height=d,this}contains(a,b){return kb(this,a,b)}set right(a){a<=this.x?this.width=0:this.width=a-this.x}get right(){return this.x+this.width}set bottom(a){a<=this.y?this.height=0:this.height=a-this.y}get bottom(){return this.y+this.height}}function xc(a,b=0,c=0,d=0,f=0){const g=new A(b,c,d,f);return a.viewportStack.push(g),g}let e;const xd={get:()=>e,set:a=>{e=a}};function aa(a,b){if(!b){b=a.currentViewport;if(!b)return}const c=e.getParameter(e.VIEWPORT);(c[0]!==b.x||c[1]!==b.y||c[2]!==b.width||c[3]!==b.height)&&e.viewport(b.x,b.y,b.width,b.height)}function zc(a,b=0,c=0,d=0,f=0){const g=xc(a,b,c,d,f);aa(a,g),a.currentViewport=g}function _(a,b=!0,c){c||(c=a.currentFramebuffer);const{framebuffer:d,viewport:f}=c;e.bindFramebuffer(e.FRAMEBUFFER,d),b&&(e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)),f&&zc(a,f.x,f.y,f.width,f.height)}function Dc(a){const b=a.viewportStack;b.length>1&&b.pop(),a.currentViewport=b[b.length-1],aa(a)}function X(a){const b=a.framebufferStack;b.length>1&&(a.currentFramebuffer.viewport&&Dc(a),b.pop()),a.currentFramebuffer=b[b.length-1],_(a,!1)}function uc(a,b,c){const d={framebuffer:b,viewport:c};return a.framebufferStack.push(d),d}function ka(a,b,c=!0,d){const f=uc(a,b,d);_(a,c,f),a.currentFramebuffer=f}function Cc(a){const b=a.count;if(b===0)return;const c=a.currentVertexBuffer,d=a.currentShader,f=d.shader.renderToFramebuffer;f&&ka(a,d.shader.framebuffer,!0);if(b===c.batchSize){const g=c.isDynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW;e.bufferData(e.ARRAY_BUFFER,c.data,g)}else{const g=c.indexed?b*c.entryElementSize:b*c.vertexElementSize,h=c.vertexViewF32.subarray(0,g);e.bufferSubData(e.ARRAY_BUFFER,0,h)}c.indexed?e.drawElements(e.TRIANGLES,b*c.entryIndexSize,e.UNSIGNED_SHORT,0):e.drawArrays(e.TRIANGLES,0,b),f&&X(a)}function B(a,b){b&&(a.count=b);const c=a.count;return c===0?!1:(Cc(a),a.prevCount=c,a.count=0,a.flushTotal++,!0)}function jc(a){B(a)}function zd(a,b=[]){const c=a>>16&255,d=a>>8&255,f=a&255,g=a>16777215?a>>>24:255;return b[0]=c/255,b[1]=d/255,b[2]=f/255,b[3]=g/255,b}function ld(){return r.get(s.WEBGL_CONTEXT)}function pb(a){const{parent:b,flipY:c,unpackPremultiplyAlpha:d,minFilter:f,magFilter:g,wrapS:h,wrapT:i,generateMipmap:j,isPOT:k}=a,m=b.image;let l=b.width,t=b.height;const n=e.createTexture();return e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,n),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,c),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,d),m?(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,m),l=m.width,t=m.height):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,l,t,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,f),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,g),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,h),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,i),j&&k&&e.generateMipmap(e.TEXTURE_2D),a.texture=n,n}function L(a){e&&e.isFramebuffer(a)&&e.deleteFramebuffer(a)}function Na(a){e.isTexture(a)&&e.deleteTexture(a)}function td(a,b){return a<1||b<1?!1:(a&a-1)===0&&(b&b-1)===0}function Hd(a,b=!0){e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,a);const c=b?e.LINEAR:e.NEAREST;e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,c),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,c)}function Id(a){const b=a.parent.image,c=b.width,d=b.height;return c>0&&d>0&&(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,a.texture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,a.flipY),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,b)),a.texture}class la{constructor(a,b={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1,this.parent=a,this.isPOT=td(a.width,a.height);const{texture:c=null,framebuffer:d=null,depthbuffer:f=null,unpackPremultiplyAlpha:g=!0,minFilter:h=this.isPOT?e.LINEAR_MIPMAP_LINEAR:e.LINEAR,magFilter:i=e.LINEAR,wrapS:j=e.CLAMP_TO_EDGE,wrapT:k=e.CLAMP_TO_EDGE,generateMipmap:m=this.isPOT,flipY:l=!1}=b;this.minFilter=h,this.magFilter=i,this.wrapS=j,this.wrapT=k,this.generateMipmap=m,this.flipY=l,this.unpackPremultiplyAlpha=g,d&&(this.framebuffer=d),f&&(this.depthbuffer=f),c?this.texture=c:pb(this)}setFilter(a){this.texture&&Hd(this.texture,a)}create(){const a=this.texture;return a&&Na(a),pb(this)}update(){const a=this.texture;return a?Id(this):pb(this)}setIndex(a){this.dirtyIndex=a!==this.index,this.index=a}destroy(){Na(this.texture),L(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}}function kc(){const a=ma.get();a.forEach(b=>{const{texture:c,glConfig:d}=b;c.binding||(c.binding=new la(c,d))}),ma.clear()}function ua(){return r.get(s.MAX_TEXTURES)}const Ce=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function De(a){let b="";for(let c=0;c<a;++c)c>0&&(b+=`
else `),c<a-1&&(b+=`if(test == ${c}.0){}`);return b}function Ac(a){const b=e.createShader(e.FRAGMENT_SHADER);for(;;){const c=Ce.replace(/%forloop%/gi,De(a));e.shaderSource(b,c),e.compileShader(b);if(!e.getShaderParameter(b,e.COMPILE_STATUS))a=a/2|0;else break}return a}function Bc(a){let b=Ac(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS));const c=ua();c===0||c>0&&c>b?ia(b):c>0&&c<b&&(b=Math.max(8,c));const d=a.tempTextures;d.length&&d.forEach(g=>{e.deleteTexture(g)});const f=[];for(let g=0;g<b;g++){const h=e.createTexture();e.activeTexture(e.TEXTURE0+g),e.bindTexture(e.TEXTURE_2D,h),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),d[g]=h,f.push(g)}a.maxTextures=b,a.textureIndex=f,a.currentActiveTexture=1}function jd(){return r.get(s.BATCH_SIZE)}function Ja(a){e.isBuffer(a)&&e.deleteBuffer(a)}class Bd{constructor(a={}){this.indexed=!1,this.isDynamic=!1,this.count=0,this.offset=0;const{batchSize:b=1,dataSize:c=4,isDynamic:d=!0,elementsPerEntry:f=4,vertexElementSize:g=6}=a;this.batchSize=b,this.dataSize=c,this.vertexElementSize=g,this.isDynamic=d,this.elementsPerEntry=f,this.vertexByteSize=g*c,this.entryByteSize=this.vertexByteSize*f,this.bufferByteSize=b*this.entryByteSize,this.create()}resize(a){this.batchSize=a,this.bufferByteSize=a*this.entryByteSize,this.vertexBuffer&&Ja(this.vertexBuffer),this.create()}create(){const a=new ArrayBuffer(this.bufferByteSize);this.data=a,this.vertexViewF32=new Float32Array(a),this.vertexViewU32=new Uint32Array(a),this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer);const b=this.isDynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW;e.bufferData(e.ARRAY_BUFFER,a,b),e.bindBuffer(e.ARRAY_BUFFER,null)}add(a){this.count+=a,this.offset+=this.vertexElementSize*a}reset(){this.count=0,this.offset=0}canContain(a){return this.count+a<=this.batchSize}free(){return Math.max(0,1-this.count/this.batchSize)}bind(){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer)}destroy(){Ja(this.vertexBuffer),this.data=null,this.vertexViewF32=null,this.vertexViewU32=null,this.vertexBuffer=null}}class oc extends Bd{constructor(a={}){super(a);const{indexSize:b=4,entryIndexSize:c=6,indexLayout:d=null}=a;this.indexed=!0,this.indexSize=b,this.entryIndexSize=c,this.entryElementSize=this.vertexElementSize*this.elementsPerEntry;const f=[];if(d){this.indexLayout=d;for(let g=0;g<this.batchSize*b;g+=b)for(let h=0;h<d.length;h++)f.push(g+d[h])}this.create(),this.createIndexBuffer(f)}createIndexBuffer(a){this.index=new Uint16Array(a),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.index,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),a=[]}bind(){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer)}destroy(){super.destroy(),Ja(this.indexBuffer),this.index=null,this.indexLayout=null,this.indexBuffer=null}}const Qd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ie=new Uint8Array(256);for(let a=0;a<Qd.length;a++)Ie[Qd.charCodeAt(a)]=a;function Y(){}class v{constructor(a){const b=new Float32Array(16);this.data=b,this.onChange=Y,a?Array.isArray(a)?this.fromArray(a):this.fromArray(a.data):(b[0]=1,b[5]=1,b[10]=1,b[15]=1)}set(a,b,c,d,f,g,h,i,j,k,m,l,t,n,u,w){const p=this.data;return p[0]=a,p[1]=b,p[2]=c,p[3]=d,p[4]=f,p[5]=g,p[6]=h,p[7]=i,p[8]=j,p[9]=k,p[10]=m,p[11]=l,p[12]=t,p[13]=n,p[14]=u,p[15]=w,this.onChange(this),this}toArray(a=[],b=0){const c=this.data;for(let d=0;d<16;d++)a[b+d]=c[d];return a}fromArray(a,b=0){const c=this.data;for(let d=0;d<16;d++)c[d]=a[b+d];return this.onChange(this),this}toString(){return"[ mat4="+this.data.join(", ")+" ]"}destroy(){this.onChange=Y,this.data=null}}function hc(a,b,c,d,f,g,h=new v()){const i=1/(a-b),j=1/(c-d),k=1/(f-g);return h.set(-2*i,0,0,0,0,-2*j,0,0,0,0,2*k,0,(a+b)*i,(d+c)*j,(g+f)*k,1)}function Kc(a,b){const c=new Map(),d={size:1,type:e.FLOAT,normalized:!1,stride:0,offset:0},f=e.getProgramParameter(a,e.ACTIVE_ATTRIBUTES);for(let g=0;g<f;g++){const h=e.getActiveAttrib(a,g);if(!h)break;const i=h.name,j=e.getAttribLocation(a,i);e.enableVertexAttribArray(j);const k=b.hasOwnProperty(i)?b[i]:{},{size:m=d.size,type:l=d.type,normalized:t=d.normalized,stride:n=d.stride,offset:u=d.offset}=k;c.set(i,{index:j,size:m,type:l,normalized:t,stride:n,offset:u})}return c}function Ma(...a){a.forEach(b=>{e.deleteShader(b)})}function Lc(...a){const b=e.createProgram();a.forEach(d=>{e.attachShader(b,d)}),e.linkProgram(b);const c=e.getProgramParameter(b,e.LINK_STATUS);if(!c){const d=e.getProgramInfoLog(b);return console.error(`Error linking program: ${d}`),e.deleteProgram(b),Ma(...a),null}return b}function ob(a,b){const c=e.createShader(b);e.shaderSource(c,a),e.compileShader(c);const d=e.getShaderParameter(c,e.COMPILE_STATUS);if(!d){const f=e.getShaderInfoLog(c),g=a.split(`
`).map((h,i)=>`${i}: ${h}`);return console.error(`Error compiling shader: ${f}`,g.join(`
`)),e.deleteShader(c),null}return c}function Mc(a,b,c=!1){switch(a.type){case e.INT:case e.BOOL:return c?d=>{e.uniform1iv(b,d)}:d=>{e.uniform1i(b,d)};case e.INT_VEC2:case e.BOOL_VEC2:return d=>{e.uniform2iv(b,d)};case e.INT_VEC3:case e.BOOL_VEC3:return d=>{e.uniform3iv(b,d)};case e.INT_VEC4:case e.BOOL_VEC4:return d=>{e.uniform4iv(b,d)};case e.FLOAT:return c?d=>{e.uniform1fv(b,d)}:d=>{e.uniform1f(b,d)};case e.FLOAT_VEC2:return d=>{e.uniform2fv(b,d)};case e.FLOAT_VEC3:return d=>{e.uniform3fv(b,d)};case e.FLOAT_VEC4:return d=>{e.uniform4fv(b,d)};case e.FLOAT_MAT2:return d=>{e.uniformMatrix2fv(b,!1,d)};case e.FLOAT_MAT3:return d=>{e.uniformMatrix3fv(b,!1,d)};case e.FLOAT_MAT4:return d=>{e.uniformMatrix4fv(b,!1,d)};case e.SAMPLER_2D:case e.SAMPLER_CUBE:return a.size>1?d=>{e.uniform1iv(b,d)}:d=>{e.uniform1i(b,d)}}}function Nc(a){const b=new Map(),c=e.getProgramParameter(a,e.ACTIVE_UNIFORMS);for(let d=0;d<c;d++){const f=e.getActiveUniform(a,d);let g=f.name;if(g.startsWith("gl_")||g.startsWith("webgl_"))continue;const h=e.getUniformLocation(a,f.name);if(h){let i=!1;g.substr(-3)==="[0]"&&(g=g.substr(0,g.length-3),i=f.size>1),b.set(g,Mc(f,h,i))}}return b}const yd=5121,lb=5126;const ca={aVertexPosition:{size:2,type:lb,normalized:!1,offset:0},aTextureCoord:{size:2,type:lb,normalized:!1,offset:8},aTextureId:{size:1,type:lb,normalized:!1,offset:16},aTintColor:{size:4,type:yd,normalized:!0,offset:20}};const Oc={uProjectionMatrix:new Float32Array(),uCameraMatrix:new Float32Array(),uTexture:0};function Dd(a,b,c){e.bindFramebuffer(e.FRAMEBUFFER,a);const d=e.createRenderbuffer();return e.bindRenderbuffer(e.RENDERBUFFER,d),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,b,c),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,d),e.bindFramebuffer(e.FRAMEBUFFER,null),d}function hb(a,b){b||(b=e.COLOR_ATTACHMENT0);const c=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,c),e.framebufferTexture2D(e.FRAMEBUFFER,b,e.TEXTURE_2D,a,0),e.bindFramebuffer(e.FRAMEBUFFER,null),c}const Fd=`#define SHADER_NAME SINGLE_QUAD_FRAG

precision highp float;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

uniform sampler2D uTexture;

void main (void)
{
    vec4 color = texture2D(uTexture, vTextureCoord);

    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);
}`;const Gd=`#define SHADER_NAME SINGLE_QUAD_VERT

precision highp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute float aTextureId;
attribute vec4 aTintColor;

uniform mat4 uProjectionMatrix;
uniform mat4 uCameraMatrix;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

void main (void)
{
    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vTintColor = aTintColor;

    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);
}`;class Oa{constructor(a,b,c,d,f,g){this.trimmed=!1,this.texture=a,this.key=b,this.x=c,this.y=d,this.width=f,this.height=g,this.sourceSizeWidth=f,this.sourceSizeHeight=g,this.updateUVs()}setPivot(a,b){this.pivot={x:a,y:b}}setSize(a,b){this.width=a,this.height=b,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.updateUVs()}setSourceSize(a,b){this.sourceSizeWidth=a,this.sourceSizeHeight=b}setTrim(a,b,c,d,f,g){this.trimmed=!0,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.spriteSourceSizeX=c,this.spriteSourceSizeY=d,this.spriteSourceSizeWidth=f,this.spriteSourceSizeHeight=g}getExtent(a,b){const c=this.sourceSizeWidth,d=this.sourceSizeHeight;let f,g,h,i;return this.trimmed?(f=this.spriteSourceSizeX-a*c,g=f+this.spriteSourceSizeWidth,h=this.spriteSourceSizeY-b*d,i=h+this.spriteSourceSizeHeight):(f=-a*c,g=f+c,h=-b*d,i=h+d),{left:f,right:g,top:h,bottom:i}}copyToExtent(a){const b=a.transform,c=b.origin.x,d=b.origin.y,f=this.sourceSizeWidth,g=this.sourceSizeHeight;let h,i,j,k;return this.trimmed?(h=this.spriteSourceSizeX-c*f,i=this.spriteSourceSizeY-d*g,j=this.spriteSourceSizeWidth,k=this.spriteSourceSizeHeight):(h=-c*f,i=-d*g,j=f,k=g),b.setExtent(h,i,j,k),this}copyToVertices(a,b=0){const{u0:c,u1:d,v0:f,v1:g}=this;return a[b+0].setUV(c,f),a[b+1].setUV(c,g),a[b+2].setUV(d,g),a[b+3].setUV(d,f),this}updateUVs(){const{x:a,y:b,width:c,height:d}=this,f=this.texture.width,g=this.texture.height;this.u0=a/f,this.v0=b/g,this.u1=(a+c)/f,this.v1=(b+d)/g}}class D{constructor(a,b,c,d){this.key="",a&&(b=a.width,c=a.height),this.image=a,this.width=b,this.height=c,this.frames=new Map(),this.data={},this.addFrame("__BASE",0,0,b,c),ma.add(this,d)}addFrame(a,b,c,d,f){if(this.frames.has(a))return null;const g=new Oa(this,a,b,c,d,f);return this.frames.set(a,g),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=g),g}getFrame(a){if(!a)return this.firstFrame;a instanceof Oa&&(a=a.key);let b=this.frames.get(a);return b||(console.warn(`Frame missing: ${a}`),b=this.firstFrame),b}setSize(a,b){this.width=a,this.height=b;const c=this.frames.get("__BASE");c.setSize(a,b)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}}class Pc{constructor(a){this.renderToFramebuffer=!1,this.renderToDepthbuffer=!1,a&&this.fromConfig(a)}fromConfig(a){const{attributes:b=ca,fragmentShader:c=Fd,height:d=M(),renderToFramebuffer:f=!1,renderToDepthbuffer:g=!1,resolution:h=N(),vertexShader:i=Gd,width:j=O(),uniforms:k=Oc}=a;this.create(c,i,k,b);if(f){this.renderToFramebuffer=!0;const m=new D(null,j*h,d*h),l=new la(m);m.binding=l,l.framebuffer=hb(l.texture),g&&(this.renderToDepthbuffer=!0,l.depthbuffer=Dd(l.framebuffer,m.width,m.height)),this.texture=m,this.framebuffer=l.framebuffer}}create(a,b,c,d){const f=ob(a,e.FRAGMENT_SHADER),g=ob(b,e.VERTEX_SHADER);if(!f||!g)return;const h=Lc(f,g);if(!h)return;const i=e.getParameter(e.CURRENT_PROGRAM);e.useProgram(h),this.program=h,this.uniformSetters=Nc(h),this.uniforms=new Map();for(const[j,k]of Object.entries(c))this.uniforms.set(j,k);this.attributes=Kc(h,d),e.useProgram(i)}updateUniforms(a){}bind(a){return this.updateUniforms(a),this.setUniforms(a)}setUniform(a,b){const c=this.uniforms;if(c.has(a)){c.set(a,b);const d=this.uniformSetters.get(a);d(b)}}setUniforms(a){if(!this.program)return!1;e.useProgram(this.program);const b=this.uniforms;for(const[c,d]of this.uniformSetters.entries())d(b.get(c));return!0}setAttributes(a){if(this.program){const b=a.currentVertexBuffer.vertexByteSize;this.attributes.forEach(c=>{e.vertexAttribPointer(c.index,c.size,c.type,c.normalized,b,c.offset)})}}destroy(){Ma(this.program),Na(this.texture),L(this.framebuffer),this.uniforms.clear(),this.uniformSetters.clear(),this.attributes.clear(),this.program=null,this.texture=null,this.framebuffer=null}}class ba extends Pc{constructor(a={}){const b=a;b.attributes=b.attributes?b.attributes:ca,super(b)}bind(a){const b=this.uniforms;return b.set("uProjectionMatrix",a.projectionMatrix.data),b.set("uCameraMatrix",a.cameraMatrix.data),super.bind(a)}}class Ee extends ba{constructor(a={}){const b=a;b.attributes=b.attributes?b.attributes:ca,b.renderToFramebuffer=!0,super(b)}bind(a){const b=a.renderer;return this.uniforms.set("uTime",performance.now()),this.uniforms.set("uResolution",[b.width,b.height]),super.bind(a)}}const Ed=`#define SHADER_NAME MULTI_QUAD_FRAG

precision highp float;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

uniform sampler2D uTexture[%count%];

void main (void)
{
    vec4 color;

    %forloop%

    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);
}`;class Ec extends ba{constructor(a={}){a.fragmentShader||(a.fragmentShader=Ed),super(a)}create(a,b,c,d){const f=ua();let g="";for(let h=1;h<f;h++)h>1&&(g+=`
	else `),h<f-1&&(g+=`if (vTextureId < ${h}.5)`),g+=`
	{`,g+=`
		color = texture2D(uTexture[${h}], vTextureCoord);`,g+=`
	}`;a=a.replace(/%count%/gi,`${f}`),a=a.replace(/%forloop%/gi,g),super.create(a,b,c,d)}bind(a){return this.uniforms.set("uTexture",a.textureIndex),super.bind(a)}}function Fc(a,b,c,d){const f={enable:b,sfactor:c,dfactor:d};a.blendModeStack[0]=f,a.currentBlendMode=f,a.defaultBlendMode=f}function Gc(a,b=null,c){const d={framebuffer:b,viewport:c};a.framebufferStack[0]=d,a.currentFramebuffer=d,a.defaultFramebuffer=d}function Hc(a,b,c){const d={shader:b,textureID:c};a.shaderStack[0]=d,a.currentShader=d,a.defaultShader=d}function Ic(a,b){a.vertexBufferStack[0]=b,a.currentVertexBuffer=b,a.defaultVertexBuffer=b}function Jc(a,b=0,c=0,d=0,f=0){const g=new A(b,c,d,f);a.viewportStack[0]=g,a.currentViewport=g,a.defaultViewport=g}let gd,hd=0,id=0;const C={get:()=>gd,set:a=>{gd=a},getFrame:()=>hd,setFrame:a=>{hd=a},getElapsed:()=>id,setElapsed:a=>{id=a}};function ha(a=new v()){return a.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}class R{constructor(a=1,b=0,c=0,d=1,f=0,g=0){this.set(a,b,c,d,f,g)}set(a=1,b=0,c=0,d=1,f=0,g=0){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=f,this.ty=g,this}identity(){return this.set()}toArray(){const{a,b,c,d,tx:f,ty:g}=this;return[a,b,c,d,f,g]}fromArray(a){return this.set(a[0],a[1],a[2],a[3],a[4],a[5])}}class J{constructor(a,b=0,c=0){this._x=b,this._y=c,this.onChange=a}destroy(){this.onChange=Y}set(a=0,b=0){return this._x=a,this._y=b,this.onChange&&this.onChange(this),this}get x(){return this._x}set x(a){const b=this._x;this._x=a,b!==a&&this.onChange(this)}get y(){return this._y}set y(a){const b=this._y;this._y=a,b!==a&&this.onChange(this)}toArray(a=[],b=0){const{x:c,y:d}=this;return a[b]=c,a[b+1]=d,a}fromArray(a,b=0){return this.set(a[b],a[b+1])}toString(){const{x:a,y:b}=this;return`{ x=${a}, y=${b} }`}}const Ia={PI2:Math.PI*2,HALF_PI:Math.PI*.5,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};function gc(a,b,c){const d=c-b;return b+((a-b)%d+d)%d}function Hb(a){return gc(a,-Math.PI,Math.PI)}class Ib{constructor(){this._rotation=0,this.type="Camera",this.dirtyRender=!0;const a=C.get();this.renderer=a.renderer,this.matrix=ha(),this.bounds=new A(),this.worldTransform=new R(),this.position=new J(()=>this.updateTransform(),0,0),this.scale=new J(()=>this.updateTransform(),1,1),this.origin=new J(()=>this.updateTransform(),.5,.5),this.reset()}updateTransform(){const a=this.matrix.data,b=this.position.x,c=this.position.y,d=this.scale.x,f=this.scale.y,g=-b+this.width*this.origin.x,h=-c+this.height*this.origin.y,i=Math.sin(this.rotation),j=Math.cos(this.rotation),k=i+i,m=i*k,l=j*k,t=(1-m)*d,n=l*d,u=-l*f,w=(1-m)*f;a[0]=t,a[1]=n,a[4]=u,a[5]=w,a[12]=b+g-(t*g+u*h),a[13]=c+h-(n*g+w*h),this.worldTransform.set(j*d,i*d,-i*f,j*f,-b,-c);const p=this.width*(1/d),y=this.height*(1/f);this.bounds.set(g-p/2,h-y/2,p,y),this.dirtyRender=!0}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}set rotation(a){a!==this._rotation&&(this._rotation=Hb(a),this.updateTransform())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.origin.destroy(),this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}class sa{constructor(){this.type="StaticCamera",this.dirtyRender=!0;const a=C.get();this.renderer=a.renderer,this.matrix=ha(),this.bounds=new A(),this.worldTransform=new R(),this.reset()}reset(){const a=this.renderer;if(a){const b=a.width,c=a.height;this.width=b,this.height=c}this.bounds.set(0,0,this.width,this.height)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}class lc{constructor(a){this.count=0,this.prevCount=0,this.flushTotal=0,this.maxTextures=0,this.currentActiveTexture=0,this.startActiveTexture=0,this.tempTextures=[],this.textureIndex=[],this.framebufferStack=[],this.currentFramebuffer=null,this.defaultFramebuffer=null,this.vertexBufferStack=[],this.currentVertexBuffer=null,this.defaultVertexBuffer=null,this.shaderStack=[],this.currentShader=null,this.defaultShader=null,this.viewportStack=[],this.currentViewport=null,this.defaultViewport=null,this.blendModeStack=[],this.currentBlendMode=null,this.defaultBlendMode=null,this.renderer=a,this.projectionMatrix=new v(),this.reset()}reset(){const a=this.renderer.gl,b=[0,1,2,2,3,0];this.quadShader=new ba(),this.quadBuffer=new oc({isDynamic:!1,indexLayout:b}),this.quadCamera=new sa(),Bc(this),Gc(this),Fc(this,!0,a.ONE,a.ONE_MINUS_SRC_ALPHA),Ic(this,new oc({batchSize:jd(),indexLayout:b})),Hc(this,new Ec())}resize(a,b){hc(0,a,b,0,-1e3,1e3,this.projectionMatrix),this.quadCamera.reset(),Jc(this,0,0,a,b)}}function vc(a,b,c){const d={shader:b,textureID:c};return a.shaderStack.push(d),d}function wc(a,b){return a.vertexBufferStack.push(b),b}function Z(a,b){b||(b=a.currentShader);const c=b.shader.bind(a,b.textureID);c&&b.shader.setAttributes(a)}function yc(a,b){a.current2DCamera=b,a.cameraMatrix=b.matrix,Z(a)}function La(a,b){b||(b=a.currentBlendMode),b.enable?(e.enable(e.BLEND),e.blendFunc(b.sfactor,b.dfactor)):e.disable(e.BLEND)}function qc(a,b=0){const c=a.binding;c.setIndex(b),e.activeTexture(e.TEXTURE0+b),e.bindTexture(e.TEXTURE_2D,c.texture)}function $(a,b){b||(b=a.currentVertexBuffer);const c=b.indexed?b.indexBuffer:null;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,c),e.bindBuffer(e.ARRAY_BUFFER,b.vertexBuffer)}function mb(a){const b=a.vertexBufferStack;b.length>1&&b.pop(),a.currentVertexBuffer=b[b.length-1],$(a)}function nb(a,b){const c=wc(a,b);$(a,c),a.currentVertexBuffer=c}function Ka(a,b=0){const c=a.currentVertexBuffer;a.count+b>=c.batchSize&&B(a);const d=c.indexed?a.count*c.entryElementSize:a.count*c.vertexElementSize;return a.count+=b,{buffer:c,F32:c.vertexViewF32,U32:c.vertexViewU32,offset:d}}function rc(a){const b=a.shaderStack;b.length>1&&b.pop(),a.currentShader=b[b.length-1],Z(a)}function sc(a,b,c){const d=vc(a,b,c);Z(a,d),a.currentShader=d}function pc(a,b){const c=b.binding,d=a.currentActiveTexture;return c.indexCounter<a.startActiveTexture&&(c.indexCounter=a.startActiveTexture,d<a.maxTextures?(c.setIndex(d),e.activeTexture(e.TEXTURE0+d),e.bindTexture(e.TEXTURE_2D,c.texture),a.currentActiveTexture++):(B(a),a.startActiveTexture++,c.indexCounter=a.startActiveTexture,c.setIndex(1),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,c.texture),a.currentActiveTexture=2)),c.index}function mc(a){a.current2DCamera=a.quadCamera,a.cameraMatrix=a.quadCamera.matrix,a.count=0,a.flushTotal=0,_(a,!1,a.defaultFramebuffer),La(a,a.defaultBlendMode),aa(a,a.defaultViewport),$(a,a.defaultVertexBuffer)}function tc(a,b=0){e.activeTexture(e.TEXTURE0+b),e.bindTexture(e.TEXTURE_2D,a.tempTextures[b]),b>0&&a.startActiveTexture++}let Ad;const nc={get:()=>Ad,set:a=>{Ad=a}};class kd{constructor(){this.clearColor=[0,0,0,1],this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.width=O(),this.height=M(),this.resolution=N(),this.setBackgroundColor(Kb());const a=document.createElement("canvas");a.addEventListener("webglcontextlost",b=>this.onContextLost(b),!1),a.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=a,this.initContext(),nc.set(this),this.renderPass=new lc(this),this.resize(this.width,this.height,this.resolution)}initContext(){const a=this.canvas.getContext("webgl",ld());xd.set(a),this.gl=a,a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE)}resize(a,b,c=1){const d=a*c,f=b*c;this.width=d,this.height=f,this.resolution=c;const g=this.canvas;g.width=d,g.height=f,this.autoResize&&(g.style.width=a.toString()+"px",g.style.height=b.toString()+"px"),this.renderPass.resize(d,f)}onContextLost(a){a.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(a){return zd(a,this.clearColor),this}reset(){}render(a){if(this.contextLost)return;const b=this.gl,c=this.renderPass;kc();if(this.optimizeRedraw&&a.numDirtyFrames===0&&a.numDirtyCameras===0)return;if(this.clearBeforeRender){const f=this.clearColor;b.clearColor(f[0],f[1],f[2],f[3]),b.clear(b.COLOR_BUFFER_BIT)}const d=a.worldData;mc(c);for(let f=0;f<d.length;f++){const{world:g}=d[f];g.renderGL(c),g.postRenderGL(c)}jc(c)}destroy(){nc.set(void 0)}}function wb(){return()=>{$a(kd)}}function Ab(a,b){const c=va(b);return c.appendChild(a),a}function Bb(a){const b=document.readyState;if(b==="complete"||b==="interactive"){a();return}const c=()=>{document.removeEventListener("deviceready",c,!0),document.removeEventListener("DOMContentLoaded",c,!0),window.removeEventListener("load",c,!0),a()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",c,!0):(document.addEventListener("DOMContentLoaded",c,!0),window.addEventListener("load",c,!0)):window.setTimeout(c,20)}function z(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);for(const f of d)f.callback.apply(f.context,c),f.once&&d.delete(f);return d.size===0&&a.events.delete(b),!0}class Cb{constructor(){this.events=new Map()}}class ya{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function za(a,b,c,d,f){const g=a.events,h=g.get(b);if(!c)g.delete(b);else if(c instanceof ya)h.delete(c);else{const i=!d,j=f!==void 0;for(const k of h)k.callback===c&&(i&&k.context===d)&&(j&&k.once===f)&&h.delete(k)}return h.size===0&&g.delete(b),a}function U(a,b,c,d=a,f=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const g=new ya(c,d,f),h=a.events.get(b);return h?h.add(g):a.events.set(b,new Set([g])),g}function Aa(a,b,c,d=a){return U(a,b,c,d,!0)}function Db(){const{title:a,version:b,url:c,color:d,background:f}=r.get(s.BANNER);if(a!==""){const g=b!==""?a+" "+b:a;console.log(`%c${g}%c ${c}`,`padding: 4px 16px; color: ${d}; background: ${f}`,"")}}function Eb(){return r.get(s.GLOBAL_VAR)}function Fb(){return r.get(s.PARENT)}function Gb(){return r.get(s.RENDERER)}function Jd(){return{gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]}}function Ob(){return r.get(s.SCENES)}function Md(a,b=0){a.gameFrame=b,a.numTotalFrames=0,a.numDirtyFrames=0,a.numDirtyCameras=0,a.worldData.length=0}let Nd;const qb={get:()=>Nd,set:a=>{Nd=a}};class dd{constructor(){this.scenes=new Map(),this.sceneIndex=0,this.flush=!1,this.renderResult=Jd(),this.game=C.get(),qb.set(this),Aa(this.game,"boot",()=>this.boot())}boot(){Ob().forEach(a=>new a())}update(a,b){for(const c of this.scenes.values())z(c,"update",a,b)}render(a){const b=this.renderResult;Md(b,a);for(const c of this.scenes.values())z(c,"render",b);return this.flush&&(b.numDirtyFrames++,this.flush=!1),b}}function ed(){Ya(0),Jb(4096),Za("Phaser","4.0.0","https://phaser4.io"),ia(0),_a(.5,.5),ta(800,600,1)}function P(a,b){const c=document.createElement("canvas");return c.width=a,c.height=b,c.getContext("2d")}let Od;const E={get:()=>Od,set:a=>{Od=a}};class fd{constructor(){this.textures=new Map(),this.createDefaultTextures(),E.set(this)}createDefaultTextures(){this.add("__BLANK",new D(P(32,32).canvas));const a=P(32,32);a.strokeStyle="#0f0",a.moveTo(0,0),a.lineTo(32,32),a.stroke(),a.strokeRect(.5,.5,31,31),this.add("__MISSING",new D(a.canvas));const b=P(32,32);b.fillStyle="#fff",b.fillRect(0,0,32,32),this.add("__WHITE",new D(b.canvas))}get(a){const b=this.textures;return b.has(a)?b.get(a):b.get("__MISSING")}has(a){return this.textures.has(a)}add(a,b,c){let d;const f=this.textures;return f.has(a)||(b instanceof D?d=b:d=new D(b,0,0,c),d.key=a,f.set(a,d)),d}}class $c extends Cb{constructor(...a){super();this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,C.set(this),ed(),Bb(()=>this.boot(a))}boot(a){a.forEach(f=>f());const b=Gb();this.renderer=new b(),this.textureManager=new fd(),this.sceneManager=new dd();const c=Fb();c&&Ab(this.renderer.canvas,c);const d=Eb();d&&window&&(window[d]=this),this.isBooted=!0,Db(),z(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(a){const b=a-this.lastTick;this.lastTick=a,this.elapsed+=b,this.isPaused||(this.willUpdate&&(this.sceneManager.update(b,a),z(this,"update",b,a)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,C.setFrame(this.frame),C.setElapsed(this.elapsed),requestAnimationFrame(c=>this.step(c))}destroy(){}}function Kd(a,b,c){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:c}function Ld(a,b={}){const c=qb.get(),d=c.scenes.size,f=c.sceneIndex,g=d===0;typeof b==="string"?a.key=b:(b||!b&&g)&&(a.key=Kd(b,"key","scene"+f.toString())),c.scenes.has(a.key)?console.warn("Scene key already in use: "+a.key):(c.scenes.set(a.key,a),c.flush=!0,c.sceneIndex++)}class ad{constructor(a){this.game=C.get(),this.events=new Map(),Ld(this,a)}}function T(a){const b=[a],c=[];for(;b.length>0;){const d=b.shift();c.push(d);const f=d.numChildren;if(f>0)for(let g=f-1;g>=0;g--)b.unshift(d.children[g])}return c.shift(),c}function K(a,b){return a.children.indexOf(b)}function ab(a,b){const c=a.children;let d;if(b>=0&&b<c.length){const f=c.splice(b,1);f[0]&&(d=f[0],d.parent=null)}return d}function xa(a,b){const c=K(a,b);return c>-1&&ab(a,c),b}const bb="addedtoworld";const Ba="destroy";const cc="postupdate";const cb="removedfromworld";const dc="update";function Ub(a,...b){return b.forEach(c=>{c.world&&(z(c.world,cb,c,c.world),z(c,cb,c,c.world)),c.world=a,z(a,bb,c,a),z(c,bb,c,a)}),b}function S(a,...b){b.forEach(d=>{d.parent&&xa(d.parent,d),d.parent=a});const c=a.world;return c&&Ub(c,...T(a)),b}function ra(a,b){return a.children.push(b),S(a,b),b.transform.updateWorld(),b}const q={CLEAR:0,TRANSFORM:1,UPDATE:2,CHILD_CACHE:4,POST_RENDER:8,COLORS:16,BOUNDS:32,TEXTURE:64,FRAME:128,ALPHA:256,CHILD:512,DEFAULT:1+2+16+32,USER1:536870912,USER2:1073741824,USER3:2147483648,USER4:4294967296};function wa(a,b=0,c){const d=a.children;c===void 0&&(c=d.length);const f=c-b;if(f>0&&f<=c){const g=d.splice(b,f);return g.forEach(h=>{h.parent=null}),g}else return[]}function Qb(a,b=0,c){const d=wa(a,b,c);d.forEach(f=>{f.destroy()})}function Sb(a,...b){return b.forEach(c=>{xa(a,c)}),b}function Tb(a,b,c=0,d){const f=wa(a,c,d);return S(b,...f),f.forEach(g=>{g.transform.updateWorld()}),f}class pd{constructor(a,b,c){this.responseType="text",this.crossOrigin=void 0,this.skipCache=!1,this.hasLoaded=!1,this.key=a,this.url=b,this.config=c}}function qd(a,b,c,d){return b||(b=a+c),/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/.exec(b)?b:d?d.baseURL+d.path+b:b}function rd(a){return a.data=new Image(),a.crossOrigin&&(a.data.crossOrigin=a.crossOrigin),new Promise((b,c)=>{a.data.onload=()=>{a.data.onload&&(a.data.onload=null,a.data.onerror=null,b(a))},a.data.onerror=d=>{a.data.onload&&(a.data.onload=null,a.data.onerror=null,a.error=d,c(a))},a.data.src=a.url,a.data.complete&&a.data.width&&a.data.height&&(a.data.onload=null,a.data.onerror=null,b(a))})}function bd(a,b,c){const d=new pd(a,b);return d.load=()=>(d.url=qd(d.key,d.url,".png",d.loader),d.loader&&(d.crossOrigin=d.loader.crossOrigin),new Promise((f,g)=>{const h=E.get();h.has(d.key)?f(d):rd(d).then(i=>{h.add(i.key,i.data,c),f(i)}).catch(i=>{g(i)})})),d}const Tc="worldrender";const Uc="worldshutdown";function rb(a,b){b.numRendered++,b.numRenderable++,a.node.dirtyFrame>=b.gameFrame&&b.dirtyFrame++,a.children.forEach(c=>{c.children.length>0&&rb(c,b)})}function Wc(a){if(a.node.isDirty(q.CHILD_CACHE))return!0;const b=[a];for(;b.length>0;){const c=b.pop();if(c.node.isDirty(q.TRANSFORM))return!0;const d=c.children.length;if(d>0)for(let f=0;f<d;f++)b.push(c.children[f])}return b.length=0,!1}function Vc(a,b){a.forEach(c=>{b||Wc(c)?c.node.setDirty(q.CHILD_CACHE):c.children.length=0})}function sb(a,b,c=[]){for(let d=0;d<b.numChildren;d++){const f=b.children[d];if(f.isRenderable()){const g=[],h={node:f,children:g};c.push(h),f.willRenderChildren&&f.numChildren>0&&(f.willCacheChildren&&a.push(h),sb(a,f,g))}}return c}function Rc(a){const b=[],c=[],d=sb(b,a,c),f=a.renderData;b.length>0&&Vc(b,a.camera.dirtyRender),d.forEach(g=>{g.children.length>0?rb(g,f):(f.numRendered++,f.numRenderable++,g.node.dirtyFrame>=f.gameFrame&&f.dirtyFrame++)}),a.renderList=d,a.forceRefresh&&(f.dirtyFrame++,a.forceRefresh=!1)}function Ca(a){const{a:b,b:c,c:d,d:f,tx:g,ty:h}=a.world,{x:i,y:j,right:k,bottom:m}=a.extent,l=i*b+j*d+g,t=i*c+j*f+h,n=i*b+m*d+g,u=i*c+m*f+h,w=k*b+m*d+g,p=k*c+m*f+h,y=k*b+j*d+g,F=k*c+j*f+h;return{x0:l,y0:t,x1:n,y1:u,x2:w,y2:p,x3:y,y3:F}}class Vb{constructor(a){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=a,this.area=new A()}set(a,b,c,d){this.area.set(a,b,c,d)}get(){return this.entity.isDirty(q.BOUNDS)&&!this.fixed&&this.update(),this.area}updateLocal(){const{x0:a,y0:b,x1:c,y1:d,x2:f,y2:g,x3:h,y3:i}=Ca(this.entity.transform),j=Math.min(a,c,f,h),k=Math.min(b,d,g,i),m=Math.max(a,c,f,h),l=Math.max(b,d,g,i);return this.area.set(j,k,m-j,l-k)}update(){const a=this.updateLocal();this.entity.clearDirty(q.BOUNDS);if(!this.includeChildren||!this.entity.numChildren)return a;const b=this.visibleOnly,c=this.entity.children;let d=a.x,f=a.y,g=a.right,h=a.bottom;for(let i=0;i<c.length;i++){const j=c[i];if(!j||b&&!j.visible)continue;const k=j.bounds.get();k.x<d&&(d=k.x),k.y<f&&(f=k.y),k.right>g&&(g=k.right),k.bottom>h&&(h=k.bottom)}return a.set(d,f,g-d,h-f)}destroy(){this.entity=null,this.area=null}}class Wb{constructor(a){this.enabled=!1,this.enabledChildren=!0,this.entity=a}destroy(){this.entity=null,this.hitArea=null}}function eb(a,b,c,d,f,g,h=0,i=1,j=1,k=0,m=0){const l=Math.cos(h+m)*i,t=Math.sin(h+m)*i,n=-Math.sin(h-k)*j,u=Math.cos(h-k)*j,w=a*l+c*n+f,p=a*t+c*u+g,y=a*l+d*n+f,F=a*t+d*u+g,oa=b*l+d*n+f,pa=b*t+d*u+g,ea=b*l+c*n+f,fa=b*t+c*u+g;return{x0:w,y0:p,x1:y,y1:F,x2:oa,y2:pa,x3:ea,y3:fa}}function md(a){a.forEach(b=>{b.packColor()})}function Yb(a){const b=a.vertices,{x0:c,y0:d,x1:f,y1:g,x2:h,y2:i,x3:j,y3:k}=Ca(a.transform);return b[0].setPosition(c,d),b[1].setPosition(f,g),b[2].setPosition(h,i),b[3].setPosition(j,k),a}function W(a){return a.isDirty(q.COLORS)&&(md(a.vertices),a.clearDirty(q.COLORS)),a.isDirty(q.TRANSFORM)&&(Yb(a),a.clearDirty(q.TRANSFORM)),a}function Lb(){return r.get(s.DEFAULT_ORIGIN).x}function Mb(){return r.get(s.DEFAULT_ORIGIN).y}class o{constructor(a=0,b=0){this.set(a,b)}set(a=0,b=0){return this.x=a,this.y=b,this}toArray(a=[],b=0){const{x:c,y:d}=this;return a[b]=c,a[b+1]=d,a}fromArray(a,b=0){return this.set(a[b],a[b+1])}toString(){const{x:a,y:b}=this;return`{ x=${a}, y=${b} }`}}function ib(a,b,c){return Math.max(b,Math.min(c,a))}function ac(a,b=new o()){return b.set(a.width,a.height)}function Zb(a){const b=a.local,c=a.position.x,d=a.position.y,f=a.rotation,g=a.scale.x,h=a.scale.y,i=a.skew.x,j=a.skew.y;b.set(Math.cos(f+j)*g,Math.sin(f+j)*g,-Math.sin(f-i)*h,Math.cos(f-i)*h,c,d)}function $b(a,b){const{a:c,b:d,c:f,d:g,tx:h,ty:i}=a;return b.set(c,d,f,g,h,i)}function _b(a){const b=a.parent,c=a.transform,d=c.local,f=c.world;if(!b)$b(d,f);else if(c.passthru)$b(b.transform.world,f);else{const{a:g,b:h,c:i,d:j,tx:k,ty:m}=d,{a:l,b:t,c:n,d:u,tx:w,ty:p}=b.transform.world;f.set(g*l+h*n,g*t+h*u,i*l+j*n,i*t+j*u,k*l+m*n+w,k*t+m*u+p)}}class Xb{constructor(a,b=0,c=0){this.passthru=!1,this._rotation=0,this.entity=a,this.local=new R(),this.world=new R();const d=()=>this.update(),f=()=>this.updateExtent();this.position=new J(d,b,c),this.scale=new J(d,1,1),this.skew=new J(d),this.origin=new J(f,Lb(),Mb()),this.extent=new A()}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(q.TRANSFORM,q.BOUNDS),Zb(this)}updateWorld(){const a=this.entity;a.setDirty(q.TRANSFORM,q.BOUNDS),_b(a),a.numChildren&&this.updateChildren()}updateChildren(){const a=this.entity.children;for(let b=0;b<a.length;b++){const c=a[b];c.transform.updateWorld()}}globalToLocal(a,b,c=new o()){const{a:d,b:f,c:g,d:h,tx:i,ty:j}=this.world,k=1/(d*h+g*-f);return c.x=h*k*a+-g*k*b+(j*g-i*h)*k,c.y=d*k*b+-f*k*a+(-j*d+i*f)*k,c}localToGlobal(a,b,c=new o()){const{a:d,b:f,c:g,d:h,tx:i,ty:j}=this.world;return c.x=d*a+g*b+i,c.y=f*a+h*b+j,c}setExtent(a,b,c,d){this.extent.set(a,b,c,d),this.entity.setDirty(q.TRANSFORM,q.BOUNDS)}updateExtent(a,b){const c=this.extent,d=this.entity;a!==void 0&&(c.width=a),b!==void 0&&(c.height=b),c.x=-this.origin.x*c.width,c.y=-this.origin.y*c.height,d.setDirty(q.TRANSFORM,q.BOUNDS)}set rotation(a){a!==this._rotation&&(this._rotation=a,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}}function db(a,b){const c=(b*255|0)&255;return(c<<24|a)>>>0}class H{constructor(a=0,b=0,c=0){this.x=0,this.y=0,this.z=0,this.u=0,this.v=0,this.texture=0,this.tint=16777215,this.alpha=1,this.color=4294967295,this.x=a,this.y=b,this.z=c}setPosition(a,b,c=0){return this.x=a,this.y=b,this.z=c,this}setUV(a,b){return this.u=a,this.v=b,this}setColor(a,b=1){return this.tint=a,this.alpha=b,this.packColor(),this}setAlpha(a){return this.alpha=a,this}setTint(a){return this.tint=a,this}packColor(){this.color=db(this.tint,this.alpha)}}function fb(a,b,c){const{F32:d,U32:f,offset:g}=Ka(c,1),h=pc(c,a);let i=g;b.forEach(j=>{d[i+0]=j.x,d[i+1]=j.y,d[i+2]=j.u,d[i+3]=j.v,d[i+4]=h,f[i+5]=j.color,i+=6})}class V{constructor(a=0,b=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.vertices=[],this.events=new Map(),this.transform=new Xb(this,a,b),this.bounds=new Vb(this),this.input=new Wb(this),this.dirty=q.DEFAULT,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(a){return(this.dirty&a)!==0}clearDirty(a){return this.isDirty(a)&&(this.dirty^=a),this}setDirty(a,b){return this.isDirty(a)||(this.dirty^=a,this.dirtyFrame=C.getFrame()),this.isDirty(b)||(this.dirty^=b),this}update(a,b){if(this.willUpdateChildren){const c=this.children;for(let d=0;d<c.length;d++){const f=c[d];f&&f.willUpdate&&f.update(a,b)}}this.postUpdate(a,b)}postUpdate(a,b){}renderGL(a){}renderCanvas(a){}postRenderGL(a){}postRenderCanvas(a){}get numChildren(){return this.children.length}getBounds(){return this.bounds.get()}destroy(a){a?Tb(this,a):Qb(this),z(this,Ba,this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null,this.vertices=[]}}class Da extends V{constructor(a=0,b=0){super(a,b);this._alpha=1,this.type="Container"}setSize(a,b=a){return this.transform.updateExtent(a,b),this}getSize(a=new o()){return ac(this.transform.extent,a)}setPosition(a,b){return this.transform.position.set(a,b),this}getPosition(a=new o()){const b=this.transform.position;return a.set(b.x,b.y)}setOrigin(a,b=a){return this.transform.origin.set(a,b),this}getOrigin(a=new o()){const b=this.transform.origin;return a.set(b.x,b.y)}setSkew(a,b=a){return this.transform.skew.set(a,b),this}getSkew(a=new o()){const b=this.transform.skew;return a.set(b.x,b.y)}setScale(a,b=a){return this.transform.scale.set(a,b),this}getScale(a=new o()){const b=this.transform.scale;return a.set(b.x,b.y)}setRotation(a){return this.transform.rotation=a,this}getRotation(){return this.transform.rotation}set width(a){this.transform.updateExtent(a)}get width(){return this.transform.extent.width}set height(a){this.transform.updateExtent(void 0,a)}get height(){return this.transform.extent.height}set x(a){this.transform.position.x=a}get x(){return this.transform.position.x}set y(a){this.transform.position.y=a}get y(){return this.transform.position.y}set originX(a){this.transform.origin.x=a}get originX(){return this.transform.origin.x}set originY(a){this.transform.origin.y=a}get originY(){return this.transform.origin.y}set skewX(a){this.transform.skew.x=a}get skewX(){return this.transform.skew.x}set skewY(a){this.transform.skew.y=a}get skewY(){return this.transform.skew.y}set scaleX(a){this.transform.scale.x=a}get scaleX(){return this.transform.scale.x}set scaleY(a){this.transform.scale.y=a}get scaleY(){return this.transform.scale.y}set rotation(a){this.transform.rotation=a}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(a){a!==this._alpha&&(this._alpha=a,this.vertices.forEach(b=>{b.setAlpha(a)}),this.setDirty(q.COLORS))}}function gb(a,b,c,d){if(!a)return;const f=d.ctx,{a:g,b:h,c:i,d:j,tx:k,ty:m}=c.world,{x:l,y:t}=c.extent;f.save(),f.setTransform(g,h,i,j,k,m),f.globalAlpha=b,f.drawImage(a.texture.image,a.x,a.y,a.width,a.height,l,t,a.width,a.height),f.restore()}function Fa(a,b,...c){const d=a.getFrame(b),f=d.pivot;return c.forEach(g=>{if(!g||d===g.frame)return;g.frame=d,g.hasTexture=!0,f&&g.setOrigin(f.x,f.y),d.copyToExtent(g),d.copyToVertices(g.vertices)}),c}function ec(a,b,...c){if(!a)c.forEach(d=>{d.texture=null,d.frame=null,d.hasTexture=!1});else{let d;a instanceof D?d=a:d=E.get().get(a),d?(c.forEach(f=>{f.texture=d}),Fa(d,b,...c)):console.warn(`Invalid Texture key: ${a}`)}return c}class I extends Da{constructor(a,b,c,d){super(a,b);this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertices=[new H(),new H(),new H(),new H()],this.setTexture(c,d)}setTexture(a,b){return ec(a,b,this),this}setFrame(a){return Fa(this.texture,a,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}renderGL(a){W(this),fb(this.texture,this.vertices,a)}renderCanvas(a){W(this),gb(this.frame,this.alpha,this.transform,a)}get tint(){return this._tint}set tint(a){a!==this._tint&&(this._tint=a,this.vertices.forEach(b=>{b.setTint(a)}),this.setDirty(q.COLORS))}destroy(a){super.destroy(a),this.texture=null,this.frame=null,this.hasTexture=!1}}class ge extends I{constructor(a,b,c,d){super(a,b,c,d);this.type="AnimatedSprite",this.anims=new Map(),this.animData={currentAnim:"",currentFrames:[],frameIndex:0,animSpeed:0,nextFrameTime:0,repeatCount:0,isPlaying:!1,yoyo:!1,pendingStart:!1,playingForward:!0,delay:0,repeatDelay:0,onStart:null,onRepeat:null,onComplete:null}}stop(){const a=this.animData;a.isPlaying=!1,a.currentAnim="",a.onComplete&&a.onComplete(this,a.currentAnim)}nextFrame(){const a=this.animData;a.frameIndex++;if(a.frameIndex===a.currentFrames.length)if(a.yoyo)a.frameIndex--,a.playingForward=!1;else if(a.repeatCount===-1||a.repeatCount>0)a.frameIndex=0,a.repeatCount!==-1&&a.repeatCount--,a.onRepeat&&a.onRepeat(this,a.currentAnim),a.nextFrameTime+=a.repeatDelay;else return a.frameIndex--,this.stop();this.setFrame(a.currentFrames[a.frameIndex]),a.nextFrameTime+=a.animSpeed}prevFrame(){const a=this.animData;a.frameIndex--;if(a.frameIndex===-1)if(a.repeatCount===-1||a.repeatCount>0)a.frameIndex=0,a.playingForward=!0,a.repeatCount!==-1&&a.repeatCount--,a.onRepeat&&a.onRepeat(this,a.currentAnim),a.nextFrameTime+=a.repeatDelay;else return a.frameIndex=0,this.stop();this.setFrame(a.currentFrames[a.frameIndex]),a.nextFrameTime+=a.animSpeed}update(a,b){super.update(a,b);const c=this.animData;if(!c.isPlaying)return;c.nextFrameTime-=a*1e3,c.nextFrameTime=Math.max(c.nextFrameTime,0),c.nextFrameTime===0&&(c.pendingStart?(c.onStart&&c.onStart(this,c.currentAnim),c.pendingStart=!1,c.nextFrameTime=c.animSpeed):c.playingForward?this.nextFrame():this.prevFrame())}get isPlaying(){return this.animData.isPlaying}get isPlayingForward(){return this.animData.isPlaying&&this.animData.playingForward}get currentAnimation(){return this.animData.currentAnim}destroy(a){super.destroy(a),this.anims.clear(),this.animData=null}}function Cd(a,b,c,d,f,g,h,i,j,k=0,m=4294967295){const{F32:l,U32:t,offset:n}=Ka(a,1);l[n+0]=b,l[n+1]=c,l[n+2]=g,l[n+3]=j,l[n+4]=k,t[n+5]=m,l[n+6]=b,l[n+7]=c+f,l[n+8]=g,l[n+9]=h,l[n+10]=k,t[n+11]=m,l[n+12]=b+d,l[n+13]=c+f,l[n+14]=i,l[n+15]=h,l[n+16]=k,t[n+17]=m,l[n+18]=b+d,l[n+19]=c,l[n+20]=i,l[n+21]=j,l[n+22]=k,t[n+23]=m}function ja(a,b,c){c||(c=a.quadShader);const{u0:d,v0:f,u1:g,v1:h}=b.firstFrame;qc(b,0),nb(a,a.quadBuffer),sc(a,c,0),Cd(a,0,0,b.width,b.height,d,f,g,h,0),B(a),mb(a),rc(a),tc(a)}class Ea extends V{constructor(){super();this.type="Layer",this.transform.passthru=!0,this.willRender=!1}}class bc extends Ea{constructor(){super();this.type="RenderLayer",this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!0,this.setDirty(q.CHILD_CACHE);const a=O(),b=M(),c=N(),d=new D(null,a*c,b*c),f=new la(d);d.binding=f,f.framebuffer=hb(f.texture),this.texture=d,this.framebuffer=f.framebuffer}renderGL(a){this.numChildren>0&&(B(a),!this.willCacheChildren||this.isDirty(q.CHILD_CACHE)?(ka(a,this.framebuffer,!0),this.clearDirty(q.CHILD_CACHE)):(ka(a,this.framebuffer,!1),this.postRenderGL(a)))}postRenderGL(a){B(a),X(a),ja(a,this.texture),this.clearDirty(q.TRANSFORM)}}class le extends bc{constructor(...a){super();this.shaders=[],this.type="EffectLayer",Array.isArray(a)&&(this.shaders=a)}postRenderGL(a){const b=this.shaders,c=this.texture;B(a),X(a);if(b.length===0)ja(a,c);else{let d=c;for(let f=0;f<b.length;f++){const g=b[f];ja(a,d,g),d=g.texture}ja(a,d)}this.clearDirty(q.TRANSFORM)}}class me extends Da{constructor(a,b,c=64,d=64,f=16777215){super(a,b);this._color=16777215,this.type="Rectangle",this.vertices=[new H(),new H(),new H(),new H()],this.color=f,this.setWhiteTexture(),this.setSize(c,d)}setWhiteTexture(){this.texture=E.get().get("__WHITE"),this.frame=this.texture.getFrame(),this.frame.copyToExtent(this),this.frame.copyToVertices(this.vertices)}setColor(a){return this.color=a,this}isRenderable(){return this.visible&&this.willRender&&this.alpha>0}renderGL(a){W(this),fb(this.texture,this.vertices,a)}renderCanvas(a){W(this),gb(this.frame,this.alpha,this.transform,a)}get color(){return this._color}set color(a){a!==this._color&&(this._color=a,this.vertices.forEach(b=>{b.setTint(a)}),this.setDirty(q.COLORS))}destroy(a){super.destroy(a),this.texture=null,this.frame=null}}function nd(a,b){}class zb extends Ea{constructor(a,b){super();this.glTextureIndex=0,this.hasTexture=!1,this.type="SpriteBatch",this.willRender=!0,this.setTexture(b),this.setMaxSize(a)}resetBuffers(){let a=[];for(let b=0;b<this.maxSize*4;b+=4)a.push(b+0,b+1,b+2,b+2,b+3,b+0);this.data=new ArrayBuffer(this.maxSize*96),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data),e&&(L(this.vertexBuffer),L(this.indexBuffer),this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.data,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.index,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null)),a=[],this.count=0}setMaxSize(a){return this.maxSize=ib(a,0,65535),this.resetBuffers(),this}setTexture(a){let b;return a instanceof D?b=a:b=E.get().get(a),b?(this.texture=b,this.hasTexture=!0,this.glTextureIndex=-1):console.warn(`Invalid Texture key: ${a}`),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.count>0}clear(){return this.count=0,this}addToBatch(a,b,c,d,f,g,h,i,j,k){if(this.count>=this.maxSize)return console.warn("SpriteBatch full"),this;const{u0:m,u1:l,v0:t,v1:n}=a,u=this.vertexViewF32,w=this.vertexViewU32,p=this.count*24,y=this.texture.binding?this.texture.binding.index:0;return u[p+0]=c,u[p+1]=d,u[p+2]=m,u[p+3]=t,u[p+4]=y,w[p+5]=b,u[p+6]=f,u[p+7]=g,u[p+8]=m,u[p+9]=n,u[p+10]=y,w[p+11]=b,u[p+12]=h,u[p+13]=i,u[p+14]=l,u[p+15]=n,u[p+16]=y,w[p+17]=b,u[p+18]=j,u[p+19]=k,u[p+20]=l,u[p+21]=t,u[p+22]=y,w[p+23]=b,this.setDirty(q.TRANSFORM),this.count++,this}add(a){const{frame:b=null,x:c=0,y:d=0,rotation:f=0,scaleX:g=1,scaleY:h=1,skewX:i=0,skewY:j=0,originX:k=0,originY:m=0,alpha:l=1,tint:t=16777215}=a,n=this.texture.getFrame(b),{left:u,right:w,top:p,bottom:y}=n.getExtent(k,m),{x0:F,y0:oa,x1:pa,y1:ea,x2:fa,y2:Xc,x3:Yc,y3:Zc}=eb(u,w,p,y,c,d,f,g,h,i,j),x=db(t,l);return this.addToBatch(n,x,F,oa,pa,ea,fa,Xc,Yc,Zc)}addXY(a,b,c){const d=this.texture.getFrame(c),{left:f,right:g,top:h,bottom:i}=d.getExtent(0,0),{x0:j,y0:k,x1:m,y1:l,x2:t,y2:n,x3:u,y3:w}=eb(f,g,h,i,a,b);return this.addToBatch(d,4294967295,j,k,m,l,t,n,u,w)}updateTextureIndex(){const a=this.texture.binding.index;if(a===this.glTextureIndex)return;const b=this.vertexViewF32;this.glTextureIndex=a;for(let c=0;c<this.count;c++)b[c*24+4]=a,b[c*24+10]=a,b[c*24+16]=a,b[c*24+22]=a}renderGL(a){nd(this,a)}destroy(){super.destroy(),L(this.vertexBuffer),L(this.indexBuffer),this.data=null,this.vertexViewF32=null,this.vertexViewU32=null,this.index=null,this.texture=null,this.hasTexture=!1}}function jb(a=32,b=32){const c=P(a,b);return new D(c.canvas)}class ne extends I{constructor(a,b,c="",d,f){super(a,b,jb());this.splitRegExp=/(?:\r\n|\r|\n)/,this.padding={left:0,right:0,top:0,bottom:0},this.verticalAlign="ascent",this.lineSpacing=0,this.font="16px monospace",this.fillStyle="#fff",this.strokeStyle="",this.backgroundStyle="",this.cornerRadius=0,this.textAlign="left",this.textBaseline="alphabetic",this.lineWidth=0,this.lineDash=[],this.antialias=!1,this.type="Text";const g=C.get();this.resolution=g.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),d&&(this.font=d),f&&(this.fillStyle=f),this.setText(c)}syncContext(a,b){this.preRenderCallback&&this.preRenderCallback(a,b),b.font=this.font,b.textBaseline=this.textBaseline,b.textAlign=this.textAlign,b.fillStyle=this.fillStyle,b.strokeStyle=this.strokeStyle,b.lineWidth=this.lineWidth,b.lineCap="round",b.lineJoin="round",b.setLineDash(this.lineDash),b.imageSmoothingEnabled=this.antialias}updateText(){const a=this.canvas,b=this.context,c=this.resolution,d=this._text.split(this.splitRegExp),f=this.padding,g=this.fillStyle,h=this.strokeStyle,i=this.lineWidth,j=this.lineSpacing,k=i>0?i/2:0;b.clearRect(0,0,a.width,a.height),this.syncContext(a,b),b.textAlign="start";let m=0,l=0,t=0;const n=[],u=this.verticalAlign==="ascent",w=b.measureText("|Mq"),p=Math.ceil(Math.abs(w.actualBoundingBoxAscent)+Math.abs(w.actualBoundingBoxDescent))+i;for(let x=0;x<d.length;x++){const G=b.measureText(d[x]),Ua=G.actualBoundingBoxLeft,ga=G.actualBoundingBoxRight;let Q=G.actualBoundingBoxAscent,qa=G.actualBoundingBoxDescent;(!Q&&!qa||d[x]==="")&&(Q=p,qa=0);const Zd=Math.ceil(Math.abs(Ua)+Math.abs(ga))+i,_c=Math.ceil(Math.abs(Q)+Math.abs(qa))+i;u?(t+=Q+k,x>0&&(t+=j+k),l=t+qa+k):(t=l+(_c-qa-k),l+=_c,x<d.length-1&&(l+=j)),m=Math.max(m,Zd),n.push({lineWidth:Zd,lineHeight:_c,ascent:Q,descent:qa,left:Ua,right:ga,y:t})}m+=f.left+f.right,l+=f.top+f.bottom;const y=this.fixedWidth?this.fixedWidth:m,F=this.fixedHeight?this.fixedHeight:l,oa=Math.ceil(y*c),pa=Math.ceil(F*c);(a.width!==oa||a.height!==pa)&&(a.width=oa,a.height=pa,this.texture.setSize(y,F),this.setSize(y,F)),b.save(),b.scale(c,c),this.syncContext(a,b);const ea=this.backgroundStyle;if(ea){b.save(),b.fillStyle=ea,b.strokeStyle=ea;const x=this.cornerRadius,G=x>0?x/2:0;x&&(b.lineWidth=x,b.strokeRect(G,G,y-x,F-x)),b.fillRect(G,G,y-x,F-x),b.restore()}const fa=this.textAlign,Xc=fa==="center",Yc=fa==="right"||fa==="end",Zc=(F-l)/2+f.top;for(let x=0;x<d.length;x++){const G=d[x],Ua=n[x];let ga=f.left+Ua.left+k;const Q=Zc+Ua.y;Xc?ga=y/2:Yc&&(ga=y-k),h&&b.strokeText(G,ga,Q),g&&b.fillText(G,ga,Q)}return b.restore(),this.texture.binding&&this.texture.binding.update(),this.setDirty(q.TEXTURE),this}get text(){return this._text}set text(a){this.setText(a)}setText(a=""){return Array.isArray(a)&&(a=a.join(`
`)),a!==this._text&&(this._text=a.toString(),this.updateText()),this}destroy(a){this.texture.destroy(),this.fillStyle=null,this.strokeStyle=null,this.backgroundStyle=null,this.canvas=null,this.context=null,super.destroy(a)}}function sd(a,b){return a.a===b.a&&a.b===b.b&&a.c===b.c&&a.d===b.d&&a.tx===b.tx&&a.ty===b.ty}function Sc(a,b){a.numDirtyFrames+=b.dirtyFrame,a.numTotalFrames+=b.numRendered,b.camera.dirtyRender&&a.numDirtyCameras++,a.worldData.push(b)}function Pa(a,b){a.gameFrame=b,a.dirtyFrame=0,a.numRendered=0,a.numRenderable=0}class Qa extends V{constructor(a){super();this.forceRefresh=!1,this.is3D=!1,this.type="BaseWorld",this.scene=a,this.world=this,this.events=new Map(),this.renderList=[],this._updateListener=U(a,"update",(b,c)=>this.update(b,c)),this._renderListener=U(a,"render",b=>this.render(b)),this._shutdownListener=U(a,"shutdown",()=>this.shutdown()),Aa(a,"destroy",()=>this.destroy())}update(a,b){if(!this.willUpdate)return;z(this,dc,a,b,this),super.update(a,b)}postUpdate(a,b){z(this,cc,a,b,this)}render(a){const b=this.renderData;Pa(b,a.gameFrame);if(!this.willRender||!this.visible)return;Rc(this),z(this,Tc,b,this),Sc(a,b),this.camera.dirtyRender=!1}renderGL(a){const b=a.current2DCamera,c=this.camera;(!b||!sd(c.worldTransform,b.worldTransform))&&B(a),yc(a,c),this.renderList.forEach(d=>{d.children.length>0?this.renderNode(d,a):d.node.renderGL(a)})}renderNode(a,b){a.node.renderGL(b),a.children.forEach(c=>{c.children.length>0?this.renderNode(c,b):c.node.renderGL(b)}),a.node.postRenderGL(b)}postRenderGL(a){}shutdown(){const a=this.scene;za(a,"update",this._updateListener),za(a,"render",this._renderListener),za(a,"shutdown",this._shutdownListener),Sb(this),z(this,Uc,this),Pa(this.renderData,0),this.camera&&this.camera.reset()}destroy(a){super.destroy(a),z(this,Ba,this),Pa(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}}function Ra(a,b){return{world:a,camera:b,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0}}class xb extends Qa{constructor(a){super(a);this.type="StaticWorld",this.camera=new sa(),this.renderData=Ra(this,this.camera)}}class Le extends Qa{constructor(a){super(a);this.enableCameraCull=!0,this.type="World",this.camera=new Ib(),this.renderData=Ra(this,this.camera)}}function na(a,b,c,d=1){let f;if(typeof a==="string"){let i=E.get();i.has(a)||i.add(a,jb()),f=i.get(a)}else f=a;let g=f.image,h=g.getContext("2d");return c?b.call(c,g,h):b(g,h),f.setSize(g.width/d,g.height/d),f.binding&&f.binding.update(),f}var Ta;(function(a){a[a.left=1]="left",a[a.right=2]="right",a[a.both=3]="both"})(Ta||(Ta={}));function Yd(a,b=0,c=" ",d=1){a=a.toString();let f=0;if(b+1>=a.length)switch(d){case 1:a=new Array(b+1-a.length).join(c)+a;break;case 3:f=b-a.length;let g=Math.ceil(f/2),h=f-g;a=new Array(h+1).join(c)+a+new Array(g+1).join(c);break;default:a=a+new Array(b+1-a.length).join(c);break}return a}function da(a,b,c){switch(typeof a){case"number":return`#${Yd(Math.floor(a).toString(16),6,"0",Ta.left)}`;case"function":return a(b,c);default:return a}}function Vd(a,b,c,d,f,g,h,i,j,k,m=!0){b.beginPath(),b.rect(c,d,f,g);if(h!==void 0){if(k!==void 0){let l;m?l=b.createLinearGradient(0,0,f,0):l=b.createLinearGradient(0,0,0,g),l.addColorStop(0,h),l.addColorStop(1,k),h=l}b.fillStyle=h,b.fill()}i!==void 0&&(b.strokeStyle=i,b.lineWidth=j,b.stroke())}function yb(a,{width:b=32,height:c=b,fillStyle:d,fillColor2:f,isHorizontalGradient:g=!0,strokeStyle:h,lineWidth:i=2}={}){return na(a,function(j,k){j.width=Math.ceil(b),j.height=Math.ceil(c),h||(i=0);const m=i/2,l=m,t=m;b-=i,c-=i,Vd(j,k,l,t,b,c,da(d,j,k),da(h,j,k),i,da(f,j,k),g)})}const Qe=Math.PI/180;function Sa(a){return a*Qe}const aK=Sa(0),bK=Sa(90),cK=Sa(180),dK=Sa(270);var Wd;(function(a){a[a.right=0]="right",a[a.down=1]="down",a[a.left=2]="left",a[a.up=3]="up"})(Wd||(Wd={}));class tb{constructor(a,b=0,c=b){this.width=b,this.height=c,this.buffer=new a(b*c)}getOffset(a,b){return b*this.width+a}get(a,b){let c;return arguments.length===2?c=this.getOffset(a,b):c=a,this.buffer.get(c)}set(a,b,c=b){let d;return arguments.length===3?d=this.getOffset(a,b):d=a,this.buffer.set(d,c),this}fillFromCanvas(a,b=0,c=0,d=a.width-b,f=a.height-c,g,h){this.resize(d,f);const i=a.getContext("2d"),j=i.getImageData(b,c,d,f).data,k=j.length;for(let m=0,l=k/4;m<l;m++){const t=m*4;let n;h?n=g.call(h,j,t):n=g(j,t),this.set(m,n)}return this}fill(a){return this.buffer.fill(a),this}clear(){return this.fill(0),this}resize(a,b){return this.width===a&&this.height===b?this:(this.width=a,this.height=b,this.buffer.resize(a*b),this)}forEach(a,b,c=!1){for(let d=0,f=this.height;d<f;d++)for(let g=0,h=this.width;g<h;g++){const i=this.get(g,d);if(c&&i===0)continue;b?a.call(b,i,g,d,this):a(i,g,d,this)}return this}forEachNonZero(a,b){return this.forEach(a,b,!0),this}}function Rd(a,b=0,c=0,d=a.width-b,f=a.height-c,g,h,i,j){return j===void 0&&(j=new tb(g,d,f)),j.fillFromCanvas(a,b,c,d,f,h,i),j}var ub;(function(a){a[a.uint8=0]="uint8",a[a.unit32=1]="unit32"})(ub||(ub={}));const Oe=[Uint8Array,Uint32Array],Pe=[1,4];class Xd{constructor(a,b=0){this.type=a,this.resize(b)}get(a){return this._arr[a]}set(a,b){return this._arr[a]=b,this}fill(a){for(var b=0,c=this._rows;b<c;b++)this._arr[b]=a;return this}resize(a){return a!==this._rows&&(this._rows=a,this._buf=new ArrayBuffer(this._rows*Pe[this.type]),this._arr=new Oe[this.type](this._buf)),this}}class Sd extends Xd{constructor(a=0){super(ub.unit32,a)}}function Td(a,b){return a[b+3]<<24|a[b+0]<<16|a[b+1]<<8|a[b+2]}function Ud(a,b){b.width!==a.width&&(b.width=a.width),b.height!==a.height&&(b.height=a.height);let c=b.getContext("2d");return c.drawImage(a.texture.image,a.x,a.y,a.width,a.height),b}function cd(a,b,c={},d){let f;if(typeof a==="string"){const m=E.get();f=m.get(a).getFrame(b)}else a instanceof Oa?f=a:a instanceof I&&(f=a.frame);c instanceof tb&&(d=c,c={});const g=Ud(f,P(1,1).canvas),{x:h=0,y:i=0,width:j=g.width-h,height:k=g.height-i}=c;return d=Rd(g,h,i,j,k,Sd,Td,void 0,d),g.width=1,g.height=1,d}class _d extends ad{constructor(){super();bd("mushroom","../assets/mushroom.png").load().then(()=>{this.create()})}create(){const a=4;yb("dot",{width:a,height:a,fillStyle:"white"});const b=new xb(this),c=new I(0,0,"mushroom"),d=new zb(c.width*c.height,"dot"),f=(800-c.width*a)/2,g=(600-c.height*a)/2;cd(c).forEachNonZero(function(h,i,j){d.add({x:f+i*a,y:g+j*a,tint:h})}),ra(b,d),c.setOrigin(0),ra(b,c)}}new $c(wb(),Xa(800,600),Va("game"),vb(2960685),Wa(_d));})();
/**
 * @author       Niklas von Hertzen (https://github.com/niklasvh/base64-arraybuffer)
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2020 Photon Storm Ltd.
 * @license      {@link https://opensource.org/licenses/MIT|MIT License}
 */
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2020 Photon Storm Ltd.
 * @license      {@link https://opensource.org/licenses/MIT|MIT License}
 */

(()=>{let Ib,Jb=0,Kb=0;const w={get:()=>Ib,set:a=>{Ib=a},getFrame:()=>Jb,setFrame:a=>{Jb=a},getElapsed:()=>Kb,setElapsed:a=>{Kb=a}};let Ob=0;function Na(a=0){return()=>{Ob=a}}function na(){return Ob}let Za="Phaser",Mc="https://phaser4.io",Nc="#fff",Oc="linear-gradient(#3e0081 40%, #00bcc3)";function Wa(){if(Za!==""){const a=w.get(),b=Za==="Phaser"?" v"+a.VERSION:"";console.log(`%c${Za}${b}%c ${Mc}`,`padding: 4px 16px; color: ${Nc}; background: ${Oc}`,"")}}let Tb=800,Ub=600,Vb=1;function Qa(a=800,b=600,c=1){return c===0&&(c=window.devicePixelRatio),()=>{Tb=a,Ub=b,Vb=c}}function D(){return Tb}function E(){return Ub}function F(){return Vb}const ob=[],V={add:a=>{ob.push(a)},get:()=>ob,clear:()=>{ob.length=0}};let Sb;function oa(a){Sb=a}function Xa(){return Sb}let _a=.5,$a=.5;let Pb=0;function ab(a){Pb=a}function $(){return Pb}function pa(a){let b;return a&&(typeof a==="string"?b=document.getElementById(a):typeof a==="object"&&a.nodeType===1&&(b=a)),b||(b=document.body),b}let Qb;function Oa(a){return()=>{a&&(Qb=pa(a))}}function Ya(){return Qb}let Rb=[];function Pa(a){return()=>{Rb=[].concat(a)}}function bb(){return Rb}let Qc={alpha:!1,antialias:!1,depth:!1,premultipliedAlpha:!1};function cb(){return Qc}class kc{constructor(a){this.stack=[],this.current=null,this.renderer=a}reset(){this.stack=[],this.current=null;const a=this.renderer,b=a.gl;b.bindFramebuffer(b.FRAMEBUFFER,null),b.viewport(0,0,a.width,a.height)}add(a,b=!0,c=0,d=0){this.stack.push({framebuffer:a,width:c,height:d}),this.set(a,b,c,d)}set(a,b=!0,c=0,d=0){const e=this.renderer,f=e.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),b&&(f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),c>0&&f.viewport(0,0,c,d),this.current=a}pop(){this.stack.pop();const a=this.stack.length;if(a>0){const b=this.stack[a-1];this.set(b.framebuffer,!1,b.width,b.height)}else this.reset()}rebind(){const a=this.renderer.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.current)}destroy(){this.stack=[]}}let jc;const u={get:()=>jc,set:a=>{jc=a}};function lc(a,b=[]){const c=a>>16&255,d=a>>8&255,e=a&255,f=a>16777215?a>>>24:255;return b[0]=c/255,b[1]=d/255,b[2]=e/255,b[3]=f/255,b}function gc(a,b){return a.a===b.a&&a.b===b.b&&a.c===b.c&&a.d===b.d&&a.tx===b.tx&&a.ty===b.ty}function Ba(a,b){const c=u.get();b||(b=c.COLOR_ATTACHMENT0);const d=c.createFramebuffer();return c.bindFramebuffer(c.FRAMEBUFFER,d),c.framebufferTexture2D(c.FRAMEBUFFER,b,c.TEXTURE_2D,a,0),c.bindFramebuffer(c.FRAMEBUFFER,null),d}function Ha(a){const b=u.get();if(!b)return;const{parent:c,flipY:d,unpackPremultiplyAlpha:e,minFilter:f,magFilter:g,wrapS:h,wrapT:j,generateMipmap:i,isPOT:k}=a,m=c.image;let p=c.width,l=c.height;const n=b.createTexture();return b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,n),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,d),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),m?(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,m),p=m.width,l=m.height):b.texImage2D(b.TEXTURE_2D,0,b.RGBA,p,l,0,b.RGBA,b.UNSIGNED_BYTE,null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,g),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,h),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,j),i&&k&&b.generateMipmap(b.TEXTURE_2D),a.texture=n,n}function M(a){const b=u.get();b&&b.isFramebuffer(a)&&b.deleteFramebuffer(a)}function pb(a){const b=u.get();if(!b)return;b.isTexture(a)&&b.deleteTexture(a)}function hc(a,b){return a<1||b<1?!1:(a&a-1)===0&&(b&b-1)===0}function uc(a,b=!0){const c=u.get();c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,a);const d=b?c.LINEAR:c.NEAREST;c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,d),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,d)}function vc(a){const b=u.get(),c=a.parent.image,d=c.width,e=c.height;return d>0&&e>0&&(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,a.texture),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,a.flipY),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,c)),a.texture}class U{constructor(a,b={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1;const c=u.get();this.parent=a,this.isPOT=hc(a.width,a.height);const{texture:d=null,framebuffer:e=null,unpackPremultiplyAlpha:f=!0,minFilter:g=c.LINEAR,magFilter:h=c.LINEAR,wrapS:j=c.CLAMP_TO_EDGE,wrapT:i=c.CLAMP_TO_EDGE,generateMipmap:k=this.isPOT,flipY:m=!1}=b;this.minFilter=g,this.magFilter=h,this.wrapS=j,this.wrapT=i,this.generateMipmap=k,this.flipY=m,this.unpackPremultiplyAlpha=f,e&&(this.framebuffer=e),d?this.texture=d:Ha(this)}setFilter(a){this.texture&&uc(this.texture,a)}create(){const a=this.texture;return a&&pb(a),Ha(this)}update(){const a=this.texture;return a?vc(this):Ha(this)}setIndex(a){this.dirtyIndex=a!==this.index,this.index=a}destroy(){pb(this.texture),M(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}}class rc{constructor(a,b,c,d,e){this.batchSize=a,this.dataSize=b,this.indexSize=c,this.vertexElementSize=d,this.quadIndexSize=e,this.vertexByteSize=d*b,this.quadByteSize=this.vertexByteSize*4,this.quadElementSize=d*4,this.bufferByteSize=a*this.quadByteSize,this.create()}create(){let a=[];for(let c=0;c<this.batchSize*this.indexSize;c+=this.indexSize)a.push(c+0,c+1,c+2,c+2,c+3,c+0);this.data=new ArrayBuffer(this.bufferByteSize),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const b=u.get();this.vertexBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.data,b.DYNAMIC_DRAW),this.indexBuffer=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.index,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,null),a=[]}destroy(){}}class qb{constructor(a,b,c,d,e,f){this.trimmed=!1,this.texture=a,this.key=b,this.x=c,this.y=d,this.width=e,this.height=f,this.sourceSizeWidth=e,this.sourceSizeHeight=f,this.updateUVs()}setPivot(a,b){this.pivot={x:a,y:b}}setSize(a,b){this.width=a,this.height=b,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.updateUVs()}setSourceSize(a,b){this.sourceSizeWidth=a,this.sourceSizeHeight=b}setTrim(a,b,c,d,e,f){this.trimmed=!0,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.spriteSourceSizeX=c,this.spriteSourceSizeY=d,this.spriteSourceSizeWidth=e,this.spriteSourceSizeHeight=f}getExtent(a,b){const c=this.sourceSizeWidth,d=this.sourceSizeHeight;let e,f,g,h;return this.trimmed?(e=this.spriteSourceSizeX-a*c,f=e+this.spriteSourceSizeWidth,g=this.spriteSourceSizeY-b*d,h=g+this.spriteSourceSizeHeight):(e=-a*c,f=e+c,g=-b*d,h=g+d),{left:e,right:f,top:g,bottom:h}}setExtent(a){const b=a.transform,c=b.origin.x,d=b.origin.y,e=this.sourceSizeWidth,f=this.sourceSizeHeight;let g,h,j,i;this.trimmed?(g=this.spriteSourceSizeX-c*e,h=this.spriteSourceSizeY-d*f,j=this.spriteSourceSizeWidth,i=this.spriteSourceSizeHeight):(g=-c*e,h=-d*f,j=e,i=f),b.setExtent(g,h,j,i)}updateUVs(){const{x:a,y:b,width:c,height:d}=this,e=this.texture.width,f=this.texture.height;this.u0=a/e,this.v0=b/f,this.u1=(a+c)/e,this.v1=(b+d)/f}}class x{constructor(a,b,c){this.key="",a&&(b=a.width,c=a.height),this.image=a,this.width=b,this.height=c,this.frames=new Map(),this.data={},this.addFrame("__BASE",0,0,b,c),V.add(this)}addFrame(a,b,c,d,e){if(this.frames.has(a))return null;const f=new qb(this,a,b,c,d,e);return this.frames.set(a,f),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=f),f}getFrame(a){if(!a)return this.firstFrame;a instanceof qb&&(a=a.key);let b=this.frames.get(a);return b||(console.warn(`Frame missing: ${a}`),b=this.firstFrame),b}setSize(a,b){this.width=a,this.height=b;const c=this.frames.get("__BASE");c.setSize(a,b)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}}let qc;const fa={get:()=>qc,set:a=>{qc=a}};const tc={fragmentShader:`\r
#define SHADER_NAME SINGLE_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture;\r
\r
void main (void)\r
{\r
    vec4 color = texture2D(uTexture, vTextureCoord);\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`,vertexShader:`\r
#define SHADER_NAME SINGLE_QUAD_VERT\r
\r
precision highp float;\r
\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
attribute float aTextureId;\r
attribute vec4 aTintColor;\r
\r
uniform mat4 uProjectionMatrix;\r
uniform mat4 uCameraMatrix;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
void main (void)\r
{\r
    vTextureCoord = aTextureCoord;\r
    vTextureId = aTextureId;\r
    vTintColor = aTintColor;\r
\r
    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\r
}`};class Ga{constructor(a={}){this.attribs={aVertexPosition:0,aTextureCoord:0,aTextureId:0,aTintColor:0},this.uniforms={uProjectionMatrix:0,uCameraMatrix:0,uTexture:0,uTime:0,uResolution:0},this.renderToFBO=!1,this.renderer=fa.get();const{batchSize:b=4096,dataSize:c=4,indexSize:d=4,vertexElementSize:e=6,quadIndexSize:f=6,fragmentShader:g=tc.fragmentShader,vertexShader:h=tc.vertexShader,width:j=D(),height:i=E(),resolution:k=F(),renderToFBO:m=!1}=a;this.buffer=new rc(b,c,d,e,f),this.createShaders(g,h),this.count=0,this.renderToFBO=m;const p=new x(null,j*k,i*k),l=new U(p);p.binding=l,l.framebuffer=Ba(l.texture),this.texture=p,this.framebuffer=l.framebuffer}createShaders(a,b){const c=this.renderer.gl,d=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(d,a),c.compileShader(d);let e=!1,f=c.getShaderInfoLog(d);f.length>0&&(e=!0,console.error(f));const g=c.createShader(c.VERTEX_SHADER);c.shaderSource(g,b),c.compileShader(g),f=c.getShaderInfoLog(d),f.length>0&&(e=!0,console.error(f));if(e)return;const h=c.createProgram();c.attachShader(h,g),c.attachShader(h,d),c.linkProgram(h),c.useProgram(h),this.program=h;for(const j of Object.keys(this.attribs)){const i=c.getAttribLocation(h,j);c.enableVertexAttribArray(i),this.attribs[j]=i}for(const j of Object.keys(this.uniforms))this.uniforms[j]=c.getUniformLocation(h,j)}bind(a,b,c){if(!this.program)return!1;const d=this.renderer,e=d.gl,f=this.uniforms;return e.useProgram(this.program),e.uniformMatrix4fv(f.uProjectionMatrix,!1,a),e.uniformMatrix4fv(f.uCameraMatrix,!1,b),e.uniform1i(f.uTexture,d.textures.textureIndex[c]),e.uniform1f(f.uTime,performance.now()),e.uniform2f(f.uResolution,d.width,d.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}bindBuffers(a,b){const c=this.renderer.gl,d=this.buffer.vertexByteSize,e=this.attribs;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a),c.bindBuffer(c.ARRAY_BUFFER,b),c.vertexAttribPointer(e.aVertexPosition,2,c.FLOAT,!1,d,0),c.vertexAttribPointer(e.aTextureCoord,2,c.FLOAT,!1,d,8),c.vertexAttribPointer(e.aTextureId,1,c.FLOAT,!1,d,16),c.vertexAttribPointer(e.aTintColor,4,c.UNSIGNED_BYTE,!0,d,20),this.count=0}draw(a){const b=this.renderer,c=b.gl,d=this.buffer;if(a===d.batchSize)c.bufferData(c.ARRAY_BUFFER,d.data,c.DYNAMIC_DRAW);else{const e=d.vertexViewF32.subarray(0,a*d.quadElementSize);c.bufferSubData(c.ARRAY_BUFFER,0,e)}this.renderToFBO&&b.fbo.add(this.framebuffer,!0),c.drawElements(c.TRIANGLES,a*d.quadIndexSize,c.UNSIGNED_SHORT,0),this.renderToFBO&&b.fbo.pop()}flush(){const a=this.count;return a===0?!1:(this.draw(a),this.prevCount=a,this.count=0,!0)}}const Zc=`\r
#define SHADER_NAME MULTI_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture[%count%];\r
\r
void main (void)\r
{\r
    vec4 color;\r
\r
    %forloop%\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`;class mc extends Ga{constructor(a={fragmentShader:Zc}){super(a)}createShaders(a,b){const c=$();let d="";for(let e=1;e<c;e++)e>1&&(d+=`
	else `),e<c-1&&(d+=`if (vTextureId < ${e}.5)`),d+=`
	{`,d+=`
		color = texture2D(uTexture[${e}], vTextureCoord);`,d+=`
	}`;a=a.replace(/%count%/gi,`${c}`),a=a.replace(/%forloop%/gi,d),super.createShaders(a,b)}bind(a,b){if(!this.program)return!1;const c=this.renderer,d=c.gl,e=this.uniforms;return d.useProgram(this.program),d.uniformMatrix4fv(e.uProjectionMatrix,!1,a),d.uniformMatrix4fv(e.uCameraMatrix,!1,b),d.uniform1iv(e.uTexture,c.textures.textureIndex),d.uniform1f(e.uTime,performance.now()),d.uniform2f(e.uResolution,c.width,c.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}}function nc(a,b,c=-1,d=1){const e=-2*(1/-a),f=-2*(1/b),g=2*(1/(c-d));return new Float32Array([e,0,0,0,0,f,0,0,0,0,g,0,-1,1,0,1])}class oc{constructor(a,b){this.renderer=a;const c={shader:new b()};this.stack=[c],this.currentEntry=c,this.current=c.shader,this.singleQuadShader=new Ga()}add(a,b){const c={shader:a,textureID:b};return this.stack.push(c),c}set(a,b){this.flush();const c=this.renderer,d=c.projectionMatrix,e=c.currentCamera.matrix,f=a.bind(d,e,b);if(f){const g=this.add(a,b);this.currentEntry=g,this.current=a}return f}setDefault(a){this.set(this.singleQuadShader,a)}pop(){this.flush();const a=this.stack;a.length>1&&a.pop(),this.currentEntry=a[a.length-1],this.current=this.currentEntry.shader}reset(){this.pop(),this.rebind()}flush(){return this.current.flush()?(this.renderer.flushTotal++,!0):!1}rebind(){const a=this.renderer,b=a.projectionMatrix,c=a.currentCamera.matrix,d=this.currentEntry;d.shader.bind(b,c,d.textureID)}popAndRebind(){this.pop(),this.rebind()}clear(){}destroy(){}}const Xc=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Yc(a){let b="";for(let c=0;c<a;++c)c>0&&(b+=`
else `),c<a-1&&(b+=`if(test == ${c}.0){}`);return b}function sc(a,b){const c=b.createShader(b.FRAGMENT_SHADER);for(;;){const d=Xc.replace(/%forloop%/gi,Yc(a));b.shaderSource(c,d),b.compileShader(c);if(!b.getShaderParameter(c,b.COMPILE_STATUS))a=a/2|0;else break}return a}class pc{constructor(a){this.startActiveTexture=0,this.renderer=a,this.tempTextures=[],this.textureIndex=[]}init(){const a=this.renderer.gl;let b=sc(a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),a);const c=$();c===0||c>0&&c>b?ab(b):c>0&&c<b&&(b=Math.max(8,c));const d=this.tempTextures;d.length&&d.forEach(f=>{a.deleteTexture(f)});const e=[];for(let f=0;f<b;f++){const g=a.createTexture();a.activeTexture(a.TEXTURE0+f),a.bindTexture(a.TEXTURE_2D,g),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),d[f]=g,e.push(f)}this.maxTextures=b,this.textureIndex=e,this.currentActiveTexture=1}update(){const a=V.get();for(let b=0;b<a.length;b++){const c=a[b];c.binding||(c.binding=new U(c))}V.clear()}reset(){const a=this.renderer.gl,b=this.tempTextures;for(let c=0;c<b.length;c++)a.activeTexture(a.TEXTURE0+c),a.bindTexture(a.TEXTURE_2D,b[c]);this.currentActiveTexture=1,this.startActiveTexture++}bind(a,b=0){const c=this.renderer.gl,d=a.binding;d.setIndex(b),c.activeTexture(c.TEXTURE0+b),c.bindTexture(c.TEXTURE_2D,d.texture)}unbind(a=0){const b=this.renderer.gl;b.activeTexture(b.TEXTURE0+a),b.bindTexture(b.TEXTURE_2D,this.tempTextures[a]),a>0&&this.startActiveTexture++}request(a){const b=this.renderer.gl,c=a.binding,d=this.currentActiveTexture;return c.indexCounter>=this.startActiveTexture?!1:(c.indexCounter=this.startActiveTexture,d<this.maxTextures?(c.setIndex(d),b.activeTexture(b.TEXTURE0+d),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture++):(this.renderer.flush(),this.startActiveTexture++,c.indexCounter=this.startActiveTexture,c.setIndex(1),b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture=2),!0)}}class Wb{constructor(){this.clearColor=[0,0,0,1],this.flushTotal=0,this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.currentCamera=null,this.width=D(),this.height=E(),this.resolution=F(),this.setBackgroundColor(na());const a=document.createElement("canvas");a.addEventListener("webglcontextlost",b=>this.onContextLost(b),!1),a.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=a,this.fbo=new kc(this),this.textures=new pc(this),this.initContext(),fa.set(this),this.shaders=new oc(this,mc)}initContext(){const a=this.canvas.getContext("webgl",cb());u.set(a),this.gl=a,a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE),this.resize(this.width,this.height,this.resolution),this.textures.init()}resize(a,b,c=1){this.width=a*c,this.height=b*c,this.resolution=c;const d=this.canvas;d.width=this.width,d.height=this.height,this.autoResize&&(d.style.width=(this.width/c).toString()+"px",d.style.height=(this.height/c).toString()+"px"),this.gl.viewport(0,0,this.width,this.height),this.projectionMatrix=nc(a,b)}onContextLost(a){a.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(a){return lc(a,this.clearColor),this}reset(a=null,b=this.width,c=this.height){const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),d.viewport(0,0,b,c),d.enable(d.BLEND),d.blendFunc(d.ONE,d.ONE_MINUS_SRC_ALPHA),this.flushTotal=0,this.currentCamera=null,this.textures.update()}render(a){if(this.contextLost)return;this.reset();if(this.optimizeRedraw&&a.numDirtyFrames===0&&a.numDirtyCameras===0)return;const b=this.gl;if(this.clearBeforeRender){const d=this.clearColor;b.clearColor(d[0],d[1],d[2],d[3]),b.clear(b.COLOR_BUFFER_BIT)}const c=a.worldData;for(let d=0;d<c.length;d++){const{camera:e,renderList:f}=c[d];(!this.currentCamera||!gc(e.worldTransform,this.currentCamera.worldTransform))&&(this.flush(),this.currentCamera=e,this.shaders.rebind()),f.forEach(g=>{g.children.length?this.renderNode(g):g.node.renderGL(this)})}this.flush()}renderNode(a){a.node.renderGL(this),a.children.forEach(b=>{b.children.length>0?this.renderNode(b):b.node.renderGL(this)}),a.node.postRenderGL(this)}flush(){this.shaders.flush()}destroy(){fa.set(void 0)}}function Ra(){return()=>{oa(Wb)}}function v(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);for(const e of d)e.callback.apply(e.context,c),e.once&&d.delete(e);return d.size===0&&a.events.delete(b),!0}function Db(a,b){const c=pa(b);return c.appendChild(a),a}function Eb(a){const b=document.readyState;if(b==="complete"||b==="interactive"){a();return}const c=()=>{document.removeEventListener("deviceready",c,!0),document.removeEventListener("DOMContentLoaded",c,!0),window.removeEventListener("load",c,!0),a()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",c,!0):(document.addEventListener("DOMContentLoaded",c,!0),window.addEventListener("load",c,!0)):window.setTimeout(c,20)}class Fb{constructor(){this.events=new Map()}}class ra{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function S(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new ra(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function ta(a,b,c,d=a){return S(a,b,c,d,!0)}function wc(){return{gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]}}function zc(a,b=0){a.gameFrame=b,a.numTotalFrames=0,a.numDirtyFrames=0,a.numDirtyCameras=0,a.worldData.length=0}let Ac;const Ia={get:()=>Ac,set:a=>{Ac=a}};class Gb{constructor(){this.scenes=new Map(),this.sceneIndex=0,this.flush=!1,this.renderResult=wc(),this.game=w.get(),Ia.set(this),ta(this.game,"boot",()=>this.boot())}boot(){bb().forEach(a=>new a())}update(a,b){for(const c of this.scenes.values())v(c,"update",a,b)}render(a){const b=this.renderResult;zc(b,a);for(const c of this.scenes.values())v(c,"render",b);return this.flush&&(b.numDirtyFrames++,this.flush=!1),b}}function ga(a,b){const c=document.createElement("canvas");return c.width=a,c.height=b,c.getContext("2d")}let Bc;const G={get:()=>Bc,set:a=>{Bc=a}};class Hb{constructor(){this.textures=new Map(),this.createDefaultTextures(),G.set(this)}createDefaultTextures(){this.add("__BLANK",new x(ga(32,32).canvas));const a=ga(32,32);a.strokeStyle="#0f0",a.moveTo(0,0),a.lineTo(32,32),a.stroke(),a.strokeRect(.5,.5,31,31),this.add("__MISSING",new x(a.canvas))}get(a){const b=this.textures;return b.has(a)?b.get(a):b.get("__MISSING")}has(a){return this.textures.has(a)}add(a,b){let c;const d=this.textures;return d.has(a)||(b instanceof x?c=b:c=new x(b),c.key=a,d.set(a,c)),c}}class Ab extends Fb{constructor(...a){super();this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,w.set(this),Eb(()=>this.boot(a))}boot(a){a.forEach(d=>d());const b=Xa();this.renderer=new b(),this.textureManager=new Hb(),this.sceneManager=new Gb();const c=Ya();c&&Db(this.renderer.canvas,c),this.isBooted=!0,Wa(),v(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(a){const b=a-this.lastTick;this.lastTick=a,this.elapsed+=b,this.isPaused||(this.willUpdate&&(this.sceneManager.update(b,a),v(this,"update",b,a)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,w.setFrame(this.frame),w.setElapsed(this.elapsed),requestAnimationFrame(c=>this.step(c))}destroy(){}}function xc(a,b,c){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:c}function yc(a,b={}){const c=Ia.get(),d=c.scenes.size,e=c.sceneIndex,f=d===0;typeof b==="string"?a.key=b:(b||!b&&f)&&(a.key=xc(b,"key","scene"+e.toString())),c.scenes.has(a.key)?console.warn("Scene key already in use: "+a.key):(c.scenes.set(a.key,a),c.flush=!0,c.sceneIndex++)}class Bb{constructor(a){this.game=w.get(),this.events=new Map(),yc(this,a)}}function K(a){const b=[a],c=[];for(;b.length>0;){const d=b.shift();c.push(d);const e=d.numChildren;if(e>0)for(let f=e-1;f>=0;f--)b.unshift(d.children[f])}return c.shift(),c}function B(a,b){return a.children.indexOf(b)}function qa(a,b){const c=a.children;let d;if(b>=0&&b<c.length){const e=c.splice(b,1);e[0]&&(d=e[0],d.parent=null)}return d}function ba(a,b){const c=B(a,b);return c>-1&&qa(a,c),b}const hb="addedtoworld";const ib="removedfromworld";function gb(a,...b){return b.forEach(c=>{c.world&&(v(c.world,ib,c,c.world),v(c,ib,c,c.world)),c.world=a,v(a,hb,c,a),v(c,hb,c,a)}),b}function J(a,...b){b.forEach(d=>{d.parent&&ba(d.parent,d),d.parent=a});const c=a.world;return c&&gb(c,...K(a)),b}function _(a,b){return a.children.push(b),J(a,b),b.transform.updateWorld(),b}const o={CLEAR:0,TRANSFORM:1,UPDATE:2,CHILD_CACHE:4,POST_RENDER:8,COLORS:16,BOUNDS:32,TEXTURE:64,FRAME:128,ALPHA:256,CHILD:512,DEFAULT:1+2+16+32,USER1:536870912,USER2:1073741824,USER3:2147483648,USER4:4294967296};function aa(a,b=0,c){const d=a.children;c===void 0&&(c=d.length);const e=c-b;if(e>0&&e<=c){const f=d.splice(b,e);return f.forEach(g=>{g.parent=null}),f}else return[]}function db(a,b=0,c){const d=aa(a,b,c);d.forEach(e=>{e.destroy()})}function eb(a,...b){return b.forEach(c=>{ba(a,c)}),b}function fb(a,b,c=0,d){const e=aa(a,c,d);return J(b,...e),e.forEach(f=>{f.transform.updateWorld()}),e}class I{constructor(a=1,b=0,c=0,d=1,e=0,f=0){this.set(a,b,c,d,e,f)}set(a=1,b=0,c=0,d=1,e=0,f=0){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=e,this.ty=f,this}identity(){return this.set()}toArray(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]}fromArray(a){return this.set(a[0],a[1],a[2],a[3],a[4],a[5])}}function ec(a,b,c){return a.width<=0||a.height<=0?!1:a.x<=b&&a.x+a.width>=b&&a.y<=c&&a.y+a.height>=c}class C{constructor(a=0,b=0,c=0,d=0){this.set(a,b,c,d)}set(a=0,b=0,c=0,d=0){return this.x=a,this.y=b,this.width=c,this.height=d,this}contains(a,b){return ec(this,a,b)}set right(a){a<=this.x?this.width=0:this.width=a-this.x}get right(){return this.x+this.width}set bottom(a){a<=this.y?this.height=0:this.height=a-this.y}get bottom(){return this.y+this.height}}function ic(){}class A{constructor(a,b=0,c=0,d=!1){this.compareValue=!1,this._x=b,this._y=c,this.callback=a,this.compareValue=d}set(a=0,b=0){return this._x=a,this._y=b,this.callback(this),this}destroy(){this.callback=ic}set x(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._x=a,this.callback(this))}get x(){return this._x}set y(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._y=a,this.callback(this))}get y(){return this._y}}function fc(a,b,c){const d=c-b;return b+((a-b)%d+d)%d}function Lb(a){return fc(a,-Math.PI,Math.PI)}class Mb{constructor(){this._rotation=0,this.type="Camera",this.dirtyRender=!0;const a=w.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1]),this.bounds=new C(),this.worldTransform=new I(),this.position=new A(()=>this.updateTransform(),0,0),this.scale=new A(()=>this.updateTransform(),1,1),this.origin=new A(()=>this.updateTransform(),.5,.5),this.reset()}updateTransform(){const a=this.matrix,b=this.position.x,c=this.position.y,d=this.scale.x,e=this.scale.y,f=-b+this.width*this.origin.x,g=-c+this.height*this.origin.y,h=Math.sin(this.rotation),j=Math.cos(this.rotation),i=h+h,k=h*i,m=j*i,p=(1-k)*d,l=m*d,n=-m*e,q=(1-k)*e;a[0]=p,a[1]=l,a[4]=n,a[5]=q,a[12]=b+f-(p*f+n*g),a[13]=c+g-(l*f+q*g),this.worldTransform.set(j*d,h*d,-h*e,j*e,-b,-c);const r=this.width*(1/d),t=this.height*(1/e);this.bounds.set(f-r/2,g-t/2,r,t),this.dirtyRender=!0}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}set rotation(a){a!==this._rotation&&(this._rotation=Lb(a),this.updateTransform())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.origin.destroy(),this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}class Nb{constructor(){this.type="StaticCamera",this.dirtyRender=!0;const a=w.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.bounds=new C(),this.worldTransform=new I(),this.reset()}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}const ua="destroy";const Xb="postupdate";const Yb="update";function sa(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof ra)g.delete(c);else{const h=!d,j=e!==void 0;for(const i of g)i.callback===c&&(h&&i.context===d)&&(j&&i.once===e)&&g.delete(i)}return g.size===0&&f.delete(b),a}function T(a){const{a:b,b:c,c:d,d:e,tx:f,ty:g}=a.world,{x:h,y:j,right:i,bottom:k}=a.extent,m=h*b+j*d+f,p=h*c+j*e+g,l=h*b+k*d+f,n=h*c+k*e+g,q=i*b+k*d+f,r=i*c+k*e+g,t=i*b+j*d+f,y=i*c+j*e+g;return{x0:m,y0:p,x1:l,y1:n,x2:q,y2:r,x3:t,y3:y}}class va{constructor(a){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=a,this.area=new C()}set(a,b,c,d){this.area.set(a,b,c,d)}get(){return this.entity.isDirty(o.BOUNDS)&&!this.fixed&&this.update(),this.area}updateLocal(){const{x0:a,y0:b,x1:c,y1:d,x2:e,y2:f,x3:g,y3:h}=T(this.entity.transform),j=Math.min(a,c,e,g),i=Math.min(b,d,f,h),k=Math.max(a,c,e,g),m=Math.max(b,d,f,h);return this.area.set(j,i,k-j,m-i)}update(){const a=this.updateLocal();this.entity.clearDirty(o.BOUNDS);if(!this.includeChildren||!this.entity.numChildren)return a;const b=this.visibleOnly,c=this.entity.children;let d=a.x,e=a.y,f=a.right,g=a.bottom;for(let h=0;h<c.length;h++){const j=c[h];if(!j||b&&!j.visible)continue;const i=j.bounds.get();i.x<d&&(d=i.x),i.y<e&&(e=i.y),i.right>f&&(f=i.right),i.bottom>g&&(g=i.bottom)}return a.set(d,e,f-d,g-e)}destroy(){this.entity=null,this.area=null}}class wa{constructor(a){this.enabled=!1,this.enabledChildren=!0,this.entity=a}destroy(){this.entity=null,this.hitArea=null}}class kb{constructor(a=0,b=0){this.set(a,b)}set(a=0,b=0){return this.x=a,this.y=b,this}getArray(){return[this.x,this.y]}fromArray(a){return this.set(a[0],a[1])}toString(){return`[x=${this.x}, y=${this.y}]`}}function ya(a){const b=a.local,c=a.position.x,d=a.position.y,e=a.rotation,f=a.scale.x,g=a.scale.y,h=a.skew.x,j=a.skew.y;b.set(Math.cos(e+j)*f,Math.sin(e+j)*f,-Math.sin(e-h)*g,Math.cos(e-h)*g,c,d)}function lb(a,b){return b.set(a.a,a.b,a.c,a.d,a.tx,a.ty)}function za(a){const b=a.parent,c=a.transform,d=c.local,e=c.world;if(!b)lb(d,e);else if(c.passthru)lb(b.transform.world,e);else{const{a:f,b:g,c:h,d:j,tx:i,ty:k}=d,{a:m,b:p,c:l,d:n,tx:q,ty:r}=b.transform.world;e.set(f*m+g*l,f*p+g*n,h*m+j*l,h*p+j*n,i*m+k*l+q,i*p+k*n+r)}}class xa{constructor(a,b=0,c=0){this.passthru=!1,this._rotation=0,this.entity=a,this.local=new I(),this.world=new I(),this.position=new A(()=>this.update(),b,c),this.scale=new A(()=>this.update(),1,1,!0),this.skew=new A(()=>this.update(),0,0,!0),this.origin=new A(()=>this.updateExtent(),_a,$a),this.extent=new C()}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(o.TRANSFORM,o.BOUNDS),ya(this)}updateWorld(){const a=this.entity;a.setDirty(o.TRANSFORM,o.BOUNDS),za(a),a.numChildren&&this.updateChildren()}updateChildren(){const a=this.entity.children;for(let b=0;b<a.length;b++){const c=a[b];c.transform.updateWorld()}}globalToLocal(a,b,c=new kb()){const{a:d,b:e,c:f,d:g,tx:h,ty:j}=this.world,i=1/(d*g+f*-e);return c.x=g*i*a+-f*i*b+(j*f-h*g)*i,c.y=d*i*b+-e*i*a+(-j*d+h*e)*i,c}localToGlobal(a,b,c=new kb()){const{a:d,b:e,c:f,d:g,tx:h,ty:j}=this.world;return c.x=d*a+f*b+h,c.y=e*a+g*b+j,c}setExtent(a,b,c,d){this.extent.set(a,b,c,d),this.entity.setDirty(o.TRANSFORM,o.BOUNDS)}updateExtent(a,b){const c=this.extent,d=this.entity;a!==void 0&&(c.width=a),b!==void 0&&(c.height=b),c.x=-this.origin.x*c.width,c.y=-this.origin.y*c.height,d.setDirty(o.TRANSFORM,o.BOUNDS)}set rotation(a){a!==this._rotation&&(this._rotation=a,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}}class L{constructor(a=0,b=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.events=new Map(),this.transform=new xa(this,a,b),this.bounds=new va(this),this.input=new wa(this),this.dirty=o.DEFAULT,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(a){return(this.dirty&a)!==0}clearDirty(a){return this.isDirty(a)&&(this.dirty^=a),this}setDirty(a,b){return this.isDirty(a)||(this.dirty^=a,this.dirtyFrame=w.getFrame()),this.isDirty(b)||(this.dirty^=b),this}update(a,b){if(this.willUpdateChildren){const c=this.children;for(let d=0;d<c.length;d++){const e=c[d];e&&e.willUpdate&&e.update(a,b)}}this.postUpdate(a,b)}postUpdate(a,b){}renderGL(a){}renderCanvas(a){}postRenderGL(a){}postRenderCanvas(a){}get numChildren(){return this.children.length}destroy(a){a?fb(this,a):db(this),v(this,ua,this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}}const Ea="worldrender";const Fa="worldshutdown";var Wc=Object.freeze({__proto__:null,WorldRenderEvent:Ea,WorldShutdownEvent:Fa});function Ja(a,b){b.numRendered++,b.numRenderable++,a.node.dirtyFrame>=b.gameFrame&&b.dirtyFrame++,a.children.forEach(c=>{c.children.length>0&&Ja(c,b)})}function ub(a){if(a.node.isDirty(o.CHILD_CACHE))return!0;const b=[a];for(;b.length>0;){const c=b.pop();if(c.node.isDirty(o.TRANSFORM))return!0;const d=c.children.length;if(d>0)for(let e=0;e<d;e++)b.push(c.children[e])}return b.length=0,!1}function tb(a,b){a.forEach(c=>{b||ub(c)?c.node.setDirty(o.CHILD_CACHE):c.children.length=0})}function Ka(a,b,c=[]){for(let d=0;d<b.numChildren;d++){const e=b.children[d];if(e.isRenderable()){const f=[],g={node:e,children:f};c.push(g),e.willRenderChildren&&e.numChildren>0&&(e.willCacheChildren&&a.push(g),Ka(a,e,f))}}return c}function rb(a){const b=[],c=[],d=Ka(b,a,c),e=a.renderData;b.length>0&&tb(b,a.camera.dirtyRender),d.forEach(f=>{f.children.length?Ja(f,e):(e.numRendered++,e.numRenderable++,f.node.dirtyFrame>=e.gameFrame&&e.dirtyFrame++)}),e.renderList=d,a.forceRefresh&&(e.dirtyFrame++,a.forceRefresh=!1)}function sb(a,b){a.numDirtyFrames+=b.dirtyFrame,a.numTotalFrames+=b.numRendered,b.camera.dirtyRender&&a.numDirtyCameras++,a.worldData.push(b)}function ha(a,b){a.gameFrame=b,a.dirtyFrame=0,a.numRendered=0,a.numRenderable=0,a.renderList.length=0}class ia extends L{constructor(a){super();this.forceRefresh=!1,this.type="BaseWorld",this.scene=a,this.world=this,this.events=new Map(),this._updateListener=S(a,"update",(b,c)=>this.update(b,c)),this._renderListener=S(a,"render",b=>this.render(b)),this._shutdownListener=S(a,"shutdown",()=>this.shutdown()),ta(a,"destroy",()=>this.destroy())}update(a,b){if(!this.willUpdate)return;v(this,Yb,a,b,this),super.update(a,b)}postUpdate(a,b){v(this,Xb,a,b,this)}render(a){const b=this.renderData;ha(b,a.gameFrame);if(!this.willRender||!this.visible)return;rb(this),v(this,Ea,b,this),sb(a,b),this.camera&&(this.camera.dirtyRender=!1)}shutdown(){const a=this.scene;sa(a,"update",this._updateListener),sa(a,"render",this._renderListener),sa(a,"shutdown",this._shutdownListener),eb(this),v(this,Fa,this),ha(this.renderData,0),this.camera&&this.camera.reset()}destroy(a){super.destroy(a),v(this,ua,this),ha(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}}function ja(a){return{camera:a,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0,renderList:[]}}class Sa extends ia{constructor(a){super(a);this.type="StaticWorld",this.camera=new Nb(),this.renderData=ja(this.camera)}}class _c extends ia{constructor(a){super(a);this.enableCameraCull=!0,this.type="World",this.camera=new Mb(),this.renderData=ja(this.camera)}}function Da(a=32,b=32){const c=ga(a,b);return new x(c.canvas)}function W(a,b,c,d=1){let e;if(typeof a==="string"){let h=G.get();h.has(a)||h.add(a,Da()),e=h.get(a)}else e=a;let f=e.image,g=f.getContext("2d");return c?b.call(c,f,g):b(f,g),e.setSize(f.width/d,f.height/d),e.binding&&e.binding.update(),e}var la;(function(a){a[a.left=1]="left",a[a.right=2]="right",a[a.both=3]="both"})(la||(la={}));function Jc(a,b=0,c=" ",d=1){a=a.toString();let e=0;if(b+1>=a.length)switch(d){case 1:a=new Array(b+1-a.length).join(c)+a;break;case 3:e=b-a.length;let f=Math.ceil(e/2),g=e-f;a=new Array(g+1).join(c)+a+new Array(f+1).join(c);break;default:a=a+new Array(b+1-a.length).join(c);break}return a}function O(a,b,c){switch(typeof a){case"number":return`#${Jc(Math.floor(a).toString(16),6,"0",la.left)}`;case"function":return a(b,c);default:return a}}function Fc(a,b,c,d,e,f,g,h,j,i,k=!0){b.beginPath(),b.rect(c,d,e,f);if(g!==void 0){if(i!==void 0){let m;k?m=b.createLinearGradient(0,0,e,0):m=b.createLinearGradient(0,0,0,f),m.addColorStop(0,g),m.addColorStop(1,i),g=m}b.fillStyle=g,b.fill()}h!==void 0&&(b.strokeStyle=h,b.lineWidth=j,b.stroke())}function Ta(a,{width:b=32,height:c=b,fillStyle:d,fillColor2:e,isHorizontalGradient:f=!0,strokeStyle:g,lineWidth:h=2}={}){return W(a,function(j,i){j.width=Math.ceil(b),j.height=Math.ceil(c),g||(h=0);const k=h/2,m=k,p=k;b-=h,c-=h,Fc(j,i,m,p,b,c,O(d,j,i),O(g,j,i),h,O(e,j,i),f)})}const cd=Math.PI/180;function ka(a){return a*cd}const gC=ka(0),hC=ka(90),iC=ka(180),jC=ka(270);var Gc;(function(a){a[a.right=0]="right",a[a.down=1]="down",a[a.left=2]="left",a[a.up=3]="up"})(Gc||(Gc={}));function _b(a,b){const c=a.texture,d=b.shaders.current,e=d.buffer,f=c.binding;d.count===e.batchSize&&b.flush();const g=a.vertexData;b.textures.request(c);const h=f.index;g[4]=h,g[10]=h,g[16]=h,g[22]=h;const j=d.count*e.quadElementSize;e.vertexViewF32.set(g,j);const i=a.vertexColor,k=e.vertexViewU32;k[j+5]=i[0],k[j+11]=i[2],k[j+17]=i[3],k[j+23]=i[1],d.count++}var Vc=Object.freeze({__proto__:null,BoundsComponent:va,InputComponent:wa,GetVertices:T,TransformComponent:xa,UpdateLocalTransform:ya,UpdateWorldTransform:za});class mb extends L{constructor(a=0,b=0){super(a,b);this._alpha=1,this.type="Container"}setSize(a,b=a){return this.transform.updateExtent(a,b),this}setPosition(a,b){return this.transform.position.set(a,b),this}setOrigin(a,b=a){return this.transform.origin.set(a,b),this}setSkew(a,b=a){return this.transform.skew.set(a,b),this}setScale(a,b=a){return this.transform.scale.set(a,b),this}setRotation(a){return this.transform.rotation=a,this}set width(a){this.transform.updateExtent(a)}get width(){return this.transform.extent.width}set height(a){this.transform.updateExtent(void 0,a)}get height(){return this.transform.extent.height}set x(a){this.transform.position.x=a}get x(){return this.transform.position.x}set y(a){this.transform.position.y=a}get y(){return this.transform.position.y}set originX(a){this.transform.origin.x=a}get originX(){return this.transform.origin.x}set originY(a){this.transform.origin.y=a}get originY(){return this.transform.origin.y}set skewX(a){this.transform.skew.x=a}get skewX(){return this.transform.skew.x}set skewY(a){this.transform.skew.y=a}get skewY(){return this.transform.skew.y}set scaleX(a){this.transform.scale.x=a}get scaleX(){return this.transform.scale.x}set scaleY(a){this.transform.scale.y=a}get scaleY(){return this.transform.scale.y}set rotation(a){this.transform.rotation=a}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(a){a!==this._alpha&&(this._alpha=a,this.setDirty(o.TRANSFORM))}}function $b(a,b){const c=a.frame;if(!c)return;const d=b.ctx,e=a.transform,{a:f,b:g,c:h,d:j,tx:i,ty:k}=e.world,{x:m,y:p}=e.extent;d.save(),d.setTransform(f,g,h,j,i,k),d.globalAlpha=a.alpha,d.drawImage(c.texture.image,c.x,c.y,c.width,c.height,m,p,c.width,c.height),d.restore()}function N(a,b){const c=(b*255|0)&255;return(c<<24|a)>>>0}function ac(a){const b=a.vertexAlpha,c=a.vertexTint,d=a.vertexColor;return d[0]=N(c[0],b[0]),d[1]=N(c[1],b[1]),d[2]=N(c[2],b[2]),d[3]=N(c[3],b[3]),a}function Ca(a,b,...c){const d=a.getFrame(b),{u0:e,u1:f,v0:g,v1:h,pivot:j}=d;return c.forEach(i=>{if(!i||d===i.frame)return;i.frame=d,j&&i.setOrigin(j.x,j.y),i.frame.setExtent(i),i.hasTexture=!0;const k=i.vertexData;k[2]=e,k[3]=g,k[8]=e,k[9]=h,k[14]=f,k[15]=h,k[20]=f,k[21]=g}),c}function Zb(a,b,...c){if(!a)c.forEach(d=>{d.texture=null,d.frame=null,d.hasTexture=!1});else{let d;a instanceof x?d=a:d=G.get().get(a),d?(c.forEach(e=>{e.texture=d}),Ca(d,b,...c)):console.warn(`Invalid Texture key: ${a}`)}return c}function bc(a){const b=a.vertexData,{x0:c,y0:d,x1:e,y1:f,x2:g,y2:h,x3:j,y3:i}=T(a.transform);return b[0]=c,b[1]=d,b[6]=e,b[7]=f,b[12]=g,b[13]=h,b[18]=j,b[19]=i,a}class ca extends mb{constructor(a,b,c,d){super(a,b);this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertexData=new Float32Array(24).fill(0),this.vertexColor=new Uint32Array(4).fill(4294967295),this.vertexAlpha=new Float32Array(4).fill(1),this.vertexTint=new Uint32Array(4).fill(16777215),this.setTexture(c,d)}setTexture(a,b){return Zb(a,b,this),this}setFrame(a){return Ca(this.texture,a,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}preRender(){this.isDirty(o.COLORS)&&(ac(this),this.clearDirty(o.COLORS)),this.isDirty(o.TRANSFORM)&&(bc(this),this.clearDirty(o.TRANSFORM))}renderGL(a){this.preRender(),_b(this,a)}renderCanvas(a){this.preRender(),$b(this,a)}get alpha(){return this._alpha}set alpha(a){if(a!==this._alpha){this._alpha=a;const b=this.vertexAlpha;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(o.ALPHA)}}get tint(){return this._tint}set tint(a){if(a!==this._tint){this._tint=a;const b=this.vertexTint;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(o.COLORS)}}destroy(a){super.destroy(a),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertexData=null,this.vertexColor=null,this.vertexAlpha=null,this.vertexTint=null}}class Tc extends ca{constructor(a,b,c,d){super(a,b,c,d);this.type="AnimatedSprite",this.anims=new Map(),this.animData={currentAnim:"",currentFrames:[],frameIndex:0,animSpeed:0,nextFrameTime:0,repeatCount:0,isPlaying:!1,yoyo:!1,pendingStart:!1,playingForward:!0,delay:0,repeatDelay:0,onStart:null,onRepeat:null,onComplete:null}}stop(){const a=this.animData;a.isPlaying=!1,a.currentAnim="",a.onComplete&&a.onComplete(this,a.currentAnim)}nextFrame(){const a=this.animData;a.frameIndex++;if(a.frameIndex===a.currentFrames.length)if(a.yoyo)a.frameIndex--,a.playingForward=!1;else if(a.repeatCount===-1||a.repeatCount>0)a.frameIndex=0,a.repeatCount!==-1&&a.repeatCount--,a.onRepeat&&a.onRepeat(this,a.currentAnim),a.nextFrameTime+=a.repeatDelay;else return a.frameIndex--,this.stop();this.setFrame(a.currentFrames[a.frameIndex]),a.nextFrameTime+=a.animSpeed}prevFrame(){const a=this.animData;a.frameIndex--;if(a.frameIndex===-1)if(a.repeatCount===-1||a.repeatCount>0)a.frameIndex=0,a.playingForward=!0,a.repeatCount!==-1&&a.repeatCount--,a.onRepeat&&a.onRepeat(this,a.currentAnim),a.nextFrameTime+=a.repeatDelay;else return a.frameIndex=0,this.stop();this.setFrame(a.currentFrames[a.frameIndex]),a.nextFrameTime+=a.animSpeed}update(a,b){super.update(a,b);const c=this.animData;if(!c.isPlaying)return;c.nextFrameTime-=a*1e3,c.nextFrameTime=Math.max(c.nextFrameTime,0),c.nextFrameTime===0&&(c.pendingStart?(c.onStart&&c.onStart(this,c.currentAnim),c.pendingStart=!1,c.nextFrameTime=c.animSpeed):c.playingForward?this.nextFrame():this.prevFrame())}get isPlaying(){return this.animData.isPlaying}get isPlayingForward(){return this.animData.isPlaying&&this.animData.playingForward}get currentAnimation(){return this.animData.currentAnim}destroy(a){super.destroy(a),this.anims.clear(),this.animData=null}}function jb(a,b,c,d,e,f,g=0,h=1,j=1,i=0,k=0){const m=Math.cos(g+k)*h,p=Math.sin(g+k)*h,l=-Math.sin(g-i)*j,n=Math.cos(g-i)*j,q=a*m+c*l+e,r=a*p+c*n+f,t=a*m+d*l+e,y=a*p+d*n+f,X=b*m+d*l+e,Y=b*p+d*n+f,P=b*m+c*l+e,Q=b*p+c*n+f;return{x0:q,y0:r,x1:t,y1:y,x2:X,y2:Y,x3:P,y3:Q}}function Aa(a,b,c,d,e,f,g,h,j,i=0,k=4294967295){const m=a.shaders.current,p=m.buffer,l=p.vertexViewF32,n=p.vertexViewU32,q=m.count*p.quadElementSize;l[q+0]=b,l[q+1]=c,l[q+2]=f,l[q+3]=j,l[q+4]=i,n[q+5]=k,l[q+6]=b,l[q+7]=c+e,l[q+8]=f,l[q+9]=g,l[q+10]=i,n[q+11]=k,l[q+12]=b+d,l[q+13]=c+e,l[q+14]=h,l[q+15]=g,l[q+16]=i,n[q+17]=k,l[q+18]=b+d,l[q+19]=c,l[q+20]=h,l[q+21]=j,l[q+22]=i,n[q+23]=k,m.count++}function da(a,b,c,d,e,f,g,h,j,i=0,k=4294967295){a.shaders.setDefault(i),Aa(a,b,c,d,e,f,g,h,j,i,k),a.shaders.popAndRebind()}class ea extends L{constructor(){super();this.type="Layer",this.transform.passthru=!0,this.willRender=!1}}class nb extends ea{constructor(){super();this.type="RenderLayer",this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!0,this.setDirty(o.CHILD_CACHE);const a=D(),b=E(),c=F(),d=new x(null,a*c,b*c);d.binding=new U(d),d.binding.framebuffer=Ba(d.binding.texture),this.texture=d,this.framebuffer=d.binding.framebuffer}renderGL(a){this.numChildren>0&&(a.flush(),this.isDirty(o.CHILD_CACHE)?(a.fbo.add(this.framebuffer,!0),this.clearDirty(o.CHILD_CACHE)):(a.fbo.add(this.framebuffer,!1),this.postRenderGL(a)))}postRenderGL(a){const b=this.texture;a.flush(),a.fbo.pop();const{u0:c,v0:d,u1:e,v1:f}=b.firstFrame;a.textures.bind(b),da(a,0,0,b.width,b.height,c,d,e,f),a.textures.unbind(),this.clearDirty(o.TRANSFORM)}}class Uc extends nb{constructor(){super();this.shaders=[],this.type="EffectLayer"}postRenderGL(a){const b=this.shaders,c=this.texture;a.flush(),a.fbo.pop();if(b.length===0){const{u0:d,v0:e,u1:f,v1:g}=c.firstFrame;a.textures.bind(c),da(a,0,0,c.width,c.height,d,e,f,g),a.textures.unbind()}else{let d=c;for(let j=0;j<b.length;j++){const i=b[j],{u0:k,v0:m,u1:p,v1:l}=d.firstFrame;a.shaders.set(i,0)&&(i.renderToFBO=!0,a.textures.bind(d),Aa(a,0,0,d.width,d.height,k,m,p,l),a.shaders.pop(),a.textures.unbind(),d=i.texture)}const{u0:e,v0:f,u1:g,v1:h}=d.firstFrame;a.textures.bind(d),da(a,0,0,d.width,d.height,e,f,g,h),a.textures.unbind()}this.clearDirty(o.TRANSFORM)}}function cc(a,b){const c=a.texture,d=b.shaders.current,e=d.buffer;b.flush(),b.textures.request(c),a.updateTextureIndex();const f=b.gl;d.bindBuffers(a.indexBuffer,a.vertexBuffer),f.bufferData(f.ARRAY_BUFFER,a.data,f.STATIC_DRAW),f.drawElements(f.TRIANGLES,a.count*e.quadIndexSize,f.UNSIGNED_SHORT,0),d.prevCount=a.count,b.flushTotal++,d.bindBuffers(e.indexBuffer,e.vertexBuffer)}function dc(a,b,c){return Math.max(b,Math.min(c,a))}class Va extends ea{constructor(a,b){super();this.glTextureIndex=0,this.hasTexture=!1,this.type="SpriteBatch",this.willRender=!0,this.setTexture(b),this.setMaxSize(a)}resetBuffers(){let a=[];for(let c=0;c<this.maxSize*4;c+=4)a.push(c+0,c+1,c+2,c+2,c+3,c+0);this.data=new ArrayBuffer(this.maxSize*96),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const b=u.get();b&&(M(this.vertexBuffer),M(this.indexBuffer),this.vertexBuffer=b.createBuffer(),this.indexBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.data,b.STATIC_DRAW),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.index,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,null)),a=[],this.count=0}setMaxSize(a){return this.maxSize=dc(a,0,65535),this.resetBuffers(),this}setTexture(a){let b;return a instanceof x?b=a:b=G.get().get(a),b?(this.texture=b,this.hasTexture=!0,this.glTextureIndex=-1):console.warn(`Invalid Texture key: ${a}`),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.count>0}clear(){return this.count=0,this}addToBatch(a,b,c,d,e,f,g,h,j,i){if(this.count>=this.maxSize)return console.warn("SpriteBatch full"),this;const{u0:k,u1:m,v0:p,v1:l}=a,n=this.vertexViewF32,q=this.vertexViewU32,r=this.count*24,t=this.texture.binding?this.texture.binding.index:0;return n[r+0]=c,n[r+1]=d,n[r+2]=k,n[r+3]=p,n[r+4]=t,q[r+5]=b,n[r+6]=e,n[r+7]=f,n[r+8]=k,n[r+9]=l,n[r+10]=t,q[r+11]=b,n[r+12]=g,n[r+13]=h,n[r+14]=m,n[r+15]=l,n[r+16]=t,q[r+17]=b,n[r+18]=j,n[r+19]=i,n[r+20]=m,n[r+21]=p,n[r+22]=t,q[r+23]=b,this.setDirty(o.TRANSFORM),this.count++,this}add(a){const{frame:b=null,x:c=0,y:d=0,rotation:e=0,scaleX:f=1,scaleY:g=1,skewX:h=0,skewY:j=0,originX:i=0,originY:k=0,alpha:m=1,tint:p=16777215}=a,l=this.texture.getFrame(b),{left:n,right:q,top:r,bottom:t}=l.getExtent(i,k),{x0:y,y0:X,x1:Y,y1:P,x2:Q,y2:wb,x3:xb,y3:yb}=jb(n,q,r,t,c,d,e,f,g,h,j),s=N(p,m);return this.addToBatch(l,s,y,X,Y,P,Q,wb,xb,yb)}addXY(a,b,c){const d=this.texture.getFrame(c),{left:e,right:f,top:g,bottom:h}=d.getExtent(0,0),{x0:j,y0:i,x1:k,y1:m,x2:p,y2:l,x3:n,y3:q}=jb(e,f,g,h,a,b);return this.addToBatch(d,4294967295,j,i,k,m,p,l,n,q)}updateTextureIndex(){const a=this.texture.binding.index;if(a===this.glTextureIndex)return;const b=this.vertexViewF32;this.glTextureIndex=a;for(let c=0;c<this.count;c++)b[c*24+4]=a,b[c*24+10]=a,b[c*24+16]=a,b[c*24+22]=a}renderGL(a){cc(this,a)}destroy(){super.destroy(),M(this.vertexBuffer),M(this.indexBuffer),this.data=null,this.vertexViewF32=null,this.vertexViewU32=null,this.index=null,this.texture=null,this.hasTexture=!1}}class Ua extends ca{constructor(a,b,c="",d,e){super(a,b,Da());this.splitRegExp=/(?:\r\n|\r|\n)/,this.padding={left:0,right:0,top:0,bottom:0},this.verticalAlign="ascent",this.lineSpacing=0,this.font="16px monospace",this.fillStyle="#fff",this.strokeStyle="",this.backgroundStyle="",this.cornerRadius=0,this.textAlign="left",this.textBaseline="alphabetic",this.lineWidth=0,this.lineDash=[],this.antialias=!1,this.type="Text";const f=w.get();this.resolution=f.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),d&&(this.font=d),e&&(this.fillStyle=e),this.setText(c)}syncContext(a,b){this.preRenderCallback&&this.preRenderCallback(a,b),b.font=this.font,b.textBaseline=this.textBaseline,b.textAlign=this.textAlign,b.fillStyle=this.fillStyle,b.strokeStyle=this.strokeStyle,b.lineWidth=this.lineWidth,b.lineCap="round",b.lineJoin="round",b.setLineDash(this.lineDash),b.imageSmoothingEnabled=this.antialias}updateText(){const a=this.canvas,b=this.context,c=this.resolution,d=this._text.split(this.splitRegExp),e=this.padding,f=this.fillStyle,g=this.strokeStyle,h=this.lineWidth,j=this.lineSpacing,i=h>0?h/2:0;b.clearRect(0,0,a.width,a.height),this.syncContext(a,b),b.textAlign="start";let k=0,m=0,p=0;const l=[],n=this.verticalAlign==="ascent",q=b.measureText("|MÉq"),r=Math.ceil(Math.abs(q.actualBoundingBoxAscent)+Math.abs(q.actualBoundingBoxDescent))+h;for(let s=0;s<d.length;s++){const z=b.measureText(d[s]),ma=z.actualBoundingBoxLeft,R=z.actualBoundingBoxRight;let H=z.actualBoundingBoxAscent,Z=z.actualBoundingBoxDescent;(!H&&!Z||d[s]==="")&&(H=r,Z=0);const Kc=Math.ceil(Math.abs(ma)+Math.abs(R))+h,zb=Math.ceil(Math.abs(H)+Math.abs(Z))+h;n?(p+=H+i,s>0&&(p+=j+i),m=p+Z+i):(p=m+(zb-Z-i),m+=zb,s<d.length-1&&(m+=j)),k=Math.max(k,Kc),l.push({lineWidth:Kc,lineHeight:zb,ascent:H,descent:Z,left:ma,right:R,y:p})}k+=e.left+e.right,m+=e.top+e.bottom;const t=this.fixedWidth?this.fixedWidth:k,y=this.fixedHeight?this.fixedHeight:m,X=Math.ceil(t*c),Y=Math.ceil(y*c);(a.width!==X||a.height!==Y)&&(a.width=X,a.height=Y,this.texture.setSize(t,y),this.setSize(t,y)),b.save(),b.scale(c,c),this.syncContext(a,b);const P=this.backgroundStyle;if(P){b.save(),b.fillStyle=P,b.strokeStyle=P;const s=this.cornerRadius,z=s>0?s/2:0;s&&(b.lineWidth=s,b.strokeRect(z,z,t-s,y-s)),b.fillRect(z,z,t-s,y-s),b.restore()}const Q=this.textAlign,wb=Q==="center",xb=Q==="right"||Q==="end",yb=(y-m)/2+e.top;for(let s=0;s<d.length;s++){const z=d[s],ma=l[s];let R=e.left+ma.left+i;const H=yb+ma.y;wb?R=t/2:xb&&(R=t-i),g&&b.strokeText(z,R,H),f&&b.fillText(z,R,H)}return b.restore(),this.texture.binding&&this.texture.binding.update(),this.setDirty(o.TEXTURE),this}get text(){return this._text}set text(a){this.setText(a)}setText(a=""){return Array.isArray(a)&&(a=a.join(`
`)),a!==this._text&&(this._text=a.toString(),this.updateText()),this}destroy(a){this.texture.destroy(),this.fillStyle=null,this.strokeStyle=null,this.backgroundStyle=null,this.canvas=null,this.context=null,super.destroy(a)}}class La{constructor(a,b=0,c=b){this.width=b,this.height=c,this.buffer=new a(b*c)}getOffset(a,b){return b*this.width+a}get(a,b){let c;return arguments.length===2?c=this.getOffset(a,b):c=a,this.buffer.get(c)}set(a,b,c=b){let d;return arguments.length===3?d=this.getOffset(a,b):d=a,this.buffer.set(d,c),this}fillFromCanvas(a,b=0,c=0,d=a.width-b,e=a.height-c,f,g){this.resize(d,e);const h=a.getContext("2d"),j=h.getImageData(b,c,d,e).data,i=j.length;for(let k=0,m=i/4;k<m;k++){const p=k*4;let l;g?l=f.call(g,j,p):l=f(j,p),this.set(k,l)}return this}fill(a){return this.buffer.fill(a),this}clear(){return this.fill(0),this}resize(a,b){return this.width===a&&this.height===b?this:(this.width=a,this.height=b,this.buffer.resize(a*b),this)}forEach(a,b,c=!1){for(let d=0,e=this.height;d<e;d++)for(let f=0,g=this.width;f<g;f++){const h=this.get(f,d);if(c&&h===0)continue;b?a.call(b,h,f,d,this):a(h,f,d,this)}return this}forEachNonZero(a,b){return this.forEach(a,b,!0),this}}function Cc(a,b=0,c=0,d=a.width-b,e=a.height-c,f,g,h,j){return j===void 0&&(j=new La(f,d,e)),j.fillFromCanvas(a,b,c,d,e,g,h),j}var Ma;(function(a){a[a.uint8=0]="uint8",a[a.unit32=1]="unit32"})(Ma||(Ma={}));const ad=[Uint8Array,Uint32Array],bd=[1,4];class Hc{constructor(a,b=0){this.type=a,this.resize(b)}get(a){return this._arr[a]}set(a,b){return this._arr[a]=b,this}fill(a){for(var b=0,c=this._rows;b<c;b++)this._arr[b]=a;return this}resize(a){return a!==this._rows&&(this._rows=a,this._buf=new ArrayBuffer(this._rows*bd[this.type]),this._arr=new ad[this.type](this._buf)),this}}const Ic=8,vb=3;class Dc extends Hc{constructor(a=0){super(Ma.uint8,a)}get(a){const b=a>>vb,c=a%Ic,d=1<<c;return this._arr[b]&d?1:0}set(a,b=1){const c=a>>vb,d=a%Ic;let e=1<<d;return b?this._arr[c]|=e:(e=255^e,this._arr[c]&=e),this}fill(a){const b=a?255:0;return super.fill(b),this}resize(a){return a=(a>>vb)+1,super.resize(a),this}}function Ec(a,b){return a[b+3]?1:0}function Cb(a,b={},c){b instanceof La&&(c=b,b={});const d=a.canvas,{x:e=0,y:f=0,width:g=d.width-e,height:h=d.height-f}=b;return Cc(d,e,f,g,h,Dc,Ec,void 0,c)}class Lc extends Bb{constructor(){super();const a=4;Ta("dot",{width:a,height:a,fillStyle:"white"});const b=new Sa(this),c=new Ua(0,0,"Hello","40px Comic Sans MS"),d=new Va(c.width*c.height,"dot"),e=(800-c.width*a)/2,f=(600-c.height*a)/2;Cb(c).forEachNonZero(function(g,h,j){d.add({x:e+h*a,y:f+j*a,tint:16770244})}),_(b,d),c.setOrigin(0),_(b,c)}}new Ab(Ra(),Qa(800,600),Oa("game"),Na(2960685),Pa(Lc));})();

!function(){"use strict";let t,e=0,r=0;const i=()=>t,s=e=>{t=e},n=()=>e,o=t=>{e=t},h=t=>{r=t};let a=0;let l=800,u=600,c=1;function d(){return l}function f(){return u}function x(){return c}const g=[],y=t=>{g.push(t)},p=()=>g,T=()=>{g.length=0};let m;let v,w=0;function b(){return w}function E(t){let e;return t&&("string"==typeof t?e=document.getElementById(t):"object"==typeof t&&1===t.nodeType&&(e=t)),e||(e=document.body),e}function C(){return v}let _=[];let M,D={alpha:!1,antialias:!1,depth:!1,premultipliedAlpha:!1};class R{constructor(t){this.stack=[],this.current=null,this.renderer=t}reset(){this.stack=[],this.current=null;const t=this.renderer,e=t.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,t.width,t.height)}add(t,e=!0,r=0,i=0){this.stack.push({framebuffer:t,width:r,height:i}),this.set(t,e,r,i)}set(t,e=!0,r=0,i=0){const s=this.renderer.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),e&&(s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT)),r>0&&s.viewport(0,0,r,i),this.current=t}pop(){this.stack.pop();const t=this.stack.length;if(t>0){const e=this.stack[t-1];this.set(e.framebuffer,!1,e.width,e.height)}else this.reset()}rebind(){const t=this.renderer.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.current)}destroy(){this.stack=[]}}const S=()=>M,A=t=>{M=t};function X(t){const e=S();if(!e)return;const{parent:r,flipY:i,unpackPremultiplyAlpha:s,minFilter:n,magFilter:o,wrapS:h,wrapT:a,generateMipmap:l,isPOT:u}=t,c=r.image;let d=r.width,f=r.height;const x=e.createTexture();return e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,x),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),c?(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,c),d=c.width,f=c.height):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,d,f,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,h),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,a),l&&u&&e.generateMipmap(e.TEXTURE_2D),t.texture=x,x}function Y(t){const e=S();e&&e.isTexture(t)&&e.deleteTexture(t)}class k{constructor(t,e={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1;const r=S();var i,s;this.parent=t,this.isPOT=(i=t.width,s=t.height,!(i<1||s<1)&&0==(i&i-1)&&0==(s&s-1));const{texture:n=null,framebuffer:o=null,unpackPremultiplyAlpha:h=!0,minFilter:a=r.LINEAR,magFilter:l=r.LINEAR,wrapS:u=r.CLAMP_TO_EDGE,wrapT:c=r.CLAMP_TO_EDGE,generateMipmap:d=this.isPOT,flipY:f=!1}=e;this.minFilter=a,this.magFilter=l,this.wrapS=u,this.wrapT=c,this.generateMipmap=d,this.flipY=f,this.unpackPremultiplyAlpha=h,o&&(this.framebuffer=o),n?this.texture=n:X(this)}setFilter(t){this.texture&&function(t,e=!0){const r=S();r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t);const i=e?r.LINEAR:r.NEAREST;r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,i)}(this.texture,t)}create(){const t=this.texture;return t&&Y(t),X(this)}update(){return this.texture?function(t){const e=S(),r=t.parent.image,i=r.width,s=r.height;return i>0&&s>0&&(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t.texture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)),t.texture}(this):X(this)}setIndex(t){this.dirtyIndex=t!==this.index,this.index=t}destroy(){Y(this.texture),function(t){const e=S();e&&e.isFramebuffer(t)&&e.deleteFramebuffer(t)}(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}}class N{constructor(t,e,r,i,s){this.batchSize=t,this.dataSize=e,this.indexSize=r,this.vertexElementSize=i,this.quadIndexSize=s,this.vertexByteSize=i*e,this.quadByteSize=4*this.vertexByteSize,this.quadElementSize=4*i,this.bufferByteSize=t*this.quadByteSize,this.create()}create(){let t=[];for(let e=0;e<this.batchSize*this.indexSize;e+=this.indexSize)t.push(e+0,e+1,e+2,e+2,e+3,e+0);this.data=new ArrayBuffer(this.bufferByteSize),this.index=new Uint16Array(t),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const e=S();this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.data,e.DYNAMIC_DRAW),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.index,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),t=[]}destroy(){}}class F{constructor(t,e,r,i,s,n){this.trimmed=!1,this.texture=t,this.key=e,this.x=r,this.y=i,this.width=s,this.height=n,this.sourceSizeWidth=s,this.sourceSizeHeight=n,this.updateUVs()}setPivot(t,e){this.pivot={x:t,y:e}}setSize(t,e){this.width=t,this.height=e,this.sourceSizeWidth=t,this.sourceSizeHeight=e,this.updateUVs()}setSourceSize(t,e){this.sourceSizeWidth=t,this.sourceSizeHeight=e}setTrim(t,e,r,i,s,n){this.trimmed=!0,this.sourceSizeWidth=t,this.sourceSizeHeight=e,this.spriteSourceSizeX=r,this.spriteSourceSizeY=i,this.spriteSourceSizeWidth=s,this.spriteSourceSizeHeight=n}getExtent(t,e){const r=this.sourceSizeWidth,i=this.sourceSizeHeight;let s,n,o,h;return this.trimmed?(s=this.spriteSourceSizeX-t*r,n=s+this.spriteSourceSizeWidth,o=this.spriteSourceSizeY-e*i,h=o+this.spriteSourceSizeHeight):(s=-t*r,n=s+r,o=-e*i,h=o+i),{left:s,right:n,top:o,bottom:h}}setExtent(t){const e=t.transform,r=e.origin.x,i=e.origin.y,s=this.sourceSizeWidth,n=this.sourceSizeHeight;let o,h,a,l;this.trimmed?(o=this.spriteSourceSizeX-r*s,h=this.spriteSourceSizeY-i*n,a=this.spriteSourceSizeWidth,l=this.spriteSourceSizeHeight):(o=-r*s,h=-i*n,a=s,l=n),e.setExtent(o,h,a,l)}updateUVs(){const{x:t,y:e,width:r,height:i}=this,s=this.texture.width,n=this.texture.height;this.u0=t/s,this.v0=e/n,this.u1=(t+r)/s,this.v1=(e+i)/n}}class z{constructor(t,e,r){this.key="",t&&(e=t.width,r=t.height),this.image=t,this.width=e,this.height=r,this.frames=new Map,this.data={},this.addFrame("__BASE",0,0,e,r),y(this)}addFrame(t,e,r,i,s){if(this.frames.has(t))return null;const n=new F(this,t,e,r,i,s);return this.frames.set(t,n),this.firstFrame&&"__BASE"!==this.firstFrame.key||(this.firstFrame=n),n}getFrame(t){if(!t)return this.firstFrame;t instanceof F&&(t=t.key);let e=this.frames.get(t);return e||(console.warn("Frame missing: "+t),e=this.firstFrame),e}setSize(t,e){this.width=t,this.height=e;this.frames.get("__BASE").setSize(t,e)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}}let B;const P=()=>B,U=t=>{B=t},I={fragmentShader:"\n#define SHADER_NAME SINGLE_QUAD_FRAG\n\nprecision highp float;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nuniform sampler2D uTexture;\n\nvoid main (void)\n{\n    vec4 color = texture2D(uTexture, vTextureCoord);\n\n    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\n}",vertexShader:"\n#define SHADER_NAME SINGLE_QUAD_VERT\n\nprecision highp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute float aTextureId;\nattribute vec4 aTintColor;\n\nuniform mat4 uProjectionMatrix;\nuniform mat4 uCameraMatrix;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nvoid main (void)\n{\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vTintColor = aTintColor;\n\n    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\n}"};class O{constructor(t={}){this.attribs={aVertexPosition:0,aTextureCoord:0,aTextureId:0,aTintColor:0},this.uniforms={uProjectionMatrix:0,uCameraMatrix:0,uTexture:0,uTime:0,uResolution:0},this.renderToFBO=!1,this.renderer=P();const{batchSize:e=4096,dataSize:r=4,indexSize:i=4,vertexElementSize:s=6,quadIndexSize:n=6,fragmentShader:o=I.fragmentShader,vertexShader:h=I.vertexShader,width:a=d(),height:l=f(),resolution:u=x(),renderToFBO:c=!1}=t;this.buffer=new N(e,r,i,s,n),this.createShaders(o,h),this.count=0,this.renderToFBO=c;const g=new z(null,a*u,l*u),y=new k(g);g.binding=y,y.framebuffer=function(t,e){const r=S();e||(e=r.COLOR_ATTACHMENT0);const i=r.createFramebuffer();return r.bindFramebuffer(r.FRAMEBUFFER,i),r.framebufferTexture2D(r.FRAMEBUFFER,e,r.TEXTURE_2D,t,0),r.bindFramebuffer(r.FRAMEBUFFER,null),i}(y.texture),this.texture=g,this.framebuffer=y.framebuffer}createShaders(t,e){const r=this.renderer.gl,i=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(i,t),r.compileShader(i);let s=!1,n=r.getShaderInfoLog(i);n.length>0&&(s=!0,console.error(n));const o=r.createShader(r.VERTEX_SHADER);if(r.shaderSource(o,e),r.compileShader(o),n=r.getShaderInfoLog(i),n.length>0&&(s=!0,console.error(n)),s)return;const h=r.createProgram();r.attachShader(h,o),r.attachShader(h,i),r.linkProgram(h),r.useProgram(h),this.program=h;for(const t of Object.keys(this.attribs)){const e=r.getAttribLocation(h,t);r.enableVertexAttribArray(e),this.attribs[t]=e}for(const t of Object.keys(this.uniforms))this.uniforms[t]=r.getUniformLocation(h,t)}bind(t,e,r){if(!this.program)return!1;const i=this.renderer,s=i.gl,n=this.uniforms;return s.useProgram(this.program),s.uniformMatrix4fv(n.uProjectionMatrix,!1,t),s.uniformMatrix4fv(n.uCameraMatrix,!1,e),s.uniform1i(n.uTexture,i.textures.textureIndex[r]),s.uniform1f(n.uTime,performance.now()),s.uniform2f(n.uResolution,i.width,i.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}bindBuffers(t,e){const r=this.renderer.gl,i=this.buffer.vertexByteSize,s=this.attribs;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),r.bindBuffer(r.ARRAY_BUFFER,e),r.vertexAttribPointer(s.aVertexPosition,2,r.FLOAT,!1,i,0),r.vertexAttribPointer(s.aTextureCoord,2,r.FLOAT,!1,i,8),r.vertexAttribPointer(s.aTextureId,1,r.FLOAT,!1,i,16),r.vertexAttribPointer(s.aTintColor,4,r.UNSIGNED_BYTE,!0,i,20),this.count=0}draw(t){const e=this.renderer,r=e.gl,i=this.buffer;if(t===i.batchSize)r.bufferData(r.ARRAY_BUFFER,i.data,r.DYNAMIC_DRAW);else{const e=i.vertexViewF32.subarray(0,t*i.quadElementSize);r.bufferSubData(r.ARRAY_BUFFER,0,e)}this.renderToFBO&&e.fbo.add(this.framebuffer,!0),r.drawElements(r.TRIANGLES,t*i.quadIndexSize,r.UNSIGNED_SHORT,0),this.renderToFBO&&e.fbo.pop()}flush(){const t=this.count;return 0!==t&&(this.draw(t),this.prevCount=t,this.count=0,!0)}}class L extends O{constructor(t={fragmentShader:"\n#define SHADER_NAME MULTI_QUAD_FRAG\n\nprecision highp float;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nuniform sampler2D uTexture[%count%];\n\nvoid main (void)\n{\n    vec4 color;\n\n    %forloop%\n\n    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\n}"}){super(t)}createShaders(t,e){const r=b();let i="";for(let t=1;t<r;t++)t>1&&(i+="\n\telse "),t<r-1&&(i+=`if (vTextureId < ${t}.5)`),i+="\n\t{",i+=`\n\t\tcolor = texture2D(uTexture[${t}], vTextureCoord);`,i+="\n\t}";t=(t=t.replace(/%count%/gi,""+r)).replace(/%forloop%/gi,i),super.createShaders(t,e)}bind(t,e){if(!this.program)return!1;const r=this.renderer,i=r.gl,s=this.uniforms;return i.useProgram(this.program),i.uniformMatrix4fv(s.uProjectionMatrix,!1,t),i.uniformMatrix4fv(s.uCameraMatrix,!1,e),i.uniform1iv(s.uTexture,r.textures.textureIndex),i.uniform1f(s.uTime,performance.now()),i.uniform2f(s.uResolution,r.width,r.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}}class Z{constructor(t,e){this.renderer=t;const r={shader:new e};this.stack=[r],this.currentEntry=r,this.current=r.shader,this.singleQuadShader=new O}add(t,e){const r={shader:t,textureID:e};return this.stack.push(r),r}set(t,e){this.flush();const r=this.renderer,i=r.projectionMatrix,s=r.currentCamera.matrix,n=t.bind(i,s,e);if(n){const r=this.add(t,e);this.currentEntry=r,this.current=t}return n}setDefault(t){this.set(this.singleQuadShader,t)}pop(){this.flush();const t=this.stack;t.length>1&&t.pop(),this.currentEntry=t[t.length-1],this.current=this.currentEntry.shader}reset(){this.pop(),this.rebind()}flush(){return!!this.current.flush()&&(this.renderer.flushTotal++,!0)}rebind(){const t=this.renderer,e=t.projectionMatrix,r=t.currentCamera.matrix,i=this.currentEntry;i.shader.bind(e,r,i.textureID)}popAndRebind(){this.pop(),this.rebind()}clear(){}destroy(){}}const W=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function G(t){let e="";for(let r=0;r<t;++r)r>0&&(e+="\nelse "),r<t-1&&(e+=`if(test == ${r}.0){}`);return e}class V{constructor(t){this.startActiveTexture=0,this.renderer=t,this.tempTextures=[],this.textureIndex=[]}init(){const t=this.renderer.gl;let e=function(t,e){const r=e.createShader(e.FRAGMENT_SHADER);for(;;){const i=W.replace(/%forloop%/gi,G(t));if(e.shaderSource(r,i),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))break;t=t/2|0}return t}(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),t);const r=b();0===r||r>0&&r>e?w=e:r>0&&r<e&&(e=Math.max(8,r));const i=this.tempTextures;i.length&&i.forEach(e=>{t.deleteTexture(e)});const s=[];for(let r=0;r<e;r++){const e=t.createTexture();t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),i[r]=e,s.push(r)}this.maxTextures=e,this.textureIndex=s,this.currentActiveTexture=1}update(){const t=p();for(let e=0;e<t.length;e++){const r=t[e];r.binding||(r.binding=new k(r))}T()}reset(){const t=this.renderer.gl,e=this.tempTextures;for(let r=0;r<e.length;r++)t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_2D,e[r]);this.currentActiveTexture=1,this.startActiveTexture++}bind(t,e=0){const r=this.renderer.gl,i=t.binding;i.setIndex(e),r.activeTexture(r.TEXTURE0+e),r.bindTexture(r.TEXTURE_2D,i.texture)}unbind(t=0){const e=this.renderer.gl;e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this.tempTextures[t]),t>0&&this.startActiveTexture++}request(t){const e=this.renderer.gl,r=t.binding,i=this.currentActiveTexture;return!(r.indexCounter>=this.startActiveTexture)&&(r.indexCounter=this.startActiveTexture,i<this.maxTextures?(r.setIndex(i),e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_2D,r.texture),this.currentActiveTexture++):(this.renderer.flush(),this.startActiveTexture++,r.indexCounter=this.startActiveTexture,r.setIndex(1),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,r.texture),this.currentActiveTexture=2),!0)}}class H{constructor(){this.clearColor=[0,0,0,1],this.flushTotal=0,this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.currentCamera=null,this.width=d(),this.height=f(),this.resolution=x(),this.setBackgroundColor(a);const t=document.createElement("canvas");t.addEventListener("webglcontextlost",t=>this.onContextLost(t),!1),t.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=t,this.fbo=new R(this),this.textures=new V(this),this.initContext(),U(this),this.shaders=new Z(this,L)}initContext(){const t=this.canvas.getContext("webgl",D);A(t),this.gl=t,t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),this.resize(this.width,this.height,this.resolution),this.textures.init()}resize(t,e,r=1){this.width=t*r,this.height=e*r,this.resolution=r;const i=this.canvas;i.width=this.width,i.height=this.height,this.autoResize&&(i.style.width=(this.width/r).toString()+"px",i.style.height=(this.height/r).toString()+"px"),this.gl.viewport(0,0,this.width,this.height),this.projectionMatrix=function(t,e,r=-1,i=1){return new Float32Array([1/-t*-2,0,0,0,0,1/e*-2,0,0,0,0,1/(r-i)*2,0,-1,1,0,1])}(t,e)}onContextLost(t){t.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(t){return function(t,e=[]){const r=t>>16&255,i=t>>8&255,s=255&t,n=t>16777215?t>>>24:255;e[0]=r/255,e[1]=i/255,e[2]=s/255,e[3]=n/255}(t,this.clearColor),this}reset(t=null,e=this.width,r=this.height){const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,t),i.viewport(0,0,e,r),i.enable(i.BLEND),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),this.flushTotal=0,this.currentCamera=null,this.textures.update()}render(t){if(this.contextLost)return;if(this.reset(),this.optimizeRedraw&&0===t.numDirtyFrames&&0===t.numDirtyCameras)return;const e=this.gl;if(this.clearBeforeRender){const t=this.clearColor;e.clearColor(t[0],t[1],t[2],t[3]),e.clear(e.COLOR_BUFFER_BIT)}const r=t.worldData;for(let t=0;t<r.length;t++){const{camera:e,renderList:n}=r[t];this.currentCamera&&(i=e.worldTransform,s=this.currentCamera.worldTransform,i.a===s.a&&i.b===s.b&&i.c===s.c&&i.d===s.d&&i.tx===s.tx&&i.ty===s.ty)||(this.flush(),this.currentCamera=e,this.shaders.rebind()),n.forEach(t=>{t.children.length?this.renderNode(t):t.node.renderGL(this)})}var i,s;this.flush()}renderNode(t){t.node.renderGL(this),t.children.forEach(t=>{t.children.length>0?this.renderNode(t):t.node.renderGL(this)}),t.node.postRenderGL(this)}flush(){this.shaders.flush()}destroy(){U(void 0)}}class Q{constructor(t=1,e=0,r=0,i=1,s=0,n=0){this.set(t,e,r,i,s,n)}set(t=1,e=0,r=0,i=1,s=0,n=0){return this.a=t,this.b=e,this.c=r,this.d=i,this.tx=s,this.ty=n,this}identity(){return this.set()}toArray(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]}fromArray(t){return this.set(t[0],t[1],t[2],t[3],t[4],t[5])}}class j{constructor(t=0,e=0,r=0,i=0){this.set(t,e,r,i)}set(t=0,e=0,r=0,i=0){return this.x=t,this.y=e,this.width=r,this.height=i,this}contains(t,e){return function(t,e,r){return!(t.width<=0||t.height<=0)&&(t.x<=e&&t.x+t.width>=e&&t.y<=r&&t.y+t.height>=r)}(this,t,e)}set right(t){t<=this.x?this.width=0:this.width=t-this.x}get right(){return this.x+this.width}set bottom(t){t<=this.y?this.height=0:this.height=t-this.y}get bottom(){return this.y+this.height}}function q(){}class ${constructor(t,e=0,r=0,i=!1){this.compareValue=!1,this._x=e,this._y=r,this.callback=t,this.compareValue=i}set(t=0,e=0){return this._x=t,this._y=e,this.callback(this),this}destroy(){this.callback=q}set x(t){(!this.compareValue||this.compareValue&&t!==this._x)&&(this._x=t,this.callback(this))}get x(){return this._x}set y(t){(!this.compareValue||this.compareValue&&t!==this._x)&&(this._y=t,this.callback(this))}get y(){return this._y}}class J{constructor(){this.type="StaticCamera",this.dirtyRender=!0;const t=i();this.renderer=t.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.bounds=new j,this.worldTransform=new Q,this.reset()}reset(){const t=this.renderer.width,e=this.renderer.height;this.width=t,this.height=e,this.bounds.set(0,0,t,e)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}function K(t,e){const r=function(t,e){return t.children.indexOf(e)}(t,e);return r>-1&&function(t,e){const r=t.children;let i;if(e>=0&&e<r.length){const t=r.splice(e,1);t[0]&&(i=t[0],i.parent=null)}}(t,r),e}function tt(t,e,...r){if(0===t.events.size||!t.events.has(e))return!1;const i=t.events.get(e);for(const t of i)t.callback.apply(t.context,r),t.once&&i.delete(t);return 0===i.size&&t.events.delete(e),!0}function et(t,...e){e.forEach(e=>{e.parent&&K(e.parent,e),e.parent=t});const r=t.world;return r&&function(t,...e){e.forEach(e=>{e.world&&(tt(e.world,"removedfromworld",e,e.world),tt(e,"removedfromworld",e,e.world)),e.world=t,tt(t,"addedtoworld",e,t),tt(e,"addedtoworld",e,t)})}(r,...function(t){const e=[t],r=[];for(;e.length>0;){const t=e.shift();r.push(t);const i=t.numChildren;if(i>0)for(let r=i-1;r>=0;r--)e.unshift(t.children[r])}return r.shift(),r}(t)),e}function rt(t,e){return t.children.push(e),et(t,e),e.transform.updateWorld(),e}const it=1,st=4,nt=16,ot=32,ht=256,at=51;function lt(t,e=0,r){const i=t.children;void 0===r&&(r=i.length);const s=r-e;if(s>0&&s<=r){const t=i.splice(e,s);return t.forEach(t=>{t.parent=null}),t}return[]}class ut{constructor(t,e,r=!1){this.callback=t,this.context=e,this.once=r}}function ct(t,e,r,i,s){const n=t.events,o=n.get(e);if(r)if(r instanceof ut)o.delete(r);else{const t=!i,e=void 0!==s;for(const n of o)n.callback===r&&t&&n.context===i&&e&&n.once===s&&o.delete(n)}else n.delete(e);return 0===o.size&&n.delete(e),t}function dt(t,e,r,i=t,s=!1){if("function"!=typeof r)throw new TypeError("Listener not a function");const n=new ut(r,i,s),o=t.events.get(e);return o?o.add(n):t.events.set(e,new Set([n])),n}function ft(t,e,r,i=t){return dt(t,e,r,i,!0)}let xt;const gt=()=>xt,yt=t=>{xt=t};class pt{constructor(){this.scenes=new Map,this.sceneIndex=0,this.flush=!1,this.renderResult={gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]},this.game=i(),yt(this),ft(this.game,"boot",()=>this.boot())}boot(){_.forEach(t=>new t)}update(t,e){for(const r of this.scenes.values())tt(r,"update",t,e)}render(t){const e=this.renderResult;!function(t,e=0){t.gameFrame=e,t.numTotalFrames=0,t.numDirtyFrames=0,t.numDirtyCameras=0,t.worldData.length=0}(e,t);for(const t of this.scenes.values())tt(t,"render",e);return this.flush&&(e.numDirtyFrames++,this.flush=!1),e}}function Tt(t,e){const r=document.createElement("canvas");return r.width=t,r.height=e,r.getContext("2d")}let mt;const vt=()=>mt,wt=t=>{mt=t};class bt{constructor(){this.textures=new Map,this.createDefaultTextures(),wt(this)}createDefaultTextures(){this.add("__BLANK",new z(Tt(32,32).canvas));const t=Tt(32,32);t.strokeStyle="#0f0",t.moveTo(0,0),t.lineTo(32,32),t.stroke(),t.strokeRect(.5,.5,31,31),this.add("__MISSING",new z(t.canvas))}get(t){const e=this.textures;return e.has(t)?e.get(t):e.get("__MISSING")}has(t){return this.textures.has(t)}add(t,e){let r;const i=this.textures;return i.has(t)||(r=e instanceof z?e:new z(e),r.key=t,i.set(t,r)),r}}function Et(t){const{a:e,b:r,c:i,d:s,tx:n,ty:o}=t.world,{x:h,y:a,right:l,bottom:u}=t.extent;return{x0:h*e+a*i+n,y0:h*r+a*s+o,x1:h*e+u*i+n,y1:h*r+u*s+o,x2:l*e+u*i+n,y2:l*r+u*s+o,x3:l*e+a*i+n,y3:l*r+a*s+o}}class Ct{constructor(t){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=t,this.area=new j}set(t,e,r,i){this.area.set(t,e,r,i)}get(){return this.entity.isDirty(ot)&&!this.fixed&&this.update(),this.area}updateLocal(){const{x0:t,y0:e,x1:r,y1:i,x2:s,y2:n,x3:o,y3:h}=Et(this.entity.transform),a=Math.min(t,r,s,o),l=Math.min(e,i,n,h),u=Math.max(t,r,s,o),c=Math.max(e,i,n,h);return this.area.set(a,l,u-a,c-l)}update(){const t=this.updateLocal();if(this.entity.clearDirty(ot),!this.includeChildren||!this.entity.numChildren)return t;const e=this.visibleOnly,r=this.entity.children;let i=t.x,s=t.y,n=t.right,o=t.bottom;for(let t=0;t<r.length;t++){const h=r[t];if(!h||e&&!h.visible)continue;const a=h.bounds.get();a.x<i&&(i=a.x),a.y<s&&(s=a.y),a.right>n&&(n=a.right),a.bottom>o&&(o=a.bottom)}return t.set(i,s,n-i,o-s)}destroy(){this.entity=null,this.area=null}}class _t{constructor(t){this.enabled=!1,this.enabledChildren=!0,this.entity=t}destroy(){this.entity=null,this.hitArea=null}}class Mt{constructor(t=0,e=0){this.set(t,e)}set(t=0,e=0){return this.x=t,this.y=e,this}getArray(){return[this.x,this.y]}fromArray(t){return this.set(t[0],t[1])}toString(){return`[x=${this.x}, y=${this.y}]`}}function Dt(t,e){return e.set(t.a,t.b,t.c,t.d,t.tx,t.ty)}class Rt{constructor(t,e=0,r=0){this.passthru=!1,this._rotation=0,this.entity=t,this.local=new Q,this.world=new Q,this.position=new $(()=>this.update(),e,r),this.scale=new $(()=>this.update(),1,1,!0),this.skew=new $(()=>this.update(),0,0,!0),this.origin=new $(()=>this.updateExtent(),.5,.5),this.extent=new j}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(it,ot),function(t){const e=t.local,r=t.position.x,i=t.position.y,s=t.rotation,n=t.scale.x,o=t.scale.y,h=t.skew.x,a=t.skew.y;e.set(Math.cos(s+a)*n,Math.sin(s+a)*n,-Math.sin(s-h)*o,Math.cos(s-h)*o,r,i)}(this)}updateWorld(){const t=this.entity;t.setDirty(it,ot),function(t){const e=t.parent,r=t.transform,i=r.local,s=r.world;if(e)if(r.passthru)Dt(e.transform.world,s);else{const{a:t,b:r,c:n,d:o,tx:h,ty:a}=i,{a:l,b:u,c:c,d:d,tx:f,ty:x}=e.transform.world;s.set(t*l+r*c,t*u+r*d,n*l+o*c,n*u+o*d,h*l+a*c+f,h*u+a*d+x)}else Dt(i,s)}(t),t.numChildren&&this.updateChildren()}updateChildren(){const t=this.entity.children;for(let e=0;e<t.length;e++){t[e].transform.updateWorld()}}globalToLocal(t,e,r=new Mt){const{a:i,b:s,c:n,d:o,tx:h,ty:a}=this.world,l=1/(i*o+n*-s);return r.x=o*l*t+-n*l*e+(a*n-h*o)*l,r.y=i*l*e+-s*l*t+(-a*i+h*s)*l,r}localToGlobal(t,e,r=new Mt){const{a:i,b:s,c:n,d:o,tx:h,ty:a}=this.world;return r.x=i*t+n*e+h,r.y=s*t+o*e+a,r}setExtent(t,e,r,i){this.extent.set(t,e,r,i),this.entity.setDirty(it,ot)}updateExtent(t,e){const r=this.extent,i=this.entity;void 0!==t&&(r.width=t),void 0!==e&&(r.height=e),r.x=-this.origin.x*r.width,r.y=-this.origin.y*r.height,i.setDirty(it,ot)}set rotation(t){t!==this._rotation&&(this._rotation=t,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}}class St{constructor(t=0,e=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.events=new Map,this.transform=new Rt(this,t,e),this.bounds=new Ct(this),this.input=new _t(this),this.dirty=at,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(t){return 0!=(this.dirty&t)}clearDirty(t){return this.isDirty(t)&&(this.dirty^=t),this}setDirty(t,e){return this.isDirty(t)||(this.dirty^=t,this.dirtyFrame=n()),this.isDirty(e)||(this.dirty^=e),this}update(t,e){if(this.willUpdateChildren){const r=this.children;for(let i=0;i<r.length;i++){const s=r[i];s&&s.willUpdate&&s.update(t,e)}}this.postUpdate(t,e)}postUpdate(t,e){}renderGL(t){}renderCanvas(t){}postRenderGL(t){}postRenderCanvas(t){}get numChildren(){return this.children.length}destroy(t){t?function(t,e,r=0,i){const s=lt(t,r,i);et(e,...s),s.forEach(t=>{t.transform.updateWorld()})}(this,t):function(t,e=0,r){lt(t,e,r).forEach(t=>{t.destroy()})}(this),tt(this,"destroy",this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}}class At extends St{constructor(t=0,e=0){super(t,e),this._alpha=1,this.type="Container"}setSize(t,e=t){return this.transform.updateExtent(t,e),this}setPosition(t,e){return this.transform.position.set(t,e),this}setOrigin(t,e=t){return this.transform.origin.set(t,e),this}setSkew(t,e=t){return this.transform.skew.set(t,e),this}setScale(t,e=t){return this.transform.scale.set(t,e),this}setRotation(t){return this.transform.rotation=t,this}set width(t){this.transform.updateExtent(t)}get width(){return this.transform.extent.width}set height(t){this.transform.updateExtent(void 0,t)}get height(){return this.transform.extent.height}set x(t){this.transform.position.x=t}get x(){return this.transform.position.x}set y(t){this.transform.position.y=t}get y(){return this.transform.position.y}set originX(t){this.transform.origin.x=t}get originX(){return this.transform.origin.x}set originY(t){this.transform.origin.y=t}get originY(){return this.transform.origin.y}set skewX(t){this.transform.skew.x=t}get skewX(){return this.transform.skew.x}set skewY(t){this.transform.skew.y=t}get skewY(){return this.transform.skew.y}set scaleX(t){this.transform.scale.x=t}get scaleX(){return this.transform.scale.x}set scaleY(t){this.transform.scale.y=t}get scaleY(){return this.transform.scale.y}set rotation(t){this.transform.rotation=t}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t,this.setDirty(it))}}function Xt(t,e){return((255&(255*e|0))<<24|t)>>>0}function Yt(t){const e=t.vertexAlpha,r=t.vertexTint,i=t.vertexColor;return i[0]=Xt(r[0],e[0]),i[1]=Xt(r[1],e[1]),i[2]=Xt(r[2],e[2]),i[3]=Xt(r[3],e[3]),t}function kt(t,e,...r){const i=t.getFrame(e),{u0:s,u1:n,v0:o,v1:h,pivot:a}=i;return r.forEach(t=>{if(!t||i===t.frame)return;t.frame=i,a&&t.setOrigin(a.x,a.y),t.frame.setExtent(t),t.hasTexture=!0;const e=t.vertexData;e[2]=s,e[3]=o,e[8]=s,e[9]=h,e[14]=n,e[15]=h,e[20]=n,e[21]=o}),r}class Nt extends At{constructor(t,e,r,i){super(t,e),this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertexData=new Float32Array(24).fill(0),this.vertexColor=new Uint32Array(4).fill(4294967295),this.vertexAlpha=new Float32Array(4).fill(1),this.vertexTint=new Uint32Array(4).fill(16777215),this.setTexture(r,i)}setTexture(t,e){return function(t,e,...r){if(t){let i;i=t instanceof z?t:vt().get(t),i?(r.forEach(t=>{t.texture=i}),kt(i,e,...r)):console.warn("Invalid Texture key: "+t)}else r.forEach(t=>{t.texture=null,t.frame=null,t.hasTexture=!1})}(t,e,this),this}setFrame(t){return kt(this.texture,t,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}preRender(){this.isDirty(nt)&&(Yt(this),this.clearDirty(nt)),this.isDirty(it)&&(!function(t){const e=t.vertexData,{x0:r,y0:i,x1:s,y1:n,x2:o,y2:h,x3:a,y3:l}=Et(t.transform);e[0]=r,e[1]=i,e[6]=s,e[7]=n,e[12]=o,e[13]=h,e[18]=a,e[19]=l}(this),this.clearDirty(it))}renderGL(t){this.preRender(),function(t,e){const r=t.texture,i=e.shaders.current,s=i.buffer,n=r.binding;i.count===s.batchSize&&e.flush();const o=t.vertexData;e.textures.request(r);const h=n.index;o[4]=h,o[10]=h,o[16]=h,o[22]=h;const a=i.count*s.quadElementSize;s.vertexViewF32.set(o,a);const l=t.vertexColor,u=s.vertexViewU32;u[a+5]=l[0],u[a+11]=l[2],u[a+17]=l[3],u[a+23]=l[1],i.count++}(this,t)}renderCanvas(t){this.preRender(),function(t,e){const r=t.frame;if(!r)return;const i=e.ctx,s=t.transform,{a:n,b:o,c:h,d:a,tx:l,ty:u}=s.world,{x:c,y:d}=s.extent;i.save(),i.setTransform(n,o,h,a,l,u),i.globalAlpha=t.alpha,i.drawImage(r.texture.image,r.x,r.y,r.width,r.height,c,d,r.width,r.height),i.restore()}(this,t)}get alpha(){return this._alpha}set alpha(t){if(t!==this._alpha){this._alpha=t;const e=this.vertexAlpha;e[0]=t,e[1]=t,e[2]=t,e[3]=t,this.setDirty(ht)}}get tint(){return this._tint}set tint(t){if(t!==this._tint){this._tint=t;const e=this.vertexTint;e[0]=t,e[1]=t,e[2]=t,e[3]=t,this.setDirty(nt)}}destroy(t){super.destroy(t),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertexData=null,this.vertexColor=null,this.vertexAlpha=null,this.vertexTint=null}}function Ft(t,e){t.forEach(t=>{e||function(t){if(t.node.isDirty(st))return!0;const e=[t];for(;e.length>0;){const t=e.pop();if(t.node.isDirty(it))return!0;const r=t.children.length;if(r>0)for(let i=0;i<r;i++)e.push(t.children[i])}return e.length=0,!1}(t)?t.node.setDirty(st):t.children.length=0})}function zt(t){const e=[],r=function t(e,r,i=[]){for(let s=0;s<r.numChildren;s++){const n=r.children[s];if(n.isRenderable()){const r=[],s={node:n,children:r};i.push(s),n.willRenderChildren&&n.numChildren>0&&(n.willCacheChildren&&e.push(s),t(e,n,r))}}return i}(e,t,[]),i=t.renderData;e.length>0&&Ft(e,t.camera.dirtyRender),r.forEach(t=>{t.children.length?function t(e,r){r.numRendered++,r.numRenderable++,e.node.dirtyFrame>=r.gameFrame&&r.dirtyFrame++,e.children.forEach(e=>{e.children.length>0&&t(e,r)})}(t,i):(i.numRendered++,i.numRenderable++,t.node.dirtyFrame>=i.gameFrame&&i.dirtyFrame++)}),i.renderList=r,t.forceRefresh&&(i.dirtyFrame++,t.forceRefresh=!1)}function Bt(t,e){t.gameFrame=e,t.dirtyFrame=0,t.numRendered=0,t.numRenderable=0,t.renderList.length=0}class Pt extends St{constructor(t){super(),this.forceRefresh=!1,this.type="BaseWorld",this.scene=t,this.world=this,this.events=new Map,this._updateListener=dt(t,"update",(t,e)=>this.update(t,e)),this._renderListener=dt(t,"render",t=>this.render(t)),this._shutdownListener=dt(t,"shutdown",()=>this.shutdown()),ft(t,"destroy",()=>this.destroy())}update(t,e){this.willUpdate&&(tt(this,"update",t,e,this),super.update(t,e))}postUpdate(t,e){tt(this,"postupdate",t,e,this)}render(t){const e=this.renderData;Bt(e,t.gameFrame),this.willRender&&this.visible&&(zt(this),tt(this,"worldrender",e,this),function(t,e){t.numDirtyFrames+=e.dirtyFrame,t.numTotalFrames+=e.numRendered,e.camera.dirtyRender&&t.numDirtyCameras++,t.worldData.push(e)}(t,e),this.camera&&(this.camera.dirtyRender=!1))}shutdown(){const t=this.scene;ct(t,"update",this._updateListener),ct(t,"render",this._renderListener),ct(t,"shutdown",this._shutdownListener),function(t,...e){e.forEach(e=>{K(t,e)})}(this),tt(this,"worldshutdown",this),Bt(this.renderData,0),this.camera&&this.camera.reset()}destroy(t){super.destroy(t),tt(this,"destroy",this),Bt(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}}class Ut extends Pt{constructor(t){super(t),this.type="StaticWorld",this.camera=new J,this.renderData={camera:this.camera,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0,renderList:[]}}}function It(t,e={}){const r=gt(),i=r.scenes.size,s=r.sceneIndex,n=0===i;"string"==typeof e?t.key=e:(e||!e&&n)&&(t.key=function(t,e,r){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:r}(e,"key","scene"+s.toString())),r.scenes.has(t.key)?console.warn("Scene key already in use: "+t.key):(r.scenes.set(t.key,t),r.flush=!0,r.sceneIndex++)}let Ot=function(t,e){return void 0===t||void 0===e?void 0:`${t}|${e}`};class Lt{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(t){return this.items.push(t),this}pushMultiple(t){return this.items.push.apply(this.items,t),t.length=0,this}clear(){return this.items.length=0,this}}let Zt=new Lt,Wt=function(t){Zt.push(t)},Gt=function(t,e,r,i,s,n,o,h){if(r===n&&i===o&&s===h)return;let a=Ot(r,i),l=Ot(n,o);if(a){let r=e.get(a);if(r.delete(s),a===l)return void r.set(h,t);0===r.size&&(Wt(r),e.delete(a))}if(l){let r=e.get(l);r?r.set(h,t):(r=function(){let t=Zt.pop();return null===t&&(t=new Map),t}(),r.set(h,t),e.set(l,r))}},Vt=function(t,e,r,i){let s=Ot(e,r),n=t.get(s);n&&(void 0!==i?(n.delete(i),0===n.size&&(Wt(n),t.delete(s))):(n.clear(),Wt(n),t.delete(s)))},Ht=new Lt,Qt=function(t){Ht.push(t)},jt=function(t,e,r,i){if(r!==i){if(void 0!==r){let i=e.get(r);i&&(i.delete(t),0===i.size&&(Qt(i),e.delete(r)))}if(void 0!==i){let r=e.get(i);r?r.add(t):(r=function(){let t=Ht.pop();return null===t&&(t=new Set),t}(),r.add(t),e.set(i,r))}}},qt=function(t,e,r){let i=t.get(e);i&&(i.delete(r),0===i.size&&(Qt(i),t.delete(e)))},$t=function(t,e,r,i){let s=t.XYToZMap.get(Ot(e,r));return void 0===s?null:void 0!==i?s.has(i)?s.get(i):null:s},Jt=function(t){let e=-1/0;for(const[r,i]of t)e<r&&(e=r);return e},Kt=function(t){let e=1/0;for(const[r,i]of t)e>r&&(e=r);return e};class te{constructor(){this.chessToXYZ=new Map,this.XYToZMap=new Map,this.XToChessSet=new Map,this.YToChessSet=new Map,this.ZToChessSet=new Map,this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0}destroy(){this.clear()}clear(){return this.chessToXYZ.clear(),this.XYToZMap.clear(),this.XToChessSet.clear(),this.YToChessSet.clear(),this.ZToChessSet.clear(),this.clearBounds(),this}clearBounds(){return this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0,this}addChess(t,e,r,i){return function(t,e,r,i,s){let n=t.chessToXYZ.get(e),o=n?n.x:void 0,h=n?n.y:void 0,a=n?n.y:void 0;n?(n.x=r,n.y=i,n.z=s):t.chessToXYZ.set(e,{x:r,y:i,z:s}),Gt(e,t.XYToZMap,o,h,a,r,i,s),jt(e,t.XToChessSet,o,r),jt(e,t.YToChessSet,h,i),jt(e,t.ZToChessSet,a,s)}(this,t,e,r,i),this.clearBounds(),this}getChess(t,e,r){return $t(this,t,e,r)}removeChess(t,e,r){return function(t,e,r,i){if(void 0!==i){let s=$t(t,e,r,i);if(void 0===s)return;t.chessToXYZ.delete(s),Vt(t.XYToZMap,e,r,i),qt(t.XToChessSet,e,s),qt(t.YToChessSet,r,s),qt(t.ZToChessSet,i,s)}else{let i=$t(t,e,r);if(i){for(const[s,n]of i)t.chessToXYZ.delete(n),qt(t.XToChessSet,e,n),qt(t.YToChessSet,r,n),qt(t.ZToChessSet,s,n);Vt(t.XYToZMap,e,r)}}}(this,t,e,r),this.clearBounds(),this}hasChess(t){return function(t,e){return t.chessToXYZ.has(e)}(this,t)}contains(t,e,r){return function(t,e,r,i){return null!==$t(t,e,r,i)}(this,t,e,r)}getXYZ(t){return function(t,e){return t.chessToXYZ.get(e)||null}(this,t)}get xMax(){return void 0===this._xMax&&(this._xMax=Jt(this.XToChessSet)),this._xMax}get xMin(){return void 0===this._xMin&&(this._xMin=Kt(this.XToChessSet)),this._xMin}get yMax(){return void 0===this._yMax&&(this._yMax=Jt(this.YToChessSet)),this._yMax}get yMin(){return void 0===this._yMin&&(this._yMin=Kt(this.YToChessSet)),this._yMin}}let ee=function(t,e){if(!t.infinityMode)if(void 0===t.width||t.width<=e)t.width=e;else{for(let r=e;r<t.width;r++)for(let e=0;e<t.height;e++);t.width=e}},re=function(t,e){if(!t.infinityMode)if(void 0===t.height||t.height<=e)t.height=e;else{for(let r=0;r<t.width;r++)for(let r=e;r<t.height;r++);t.height=e}},ie=function(t,e,r,i){return t.boardData.getChess(e,r,i)};class se{constructor(t){this.parent=t,this.board=null,this.blocker=!1,this.boot()}boot(){"object"==typeof this.parent&&this.parent.on&&this.parent.on("destroy",this.destroy,this)}destroy(){this.board&&this.board.removeChess(this.parent),this.parent=void 0,this.board=null}setBoard(t){return this.board=t,this}get tileXYZ(){return null==this.board?null:this.board.chessToTileXYZ(this.parent)}setTileZ(t){if(null==this.board)return this;let e=this.tileXYZ;return this.board.addChess(this.parent,e.x,e.y,t,!1),this}setBlocker(t=!0){return this.blocker=t,this}setBlockEdge(t,e=!0){"boolean"==typeof this.blocker&&(this.blocker={});let r=this.blocker;if("object"==typeof t){let e=t;for(let t in e)r[t]=e[t]}else r[t]=e;return this}getBlockEdge(t){return"boolean"!=typeof this.blocker&&(!!this.blocker.hasOwnProperty(t)&&this.blocker[t])}}let ne=function(t){return t.hasOwnProperty("rexChess")||(t.rexChess=new se(t)),t.rexChess},oe=function(t,e,r,i){if(void 0===e){let e=t.getAllChess();for(let r=0,i=e.length;r<i;r++){let i=e[r],s=t.chessToTileXYZ(i);t.tileXYToWorldXY(s.x,s.y,i)}}else{if(void 0===r){let s=t.chessToTileXYZ(e);r=s.x,i=s.y}t.tileXYToWorldXY(r,i,e)}},he=function(t,e,r,i){return Math.atan2(i-e,r-t)};const ae=180/Math.PI;let le=function(t){return t*ae},ue=function(t,e){let r=e-t;return 0===r?0:r-360*Math.floor((r- -180)/360)},ce={x:0,y:0};var de,fe;!function(t){t[t.x=1]="x",t[t.horizontal=1]="horizontal",t[t.h=1]="h",t[t.y=2]="y",t[t.vertical=2]="vertical",t[t.v=2]="v",t[t.xy=3]="xy"}(de||(de={})),function(t){t[t["x+,y+"]=0]="x+,y+",t[t["x-,y+"]=1]="x-,y+",t[t["y+,x+"]=2]="y+,x+",t[t["y-,x+"]=3]="y-,x+"}(fe||(fe={}));let xe=function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},ge=function(t,e=0,r=t.length){let i=e+Math.floor(Math.random()*r);return void 0===t[i]?null:t[i]},ye={x:0,y:0},pe=function(t,e,r,i,s){let n=t.chessToTileXYZ(e);if(null===n)return null;"string"==typeof r&&(r=-1===r.indexOf(",")?parseInt(r):r.split(".").map(t=>parseInt(t,10)));let o,h="number"==typeof r,a="number"==typeof i;if(h&&a){let e=t.grid.getTileXYAtDirection(n,r,i,s);return t.getWrapTileXY(e.x,e.y,e),null!==e.x&&null!==e.y||(e=null),e}if(Array.isArray(s)||(s=[]),null===r&&(r=t.grid.allDirections),h)if(Array.isArray(i))for(let e=0,h=i.length;e<h;e++)o=pe(t,n,r,i[e]),null!==o&&s.push(o);else{let e,h,a;if(({end:e=1,start:h=(e>0?1:-1),step:a=(e>=h?1:-1)}=i),h===e)o=pe(t,n,r,e),null!==o&&s.push(o);else if(h<e)for(let i=h;i<=e;i+=a)o=pe(t,n,r,i),null!==o&&s.push(o);else for(let i=h;i>=e;i+=a)o=pe(t,n,r,i),null!==o&&s.push(o)}else for(let e=0,h=r.length;e<h;e++)a?(o=pe(t,n,r[e],i),null!==o&&s.push(o)):pe(t,n,r[e],i,s);return s},Te=function(t,e,r){let i=r-e;return e+((t-e)%i+i)%i},me={x:0,y:0},ve=function(t,e){return!1===t||!0===t?t:!0===t[e]};const we=2*Math.PI;let be=function(t,e,r,i,s){let n=t.chessToTileXYZ(e),o=t.chessToTileXYZ(r),h=t.angleBetween(n,o);var a;a=h,h=(a%=we)>=0?a:a+we;let l=Math.abs(h-i);l=Math.min(l,Ee-l);let u=s/2;return function(t,e,r=1e-4){return Math.abs(t-e)<r}(l,u)||l<u};const Ee=2*Math.PI;let Ce={x:0,y:0},_e={x:0,y:0},Me={x:0,y:0},De=function(t,e,r,i=[]){let s=t.boardData.getChess(e,r);for(const[t,e]of s)i.push(e);return i},Re={x:0,y:0};var Se,Ae;!function(t){t[t.orthogonal=0]="orthogonal",t[t.isometric=1]="isometric"}(Se||(Se={})),function(t){t[t["4dir"]=4]="4dir",t[t["8dir"]=8]="8dir"}(Ae||(Ae={}));const Xe=[[1,0],[0,1],[-1,0],[0,-1],[1,1],[-1,1],[-1,-1],[1,-1]],Ye=Xe;let ke=function(t){let e,r,i,s={};for(let n in t)e=t[n],r=e[0],i=e[1],s.hasOwnProperty(r)||(s[r]={}),s[r][i]=parseInt(n);return s};ke(Xe),ke(Ye);var Ne,Fe,ze;!function(t){t[t.ODD_R=0]="ODD_R",t[t.EVEN_R=1]="EVEN_R",t[t.ODD_Q=2]="ODD_Q",t[t.EVEN_Q=3]="EVEN_Q"}(Ne||(Ne={})),function(t){t[t.y=0]="y",t[t.flat=0]="flat",t[t.x=1]="x",t[t.pointy=1]="pointy"}(Fe||(Fe={})),function(t){t[t.even=0]="even",t[t.odd=1]="odd"}(ze||(ze={}));const Be=Math.sqrt(3);function Pe(t,e,r,i={x:0,y:0,z:0}){switch(!0===i&&(i=Ie),t){case Ne.ODD_R:i.x=e-(r-(1&r))/2,i.z=r;break;case Ne.EVEN_R:i.x=e-(r+(1&r))/2,i.z=r;break;case Ne.ODD_Q:i.x=e,i.z=r-(e-(1&e))/2;break;case Ne.EVEN_Q:i.x=e,i.z=r-(e+(1&e))/2}return i.y=-i.x-i.z,i}function Ue(t,e,r,i,s={x:0,y:0}){switch(!0===s&&(s=Oe),t){case Ne.ODD_R:s.x=e+(i-(1&i))/2,s.y=i;break;case Ne.EVEN_R:s.x=e+(i+(1&i))/2,s.y=i;break;case Ne.ODD_Q:s.x=e,s.y=i+(e-(1&e))/2;break;case Ne.EVEN_Q:s.x=e,s.y=i+(e+(1&e))/2}return s}let Ie={x:0,y:0,z:0},Oe={x:0,y:0},Le={x:0,y:0,z:0},Ze={x:0,y:0,z:0},We={x:0,y:0,z:0},Ge={x:0,y:0,z:0},Ve=function(t,e,r,i={x:0,y:0}){"object"==typeof e&&(r=e.y,e=e.x),!0===i&&(i=He);let s=e*t.width,n=r*t.height;switch(t.mode){case Ne.ODD_R:1&r&&(s+=t._halfWidth),n*=.75;break;case Ne.EVEN_R:1&r&&(s-=t._halfWidth),n*=.75;break;case Ne.ODD_Q:s*=.75,1&e&&(n+=t._halfHeight);break;case Ne.EVEN_Q:s*=.75,1&e&&(n-=t._halfHeight)}return s+=t.x,n+=t.y,i.x=s,i.y=n,i},He={x:0,y:0};const Qe=Math.PI/180;let je=[];let qe=[[[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]]],[[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]],[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]]],[[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]],[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]]],[[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]],[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]]]],$e=function(t){let e,r,i={};for(let s in t)[e,r]=t[s],i.hasOwnProperty(e)||(i[e]={}),i[e][r]=parseInt(s);return i},Je=[[$e(qe[0][0]),$e(qe[0][1])],[$e(qe[1][0]),$e(qe[1][1])],[$e(qe[2][0]),$e(qe[2][1])],[$e(qe[3][0]),$e(qe[3][1])]];function Ke(t,e,r){let i;switch(t){case Ne.ODD_R:case Ne.EVEN_R:i=1&r;break;case Ne.ODD_Q:case Ne.EVEN_Q:i=1&e}return i}let tr=function(t,e,r,i,s={x:0,y:0}){!0===s&&(s=er);let n=t.mode,o=e.x,h=e.y;if(1===i){let t=Ke(n,o,h);s.x=o+qe[n][t][r][0],s.y=h+qe[n][t][r][1]}else if(0===i)s.x=o,s.y=h;else{let t,e,a,l=Pe(n,o,h,!0);switch(r){case 1:t=l.x,e=l.y-i,a=l.z+i;break;case 2:t=l.x-i,e=l.y,a=l.z+i;break;case 3:t=l.x-i,e=l.y+i,a=l.z;break;case 4:t=l.x,e=l.y+i,a=l.z-i;break;case 5:t=l.x+i,e=l.y,a=l.z-i;break;default:t=l.x+i,e=l.y-i,a=l.z}Ue(n,t,0,a,s)}return s},er={x:0,y:0};let rr=function(t,e,r,i={x:0,y:0}){let s,n;switch("object"==typeof e&&(r=e.y,e=e.x),!0===i&&(i=sr),e-=t.x,r-=t.y,t.mode){case Ne.ODD_R:case Ne.EVEN_R:n=r*(4/3)/t.height,s=e/t.width-2/3*(r/t.height);break;case Ne.ODD_Q:case Ne.EVEN_Q:n=r/t.height-2/3*(e/t.width),s=e*(4/3)/t.width}let o=function(t,e,r={x:0,y:0,z:0}){return!0===r&&(r=Ie),r.x=t,r.y=-t-e,r.z=e,r}(s,n,ir);return function(t,e,r,i={x:0,y:0,z:0}){"number"!=typeof t&&(t=(i=t).x,e=i.y,r=i.z),!0===i&&(i=Ie);let s=Math.round(t),n=Math.round(e),o=Math.round(r),h=Math.abs(s-t),a=Math.abs(n-e),l=Math.abs(o-r);h>a&&h>l?s=-n-o:a>l?n=-s-o:o=-s-n,i.x=s,i.y=n,i.z=o}(o),Ue(t.mode,o.x,o.y,o.z,i),i},ir={x:0,y:0,z:0},sr={x:0,y:0},nr={x:0,y:0},or={x:0,y:0},hr={x:0,y:0};class ar extends class{constructor({x:t=0,y:e=0,radius:r,cellWidth:i=0,cellHeight:s=0,staggerAxis:n=Fe.x,staggerIndex:o=ze.odd}={}){this.setType(n,o),this.setDirectionMode(),this.setOriginPosition(t,e),void 0!==r?this.setRadius(r):this.setCellSize(i,s)}fromJSON({x:t=0,y:e=0,radius:r,cellWidth:i=0,cellHeight:s=0,staggerAxis:n=Fe.x,staggerIndex:o=ze.odd}={}){return this.setType(n,o),this.setDirectionMode(),this.setOriginPosition(t,e),void 0!==r?this.setRadius(r):this.setCellSize(i,s),this}toJSON(){return{x:this.x,y:this.y,radius:this.radius,cellWidth:this.cellWidth,cellHeight:this.cellHeight,staggerAxis:this.staggerAxis,staggerIndex:this.staggerIndex}}setOriginPosition(t,e){return this.x=t,this.y=e,this}get width(){return this._width}set width(t){this._width=t,this._halfWidth=t/2}get height(){return this._height}set height(t){this._height=t,this._halfHeight=t/2}setCellSize(t=0,e=0){return this.width=t,this.height=e,this.radius=void 0,this}get cellWidth(){return this.width}set cellWidth(t){this.width=t}get cellHeight(){return this.height}set cellHeight(t){this.height=t}setRadius(t=0){let e,r;return this.staggerAxis===Fe.y?(e=2*t,r=Be*t):(e=Be*t,r=2*t),this.setCellSize(e,r),this.radius=t,this}setDirectionMode(){return this.directions=6,this}setType(t=1,e=1){return"string"==typeof t&&(t=Fe[t]),"string"==typeof e&&(e=ze[e]),this.staggerAxis=t,this.staggerIndex=e,t===Fe.y?this.mode=e===ze.even?Ne.EVEN_Q:Ne.ODD_Q:this.mode=e===ze.even?Ne.EVEN_R:Ne.ODD_R,this}}{get sides(){return 6}get allDirections(){return lr}get halfDirections(){return ur}directionBetween(t,e,r=!0){return function(t,e,r,i=!0){let s;Pe(t.mode,e.x,e.y,Le),Pe(t.mode,r.x,r.y,Ze);let n=Ze.x-Le.x,o=Ze.y-Le.y,h=Ze.z-Le.z;return s=0===h?n>0?0:3:0===n?h>0?1:4:0===o?h>0?2:5:n>0&&o<0&&h>0?0+h/-o:n<0&&o<0&&h>0?1+-o/h:n<0&&o>0&&h>0?2+o/-n:n<0&&o>0&&h<0?3+-h/o:n>0&&o>0&&h<0?4+n/-h:5+-o/n,i&&(s=Math.round(s)),s}(this,t,e,r)}directionNormalize(t){return function(t,e){return function(t,e,r){let i=r-e;return e+((t-e)%i+i)%i}(e,0,t.directions)}(this,t)}getDistance(t,e,r=!1){return function(t,e,r,i=!1){Pe(t.mode,e.x,e.y,We),Pe(t.mode,r.x,r.y,Ge);let s=Ge.x-We.x,n=Ge.y-We.y,o=Ge.z-We.z;return(Math.abs(s)+Math.abs(n)+Math.abs(o))/2}(this,t,e,r)}getGridPoints(t=0,e=0,r=[]){return function(t,e=0,r=0,i=[]){if("object"==typeof e){let t=e;r=t.y,e=t.x}let s,n;if(!0===i&&(i=je),function(t,e=[]){if(e.length===t);else if(e.length<t)for(let r=e.length;r<t;r++)e.push({x:0,y:0});else e.length=t}(6,i),({x:s,y:n}=Ve(t,e,r)),void 0!==t.radius){let e=t.radius,r=t.staggerAxis===Fe.flat?0:-30;for(let t=0;t<6;t++){let o=(60*t+r)*Qe;i[t].x=s+e*Math.cos(o),i[t].y=n+e*Math.sin(o)}}else{let e=t._halfWidth,r=e/2,o=t._halfHeight,h=o/2;t.staggerAxis===Fe.flat?(i[0].x=s+e,i[0].y=n,i[1].x=s+r,i[1].y=n+o,i[2].x=s-r,i[2].y=n+o,i[3].x=s-e,i[3].y=n,i[4].x=s-r,i[4].y=n-o,i[5].x=s+r,i[5].y=n-o):(i[0].x=s+e,i[0].y=n-h,i[1].x=s+e,i[1].y=n+h,i[2].x=s,i[2].y=n+o,i[3].x=s-e,i[3].y=n+h,i[4].x=s-e,i[4].y=n-h,i[5].x=s,i[5].y=n-o)}return i}(this,t,e,r)}getNeighborTileDirection(t,e){return function(t,e,r){let i=t.mode,s=Ke(i,e.x,e.y),n=Je[i][s],o=r.x-e.x,h=r.y-e.y;if(n.hasOwnProperty(o)){let t=n[o];if(t.hasOwnProperty(h))return t[h]}return null}(this,t,e)}getNeighborTileXY(t,e,r={x:0,y:0}){return function(t,e,r,i={x:0,y:0}){return tr(t,e,r,1,i)}(this,t,e,r)}getOppositeDirection(t,e,r){return function(t,e,r,i){return(i+3)%6}(0,0,0,r)}getTileXY(t,e,r={x:0,y:0}){return rr(this,t,e,r)}getTileXYAtDirection(t,e,r,i={x:0,y:0}){return tr(this,t,e,r,i)}getWorldXY(t,e,r={x:0,y:0}){return Ve(this,t,e,r)}mirror(t,e,r={x:0,y:0}){return function(t,e,r,i={x:0,y:0}){"string"==typeof r&&(r=de[r]),!0===i&&(i=nr);let s,n,o,h=Pe(t.mode,e.x,e.y,!0),a=t.mode===Ne.ODD_R||t.mode===Ne.EVEN_R;return 1&r&&(a?(s=h.y,n=h.x,o=h.z):(s=-h.x,n=-h.z,o=-h.y),h.x=s,h.y=n,h.z=o),2&r&&(a?(s=-h.y,n=-h.x,o=-h.z):(s=h.x,n=h.z,o=h.y)),Ue(t.mode,s,0,o,i),i}(this,t,e,r)}offset(t,e,r,i={x:0,y:0}){return function(t,e,r,i,s={x:0,y:0}){!0===s&&(s=or);let n=e.x+r,o=e.y+i;switch(t.mode){case Ne.ODD_R:0!=(1&i)&&0==(1&o)&&(n+=1);break;case Ne.EVEN_R:0!=(1&i)&&0==(1&o)&&(n-=1);break;case Ne.ODD_Q:0!=(1&r)&&0==(1&n)&&(o+=1);break;case Ne.EVEN_Q:0!=(1&r)&&0==(1&n)&&(o-=1)}return s.x=n,s.y=o,s}(this,t,e,r,i)}ringToTileXYArray(t,e,r=[]){return function(t,e,r,i=[]){let s,n,o,h=Pe(t.mode,e.x,e.y,!0),a=h.x,l=(h.y,h.z);for(o=r,s=0;s>=-r;s--)n=-s-o,i.push(Ue(t.mode,a+s,0,l+o));for(s=-r,n=1;n<=r;n++)o=-s-n,i.push(Ue(t.mode,a+s,0,l+o));for(n=r,o=-1;o>=-r;o--)s=-n-o,i.push(Ue(t.mode,a+s,0,l+o));for(o=-r,s=1;s<=r;s++)n=-s-o,i.push(Ue(t.mode,a+s,0,l+o));for(s=r,n=-1;n>=-r;n--)o=-s-n,i.push(Ue(t.mode,a+s,0,l+o));for(n=-r,o=1;o<=r-1;o++)s=-n-o,i.push(Ue(t.mode,a+s,0,l+o));return i}(this,t,e,r)}rotate(t,e,r={x:0,y:0}){return function(t,e,r,i={x:0,y:0}){!0===i&&(i=hr),r=Te(r,0,5);let s,n,o,h=Pe(t.mode,e.x,e.y,!0);switch(r){case 1:s=-h.z,n=-h.x,o=-h.y;break;case 2:s=h.y,n=h.z,o=h.x;break;case 3:s=-h.x,n=-h.y,o=-h.z;break;case 4:s=h.z,n=h.x,o=h.y;break;case 5:s=-h.y,n=-h.z,o=-h.x;break;default:s=h.x,n=h.y,o=h.z}return Ue(t.mode,s,0,o,i),i}(this,t,e,r)}restoreOrigin(){var t;return(t=this).x=t._savedOriginX,t.y=t._savedOriginY,this}saveOrigin(){var t;return(t=this)._savedOriginX=t.x,t._savedOriginY=t.y,this}}const lr=[0,1,2,3,4,5],ur=[0,1,2];var cr;!function(t){t[t.random=0]="random",t[t.diagonal=1]="diagonal",t[t.straight=2]="straight",t[t.line=3]="line",t[t.astar=10]="astar",t[t["astar-random"]=11]="astar-random",t[t["astar-line"]=12]="astar-line"}(cr||(cr={}));class dr{constructor(t){this.createNodeCallback=t,this.nodePool=new Lt,this.nodes=new Map,this.sn=0}getNode(t,e=!1){if(!this.nodes.has(t)){if(!e)return null;let r=this.nodePool.pop();null===r&&(r=this.createNodeCallback(),r.manager=this),r.sn=this.sn,r.reset(t),this.nodes.set(t,r)}this.sn++;let r=this.nodes.get(t);return r.sn=this.sn,r}freeAllNodes(){let t=this.nodePool;for(const[e,r]of this.nodes)r.shutdown(),t.push(r);return this.nodes.clear(),this.sn=0,this}getAllNodes(){return this.nodes}}let fr=new class{constructor(t){this.content=[],this.scoreFunction=t}clear(){this.content.length=0}push(t){this.content.push(t),this.sinkDown(this.content.length-1)}pop(){let t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.bubbleUp(0)),t}remove(t){let e=this.content.indexOf(t),r=this.content.pop();e!==this.content.length-1&&(this.content[e]=r,this.scoreFunction(r)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))}get size(){return this.content.length}rescoreElement(t){this.sinkDown(this.content.indexOf(t))}sinkDown(t){let e=this.content[t];for(;t>0;){let r=(t+1>>1)-1,i=this.content[r];if(!(this.scoreFunction(e)<this.scoreFunction(i)))break;this.content[r]=e,this.content[t]=i,t=r}}bubbleUp(t){let e=this.content.length,r=this.content[t],i=this.scoreFunction(r);for(;;){let s,n=t+1<<1,o=n-1,h=null;if(o<e){let t=this.content[o];s=this.scoreFunction(t),s<i&&(h=o)}if(n<e){let t=this.content[n];this.scoreFunction(t)<(null===h?i:s)&&(h=n)}if(null===h)break;this.content[t]=this.content[h],this.content[h]=r,t=h}}}(t=>t.f),xr=function(t,e,r,i){const s=null!==r,n=(o=t.pathMode)===cr.astar||o===cr["astar-line"]||o===cr["astar-random"];var o;const h=s&&!n,a=s&&n?t.pathMode:null;let l=t.nodeManager;l.freeAllNodes();let u=l.getNode(e,!0),c=s?l.getNode(r,!0):null;u.h=u.heuristic(c,a);let d=null;for(s&&(d=u,d.closerH=d.h||d.heuristic(c,cr.astar)),fr.push(u);fr.size>0;){let t=fr.pop();if(s&&t===c){d=c;break}t.closed=!0;let e,r,n=t.getNextNodes();for(let o=0,l=n.length;o<l;++o){if(e=n[o],r=e.getCost(t),e.closed||null===r)continue;let l=t.g+r,f=e.visited;void 0!==i&&l>i||(!f||l<e.g?(e.visited=!0,e.prevNodes.length=0,e.prevNodes.push(t),void 0===e.h&&(e.h=e.heuristic(c,a,u)),e.g=l,e.f=e.g+e.h,s&&(void 0===e.closerH&&(e.closerH=e.h||e.heuristic(c,cr.astar)),(e.closerH<d.closerH||e.closerH===d.closerH&&e.g<d.g)&&(d=e)),f?fr.rescoreElement(e):fr.push(e)):h&&l==e.g&&e.prevNodes.push(t))}}l.closestNode=d,fr.clear()},gr=function(t,e,r=[]){let i=e;for(;i.prevNodes.length>0;)r.push(i),i=i.prevNodes[0];return r.reverse()},yr={};yr[cr.astar]=gr,yr[cr["astar-line"]]=gr,yr[cr["astar-random"]]=gr,yr[cr.random]=function(t,e,r=[]){let i=e;for(;i.prevNodes.length>0;)r.push(i),i=1===i.prevNodes.length?i.prevNodes[0]:ge(i.prevNodes);return r.reverse()},yr[cr.line]=function(t,e,r=[]){let i=e,s=e.angleTo(t);for(;i.prevNodes.length>0;)if(r.push(i),1===i.prevNodes.length)i=i.prevNodes[0];else{let t=1/0;for(let r=1,n=i.prevNodes.length;r<n;r++){let n=i.prevNodes[r],o=Math.abs(e.angleTo(n)-s);o<t&&(t=o,i=n)}}return r.reverse()},yr[cr.diagonal]=function(t,e,r=[]){let i,s=e;for(;s.prevNodes.length>0;)if(r.push(s),1===s.prevNodes.length||void 0===i){let t=s.prevNodes[0];i=t.logicDirTo(s),s=t}else{let t,e;for(let r=0,n=s.prevNodes.length;r<n&&(t=s.prevNodes[r],e=t.logicDirTo(s),e===i);r++);i=e,s=t}return r.reverse()},yr[cr.straight]=function(t,e,r=[]){let i,s=e;for(;s.prevNodes.length>0;)if(r.push(s),1===s.prevNodes.length||void 0===i){let t=s.prevNodes[0];i=t.logicDirTo(s),s=t}else{let t,e;for(let r=0,n=s.prevNodes.length;r<n&&(t=s.prevNodes[r],e=t.logicDirTo(s),e!==i);r++);i=e,s=t}return r.reverse()};class pr{constructor(t){this.nodeManager=new dr(t)}setPathMode(t){return"string"==typeof t&&(t=cr[t]),this.pathMode=t,this}setWeight(t){return this.nodeManager.weight=t,this}search(t,e,r){return xr(this,t,e,r),this}getAllNodes(){return this.nodeManager.getAllNodes()}getNode(t){return this.nodeManager.getNode(t)}getClosestNode(){return this.nodeManager.closestNode}getNodePath(t,e){return function(t,e,r){let i=t.nodeManager,s=i.getNode(r),n=[];if(null===s)return n;let o=i.getNode(e);return yr[t.pathMode](o,s,n)}(this,t,e)}}let Tr=function(t){for(let e=t.length-1;e>0;e--){let r=Math.floor(Math.random()*(e+1)),i=t[e];t[e]=t[r],t[r]=i}return t},mr=function(t,e){return`${t}|${e}`},vr={x:0,y:0};class wr extends class{constructor(){this.prevNodes=[]}shutdown(){this.key=void 0,this.prevNodes.length=0}destroy(){this.shutdown()}reset(t){this.key=t,this.f=0,this.g=0,this.h=void 0,this.closerH=void 0,this.visited=!1,this.closed=!1}heuristic(t,e,r){if(null===e)return 0;let i,s=this.distanceTo(t)*this.manager.weight;switch(e){case cr.astar:i=s;break;case cr["astar-line"]:if(void 0!==r){let e=t.angleTo(r)-this.angleTo(r);i=s+Math.abs(e)}else i=s;case cr["astar-random"]:i=s+Math.random();break;default:i=s}return i}getNextNodes(){return[]}getCost(t){return null}distanceTo(t){return 0}angleTo(t){return 0}logicDirTo(t){return 0}getNode(t,e=!1){return this.manager.getNode(t,e)}}{constructor(t){super(),this.isTileXYZ=!0,this.pathFinder=t}reset(t){super.reset(t),this.key=t,function(t,e){let r=t.split("|");void 0===e&&(e=vr),e.x=parseInt(r[0]),e.y=parseInt(r[1])}(t,this),this._px=void 0,this._py=void 0,this.cost=void 0}getNextNodes(){let t=this.board.getNeighborTileXY(this);this.pathFinder.shuffleNeighbors&&Tr(t);let e=[];return t.forEach(t=>{let r=this.getNode(mr(t.x,t.y),!0);e.push(r)}),e}getCost(t){return this.pathFinder.cacheCost?void 0===this.cost&&(this.cost=this.pathFinder.getCost(this,t)):this.cost=this.pathFinder.getCost(this,t),this.cost}distanceTo(t){return this.board.getDistance(this,t,!0)}angleTo(t){return he(this.worldX,this.wroldY,t.worldX,t.worldX)}logicDirTo(t){return this.board.getNeighborTileDirection(this,t)}get board(){return this.pathFinder.board}get worldX(){if(void 0===this._px){let t=this.board.tileXYToWorldXY(this.x,this.y,!0);this._px=t.x,this._py=t.y}return this._px}get wroldY(){if(void 0===this._py){let t=this.board.tileXYToWorldXY(this.x,this.y,!0);this._px=t.x,this._py=t.y}return this._py}}let br=function(t,e,r=[]){let i=t.board.chessToTileXYZ(e),s=t.startTileXYZ;return t.astar.setPathMode(t.pathMode).getNodePath(mr(s.x,s.y),mr(i.x,i.y)).forEach((function(t){r.push({x:t.x,y:t.y,cost:t.g})})),r};class Er{constructor({board:t,cost:e=1,costCallback:r,costCallbackScope:i,occupiedTest:s=!1,blockerTest:n=!1,edgeBlockerTest:o=!1,pathMode:h=cr.astar,cacheCost:a=!0,weight:l=10,shuffleNeighbors:u=!1}={}){var c;this.setBoard(t),r?this.setCostFunction(r,i):(this.setConstCost(e),this.setCostFunction(null)),this.setPathMode(h),this.setOccupiedTest(s),this.setBlockerTest(n),this.setEdgeBlockerTest(o),this.setCacheCostMode(a),this.setWeight(l),this.setShuffleNeighborsMode(u),this.astar=(c=this,new pr((function(){return new wr(c)})))}setBoard(t){return this.board=t,this}setConstCost(t){return this.constCost=t,this}setCostFunction(t,e){return this.costCallback=t,this.costCallbackScope=e,this}setPathMode(t){return"string"==typeof t&&(t=cr[t]),this.pathMode=t,this}setOccupiedTest(t=!0){return this.occupiedTest=t,this}setBlockerTest(t=!0){return this.blockerTest=t,this}setEdgeBlockerTest(t=!0){return this.edgeBlockerTest=t,this}setCacheCostMode(t=!0){return this.cacheCost=t,this}setWeight(t){return this.weight=t,this}setShuffleNeighborsMode(t=!0){return this.shuffleNeighbors=t,this}getCost(t,e){return function(t,e,r){if(t.occupiedTest&&t.board.contains(e.x,e.y,t.startTileXYZ.z))return null;if(t.blockerTest&&t.board.hasBlocker(e.x,e.y))return null;t.edgeBlockerTest;let i=t.costCallback;if(i){let s,n=t.costCallbackScope;return s=n?i.call(n,e,r,t):i(e,r,t),void 0===s&&(s=null),s}return t.constCost}(this,t,e)}findArea(t,e,r=[]){return function(t,e,r,i=[]){let s=t.board;if(!s.hasChess(e))return i;if(void 0!==r&&r<=0)return i;let n=t.astar,o=s.chessToTileXYZ(e),h=o.x,a=o.y;t.startTileXYZ=o;let l=mr(h,a);n.search(l,null,r);let u=n.getAllNodes(),c=[];for(const[t,e]of u)e.x===h&&e.y===a||e.closed&&c.push(e);return c.sort((function(t,e){let r=t.sn,i=e.sn;return r>i?1:r<i?-1:0})),c.forEach((function(t){i.push({x:t.x,y:t.y,cost:t.g})})),i}(this,t,e,r)}get BLOCKER(){return null}findPath(t,e,r,i=!0,s=[]){return function(t,e,r,i,s=!0,n=[]){let o=t.board;if(!o.hasChess(e))return n;if(void 0!==i&&i<=0)return n;let h=t.astar,a=o.chessToTileXYZ(e),l=o.chessToTileXYZ(r);t.startTileXYZ=a;let u=mr(a.x,a.y),c=mr(l.x,l.y);h.setPathMode(t.pathMode).setWeight(t.weight).search(u,c,i);let d=s?h.getClosestNode():h.getNode(c);return null===d?n:br(t,d,n)}(this,t,e,r,i,s)}getPath(t,e=[]){return br(this,t,e)}}let Cr=function(t,e,r,i=1){let s;if("string"==typeof t){let e=vt();e.has(t)||e.add(t,function(t=32,e=32){const r=Tt(t,e);return new z(r.canvas)}()),s=e.get(t)}else s=t;let n=s.image,o=n.getContext("2d");return r?e.call(r,n,o):e(n,o),s.setSize(n.width/i,n.height/i),s.binding&&s.binding.update(),s},_r=function(t,e,r){switch(typeof t){case"number":return"#"+t.toString(16);case"function":return t(e,r);default:return t}},Mr=function(t,{points:e,fillStyle:r,strokeStyle:i,lineWidth:s=2,lineJoin:n="round"}={points:[]}){return Cr(t,(function(t,o){if(0===e.length)return t.width=1,void(t.height=1);i||(s=0);let h=Rr(e,"x"),a=Rr(e,"y"),l=Dr(e,"x")-h,u=Dr(e,"y")-a,c=l/2,d=u/2,f=s/2;t.width=Math.ceil(l),t.height=Math.ceil(u),o.beginPath(),o.lineJoin=n;let x=e[0];o.moveTo(Sr(x.x-h,c,f),Sr(x.y-a,d,f));for(let t=1,r=e.length;t<r;t++)x=e[t],o.lineTo(Sr(x.x-h,c,f),Sr(x.y-a,d,f));o.closePath(),r&&(o.fillStyle=_r(r,t,o),o.fill()),i&&(o.strokeStyle=_r(i,t,o),o.lineWidth=s,o.stroke())}))},Dr=function(t,e){let r=-1/0;for(let i=0,s=t.length;i<s;i++)r=Math.max(r,t[i][e]);return r},Rr=function(t,e){let r=1/0;for(let i=0,s=t.length;i<s;i++)r=Math.min(r,t[i][e]);return r},Sr=function(t,e,r){return t<e?t+r:t>e?t-r:t};var Ar,Xr,Yr;!function(t){t[t.right=0]="right",t[t.down=1]="down",t[t.left=2]="left",t[t.up=3]="up"}(Ar||(Ar={}));class kr extends class extends class{constructor({grid:t,wrap:e=!1,inifinity:r=!1,width:i=0,height:s=0}={}){this.boardData=new te,this._isBoard=!0,this.setGrid(t),this.setWrapMode(e),this.setInfinityMode(r),this.setBoardSize(i,s)}destroy(){}setGrid(t){return this.grid=t,this}setWrapMode(t=!0){return this.wrapMode=t,this}setInfinityMode(t=!0){return this.infinityMode=t,this}setBoardSize(t=0,e=0){return ee(this,t),re(this,e),this}addChess(t,e,r,i,s=!0){return function(t,e,r,i,s,n=!0){if(!t.contains(r,i))return;let o=t.chessToTileXYZ(e);void 0===s&&(s=o?o.z:0),o&&o.x===r&&o.y===i&&o.z===s||(ie(t,r,i,s)&&t.removeChess(null,r,i,s),t.boardData.addChess(e,r,i,s),t._isBoard&&ne(e).setBoard(t),n&&oe(t,e,r,i))}(this,t,e,r,i,s),this}angleBetween(t,e){return function(t,e,r){let i=t.chessToTileXYZ(e),s=t.chessToTileXYZ(r),n=t.tileXYToWorldXY(i.x,i.y,!0),o=n.x,h=n.y;n=t.tileXYToWorldXY(s.x,s.y,!0);let a=n.x,l=n.y;return he(o,h,a,l)}(this,t,e)}angleSnapToDirection(t,e){return function(t,e,r){r=le(r);let i=t.grid.allDirections,s=1/0,n=void 0;for(let o=0,h=i.length;o<h;o++){let h=le(t.angleToward(e,i[o])),a=Math.abs(ue(r,h));a<s&&(s=a,n=o)}return n}(this,t,e)}angleToward(t,e){return function(t,e,r){void 0===e&&(e=ce);let i=t.wrapMode,s=t.infinityMode;t.wrapMode=!1,t.infinityMode=!0;let n=t.getNeighborTileXY(e,r,!0);return t.wrapMode=i,t.infinityMode=s,t.angleBetween(e,n)}(this,t,e)}areNeighbors(t,e){return function(t,e,r){return null!==t.getNeighborChessDirection(e,r)}(this,t,e)}chessToTileXYZ(t){return function(t,e){let r=t.boardData.getXYZ(e);return r||((i=e)&&(function(t){if("object"!=typeof t||t.nodeType||t===t.window)return!1;try{if(t.constructor&&!{}.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0}(i)||i.isTileXYZ)&&i.hasOwnProperty("x")&&i.hasOwnProperty("y")?e:null);var i}(this,t)}contains(t,e,r){return function(t,e,r,i){let s;return s=!!t.infinityMode||e>=0&&e<t.width&&r>=0&&r<t.height,s&&void 0!==i&&(s=t.boardData.contains(e,r,i)),s}(this,t,e,r)}directionBetween(t,e,r=!0){return function(t,e,r,i=!0){let s=t.chessToTileXYZ(e),n=t.chessToTileXYZ(r);return null===s||null===n?null:t.grid.directionBetween(s,n,i)}(this,t,e,r)}filledRingToTileXYArray(t,e,r=!0,i=[]){return function(t,e,r,i=!0,s=[]){for(let n=0;n<=r;n++){let o=i?n:r-n;t.ringToTileXYArray(e,o,s)}return s}(this,t,e,r,i)}fit(t){return function(t,e){let r,i=1/0,s=1/0;for(let t=0,n=e.length;t<n;t++)r=e[t],i=Math.min(i,r.x),s=Math.min(s,r.y);if(0!==i||0!==s)for(let n=0,o=e.length;n<o;n++)r=e[n],t.offset(r,-i,-s,r);let n=-1/0,o=-1/0;for(let t=0,i=e.length;t<i;t++)r=e[t],n=Math.max(n,r.x),o=Math.max(o,r.y);return t.setBoardSize(n+1,o+1),e}(this,t)}forEachTileXY(t,e,r=0){return function(t,e,r,i=fe["x+,y+"]){let s={x:0,y:0};switch(i){case fe["x+,y+"]:for(let i=0;i<t.height;i++)for(let n=0;n<t.width;n++)s.x=n,s.y=i,r?e.call(r,s,t):e(s,t);break;case fe["x-,y+"]:for(let i=0;i<t.height;i++)for(let n=t.width-1;n>=0;n--)s.x=n,s.y=i,r?e.call(r,s,t):e(s,t);break;case fe["y+,x+"]:for(let i=0;i<t.width;i++)for(let n=0;n<t.height;n++)s.x=i,s.y=n,r?e.call(r,s,t):e(s,t);break;case fe["y-,x+"]:for(let i=0;i<t.width;i++)for(let n=t.height-1;n>=0;n--)s.x=i,s.y=n,r?e.call(r,s,t):e(s,t)}}(this,t,e,r),this}getAllChess(t=[]){return function(t,e=[]){let r=t.boardData.chessToXYZ;for(const[t,i]of r)e.push(t);return e}(this,t)}getChessData(t){return ne(t)}getDistance(t,e,r=!1){return function(t,e,r,i){return t.grid.getDistance(e,r,i)}(this,t,e,r)}getEmptyTileXYArray(t=0,e=[]){return function(t,e=0,r=[]){if(Array.isArray(e)){let i=e;for(let e=0;e<t.height;e++)for(let s=0;s<t.width;s++){let n=!0;for(let r=0,o=i.length;r<o;r++)if(null!==t.tileXYZToChess(s,e,i[r])){n=!1;break}n&&r.push({x:s,y:e})}}else for(let i=0;i<t.height;i++)for(let s=0;s<t.width;s++)null===t.tileXYZToChess(s,i,e)&&r.push({x:s,y:i});return r}(this,t,e)}getGridPoints(t,e,r){return function(t,e,r,i){return t.grid.getGridPoints(e,r,i)}(this,t,e,r)}getNeighborChess(t,e,r,i){return function(t,e,r,i,s){let n=t.chessToTileXYZ(e);if(null===n)return null;null==i&&(i=n.hasOwnProperty("z")?n.z:null);let o=t.getNeighborTileXY(n,r,!0);return null===o?null:Array.isArray(o)?(void 0===s&&(s=[]),t.tileXYArrayToChessArray(o,i,s)):null==i?(void 0===s&&(s=[]),t.tileXYToChessArray(o.x,o.y,s)):t.tileXYZToChess(o.x,o.y,i)}(this,t,e,r,i)}getNeighborChessDirection(t,e){return function(t,e,r){let i=t.chessToTileXYZ(e),s=t.chessToTileXYZ(r);return t.getNeighborTileDirection(i,s)}(this,t,e)}getNeighborTileDirection(t,e){return function(t,e,r){if(null===e||null===r)return null;if(e.x===r.x&&e.y===r.y)return null;let i=t.grid.getNeighborTileDirection(e,r);if(t.wrapMode&&null===i){let s=t.getNeighborTileXY(e,null);for(let t=0,e=s.length;t<e;t++){let e=s[t];if(r.x===e.x&&r.y===e.y){i=t;break}}}return i}(this,t,e)}getNeighborTileXY(t,e=null,r={x:0,y:0}){return function(t,e,r=null,i={x:0,y:0}){return t.getTileXYAtDirection(e,r,1,i)}(this,t,e,r)}getNeighborTileXYAtAngle(t,e,r={x:0,y:0}){return function(t,e,r,i={x:0,y:0}){let s=t.angleSnapToDirection(e,r);return t.getTileXYAtDirection(e,s,1,i)}(this,t,e,r)}getOppositeDirection(t,e,r){return function(t,e,r,i){return t.grid.getOppositeDirection(e,r,i)}(this,t,e,r)}getRandomEmptyTileXY(t=0,e={x:0,y:0}){return function(t,e=0,r={x:0,y:0}){!0===r&&(r=ye);let i=Math.floor(t.width*t.height*.1);for(let s=0;s<i;s++){let i=xe(0,t.width-1),s=xe(0,t.height-1);if(null===t.tileXYZToChess(i,s,e))return r.x=i,r.y=s,r}let s=t.getEmptyTileXYArray(e);if(0===s.length)return null;{let t=ge(s);return r.x=t.x,r.y=t.y,r}}(this,t,e)}getTileXYAtDirection(t,e,r,i){return pe(this,t,e,r,i)}getWrapTileXY(t,e,r={x:0,y:0}){return function(t,e,r,i={x:0,y:0}){return!0===i&&(i=me),t.wrapMode?e=Te(e,0,t.width):!t.infinityMode&&(e<0||e>=t.width)&&(e=null),t.wrapMode?r=Te(r,0,t.height):!t.infinityMode&&(r<0||r>=t.height)&&(r=null),i.x=e,i.y=r,i}(this,t,e,r)}gridAlign(t,e,r){return oe(this,t,e,r),this}hasBlocker(t,e,r){return function(t,e,r,i){if(void 0===i){let i=t.tileXYToChessArray(e,r);for(let e=0,r=i.length;e<r;e++){if(!0===t.getChessData(i[e]).blocker)return!0}return!1}{let s=t.tileXYZToChess(e,r,i);return null!==s&&!0===t.getChessData(s).blocker}}(this,t,e,r)}hasChess(t){return function(t,e){return t.boardData.chessToXYZ.has(e)}(this,t)}hasEdgeBlocker(t,e,r,i){return function(t,e,r,i,s){if(void 0===i){let i=t.tileXYToChessArray(e,r);for(let e=0,r=i.length;e<r;e++)if(ve(t.getChessData(i[e]).blocker,s))return!0;return!1}{let n=t.tileXYZToChess(e,r,i);return null!==n&&ve(t.getChessData(n).blocker,s)}}(this,t,e,r,i)}isAngleInCone(t,e,r,i){return be(this,t,e,r,i)}isDirectionInCone(t,e,r,i){return function(t,e,r,i,s){let n=t.chessToTileXYZ(e),o=t.chessToTileXYZ(r),h=t.grid.directions;t.grid.directions=t.grid.sides;let a=t.grid.directionBetween(n,o,!1);t.grid.directions=h;let l=Math.abs(a-i);return l=Math.min(l,t.grid.directions-l),l<=s/2}(this,t,e,r,i)}isOverlappingPoint(t,e,r){return function(t,e,r,i){if(t.infinityMode&&void 0===i)return!0;let s=t.worldXYToTileXY(e,r,!0);return t.contains(s.x,s.y,i)}(this,t,e,r)}mirror(t,e,r=null,i={x:0,y:0}){return function(t,e,r,i=null,s={x:0,y:0}){return!0===s&&(s=Ce),null!==i?t.offset(e,-i.x,-i.y,s):(s.x=e.x,s.y=e.y),t.grid.mirror(s,r,s),null!==i&&t.offset(s,i.x,i.y,s),s}(this,t,e,r,i)}offset(t,e,r,i){return function(t,e,r,i,s={x:0,y:0}){return!0===s&&(s=_e),0===r&&0===i?(s.x=e.x,s.y=e.y):t.grid.offset(e,r,i,s),s}(this,t,e,r,i)}removeAllChess(t=!1,e=!1){return function(t,e=!1,r=!1){let i=t.getAllChess();for(let s=0,n=i.length;s<n;s++)t.removeChess(i[s],void 0,void 0,void 0,e,r)}(this,t,e),this}removeChess(t,e,r,i,s=!1,n=!1){return function(t,e,r,i,s,n=!1,o=!1){if(e){let n=t.chessToTileXYZ(e);if(!n)return;r=n.x,i=n.y,s=n.z}else if(!(e=ie(t,r,i,s)))return;o||t.boardData.removeChess(r,i,s),t._isBoard&&ne(e).setBoard(null),n&&e.destroy&&e.destroy()}(this,t,e,r,i,s,n),this}ringToTileXYArray(t,e=1,r=[]){return function(t,e,r=1,i=[]){let s=t.grid.ringToTileXYArray(e,r);for(let e=0,r=s.length;e<r;e++){let r=s[e];t.contains(r.x,r.y)&&i.push(r)}return i}(this,t,e,r)}rotate(t,e,r=null,i={x:0,y:0}){return function(t,e,r,i=null,s={x:0,y:0}){return!0===s&&(s=Me),null!==i?t.offset(e,-i.x,-i.y,s):(s.x=e.x,s.y=e.y),t.grid.rotate(s,r,s),null!==i&&t.offset(s,i.x,i.y,s),s}(this,t,e,r,i)}setBoardWidth(t=0){return ee(this,t),this}setBoardHeight(t=0){return re(this,t),this}swapChess(t,e,r=!0){return function(t,e,r,i=!0){let s=t.chessToTileXYZ(e),n=t.chessToTileXYZ(r);null!=s&&null!=n&&(t.removeChess(e),t.removeChess(r),t.addChess(e,n.x,n.y,n.z,i),t.addChess(r,s.x,s.y,s.z,i))}(this,t,e,r),this}tileXYArrayToChessArray(t,e,r=[]){return function(t,e,r,i=[]){let s,n,o=null!=r;for(let h=0,a=e.length;h<a;h++)s=e[h],o?(n=ie(t,s.x,s.y,r),null!==n&&i.push(n)):De(t,s.x,s.y,i);return i}(this,t,e,r)}tileXYToChessArray(t,e,r=[]){return De(this,t,e,r)}tileXYZToChess(t,e,r){return ie(this,t,e,r)}tileZToChessArray(t,e=[]){return function(t,e,r=[]){let i=t.boardData.ZToChessSet.get(e);if(i)for(const t of i)r.push(t);return r}(this,t,e)}tileXYArrayToWorldXYArray(t,e=[]){return function(t,e,r=[]){for(let i=0,s=e.length;i<s;i++){let s=e[i];r.push(t.tileXYToWorldXY(s.x,s.y))}return r}(this,t,e)}tileXYToWorldXY(t,e,r={x:0,y:0}){return function(t,e,r,i){return t.grid.getWorldXY(e,r,i)}(this,t,e,r)}worldXYSnapToGrid(t,e,r={x:0,y:0}){return function(t,e,r,i={x:0,y:0}){return!0===i&&(i=Re),t.worldXYToTileXY(e,r,i),t.tileXYToWorldXY(i.x,i.y,i),i}(this,t,e,r)}worldXYToChess(t,e,r,i){return function(t,e,r,i,s){let n=t.worldXYToTileXY(e,r,!0);return void 0!==i?t.tileXYZToChess(n.x,n.y,i):t.tileXYToChessArray(n.x,n.y,s)}(this,t,e,r,i)}worldXYToTileXY(t,e,r){return function(t,e,r,i={x:0,y:0}){return t.grid.getTileXY(e,r,i)}(this,t,e,r)}}{}{constructor(t){super(t),this.pathFinder=new Er({board:this,pathMode:"astar",occupiedTest:!0}),Mr("tile",{points:this.getGridPoints(),strokeStyle:"white",lineWidth:1,lineJoin:"miter"}),Mr("chess",{points:this.getGridPoints(),fillStyle:"white"})}strokeGrid(t){return this.forEachTileXY((e,r)=>{let i=r.tileXYToWorldXY(e.x,e.y,!0),s=new Nt(i.x,i.y,"tile");rt(t,s)}),this}createChess(t,e,r,i,s){let n=new Nt(0,0,"chess");return rt(t,n),void 0!==s&&function(t,...e){e.forEach(e=>{const r=e.vertexTint;r[0]=t,r[1]=t,r[2]=t,r[3]=t,Yt(e)})}(s,n),this.addChess(n,e,r,i),n}findPath(t,e,r=!0){return this.pathFinder.findPath(t,e,void 0,r)}}new class extends class{constructor(){this.events=new Map}}{constructor(...t){super(),this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,s(this),function(t){const e=document.readyState;if("complete"===e||"interactive"===e)return void t();const r=()=>{document.removeEventListener("deviceready",r,!0),document.removeEventListener("DOMContentLoaded",r,!0),window.removeEventListener("load",r,!0),t()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",r,!0):(document.addEventListener("DOMContentLoaded",r,!0),window.addEventListener("load",r,!0)):window.setTimeout(r,20)}(()=>this.boot(t))}boot(t){t.forEach(t=>t());const e=m;this.renderer=new e,this.textureManager=new bt,this.sceneManager=new pt;const r=C();r&&function(t,e){E(e).appendChild(t)}(this.renderer.canvas,r),this.isBooted=!0,function(){{const t=" v"+i().VERSION;console.log(`%cPhaser${t}%c https://phaser4.io`,"padding: 4px 16px; color: #fff; background: linear-gradient(#3e0081 40%, #00bcc3)","")}}(),tt(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(t){const e=t-this.lastTick;this.lastTick=t,this.elapsed+=e,this.isPaused||(this.willUpdate&&(this.sceneManager.update(e,t),tt(this,"update",e,t)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,o(this.frame),h(this.elapsed),requestAnimationFrame(t=>this.step(t))}destroy(){}}(()=>{m=H},function(t=800,e=600,r=1){return 0===r&&(r=window.devicePixelRatio),()=>{l=t,u=e,c=r}}(800,600),(Yr="game",()=>{Yr&&(v=E(Yr))}),function(t=0){return()=>{a=t}}(2960685),(Xr=class extends class{constructor(t){this.game=i(),this.events=new Map,It(this,t)}}{constructor(){super();const t=new Ut(this),e=new kr({grid:new ar({x:40,y:40,cellWidth:40,cellHeight:48}),width:10,height:10});e.strokeGrid(t);let r=e.createChess(t,2,2,1,16777215),i=e.createChess(t,8,8,1,16711680),s=Tr(e.getEmptyTileXYArray(1));for(let r=0;r<30;r++){let i=s[r];e.createChess(t,i.x,i.y,1,8421504)}e.findPath(r,i).forEach(r=>{!function(t,...e){e.forEach(e=>{const r=e.vertexAlpha;r[0]=t,r[1]=t,r[2]=t,r[3]=t,Yt(e)})}(.5,e.createChess(t,r.x,r.y,-1,16384))})}},()=>{_=[].concat(Xr)}))}();
//# sourceMappingURL=bundle.js.map

(()=>{var Uf=Object.defineProperty,ap=Object.prototype.hasOwnProperty,qb=(a,b)=>()=>(b||(b={exports:{}},a(b.exports,b)),b.exports),bp=a=>Uf(a,"__esModule",{value:!0}),Sb=(a,b)=>{bp(a);for(var c in b)Uf(a,c,{get:b[c],enumerable:!0})},Wr=(a,b)=>{bp(a);if(typeof b==="object"||typeof b==="function")for(let c in b)ap.call(b,c)&&!ap.call(a,c)&&c!=="default"&&Uf(a,c,{get:()=>b[c],enumerable:!0});return a},Ka=a=>a&&a.__esModule?a:Wr(Uf({},"default",{value:a,enumerable:!0}),a);var Dg=qb((a,b)=>{!function(c,d){"function"==typeof define&&define.amd?define([],d):"object"==typeof b&&"undefined"!=typeof a?b.exports=d():c.Papa=d()}(a,function c(){"use strict";var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==d?d:{},e=!d.document&&!!d.postMessage,f=e&&/blob:/i.test((d.location||{}).protocol),g={},i=0,h={parse:function(r,t){var j=(t=t||{}).dynamicTyping||!1;L(j)&&(t.dynamicTypingFunction=j,j={});if(t.dynamicTyping=j,t.transform=!!L(t.transform)&&t.transform,t.worker&&h.WORKERS_SUPPORTED){var m=function(){if(!h.WORKERS_SUPPORTED)return!1;var q=(p=d.URL||d.webkitURL||null,E=c.toString(),h.BLOB_URL||(h.BLOB_URL=p.createObjectURL(new Blob(["(",E,")();"],{type:"text/javascript"})))),w=new d.Worker(q),p,E;return w.onmessage=J,w.id=i++,g[w.id]=w}();return m.userStep=t.step,m.userChunk=t.chunk,m.userComplete=t.complete,m.userError=t.error,t.step=L(t.step),t.chunk=L(t.chunk),t.complete=L(t.complete),t.error=L(t.error),delete t.worker,void m.postMessage({input:r,config:t,workerId:m.id})}var l=null;return h.NODE_STREAM_INPUT,"string"==typeof r?l=t.download?new o(t):new u(t):!0===r.readable&&L(r.read)&&L(r.on)?l=new v(t):(d.File&&r instanceof File||r instanceof Object)&&(l=new s(t)),l.stream(r)},unparse:function(r,t){var j=!1,m=!0,l=",",q=`\r
`,w='"',p=w+w,E=!1,H=null,Y=!1;!function(){if("object"!=typeof t)return;"string"!=typeof t.delimiter||h.BAD_DELIMITERS.filter(function(M){return-1!==t.delimiter.indexOf(M)}).length||(l=t.delimiter),("boolean"==typeof t.quotes||"function"==typeof t.quotes||Array.isArray(t.quotes))&&(j=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(E=t.skipEmptyLines),"string"==typeof t.newline&&(q=t.newline),"string"==typeof t.quoteChar&&(w=t.quoteChar),"boolean"==typeof t.header&&(m=t.header);if(Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");H=t.columns}void 0!==t.escapeChar&&(p=t.escapeChar+w),"boolean"==typeof t.escapeFormulae&&(Y=t.escapeFormulae)}();var B=new RegExp(G(w),"g");"string"==typeof r&&(r=JSON.parse(r));if(Array.isArray(r)){if(!r.length||Array.isArray(r[0]))return Q(null,r,E);if("object"==typeof r[0])return Q(H||Z(r[0]),r,E)}else if("object"==typeof r)return"string"==typeof r.data&&(r.data=JSON.parse(r.data)),Array.isArray(r.data)&&(r.fields||(r.fields=r.meta&&r.meta.fields),r.fields||(r.fields=Array.isArray(r.data[0])?r.fields:Z(r.data[0])),Array.isArray(r.data[0])||"object"==typeof r.data[0]||(r.data=[r.data])),Q(r.fields||[],r.data||[],E);throw new Error("Unable to serialize unrecognized input");function Z(M){if("object"!=typeof M)return[];var W=[];for(var fa in M)W.push(fa);return W}function Q(M,W,fa){var la="";"string"==typeof M&&(M=JSON.parse(M)),"string"==typeof W&&(W=JSON.parse(W));var ma=Array.isArray(M)&&0<M.length,sa=!Array.isArray(W[0]);if(ma&&m){for(var X=0;X<M.length;X++)0<X&&(la+=l),la+=F(M[X],X);0<W.length&&(la+=q)}for(var aa=0;aa<W.length;aa++){var ia=ma?M.length:W[aa].length,ja=!1,R=ma?0===Object.keys(W[aa]).length:0===W[aa].length;if(fa&&!ma&&(ja="greedy"===fa?""===W[aa].join("").trim():1===W[aa].length&&0===W[aa][0].length),"greedy"===fa&&ma){for(var V=[],ea=0;ea<ia;ea++){var U=sa?M[ea]:ea;V.push(W[aa][U])}ja=""===V.join("").trim()}if(!ja){for(var ba=0;ba<ia;ba++){0<ba&&!R&&(la+=l);var oa=ma&&sa?M[ba]:ba;la+=F(W[aa][oa],ba)}aa<W.length-1&&(!fa||0<ia&&!R)&&(la+=q)}}return la}function F(M,W){if(null==M)return"";if(M.constructor===Date)return JSON.stringify(M).slice(1,25);!0===Y&&"string"==typeof M&&null!==M.match(/^[=+\-@].*$/)&&(M="'"+M);var fa=M.toString().replace(B,p),la="boolean"==typeof j&&j||"function"==typeof j&&j(M,W)||Array.isArray(j)&&j[W]||function(ma,sa){for(var X=0;X<sa.length;X++)if(-1<ma.indexOf(sa[X]))return!0;return!1}(fa,h.BAD_DELIMITERS)||-1<fa.indexOf(l)||" "===fa.charAt(0)||" "===fa.charAt(fa.length-1);return la?w+fa+w:fa}}};if(h.RECORD_SEP=String.fromCharCode(30),h.UNIT_SEP=String.fromCharCode(31),h.BYTE_ORDER_MARK="ï»¿",h.BAD_DELIMITERS=["\r",`
`,'"',h.BYTE_ORDER_MARK],h.WORKERS_SUPPORTED=!e&&!!d.Worker,h.NODE_STREAM_INPUT=1,h.LocalChunkSize=10485760,h.RemoteChunkSize=5242880,h.DefaultDelimiter=",",h.Parser=K,h.ParserHandle=y,h.NetworkStreamer=o,h.FileStreamer=s,h.StringStreamer=u,h.ReadableStreamStreamer=v,d.jQuery){var k=d.jQuery;k.fn.parse=function(r){var t=r.config||{},j=[];return this.each(function(q){if(!("INPUT"===k(this).prop("tagName").toUpperCase()&&"file"===k(this).attr("type").toLowerCase()&&d.FileReader)||!this.files||0===this.files.length)return!0;for(var w=0;w<this.files.length;w++)j.push({file:this.files[w],inputElem:this,instanceConfig:k.extend({},t)})}),m(),this;function m(){if(0!==j.length){var q,w,p,E,H=j[0];if(L(r.before)){var Y=r.before(H.file,H.inputElem);if("object"==typeof Y){if("abort"===Y.action)return q="AbortError",w=H.file,p=H.inputElem,E=Y.reason,void(L(r.error)&&r.error({name:q},w,p,E));if("skip"===Y.action)return void l();"object"==typeof Y.config&&(H.instanceConfig=k.extend(H.instanceConfig,Y.config))}else if("skip"===Y)return void l()}var B=H.instanceConfig.complete;H.instanceConfig.complete=function(Z){L(B)&&B(Z,H.file,H.inputElem),l()},h.parse(H.file,H.instanceConfig)}else L(r.complete)&&r.complete()}function l(){j.splice(0,1),m()}}}function n(r){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(t){var j=O(t);j.chunkSize=parseInt(j.chunkSize),t.step||t.chunk||(j.chunkSize=null),this._handle=new y(j),(this._handle.streamer=this)._config=j}.call(this,r),this.parseChunk=function(t,j){if(this.isFirstChunk&&L(this._config.beforeFirstChunk)){var m=this._config.beforeFirstChunk(t);void 0!==m&&(t=m)}this.isFirstChunk=!1,this._halted=!1;var l=this._partialLine+t;this._partialLine="";var q=this._handle.parse(l,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var w=q.meta.cursor;this._finished||(this._partialLine=l.substring(w-this._baseIndex),this._baseIndex=w),q&&q.data&&(this._rowCount+=q.data.length);var p=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(f)d.postMessage({results:q,workerId:h.WORKER_ID,finished:p});else if(L(this._config.chunk)&&!j){if(this._config.chunk(q,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);q=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(q.data),this._completeResults.errors=this._completeResults.errors.concat(q.errors),this._completeResults.meta=q.meta),this._completed||!p||!L(this._config.complete)||q&&q.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),p||q&&q.meta.paused||this._nextChunk(),q}this._halted=!0},this._sendError=function(t){L(this._config.error)?this._config.error(t):f&&this._config.error&&d.postMessage({workerId:h.WORKER_ID,error:t,finished:!1})}}function o(r){var t;(r=r||{}).chunkSize||(r.chunkSize=h.RemoteChunkSize),n.call(this,r),this._nextChunk=e?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(j){this._input=j,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest(),this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),e||(t.onload=P(this._chunkLoaded,this),t.onerror=P(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!e),this._config.downloadRequestHeaders){var j=this._config.downloadRequestHeaders;for(var m in j)t.setRequestHeader(m,j[m])}if(this._config.chunkSize){var l=this._start+this._config.chunkSize-1;t.setRequestHeader("Range","bytes="+this._start+"-"+l)}try{t.send(this._config.downloadRequestBody)}catch(q){this._chunkError(q.message)}e&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:t.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(j){var m=j.getResponseHeader("Content-Range");return null===m?-1:parseInt(m.substring(m.lastIndexOf("/")+1))}(t),this.parseChunk(t.responseText)))},this._chunkError=function(j){var m=t.statusText||j;this._sendError(new Error(m))}}function s(r){var t,j;(r=r||{}).chunkSize||(r.chunkSize=h.LocalChunkSize),n.call(this,r);var m="undefined"!=typeof FileReader;this.stream=function(l){this._input=l,j=l.slice||l.webkitSlice||l.mozSlice,m?((t=new FileReader()).onload=P(this._chunkLoaded,this),t.onerror=P(this._chunkError,this)):t=new FileReaderSync(),this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var l=this._input;if(this._config.chunkSize){var q=Math.min(this._start+this._config.chunkSize,this._input.size);l=j.call(l,this._start,q)}var w=t.readAsText(l,this._config.encoding);m||this._chunkLoaded({target:{result:w}})},this._chunkLoaded=function(l){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(l.target.result)},this._chunkError=function(){this._sendError(t.error)}}function u(r){var t;n.call(this,r=r||{}),this.stream=function(j){return t=j,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var j,m=this._config.chunkSize;return m?(j=t.substring(0,m),t=t.substring(m)):(j=t,t=""),this._finished=!t,this.parseChunk(j)}}}function v(r){n.call(this,r=r||{});var t=[],j=!0,m=!1;this.pause=function(){n.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){n.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(l){this._input=l,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){m&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):j=!0},this._streamData=P(function(l){try{t.push("string"==typeof l?l:l.toString(this._config.encoding)),j&&(j=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(q){this._streamError(q)}},this),this._streamError=P(function(l){this._streamCleanUp(),this._sendError(l)},this),this._streamEnd=P(function(){this._streamCleanUp(),m=!0,this._streamData("")},this),this._streamCleanUp=P(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function y(r){var t,j,m,l=Math.pow(2,53),q=-l,w=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)(e[-+]?\d+)?\s*$/,p=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,E=this,H=0,Y=0,B=!1,Z=!1,Q=[],F={data:[],errors:[],meta:{}};if(L(r.step)){var M=r.step;r.step=function(X){if(F=X,la())fa();else{if(fa(),0===F.data.length)return;H+=X.data.length,r.preview&&H>r.preview?j.abort():(F.data=F.data[0],M(F,E))}}}function W(X){return"greedy"===r.skipEmptyLines?""===X.join("").trim():1===X.length&&0===X[0].length}function fa(){if(F&&m&&(sa("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+h.DefaultDelimiter+"'"),m=!1),r.skipEmptyLines)for(var X=0;X<F.data.length;X++)W(F.data[X])&&F.data.splice(X--,1);return la()&&function(){if(!F)return;function aa(ja,R){L(r.transformHeader)&&(ja=r.transformHeader(ja,R)),Q.push(ja)}if(Array.isArray(F.data[0])){for(var ia=0;la()&&ia<F.data.length;ia++)F.data[ia].forEach(aa);F.data.splice(0,1)}else F.data.forEach(aa)}(),function(){if(!F||!r.header&&!r.dynamicTyping&&!r.transform)return F;function aa(ja,R){var V,ea=r.header?{}:[];for(V=0;V<ja.length;V++){var U=V,ba=ja[V];r.header&&(U=V>=Q.length?"__parsed_extra":Q[V]),r.transform&&(ba=r.transform(ba,U)),ba=ma(U,ba),"__parsed_extra"===U?(ea[U]=ea[U]||[],ea[U].push(ba)):ea[U]=ba}return r.header&&(V>Q.length?sa("FieldMismatch","TooManyFields","Too many fields: expected "+Q.length+" fields but parsed "+V,Y+R):V<Q.length&&sa("FieldMismatch","TooFewFields","Too few fields: expected "+Q.length+" fields but parsed "+V,Y+R)),ea}var ia=1;return!F.data.length||Array.isArray(F.data[0])?(F.data=F.data.map(aa),ia=F.data.length):F.data=aa(F.data,0),r.header&&F.meta&&(F.meta.fields=Q),Y+=ia,F}()}function la(){return r.header&&0===Q.length}function ma(X,aa){return ia=X,r.dynamicTypingFunction&&void 0===r.dynamicTyping[ia]&&(r.dynamicTyping[ia]=r.dynamicTypingFunction(ia)),!0===(r.dynamicTyping[ia]||r.dynamicTyping)?"true"===aa||"TRUE"===aa||"false"!==aa&&"FALSE"!==aa&&(function(ja){if(w.test(ja)){var R=parseFloat(ja);if(q<R&&R<l)return!0}return!1}(aa)?parseFloat(aa):p.test(aa)?new Date(aa):""===aa?null:aa):aa;var ia}function sa(X,aa,ia,ja){var R={type:X,code:aa,message:ia};void 0!==ja&&(R.row=ja),F.errors.push(R)}this.parse=function(X,aa,ia){var ja=r.quoteChar||'"';if(r.newline||(r.newline=function(ea,U){ea=ea.substring(0,1048576);var ba=new RegExp(G(U)+"([^]*?)"+G(U),"gm"),oa=(ea=ea.replace(ba,"")).split("\r"),ta=ea.split(`
`),Ca=1<ta.length&&ta[0].length<oa[0].length;if(1===oa.length||Ca)return`
`;for(var S=0,Da=0;Da<oa.length;Da++)`
`===oa[Da][0]&&S++;return S>=oa.length/2?`\r
`:"\r"}(X,ja)),m=!1,r.delimiter)L(r.delimiter)&&(r.delimiter=r.delimiter(X),F.meta.delimiter=r.delimiter);else{var R=function(ea,U,ba,oa,ta){var Ca,S,Da,A;ta=ta||[",","	","|",";",h.RECORD_SEP,h.UNIT_SEP];for(var x=0;x<ta.length;x++){var C=ta[x],D=0,z=0,T=0;Da=void 0;for(var $=new K({comments:oa,delimiter:C,newline:U,preview:10}).parse(ea),ha=0;ha<$.data.length;ha++)if(ba&&W($.data[ha]))T++;else{var ga=$.data[ha].length;z+=ga,void 0!==Da?0<ga&&(D+=Math.abs(ga-Da),Da=ga):Da=ga}0<$.data.length&&(z/=$.data.length-T),(void 0===S||D<=S)&&(void 0===A||A<z)&&1.99<z&&(S=D,Ca=C,A=z)}return{successful:!!(r.delimiter=Ca),bestDelimiter:Ca}}(X,r.newline,r.skipEmptyLines,r.comments,r.delimitersToGuess);R.successful?r.delimiter=R.bestDelimiter:(m=!0,r.delimiter=h.DefaultDelimiter),F.meta.delimiter=r.delimiter}var V=O(r);return r.preview&&r.header&&V.preview++,t=X,j=new K(V),F=j.parse(t,aa,ia),fa(),B?{meta:{paused:!0}}:F||{meta:{paused:!1}}},this.paused=function(){return B},this.pause=function(){B=!0,j.abort(),t=L(r.chunk)?"":t.substring(j.getCharIndex())},this.resume=function(){E.streamer._halted?(B=!1,E.streamer.parseChunk(t,!0)):setTimeout(E.resume,3)},this.aborted=function(){return Z},this.abort=function(){Z=!0,j.abort(),F.meta.aborted=!0,L(r.complete)&&r.complete(F),t=""}}function G(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function K(r){var t,j=(r=r||{}).delimiter,m=r.newline,l=r.comments,q=r.step,w=r.preview,p=r.fastMode,E=t=void 0===r.quoteChar?'"':r.quoteChar;if(void 0!==r.escapeChar&&(E=r.escapeChar),("string"!=typeof j||-1<h.BAD_DELIMITERS.indexOf(j))&&(j=","),l===j)throw new Error("Comment character same as delimiter");!0===l?l="#":("string"!=typeof l||-1<h.BAD_DELIMITERS.indexOf(l))&&(l=!1),`
`!==m&&"\r"!==m&&`\r
`!==m&&(m=`
`);var H=0,Y=!1;this.parse=function(B,Z,Q){if("string"!=typeof B)throw new Error("Input must be a string");var F=B.length,M=j.length,W=m.length,fa=l.length,la=L(q),ma=[],sa=[],X=[],aa=H=0;if(!B)return x();if(p||!1!==p&&-1===B.indexOf(t)){for(var ia=B.split(m),ja=0;ja<ia.length;ja++){if(X=ia[ja],H+=X.length,ja!==ia.length-1)H+=m.length;else if(Q)return x();if(!l||X.substring(0,fa)!==l){if(la){if(ma=[],Ca(X.split(j)),C(),Y)return x()}else Ca(X.split(j));if(w&&w<=ja)return ma=ma.slice(0,w),x(!0)}}return x()}for(var R=B.indexOf(j,H),V=B.indexOf(m,H),ea=new RegExp(G(E)+G(t),"g"),U=B.indexOf(t,H);;)if(B[H]!==t)if(l&&0===X.length&&B.substring(H,H+fa)===l){if(-1===V)return x();H=V+W,V=B.indexOf(m,H),R=B.indexOf(j,H)}else{if(-1!==R&&(R<V||-1===V)){if(!(R<U)){X.push(B.substring(H,R)),H=R+M,R=B.indexOf(j,H);continue}var ba=D(R,U,V);if(ba&&void 0!==ba.nextDelim){R=ba.nextDelim,U=ba.quoteSearch,X.push(B.substring(H,R)),H=R+M,R=B.indexOf(j,H);continue}}if(-1===V)break;if(X.push(B.substring(H,V)),A(V+W),la&&(C(),Y))return x();if(w&&ma.length>=w)return x(!0)}else for(U=H,H++;;){if(-1===(U=B.indexOf(t,U+1)))return Q||sa.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:ma.length,index:H}),Da();if(U===F-1)return Da(B.substring(H,U).replace(ea,t));if(t!==E||B[U+1]!==E){if(t===E||0===U||B[U-1]!==E){-1!==R&&R<U+1&&(R=B.indexOf(j,U+1)),-1!==V&&V<U+1&&(V=B.indexOf(m,U+1));var oa=S(-1===V?R:Math.min(R,V));if(B[U+1+oa]===j){X.push(B.substring(H,U).replace(ea,t)),B[H=U+1+oa+M]!==t&&(U=B.indexOf(t,H)),R=B.indexOf(j,H),V=B.indexOf(m,H);break}var ta=S(V);if(B.substring(U+1+ta,U+1+ta+W)===m){if(X.push(B.substring(H,U).replace(ea,t)),A(U+1+ta+W),R=B.indexOf(j,H),U=B.indexOf(t,H),la&&(C(),Y))return x();if(w&&ma.length>=w)return x(!0);break}sa.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:ma.length,index:H}),U++}}else U++}return Da();function Ca(z){ma.push(z),aa=H}function S(z){var T=0;if(-1!==z){var $=B.substring(U+1,z);$&&""===$.trim()&&(T=$.length)}return T}function Da(z){return Q||(void 0===z&&(z=B.substring(H)),X.push(z),H=F,Ca(X),la&&C()),x()}function A(z){H=z,Ca(X),X=[],V=B.indexOf(m,H)}function x(z){return{data:ma,errors:sa,meta:{delimiter:j,linebreak:m,aborted:Y,truncated:!!z,cursor:aa+(Z||0)}}}function C(){q(x()),ma=[],sa=[]}function D(z,T,$){var ha={nextDelim:void 0,quoteSearch:void 0},ga=B.indexOf(t,T+1);if(T<z&&z<ga&&(ga<$||-1===$)){var ka=B.indexOf(j,ga);if(-1===ka)return ha;ga<ka&&(ga=B.indexOf(t,ga+1)),ha=D(ka,ga,$)}else ha={nextDelim:z,quoteSearch:T};return ha}},this.abort=function(){Y=!0},this.getCharIndex=function(){return H}}function J(r){var t=r.data,j=g[t.workerId],m=!1;if(t.error)j.userError(t.error,t.file);else if(t.results&&t.results.data){var l={abort:function(){m=!0,N(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:I,resume:I};if(L(j.userStep)){for(var q=0;q<t.results.data.length&&(j.userStep({data:t.results.data[q],errors:t.results.errors,meta:t.results.meta},l),!m);q++);delete t.results}else L(j.userChunk)&&(j.userChunk(t.results,l,t.file),delete t.results)}t.finished&&!m&&N(t.workerId,t.results)}function N(r,t){var j=g[r];L(j.userComplete)&&j.userComplete(t),j.terminate(),delete g[r]}function I(){throw new Error("Not implemented.")}function O(r){if("object"!=typeof r||null===r)return r;var t=Array.isArray(r)?[]:{};for(var j in r)t[j]=O(r[j]);return t}function P(r,t){return function(){r.apply(t,arguments)}}function L(r){return"function"==typeof r}return f&&(d.onmessage=function(r){var t=r.data;void 0===h.WORKER_ID&&t&&(h.WORKER_ID=t.workerId);if("string"==typeof t.input)d.postMessage({workerId:h.WORKER_ID,results:h.parse(t.input,t.config),finished:!0});else if(d.File&&t.input instanceof File||t.input instanceof Object){var j=h.parse(t.input,t.config);j&&d.postMessage({workerId:h.WORKER_ID,results:j,finished:!0})}}),(o.prototype=Object.create(n.prototype)).constructor=o,(s.prototype=Object.create(n.prototype)).constructor=s,(u.prototype=Object.create(u.prototype)).constructor=u,(v.prototype=Object.create(n.prototype)).constructor=v,h})});var pj=qb(r=>{Sb(r,{__assign:()=>c,__asyncDelegator:()=>K,__asyncGenerator:()=>G,__asyncValues:()=>J,__await:()=>y,__awaiter:()=>i,__classPrivateFieldGet:()=>P,__classPrivateFieldSet:()=>L,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>h,__importDefault:()=>O,__importStar:()=>I,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>s,__rest:()=>d,__spread:()=>u,__spreadArrays:()=>v,__values:()=>o});var a=function(j,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,q){l.__proto__=q}||function(l,q){for(var w in q)q.hasOwnProperty(w)&&(l[w]=q[w])},a(j,m)};function b(j,m){a(j,m);function l(){this.constructor=j}j.prototype=m===null?Object.create(m):(l.prototype=m.prototype,new l())}var c=function(){return c=Object.assign||function j(m){for(var l,q=1,w=arguments.length;q<w;q++){l=arguments[q];for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(m[p]=l[p])}return m},c.apply(this,arguments)};function d(j,m){var l={};for(var q in j)Object.prototype.hasOwnProperty.call(j,q)&&m.indexOf(q)<0&&(l[q]=j[q]);if(j!=null&&typeof Object.getOwnPropertySymbols==="function")for(var w=0,q=Object.getOwnPropertySymbols(j);w<q.length;w++)m.indexOf(q[w])<0&&Object.prototype.propertyIsEnumerable.call(j,q[w])&&(l[q[w]]=j[q[w]]);return l}function e(j,m,l,q){var w=arguments.length,p=w<3?m:q===null?q=Object.getOwnPropertyDescriptor(m,l):q,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")p=Reflect.decorate(j,m,l,q);else for(var H=j.length-1;H>=0;H--)(E=j[H])&&(p=(w<3?E(p):w>3?E(m,l,p):E(m,l))||p);return w>3&&p&&Object.defineProperty(m,l,p),p}function f(j,m){return function(l,q){m(l,q,j)}}function g(j,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(j,m)}function i(j,m,l,q){function w(p){return p instanceof l?p:new l(function(E){E(p)})}return new(l||(l=Promise))(function(p,E){function H(Z){try{B(q.next(Z))}catch(Q){E(Q)}}function Y(Z){try{B(q.throw(Z))}catch(Q){E(Q)}}function B(Z){Z.done?p(Z.value):w(Z.value).then(H,Y)}B((q=q.apply(j,m||[])).next())})}function h(j,m){var l={label:0,sent:function(){if(p[0]&1)throw p[1];return p[1]},trys:[],ops:[]},q,w,p,E;return E={next:H(0),throw:H(1),return:H(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function H(B){return function(Z){return Y([B,Z])}}function Y(B){if(q)throw new TypeError("Generator is already executing.");for(;l;)try{if(q=1,w&&(p=B[0]&2?w.return:B[0]?w.throw||((p=w.return)&&p.call(w),0):w.next)&&!(p=p.call(w,B[1])).done)return p;(w=0,p)&&(B=[B[0]&2,p.value]);switch(B[0]){case 0:case 1:p=B;break;case 4:return l.label++,{value:B[1],done:!1};case 5:l.label++,w=B[1],B=[0];continue;case 7:B=l.ops.pop(),l.trys.pop();continue;default:if(!(p=l.trys,p=p.length>0&&p[p.length-1])&&(B[0]===6||B[0]===2)){l=0;continue}if(B[0]===3&&(!p||B[1]>p[0]&&B[1]<p[3])){l.label=B[1];break}if(B[0]===6&&l.label<p[1]){l.label=p[1],p=B;break}if(p&&l.label<p[2]){l.label=p[2],l.ops.push(B);break}p[2]&&l.ops.pop(),l.trys.pop();continue}B=m.call(j,l)}catch(Z){B=[6,Z],w=0}finally{q=p=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}}function k(j,m,l,q){q===void 0&&(q=l),j[q]=m[l]}function n(j,m){for(var l in j)l!=="default"&&!m.hasOwnProperty(l)&&(m[l]=j[l])}function o(j){var m=typeof Symbol==="function"&&Symbol.iterator,l=m&&j[m],q=0;if(l)return l.call(j);if(j&&typeof j.length==="number")return{next:function(){return j&&q>=j.length&&(j=void 0),{value:j&&j[q++],done:!j}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(j,m){var l=typeof Symbol==="function"&&j[Symbol.iterator];if(!l)return j;var q=l.call(j),w,p=[],E;try{for(;(m===void 0||m-- >0)&&!(w=q.next()).done;)p.push(w.value)}catch(H){E={error:H}}finally{try{w&&!w.done&&(l=q.return)&&l.call(q)}finally{if(E)throw E.error}}return p}function u(){for(var j=[],m=0;m<arguments.length;m++)j=j.concat(s(arguments[m]));return j}function v(){for(var j=0,m=0,l=arguments.length;m<l;m++)j+=arguments[m].length;for(var q=Array(j),w=0,m=0;m<l;m++)for(var p=arguments[m],E=0,H=p.length;E<H;E++,w++)q[w]=p[E];return q}function y(j){return this instanceof y?(this.v=j,this):new y(j)}function G(j,m,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var q=l.apply(j,m||[]),w,p=[];return w={},E("next"),E("throw"),E("return"),w[Symbol.asyncIterator]=function(){return this},w;function E(F){q[F]&&(w[F]=function(M){return new Promise(function(W,fa){p.push([F,M,W,fa])>1||H(F,M)})})}function H(F,M){try{Y(q[F](M))}catch(W){Q(p[0][3],W)}}function Y(F){F.value instanceof y?Promise.resolve(F.value.v).then(B,Z):Q(p[0][2],F)}function B(F){H("next",F)}function Z(F){H("throw",F)}function Q(F,M){(F(M),p.shift(),p.length)&&H(p[0][0],p[0][1])}}function K(j){var m,l;return m={},q("next"),q("throw",function(w){throw w}),q("return"),m[Symbol.iterator]=function(){return this},m;function q(w,p){m[w]=j[w]?function(E){return(l=!l)?{value:y(j[w](E)),done:w==="return"}:p?p(E):E}:p}}function J(j){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=j[Symbol.asyncIterator],l;return m?m.call(j):(j=typeof o==="function"?o(j):j[Symbol.iterator](),l={},q("next"),q("throw"),q("return"),l[Symbol.asyncIterator]=function(){return this},l);function q(p){l[p]=j[p]&&function(E){return new Promise(function(H,Y){E=j[p](E),w(H,Y,E.done,E.value)})}}function w(p,E,H,Y){Promise.resolve(Y).then(function(B){p({value:B,done:H})},E)}}function N(j,m){return Object.defineProperty?Object.defineProperty(j,"raw",{value:m}):j.raw=m,j}function I(j){if(j&&j.__esModule)return j;var m={};if(j!=null)for(var l in j)Object.hasOwnProperty.call(j,l)&&(m[l]=j[l]);return m.default=j,m}function O(j){return j&&j.__esModule?j:{default:j}}function P(j,m){if(!m.has(j))throw new TypeError("attempted to get private field on non-instance");return m.get(j)}function L(j,m,l){if(!m.has(j))throw new TypeError("attempted to set private field on non-instance");return m.set(j,l),l}});var tj=qb(r=>{Sb(r,{__assign:()=>c,__asyncDelegator:()=>K,__asyncGenerator:()=>G,__asyncValues:()=>J,__await:()=>y,__awaiter:()=>i,__classPrivateFieldGet:()=>P,__classPrivateFieldSet:()=>L,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>h,__importDefault:()=>O,__importStar:()=>I,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>s,__rest:()=>d,__spread:()=>u,__spreadArrays:()=>v,__values:()=>o});var a=function(j,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,q){l.__proto__=q}||function(l,q){for(var w in q)q.hasOwnProperty(w)&&(l[w]=q[w])},a(j,m)};function b(j,m){a(j,m);function l(){this.constructor=j}j.prototype=m===null?Object.create(m):(l.prototype=m.prototype,new l())}var c=function(){return c=Object.assign||function j(m){for(var l,q=1,w=arguments.length;q<w;q++){l=arguments[q];for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(m[p]=l[p])}return m},c.apply(this,arguments)};function d(j,m){var l={};for(var q in j)Object.prototype.hasOwnProperty.call(j,q)&&m.indexOf(q)<0&&(l[q]=j[q]);if(j!=null&&typeof Object.getOwnPropertySymbols==="function")for(var w=0,q=Object.getOwnPropertySymbols(j);w<q.length;w++)m.indexOf(q[w])<0&&Object.prototype.propertyIsEnumerable.call(j,q[w])&&(l[q[w]]=j[q[w]]);return l}function e(j,m,l,q){var w=arguments.length,p=w<3?m:q===null?q=Object.getOwnPropertyDescriptor(m,l):q,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")p=Reflect.decorate(j,m,l,q);else for(var H=j.length-1;H>=0;H--)(E=j[H])&&(p=(w<3?E(p):w>3?E(m,l,p):E(m,l))||p);return w>3&&p&&Object.defineProperty(m,l,p),p}function f(j,m){return function(l,q){m(l,q,j)}}function g(j,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(j,m)}function i(j,m,l,q){function w(p){return p instanceof l?p:new l(function(E){E(p)})}return new(l||(l=Promise))(function(p,E){function H(Z){try{B(q.next(Z))}catch(Q){E(Q)}}function Y(Z){try{B(q.throw(Z))}catch(Q){E(Q)}}function B(Z){Z.done?p(Z.value):w(Z.value).then(H,Y)}B((q=q.apply(j,m||[])).next())})}function h(j,m){var l={label:0,sent:function(){if(p[0]&1)throw p[1];return p[1]},trys:[],ops:[]},q,w,p,E;return E={next:H(0),throw:H(1),return:H(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function H(B){return function(Z){return Y([B,Z])}}function Y(B){if(q)throw new TypeError("Generator is already executing.");for(;l;)try{if(q=1,w&&(p=B[0]&2?w.return:B[0]?w.throw||((p=w.return)&&p.call(w),0):w.next)&&!(p=p.call(w,B[1])).done)return p;(w=0,p)&&(B=[B[0]&2,p.value]);switch(B[0]){case 0:case 1:p=B;break;case 4:return l.label++,{value:B[1],done:!1};case 5:l.label++,w=B[1],B=[0];continue;case 7:B=l.ops.pop(),l.trys.pop();continue;default:if(!(p=l.trys,p=p.length>0&&p[p.length-1])&&(B[0]===6||B[0]===2)){l=0;continue}if(B[0]===3&&(!p||B[1]>p[0]&&B[1]<p[3])){l.label=B[1];break}if(B[0]===6&&l.label<p[1]){l.label=p[1],p=B;break}if(p&&l.label<p[2]){l.label=p[2],l.ops.push(B);break}p[2]&&l.ops.pop(),l.trys.pop();continue}B=m.call(j,l)}catch(Z){B=[6,Z],w=0}finally{q=p=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}}function k(j,m,l,q){q===void 0&&(q=l),j[q]=m[l]}function n(j,m){for(var l in j)l!=="default"&&!m.hasOwnProperty(l)&&(m[l]=j[l])}function o(j){var m=typeof Symbol==="function"&&Symbol.iterator,l=m&&j[m],q=0;if(l)return l.call(j);if(j&&typeof j.length==="number")return{next:function(){return j&&q>=j.length&&(j=void 0),{value:j&&j[q++],done:!j}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(j,m){var l=typeof Symbol==="function"&&j[Symbol.iterator];if(!l)return j;var q=l.call(j),w,p=[],E;try{for(;(m===void 0||m-- >0)&&!(w=q.next()).done;)p.push(w.value)}catch(H){E={error:H}}finally{try{w&&!w.done&&(l=q.return)&&l.call(q)}finally{if(E)throw E.error}}return p}function u(){for(var j=[],m=0;m<arguments.length;m++)j=j.concat(s(arguments[m]));return j}function v(){for(var j=0,m=0,l=arguments.length;m<l;m++)j+=arguments[m].length;for(var q=Array(j),w=0,m=0;m<l;m++)for(var p=arguments[m],E=0,H=p.length;E<H;E++,w++)q[w]=p[E];return q}function y(j){return this instanceof y?(this.v=j,this):new y(j)}function G(j,m,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var q=l.apply(j,m||[]),w,p=[];return w={},E("next"),E("throw"),E("return"),w[Symbol.asyncIterator]=function(){return this},w;function E(F){q[F]&&(w[F]=function(M){return new Promise(function(W,fa){p.push([F,M,W,fa])>1||H(F,M)})})}function H(F,M){try{Y(q[F](M))}catch(W){Q(p[0][3],W)}}function Y(F){F.value instanceof y?Promise.resolve(F.value.v).then(B,Z):Q(p[0][2],F)}function B(F){H("next",F)}function Z(F){H("throw",F)}function Q(F,M){(F(M),p.shift(),p.length)&&H(p[0][0],p[0][1])}}function K(j){var m,l;return m={},q("next"),q("throw",function(w){throw w}),q("return"),m[Symbol.iterator]=function(){return this},m;function q(w,p){m[w]=j[w]?function(E){return(l=!l)?{value:y(j[w](E)),done:w==="return"}:p?p(E):E}:p}}function J(j){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=j[Symbol.asyncIterator],l;return m?m.call(j):(j=typeof o==="function"?o(j):j[Symbol.iterator](),l={},q("next"),q("throw"),q("return"),l[Symbol.asyncIterator]=function(){return this},l);function q(p){l[p]=j[p]&&function(E){return new Promise(function(H,Y){E=j[p](E),w(H,Y,E.done,E.value)})}}function w(p,E,H,Y){Promise.resolve(Y).then(function(B){p({value:B,done:H})},E)}}function N(j,m){return Object.defineProperty?Object.defineProperty(j,"raw",{value:m}):j.raw=m,j}function I(j){if(j&&j.__esModule)return j;var m={};if(j!=null)for(var l in j)Object.hasOwnProperty.call(j,l)&&(m[l]=j[l]);return m.default=j,m}function O(j){return j&&j.__esModule?j:{default:j}}function P(j,m){if(!m.has(j))throw new TypeError("attempted to get private field on non-instance");return m.get(j)}function L(j,m,l){if(!m.has(j))throw new TypeError("attempted to set private field on non-instance");return m.set(j,l),l}});var cg=qb(S=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0});var a=tj();var b={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};var c=function(A,x){if(!A)throw d(x)},d=function(A){return new Error("Firebase Database ("+b.SDK_VERSION+") INTERNAL ASSERT FAILED: "+A)};var e=function(A){for(var x=[],C=0,D=0;D<A.length;D++){var z=A.charCodeAt(D);z<128?x[C++]=z:z<2048?(x[C++]=z>>6|192,x[C++]=z&63|128):(z&64512)===55296&&D+1<A.length&&(A.charCodeAt(D+1)&64512)===56320?(z=65536+((z&1023)<<10)+(A.charCodeAt(++D)&1023),x[C++]=z>>18|240,x[C++]=z>>12&63|128,x[C++]=z>>6&63|128,x[C++]=z&63|128):(x[C++]=z>>12|224,x[C++]=z>>6&63|128,x[C++]=z&63|128)}return x},f=function(A){for(var x=[],C=0,D=0;C<A.length;){var z=A[C++];if(z<128)x[D++]=String.fromCharCode(z);else if(z>191&&z<224){var T=A[C++];x[D++]=String.fromCharCode((z&31)<<6|T&63)}else if(z>239&&z<365){var T=A[C++],$=A[C++],ha=A[C++],ga=((z&7)<<18|(T&63)<<12|($&63)<<6|ha&63)-65536;x[D++]=String.fromCharCode(55296+(ga>>10)),x[D++]=String.fromCharCode(56320+(ga&1023))}else{var T=A[C++],$=A[C++];x[D++]=String.fromCharCode((z&15)<<12|(T&63)<<6|$&63)}}return x.join("")},g={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob==="function",encodeByteArray:function(A,x){if(!Array.isArray(A))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var C=x?this.byteToCharMapWebSafe_:this.byteToCharMap_,D=[],z=0;z<A.length;z+=3){var T=A[z],$=z+1<A.length,ha=$?A[z+1]:0,ga=z+2<A.length,ka=ga?A[z+2]:0,_a=T>>2,Xa=(T&3)<<4|ha>>4,La=(ha&15)<<2|ka>>6,Vf=ka&63;ga||(Vf=64,$||(La=64)),D.push(C[_a],C[Xa],C[La],C[Vf])}return D.join("")},encodeString:function(A,x){return this.HAS_NATIVE_SUPPORT&&!x?btoa(A):this.encodeByteArray(e(A),x)},decodeString:function(A,x){return this.HAS_NATIVE_SUPPORT&&!x?atob(A):f(this.decodeStringToByteArray(A,x))},decodeStringToByteArray:function(A,x){this.init_();for(var C=x?this.charToByteMapWebSafe_:this.charToByteMap_,D=[],z=0;z<A.length;){var T=C[A.charAt(z++)],$=z<A.length,ha=$?C[A.charAt(z)]:0;++z;var ga=z<A.length,ka=ga?C[A.charAt(z)]:64;++z;var _a=z<A.length,Xa=_a?C[A.charAt(z)]:64;++z;if(T==null||ha==null||ka==null||Xa==null)throw Error();var La=T<<2|ha>>4;D.push(La);if(ka!==64){var Vf=ha<<4&240|ka>>2;D.push(Vf);if(Xa!==64){var Xr=ka<<6&192|Xa;D.push(Xr)}}}return D},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var A=0;A<this.ENCODED_VALS.length;A++)this.byteToCharMap_[A]=this.ENCODED_VALS.charAt(A),this.charToByteMap_[this.byteToCharMap_[A]]=A,this.byteToCharMapWebSafe_[A]=this.ENCODED_VALS_WEBSAFE.charAt(A),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[A]]=A,A>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(A)]=A,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(A)]=A)}}},i=function(A){var x=e(A);return g.encodeByteArray(x,!0)},h=function(A){try{return g.decodeString(A,!0)}catch(x){console.error("base64Decode failed: ",x)}return null};function k(A){return n(void 0,A)}function n(A,x){if(!(x instanceof Object))return x;switch(x.constructor){case Date:var C=x;return new Date(C.getTime());case Object:A===void 0&&(A={});break;case Array:A=[];break;default:return x}for(var D in x){if(!x.hasOwnProperty(D))continue;A[D]=n(A[D],x[D])}return A}var o=function(){function A(){var x=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(C,D){x.resolve=C,x.reject=D})}return A.prototype.wrapCallback=function(x){var C=this;return function(D,z){D?C.reject(D):C.resolve(z),typeof x==="function"&&(C.promise.catch(function(){}),x.length===1?x(D):x(D,z))}},A}();function s(){return typeof navigator!=="undefined"&&typeof navigator.userAgent==="string"?navigator.userAgent:""}function u(){return typeof window!=="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(s())}function v(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(A){return!1}}function y(){return typeof self==="object"&&self.self===self}function G(){var A=typeof chrome==="object"?chrome.runtime:typeof browser==="object"?browser.runtime:void 0;return typeof A==="object"&&A.id!==void 0}function K(){return typeof navigator==="object"&&navigator.product==="ReactNative"}function J(){return s().indexOf("Electron/")>=0}function N(){var A=s();return A.indexOf("MSIE ")>=0||A.indexOf("Trident/")>=0}function I(){return s().indexOf("MSAppHost/")>=0}function O(){return b.NODE_CLIENT===!0||b.NODE_ADMIN===!0}function P(){return!v()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function L(){return"indexedDB"in self&&indexedDB!==null}function r(){return new Promise(function(A,x){try{var C=!0,D="validate-browser-context-for-indexeddb-analytics-module",z=window.indexedDB.open(D);z.onsuccess=function(){z.result.close(),C||window.indexedDB.deleteDatabase(D),A(!0)},z.onupgradeneeded=function(){C=!1},z.onerror=function(){var T;x(((T=z.error)===null||T===void 0?void 0:T.message)||"")}}catch(T){x(T)}})}function t(){return!navigator||!navigator.cookieEnabled?!1:!0}var j="FirebaseError",m=function(A){a.__extends(x,A);function x(C,D){var z=A.call(this,D)||this;return z.code=C,z.name=j,Object.setPrototypeOf(z,x.prototype),Error.captureStackTrace&&Error.captureStackTrace(z,l.prototype.create),z}return x}(Error),l=function(){function A(x,C,D){this.service=x,this.serviceName=C,this.errors=D}return A.prototype.create=function(x){for(var C=[],D=1;D<arguments.length;D++)C[D-1]=arguments[D];for(var z=C[0]||{},T=this.service+"/"+x,$=this.errors[x],ha=$?q($,z):"Error",ga=this.serviceName+": "+ha+" ("+T+").",ka=new m(T,ga),_a=0,Xa=Object.keys(z);_a<Xa.length;_a++){var La=Xa[_a];La.slice(-1)!=="_"&&(La in ka&&console.warn('Overwriting FirebaseError base field "'+La+'" can cause unexpected behavior.'),ka[La]=z[La])}return ka},A}();function q(A,x){return A.replace(w,function(C,D){var z=x[D];return z!=null?String(z):"<"+D+"?>"})}var w=/\{\$([^}]+)}/g;function p(A){return JSON.parse(A)}function E(A){return JSON.stringify(A)}var H=function(A){var x={},C={},D={},z="";try{var T=A.split(".");x=p(h(T[0])||""),C=p(h(T[1])||""),z=T[2],D=C.d||{},delete C.d}catch($){}return{header:x,claims:C,data:D,signature:z}},Y=function(A){var x=H(A).claims,C=Math.floor(new Date().getTime()/1e3),D=0,z=0;return typeof x==="object"&&(x.hasOwnProperty("nbf")?D=x.nbf:x.hasOwnProperty("iat")&&(D=x.iat),x.hasOwnProperty("exp")?z=x.exp:z=D+86400),!!C&&!!D&&!!z&&C>=D&&C<=z},B=function(A){var x=H(A).claims;return typeof x==="object"&&x.hasOwnProperty("iat")?x.iat:null},Z=function(A){var x=H(A),C=x.claims;return!!C&&typeof C==="object"&&C.hasOwnProperty("iat")},Q=function(A){var x=H(A).claims;return typeof x==="object"&&x.admin===!0};function F(A,x){return Object.prototype.hasOwnProperty.call(A,x)}function M(A,x){return Object.prototype.hasOwnProperty.call(A,x)?A[x]:void 0}function W(A){for(var x in A)if(Object.prototype.hasOwnProperty.call(A,x))return!1;return!0}function fa(A,x,C){var D={};for(var z in A)Object.prototype.hasOwnProperty.call(A,z)&&(D[z]=x.call(C,A[z],z,A));return D}function la(A){for(var x=[],C=function(ga,ka){Array.isArray(ka)?ka.forEach(function(_a){x.push(encodeURIComponent(ga)+"="+encodeURIComponent(_a))}):x.push(encodeURIComponent(ga)+"="+encodeURIComponent(ka))},D=0,z=Object.entries(A);D<z.length;D++){var T=z[D],$=T[0],ha=T[1];C($,ha)}return x.length?"&"+x.join("&"):""}function ma(A){var x={},C=A.replace(/^\?/,"").split("&");return C.forEach(function(D){if(D){var z=D.split("=");x[z[0]]=z[1]}}),x}var sa=function(){function A(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(var x=1;x<this.blockSize;++x)this.pad_[x]=0;this.reset()}return A.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},A.prototype.compress_=function(x,C){C||(C=0);var D=this.W_;if(typeof x==="string")for(var z=0;z<16;z++)D[z]=x.charCodeAt(C)<<24|x.charCodeAt(C+1)<<16|x.charCodeAt(C+2)<<8|x.charCodeAt(C+3),C+=4;else for(var z=0;z<16;z++)D[z]=x[C]<<24|x[C+1]<<16|x[C+2]<<8|x[C+3],C+=4;for(var z=16;z<80;z++){var T=D[z-3]^D[z-8]^D[z-14]^D[z-16];D[z]=(T<<1|T>>>31)&4294967295}for(var $=this.chain_[0],ha=this.chain_[1],ga=this.chain_[2],ka=this.chain_[3],_a=this.chain_[4],Xa,La,z=0;z<80;z++){z<40?z<20?(Xa=ka^ha&(ga^ka),La=1518500249):(Xa=ha^ga^ka,La=1859775393):z<60?(Xa=ha&ga|ka&(ha|ga),La=2400959708):(Xa=ha^ga^ka,La=3395469782);var T=($<<5|$>>>27)+Xa+_a+La+D[z]&4294967295;_a=ka,ka=ga,ga=(ha<<30|ha>>>2)&4294967295,ha=$,$=T}this.chain_[0]=this.chain_[0]+$&4294967295,this.chain_[1]=this.chain_[1]+ha&4294967295,this.chain_[2]=this.chain_[2]+ga&4294967295,this.chain_[3]=this.chain_[3]+ka&4294967295,this.chain_[4]=this.chain_[4]+_a&4294967295},A.prototype.update=function(x,C){if(x==null)return;C===void 0&&(C=x.length);for(var D=C-this.blockSize,z=0,T=this.buf_,$=this.inbuf_;z<C;){if($===0)for(;z<=D;)this.compress_(x,z),z+=this.blockSize;if(typeof x==="string")for(;z<C;){T[$]=x.charCodeAt(z),++$,++z;if($===this.blockSize){this.compress_(T),$=0;break}}else for(;z<C;){T[$]=x[z],++$,++z;if($===this.blockSize){this.compress_(T),$=0;break}}}this.inbuf_=$,this.total_+=C},A.prototype.digest=function(){var x=[],C=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var D=this.blockSize-1;D>=56;D--)this.buf_[D]=C&255,C/=256;this.compress_(this.buf_);for(var z=0,D=0;D<5;D++)for(var T=24;T>=0;T-=8)x[z]=this.chain_[D]>>T&255,++z;return x},A}();function X(A,x){var C=new aa(A,x);return C.subscribe.bind(C)}var aa=function(){function A(x,C){var D=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=C,this.task.then(function(){x(D)}).catch(function(z){D.error(z)})}return A.prototype.next=function(x){this.forEachObserver(function(C){C.next(x)})},A.prototype.error=function(x){this.forEachObserver(function(C){C.error(x)}),this.close(x)},A.prototype.complete=function(){this.forEachObserver(function(x){x.complete()}),this.close()},A.prototype.subscribe=function(x,C,D){var z=this,T;if(x===void 0&&C===void 0&&D===void 0)throw new Error("Missing Observer.");ja(x,["next","error","complete"])?T=x:T={next:x,error:C,complete:D},T.next===void 0&&(T.next=R),T.error===void 0&&(T.error=R),T.complete===void 0&&(T.complete=R);var $=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{z.finalError?T.error(z.finalError):T.complete()}catch(ha){}return}),this.observers.push(T),$},A.prototype.unsubscribeOne=function(x){if(this.observers===void 0||this.observers[x]===void 0)return;delete this.observers[x],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this)},A.prototype.forEachObserver=function(x){if(this.finalized)return;for(var C=0;C<this.observers.length;C++)this.sendOne(C,x)},A.prototype.sendOne=function(x,C){var D=this;this.task.then(function(){if(D.observers!==void 0&&D.observers[x]!==void 0)try{C(D.observers[x])}catch(z){typeof console!=="undefined"&&console.error&&console.error(z)}})},A.prototype.close=function(x){var C=this;if(this.finalized)return;this.finalized=!0,x!==void 0&&(this.finalError=x),this.task.then(function(){C.observers=void 0,C.onNoObservers=void 0})},A}();function ia(A,x){return function(){for(var C=[],D=0;D<arguments.length;D++)C[D]=arguments[D];Promise.resolve(!0).then(function(){A.apply(void 0,C)}).catch(function(z){x&&x(z)})}}function ja(A,x){if(typeof A!=="object"||A===null)return!1;for(var C=0,D=x;C<D.length;C++){var z=D[C];if(z in A&&typeof A[z]==="function")return!0}return!1}function R(){}var V=function(A,x,C,D){var z;D<x?z="at least "+x:D>C&&(z=C===0?"none":"no more than "+C);if(z){var T=A+" failed: Was called with "+D+(D===1?" argument.":" arguments.")+" Expects "+z+".";throw new Error(T)}};function ea(A,x,C){var D="";switch(x){case 1:D=C?"first":"First";break;case 2:D=C?"second":"Second";break;case 3:D=C?"third":"Third";break;case 4:D=C?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var z=A+" failed: ";return z+=D+" argument ",z}function U(A,x,C,D){if(D&&!C)return;if(typeof C!=="string")throw new Error(ea(A,x,D)+"must be a valid firebase namespace.")}function ba(A,x,C,D){if(D&&!C)return;if(typeof C!=="function")throw new Error(ea(A,x,D)+"must be a valid function.")}function oa(A,x,C,D){if(D&&!C)return;if(typeof C!=="object"||C===null)throw new Error(ea(A,x,D)+"must be a valid context object.")}var ta=function(A){for(var x=[],C=0,D=0;D<A.length;D++){var z=A.charCodeAt(D);if(z>=55296&&z<=56319){var T=z-55296;D++,c(D<A.length,"Surrogate pair missing trail surrogate.");var $=A.charCodeAt(D)-56320;z=65536+(T<<10)+$}z<128?x[C++]=z:z<2048?(x[C++]=z>>6|192,x[C++]=z&63|128):z<65536?(x[C++]=z>>12|224,x[C++]=z>>6&63|128,x[C++]=z&63|128):(x[C++]=z>>18|240,x[C++]=z>>12&63|128,x[C++]=z>>6&63|128,x[C++]=z&63|128)}return x},Ca=function(A){for(var x=0,C=0;C<A.length;C++){var D=A.charCodeAt(C);D<128?x++:D<2048?x+=2:D>=55296&&D<=56319?(x+=4,C++):x+=3}return x};S.CONSTANTS=b;S.Deferred=o;S.ErrorFactory=l;S.FirebaseError=m;S.Sha1=sa;S.areCookiesEnabled=t;S.assert=c;S.assertionError=d;S.async=ia;S.base64=g;S.base64Decode=h;S.base64Encode=i;S.contains=F;S.createSubscribe=X;S.decode=H;S.deepCopy=k;S.deepExtend=n;S.errorPrefix=ea;S.getUA=s;S.isAdmin=Q;S.isBrowser=y;S.isBrowserExtension=G;S.isElectron=J;S.isEmpty=W;S.isIE=N;S.isIndexedDBAvailable=L;S.isMobileCordova=u;S.isNode=v;S.isNodeSdk=O;S.isReactNative=K;S.isSafari=P;S.isUWP=I;S.isValidFormat=Z;S.isValidTimestamp=Y;S.issuedAtTime=B;S.jsonEval=p;S.map=fa;S.querystring=la;S.querystringDecode=ma;S.safeGet=M;S.stringLength=Ca;S.stringToByteArray=ta;S.stringify=E;S.validateArgCount=V;S.validateCallback=ba;S.validateContextObject=oa;S.validateIndexedDBOpenable=r;S.validateNamespace=U});var rj=qb(r=>{Sb(r,{__assign:()=>c,__asyncDelegator:()=>K,__asyncGenerator:()=>G,__asyncValues:()=>J,__await:()=>y,__awaiter:()=>i,__classPrivateFieldGet:()=>P,__classPrivateFieldSet:()=>L,__createBinding:()=>k,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>h,__importDefault:()=>O,__importStar:()=>I,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>s,__rest:()=>d,__spread:()=>u,__spreadArrays:()=>v,__values:()=>o});var a=function(j,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,q){l.__proto__=q}||function(l,q){for(var w in q)q.hasOwnProperty(w)&&(l[w]=q[w])},a(j,m)};function b(j,m){a(j,m);function l(){this.constructor=j}j.prototype=m===null?Object.create(m):(l.prototype=m.prototype,new l())}var c=function(){return c=Object.assign||function j(m){for(var l,q=1,w=arguments.length;q<w;q++){l=arguments[q];for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(m[p]=l[p])}return m},c.apply(this,arguments)};function d(j,m){var l={};for(var q in j)Object.prototype.hasOwnProperty.call(j,q)&&m.indexOf(q)<0&&(l[q]=j[q]);if(j!=null&&typeof Object.getOwnPropertySymbols==="function")for(var w=0,q=Object.getOwnPropertySymbols(j);w<q.length;w++)m.indexOf(q[w])<0&&Object.prototype.propertyIsEnumerable.call(j,q[w])&&(l[q[w]]=j[q[w]]);return l}function e(j,m,l,q){var w=arguments.length,p=w<3?m:q===null?q=Object.getOwnPropertyDescriptor(m,l):q,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")p=Reflect.decorate(j,m,l,q);else for(var H=j.length-1;H>=0;H--)(E=j[H])&&(p=(w<3?E(p):w>3?E(m,l,p):E(m,l))||p);return w>3&&p&&Object.defineProperty(m,l,p),p}function f(j,m){return function(l,q){m(l,q,j)}}function g(j,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(j,m)}function i(j,m,l,q){function w(p){return p instanceof l?p:new l(function(E){E(p)})}return new(l||(l=Promise))(function(p,E){function H(Z){try{B(q.next(Z))}catch(Q){E(Q)}}function Y(Z){try{B(q.throw(Z))}catch(Q){E(Q)}}function B(Z){Z.done?p(Z.value):w(Z.value).then(H,Y)}B((q=q.apply(j,m||[])).next())})}function h(j,m){var l={label:0,sent:function(){if(p[0]&1)throw p[1];return p[1]},trys:[],ops:[]},q,w,p,E;return E={next:H(0),throw:H(1),return:H(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function H(B){return function(Z){return Y([B,Z])}}function Y(B){if(q)throw new TypeError("Generator is already executing.");for(;l;)try{if(q=1,w&&(p=B[0]&2?w.return:B[0]?w.throw||((p=w.return)&&p.call(w),0):w.next)&&!(p=p.call(w,B[1])).done)return p;(w=0,p)&&(B=[B[0]&2,p.value]);switch(B[0]){case 0:case 1:p=B;break;case 4:return l.label++,{value:B[1],done:!1};case 5:l.label++,w=B[1],B=[0];continue;case 7:B=l.ops.pop(),l.trys.pop();continue;default:if(!(p=l.trys,p=p.length>0&&p[p.length-1])&&(B[0]===6||B[0]===2)){l=0;continue}if(B[0]===3&&(!p||B[1]>p[0]&&B[1]<p[3])){l.label=B[1];break}if(B[0]===6&&l.label<p[1]){l.label=p[1],p=B;break}if(p&&l.label<p[2]){l.label=p[2],l.ops.push(B);break}p[2]&&l.ops.pop(),l.trys.pop();continue}B=m.call(j,l)}catch(Z){B=[6,Z],w=0}finally{q=p=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}}function k(j,m,l,q){q===void 0&&(q=l),j[q]=m[l]}function n(j,m){for(var l in j)l!=="default"&&!m.hasOwnProperty(l)&&(m[l]=j[l])}function o(j){var m=typeof Symbol==="function"&&Symbol.iterator,l=m&&j[m],q=0;if(l)return l.call(j);if(j&&typeof j.length==="number")return{next:function(){return j&&q>=j.length&&(j=void 0),{value:j&&j[q++],done:!j}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(j,m){var l=typeof Symbol==="function"&&j[Symbol.iterator];if(!l)return j;var q=l.call(j),w,p=[],E;try{for(;(m===void 0||m-- >0)&&!(w=q.next()).done;)p.push(w.value)}catch(H){E={error:H}}finally{try{w&&!w.done&&(l=q.return)&&l.call(q)}finally{if(E)throw E.error}}return p}function u(){for(var j=[],m=0;m<arguments.length;m++)j=j.concat(s(arguments[m]));return j}function v(){for(var j=0,m=0,l=arguments.length;m<l;m++)j+=arguments[m].length;for(var q=Array(j),w=0,m=0;m<l;m++)for(var p=arguments[m],E=0,H=p.length;E<H;E++,w++)q[w]=p[E];return q}function y(j){return this instanceof y?(this.v=j,this):new y(j)}function G(j,m,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var q=l.apply(j,m||[]),w,p=[];return w={},E("next"),E("throw"),E("return"),w[Symbol.asyncIterator]=function(){return this},w;function E(F){q[F]&&(w[F]=function(M){return new Promise(function(W,fa){p.push([F,M,W,fa])>1||H(F,M)})})}function H(F,M){try{Y(q[F](M))}catch(W){Q(p[0][3],W)}}function Y(F){F.value instanceof y?Promise.resolve(F.value.v).then(B,Z):Q(p[0][2],F)}function B(F){H("next",F)}function Z(F){H("throw",F)}function Q(F,M){(F(M),p.shift(),p.length)&&H(p[0][0],p[0][1])}}function K(j){var m,l;return m={},q("next"),q("throw",function(w){throw w}),q("return"),m[Symbol.iterator]=function(){return this},m;function q(w,p){m[w]=j[w]?function(E){return(l=!l)?{value:y(j[w](E)),done:w==="return"}:p?p(E):E}:p}}function J(j){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=j[Symbol.asyncIterator],l;return m?m.call(j):(j=typeof o==="function"?o(j):j[Symbol.iterator](),l={},q("next"),q("throw"),q("return"),l[Symbol.asyncIterator]=function(){return this},l);function q(p){l[p]=j[p]&&function(E){return new Promise(function(H,Y){E=j[p](E),w(H,Y,E.done,E.value)})}}function w(p,E,H,Y){Promise.resolve(Y).then(function(B){p({value:B,done:H})},E)}}function N(j,m){return Object.defineProperty?Object.defineProperty(j,"raw",{value:m}):j.raw=m,j}function I(j){if(j&&j.__esModule)return j;var m={};if(j!=null)for(var l in j)Object.hasOwnProperty.call(j,l)&&(m[l]=j[l]);return m.default=j,m}function O(j){return j&&j.__esModule?j:{default:j}}function P(j,m){if(!m.has(j))throw new TypeError("attempted to get private field on non-instance");return m.get(j)}function L(j,m,l){if(!m.has(j))throw new TypeError("attempted to set private field on non-instance");return m.set(j,l),l}});var qj=qb(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0});var a=rj(),b=cg(),c=function(){function n(o,s,u){this.name=o,this.instanceFactory=s,this.type=u,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return n.prototype.setInstantiationMode=function(o){return this.instantiationMode=o,this},n.prototype.setMultipleInstances=function(o){return this.multipleInstances=o,this},n.prototype.setServiceProps=function(o){return this.serviceProps=o,this},n}();var d="[DEFAULT]";var e=function(){function n(o,s){this.name=o,this.container=s,this.component=null,this.instances=new Map(),this.instancesDeferred=new Map()}return n.prototype.get=function(o){o===void 0&&(o=d);var s=this.normalizeInstanceIdentifier(o);if(!this.instancesDeferred.has(s)){var u=new b.Deferred();this.instancesDeferred.set(s,u);try{var v=this.getOrInitializeService(s);v&&u.resolve(v)}catch(y){}}return this.instancesDeferred.get(s).promise},n.prototype.getImmediate=function(o){var s=a.__assign({identifier:d,optional:!1},o),u=s.identifier,v=s.optional,y=this.normalizeInstanceIdentifier(u);try{var G=this.getOrInitializeService(y);if(!G){if(v)return null;throw Error("Service "+this.name+" is not available")}return G}catch(K){if(v)return null;throw K}},n.prototype.getComponent=function(){return this.component},n.prototype.setComponent=function(o){var s,u;if(o.name!==this.name)throw Error("Mismatching Component "+o.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");this.component=o;if(g(o))try{this.getOrInitializeService(d)}catch(O){}try{for(var v=a.__values(this.instancesDeferred.entries()),y=v.next();!y.done;y=v.next()){var G=a.__read(y.value,2),K=G[0],J=G[1],N=this.normalizeInstanceIdentifier(K);try{var I=this.getOrInitializeService(N);J.resolve(I)}catch(O){}}}catch(O){s={error:O}}finally{try{y&&!y.done&&(u=v.return)&&u.call(v)}finally{if(s)throw s.error}}},n.prototype.clearInstance=function(o){o===void 0&&(o=d),this.instancesDeferred.delete(o),this.instances.delete(o)},n.prototype.delete=function(){return a.__awaiter(this,void 0,void 0,function(){var o;return a.__generator(this,function(s){switch(s.label){case 0:return o=Array.from(this.instances.values()),[4,Promise.all(o.filter(function(u){return"INTERNAL"in u}).map(function(u){return u.INTERNAL.delete()}))];case 1:return s.sent(),[2]}})})},n.prototype.isComponentSet=function(){return this.component!=null},n.prototype.getOrInitializeService=function(o){var s=this.instances.get(o);return!s&&this.component&&(s=this.component.instanceFactory(this.container,f(o)),this.instances.set(o,s)),s||null},n.prototype.normalizeInstanceIdentifier=function(o){return this.component?this.component.multipleInstances?o:d:o},n}();function f(n){return n===d?void 0:n}function g(n){return n.instantiationMode==="EAGER"}var i=function(){function n(o){this.name=o,this.providers=new Map()}return n.prototype.addComponent=function(o){var s=this.getProvider(o.name);if(s.isComponentSet())throw new Error("Component "+o.name+" has already been registered with "+this.name);s.setComponent(o)},n.prototype.addOrOverwriteComponent=function(o){var s=this.getProvider(o.name);s.isComponentSet()&&this.providers.delete(o.name),this.addComponent(o)},n.prototype.getProvider=function(o){if(this.providers.has(o))return this.providers.get(o);var s=new e(o,this);return this.providers.set(o,s),s},n.prototype.getProviders=function(){return Array.from(this.providers.values())},n}();h.Component=c;h.ComponentContainer=i;h.Provider=e});var sj=qb(o=>{Sb(o,{LogLevel:()=>d,Logger:()=>h,setLogLevel:()=>k,setUserLogHandler:()=>n});function a(){for(var u=0,v=0,y=arguments.length;v<y;v++)u+=arguments[v].length;for(var G=Array(u),K=0,v=0;v<y;v++)for(var J=arguments[v],N=0,I=J.length;N<I;N++,K++)G[K]=J[N];return G}var b,c=[],d;(function(u){u[u.DEBUG=0]="DEBUG",u[u.VERBOSE=1]="VERBOSE",u[u.INFO=2]="INFO",u[u.WARN=3]="WARN",u[u.ERROR=4]="ERROR",u[u.SILENT=5]="SILENT"})(d||(d={}));var e={debug:d.DEBUG,verbose:d.VERBOSE,info:d.INFO,warn:d.WARN,error:d.ERROR,silent:d.SILENT},f=d.INFO,g=(b={},b[d.DEBUG]="log",b[d.VERBOSE]="log",b[d.INFO]="info",b[d.WARN]="warn",b[d.ERROR]="error",b),i=function(u,v){for(var y=[],G=2;G<arguments.length;G++)y[G-2]=arguments[G];if(v<u.logLevel)return;var K=new Date().toISOString(),J=g[v];if(J)console[J].apply(console,a(["["+K+"]  "+u.name+":"],y));else throw new Error("Attempted to log a message with an invalid logType (value: "+v+")")},h=function(){function u(v){this.name=v,this._logLevel=f,this._logHandler=i,this._userLogHandler=null,c.push(this)}return Object.defineProperty(u.prototype,"logLevel",{get:function(){return this._logLevel},set:function(v){if(!(v in d))throw new TypeError('Invalid value "'+v+'" assigned to `logLevel`');this._logLevel=v},enumerable:!1,configurable:!0}),u.prototype.setLogLevel=function(v){this._logLevel=typeof v==="string"?e[v]:v},Object.defineProperty(u.prototype,"logHandler",{get:function(){return this._logHandler},set:function(v){if(typeof v!=="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=v},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(v){this._userLogHandler=v},enumerable:!1,configurable:!0}),u.prototype.debug=function(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.DEBUG],v)),this._logHandler.apply(this,a([this,d.DEBUG],v))},u.prototype.log=function(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.VERBOSE],v)),this._logHandler.apply(this,a([this,d.VERBOSE],v))},u.prototype.info=function(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.INFO],v)),this._logHandler.apply(this,a([this,d.INFO],v))},u.prototype.warn=function(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.WARN],v)),this._logHandler.apply(this,a([this,d.WARN],v))},u.prototype.error=function(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.ERROR],v)),this._logHandler.apply(this,a([this,d.ERROR],v))},u}();function k(u){c.forEach(function(v){v.setLogLevel(u)})}function n(u,v){for(var y=function(N){var I=null;v&&v.level&&(I=e[v.level]),u===null?N.userLogHandler=null:N.userLogHandler=function(O,P){for(var L=[],r=2;r<arguments.length;r++)L[r-2]=arguments[r];var t=L.map(function(j){if(j==null)return null;{if(typeof j==="string")return j;{if(typeof j==="number"||typeof j==="boolean")return j.toString();{if(j instanceof Error)return j.message;try{return JSON.stringify(j)}catch(m){return null}}}}}).filter(function(j){return j}).join(" ");P>=(I!==null&&I!==void 0?I:O.logLevel)&&u({level:d[P].toLowerCase(),message:t,args:L,type:O.name})}},G=0,K=c;G<K.length;G++){var J=K[G];y(J)}}});var oj=qb(B=>{"use strict";Object.defineProperty(B,"__esModule",{value:!0});var a=pj(),b=cg(),c=qj(),d=sj();var e,f=(e={},e["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",e["bad-app-name"]="Illegal App name: '{$appName}",e["duplicate-app"]="Firebase App named '{$appName}' already exists",e["app-deleted"]="Firebase App named '{$appName}' already deleted",e["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",e["invalid-log-argument"]="First argument to `onLog` must be null or a function.",e),g=new b.ErrorFactory("app","Firebase",f),i="@firebase/app",h="0.6.10",k="@firebase/analytics",n="@firebase/auth",o="@firebase/database",s="@firebase/functions",u="@firebase/installations",v="@firebase/messaging",y="@firebase/performance",G="@firebase/remote-config",K="@firebase/storage",J="@firebase/firestore",N="firebase-wrapper";var I,O="[DEFAULT]",P=(I={},I[i]="fire-core",I[k]="fire-analytics",I[n]="fire-auth",I[o]="fire-rtdb",I[s]="fire-fn",I[u]="fire-iid",I[v]="fire-fcm",I[y]="fire-perf",I[G]="fire-rc",I[K]="fire-gcs",I[J]="fire-fst",I["fire-js"]="fire-js",I[N]="fire-js-all",I);var L=new d.Logger("@firebase/app");var r=function(){function Q(F,M,W){var fa,la,ma=this;this.firebase_=W,this.isDeleted_=!1,this.name_=M.name,this.automaticDataCollectionEnabled_=M.automaticDataCollectionEnabled||!1,this.options_=b.deepCopy(F),this.container=new c.ComponentContainer(M.name),this._addComponent(new c.Component("app",function(){return ma},"PUBLIC"));try{for(var sa=a.__values(this.firebase_.INTERNAL.components.values()),X=sa.next();!X.done;X=sa.next()){var aa=X.value;this._addComponent(aa)}}catch(ia){fa={error:ia}}finally{try{X&&!X.done&&(la=sa.return)&&la.call(sa)}finally{if(fa)throw fa.error}}}return Object.defineProperty(Q.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(F){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=F},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),Q.prototype.delete=function(){var F=this;return new Promise(function(M){F.checkDestroyed_(),M()}).then(function(){return F.firebase_.INTERNAL.removeApp(F.name_),Promise.all(F.container.getProviders().map(function(M){return M.delete()}))}).then(function(){F.isDeleted_=!0})},Q.prototype._getService=function(F,M){return M===void 0&&(M=O),this.checkDestroyed_(),this.container.getProvider(F).getImmediate({identifier:M})},Q.prototype._removeServiceInstance=function(F,M){M===void 0&&(M=O),this.container.getProvider(F).clearInstance(M)},Q.prototype._addComponent=function(F){try{this.container.addComponent(F)}catch(M){L.debug("Component "+F.name+" failed to register with FirebaseApp "+this.name,M)}},Q.prototype._addOrOverwriteComponent=function(F){this.container.addOrOverwriteComponent(F)},Q.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw g.create("app-deleted",{appName:this.name_})},Q}();r.prototype.name&&r.prototype.options||r.prototype.delete||console.log("dc");var t="7.18.0";function j(Q){var F={},M=new Map(),W={__esModule:!0,initializeApp:ma,app:la,registerVersion:aa,setLogLevel:d.setLogLevel,onLog:ia,apps:null,SDK_VERSION:t,INTERNAL:{registerComponent:X,removeApp:fa,components:M,useAsService:ja}};W.default=W,Object.defineProperty(W,"apps",{get:sa});function fa(R){delete F[R]}function la(R){R=R||O;if(!b.contains(F,R))throw g.create("no-app",{appName:R});return F[R]}la.App=Q;function ma(R,V){V===void 0&&(V={});if(typeof V!=="object"||V===null){var ea=V;V={name:ea}}var U=V;U.name===void 0&&(U.name=O);var ba=U.name;if(typeof ba!=="string"||!ba)throw g.create("bad-app-name",{appName:String(ba)});if(b.contains(F,ba))throw g.create("duplicate-app",{appName:ba});var oa=new Q(R,U,W);return F[ba]=oa,oa}function sa(){return Object.keys(F).map(function(R){return F[R]})}function X(R){var V,ea,U=R.name;if(M.has(U))return L.debug("There were multiple attempts to register component "+U+"."),R.type==="PUBLIC"?W[U]:null;M.set(U,R);if(R.type==="PUBLIC"){var ba=function(S){S===void 0&&(S=la());if(typeof S[U]!=="function")throw g.create("invalid-app-argument",{appName:U});return S[U]()};R.serviceProps!==void 0&&b.deepExtend(ba,R.serviceProps),W[U]=ba,Q.prototype[U]=function(){for(var S=[],Da=0;Da<arguments.length;Da++)S[Da]=arguments[Da];var A=this._getService.bind(this,U);return A.apply(this,R.multipleInstances?S:[])}}try{for(var oa=a.__values(Object.keys(F)),ta=oa.next();!ta.done;ta=oa.next()){var Ca=ta.value;F[Ca]._addComponent(R)}}catch(S){V={error:S}}finally{try{ta&&!ta.done&&(ea=oa.return)&&ea.call(oa)}finally{if(V)throw V.error}}return R.type==="PUBLIC"?W[U]:null}function aa(R,V,ea){var U,ba=(U=P[R])!==null&&U!==void 0?U:R;ea&&(ba+="-"+ea);var oa=ba.match(/\s|\//),ta=V.match(/\s|\//);if(oa||ta){var Ca=['Unable to register library "'+ba+'" with version "'+V+'":'];oa&&Ca.push('library name "'+ba+'" contains illegal characters (whitespace or "/")'),oa&&ta&&Ca.push("and"),ta&&Ca.push('version name "'+V+'" contains illegal characters (whitespace or "/")'),L.warn(Ca.join(" "));return}X(new c.Component(ba+"-version",function(){return{library:ba,version:V}},"VERSION"))}function ia(R,V){if(R!==null&&typeof R!=="function")throw g.create("invalid-log-argument",{appName:name});d.setUserLogHandler(R,V)}function ja(R,V){if(V==="serverAuth")return null;var ea=V;return ea}return W}function m(){var Q=j(r);Q.INTERNAL=a.__assign(a.__assign({},Q.INTERNAL),{createFirebaseNamespace:m,extendNamespace:F,createSubscribe:b.createSubscribe,ErrorFactory:b.ErrorFactory,deepExtend:b.deepExtend});function F(M){b.deepExtend(Q,M)}return Q}var l=m();var q=function(){function Q(F){this.container=F}return Q.prototype.getPlatformInfoString=function(){var F=this.container.getProviders();return F.map(function(M){if(w(M)){var W=M.getImmediate();return W.library+"/"+W.version}else return null}).filter(function(M){return M}).join(" ")},Q}();function w(Q){var F=Q.getComponent();return(F===null||F===void 0?void 0:F.type)==="VERSION"}function p(Q,F){Q.INTERNAL.registerComponent(new c.Component("platform-logger",function(M){return new q(M)},"PRIVATE")),Q.registerVersion(i,h,F),Q.registerVersion("fire-js","")}if(b.isBrowser()&&self.firebase!==void 0){L.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);var E=self.firebase.SDK_VERSION;E&&E.indexOf("LITE")>=0&&L.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}var H=l.initializeApp;l.initializeApp=function(){for(var Q=[],F=0;F<arguments.length;F++)Q[F]=arguments[F];return b.isNode()&&L.warn(`
      Warning: This is a browser-targeted Firebase bundle but it appears it is being
      run in a Node environment.  If running in a Node environment, make sure you
      are using the bundle specified by the "main" field in package.json.
      
      If you are using Webpack, you can specify "main" as the first item in
      "resolve.mainFields":
      https://webpack.js.org/configuration/resolve/#resolvemainfields
      
      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"
      as the first item in "mainFields", e.g. ['main', 'module'].
      https://github.com/rollup/rollup-plugin-node-resolve
      `),H.apply(void 0,Q)};var Y=l;p(Y);B.default=Y;B.firebase=Y});var Ra=qb((e,f)=>{"use strict";function a(g){return g&&typeof g==="object"&&"default"in g?g.default:g}var b=a(oj()),c="firebase",d="7.19.0";b.registerVersion(c,d,"app");f.exports=b});var $o=qb((b,c)=>{var a=function(){function d(k,n){if(!i[k]){i[k]={};for(var o=0;o<k.length;o++)i[k][k.charAt(o)]=o}return i[k][n]}var e=String.fromCharCode,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",i={},h={compressToBase64:function(k){if(null==k)return"";var n=h._compress(k,6,function(o){return f.charAt(o)});switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(k){return null==k?"":""==k?null:h._decompress(k.length,32,function(n){return d(f,k.charAt(n))})},compressToUTF16:function(k){return null==k?"":h._compress(k,15,function(n){return e(n+32)})+" "},decompressFromUTF16:function(k){return null==k?"":""==k?null:h._decompress(k.length,16384,function(n){return k.charCodeAt(n)-32})},compressToUint8Array:function(k){for(var n=h.compress(k),o=new Uint8Array(2*n.length),s=0,u=n.length;u>s;s++){var v=n.charCodeAt(s);o[2*s]=v>>>8,o[2*s+1]=v%256}return o},decompressFromUint8Array:function(k){if(null===k||void 0===k)return h.decompress(k);for(var n=new Array(k.length/2),o=0,s=n.length;s>o;o++)n[o]=256*k[2*o]+k[2*o+1];var u=[];return n.forEach(function(v){u.push(e(v))}),h.decompress(u.join(""))},compressToEncodedURIComponent:function(k){return null==k?"":h._compress(k,6,function(n){return g.charAt(n)})},decompressFromEncodedURIComponent:function(k){return null==k?"":""==k?null:(k=k.replace(/ /g,"+"),h._decompress(k.length,32,function(n){return d(g,k.charAt(n))}))},compress:function(k){return h._compress(k,16,function(n){return e(n)})},_compress:function(k,n,o){if(null==k)return"";var s,u,v,y={},G={},K="",J="",N="",I=2,O=3,P=2,L=[],r=0,t=0;for(v=0;v<k.length;v+=1)if(K=k.charAt(v),Object.prototype.hasOwnProperty.call(y,K)||(y[K]=O++,G[K]=!0),J=N+K,Object.prototype.hasOwnProperty.call(y,J))N=J;else{if(Object.prototype.hasOwnProperty.call(G,N)){if(N.charCodeAt(0)<256){for(s=0;P>s;s++)r<<=1,t==n-1?(t=0,L.push(o(r)),r=0):t++;for(u=N.charCodeAt(0),s=0;8>s;s++)r=r<<1|1&u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u>>=1}else{for(u=1,s=0;P>s;s++)r=r<<1|u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u=0;for(u=N.charCodeAt(0),s=0;16>s;s++)r=r<<1|1&u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u>>=1}I--,0==I&&(I=Math.pow(2,P),P++),delete G[N]}else for(u=y[N],s=0;P>s;s++)r=r<<1|1&u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u>>=1;I--,0==I&&(I=Math.pow(2,P),P++),y[J]=O++,N=String(K)}if(""!==N){if(Object.prototype.hasOwnProperty.call(G,N)){if(N.charCodeAt(0)<256){for(s=0;P>s;s++)r<<=1,t==n-1?(t=0,L.push(o(r)),r=0):t++;for(u=N.charCodeAt(0),s=0;8>s;s++)r=r<<1|1&u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u>>=1}else{for(u=1,s=0;P>s;s++)r=r<<1|u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u=0;for(u=N.charCodeAt(0),s=0;16>s;s++)r=r<<1|1&u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u>>=1}I--,0==I&&(I=Math.pow(2,P),P++),delete G[N]}else for(u=y[N],s=0;P>s;s++)r=r<<1|1&u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u>>=1;I--,0==I&&(I=Math.pow(2,P),P++)}for(u=2,s=0;P>s;s++)r=r<<1|1&u,t==n-1?(t=0,L.push(o(r)),r=0):t++,u>>=1;for(;;){if(r<<=1,t==n-1){L.push(o(r));break}t++}return L.join("")},decompress:function(k){return null==k?"":""==k?null:h._decompress(k.length,32768,function(n){return k.charCodeAt(n)})},_decompress:function(k,n,o){var s,u,v,y,G,K,J,N,I=[],O=4,P=4,L=3,r="",t=[],j={val:o(0),position:n,index:1};for(u=0;3>u;u+=1)I[u]=u;for(y=0,K=Math.pow(2,2),J=1;J!=K;)G=j.val&j.position,j.position>>=1,0==j.position&&(j.position=n,j.val=o(j.index++)),y|=(G>0?1:0)*J,J<<=1;switch(s=y){case 0:for(y=0,K=Math.pow(2,8),J=1;J!=K;)G=j.val&j.position,j.position>>=1,0==j.position&&(j.position=n,j.val=o(j.index++)),y|=(G>0?1:0)*J,J<<=1;N=e(y);break;case 1:for(y=0,K=Math.pow(2,16),J=1;J!=K;)G=j.val&j.position,j.position>>=1,0==j.position&&(j.position=n,j.val=o(j.index++)),y|=(G>0?1:0)*J,J<<=1;N=e(y);break;case 2:return""}for(I[3]=N,v=N,t.push(N);;){if(j.index>k)return"";for(y=0,K=Math.pow(2,L),J=1;J!=K;)G=j.val&j.position,j.position>>=1,0==j.position&&(j.position=n,j.val=o(j.index++)),y|=(G>0?1:0)*J,J<<=1;switch(N=y){case 0:for(y=0,K=Math.pow(2,8),J=1;J!=K;)G=j.val&j.position,j.position>>=1,0==j.position&&(j.position=n,j.val=o(j.index++)),y|=(G>0?1:0)*J,J<<=1;I[P++]=e(y),N=P-1,O--;break;case 1:for(y=0,K=Math.pow(2,16),J=1;J!=K;)G=j.val&j.position,j.position>>=1,0==j.position&&(j.position=n,j.val=o(j.index++)),y|=(G>0?1:0)*J,J<<=1;I[P++]=e(y),N=P-1,O--;break;case 2:return t.join("")}if(0==O&&(O=Math.pow(2,L),L++),I[N])r=I[N];else{if(N!==P)return null;r=v+v.charAt(0)}t.push(r),I[P++]=v+r.charAt(0),O--,v=r,0==O&&(O=Math.pow(2,L),L++)}}};return h}();"function"==typeof define&&define.amd?define(function(){return a}):"undefined"!=typeof c&&null!=c&&(c.exports=a)});let yj,zj=0,Aj=0;const ua={get:()=>yj,set:a=>{yj=a},getFrame:()=>zj,setFrame:a=>{zj=a},getElapsed:()=>Aj,setElapsed:a=>{Aj=a}};let Ej=0;function Wf(a=0){return()=>{Ej=a}}function Wd(){return Ej}let hg="Phaser",fp="https://phaser4.io",gp="#fff",hp="linear-gradient(#3e0081 40%, #00bcc3)";function dg(){if(hg!==""){const a=ua.get(),b=hg==="Phaser"?" v"+a.VERSION:"";console.log(`%c${hg}${b}%c ${fp}`,`padding: 4px 16px; color: ${gp}; background: ${hp}`,"")}}let Jj=800,Kj=600,Lj=1;function Zf(a=800,b=600,c=1){return c===0&&(c=window.devicePixelRatio),()=>{Jj=a,Kj=b,Lj=c}}function Bb(){return Jj}function Cb(){return Kj}function Db(){return Lj}const wg=[],Ac={add:a=>{wg.push(a)},get:()=>wg,clear:()=>{wg.length=0}};let Ij;function Xd(a){Ij=a}function eg(){return Ij}let ig=.5,jg=.5;let Fj=0;function kg(a){Fj=a}function Yc(){return Fj}function Yd(a){let b;return a&&(typeof a==="string"?b=document.getElementById(a):typeof a==="object"&&a.nodeType===1&&(b=a)),b||(b=document.body),b}let Gj;function Xf(a){return()=>{a&&(Gj=Yd(a))}}function fg(){return Gj}let Hj=[];function Yf(a){return()=>{Hj=[].concat(a)}}function lg(){return Hj}let jp={alpha:!1,antialias:!1,depth:!1,premultipliedAlpha:!1};function mg(){return jp}class bk{constructor(a){this.stack=[],this.current=null,this.renderer=a}reset(){this.stack=[],this.current=null;const a=this.renderer,b=a.gl;b.bindFramebuffer(b.FRAMEBUFFER,null),b.viewport(0,0,a.width,a.height)}add(a,b=!0,c=0,d=0){this.stack.push({framebuffer:a,width:c,height:d}),this.set(a,b,c,d)}set(a,b=!0,c=0,d=0){const e=this.renderer,f=e.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),b&&(f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),c>0&&f.viewport(0,0,c,d),this.current=a}pop(){this.stack.pop();const a=this.stack.length;if(a>0){const b=this.stack[a-1];this.set(b.framebuffer,!1,b.width,b.height)}else this.reset()}rebind(){const a=this.renderer.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.current)}destroy(){this.stack=[]}}let ak;const za={get:()=>ak,set:a=>{ak=a}};function ck(a,b=[]){const c=a>>16&255,d=a>>8&255,e=a&255,f=a>16777215?a>>>24:255;return b[0]=c/255,b[1]=d/255,b[2]=e/255,b[3]=f/255,b}function Zj(a,b){return a.a===b.a&&a.b===b.b&&a.c===b.c&&a.d===b.d&&a.tx===b.tx&&a.ty===b.ty}function fe(a,b){const c=za.get();b||(b=c.COLOR_ATTACHMENT0);const d=c.createFramebuffer();return c.bindFramebuffer(c.FRAMEBUFFER,d),c.framebufferTexture2D(c.FRAMEBUFFER,b,c.TEXTURE_2D,a,0),c.bindFramebuffer(c.FRAMEBUFFER,null),d}function le(a){const b=za.get();if(!b)return;const{parent:c,flipY:d,unpackPremultiplyAlpha:e,minFilter:f,magFilter:g,wrapS:i,wrapT:h,generateMipmap:k,isPOT:n}=a,o=c.image;let s=c.width,u=c.height;const v=b.createTexture();return b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,v),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,d),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),o?(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,o),s=o.width,u=o.height):b.texImage2D(b.TEXTURE_2D,0,b.RGBA,s,u,0,b.RGBA,b.UNSIGNED_BYTE,null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,g),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,i),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,h),k&&n&&b.generateMipmap(b.TEXTURE_2D),a.texture=v,v}function Zb(a){const b=za.get();b&&b.isFramebuffer(a)&&b.deleteFramebuffer(a)}function xg(a){const b=za.get();if(!b)return;b.isTexture(a)&&b.deleteTexture(a)}function _j(a,b){return a<1||b<1?!1:(a&a-1)===0&&(b&b-1)===0}function lk(a,b=!0){const c=za.get();c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,a);const d=b?c.LINEAR:c.NEAREST;c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,d),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,d)}function mk(a){const b=za.get(),c=a.parent.image,d=c.width,e=c.height;return d>0&&e>0&&(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,a.texture),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,a.flipY),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,c)),a.texture}class zc{constructor(a,b={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1;const c=za.get();this.parent=a,this.isPOT=_j(a.width,a.height);const{texture:d=null,framebuffer:e=null,unpackPremultiplyAlpha:f=!0,minFilter:g=c.LINEAR,magFilter:i=c.LINEAR,wrapS:h=c.CLAMP_TO_EDGE,wrapT:k=c.CLAMP_TO_EDGE,generateMipmap:n=this.isPOT,flipY:o=!1}=b;this.minFilter=g,this.magFilter=i,this.wrapS=h,this.wrapT=k,this.generateMipmap=n,this.flipY=o,this.unpackPremultiplyAlpha=f,e&&(this.framebuffer=e),d?this.texture=d:le(this)}setFilter(a){this.texture&&lk(this.texture,a)}create(){const a=this.texture;return a&&xg(a),le(this)}update(){const a=this.texture;return a?mk(this):le(this)}setIndex(a){this.dirtyIndex=a!==this.index,this.index=a}destroy(){xg(this.texture),Zb(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}}class ik{constructor(a,b,c,d,e){this.batchSize=a,this.dataSize=b,this.indexSize=c,this.vertexElementSize=d,this.quadIndexSize=e,this.vertexByteSize=d*b,this.quadByteSize=this.vertexByteSize*4,this.quadElementSize=d*4,this.bufferByteSize=a*this.quadByteSize,this.create()}create(){let a=[];for(let c=0;c<this.batchSize*this.indexSize;c+=this.indexSize)a.push(c+0,c+1,c+2,c+2,c+3,c+0);this.data=new ArrayBuffer(this.bufferByteSize),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const b=za.get();this.vertexBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.data,b.DYNAMIC_DRAW),this.indexBuffer=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.index,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,null),a=[]}destroy(){}}class yg{constructor(a,b,c,d,e,f){this.trimmed=!1,this.texture=a,this.key=b,this.x=c,this.y=d,this.width=e,this.height=f,this.sourceSizeWidth=e,this.sourceSizeHeight=f,this.updateUVs()}setPivot(a,b){this.pivot={x:a,y:b}}setSize(a,b){this.width=a,this.height=b,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.updateUVs()}setSourceSize(a,b){this.sourceSizeWidth=a,this.sourceSizeHeight=b}setTrim(a,b,c,d,e,f){this.trimmed=!0,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.spriteSourceSizeX=c,this.spriteSourceSizeY=d,this.spriteSourceSizeWidth=e,this.spriteSourceSizeHeight=f}getExtent(a,b){const c=this.sourceSizeWidth,d=this.sourceSizeHeight;let e,f,g,i;return this.trimmed?(e=this.spriteSourceSizeX-a*c,f=e+this.spriteSourceSizeWidth,g=this.spriteSourceSizeY-b*d,i=g+this.spriteSourceSizeHeight):(e=-a*c,f=e+c,g=-b*d,i=g+d),{left:e,right:f,top:g,bottom:i}}setExtent(a){const b=a.transform,c=b.origin.x,d=b.origin.y,e=this.sourceSizeWidth,f=this.sourceSizeHeight;let g,i,h,k;this.trimmed?(g=this.spriteSourceSizeX-c*e,i=this.spriteSourceSizeY-d*f,h=this.spriteSourceSizeWidth,k=this.spriteSourceSizeHeight):(g=-c*e,i=-d*f,h=e,k=f),b.setExtent(g,i,h,k)}updateUVs(){const{x:a,y:b,width:c,height:d}=this,e=this.texture.width,f=this.texture.height;this.u0=a/e,this.v0=b/f,this.u1=(a+c)/e,this.v1=(b+d)/f}}class Na{constructor(a,b,c){this.key="",a&&(b=a.width,c=a.height),this.image=a,this.width=b,this.height=c,this.frames=new Map(),this.data={},this.addFrame("__BASE",0,0,b,c),Ac.add(this)}addFrame(a,b,c,d,e){if(this.frames.has(a))return null;const f=new yg(this,a,b,c,d,e);return this.frames.set(a,f),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=f),f}getFrame(a){if(!a)return this.firstFrame;a instanceof yg&&(a=a.key);let b=this.frames.get(a);return b||(console.warn(`Frame missing: ${a}`),b=this.firstFrame),b}setSize(a,b){this.width=a,this.height=b;const c=this.frames.get("__BASE");c.setSize(a,b)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}}let hk;const ed={get:()=>hk,set:a=>{hk=a}};const kk={fragmentShader:`\r
#define SHADER_NAME SINGLE_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture;\r
\r
void main (void)\r
{\r
    vec4 color = texture2D(uTexture, vTextureCoord);\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`,vertexShader:`\r
#define SHADER_NAME SINGLE_QUAD_VERT\r
\r
precision highp float;\r
\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
attribute float aTextureId;\r
attribute vec4 aTintColor;\r
\r
uniform mat4 uProjectionMatrix;\r
uniform mat4 uCameraMatrix;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
void main (void)\r
{\r
    vTextureCoord = aTextureCoord;\r
    vTextureId = aTextureId;\r
    vTintColor = aTintColor;\r
\r
    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\r
}`};class ke{constructor(a={}){this.attribs={aVertexPosition:0,aTextureCoord:0,aTextureId:0,aTintColor:0},this.uniforms={uProjectionMatrix:0,uCameraMatrix:0,uTexture:0,uTime:0,uResolution:0},this.renderToFBO=!1,this.renderer=ed.get();const{batchSize:b=4096,dataSize:c=4,indexSize:d=4,vertexElementSize:e=6,quadIndexSize:f=6,fragmentShader:g=kk.fragmentShader,vertexShader:i=kk.vertexShader,width:h=Bb(),height:k=Cb(),resolution:n=Db(),renderToFBO:o=!1}=a;this.buffer=new ik(b,c,d,e,f),this.createShaders(g,i),this.count=0,this.renderToFBO=o;const s=new Na(null,h*n,k*n),u=new zc(s);s.binding=u,u.framebuffer=fe(u.texture),this.texture=s,this.framebuffer=u.framebuffer}createShaders(a,b){const c=this.renderer.gl,d=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(d,a),c.compileShader(d);let e=!1,f=c.getShaderInfoLog(d);f.length>0&&(e=!0,console.error(f));const g=c.createShader(c.VERTEX_SHADER);c.shaderSource(g,b),c.compileShader(g),f=c.getShaderInfoLog(d),f.length>0&&(e=!0,console.error(f));if(e)return;const i=c.createProgram();c.attachShader(i,g),c.attachShader(i,d),c.linkProgram(i),c.useProgram(i),this.program=i;for(const h of Object.keys(this.attribs)){const k=c.getAttribLocation(i,h);c.enableVertexAttribArray(k),this.attribs[h]=k}for(const h of Object.keys(this.uniforms))this.uniforms[h]=c.getUniformLocation(i,h)}bind(a,b,c){if(!this.program)return!1;const d=this.renderer,e=d.gl,f=this.uniforms;return e.useProgram(this.program),e.uniformMatrix4fv(f.uProjectionMatrix,!1,a),e.uniformMatrix4fv(f.uCameraMatrix,!1,b),e.uniform1i(f.uTexture,d.textures.textureIndex[c]),e.uniform1f(f.uTime,performance.now()),e.uniform2f(f.uResolution,d.width,d.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}bindBuffers(a,b){const c=this.renderer.gl,d=this.buffer.vertexByteSize,e=this.attribs;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a),c.bindBuffer(c.ARRAY_BUFFER,b),c.vertexAttribPointer(e.aVertexPosition,2,c.FLOAT,!1,d,0),c.vertexAttribPointer(e.aTextureCoord,2,c.FLOAT,!1,d,8),c.vertexAttribPointer(e.aTextureId,1,c.FLOAT,!1,d,16),c.vertexAttribPointer(e.aTintColor,4,c.UNSIGNED_BYTE,!0,d,20),this.count=0}draw(a){const b=this.renderer,c=b.gl,d=this.buffer;if(a===d.batchSize)c.bufferData(c.ARRAY_BUFFER,d.data,c.DYNAMIC_DRAW);else{const e=d.vertexViewF32.subarray(0,a*d.quadElementSize);c.bufferSubData(c.ARRAY_BUFFER,0,e)}this.renderToFBO&&b.fbo.add(this.framebuffer,!0),c.drawElements(c.TRIANGLES,a*d.quadIndexSize,c.UNSIGNED_SHORT,0),this.renderToFBO&&b.fbo.pop()}flush(){const a=this.count;return a===0?!1:(this.draw(a),this.prevCount=a,this.count=0,!0)}}const xp=`\r
#define SHADER_NAME MULTI_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture[%count%];\r
\r
void main (void)\r
{\r
    vec4 color;\r
\r
    %forloop%\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`;class dk extends ke{constructor(a={fragmentShader:xp}){super(a)}createShaders(a,b){const c=Yc();let d="";for(let e=1;e<c;e++)e>1&&(d+=`
	else `),e<c-1&&(d+=`if (vTextureId < ${e}.5)`),d+=`
	{`,d+=`
		color = texture2D(uTexture[${e}], vTextureCoord);`,d+=`
	}`;a=a.replace(/%count%/gi,`${c}`),a=a.replace(/%forloop%/gi,d),super.createShaders(a,b)}bind(a,b){if(!this.program)return!1;const c=this.renderer,d=c.gl,e=this.uniforms;return d.useProgram(this.program),d.uniformMatrix4fv(e.uProjectionMatrix,!1,a),d.uniformMatrix4fv(e.uCameraMatrix,!1,b),d.uniform1iv(e.uTexture,c.textures.textureIndex),d.uniform1f(e.uTime,performance.now()),d.uniform2f(e.uResolution,c.width,c.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}}function ek(a,b,c=-1,d=1){const e=-2*(1/-a),f=-2*(1/b),g=2*(1/(c-d));return new Float32Array([e,0,0,0,0,f,0,0,0,0,g,0,-1,1,0,1])}class fk{constructor(a,b){this.renderer=a;const c={shader:new b()};this.stack=[c],this.currentEntry=c,this.current=c.shader,this.singleQuadShader=new ke()}add(a,b){const c={shader:a,textureID:b};return this.stack.push(c),c}set(a,b){this.flush();const c=this.renderer,d=c.projectionMatrix,e=c.currentCamera.matrix,f=a.bind(d,e,b);if(f){const g=this.add(a,b);this.currentEntry=g,this.current=a}return f}setDefault(a){this.set(this.singleQuadShader,a)}pop(){this.flush();const a=this.stack;a.length>1&&a.pop(),this.currentEntry=a[a.length-1],this.current=this.currentEntry.shader}reset(){this.pop(),this.rebind()}flush(){return this.current.flush()?(this.renderer.flushTotal++,!0):!1}rebind(){const a=this.renderer,b=a.projectionMatrix,c=a.currentCamera.matrix,d=this.currentEntry;d.shader.bind(b,c,d.textureID)}popAndRebind(){this.pop(),this.rebind()}clear(){}destroy(){}}const vp=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function wp(a){let b="";for(let c=0;c<a;++c)c>0&&(b+=`
else `),c<a-1&&(b+=`if(test == ${c}.0){}`);return b}function jk(a,b){const c=b.createShader(b.FRAGMENT_SHADER);for(;;){const d=vp.replace(/%forloop%/gi,wp(a));b.shaderSource(c,d),b.compileShader(c);if(!b.getShaderParameter(c,b.COMPILE_STATUS))a=a/2|0;else break}return a}class gk{constructor(a){this.startActiveTexture=0,this.renderer=a,this.tempTextures=[],this.textureIndex=[]}init(){const a=this.renderer.gl;let b=jk(a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),a);const c=Yc();c===0||c>0&&c>b?kg(b):c>0&&c<b&&(b=Math.max(8,c));const d=this.tempTextures;d.length&&d.forEach(f=>{a.deleteTexture(f)});const e=[];for(let f=0;f<b;f++){const g=a.createTexture();a.activeTexture(a.TEXTURE0+f),a.bindTexture(a.TEXTURE_2D,g),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),d[f]=g,e.push(f)}this.maxTextures=b,this.textureIndex=e,this.currentActiveTexture=1}update(){const a=Ac.get();for(let b=0;b<a.length;b++){const c=a[b];c.binding||(c.binding=new zc(c))}Ac.clear()}reset(){const a=this.renderer.gl,b=this.tempTextures;for(let c=0;c<b.length;c++)a.activeTexture(a.TEXTURE0+c),a.bindTexture(a.TEXTURE_2D,b[c]);this.currentActiveTexture=1,this.startActiveTexture++}bind(a,b=0){const c=this.renderer.gl,d=a.binding;d.setIndex(b),c.activeTexture(c.TEXTURE0+b),c.bindTexture(c.TEXTURE_2D,d.texture)}unbind(a=0){const b=this.renderer.gl;b.activeTexture(b.TEXTURE0+a),b.bindTexture(b.TEXTURE_2D,this.tempTextures[a]),a>0&&this.startActiveTexture++}request(a){const b=this.renderer.gl,c=a.binding,d=this.currentActiveTexture;return c.indexCounter>=this.startActiveTexture?!1:(c.indexCounter=this.startActiveTexture,d<this.maxTextures?(c.setIndex(d),b.activeTexture(b.TEXTURE0+d),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture++):(this.renderer.flush(),this.startActiveTexture++,c.indexCounter=this.startActiveTexture,c.setIndex(1),b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture=2),!0)}}class Mj{constructor(){this.clearColor=[0,0,0,1],this.flushTotal=0,this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.currentCamera=null,this.width=Bb(),this.height=Cb(),this.resolution=Db(),this.setBackgroundColor(Wd());const a=document.createElement("canvas");a.addEventListener("webglcontextlost",b=>this.onContextLost(b),!1),a.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=a,this.fbo=new bk(this),this.textures=new gk(this),this.initContext(),ed.set(this),this.shaders=new fk(this,dk)}initContext(){const a=this.canvas.getContext("webgl",mg());za.set(a),this.gl=a,a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE),this.resize(this.width,this.height,this.resolution),this.textures.init()}resize(a,b,c=1){this.width=a*c,this.height=b*c,this.resolution=c;const d=this.canvas;d.width=this.width,d.height=this.height,this.autoResize&&(d.style.width=(this.width/c).toString()+"px",d.style.height=(this.height/c).toString()+"px"),this.gl.viewport(0,0,this.width,this.height),this.projectionMatrix=ek(a,b)}onContextLost(a){a.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(a){return ck(a,this.clearColor),this}reset(a=null,b=this.width,c=this.height){const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),d.viewport(0,0,b,c),d.enable(d.BLEND),d.blendFunc(d.ONE,d.ONE_MINUS_SRC_ALPHA),this.flushTotal=0,this.currentCamera=null,this.textures.update()}render(a){if(this.contextLost)return;this.reset();if(this.optimizeRedraw&&a.numDirtyFrames===0&&a.numDirtyCameras===0)return;const b=this.gl;if(this.clearBeforeRender){const d=this.clearColor;b.clearColor(d[0],d[1],d[2],d[3]),b.clear(b.COLOR_BUFFER_BIT)}const c=a.worldData;for(let d=0;d<c.length;d++){const{camera:e,renderList:f}=c[d];(!this.currentCamera||!Zj(e.worldTransform,this.currentCamera.worldTransform))&&(this.flush(),this.currentCamera=e,this.shaders.rebind()),f.forEach(g=>{g.children.length?this.renderNode(g):g.node.renderGL(this)})}this.flush()}renderNode(a){a.node.renderGL(this),a.children.forEach(b=>{b.children.length>0?this.renderNode(b):b.node.renderGL(this)}),a.node.postRenderGL(this)}flush(){this.shaders.flush()}destroy(){ed.set(void 0)}}function _f(){return()=>{Xd(Mj)}}function ya(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);for(const e of d)e.callback.apply(e.context,c),e.once&&d.delete(e);return d.size===0&&a.events.delete(b),!0}function uj(a,b){const c=Yd(b);return c.appendChild(a),a}function vj(a){const b=document.readyState;if(b==="complete"||b==="interactive"){a();return}const c=()=>{document.removeEventListener("deviceready",c,!0),document.removeEventListener("DOMContentLoaded",c,!0),window.removeEventListener("load",c,!0),a()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",c,!0):(document.addEventListener("DOMContentLoaded",c,!0),window.addEventListener("load",c,!0)):window.setTimeout(c,20)}class gg{constructor(){this.events=new Map()}}class $c{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function $a(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new $c(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function Xb(a,b,c,d=a){return $a(a,b,c,d,!0)}function nk(){return{gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]}}function qk(a,b=0){a.gameFrame=b,a.numTotalFrames=0,a.numDirtyFrames=0,a.numDirtyCameras=0,a.worldData.length=0}let rk;const me={get:()=>rk,set:a=>{rk=a}};class wj{constructor(){this.scenes=new Map(),this.sceneIndex=0,this.flush=!1,this.renderResult=nk(),this.game=ua.get(),me.set(this),Xb(this.game,"boot",()=>this.boot())}boot(){lg().forEach(a=>new a())}update(a,b){for(const c of this.scenes.values())ya(c,"update",a,b)}render(a){const b=this.renderResult;qk(b,a);for(const c of this.scenes.values())ya(c,"render",b);return this.flush&&(b.numDirtyFrames++,this.flush=!1),b}}function fd(a,b){const c=document.createElement("canvas");return c.width=a,c.height=b,c.getContext("2d")}let sk;const Ha={get:()=>sk,set:a=>{sk=a}};class xj{constructor(){this.textures=new Map(),this.createDefaultTextures(),Ha.set(this)}createDefaultTextures(){this.add("__BLANK",new Na(fd(32,32).canvas));const a=fd(32,32);a.strokeStyle="#0f0",a.moveTo(0,0),a.lineTo(32,32),a.stroke(),a.strokeRect(.5,.5,31,31),this.add("__MISSING",new Na(a.canvas))}get(a){const b=this.textures;return b.has(a)?b.get(a):b.get("__MISSING")}has(a){return this.textures.has(a)}add(a,b){let c;const d=this.textures;return d.has(a)||(b instanceof Na?c=b:c=new Na(b),c.key=a,d.set(a,c)),c}}class mj extends gg{constructor(...a){super();this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,ua.set(this),vj(()=>this.boot(a))}boot(a){a.forEach(d=>d());const b=eg();this.renderer=new b(),this.textureManager=new xj(),this.sceneManager=new wj();const c=fg();c&&uj(this.renderer.canvas,c),this.isBooted=!0,dg(),ya(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(a){const b=a-this.lastTick;this.lastTick=a,this.elapsed+=b,this.isPaused||(this.willUpdate&&(this.sceneManager.update(b,a),ya(this,"update",b,a)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,ua.setFrame(this.frame),ua.setElapsed(this.elapsed),requestAnimationFrame(c=>this.step(c))}destroy(){}}function ok(a,b,c){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:c}function pk(a,b={}){const c=me.get(),d=c.scenes.size,e=c.sceneIndex,f=d===0;typeof b==="string"?a.key=b:(b||!b&&f)&&(a.key=ok(b,"key","scene"+e.toString())),c.scenes.has(a.key)?console.warn("Scene key already in use: "+a.key):(c.scenes.set(a.key,a),c.flush=!0,c.sceneIndex++)}class Td{constructor(a){this.game=ua.get(),this.events=new Map(),pk(this,a)}}function Vb(a){const b=[a],c=[];for(;b.length>0;){const d=b.shift();c.push(d);const e=d.numChildren;if(e>0)for(let f=e-1;f>=0;f--)b.unshift(d.children[f])}return c.shift(),c}function sb(a,b){return a.children.indexOf(b)}function Zd(a,b){const c=a.children;let d;if(b>=0&&b<c.length){const e=c.splice(b,1);e[0]&&(d=e[0],d.parent=null)}return d}function Wb(a,b){const c=sb(a,b);return c>-1&&Zd(a,c),b}const qg="addedtoworld";const rg="removedfromworld";function pg(a,...b){return b.forEach(c=>{c.world&&(ya(c.world,rg,c,c.world),ya(c,rg,c,c.world)),c.world=a,ya(a,qg,c,a),ya(c,qg,c,a)}),b}function Ub(a,...b){b.forEach(d=>{d.parent&&Wb(d.parent,d),d.parent=a});const c=a.world;return c&&pg(c,...Vb(a)),b}function xc(a,b){return a.children.push(b),Ub(a,b),b.transform.updateWorld(),b}const _={CLEAR:0,TRANSFORM:1,UPDATE:2,CHILD_CACHE:4,POST_RENDER:8,COLORS:16,BOUNDS:32,TEXTURE:64,FRAME:128,ALPHA:256,CHILD:512,DEFAULT:1+2+16+32,USER1:536870912,USER2:1073741824,USER3:2147483648,USER4:4294967296};function Zc(a,b=0,c){const d=a.children;c===void 0&&(c=d.length);const e=c-b;if(e>0&&e<=c){const f=d.splice(b,e);return f.forEach(g=>{g.parent=null}),f}else return[]}function ng(a,b=0,c){const d=Zc(a,b,c);d.forEach(e=>{e.destroy()})}function _c(a,...b){return b.forEach(c=>{Wb(a,c)}),b}function og(a,b,c=0,d){const e=Zc(a,c,d);return Ub(b,...e),e.forEach(f=>{f.transform.updateWorld()}),e}class Tb{constructor(a=1,b=0,c=0,d=1,e=0,f=0){this.set(a,b,c,d,e,f)}set(a=1,b=0,c=0,d=1,e=0,f=0){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=e,this.ty=f,this}identity(){return this.set()}toArray(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]}fromArray(a){return this.set(a[0],a[1],a[2],a[3],a[4],a[5])}}function he(a,b,c){return a.width<=0||a.height<=0?!1:a.x<=b&&a.x+a.width>=b&&a.y<=c&&a.y+a.height>=c}class Ma{constructor(a=0,b=0,c=0,d=0){this.set(a,b,c,d)}set(a=0,b=0,c=0,d=0){return this.x=a,this.y=b,this.width=c,this.height=d,this}contains(a,b){return he(this,a,b)}set right(a){a<=this.x?this.width=0:this.width=a-this.x}get right(){return this.x+this.width}set bottom(a){a<=this.y?this.height=0:this.height=a-this.y}get bottom(){return this.y+this.height}}function $j(){}class rb{constructor(a,b=0,c=0,d=!1){this.compareValue=!1,this._x=b,this._y=c,this.callback=a,this.compareValue=d}set(a=0,b=0){return this._x=a,this._y=b,this.callback(this),this}destroy(){this.callback=$j}set x(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._x=a,this.callback(this))}get x(){return this._x}set y(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._y=a,this.callback(this))}get y(){return this._y}}function Yj(a,b,c){const d=c-b;return b+((a-b)%d+d)%d}function Bj(a){return Yj(a,-Math.PI,Math.PI)}class Cj{constructor(){this._rotation=0,this.type="Camera",this.dirtyRender=!0;const a=ua.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1]),this.bounds=new Ma(),this.worldTransform=new Tb(),this.position=new rb(()=>this.updateTransform(),0,0),this.scale=new rb(()=>this.updateTransform(),1,1),this.origin=new rb(()=>this.updateTransform(),.5,.5),this.reset()}updateTransform(){const a=this.matrix,b=this.position.x,c=this.position.y,d=this.scale.x,e=this.scale.y,f=-b+this.width*this.origin.x,g=-c+this.height*this.origin.y,i=Math.sin(this.rotation),h=Math.cos(this.rotation),k=i+i,n=i*k,o=h*k,s=(1-n)*d,u=o*d,v=-o*e,y=(1-n)*e;a[0]=s,a[1]=u,a[4]=v,a[5]=y,a[12]=b+f-(s*f+v*g),a[13]=c+g-(u*f+y*g),this.worldTransform.set(h*d,i*d,-i*e,h*e,-b,-c);const G=this.width*(1/d),K=this.height*(1/e);this.bounds.set(f-G/2,g-K/2,G,K),this.dirtyRender=!0}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}set rotation(a){a!==this._rotation&&(this._rotation=Bj(a),this.updateTransform())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.origin.destroy(),this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}class Dj{constructor(){this.type="StaticCamera",this.dirtyRender=!0;const a=ua.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.bounds=new Ma(),this.worldTransform=new Tb(),this.reset()}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}const _d="destroy";const Nj="postupdate";const Oj="update";function tb(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof $c)g.delete(c);else{const i=!d,h=e!==void 0;for(const k of g)k.callback===c&&(i&&k.context===d)&&(h&&k.once===e)&&g.delete(k)}return g.size===0&&f.delete(b),a}function yc(a){const{a:b,b:c,c:d,d:e,tx:f,ty:g}=a.world,{x:i,y:h,right:k,bottom:n}=a.extent,o=i*b+h*d+f,s=i*c+h*e+g,u=i*b+n*d+f,v=i*c+n*e+g,y=k*b+n*d+f,G=k*c+n*e+g,K=k*b+h*d+f,J=k*c+h*e+g;return{x0:o,y0:s,x1:u,y1:v,x2:y,y2:G,x3:K,y3:J}}class $d{constructor(a){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=a,this.area=new Ma()}set(a,b,c,d){this.area.set(a,b,c,d)}get(){return this.entity.isDirty(_.BOUNDS)&&!this.fixed&&this.update(),this.area}updateLocal(){const{x0:a,y0:b,x1:c,y1:d,x2:e,y2:f,x3:g,y3:i}=yc(this.entity.transform),h=Math.min(a,c,e,g),k=Math.min(b,d,f,i),n=Math.max(a,c,e,g),o=Math.max(b,d,f,i);return this.area.set(h,k,n-h,o-k)}update(){const a=this.updateLocal();this.entity.clearDirty(_.BOUNDS);if(!this.includeChildren||!this.entity.numChildren)return a;const b=this.visibleOnly,c=this.entity.children;let d=a.x,e=a.y,f=a.right,g=a.bottom;for(let i=0;i<c.length;i++){const h=c[i];if(!h||b&&!h.visible)continue;const k=h.bounds.get();k.x<d&&(d=k.x),k.y<e&&(e=k.y),k.right>f&&(f=k.right),k.bottom>g&&(g=k.bottom)}return a.set(d,e,f-d,g-e)}destroy(){this.entity=null,this.area=null}}class ae{constructor(a){this.enabled=!1,this.enabledChildren=!0,this.entity=a}destroy(){this.entity=null,this.hitArea=null}}class gb{constructor(a=0,b=0){this.set(a,b)}set(a=0,b=0){return this.x=a,this.y=b,this}getArray(){return[this.x,this.y]}fromArray(a){return this.set(a[0],a[1])}toString(){return`[x=${this.x}, y=${this.y}]`}}function ce(a){const b=a.local,c=a.position.x,d=a.position.y,e=a.rotation,f=a.scale.x,g=a.scale.y,i=a.skew.x,h=a.skew.y;b.set(Math.cos(e+h)*f,Math.sin(e+h)*f,-Math.sin(e-i)*g,Math.cos(e-i)*g,c,d)}function tg(a,b){return b.set(a.a,a.b,a.c,a.d,a.tx,a.ty)}function de(a){const b=a.parent,c=a.transform,d=c.local,e=c.world;if(!b)tg(d,e);else if(c.passthru)tg(b.transform.world,e);else{const{a:f,b:g,c:i,d:h,tx:k,ty:n}=d,{a:o,b:s,c:u,d:v,tx:y,ty:G}=b.transform.world;e.set(f*o+g*u,f*s+g*v,i*o+h*u,i*s+h*v,k*o+n*u+y,k*s+n*v+G)}}class be{constructor(a,b=0,c=0){this.passthru=!1,this._rotation=0,this.entity=a,this.local=new Tb(),this.world=new Tb(),this.position=new rb(()=>this.update(),b,c),this.scale=new rb(()=>this.update(),1,1,!0),this.skew=new rb(()=>this.update(),0,0,!0),this.origin=new rb(()=>this.updateExtent(),ig,jg),this.extent=new Ma()}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(_.TRANSFORM,_.BOUNDS),ce(this)}updateWorld(){const a=this.entity;a.setDirty(_.TRANSFORM,_.BOUNDS),de(a),a.numChildren&&this.updateChildren()}updateChildren(){const a=this.entity.children;for(let b=0;b<a.length;b++){const c=a[b];c.transform.updateWorld()}}globalToLocal(a,b,c=new gb()){const{a:d,b:e,c:f,d:g,tx:i,ty:h}=this.world,k=1/(d*g+f*-e);return c.x=g*k*a+-f*k*b+(h*f-i*g)*k,c.y=d*k*b+-e*k*a+(-h*d+i*e)*k,c}localToGlobal(a,b,c=new gb()){const{a:d,b:e,c:f,d:g,tx:i,ty:h}=this.world;return c.x=d*a+f*b+i,c.y=e*a+g*b+h,c}setExtent(a,b,c,d){this.extent.set(a,b,c,d),this.entity.setDirty(_.TRANSFORM,_.BOUNDS)}updateExtent(a,b){const c=this.extent,d=this.entity;a!==void 0&&(c.width=a),b!==void 0&&(c.height=b),c.x=-this.origin.x*c.width,c.y=-this.origin.y*c.height,d.setDirty(_.TRANSFORM,_.BOUNDS)}set rotation(a){a!==this._rotation&&(this._rotation=a,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}}class ub{constructor(a=0,b=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.events=new Map(),this.transform=new be(this,a,b),this.bounds=new $d(this),this.input=new ae(this),this.dirty=_.DEFAULT,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(a){return(this.dirty&a)!==0}clearDirty(a){return this.isDirty(a)&&(this.dirty^=a),this}setDirty(a,b){return this.isDirty(a)||(this.dirty^=a,this.dirtyFrame=ua.getFrame()),this.isDirty(b)||(this.dirty^=b),this}update(a,b){if(this.willUpdateChildren){const c=this.children;for(let d=0;d<c.length;d++){const e=c[d];e&&e.willUpdate&&e.update(a,b)}}this.postUpdate(a,b)}postUpdate(a,b){}renderGL(a){}renderCanvas(a){}postRenderGL(a){}postRenderCanvas(a){}get numChildren(){return this.children.length}destroy(a){a?og(this,a):ng(this),ya(this,_d,this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}}const ie="worldrender";const je="worldshutdown";var up=Object.freeze({__proto__:null,WorldRenderEvent:ie,WorldShutdownEvent:je});function ne(a,b){b.numRendered++,b.numRenderable++,a.node.dirtyFrame>=b.gameFrame&&b.dirtyFrame++,a.children.forEach(c=>{c.children.length>0&&ne(c,b)})}function Cg(a){if(a.node.isDirty(_.CHILD_CACHE))return!0;const b=[a];for(;b.length>0;){const c=b.pop();if(c.node.isDirty(_.TRANSFORM))return!0;const d=c.children.length;if(d>0)for(let e=0;e<d;e++)b.push(c.children[e])}return b.length=0,!1}function Bg(a,b){a.forEach(c=>{b||Cg(c)?c.node.setDirty(_.CHILD_CACHE):c.children.length=0})}function oe(a,b,c=[]){for(let d=0;d<b.numChildren;d++){const e=b.children[d];if(e.isRenderable()){const f=[],g={node:e,children:f};c.push(g),e.willRenderChildren&&e.numChildren>0&&(e.willCacheChildren&&a.push(g),oe(a,e,f))}}return c}function zg(a){const b=[],c=[],d=oe(b,a,c),e=a.renderData;b.length>0&&Bg(b,a.camera.dirtyRender),d.forEach(f=>{f.children.length?ne(f,e):(e.numRendered++,e.numRenderable++,f.node.dirtyFrame>=e.gameFrame&&e.dirtyFrame++)}),e.renderList=d,a.forceRefresh&&(e.dirtyFrame++,a.forceRefresh=!1)}function Ag(a,b){a.numDirtyFrames+=b.dirtyFrame,a.numTotalFrames+=b.numRendered,b.camera.dirtyRender&&a.numDirtyCameras++,a.worldData.push(b)}function gd(a,b){a.gameFrame=b,a.dirtyFrame=0,a.numRendered=0,a.numRenderable=0,a.renderList.length=0}class $b extends ub{constructor(a){super();this.forceRefresh=!1,this.type="BaseWorld",this.scene=a,this.world=this,this.events=new Map(),this._updateListener=$a(a,"update",(b,c)=>this.update(b,c)),this._renderListener=$a(a,"render",b=>this.render(b)),this._shutdownListener=$a(a,"shutdown",()=>this.shutdown()),Xb(a,"destroy",()=>this.destroy())}update(a,b){if(!this.willUpdate)return;ya(this,Oj,a,b,this),super.update(a,b)}postUpdate(a,b){ya(this,Nj,a,b,this)}render(a){const b=this.renderData;gd(b,a.gameFrame);if(!this.willRender||!this.visible)return;zg(this),ya(this,ie,b,this),Ag(a,b),this.camera&&(this.camera.dirtyRender=!1)}shutdown(){const a=this.scene;tb(a,"update",this._updateListener),tb(a,"render",this._renderListener),tb(a,"shutdown",this._shutdownListener),_c(this),ya(this,je,this),gd(this.renderData,0),this.camera&&this.camera.reset()}destroy(a){super.destroy(a),ya(this,_d,this),gd(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}}function hd(a){return{camera:a,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0,renderList:[]}}class $f extends $b{constructor(a){super(a);this.type="StaticWorld",this.camera=new Dj(),this.renderData=hd(this.camera)}}class yp extends $b{constructor(a){super(a);this.enableCameraCull=!0,this.type="World",this.camera=new Cj(),this.renderData=hd(this.camera)}}function Qj(a,b){const c=a.texture,d=b.shaders.current,e=d.buffer,f=c.binding;d.count===e.batchSize&&b.flush();const g=a.vertexData;b.textures.request(c);const i=f.index;g[4]=i,g[10]=i,g[16]=i,g[22]=i;const h=d.count*e.quadElementSize;e.vertexViewF32.set(g,h);const k=a.vertexColor,n=e.vertexViewU32;n[h+5]=k[0],n[h+11]=k[2],n[h+17]=k[3],n[h+23]=k[1],d.count++}var pp=Object.freeze({__proto__:null,BoundsComponent:$d,InputComponent:ae,GetVertices:yc,TransformComponent:be,UpdateLocalTransform:ce,UpdateWorldTransform:de});class Yb extends ub{constructor(a=0,b=0){super(a,b);this._alpha=1,this.type="Container"}setSize(a,b=a){return this.transform.updateExtent(a,b),this}setPosition(a,b){return this.transform.position.set(a,b),this}setOrigin(a,b=a){return this.transform.origin.set(a,b),this}setSkew(a,b=a){return this.transform.skew.set(a,b),this}setScale(a,b=a){return this.transform.scale.set(a,b),this}setRotation(a){return this.transform.rotation=a,this}set width(a){this.transform.updateExtent(a)}get width(){return this.transform.extent.width}set height(a){this.transform.updateExtent(void 0,a)}get height(){return this.transform.extent.height}set x(a){this.transform.position.x=a}get x(){return this.transform.position.x}set y(a){this.transform.position.y=a}get y(){return this.transform.position.y}set originX(a){this.transform.origin.x=a}get originX(){return this.transform.origin.x}set originY(a){this.transform.origin.y=a}get originY(){return this.transform.origin.y}set skewX(a){this.transform.skew.x=a}get skewX(){return this.transform.skew.x}set skewY(a){this.transform.skew.y=a}get skewY(){return this.transform.skew.y}set scaleX(a){this.transform.scale.x=a}get scaleX(){return this.transform.scale.x}set scaleY(a){this.transform.scale.y=a}get scaleY(){return this.transform.scale.y}set rotation(a){this.transform.rotation=a}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(a){a!==this._alpha&&(this._alpha=a,this.setDirty(_.TRANSFORM))}}function Rj(a,b){const c=a.frame;if(!c)return;const d=b.ctx,e=a.transform,{a:f,b:g,c:i,d:h,tx:k,ty:n}=e.world,{x:o,y:s}=e.extent;d.save(),d.setTransform(f,g,i,h,k,n),d.globalAlpha=a.alpha,d.drawImage(c.texture.image,c.x,c.y,c.width,c.height,o,s,c.width,c.height),d.restore()}function _b(a,b){const c=(b*255|0)&255;return(c<<24|a)>>>0}function Sj(a){const b=a.vertexAlpha,c=a.vertexTint,d=a.vertexColor;return d[0]=_b(c[0],b[0]),d[1]=_b(c[1],b[1]),d[2]=_b(c[2],b[2]),d[3]=_b(c[3],b[3]),a}function ge(a,b,...c){const d=a.getFrame(b),{u0:e,u1:f,v0:g,v1:i,pivot:h}=d;return c.forEach(k=>{if(!k||d===k.frame)return;k.frame=d,h&&k.setOrigin(h.x,h.y),k.frame.setExtent(k),k.hasTexture=!0;const n=k.vertexData;n[2]=e,n[3]=g,n[8]=e,n[9]=i,n[14]=f,n[15]=i,n[20]=f,n[21]=g}),c}function Pj(a,b,...c){if(!a)c.forEach(d=>{d.texture=null,d.frame=null,d.hasTexture=!1});else{let d;a instanceof Na?d=a:d=Ha.get().get(a),d?(c.forEach(e=>{e.texture=d}),ge(d,b,...c)):console.warn(`Invalid Texture key: ${a}`)}return c}function Tj(a){const b=a.vertexData,{x0:c,y0:d,x1:e,y1:f,x2:g,y2:i,x3:h,y3:k}=yc(a.transform);return b[0]=c,b[1]=d,b[6]=e,b[7]=f,b[12]=g,b[13]=i,b[18]=h,b[19]=k,a}class fb extends Yb{constructor(a,b,c,d){super(a,b);this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertexData=new Float32Array(24).fill(0),this.vertexColor=new Uint32Array(4).fill(4294967295),this.vertexAlpha=new Float32Array(4).fill(1),this.vertexTint=new Uint32Array(4).fill(16777215),this.setTexture(c,d)}setTexture(a,b){return Pj(a,b,this),this}setFrame(a){return ge(this.texture,a,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}preRender(){this.isDirty(_.COLORS)&&(Sj(this),this.clearDirty(_.COLORS)),this.isDirty(_.TRANSFORM)&&(Tj(this),this.clearDirty(_.TRANSFORM))}renderGL(a){this.preRender(),Qj(this,a)}renderCanvas(a){this.preRender(),Rj(this,a)}get alpha(){return this._alpha}set alpha(a){if(a!==this._alpha){this._alpha=a;const b=this.vertexAlpha;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(_.ALPHA)}}get tint(){return this._tint}set tint(a){if(a!==this._tint){this._tint=a;const b=this.vertexTint;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(_.COLORS)}}destroy(a){super.destroy(a),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertexData=null,this.vertexColor=null,this.vertexAlpha=null,this.vertexTint=null}}class np extends fb{constructor(a,b,c,d){super(a,b,c,d);this.type="AnimatedSprite",this.anims=new Map(),this.animData={currentAnim:"",currentFrames:[],frameIndex:0,animSpeed:0,nextFrameTime:0,repeatCount:0,isPlaying:!1,yoyo:!1,pendingStart:!1,playingForward:!0,delay:0,repeatDelay:0,onStart:null,onRepeat:null,onComplete:null}}stop(){const a=this.animData;a.isPlaying=!1,a.currentAnim="",a.onComplete&&a.onComplete(this,a.currentAnim)}nextFrame(){const a=this.animData;a.frameIndex++;if(a.frameIndex===a.currentFrames.length)if(a.yoyo)a.frameIndex--,a.playingForward=!1;else if(a.repeatCount===-1||a.repeatCount>0)a.frameIndex=0,a.repeatCount!==-1&&a.repeatCount--,a.onRepeat&&a.onRepeat(this,a.currentAnim),a.nextFrameTime+=a.repeatDelay;else return a.frameIndex--,this.stop();this.setFrame(a.currentFrames[a.frameIndex]),a.nextFrameTime+=a.animSpeed}prevFrame(){const a=this.animData;a.frameIndex--;if(a.frameIndex===-1)if(a.repeatCount===-1||a.repeatCount>0)a.frameIndex=0,a.playingForward=!0,a.repeatCount!==-1&&a.repeatCount--,a.onRepeat&&a.onRepeat(this,a.currentAnim),a.nextFrameTime+=a.repeatDelay;else return a.frameIndex=0,this.stop();this.setFrame(a.currentFrames[a.frameIndex]),a.nextFrameTime+=a.animSpeed}update(a,b){super.update(a,b);const c=this.animData;if(!c.isPlaying)return;c.nextFrameTime-=a*1e3,c.nextFrameTime=Math.max(c.nextFrameTime,0),c.nextFrameTime===0&&(c.pendingStart?(c.onStart&&c.onStart(this,c.currentAnim),c.pendingStart=!1,c.nextFrameTime=c.animSpeed):c.playingForward?this.nextFrame():this.prevFrame())}get isPlaying(){return this.animData.isPlaying}get isPlayingForward(){return this.animData.isPlaying&&this.animData.playingForward}get currentAnimation(){return this.animData.currentAnim}destroy(a){super.destroy(a),this.anims.clear(),this.animData=null}}function sg(a,b,c,d,e,f,g=0,i=1,h=1,k=0,n=0){const o=Math.cos(g+n)*i,s=Math.sin(g+n)*i,u=-Math.sin(g-k)*h,v=Math.cos(g-k)*h,y=a*o+c*u+e,G=a*s+c*v+f,K=a*o+d*u+e,J=a*s+d*v+f,N=b*o+d*u+e,I=b*s+d*v+f,O=b*o+c*u+e,P=b*s+c*v+f;return{x0:y,y0:G,x1:K,y1:J,x2:N,y2:I,x3:O,y3:P}}function ee(a,b,c,d,e,f,g,i,h,k=0,n=4294967295){const o=a.shaders.current,s=o.buffer,u=s.vertexViewF32,v=s.vertexViewU32,y=o.count*s.quadElementSize;u[y+0]=b,u[y+1]=c,u[y+2]=f,u[y+3]=h,u[y+4]=k,v[y+5]=n,u[y+6]=b,u[y+7]=c+e,u[y+8]=f,u[y+9]=g,u[y+10]=k,v[y+11]=n,u[y+12]=b+d,u[y+13]=c+e,u[y+14]=i,u[y+15]=g,u[y+16]=k,v[y+17]=n,u[y+18]=b+d,u[y+19]=c,u[y+20]=i,u[y+21]=h,u[y+22]=k,v[y+23]=n,o.count++}function ad(a,b,c,d,e,f,g,i,h,k=0,n=4294967295){a.shaders.setDefault(k),ee(a,b,c,d,e,f,g,i,h,k,n),a.shaders.popAndRebind()}class bd extends ub{constructor(){super();this.type="Layer",this.transform.passthru=!0,this.willRender=!1}}class ug extends bd{constructor(){super();this.type="RenderLayer",this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!0,this.setDirty(_.CHILD_CACHE);const a=Bb(),b=Cb(),c=Db(),d=new Na(null,a*c,b*c);d.binding=new zc(d),d.binding.framebuffer=fe(d.binding.texture),this.texture=d,this.framebuffer=d.binding.framebuffer}renderGL(a){this.numChildren>0&&(a.flush(),this.isDirty(_.CHILD_CACHE)?(a.fbo.add(this.framebuffer,!0),this.clearDirty(_.CHILD_CACHE)):(a.fbo.add(this.framebuffer,!1),this.postRenderGL(a)))}postRenderGL(a){const b=this.texture;a.flush(),a.fbo.pop();const{u0:c,v0:d,u1:e,v1:f}=b.firstFrame;a.textures.bind(b),ad(a,0,0,b.width,b.height,c,d,e,f),a.textures.unbind(),this.clearDirty(_.TRANSFORM)}}class op extends ug{constructor(){super();this.shaders=[],this.type="EffectLayer"}postRenderGL(a){const b=this.shaders,c=this.texture;a.flush(),a.fbo.pop();if(b.length===0){const{u0:d,v0:e,u1:f,v1:g}=c.firstFrame;a.textures.bind(c),ad(a,0,0,c.width,c.height,d,e,f,g),a.textures.unbind()}else{let d=c;for(let h=0;h<b.length;h++){const k=b[h],{u0:n,v0:o,u1:s,v1:u}=d.firstFrame;a.shaders.set(k,0)&&(k.renderToFBO=!0,a.textures.bind(d),ee(a,0,0,d.width,d.height,n,o,s,u),a.shaders.pop(),a.textures.unbind(),d=k.texture)}const{u0:e,v0:f,u1:g,v1:i}=d.firstFrame;a.textures.bind(d),ad(a,0,0,d.width,d.height,e,f,g,i),a.textures.unbind()}this.clearDirty(_.TRANSFORM)}}function Uj(a,b){const c=a.texture,d=b.shaders.current,e=d.buffer;b.flush(),b.textures.request(c),a.updateTextureIndex();const f=b.gl;d.bindBuffers(a.indexBuffer,a.vertexBuffer),f.bufferData(f.ARRAY_BUFFER,a.data,f.STATIC_DRAW),f.drawElements(f.TRIANGLES,a.count*e.quadIndexSize,f.UNSIGNED_SHORT,0),d.prevCount=a.count,b.flushTotal++,d.bindBuffers(e.indexBuffer,e.vertexBuffer)}function Vj(a,b,c){return Math.max(b,Math.min(c,a))}class qp extends bd{constructor(a,b){super();this.glTextureIndex=0,this.hasTexture=!1,this.type="SpriteBatch",this.willRender=!0,this.setTexture(b),this.setMaxSize(a)}resetBuffers(){let a=[];for(let c=0;c<this.maxSize*4;c+=4)a.push(c+0,c+1,c+2,c+2,c+3,c+0);this.data=new ArrayBuffer(this.maxSize*96),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const b=za.get();b&&(Zb(this.vertexBuffer),Zb(this.indexBuffer),this.vertexBuffer=b.createBuffer(),this.indexBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.data,b.STATIC_DRAW),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.index,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,null)),a=[],this.count=0}setMaxSize(a){return this.maxSize=Vj(a,0,65535),this.resetBuffers(),this}setTexture(a){let b;return a instanceof Na?b=a:b=Ha.get().get(a),b?(this.texture=b,this.hasTexture=!0,this.glTextureIndex=-1):console.warn(`Invalid Texture key: ${a}`),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.count>0}clear(){return this.count=0,this}addToBatch(a,b,c,d,e,f,g,i,h,k){if(this.count>=this.maxSize)return console.warn("SpriteBatch full"),this;const{u0:n,u1:o,v0:s,v1:u}=a,v=this.vertexViewF32,y=this.vertexViewU32,G=this.count*24,K=this.texture.binding?this.texture.binding.index:0;return v[G+0]=c,v[G+1]=d,v[G+2]=n,v[G+3]=s,v[G+4]=K,y[G+5]=b,v[G+6]=e,v[G+7]=f,v[G+8]=n,v[G+9]=u,v[G+10]=K,y[G+11]=b,v[G+12]=g,v[G+13]=i,v[G+14]=o,v[G+15]=u,v[G+16]=K,y[G+17]=b,v[G+18]=h,v[G+19]=k,v[G+20]=o,v[G+21]=s,v[G+22]=K,y[G+23]=b,this.setDirty(_.TRANSFORM),this.count++,this}add(a){const{frame:b=null,x:c=0,y:d=0,rotation:e=0,scaleX:f=1,scaleY:g=1,skewX:i=0,skewY:h=0,originX:k=0,originY:n=0,alpha:o=1,tint:s=16777215}=a,u=this.texture.getFrame(b),{left:v,right:y,top:G,bottom:K}=u.getExtent(k,n),{x0:J,y0:N,x1:I,y1:O,x2:P,y2:L,x3:r,y3:t}=sg(v,y,G,K,c,d,e,f,g,i,h),j=_b(s,o);return this.addToBatch(u,j,J,N,I,O,P,L,r,t)}addXY(a,b,c){const d=this.texture.getFrame(c),{left:e,right:f,top:g,bottom:i}=d.getExtent(0,0),{x0:h,y0:k,x1:n,y1:o,x2:s,y2:u,x3:v,y3:y}=sg(e,f,g,i,a,b);return this.addToBatch(d,4294967295,h,k,n,o,s,u,v,y)}updateTextureIndex(){const a=this.texture.binding.index;if(a===this.glTextureIndex)return;const b=this.vertexViewF32;this.glTextureIndex=a;for(let c=0;c<this.count;c++)b[c*24+4]=a,b[c*24+10]=a,b[c*24+16]=a,b[c*24+22]=a}renderGL(a){Uj(this,a)}destroy(){super.destroy(),Zb(this.vertexBuffer),Zb(this.indexBuffer),this.data=null,this.vertexViewF32=null,this.vertexViewU32=null,this.index=null,this.texture=null,this.hasTexture=!1}}function Eb(a=32,b=32){const c=fd(a,b);return new Na(c.canvas)}class ag extends fb{constructor(a,b,c="",d,e){super(a,b,Eb());this.splitRegExp=/(?:\r\n|\r|\n)/,this.padding={left:0,right:0,top:0,bottom:0},this.verticalAlign="ascent",this.lineSpacing=0,this.font="16px monospace",this.fillStyle="#fff",this.strokeStyle="",this.backgroundStyle="",this.cornerRadius=0,this.textAlign="left",this.textBaseline="alphabetic",this.lineWidth=0,this.lineDash=[],this.antialias=!1,this.type="Text";const f=ua.get();this.resolution=f.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),d&&(this.font=d),e&&(this.fillStyle=e),this.setText(c)}syncContext(a,b){this.preRenderCallback&&this.preRenderCallback(a,b),b.font=this.font,b.textBaseline=this.textBaseline,b.textAlign=this.textAlign,b.fillStyle=this.fillStyle,b.strokeStyle=this.strokeStyle,b.lineWidth=this.lineWidth,b.lineCap="round",b.lineJoin="round",b.setLineDash(this.lineDash),b.imageSmoothingEnabled=this.antialias}updateText(){const a=this.canvas,b=this.context,c=this.resolution,d=this._text.split(this.splitRegExp),e=this.padding,f=this.fillStyle,g=this.strokeStyle,i=this.lineWidth,h=this.lineSpacing,k=i>0?i/2:0;b.clearRect(0,0,a.width,a.height),this.syncContext(a,b),b.textAlign="start";let n=0,o=0,s=0;const u=[],v=this.verticalAlign==="ascent",y=b.measureText("|MÃq"),G=Math.ceil(Math.abs(y.actualBoundingBoxAscent)+Math.abs(y.actualBoundingBoxDescent))+i;for(let j=0;j<d.length;j++){const m=b.measureText(d[j]),l=m.actualBoundingBoxLeft,q=m.actualBoundingBoxRight;let w=m.actualBoundingBoxAscent,p=m.actualBoundingBoxDescent;(!w&&!p||d[j]==="")&&(w=G,p=0);const E=Math.ceil(Math.abs(l)+Math.abs(q))+i,H=Math.ceil(Math.abs(w)+Math.abs(p))+i;v?(s+=w+k,j>0&&(s+=h+k),o=s+p+k):(s=o+(H-p-k),o+=H,j<d.length-1&&(o+=h)),n=Math.max(n,E),u.push({lineWidth:E,lineHeight:H,ascent:w,descent:p,left:l,right:q,y:s})}n+=e.left+e.right,o+=e.top+e.bottom;const K=this.fixedWidth?this.fixedWidth:n,J=this.fixedHeight?this.fixedHeight:o,N=Math.ceil(K*c),I=Math.ceil(J*c);(a.width!==N||a.height!==I)&&(a.width=N,a.height=I,this.texture.setSize(K,J),this.setSize(K,J)),b.save(),b.scale(c,c),this.syncContext(a,b);const O=this.backgroundStyle;if(O){b.save(),b.fillStyle=O,b.strokeStyle=O;const j=this.cornerRadius,m=j>0?j/2:0;j&&(b.lineWidth=j,b.strokeRect(m,m,K-j,J-j)),b.fillRect(m,m,K-j,J-j),b.restore()}const P=this.textAlign,L=P==="center",r=P==="right"||P==="end",t=(J-o)/2+e.top;for(let j=0;j<d.length;j++){const m=d[j],l=u[j];let q=e.left+l.left+k;const w=t+l.y;L?q=K/2:r&&(q=K-k),g&&b.strokeText(m,q,w),f&&b.fillText(m,q,w)}return b.restore(),this.texture.binding&&this.texture.binding.update(),this.setDirty(_.TEXTURE),this}get text(){return this._text}set text(a){this.setText(a)}setText(a=""){return Array.isArray(a)&&(a=a.join(`
`)),a!==this._text&&(this._text=a.toString(),this.updateText()),this}destroy(a){this.texture.destroy(),this.fillStyle=null,this.strokeStyle=null,this.backgroundStyle=null,this.canvas=null,this.context=null,super.destroy(a)}}function Ab(a,b,c,d=1){let e;if(typeof a==="string"){let i=Ha.get();i.has(a)||i.add(a,Eb()),e=i.get(a)}else e=a;let f=e.image,g=f.getContext("2d");return c?b.call(c,f,g):b(f,g),e.setSize(f.width/d,f.height/d),e.binding&&e.binding.update(),e}function Qa(a,b,c){switch(typeof a){case"number":return`#${a.toString(16)}`;case"function":return a(b,c);default:return a}}function wf(a,b,c,d,e,f,g,i,h,k,n=!0){b.beginPath(),b.rect(c,d,e,f);if(g){if(k){let o;n?o=b.createLinearGradient(0,0,e,0):o=b.createLinearGradient(0,0,0,f),o.addColorStop(0,g),o.addColorStop(1,k),g=o}b.fillStyle=g,b.fill()}i&&(b.strokeStyle=i,b.lineWidth=h,b.stroke())}function bg(a,{width:b=32,height:c=b,fillStyle:d,fillColor2:e,isHorizontalGradient:f=!0,strokeStyle:g,lineWidth:i=2}={}){return Ab(a,function(h,k){h.width=Math.ceil(b),h.height=Math.ceil(c),g||(i=0);const n=i/2,o=n,s=n;b-=i,c-=i,wf(h,k,o,s,b,c,Qa(d,h,k),Qa(g,h,k),i,Qa(e,h,k),f)})}class Po{constructor(a=0,b=a,c=0,d=c,e=0){this._width=0;this._height=0;this.cornerRadius={tl:eb(0),tr:eb(0),bl:eb(0),br:eb(0)};this.setTo(a,b,c,d,e)}setTo(a=0,b=a,c=0,d=c,e=0){return this.setPosition(a,b),this.setRadius(e),this.setSize(c,d),this}setPosition(a=0,b=a){return this.x=a,this.y=b,this}setRadius(a=0){let b=this.cornerRadius;if(typeof a==="number"){const c=a,d=a;b.tl=eb(void 0,c,d),b.tr=eb(void 0,c,d),b.bl=eb(void 0,c,d),b.br=eb(void 0,c,d)}else{const c=a.x??0,d=a.y??0;b.tl=eb(a.tl,c,d),b.tr=eb(a.tr,c,d),b.bl=eb(a.bl,c,d),b.br=eb(a.br,c,d)}return this}setSize(a=0,b=a){return this.width=a,this.height=b,this}get minWidth(){let a=this.cornerRadius;return Math.max(a.tl.x+a.tr.x,a.bl.x+a.br.x)}get minHeight(){let a=this.cornerRadius;return Math.max(a.tl.y+a.bl.y,a.tr.y+a.br.y)}get width(){return this._width}set width(a){a==null&&(a=0),this._width=Math.max(a,this.minWidth)}get height(){return this._height}set height(a){a==null&&(a=0),this._height=Math.max(a,this.minHeight)}get radius(){let a=this.cornerRadius,b=Math.max(a.tl.x,a.tl.y,a.tr.x,a.tr.y,a.bl.x,a.bl.y,a.br.x,a.br.y);return b}}function eb(a,b,c){return a===void 0?{x:b,y:c}:typeof a==="number"?{x:a,y:a}:a}const Rr=Math.PI/180;function Ib(a){return a*Rr}const Qo=Ib(0),Ro=Ib(90),So=Ib(180),To=Ib(270);function vf(a,b,c,d,e,f){const g=new Po(b,c,d,e,f),i=g.minWidth,h=g.minHeight,k=d>=i?1:d/i,n=e>=h?1:e/h,o=g.cornerRadius;let s,u,v,y,G;a.beginPath(),a.translate(b,c),s=o.br,u=s.x*k,v=s.y*n,y=g.width-u,G=g.height-v,Rf(s)&&u>=0&&v>=0?a.ellipse(y,G,u,v,0,Qo,Ro):(a.moveTo(g.width,G),a.lineTo(g.width,g.height),a.lineTo(y,g.height)),s=o.bl,u=s.x*k,v=s.y*n,y=u,G=g.height-v,a.lineTo(u,g.height),Rf(s)&&u>=0&&v>=0?a.ellipse(y,G,u,v,0,Ro,So):(a.lineTo(0,g.height),a.lineTo(0,G)),s=o.tl,u=s.x*k,v=s.y*n,y=u,G=v,a.lineTo(0,G),Rf(s)&&u>=0&&v>=0?a.ellipse(y,G,u,v,0,So,To):(a.lineTo(0,0),a.lineTo(y,0)),s=o.tr,u=s.x*k,v=s.y*n,y=g.width-u,G=v,a.lineTo(y,0),Rf(s)&&u>=0&&v>=0?a.ellipse(y,G,u,v,0,To,Qo):(a.lineTo(g.width,0),a.lineTo(g.width,G)),a.closePath()}function Rf(a){return a.x!==0&&a.y!==0}function Fd(a,b,c,d,e,f,g,i,h,k,n,o=!0){vf(b,c,d,e,f,g);if(i){if(n){let s;o?s=b.createLinearGradient(0,0,e,0):s=b.createLinearGradient(0,0,0,f),s.addColorStop(0,i),s.addColorStop(1,n),i=s}b.fillStyle=i,b.fill()}h&&(b.strokeStyle=h,b.lineWidth=k,b.stroke())}var Jo;(function(a){a[a.right=0]="right",a[a.down=1]="down",a[a.left=2]="left",a[a.up=3]="up"})(Jo||(Jo={}));var bj;(function(a){a[a.IDLE=0]="IDLE",a[a.UPDATING=1]="UPDATING"})(bj||(bj={}));function rf(a,b,c){const d=Math.ceil(b*a.resolution),e=Math.ceil(c*a.resolution),f=a.canvas;if(f.width===d||f.height===e){sf(a);return}f.width=d,f.height=e,a.texture.setSize(b,c),a.setSize(b,c),a.updateTexture()}function sf(a){a.context.clearRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function pi(a,b="#fff"){let c=a.context;c.fillStyle=b,c.fillRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function tf(a,b,c){const d=new Image();d.onload=function(){const e=a.resolution,f=d.width/e,g=d.height/e;rf(a,f,g),a.context.drawImage(d,0,0),a.updateTexture(),c&&c(),d.onload=null,d.src="",d.remove()},d.src=b}function qi(a,b){return new Promise(function(c,d){tf(a,b,c)})}function ri(a,b,c){return a.canvas.toDataURL(b,c)}function si(a,b,c,d=[0,0,0,0]){const e=a.context.getImageData(b,c,1,1).data;return d[0]=e[0],d[1]=e[1],d[2]=e[2],d[3]=e[3],d}function ti(a,b,c,d,e,f,g){g===void 0&&(g=d!==0||e!==0||f!==0?255:0);const i=a.context.createImageData(1,1);i.data[0]=d,i.data[1]=e,i.data[2]=f,i.data[3]=g,a.context.putImageData(i,b,c),a.updateTexture()}class nb extends fb{constructor(a=0,b=0,c=32,d=32){super(a,b,Eb());this.type="rexCanvas";const e=ua.get();this.resolution=e.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.resize(c,d)}updateTexture(){return this.texture.binding&&this.texture.binding.update(),this.setDirty(_.TEXTURE),this}destroy(a){this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}resize(a,b){return rf(this,a,b),this}clear(){return sf(this),this}}function ln(a,b){b.width!==a.width&&(b.width=a.width),b.height!==a.height&&(b.height=a.height);let c=b.getContext("2d");return c.drawImage(a.texture.image,a.x,a.y,a.width,a.height),b}function ui(a,b,c=0,d=0,e=a.width,f=a.height){const g=a.resolution,i=a.canvas,h=Math.ceil(e*g),k=Math.ceil(f*g);Ab(b,function(n,o){n.width!==h&&(n.width=h),n.height!==k&&(n.height=k),o.clearRect(0,0,h,k),o.drawImage(i,c,d,h,k)},void 0,a.resolution)}function vi(a,b,c){const d=Ha.get();if(!d.has(b))return;ln(d.get(b).getFrame(c),a.canvas);const e=a.canvas.width,f=a.canvas.height,g=a.resolution,i=e/g,h=f/g;a.texture.setSize(i,h),a.setSize(i,h),a.updateTexture()}class wi extends nb{fill(a="#fff"){return pi(this,a),this}getCanvas(){return this.canvas}getContext(){return this.context}getDataURL(a,b){return ri(this,a,b)}getPixel(a,b,c=[0,0,0,0]){return si(this,a,b,c)}generateTexture(a,b=0,c=0,d=this.width,e=this.height){return ui(this,a,b,c,d,e),this}loadFromURL(a,b){return tf(this,a,b),this}loadFromURLPromise(a){return qi(this,a)}loadTexture(a,b){return vi(this,a,b),this}setPixel(a,b,c,d,e,f){return ti(this,a,b,c,d,e,f),this}}var Qb;(function(a){a[a.circle=0]="circle",a[a.ellipse=1]="ellipse",a[a.roundRectangle=2]="roundRectangle"})(Qb||(Qb={}));class Ad extends nb{constructor(a,b,c,d,e=Qb.circle){super(a,b);this.type="rexMaskedImage",this.maskImage(c,d,e)}maskImage(a,b,c=Qb.circle){let d,e,f;typeof c==="object"?{maskType:d,backgroundStyle:e,radius:f}=c:d=c,typeof d==="string"&&(d=Qb[d]);const g=this.canvas,i=this.context,h=Ha.get();if(!h.has(a))return;const k=h.get(a).getFrame(b),n=k.width,o=k.height;g.width!==n&&(g.width=n),g.height!==o&&(g.height=o),i.clearRect(0,0,n,o),e&&(i.fillStyle=e,i.fillRect(0,0,n,o)),i.beginPath();switch(d){case Qb.roundRectangle:vf(i,0,0,n,o,f);break;default:const s=Math.floor(n/2),u=Math.floor(o/2);d===Qb.circle?i.arc(s,u,Math.min(s,u),0,2*Math.PI):i.ellipse(s,u,s,u,0,0,2*Math.PI);break}i.clip(),i.drawImage(k.texture.image,k.x,k.y,k.width,k.height),this.texture.setSize(n,o),this.setSize(n,o),this.updateTexture()}}class Bd extends nb{constructor({x:a=0,y:b=0,width:c=1,height:d=1,fillStyle:e,fillColor2:f,isHorizontalGradient:g=!0,strokeStyle:i,lineWidth:h=2}={}){super(a,b);this.type="rexCanvasRoundRectangle",this.setFillStyle(e,f,g),this.setStrokeStyle(i,h),this.resize(c,d)}setFillStyle(a,b,c=!0){return this.fillStyle=a,this.fillColor2=b,this.isHorizontalGradient=c,this}setStrokeStyle(a,b){return this.strokeStyle=a,this.lineWidth=b,this}resize(a,b){return super.resize(a,b),this.refresh(),this}refresh(){let a=this.lineWidth;this.strokeStyle||(a=0);const b=a/2,c=b,d=b,e=this.width-a,f=this.height-a;return wf(this.canvas,this.context,c,d,e,f,Qa(this.fillStyle,this.canvas,this.context),Qa(this.strokeStyle,this.canvas,this.context),a,Qa(this.fillColor2,this.canvas,this.context),this.isHorizontalGradient),this}}class Cd extends nb{constructor({x:a=0,y:b=0,width:c=1,height:d=1,radius:e=0,fillStyle:f,fillColor2:g,isHorizontalGradient:i=!0,strokeStyle:h,lineWidth:k=2}={}){super(a,b);this.type="rexCanvasRoundRectangle",this.setRadius(e),this.setFillStyle(f,g,i),this.setStrokeStyle(h,k),this.resize(c,d)}setRadius(a){return this.radius=a,this}setFillStyle(a,b,c=!0){return this.fillStyle=a,this.fillColor2=b,this.isHorizontalGradient=c,this}setStrokeStyle(a,b){return this.strokeStyle=a,this.lineWidth=b,this}resize(a,b){return super.resize(a,b),this.refresh(),this}refresh(){let a=this.lineWidth;this.strokeStyle||(a=0);const b=a/2,c=b,d=b,e=this.width-a,f=this.height-a;return Fd(this.canvas,this.context,c,d,e,f,this.radius,Qa(this.fillStyle,this.canvas,this.context),Qa(this.strokeStyle,this.canvas,this.context),a,Qa(this.fillColor2,this.canvas,this.context),this.isHorizontalGradient),this}}function Sc(a,b,c=!0){if(Array.isArray(b)){_c(a,...b);for(let d=0,e=b.length;d<e;d++)b[d].destroy()}else{const d=b;Wb(a,d),c&&d.destroy()}}function uf(a,b=!0){const c=a.children;for(let d=0,e=c.length;d<e;d++){const f=c[d];f.parent=null,b&&f.destroy()}c.length=0}class xi extends Yb{remove(a,b=!0){return Sc(this,a,b),this}clear(a=!0){return uf(this,a),this}}function Rb(a=0,b={left:0,right:0,top:0,bottom:0}){if(typeof a==="number")b.left=a,b.right=a,b.top=a,b.bottom=a;else{let c,d,e,f;({left:c=0,right:d=0,top:e=0,bottom:f=0}=a),b.left=c,b.right=d,b.top=e,b.bottom=f}return b}function oc(a){return a.x-a.originX*a.width}function qc(a){return a.x+(.5-a.originX)*a.width}function pc(a){return a.x+(1-a.originX)*a.width}function rc(a){return a.y-a.originY*a.height}function tc(a){return a.y+(.5-a.originY)*a.height}function sc(a){return a.y+(1-a.originY)*a.height}function Gd(a,b){a.x+=b-oc(a)}function Id(a,b){a.x+=b-qc(a)}function Hd(a,b){a.x+=b-pc(a)}function Jd(a,b){a.y+=b-rc(a)}function Ld(a,b){a.y+=b-tc(a)}function Kd(a,b){a.y+=b-sc(a)}function mn(a,b=[]){const c=a.sizerChildren;for(var d=0,e=c.length;d<e;d++){const f=c[d];f instanceof na&&b.push(f)}return b}function nn(a,b,c,d){if(a.rexSizer.hidden||!a.needLayout)return a;a.preLayout(b,c,d),c===void 0&&(c=Math.max(a.childrenWidth,a.minWidth)),d===void 0&&(d=Math.max(a.childrenHeight,a.minHeight)),a.resize(c,d),a.layoutBackgrounds(),a.postLayout(b,c,d)}function yi(a,b,c,d){if(b)return;a.layoutInit();const e=a.getChildrenSizers();for(var f=0,g=e.length;f<g;f++){const i=e[f];if(i.rexSizer.hidden||!i.needLayout)continue;yi(i)}}function xf(a){a._childrenWidth=void 0,a._childrenHeight=void 0}function Tc(a,b,c){if(!a||b===void 0&&c===void 0)return;a.resize?(b===void 0&&(b=a.width),c===void 0&&(c=a.height),a.resize(b,c)):(b!==void 0&&(a.width=b),c!==void 0&&(a.height=c))}var Ba;(function(a){a[a.LEFT_TOP=0]="LEFT_TOP",a[a.TOP_LEFT=0]="TOP_LEFT",a[a.CENTER_TOP=1]="CENTER_TOP",a[a.TOP_CENTER=1]="TOP_CENTER",a[a.RIGHT_TOP=2]="RIGHT_TOP",a[a.TOP_RIGHT=2]="TOP_RIGHT",a[a.LEFT_CENTER=3]="LEFT_CENTER",a[a.CENTER_LEFT=3]="CENTER_LEFT",a[a.CENTER=4]="CENTER",a[a.CENTER_CENTER=4]="CENTER_CENTER",a[a.RIGHT_CENTER=5]="RIGHT_CENTER",a[a.CENTER_RIGHT=5]="CENTER_RIGHT",a[a.LEFT_BOTTOM=6]="LEFT_BOTTOM",a[a.BOTTOM_LEFT=6]="BOTTOM_LEFT",a[a.CENTER_BOTTOM=7]="CENTER_BOTTOM",a[a.BOTTOM_CENTER=7]="BOTTOM_CENTER",a[a.RIGHT_BOTTOM=8]="RIGHT_BOTTOM",a[a.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(Ba||(Ba={}));function Wn(a,b,c=Ba.CENTER,d=0,e=0){const f=c%3;switch(f){case 0:Gd(a,oc(b));break;case 1:Id(a,qc(b));break;default:Hd(a,pc(b));break}const g=Math.floor(c/3);switch(g){case 0:Jd(a,rc(b));break;case 1:Ld(a,tc(b));break;default:Kd(a,sc(b));break}a.x-=d,a.y-=e}class dr{constructor(){this.x=0;this.y=0;this.width=0;this.height=0;this.originX=0;this.originY=0}setTo(a=0,b=0,c=0,d=0){return this.x=a,this.y=b,this.width=c,this.height=d,this}alignIn(a,b=Ba.CENTER,c=0,d=0){return Wn(a,this,b,c,d),this}}const Uc=new dr();function on(a){if(a.backgroundChildren===void 0)return;const b=a.left,c=a.top,d=a.width,e=a.height,f=a.backgroundChildren;for(let g=0,i=f.length;g<i;g++){const h=f[g],k=h.rexSizer;if(k.hidden)continue;const n=k.padding,o=b+n.left,s=c+n.top,u=d-n.left-n.right,v=e-n.top-n.bottom;Tc(h,u,v),Uc.setTo(o,s,u,v).alignIn(h)}}function pn(a,b,c,d){}function qn(a,b){xc(a,b)}function rn(a){return a.hasOwnProperty("rexSizer")||(a.rexSizer={}),a.rexSizer}function sn(a,b,{padding:c=0,childKey:d}={}){a.backgroundChildren===void 0&&(a.backgroundChildren=[]),a.pin(b),a.backgroundChildren.push(b);const e=a.getSizerState(b);e.padding=Rb(c),d!==void 0&&a.addChildrenMap(d,b)}function tn(a,b){return a.backgroundChildren===void 0?!1:a.backgroundChildren.indexOf(b)!==-1}function un(a,b,c){a.childrenMap===void 0&&(a.childrenMap={}),a.childrenMap[b]=c}function yn(a,b,c=!1){if(c){const d=[a];for(;d.length;){a=d.shift();for(let e=0,f=a.children.length;e<f;e++){const g=a.children[e];if(g.name===b)return g;d.push(g)}}}else for(let d=0,e=a.children.length;d<e;d++){const f=a.children[d];if(f.name===b)return f}return null}function zi(a,b,c){typeof b==="string"&&(b=b.split("."));if(b.length===0)return null;let d=b.shift(),e=null;if(d.charAt(0)==="#")d=d.substring(1),e=yn(a,d,c);else if(d.indexOf("[")===-1)a.childrenMap&&(e=a.childrenMap[d]);else{const f=d.match(cr);if(f!=null){if(a.childrenMap){let g=a.childrenMap[f[1]];g&&(e=g[f[2]])}}}return b.length===0?e:e&&e.childrenMap?zi(e,b,c):null}const cr=/(\S+)\[(\d+)\]/i;function Md(a){let b=a.parent;for(;b;){if(b instanceof na)return b;b=b.parent}return null}function vn(a,b){return Md(b)===a}function wn(a,b){return a.backgroundChildren?a.backgroundChildren.indexOf(b)>=0:!1}function xn(a){let b,c=Md(a);for(;c;)b=c,c=Md(c);return b}class na extends xi{constructor({x:a=0,y:b=0,width:c=0,height:d=0,space:e=0,name:f=""}={}){super(a,b);this.type="rexBaseSizer";this.rexSizer={};this.needLayout=!0;this.setMinSize(c,d),this.space=Rb(e),this.name=f}destroy(a){this.sizerChildren=null,this.backgroundChildren=null,super.destroy(a)}get left(){return oc(this)}set left(a){Gd(this,a)}alignLeft(a){return this.left=a,this}get right(){return pc(this)}set right(a){Hd(this,a)}alignRight(a){return this.right=a,this}get innerLeft(){return this.left+this.space.left}get innerRight(){return this.right-this.space.right}get centerX(){return qc(this)}set centerX(a){Id(this,a)}alignCenterX(a){return this.centerX=a,this}get top(){return rc(this)}set top(a){Jd(this,a)}alignTop(a){return this.top=a,this}get bottom(){return sc(this)}set bottom(a){Kd(this,a)}alignBottom(a){return this.bottom=a,this}get innerTop(){return this.top+this.space.top}get innerBottom(){return this.bottom-this.space.bottom}get centerY(){return tc(this)}set centerY(a){Ld(this,a)}alignCenterY(a){return this.centerY=a,this}get innerWidth(){return this.width-this.space.left-this.space.right}get innerHeight(){return this.height-this.space.top-this.space.bottom}setMinSize(a,b){return this.setMinWidth(a).setMinHeight(b),this}setMinWidth(a=0){return this.minWidth=a,this}setMinHeight(a=0){return this.minHeight=a,this}getChildrenWidth(){return 0}getChildrenHeight(){return 0}getChildrenSizers(a=[]){return mn(this,a)}get childrenWidth(){return this._childrenWidth===void 0&&(this._childrenWidth=this.getChildrenWidth()),this._childrenWidth}get childrenHeight(){return this._childrenHeight===void 0&&(this._childrenHeight=this.getChildrenHeight()),this._childrenHeight}resize(a=this.width,b=this.height){return this.setSize(a,b),this}getSizerState(a){return rn(a)}layout(){const a=this.x,b=this.y;return this.setPosition(0,0)._layout().setPosition(a,b),this}_layout(a,b,c){return nn(this,a,b,c),this}preLayout(a,b,c){return yi(this,a,b,c),this}layoutInit(){return xf(this),this}layoutBackgrounds(){return on(this),this}postLayout(a,b,c){return pn(this,a,b,c),this}pin(a){return qn(this,a),this}addBackground(a,b){return sn(this,a,b),this}isBackground(a){return tn(this,a)}addChildrenMap(a,b){return un(this,a,b),this}getElement(a,b=!1){return zi(this,a,b)}isChild(a){return vn(this,a)}isBackgroundChild(a){return wn(this,a)}getTopmostParentSizer(a=this){return xn(a)}}function Wc(a,b,c=0,d=a.length-1){for(let e=c;e<=d;e++)a[e]=b;return a}function zn(a,{column:b=0,row:c=0,columnProportions:d=0,rowProportions:e=0,space:f}={}){a.columnCount=b,a.rowCount=c,a.sizerChildren.length=b*c,Wc(a.sizerChildren,null),a.columnProportions.length=b;if(typeof d==="number")Wc(a.columnProportions,d);else for(let h=0;h<b;h++)a.columnProportions[h]=d[h]??0;a.rowProportions.length=c;if(typeof e==="number")Wc(a.rowProportions,e);else for(let h=0;h<c;h++)a.rowProportions[h]=e[h]??0;a.columnWidth.length=b,a.rowHeight.length=c,a.space.column=[],a.space.column.length=b-1;const g=f.column??0;if(typeof g==="number")Wc(a.space.column,g);else for(let h=0,k=a.space.column.length;h<k;h++)a.space.column[h]=g[h]??0;a.space.row=[],a.space.row.length=c-1;const i=f.row??0;if(typeof i==="number")Wc(a.space.row,i);else for(let h=0,k=a.space.row.length;h<k;h++)a.space.row[h]=i[h]??0}function zf(...a){return Array.prototype.reduce.call(a,Qr,0)}function Qr(a,b){return a+b}function An(a){if(a.rexSizer.hidden)return 0;let b=0;const c=a.sizerChildren;for(let d=0;d<a.columnCount;d++){const e=a.columnProportions[d];let f=0;if(e===0){for(let g=0;g<a.rowCount;g++){const i=c[g*a.columnCount+d];if(!i)continue;if(i.rexSizer.hidden)continue;let h=i instanceof na?Math.max(i.minWidth,i.childrenWidth):i.width;const k=i.rexSizer.padding;h+=k.left+k.right,f=Math.max(f,h)}b+=f}a.columnWidth[d]=f}return b+zf(a.space.left,...a.space.column,a.space.right)}function Bn(a){if(a.rexSizer.hidden)return 0;let b=0;const c=a.sizerChildren;for(let e=0;e<a.rowCount;e++){const f=a.rowProportions[e];let g=0;if(f===0){for(var d=0;d<a.columnCount;d++){const i=c[e*a.columnCount+d];if(!i)continue;if(i.rexSizer.hidden)continue;let h=i instanceof na?Math.max(i.minHeight,i.childrenHeight):i.height;const k=i.rexSizer.padding;h+=k.top+k.bottom,g=Math.max(g,h)}b+=g}a.rowHeight[e]=g}return b+zf(a.space.top,...a.space.row,a.space.bottom)}function Jn(a,b){let c;const d=a.rexSizer;if(d.expand){const e=d.padding;c=b-e.left-e.right}return c}function In(a,b){let c;const d=a.rexSizer;if(d.expand){const e=d.padding;c=b-e.top-e.bottom}return c}function Vc(a,b,c){return a.sizerChildren[c*a.columnCount+b]}function Cn(a,b,c,d){if(a.rexSizer.hidden||!a.needLayout)return;a.preLayout(b);const e=a.totalColumnProportions,f=a.totalRowProportions;if(c===void 0)if(b&&e>0){const y=a.rexSizer.padding;c=b.width-y.left-y.right}else c=Math.max(a.childrenWidth,a.minWidth);if(d===void 0)if(b&&f>0){const y=a.rexSizer.padding;d=b.height-y.top-y.bottom}else d=Math.max(a.childrenHeight,a.minHeight);a.resize(c,d);let g;e>0?g=(a.width-a.childrenWidth)/e:g=0;let i;f>0?i=(a.height-a.childrenHeight)/f:i=0;const h=a.innerLeft,k=a.innerTop,n=a.space.column,o=a.space.row;let s=h,u=k;for(let y=0;y<a.rowCount;y++){const G=a.rowProportions[y],K=G===0?a.rowHeight[y]:G*i;s=h;for(var v=0;v<a.columnCount;v++){const J=a.columnProportions[v],N=J===0?a.columnWidth[v]:J*g,I=Vc(a,v,y);if(!I||I.rexSizer.hidden){s+=N+n[v];continue}const O=Jn(I,N),P=In(I,K);I instanceof na?I._layout(a,O,P):Tc(I,O,P);const L=I.rexSizer,r=L.padding,t=s+r.left,j=N-r.left-r.right,m=u+r.top,l=K-r.top-r.bottom;Uc.setTo(t,m,j,l).alignIn(I,L.align),s+=N+n[v]}u+=K+o[y]}return a.layoutBackgrounds(),a.postLayout()}function Hn(a,b,c,d,e){if(typeof a==="number"&&typeof b==="number"){let f=b*d+a;if(!c[f])return f}else if(b===void 0&&typeof a==="number")for(let f=0;f<e;f++){let g=f*d+a;if(!c[g])return g}else if(a===void 0&&typeof b==="number")for(let f=0;f<d;f++){let g=b*d+f;if(!c[g])return g}else if(b===!0)for(let f=0;f<d;f++)for(let g=0;g<e;g++){let i=g*d+f;if(!c[i])return i}else for(let f=0,g=c.length;f<g;f++)if(!c[f])return f;return null}function Dn(a,b,{column:c,row:d,align:e=Ba.CENTER,padding:f=0,expand:g=!0,childKey:i}={}){const h=Hn(c,d,a.sizerChildren,a.columnCount,a.rowCount);if(h===null)return;a.pin(b),typeof e==="string"&&(e=Ba[e]);const k=a.getSizerState(b);k.align=e,k.padding=Rb(f),k.expand=g,a.sizerChildren[h]=b,i!==void 0&&a.addChildrenMap(i,b)}function En(a,b,c){if(!b)return null;const d=a.sizerChildren.indexOf(b);return d===-1?null:(c===void 0&&(c={x:0,y:0}),c.x=d%a.columnCount,c.y=Math.floor(d/a.columnCount),c)}function Fn(a,b,c){for(let d=0,e=a.rowCount;d<e;d++)for(let f=0,g=a.columnCount;f<g;f++){if(Vc(a,f,d))continue;let i;c?i=b.call(c,f,d,a):i=b(f,d,a);if(i)return}}function Gn(a){const b=a.sizerChildren;let c=0;for(let d=0,e=b.length;d<e;d++)b[d]||c++;return c}class yf extends na{constructor(a={}){super(a);this.type="rexGridSizer";this.sizerChildren=[];this.columnProportions=[];this.rowProportions=[];this.columnWidth=[];this.rowHeight=[];zn(this,a)}setColumnProportion(a,b){return a<this.columnProportions.length&&(this.columnProportions[a]=b),this}setRowProportion(a,b){return a<this.rowProportions.length&&(this.rowProportions[a]=b),this}get totalColumnProportions(){return this.columnProportions.reduce((a,b)=>a+b)}get totalRowProportions(){return this.rowProportions.reduce((a,b)=>a+b)}getChildrenWidth(){return An(this)}getChildrenHeight(){return Bn(this)}_layout(a,b,c){return Cn(this,a,b,c),this}add(a,b){return Dn(this,a,b),this}getChildAt(a,b){return Vc(this,a,b)}childToGridIndex(a,b){return En(this,a,b)}forEachEmptyGrid(a,b){return Fn(this,a,b),this}get gridCount(){return this.sizerChildren.length}get emptyGridCount(){return Gn(this)}}var Fa;(function(a){a[a.x=0]="x",a[a.h=0]="h",a[a.horizontal=0]="horizontal",a[a["left-to-right"]=0]="left-to-right",a[a.y=1]="y",a[a.v=1]="v",a[a.vertical=1]="vertical",a[a["top-to-bottom"]=1]="top-to-bottom"})(Fa||(Fa={}));function Kn(a){const b=a.sizerChildren;let c=0;for(let d=0,e=b.length;d<e;d++){const f=b[d];if(f.rexSizer.hidden)continue;const g=f.rexSizer,i=g.proportion;i>0&&(c+=i)}return c}function Ln(a,b=!0){if(a.rexSizer.hidden)return 0;b===void 0&&(b=!0);const c=a.sizerChildren;let d=0;if(a.orientation===0)for(var e=0,f=c.length;e<f;e++){const g=c[e],i=g.rexSizer;if(i.hidden)continue;let h;i.proportion===0||b&&!g.isRexSpace&&i.proportion>0?h=g instanceof na?Math.max(g.minWidth,g.childrenWidth):g.width:h=0;const k=i.padding;h+=k.left+k.right,e>0&&(h+=a.space.item),d+=h}else for(var e=0,f=c.length;e<f;e++){const g=c[e];if(!g.hasOwnProperty("rexSizer"))continue;const i=g.rexSizer;if(i.hidden)continue;let h=g instanceof na?Math.max(g.minWidth,g.childrenWidth):g.width;const k=i.padding;h+=k.left+k.right,d=Math.max(h,d)}return d+a.space.left+a.space.right}function Mn(a,b=!0){if(a.rexSizer.hidden)return 0;const c=a.sizerChildren;let d=0;if(a.orientation===0)for(var e=0,f=c.length;e<f;e++){const g=c[e],i=g.rexSizer;if(i.hidden)continue;let h=g instanceof na?Math.max(g.minHeight,g.childrenHeight):g.height;const k=i.padding;h+=k.top+k.bottom,d=Math.max(h,d)}else for(var e=0,f=c.length;e<f;e++){const g=c[e];if(!g.hasOwnProperty("rexSizer"))continue;const i=g.rexSizer;if(i.hidden)continue;let h;i.proportion===0||b&&!g.isRexSpace&&i.proportion>0?h=g instanceof na?Math.max(g.minHeight,g.childrenHeight):g.height:h=0;const k=i.padding;h+=k.top+k.bottom,e>0&&(h+=a.space.item),d+=h}return d+a.space.top+a.space.bottom}function Vn(a,b){let c;const d=b.rexSizer,e=d.padding;return a.orientation===Fa.x?d.proportion>0&&a.proportionLength>0&&(c=d.proportion*a.proportionLength):d.expand&&(c=a.innerWidth-e.left-e.right),c}function Un(a,b){let c;const d=b.rexSizer,e=d.padding;return a.orientation===Fa.x?d.expand&&(c=a.innerHeight-e.top-e.bottom):d.proportion>0&&a.proportionLength>0&&(c=d.proportion*a.proportionLength),c}function Nn(a,b,c,d){if(a.rexSizer.hidden||!a.needLayout)return;a.preLayout(b),c===void 0&&(c=Math.max(a.childrenWidth,a.minWidth)),d===void 0&&(d=Math.max(a.childrenHeight,a.minHeight)),a.resize(c,d);let e;if(a.childrenProportion>0){let s=a.orientation===Fa.x?a.width-a.childrenWidth:a.height-a.childrenHeight;s>0?(s=a.orientation===Fa.x?a.width-a.getChildrenWidth(!1):a.height-a.getChildrenHeight(!1),e=s/a.childrenProportion):e=0}else e=0;a.proportionLength=e;const f=a.sizerChildren,g=a.innerLeft,i=a.innerTop,h=a.innerWidth,k=a.innerHeight;let n=g,o=i;for(let s=0,u=f.length;s<u;s++){const v=f[s];if(v.rexSizer.hidden)continue;const y=v.rexSizer,G=y.padding;let K=Vn(a,v),J=Un(a,v);v instanceof na?v._layout(a,K,J):Tc(v,K,J),K===void 0&&(K=v.width),J===void 0&&(J=v.height);let N,I,O,P;a.orientation===Fa.x?(N=n+G.left,y.proportion===0||e===0?O=K:O=y.proportion*e,I=o+G.top,P=k-G.top-G.bottom):(N=n+G.left,O=h-G.left-G.right,I=o+G.top,y.proportion===0||e===0?P=J:P=y.proportion*e),Uc.setTo(N,I,O,P).alignIn(v,y.align),a.orientation===Fa.x?n+=O+G.left+G.right+a.space.item:o+=P+G.top+G.bottom+a.space.item}a.layoutBackgrounds(),a.postLayout()}function On(a){xf(a),a._childrenProportion=void 0}function Bf(a,b,{proportion:c=0,align:d=Ba.CENTER,padding:e=0,expand:f=!1,childKey:g,index:i}={}){a.pin(b),typeof d==="string"&&(d=Ba[d]);const h=a.getSizerState(b);h.proportion=c,h.align=d,h.padding=Rb(e),h.expand=f,i===void 0||i>=a.sizerChildren.length?a.sizerChildren.push(b):a.sizerChildren.splice(i,0,b),g!==void 0&&a.addChildrenMap(g,b)}class Tn extends Yb{}function Pn(a,b=1){const c=new Tn();Bf(a,c,{proportion:b})}function vd(a,b){if(b>=a.length)return;let c=a.length-1,d=a[b];for(let e=b;e<c;e++)a[e]=a[e+1];return a.length=c,d}function Ai(a,b,c,d=a){if(!Array.isArray(b)){const f=a.indexOf(b);return f!==-1?(vd(a,f),c&&c.call(d,b),b):null}let e=b.length-1;for(;e>=0;){const f=b[e],g=a.indexOf(f);g!==-1?(vd(a,g),c&&c.call(d,f)):b.pop(),e--}return b}function Qn(a,b,c=!0){Sc(this,b,c);const d=Ai(a.sizerChildren,b);!d&&a.backgroundChildren&&Ai(a.backgroundChildren,b)}function Rn(a,b=!0){Sc(a,a.sizerChildren,b),a.sizerChildren.length=0}function Sn(a,b=!0){uf(a,b),a.sizerChildren.length=0,a.backgroundChildren&&(a.backgroundChildren.length=0)}class Xc extends na{constructor({space:a={item:0},orientation:b=Fa.x}={}){super(arguments[0]);this.type="rexSizer";this.sizerChildren=[];this.setOrientation(b),this.setItemSpacing(a.item)}setOrientation(a){return typeof a==="string"&&(a=Fa[a]),this.orientation=a,this}setItemSpacing(a=0){return this.space.item=a,this}get childrenProportion(){return this._childrenProportion===void 0&&(this._childrenProportion=Kn(this)),this._childrenProportion}getChildrenWidth(a=!0){return Ln(this,a)}getChildrenHeight(a=!0){return Mn(this,a)}_layout(a,b,c){return Nn(this,a,b,c),this}layoutInit(){return On(this),this}add(a,b){return Bf(this,a,b),this}addSpace(a=1){return Pn(this,a),this}remove(a,b=!0){return Qn(this,a,b),this}removeAll(a=!0){return Rn(this,a),this}clear(a=!0){return Sn(this,a),this}}class Af extends Xc{constructor({background:a,icon:b,text:c,expandTextWidth:d=!1,expandTextHeight:e=!1,action:f,align:g,space:i={}}={}){super(arguments[0]);this.type="rexLabel";a&&this.addBackground(a),(g==="right"||g==="bottom"||g==="center")&&this.addSpace();if(b){let h;const k=i.icon??0;this.orientation===Fa.x?(c||f)&&(h={right:k}):(c||f)&&(h={bottom:k}),this.add(b,{padding:h})}if(c){let h,k,n;const o=i.text??0;this.orientation===Fa.x?(h=d?1:0,f&&(k={right:o}),n=e):(h=e?1:0,f&&(k={bottom:o}),n=d),this.add(c,{proportion:h,align:Ba.CENTER,padding:k,expand:n})}f&&this.add(f),g==="center"&&this.addSpace(),this.addChildrenMap("background",a),this.addChildrenMap("icon",b),this.addChildrenMap("text",c),this.addChildrenMap("action",f)}get text(){const a=this.childrenMap.text;if(a===void 0)return"";let b;return a.text?(b=a.text,typeof b!=="string"&&(b=b.join(`
`))):b="",b}set text(a){const b=this.childrenMap.text;b!==void 0&&(b.text=a)}setText(a){return typeof a!=="string"&&(a=a.join(`
`)),this.text=a,this}appendText(a){return typeof a!=="string"&&(a=a.join(`
`)),this.text+=a,this}}var Ga;(function(a){a[a.none=0]="none",a[a.word=1]="word",a[a.char=2]="char"})(Ga||(Ga={}));var xa;(function(a){a[a.none=0]="none",a[a.raw=1]="raw",a[a.wrapped=2]="wrapped"})(xa||(xa={}));const Oi=/(?:\r\n|\r|\n)/;function mo(a,b,c,d,e,f=0){e<=0&&(d=0);let g=[];if(!a||!a.length)return g;let i=a.split(Oi),h=i.length-1;a.slice(-1)===`
`&&(i.length-=1);let k;for(let n=0,o=i.length;n<o;n++){let s=i[n],u=n===h?0:1;if(d===0){g.push(Sd(s,b(s,c),u));continue}n===0?k=e-f:k=e;if(s.length<=100){let J=b(s,c);if(J<=k){g.push(Sd(s,J,u));continue}}let v;d===1?v=s.split(" "):v=s;let y="",G="",K=0;for(let J=0,N=v.length;J<N;J++){let I=v[J];d===1?(y+=I,J<N-1&&(y+=" ")):y+=I;let O=b(y,c);O>k&&(J===0?g.push(Sd("",0,2)):(g.push(Sd(G,K,2)),y=I,d===1&&(J<N-1&&(y+=" ")),O=b(y,c)),k=e),G=y,K=O}g.push(Sd(G,K,u))}return g}let Sd=function(a,b,c){return{text:a,width:b,newLineMode:c}};var Nd;(function(a){a[a.left=0]="left",a[a.center=1]="center",a[a.right=2]="right"})(Nd||(Nd={}));var Od;(function(a){a[a.top=0]="top",a[a.center=1]="center",a[a.bottom=2]="bottom"})(Od||(Od={}));class uc{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(a){return this.items.push(a),this}pushMultiple(a){return this.items.push.apply(this.items,a),a.length=0,this}clear(){return this.items.length=0,this}}class Qi{constructor(){this.pens=[]}destroy(){this.pens.length=0}addPen(a){return this.pens.push(a),this}get firstPen(){return this.pens[0]}get lastPen(){return this.pens[this.pens.length-1]}hasPen(){return this.pens.length>0}get pensCount(){return this.pens.length}get startIndex(){let a=this.pens[0];return a?a.startIndex:0}get width(){let a=this.lastPen;return a?a.lastX:0}}function Tf(a){if(Array.isArray(a))a.length=0;else for(let b in a)delete a[b]}function vc(a,b=Array.isArray(a)?[]:{}){Tf(b);if(Array.isArray(a)){b.length=a.length;for(let c=0,d=a.length;c<d;c++)b[c]=a[c]}else for(let c in a)b[c]=a[c];return b}class Ri{constructor(){this.text="";this.x=0;this.y=0;this.width=0;this.height=0;this.ascent=0;this.descent=0;this.prop={};this.newLineMode=xa.none;this.startIndex=0}set(a="",b=0,c=0,d=0,e=0,f=0,g=0,i={},h=xa.none,k=0){return this.text=a,this.x=b,this.y=c,this.width=d,this.height=e,this.ascent=f,this.descent=g,this.prop=i,this.newLineMode=h,this.startIndex=k,this}clone(){let a=new Ri();return a.set(this.text,this.x,this.y,this.width,this.height,this.ascent,this.descent,vc(this.prop),this.newLineMode,this.startIndex),a}get plainText(){return this.newLineMode===xa.raw?`${this.text}
`:this.text}get wrapText(){return this.newLineMode!==xa.none?`${this.text}
`:this.text}get plainTextLength(){let a=this.text.length;return this.newLineMode===xa.raw&&(a+=1),a}get endIndex(){return this.startIndex+this.plainTextLength}get lastX(){return this.x+this.width}get isTextPen(){return this.text!==""}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}}class Pd{constructor({penPool:a}){this.pens=[];this.lines=[];this.pens=[],this.lines=[],this.penPool=a}destroy(){this.freePens()}freePens(){return this.penPool.pushMultiple(this.pens),this.lines.forEach(a=>{a.destroy()}),this.lines.length=0,this.maxLineWidth=0,this.totalLineHeight=0,this}addTextPen(a,b,c,d,e,f,g,i,h=xa.none){let k=this.penPool.pop();return k==null&&(k=new Ri()),k.set(a,b,c,d,e,f,g,i,h),this.addPen(k),this}addImagePen(a,b,c,d,e){return this.addTextPen("",a,b,c,d,d,0,e,xa.none),this}addNewLinePen(a){let b=this.lastPen;return b&&b.newLineMode===xa.none&&(b.newLineMode=a),this}addPen(a){let b=this.lastPen;b==null?a.startIndex=0:a.startIndex=b.endIndex,this.pens.push(a);let c=this.lastLine;return c==null&&(c=new Qi(),this.lines.push(c)),c.addPen(a),a.newLineMode!==xa.none&&(c=new Qi(),this.lines.push(c)),this}clone(a){a==null&&(a=new Pd({penPool:this.penPool})),a.freePens();const b=this.pens;for(let e=0,f=b.length;e<f;e++)a.addPen(b[e].clone());const c=this.lines,d=a.lines;for(let e=0,f=c.length;e<f;e++){const g=c[e],i=d[e];i.y=g.y,i.height=g.height}return a}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(a){if(a>=this.lines.length)return this.getLineEndIndex(a);{let b=this.lines[a];if(!b)return 0;let c=b.firstPen;return c?c.startIndex:0}}getLineEndIndex(a){let b=this.lines.length;a>=b&&(a=b-1);for(let c=a;c>=0;c--){let d=this.lines[c];if(d&&d.hasPen())return d.lastPen.endIndex}return 0}getLineWidth(a){let b=this.lines[a];return b?b.width:0}getLineHeights(a=[]){return this.lines.forEach(function(b){a.push(b.height)}),a}get lineCount(){return this.lines.length}get plainText(){let a=[],b=this.pens;for(let c=0,d=b.length;c<d;c++)a.push(b[c].plainText);return a.join()}get plainTextLength(){let a=0;for(let b=0,c=this.pens.length;b<c;b++)a+=this.pens[b].plainTextLength;return a}getSliceTagText(a,b,c=0,d,e=!1){if(d===void 0){let k=this.lastPen;if(!k)return"";d=k.endIndex}let f=[],g;for(var i=0,h=this.pens.length;i<h;i++){let k=this.pens[i],n=k.endIndex;if(n<=c)continue;let o=e?k.wrapText:k.plainText,s=k.prop,u=k.startIndex,v=u>=c&&n<=d;v||(o=o.substring(c-u,d-u)),b?f.push(a.call(b,o,s,g)):f.push(a(o,s,g)),g=s;if(n>=d)break}return f.join()}}function jo(a,b,c){let d=vc(a,c);for(let e in b)d.hasOwnProperty(e)&&(d[e]=b[e]);return d}function Hf(a,b,c={key:b}){c=jo(lr,c);let d=Ha.get(),e=d.get(c.key);if(!e)return;let f=e.getFrame(c.frame);if(!f)return;let g=c.width,i=c.height;(g===void 0||i===void 0)&&(g===void 0&&i===void 0?(c.width=f.width,c.height=f.height):g===void 0?c.width=f.width*(i/f.height):i===void 0&&(c.height=f.height*(g/f.width))),a.images.set(b,c)}const lr={key:void 0,frame:void 0,width:void 0,height:void 0,y:0,left:0,right:0,top:0,bottom:0};class fo{constructor(){this.images=new Map()}destroy(){this.images.clear()}add(a,b){if(typeof a==="string")Hf(this,a,b);else if(Array.isArray(a)){let c=a;for(let d=0,e=c.length;d<e;d++)Hf(this,c[d])}else{let c=a;for(a in c)Hf(this,a,c[a])}return this}remove(a){return this.images.delete(a),this}get(a){return this.images.get(a)}getOuterWidth(a){let b=this.images.get(a);return b?b.width+b.left+b.right:0}getOuterHeight(a){let b=this.images.get(a);return b?b.height+b.top+b.bottom:0}getFrame(a){let b=this.images.get(a);if(!b)return;let c=Ha.get(),d=c.get(b.key);if(!d)return;let e=d.getFrame(b.frame);return e}hasTexture(a){return!!this.getFrame(a)}}function Ff(a,b){a.font=b.font}function Gf(a,b){a.textBaseline="alphabetic",a.textAlign="start",a.fillStyle=b.fillStyle,a.strokeStyle=b.strokeStyle,a.lineWidth=b.strokeThickness,a.lineCap="round",a.lineJoin="round",a.imageSmoothingEnabled=b.antialias}function Pi(a,b,c){c?(a.shadowColor=b.shadowColor,a.shadowBlur=b.shadowBlur,a.shadowOffsetX=b.shadowOffsetX,a.shadowOffsetY=b.shadowOffsetY):(a.shadowColor="#000",a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0)}function ko(a,b){return b.measureText(a).width}function lo(a,b,c=0){let d=b.measureText(a),e=d.actualBoundingBoxAscent,f=d.actualBoundingBoxDescent;return(!e&&!f||a==="")&&(e=c,f=0),Lf.ascent=e,Lf.descent=f,Lf.height=Math.ceil(Math.abs(e)+Math.abs(f)),Lf}let Lf={ascent:0,descent:0,height:0};function go(a,b,c,d,e){a.freePens();if(b==="")return a;let f=c.canvas,g=c.context,i=c.parent,h=c.parser.splitText(b),k,n,o=0;for(var s=0,u=h.length;s<u;s++){let J=c.parser.tagTextToProp(h[s],k),N=J.text;k=J.prop;if(k.img){let I,O;c.imageManager?(I=c.imageManager.getOuterWidth(k.img),O=c.imageManager.getOuterHeight(k.img)):(I=0,O=0),e>0&&d!==Ga.none&&(e<o+I&&(a.addNewLinePen(xa.wrapped),o=0)),a.addImagePen(o,0,I,O,vc(k)),o+=I}else if(N!==""){g.save();let I=c.parser.propToStyle(i,k);Ff(g,I),Gf(g,I);let O=I.strokeThickness,P=O/2;n=mo(N,ko,g,d,e,o);let L=lo("|MÃq",g);for(let r=0,t=n.length;r<t;r++){const j=n[r],m=L.height+O,l=L.ascent+P,q=L.descent+P;a.addTextPen(j.text,o,0,j.width,m,l,q,vc(k),j.newLineMode),j.newLineMode!==xa.none?o=0:o+=j.width}g.restore()}}let v=a.lines,y=c.parent.lineSpacing,G=0,K=0;for(let J=0,N=v.length;J<N;J++){const I=v[J],O=I.pens,P=O.length;let L=0,r=0;for(let m=0;m<P;m++){const l=O[m];L=Math.max(L,l.ascent),r=Math.max(r,l.descent)}const t=L+r,j=K+L;for(let m=0;m<P;m++)O[m].y+=j;I.y=j,I.height=t,G=Math.max(G,I.width),K+=t+y}return a.maxLineWidth=G,a.totalLineHeight=K-y,a}const Xj={PI2:Math.PI*2,HALF_PI:Math.PI*.5,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};class kr extends Ma{constructor(a,b,c,d,e){super(a,b,c,d);this.name=e}}class io{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return this.hitAreas.length=0,this}add(a,b,c,d,e){let f=new kr(b,c,d,e,a);return this.hitAreas.push(f),this}getFirstHitArea(a,b){for(let c=0,d=this.hitAreas.length;c<d;c++){let e=this.hitAreas[c];if(e.contains(a,b))return e}return null}}function ho(a,b,c,d,e,f=0,g=0,i=a.penManager){a.hitAreaManager&&a.hitAreaManager.clear();let h=i.totalLineHeight;if(h===0)return;const k=d<a.textWidth||e<a.textHeight;let n=a.context;n.save();let o=a.parent;fr(a,o),gr(a,o),k&&(n.beginPath(),n.rect(b,c,d,e),n.clip());let s=o.align%3,u=Math.floor(o.align/3),v=c-g;switch(u){case Od.center:v+=(e-h)/2;break;case Od.bottom:v+=e-h-2;break}let y=i.lines,G=v;const K=b+e;for(let J=0,N=y.length;J<N;J++){let I=y[J];if(G>K)break;const O=G+I.height;if(O<c){G=O;continue}let P=I.width;if(P===0){G=O;continue}let L=b-f;switch(s){case Nd.center:L+=(d-P)/2;break;case Nd.right:L+=d-P;break}let r=I.pens;for(let t=0,j=r.length;t<j;t++)er(a,r[t],L,v);G=O}n.restore()}function er(a,b,c,d){c+=b.x,d+=b.y;let e=a.canvas,f=a.context,g=a.parent;f.save();let i=a.parser.propToStyle(g,b.prop);Ff(f,i),Gf(f,i),i.underlineThickness>0&&b.width>0&&hr(a,c,d,b.width,i),b.isTextPen&&ir(a,c,d,b.text,i),b.isImagePen&&jr(a,c,d,b.prop.img,i),f.restore(),b.hasAreaMarker&&b.width>0&&(a.hitAreaManager||(a.hitAreaManager=new io()),a.hitAreaManager.add(b.prop.area,c,d,b.width,b.height))}function fr(a,b){let c=a.canvas,d=a.context;d.clearRect(0,0,c.width,c.height)}function gr(a,b){let c=a.canvas,d=a.context;d.clearRect(0,0,c.width,c.height);const e=b.backgroundFillStyle,f=b.backgroundStrokeStyle;if(e||f){const g=b.backgroundStrokeThickness,i=g/2,h=b.cornerRadius,k=i,n=i,o=c.width-g,s=c.height-g;Fd(c,d,k,n,o,s,h,e,f,g,b.backgroundFillColor2,b.backgroundIsHorizontalGradient)}else d.clearRect(0,0,c.width,c.height)}function hr(a,b,c,d,e){c+=e.underlineOffsetY-e.underlineThickness/2;let f=a.context,g=f.lineCap;f.lineCap="butt",f.beginPath(),f.strokeStyle=e.underlineStyle,f.lineWidth=e.underlineThickness,f.moveTo(b,c),f.lineTo(b+d,c),f.stroke(),f.lineCap=g}function ir(a,b,c,d,e){let f=a.context;e.strokeStyle&&e.strokeStyle!=="none"&&e.strokeThickness>0&&(Pi(f,e,e.shadowStroke),f.strokeText(d,b,c)),e.fillStyle&&e.fillStyle!=="none"&&(Pi(f,e,e.shadowFill),f.fillText(d,b,c))}function jr(a,b,c,d,e){let f=a.imageManager;if(!f)return;let g=f.get(d),i=f.getFrame(d);b+=g.left,c+=g.y-g.height;let h=a.context;h.drawImage(i.texture.image,i.x,i.y,i.width,i.height,b,c,g.width,g.height)}class Xn{constructor({canvas:a,context:b,parent:c,parser:d,penPool:e=new uc()}){this.textScrollX=0;this.textScrollY=0;this.canvas=a,this.context=b,this.parser=d,this.parent=c,this.penPool=e,this.penManager=new Pd({penPool:e})}destroy(){this.parser.destroy(),this.canvas=null,this.context=null,this.parser=null,this.parent=null,this.penManager&&(this.penManager.destroy(),this.penManager=null),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=null),this.imageManager&&(this.imageManager.destroy(),this.imageManager=null),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=null)}get textWidth(){return this.penManager.maxLineWidth}get textHeight(){return this.penManager.totalLineHeight}updatePenManager(a,b,c,d=this.penManager){return go(d,a,this,b,c)}draw(a,b,c,d,e=0,f=0){return ho(this,a,b,c,d,e,f,this.penManager),this}get lines(){return this.penManager.lines}get tmpPenManager(){return this._tmpPenManager===null&&(this._tmpPenManager=new Pd({penPool:this.penPool})),this._tmpPenManager}getPlainText(a,b,c){let d;return a==null?d=this.penManager.plainText:d=this.parser.splitText(a,!0).join(""),(b!=null||c!=null)&&(b==null&&(b=0),c==null&&(c=d.length),d=d.substring(b,c)),d}getPenManager(a,b){return a===void 0?this.clonePenManager(b,this.penManager):(b===void 0&&(b=new Pd({penPool:this.penPool})),this.updatePenManager(a,this.parent.wrapMode,this.parent.wrapWidth,b),b)}getText(a,b,c,d){if(a==null)return this.penManager.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d);let e=this.tmpPenManager;return this.updatePenManager(a,this.parent.wrapMode,this.parent.wrapWidth,e),e.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d)}clonePenManager(a,b=this.penManager){return b.clone(a)}getLastPen(a=this.penManager){return a.lastPen}addImageInfo(a,b){return this.imageManager===void 0&&(this.imageManager=new fo()),this.imageManager.add(a,b),this}}function Ci(a,b=!0,c=!0){let d=a.canvasText;b&&d.updatePenManager(a.text,a.wrapMode,a.wrapWidth);if(c){let e=a.padding,f,g,i,h;a.fixedWidth===0?(f=d.textWidth,i=f+e.left+e.right):(i=a.fixedWidth,f=i-e.left-e.right,f>d.textWidth&&(f=d.textWidth)),a.fixedHeight===0?(g=d.textHeight,h=g+e.top+e.bottom):(h=a.fixedHeight,g=h-e.top-e.bottom,g>d.textHeight&&(g=d.textHeight));let k=a.resolution,n=Math.ceil(i*k),o=Math.ceil(h*k),s=a.canvas;(s.width!==n||s.height!==o)&&(s.width=n,s.height=o,a.texture.setSize(i,h),a.setSize(i,h));let u=a.context;u.save(),u.scale(k,k),d.draw(e.left,e.top,f,g,0,a.textScrollY),u.restore(),a.texture.binding&&a.texture.binding.update(),a.setDirty(_.TEXTURE)}}function Cf(a,b=0,c=0){a.fixedWidth=b,a.fixedHeight=c,Ef(a)}function Di(a,b,c,d,e){const f=a.padding;if(typeof b==="number")f.left=b,f.right=c===void 0?b:c,f.top=d===void 0?b:d,f.bottom=e===void 0?b:e;else{let g=b;f.left=g.left??0,f.right=g.right??0,f.top=g.top??0,f.bottom=g.bottom??0}Ef(a)}function Ef(a){const b=a.fixedWidth;if(a.wrapMode!==Ga.none){const c=a.padding,d=b-c.left-c.right;a.wrapWidth=Math.max(d,0)}else a.wrapWidth=0}function Yn(a,b,c=!1){c?a.textScrollYPercentage=b:a.textScrollY=b}function Ei(a,b){typeof b==="string"&&(b=Ba[b]),a.align=b}function Fi(a,b=0){a.lineSpacing=b}function Gi(a,b,c,d=0,e=0,f,g=!0){c||(d=0),a.backgroundFillStyle=b,a.backgroundFillColor2=f,a.backgroundIsHorizontalGradient=g,a.backgroundStrokeStyle=c,a.backgroundStrokeThickness=d,a.cornerRadius=e}function Zn(a,b,c){b&&Hi(a,b),c&&Ii(a,c)}function Hi(a,b){a.fontFamily=b}function Ii(a,b){typeof b==="number"&&(b=`${b}px`),a.fontSize=b}function Ji(a,b){a.fillStyle=b}function Ki(a,b,c=2){a.strokeStyle=b,a.strokeThickness=c}function Li(a,b="#000",c=5,d=0,e=0,f=!1,g=!1){a.shadowColor=b,a.shadowBlur=c,a.shadowOffsetX=d,a.shadowOffsetY=e,a.shadowFill=f,a.shadowStroke=g}function Mi(a,b,c){typeof b==="string"&&(b=Ga[b]),a.wrapMode=b,c===void 0?Ef(a):a.wrapWidth=c}function Ni(a,b,c=2,d=0){a.underlineStyle=b,a.underlineThickness=c,a.underlineOffsetY=d}function Bi(a,b,c){a.canvasText.addImageInfo(b,c)}function _n(a,b,c,d){return b=a.canvasText.getText(b,c,d,!0),b.split(Oi)}function $n(a,b,c,d){return a.canvasText.getPlainText(b,c,d)}function ao(a,b,c,d){return a.canvasText.getText(b,c,d,!1)}function bo(a,b,c,d){return a.canvasText.getText(b,c,d,!1)}function co(a,b){return a.canvasText.clonePenManager(b)}function eo(a,b,c){return a.canvasText.getPenManager(b,c)}class Df extends fb{constructor(a,b,c="",{width:d=0,height:e=0,padding:f,wrapMode:g=Ga.none,backgroundFillStyle:i,backgroundFillColor2:h,backgroundIsHorizontalGradient:k,backgroundStrokeStyle:n,backgroundStrokeThickness:o,cornerRadius:s=0,align:u=Ba.TOP_LEFT,lineSpacing:v=0,fontFamily:y="monospace",fontSize:G="16px",fillStyle:K="#fff",strokeStyle:J,strokeThickness:N=1,shadowColor:I="#000",shadowBlur:O=4,shadowOffsetX:P=0,shadowOffsetY:L=0,shadowFill:r=!1,shadowStroke:t=!1,underlineStyle:j="#fff",underlineThickness:m=1,underlineOffsetY:l=0,images:q}={},w){super(a,b,Eb());this.antialias=!1;this.fontFamily="monospace";this.fontSize="16px";this.fillStyle="#fff";this.strokeThickness=1;this.shadowStroke=!1;this.shadowFill=!1;this.shadowColor="#000";this.shadowBlur=4;this.shadowOffsetX=0;this.shadowOffsetY=0;this.underlineStyle="#fff";this.underlineThickness=1;this.underlineOffsetY=0;this.align=Ba.TOP_LEFT;this.lineSpacing=0;this.wrapMode=Ga.none;this.wrapWidth=0;this.fixedWidth=0;this.fixedHeight=0;this.padding={left:0,right:0,top:0,bottom:0};this._textScrollY=0;this.type="rexText";const p=ua.get();this.resolution=p.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.canvasText=new Xn({canvas:this.canvas,context:this.context,parent:this,parser:w}),Cf(this,d,e),f&&Di(this,f),Mi(this,g),Ei(this,u),Fi(this,v),Gi(this,i,n,o,s,h,k),Hi(this,y),Ii(this,G),Ji(this,K),J&&Ki(this,J,N),Li(this,I,O,P,L,r,t),Ni(this,j,m,l),q&&Bi(this,q),this.setText(c)}destroy(a){this.canvasText.destroy(),this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}updateText(a=!0,b=!0){return Ci(this,a,b),this}get text(){return this._text}set text(a){this.setText(a)}setText(a="",b=!0){return Array.isArray(a)&&(a=a.join(`
`)),a!==this._text&&(this._text=a.toString(),b&&this.updateText()),this}setBackgroundStyle(a,b,c=2,d=0,e,f=!0){return Gi(this,a,b,c,d,e,f),this}setFixedSize(a,b){return Cf(this,a,b),this}setPadding(a,b,c,d){return Di(this,a,b,c,d),this}setTextScrollY(a,b=!1){return Yn(this,a,b),this}setAlign(a){return Ei(this,a),this}setLineSpacing(a=0){return Fi(this,a),this}setFont(a,b){return Zn(this,a,b),this}setFillStyle(a){return Ji(this,a),this}setStrokeStyle(a,b=2){return Ki(this,a,b),this}setShadow(a="#000",b=5,c=0,d=0,e=!1,f=!1){return Li(this,a,b,c,d,e,f),this}resize(a,b){return Cf(this,a,b),Ci(this),this}setWrapMode(a,b=0){return Mi(this,a,b),this}setUnderline(a,b=2,c=0){return Ni(this,a,b,c),this}addImageInfo(a,b){return Bi(this,a,b),this}getWrappedText(a,b,c){return _n(this,a,b,c)}getPlainText(a,b,c){return $n(this,a,b,c)}getText(a,b,c){return ao(this,a,b,c)}getSubString(a,b,c){return bo(this,a,b,c)}clonePenManager(a){return co(this,a)}getPenManager(a,b){return eo(this,a,b)}get textScrollY(){return this._textScrollY}set textScrollY(a){this._textScrollY=a}get textScrollYPercentage(){return this._textScrollY/(this.totalTextHeight-this.displayTextHeight)}set textScrollYPercentage(a){const b=this.displayTextHeight,c=this.totalTextHeight;c<=b?this._textScrollY=0:this._textScrollY=(c-b)*a}get totalTextHeight(){return this.canvasText.textHeight}get displayTextHeight(){const a=this.padding;return this.height-a.top-a.bottom}}class If{destroy(){}}const Jf={text:null,prop:null},Kf={font:void 0,fontFamily:void 0,fontStyle:void 0,fontSize:void 0,fillStyle:void 0,strokeStyle:void 0,strokeThickness:void 0,shadowColor:void 0,shadowOffsetX:void 0,shadowOffsetY:void 0,shadowBlur:void 0,shadowStroke:void 0,shadowFill:void 0,underlineStyle:void 0,underlineThickness:void 0,underlineOffsetY:void 0,image:void 0};class no extends If{splitText(a,b=!1){const c=[];let d=0;for(;;){const f=Si.exec(a);if(!f)break;const g=f[0],i=Si.lastIndex-g.length;d<i&&c.push(a.substring(d,i)),b||c.push(g),d=Si.lastIndex}const e=a.length;return d<e&&c.push(a.substring(d,e)),c}tagTextToProp(a,b){let c,d;b==null&&(b={}),b.img&&wa(b,ob,"img"),or.test(a)?(wa(b,Za,"b",!0),c=""):pr.test(a)?(wa(b,ob,"b"),c=""):qr.test(a)?(wa(b,Za,"i",!0),c=""):rr.test(a)?(wa(b,ob,"i"),c=""):oo.test(a)?(d=a.match(oo),wa(b,Za,"size",d[1]+"px"),c=""):sr.test(a)?(wa(b,ob,"size"),c=""):po.test(a)?(d=a.match(po),wa(b,Za,"color",d[1]),c=""):tr.test(a)?(wa(b,ob,"color"),c=""):qo.test(a)?(d=a.match(qo),wa(b,Za,"u",!0),c=""):ro.test(a)?(d=a.match(ro),wa(b,Za,"u",d[1]),c=""):ur.test(a)?(wa(b,ob,"u"),c=""):vr.test(a)?(wa(b,Za,"shadow",!0),c=""):so.test(a)?(d=a.match(so),wa(b,Za,"shadow",d[1]),c=""):wr.test(a)?(wa(b,ob,"shadow"),c=""):xr.test(a)?(wa(b,Za,"stroke",!0),c=""):to.test(a)?(d=a.match(to),wa(b,Za,"stroke",d[1]),c=""):yr.test(a)?(wa(b,ob,"stroke"),c=""):uo.test(a)?(d=a.match(uo),wa(b,Za,"img",d[1]),c=""):zr.test(a)?(wa(b,ob,"img"),c=""):vo.test(a)?(d=a.match(vo),wa(b,Za,"area",d[1]),c=""):Ar.test(a)?(wa(b,ob,"area"),c=""):c=a;const e=Jf;return e.text=c,e.prop=b,e}propToStyle(a,b){const c=Kf;return b.hasOwnProperty("img")?c.image=b.img:(c.image=null,c.fontFamily=a.fontFamily,c.fontSize=b.size??a.fontSize,c.fontStyle=mr(b.b,b.i),c.font=`${c.fontStyle} ${c.fontSize} ${c.fontFamily}`,c.fillStyle=b.color??a.fillStyle,b.hasOwnProperty("stroke")?b.stroke===!0?(c.strokeStyle=a.strokeStyle,c.strokeThickness=a.strokeThickness):(c.strokeStyle=b.stroke,c.strokeThickness=a.strokeThickness):(c.strokeStyle=a.strokeStyle,c.strokeThickness=0)),b.hasOwnProperty("shadow")?b.shadow===!0?(c.shadowColor=a.shadowColor,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor=b.shadow,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor="#000",c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=0,c.shadowStroke=!1,c.shadowFill=!1),b.hasOwnProperty("u")?b.u===!0?(c.underlineStyle=a.underlineStyle,c.underlineThickness=a.underlineThickness,c.underlineOffsetY=a.underlineOffsetY):(c.underlineStyle=b.u,c.underlineThickness=a.underlineThickness,c.underlineOffsetY=a.underlineOffsetY):(c.underlineStyle="#000",c.underlineThickness=0,c.underlineOffsetY=0),c}propToTagText(a,b,c){c==null&&(c=nr);let d=[];for(const f in c){if(b.hasOwnProperty(f))continue;d.push(`[/${f}]`)}a=`${d.join()}${a}`;let e=[];for(const f in b){if(c[f]===b[f])continue;switch(f){case"size":const g=b.size.replace("px","");e.push(`[size=${g}]`);break;case"color":case"img":case"area":e.push(`[${f}=${b[f]}]`);break;case"stroke":case"u":b[f]===!0?e.push(`[${f}]`):e.push(`[${f}=${b[f]}]`);break;default:e.push(`[${f}]`);break}}return a=`${a}${e.join()}`,a}}const wa=function(a,b,c,d){return b===Za?a[c]=d:a.hasOwnProperty(c)&&delete a[c],a};var mr=function(a,b){return a&&b?"bold italic":a?"bold":b?"italic":""};const nr={},Si=/\[b\]|\[\/b\]|\[i\]|\[\/i\]|\[size=(\d+)\]|\[\/size\]|\[color=([a-z]+|#[0-9abcdef]+)\]|\[\/color\]|\[u\]|\[u=([a-z]+|#[0-9abcdef]+)\]|\[\/u\]|\[shadow\]|\[shadow=([a-z]+|#[0-9abcdef]+)\]|\[\/shadow\]|\[stroke\]|\[stroke=([a-z]+|#[0-9abcdef]+)\]|\[\/stroke\]|\[img=([^\]]+)\]|\[\/img\]|\[area=([^\]]+)\]|\[\/area\]/ig;var or=/\[b\]/i,pr=/\[\/b\]/i,qr=/\[i\]/i,rr=/\[\/i\]/i,oo=/\[size=(\d+)\]/i,sr=/\[\/size\]/i,po=/\[color=([a-z]+|#[0-9abcdef]+)\]/i,tr=/\[\/color\]/i,qo=/\[u\]/i,ro=/\[u=([a-z]+|#[0-9abcdef]+)\]/i,ur=/\[\/u\]/i,vr=/\[shadow\]/i,so=/\[shadow=([a-z]+|#[0-9abcdef]+)\]/i,wr=/\[\/shadow\]/i,xr=/\[stroke\]/i,to=/\[stroke=([a-z]+|#[0-9abcdef]+)\]/i,yr=/\[\/stroke\]/i,uo=/\[img=([^\]]+)\]/i,zr=/\[\/img\]/i,vo=/\[area=([^\]]+)\]/i,Ar=/\[\/area\]/i;const ob=!1,Za=!0;class Dd extends Df{constructor(a,b,c="",d){super(a,b,c,d,new no());this.type="rexBBcodeText"}}class wo extends If{constructor(a){super();this.tags=new Map();if(a)for(const b in a)this.addTag(b,a[b])}destroy(){this.tags.clear()}addTag(a,b){return this.tags.set(a,b),this}isTextTag(a){const b=this.tags.get(a);return b?b.img==null:!1}splitText(a,b=!1){const c=[];let d=0;for(;;){const f=Ti.exec(a);if(!f)break;const g=f[0],i=Ti.lastIndex-g.length;d<i&&c.push(a.substring(d,i));if(!b)c.push(g);else if(yo.test(g)){const h=g.match(zo);c.push(h[2])}else if(Ao.test(g)){const h=g.match(Bo);c.push(h[2])}d=Ti.lastIndex}const e=a.length;return d<e&&c.push(a.substring(d,e)),c}tagTextToProp(a,b){let c,d;if(yo.test(a)){const f=a.match(zo);if(f!=null){const g=f[1],i=this.tags;d=i.get(g)??{},d._class=g,c=f[2]}}else if(Ao.test(a)){const f=a.match(Bo);if(f!=null){const g=f[1];d=Br(g),d._style=g,c=f[2]}}c===void 0&&(c=a),d===void 0&&(d={});const e=Jf;return e.text=c,e.prop=d,e}propToStyle(a,b){const c=Kf;if(b.hasOwnProperty("img"))c.image=b.img;else{c.image=null,c.fontFamily=b.family??b.fontFamily??b["font-family"]??a.fontFamily;let d=b.size??b.fontSize??b["font-size"]??a.fontSize;typeof d==="number"&&(d=`${d}px`),c.fontSize=d,c.fontStyle=b.style??b.fontStyle??b["font-style"]??"",c.font=`${c.fontStyle} ${c.fontSize} ${c.fontFamily}`,c.fillStyle=b.color??b["font-color"]??a.fillStyle;if(b.hasOwnProperty("stroke")){const e=b.stroke;c.strokeStyle=e.color??a.strokeStyle,c.strokeThickness=e.thinkness??a.strokeThickness}else c.strokeStyle=a.strokeStyle,c.strokeThickness=a.strokeThickness}if(b.hasOwnProperty("shadow")){const d=b.shadow;c.shadowColor=d.color??a.shadowColor,c.shadowOffsetX=d.offsetX??a.shadowOffsetX,c.shadowOffsetY=d.offsetY??a.shadowOffsetY,c.shadowBlur=d.blur??a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0}else c.shadowColor=a.shadowColor,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=a.shadowStroke,c.shadowFill=a.shadowFill;if(b.hasOwnProperty("u")||b.hasOwnProperty("underline")){const d=b.u??b.underline;c.underlineStyle=d.color??a.underlineStyle,c.underlineThickness=d.thinkness??a.underlineThickness,c.underlineOffsetY=d.offset??a.underlineOffsetY}else c.underlineStyle="#000",c.underlineThickness=0,c.underlineOffsetY=0;return c}propToTagText(a,b,c){if(b.hasOwnProperty("_class")){if(a===""){if(this.isTextTag(b._class))return""}return`<class=${b._class}>${a}</class>`}else if(b.hasOwnProperty("_style"))return`<style=${b._style}>${a}</style>`}}function Br(a){const b=a.split(";"),c={};for(var d=0,e=b.length;d<e;d++){const[f,g]=b[d].split(":");if(xo(f)||xo(g))continue;if(f==="stroke"){const i=g.split(" "),h={},k=i.length;k>=1&&(h.color=i[0]),k>=2&&(h.thinkness=parseInt(i[1].replace("px",""))),c.stroke=h}else if(f==="shadow"){const i=g.split(" "),h={},k=i.length;k>=1&&(h.color=i[0]),k>=2&&(h.offsetX=parseInt(i[1].replace("px",""))),k>=3&&(h.offsetY=parseInt(i[2].replace("px",""))),k>=4&&(h.blur=parseInt(i[3].replace("px",""))),c.shadow=h}else if(f==="u"||f==="underline"){const i=g.split(" "),h={},k=i.length;k>=1&&(h.color=i[0]),k>=2&&(h.thinkness=parseInt(i[1].replace("px",""))),k>=3&&(h.offset=parseInt(i[2].replace("px",""))),c[f]=h}else c[f]=g}return c}function xo(a){return a=a.replace(Cr,""),a.length===0}const Ti=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,yo=/<\s*class=/i,zo=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,Ao=/<\s*style=/i,Bo=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,Cr=/^\s+|\s+$/;class Ed extends Df{constructor(a,b,c="",d){const e=d?d.tags:void 0;super(a,b,c,d,new wo(e));this.type="rexTagText"}get parser(){return this.canvasText.parser}addTag(a,b){return this.parser.addTag(a,b),this}addTags(a){for(const b in a)this.parser.addTag(b,a[b]);return this}}const lb={};Sb(lb,{BBCodeText:()=>Dd,BaseSizer:()=>na,GridSizer:()=>yf,Label:()=>Af,MaskedImage:()=>Ad,RectangleCanvas:()=>Bd,RoundRectangleCanvas:()=>Cd,Sizer:()=>Xc,TagText:()=>Ed});function Ya(a,b){return a===void 0||b===void 0?void 0:`${a}|${b}`}function ul(a,b){let c=a.split("|");return b===void 0&&(b=vq),b.x=parseInt(c[0]),b.y=parseInt(c[1]),b}let vq={x:0,y:0};let Zo=new uc();function Ck(){let a=Zo.pop();return a===null&&(a=new Map()),a}function He(a){Zo.push(a)}function Ak(a,b,c,d,e,f,g,i){if(c===f&&d===g&&e===i)return;let h=Ya(c,d),k=Ya(f,g);if(h){let n=b.get(h);n.delete(e);if(h===k){n.set(i,a);return}else n.size===0&&(He(n),b.delete(h))}if(k){let n=b.get(k);n?n.set(i,a):(n=Ck(),n.set(i,a),b.set(k,n))}}function Wg(a,b,c,d){let e=Ya(b,c),f=a.get(e);f&&(d!==void 0?(f.delete(d),f.size===0&&(He(f),a.delete(e))):(f.clear(),He(f),a.delete(e)))}let _o=new uc();function Bk(){let a=_o.pop();return a===null&&(a=new Set()),a}function Vg(a){_o.push(a)}function Ge(a,b,c,d){if(c===d)return;if(c!==void 0){let e=b.get(c);e&&(e.delete(a),e.size===0&&(Vg(e),b.delete(c)))}if(d!==void 0){let e=b.get(d);e?e.add(a):(e=Bk(),e.add(a),b.set(d,e))}}function dc(a,b,c){let d=a.get(b);d&&(d.delete(c),d.size===0&&(Vg(d),a.delete(b)))}function vk(a,b,c,d,e){let f=a.chessToXYZ.get(b),g=f?f.x:void 0,i=f?f.y:void 0,h=f?f.y:void 0;f?(f.x=c,f.y=d,f.z=e):a.chessToXYZ.set(b,{x:c,y:d,z:e}),Ak(b,a.XYToZMap,g,i,h,c,d,e),Ge(b,a.XToChessSet,g,c),Ge(b,a.YToChessSet,i,d),Ge(b,a.ZToChessSet,h,e)}function cc(a,b,c,d){let e=a.XYToZMap.get(Ya(b,c));return e===void 0?null:d!==void 0?e.has(d)?e.get(d):null:e}function wk(a,b,c,d){if(d!==void 0){let e=cc(a,b,c,d);if(e===void 0)return;a.chessToXYZ.delete(e),Wg(a.XYToZMap,b,c,d),dc(a.XToChessSet,b,e),dc(a.YToChessSet,c,e),dc(a.ZToChessSet,d,e)}else{let e=cc(a,b,c);if(e){for(const[f,g]of e)a.chessToXYZ.delete(g),dc(a.XToChessSet,b,g),dc(a.YToChessSet,c,g),dc(a.ZToChessSet,f,g);Wg(a.XYToZMap,b,c)}}}function xk(a,b){return a.chessToXYZ.has(b)}function yk(a,b,c,d){return cc(a,b,c,d)!==null}function zk(a,b){return a.chessToXYZ.get(b)||null}function Tg(a){let b=-Infinity;for(const[c,d]of a)b<c&&(b=c);return b}function Ug(a){let b=Infinity;for(const[c,d]of a)b>c&&(b=c);return b}class Eg{constructor(){this.chessToXYZ=new Map(),this.XYToZMap=new Map(),this.XToChessSet=new Map(),this.YToChessSet=new Map(),this.ZToChessSet=new Map(),this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0}destroy(){this.clear()}clear(){return this.chessToXYZ.clear(),this.XYToZMap.clear(),this.XToChessSet.clear(),this.YToChessSet.clear(),this.ZToChessSet.clear(),this.clearBounds(),this}clearBounds(){return this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0,this}addChess(a,b,c,d){return vk(this,a,b,c,d),this.clearBounds(),this}getChess(a,b,c){return cc(this,a,b,c)}removeChess(a,b,c){return wk(this,a,b,c),this.clearBounds(),this}hasChess(a){return xk(this,a)}contains(a,b,c){return yk(this,a,b,c)}getXYZ(a){return zk(this,a)}get xMax(){return this._xMax===void 0&&(this._xMax=Tg(this.XToChessSet)),this._xMax}get xMin(){return this._xMin===void 0&&(this._xMin=Ug(this.XToChessSet)),this._xMin}get yMax(){return this._yMax===void 0&&(this._yMax=Tg(this.YToChessSet)),this._yMax}get yMin(){return this._yMin===void 0&&(this._yMin=Ug(this.YToChessSet)),this._yMin}}function hb(a,b=[]){let c=a.boardData.chessToXYZ;for(const[d,e]of c)b.push(d);return b}function We(a){if(typeof a!=="object"||a.nodeType||a===a.window)return!1;try{if(a.constructor&&!{}.hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0}function md(a){return We(a)?!0:typeof a==="object"?a.isTileXYZ:!1}function ca(a,b){let c=a.boardData.getXYZ(b);return c?c:md(b)?b:null}function qa(a,b,c,d){return a.boardData.getChess(b,c,d)}class Dk{constructor(a){this.parent=a,this.board=null,this.blocker=!1,this.boot()}boot(){typeof this.parent==="object"&&this.parent.on&&this.parent.on("destroy",this.destroy,this)}destroy(){if(this.board){let a=this.tileXYZ;this.board.boardData.removeChess(a.x,a.y,a.z)}this.parent=void 0,this.board=null}setBoard(a){return this.board=a,this}get tileXYZ(){return this.board==null?null:this.board.boardData.getXYZ(this.parent)}setBlocker(a=!0){return this.blocker=a,this}setBlockEdge(a,b=!0){typeof this.blocker==="boolean"&&(this.blocker={});let c=this.blocker;if(typeof a==="object"){let d=a;for(let e in d)c[e]=d[e]}else c[a]=b;return this}getBlockEdge(a){return typeof this.blocker==="boolean"?!1:this.blocker.hasOwnProperty(a)?this.blocker[a]:!1}}function bb(a){return a.hasOwnProperty("rexChess")||(a.rexChess=new Dk(a)),a.rexChess}function Ta(a,b,c,d,e,f=!1,g=!1){if(b){let i=ca(a,b);if(i)c=i.x,d=i.y,e=i.z;else return}else{b=qa(a,c,d,e);if(!b)return}g||a.boardData.removeChess(c,d,e),a._isBoard&&bb(b).setBoard(null),f&&b.destroy&&b.destroy()}function bc(a,b){if(a.infinityMode)return;if(a.height===void 0||a.height<=b){a.height=b;return}let c=hb(a);c.forEach(d=>{let e=ca(a,d);e.y>b&&Ta(a,d)}),a.height=b}function ac(a,b){if(a.infinityMode)return;if(a.width===void 0||a.width<=b){a.width=b;return}let c=hb(a);c.forEach(d=>{let e=ca(a,d);e.x>b&&Ta(a,d)}),a.width=b}class pe{constructor({grid:a=void 0,wrap:b=!1,inifinity:c=!1,width:d=0,height:e=0}={}){this.boardData=new Eg(),this._isBoard=!0,this.setGrid(a),this.setWrapMode(b),this.setInfinityMode(c),this.setBoardSize(d,e)}destroy(){}setGrid(a){return this.grid=a,this}setWrapMode(a=!0){return this.wrapMode=a,this}setInfinityMode(a=!0){return this.infinityMode=a,this}setBoardSize(a=0,b=0){return ac(this,a),bc(this,b),this}}function ab(a,b,c,d){let e;return a.infinityMode?e=!0:e=b>=0&&b<a.width&&c>=0&&c<a.height,e&&d!==void 0&&(e=a.boardData.contains(b,c,d)),e}function Ia(a,b,c,d){return a.grid.getWorldXY(b,c,d)}function Gc(a,b,c,d){if(b===void 0){let e=hb(a);for(let f=0,g=e.length;f<g;f++){let i=e[f],h=ca(a,i);Ia(a,h.x,h.y,i)}}else{if(c===void 0){let e=ca(a,b);c=e.x,d=e.y}Ia(a,c,d,b)}}function Fb(a,b,c,d,e,f=!0){if(!ab(a,c,d))return;let g=ca(a,b);e===void 0&&(g?e=g.z:e=0);if(g&&g.x===c&&g.y===d&&g.z===e)return;let i=qa(a,c,d,e);i&&(Ta(a,null,c,d,e),console.warn(`Chess at (${c},${d},${e}) has been removed because of overlapped`)),a.boardData.addChess(b,c,d,e),a._isBoard&&bb(b).setBoard(a),f&&Gc(a,b,c,d)}function hc(a,b,c,d){return Math.atan2(d-b,c-a)}function Gb(a,b,c){let d=ca(a,b),e=ca(a,c),f=Ia(a,d.x,d.y,!0),g=f.x,i=f.y;f=Ia(a,e.x,e.y,!0);let h=f.x,k=f.y;return hc(g,i,h,k)}function vb(a,b,c){let d=c-b;return b+((a-b)%d+d)%d}function Fc(a,b,c,d={x:0,y:0}){return d===!0&&(d=Ep),a.wrapMode?b=vb(b,0,a.width):!a.infinityMode&&(b<0||b>=a.width)&&(b=null),a.wrapMode?c=vb(c,0,a.height):!a.infinityMode&&(c<0||c>=a.height)&&(c=null),d.x=b,d.y=c,d}let Ep={x:0,y:0};function Sa(a,b,c,d,e){let f=ca(a,b);if(f===null)return null;typeof c==="string"&&(c.indexOf(",")===-1?c=parseInt(c):c=c.split(".").map(k=>parseInt(k,10)));let g=typeof c==="number",i=typeof d==="number";if(g&&i){let k=a.grid.getTileXYAtDirection(f,c,d,e);return Fc(a,k.x,k.y,k),(k.x===null||k.y===null)&&(k=null),k}Array.isArray(e)||(e=[]),c===null&&(c=a.grid.allDirections);let h;if(g)if(Array.isArray(d))for(let k=0,n=d.length;k<n;k++)h=Sa(a,f,c,d[k]),h!==null&&e.push(h);else{let k,n,o;({end:k=1,start:n=k>0?1:-1,step:o=k>=n?1:-1}=d);if(n===k)h=Sa(a,f,c,k),h!==null&&e.push(h);else if(n<k)for(let s=n;s<=k;s+=o)h=Sa(a,f,c,s),h!==null&&e.push(h);else for(let s=n;s>=k;s+=o)h=Sa(a,f,c,s),h!==null&&e.push(h)}else for(let k=0,n=c.length;k<n;k++)i?(h=Sa(a,f,c[k],d),h!==null&&e.push(h)):Sa(a,f,c[k],d,e);return e}function mb(a,b,c=null,d={x:0,y:0}){return Sa(a,b,c,1,d)}function Cc(a,b,c){b===void 0&&(b=Ip);let d=a.wrapMode,e=a.infinityMode;a.wrapMode=!1,a.infinityMode=!0;let f=mb(a,b,c,!0);return a.wrapMode=d,a.infinityMode=e,Gb(a,b,f)}let Ip={x:0,y:0};const Sr=180/Math.PI;function Jc(a){return a*Sr}function Hk(a,b){let c=b-a;if(c===0)return 0;let d=Math.floor((c- -180)/360);return c-d*360}function Bc(a,b,c){c=Jc(c);let d=a.grid.allDirections,e=Infinity,f;for(let g=0,i=d.length;g<i;g++){let h=Jc(Cc(a,b,d[g])),k=Math.abs(Hk(c,h));k<e&&(e=k,f=g)}return f}function Ec(a,b,c){if(b===null||c===null)return null;if(b.x===c.x&&b.y===c.y)return null;let d=a.grid.getNeighborTileDirection(b,c);if(a.wrapMode&&d===null){let e=mb(a,b,null);for(let f=0,g=e.length;f<g;f++){let i=e[f];if(c.x===i.x&&c.y===i.y){d=f;break}}}return d}function Dc(a,b,c){let d=ca(a,b),e=ca(a,c);return Ec(a,d,e)}function re(a,b,c){return Dc(a,b,c)!==null}function se(a,b,c,d=!0){let e=ca(a,b),f=ca(a,c);return e===null||f===null?null:a.grid.directionBetween(e,f,d)}function jd(a,b,c=1,d=[]){let e=a.grid.ringToTileXYArray(b,c);for(let f=0,g=e.length;f<g;f++){let i=e[f];ab(a,i.x,i.y)&&d.push(i)}return d}function Fg(a,b,c,d=!0,e=[]){for(let f=0;f<=c;f++){let g=d?f:c-f;jd(a,b,g,e)}return e}function ib(a,b,c,d,e={x:0,y:0}){return e===!0&&(e=Gp),c===0&&d===0?(e.x=b.x,e.y=b.y):a.grid.offset(b,c,d,e),e}let Gp={x:0,y:0};function Gg(a,b){let c=Infinity,d=Infinity,e;for(let i=0,h=b.length;i<h;i++)e=b[i],c=Math.min(c,e.x),d=Math.min(d,e.y);if(c!==0||d!==0)for(let i=0,h=b.length;i<h;i++)e=b[i],ib(a,e,-c,-d,e);let f=-Infinity,g=-Infinity;for(let i=0,h=b.length;i<h;i++)e=b[i],f=Math.max(f,e.x),g=Math.max(g,e.y);return ac(a,f+1),bc(a,g+1),b}var fc;(function(a){a[a["x+,y+"]=0]="x+,y+",a[a["x-,y+"]=1]="x-,y+",a[a["y+,x+"]=2]="y+,x+",a[a["y-,x+"]=3]="y-,x+"})(fc||(fc={}));function te(a,b,c,d=0){let e={x:0,y:0};switch(d){case 0:for(let f=0;f<a.height;f++)for(let g=0;g<a.width;g++)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 1:for(let f=0;f<a.height;f++)for(let g=a.width-1;g>=0;g--)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 2:for(let f=0;f<a.width;f++)for(let g=0;g<a.height;g++)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a);break;case 3:for(let f=0;f<a.width;f++)for(let g=a.height-1;g>=0;g--)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a)}}function ue(a,b,c,d){return a.grid.getDistance(b,c,d)}function id(a,b=0,c=[]){if(Array.isArray(b)){let d=b;for(let e=0;e<a.height;e++)for(let f=0;f<a.width;f++){let g=!0;for(let i=0,h=d.length;i<h;i++)if(qa(a,f,e,d[i])!==null){g=!1;break}g&&c.push({x:f,y:e})}}else for(let d=0;d<a.height;d++)for(let e=0;e<a.width;e++)qa(a,e,d,b)===null&&c.push({x:e,y:d});return c}function ve(a,b,c,d){return a.grid.getGridPoints(b,c,d)}function Ua(a,b,c,d=[]){let e=a.boardData.getChess(b,c);for(const[f,g]of e)d.push(g);return d}function Hc(a,b,c,d=[]){let e=c!=null,f,g;for(let i=0,h=b.length;i<h;i++)f=b[i],e?(g=qa(a,f.x,f.y,c),g!==null&&d.push(g)):Ua(a,f.x,f.y,d);return d}function we(a,b,c,d,e){let f=ca(a,b);if(f===null)return null;d==null&&(d=f.hasOwnProperty("z")?f.z:null);let g=mb(a,f,c,!0);return g===null?null:Array.isArray(g)?(e===void 0&&(e=[]),Hc(a,g,d,e)):d==null?(e===void 0&&(e=[]),Ua(a,g.x,g.y,e)):qa(a,g.x,g.y,d)}function xe(a,b,c,d={x:0,y:0}){let e=Bc(a,b,c);return Sa(a,b,e,1,d)}function ye(a,b,c,d){return a.grid.getOppositeDirection(b,c,d)}function kd(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function Ic(a,b=0,c=a.length){let d=b+Math.floor(Math.random()*c);return a[d]===void 0?null:a[d]}function Hg(a,b=0,c={x:0,y:0}){c===!0&&(c=Bp);let d=Math.floor(a.width*a.height*.3);for(let f=0;f<d;f++){let g=kd(0,a.width-1),i=kd(0,a.height-1);if(qa(a,g,i,b)===null)return c.x=g,c.y=i,c}let e=id(a,b);if(e.length===0)return null;{let f=Ic(e);return c.x=f.x,c.y=f.y,c}}let Bp={x:0,y:0};function Ig(a,b,c,d){if(d===void 0){let e=Ua(a,b,c);for(let f=0,g=e.length;f<g;f++){let i=bb(e[f]).blocker;if(i===!0)return!0}return!1}else{let e=qa(a,b,c,d);if(e===null)return!1;let f=bb(e).blocker;return f===!0}}function Jg(a,b){return a.boardData.chessToXYZ.has(b)}function Kg(a,b,c,d,e){if(d===void 0){let f=Ua(a,b,c);for(let g=0,i=f.length;g<i;g++)if(uk(bb(f[g]).blocker,e))return!0;return!1}else{let f=qa(a,b,c,d);return f===null?!1:uk(bb(f).blocker,e)}}function uk(a,b){return a===!1||a===!0?a:a[b]===!0}function Yg(a){return a=a%Vo,a>=0?a:a+Vo}const Vo=Math.PI*2;function Ik(a,b,c=1e-4){return Math.abs(a-b)<c}function ze(a,b,c,d,e){let f=ca(a,b),g=ca(a,c),i=Gb(a,f,g);i=Yg(i);let h=Math.abs(i-d);h=Math.min(h,Jp-h);let k=e/2;return Ik(h,k)||h<k}const Jp=Math.PI*2;function Ae(a,b,c,d,e){let f=ca(a,b),g=ca(a,c),i=a.grid.directions;a.grid.directions=a.grid.sides;let h=a.grid.directionBetween(f,g,!1);a.grid.directions=i;let k=Math.abs(h-d);return k=Math.min(k,a.grid.directions-k),k<=e/2}function Oa(a,b,c,d={x:0,y:0}){return a.grid.getTileXY(b,c,d)}function Be(a,b,c,d){if(a.infinityMode&&d===void 0)return!0;let e=Oa(a,b,c,!0);return ab(a,e.x,e.y,d)}function Gk(a,b,c,d){let e=a-c,f=b-d;return Math.sqrt(e*e+f*f)}function Xg(a,b,c){return(b-a)*c+a}function Lg(a,b,c,d,e,f=[]){let g=Gk(b,c,d,e),i=Math.min(a.grid.width,a.grid.height),h=Math.ceil(g/(i/4)),k;for(let n=0;n<=h;n++){let o=n/h,s=Xg(b,d,o),u=Xg(c,e,o),v=Oa(a,s,u);if(!ab(a,v.x,v.y))continue;if(k&&k.x===v.x&&k.y===v.y)continue;f.push(v),k=v}return f}var gc;(function(a){a[a.x=1]="x",a[a.horizontal=1]="horizontal",a[a.h=1]="h",a[a.y=2]="y",a[a.vertical=2]="vertical",a[a.v=2]="v",a[a.xy=3]="xy"})(gc||(gc={}));function Mg(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=Fp),d!==null?ib(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.mirror(e,c,e),d!==null&&ib(a,e,d.x,d.y,e),e}let Fp={x:0,y:0};function Ng(a,b=!1,c=!1){let d=hb(a);for(let e=0,f=d.length;e<f;e++)Ta(a,d[e],void 0,void 0,void 0,b,c)}function Og(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=Hp),d!==null?ib(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.rotate(e,c,e),d!==null&&ib(a,e,d.x,d.y,e),e}let Hp={x:0,y:0};function Pg(a,b,c){let d=ca(a,b);if(d===null)return;Fb(a,b,d.x,d.y,c)}function ld(a,b,c){return Math.max(b,Math.min(c,a))}function Qg(a,b,c,d=[]){let e=Oa(a,b.left,b.top,!0),f=e.x-1,g=e.y-1,i=Oa(a,b.right,b.bottom,!0),h=i.x+1,k=i.y+1;a.infinityMode||(f=ld(f,0,a.width-1),g=ld(g,0,a.height-1),h=ld(h,0,a.width-1),k=ld(k,0,a.height-1));for(let n=f;n<=h;n++)for(let o=g;o<=k;o++){let s=Ia(a,n,o,!0);c(b,s.x,s.y)&&d.push({x:n,y:o})}return d}function Rg(a,b,c,d=!0){let e=ca(a,b),f=ca(a,c);if(e==null||f==null)return;Ta(a,b),Ta(a,c),Fb(a,b,f.x,f.y,f.z,d),Fb(a,c,e.x,e.y,e.z,d)}function Ce(a,b,c=[]){let d=a.boardData.ZToChessSet.get(b);if(d)for(const e of d)c.push(e);return c}function De(a,b,c=[]){for(let d=0,e=b.length;d<e;d++){let f=b[d];c.push(Ia(a,f.x,f.y))}return c}function Ee(a,b,c,d={x:0,y:0}){return d===!0&&(d=Kp),Oa(a,b,c,d),Ia(a,d.x,d.y,d),d}let Kp={x:0,y:0};function Fe(a,b,c,d,e){let f=Oa(a,b,c,!0);return d!==void 0?qa(a,f.x,f.y,d):Ua(a,f.x,f.y,e)}class qe extends pe{addChess(a,b,c,d,e=!0){return Fb(this,a,b,c,d,e),this}angleBetween(a,b){return Gb(this,a,b)}angleSnapToDirection(a,b){return Bc(this,a,b)}angleToward(a,b){return Cc(this,a,b)}areNeighbors(a,b){return re(this,a,b)}chessToTileXYZ(a){return ca(this,a)}contains(a,b,c){return ab(this,a,b,c)}directionBetween(a,b,c=!0){return se(this,a,b,c)}filledRingToTileXYArray(a,b,c=!0,d=[]){return Fg(this,a,b,c,d)}fit(a){return Gg(this,a)}forEachTileXY(a,b,c=0){return te(this,a,b,c),this}getAllChess(a=[]){return hb(this,a)}getChessData(a){return bb(a)}getDistance(a,b,c=!1){return ue(this,a,b,c)}getEmptyTileXYArray(a=0,b=[]){return id(this,a,b)}getGridPoints(a,b,c){return ve(this,a,b,c)}getNeighborChess(a,b,c,d){return we(this,a,b,c,d)}getNeighborChessDirection(a,b){return Dc(this,a,b)}getNeighborTileDirection(a,b){return Ec(this,a,b)}getNeighborTileXY(a,b=null,c={x:0,y:0}){return mb(this,a,b,c)}getNeighborTileXYAtAngle(a,b,c={x:0,y:0}){return xe(this,a,b,c)}getOppositeDirection(a,b,c){return ye(this,a,b,c)}getRandomEmptyTileXY(a=0,b={x:0,y:0}){return Hg(this,a,b)}getTileXYAtDirection(a,b,c,d){return Sa(this,a,b,c,d)}getWrapTileXY(a,b,c={x:0,y:0}){return Fc(this,a,b,c)}gridAlign(a,b,c){return Gc(this,a,b,c),this}hasBlocker(a,b,c){return Ig(this,a,b,c)}hasChess(a){return Jg(this,a)}hasEdgeBlocker(a,b,c,d){return Kg(this,a,b,c,d)}isAngleInCone(a,b,c,d){return ze(this,a,b,c,d)}isDirectionInCone(a,b,c,d){return Ae(this,a,b,c,d)}isOverlappingPoint(a,b,c){return Be(this,a,b,c)}lineToTileXYArray(a,b,c,d,e=[]){return Lg(this,a,b,c,d,e)}mirror(a,b,c=null,d={x:0,y:0}){return Mg(this,a,b,c,d)}offset(a,b,c,d){return ib(this,a,b,c,d)}removeAllChess(a=!1,b=!1){return Ng(this,a,b),this}removeChess(a,b,c,d,e=!1,f=!1){return Ta(this,a,b,c,d,e,f),this}ringToTileXYArray(a,b=1,c=[]){return jd(this,a,b,c)}rotate(a,b,c=null,d={x:0,y:0}){return Og(this,a,b,c,d)}setBoardWidth(a=0){return ac(this,a),this}setBoardHeight(a=0){return bc(this,a),this}setTileZ(a,b){return Pg(this,a,b),this}shapeToTileXYArray(a,b,c=[]){return Qg(this,a,b,c)}swapChess(a,b,c=!0){return Rg(this,a,b,c),this}tileXYArrayToChessArray(a,b,c=[]){return Hc(this,a,b,c)}tileXYToChessArray(a,b,c=[]){return Ua(this,a,b,c)}tileXYZToChess(a,b,c){return qa(this,a,b,c)}tileZToChessArray(a,b=[]){return Ce(this,a,b)}tileXYArrayToWorldXYArray(a,b=[]){return De(this,a,b)}tileXYToWorldXY(a,b,c={x:0,y:0}){return Ia(this,a,b,c)}worldXYSnapToGrid(a,b,c={x:0,y:0}){return Ee(this,a,b,c)}worldXYToChess(a,b,c,d){return Fe(this,a,b,c,d)}worldXYToTileXY(a,b,c){return Oa(this,a,b,c)}}class tk extends qe{}const cb={};Sb(cb,{ChessToTileXYZ:()=>ca,Contains:()=>ab,DirectionBetween:()=>se,ForEachTileXY:()=>te,GetDistance:()=>ue,GetOppositeDirection:()=>ye,GetTileXYAtDirection:()=>Sa,GetWrapTileXY:()=>Fc,IsDirectionInCone:()=>Ae,TileXYArrayToChessArray:()=>Hc,TileXYToChessArray:()=>Ua,TileXYZToChess:()=>qa,TileZToChessArray:()=>Ce});const Hb={};Sb(Hb,{AngleBetween:()=>Gb,AngleSnapToDirection:()=>Bc,AngleToward:()=>Cc,GetGridPoints:()=>ve,GridAlign:()=>Gc,IsAngleInCone:()=>ze,IsOverlappingPoint:()=>Be,TileXYArrayToWorldXYArray:()=>De,TileXYToWorldXY:()=>Ia,WorldXYSnapToGrid:()=>Ee,WorldXYToChess:()=>Fe,WorldXYToTileXY:()=>Oa});const ec={};Sb(ec,{AreNeighbors:()=>re,GetNeighborChess:()=>we,GetNeighborChessDirection:()=>Dc,GetNeighborTileDirection:()=>Ec,GetNeighborTileXY:()=>mb,GetNeighborTileXYAtAngle:()=>xe});var pa;(function(a){a[a.orthogonal=0]="orthogonal",a[a.isometric=1]="isometric"})(pa||(pa={}));var wb;(function(a){a[a["4dir"]=4]="4dir",a[a["8dir"]=8]="8dir"})(wb||(wb={}));class ol{constructor({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=pa.orthogonal,dir:f=wb["4dir"]}={}){this.setOriginPosition(a,b),this.setCellSize(c,d),this.setType(e),this.setDirectionMode(f)}fromJSON({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=pa.orthogonal,dir:f=wb["4dir"]}={}){return this.setType(e),this.setDirectionMode(f),this.setOriginPosition(a,b),this.setCellSize(c,d),this}toJSON(){return{x:this.x,y:this.y,cellWidth:this.cellWidth,cellHeight:this.cellHeight,type:this.mode,dir:this.directions}}setOriginPosition(a=0,b=0){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setType(a=pa.orthogonal){return typeof a==="string"&&(a=pa[a]),this.mode=a,this}setDirectionMode(a=wb["4dir"]){return typeof a==="string"&&(a=wb[a]),this.directions=a,this}}function gl(a,b,c,d=!0){let e;switch(a.mode){case pa.orthogonal:case pa.isometric:if(b.y===c.y)e=c.x>=b.x?0:2;else if(b.x===c.x)e=c.y>=b.y?1:3;else if(a.directions===wb["4dir"]){let f=Jc(hc(b.x,b.y,c.x,c.y));f<0&&(f+=360),e=f/90,d&&(e=Math.round(e))}else{let f=c.x-b.x,g=c.y-b.y;if(f===g)e=f>0?4:6;else if(f===-g)e=f>0?7:5;else{let i=Jc(Math.atan2(g,f));i<0&&(i+=360);let h=i/45;d&&(h=Math.round(h)),h>=0&&h<1?e=h:h>=1&&h<2?e=h+3:h>=2&&h<3?e=h-1:h>=3&&h<4?e=h+2:h>=4&&h<5?e=h-2:h>=5&&h<6?e=h+1:h>=6&&h<7?e=h-3:e=h}}break}return e===a.directions&&(e=0),e}function Re(a,b){return vb(b,0,a.directions)}function hl(a,b,c,d=!1){let e=c.x-b.x,f=c.y-b.y,g;return d?g=Math.abs(e)+Math.abs(f):g=Math.sqrt(e*e+f*f),g}function Ne(a,b=[]){if(!(b.length===a))if(b.length<a)for(let c=b.length;c<a;c++)b.push({x:0,y:0});else b.length=a;return b}function Ue(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=dq);let e,f;switch(a.mode){case pa.orthogonal:e=b*a.width,f=c*a.height;break;case pa.isometric:e=(b-c)*a._halfWidth,f=(b+c)*a._halfHeight;break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let dq={x:0,y:0};function il(a,b=0,c=0,d=[]){if(typeof b==="object"){let h=b;c=h.y,b=h.x}d===!0&&(d=$p),Ne(4,d);let e,f;({x:e,y:f}=Ue(a,b,c));let g=a._halfWidth,i=a._halfHeight;switch(a.mode){case pa.orthogonal:d[0].x=e+g,d[0].y=f-i,d[1].x=e+g,d[1].y=f+i,d[2].x=e-g,d[2].y=f+i,d[3].x=e-g,d[3].y=f-i;break;case pa.isometric:d[0].x=e+g,d[0].y=f,d[1].x=e,d[1].y=f+i,d[2].x=e-g,d[2].y=f,d[3].x=e,d[3].y=f-i;break}return d}let $p=[];const Kc=[[1,0],[0,1],[-1,0],[0,-1],[1,1],[-1,1],[-1,-1],[1,-1]],nd=Kc;function dl(a){let b={},c,d,e;for(let f in a)c=a[f],d=c[0],e=c[1],b.hasOwnProperty(d)||(b[d]={}),b[d][e]=parseInt(f);return b}const el=dl(Kc),fl=dl(nd);function jl(a,b,c){let d;switch(a.mode){case pa.orthogonal:d=el;break;case pa.isometric:d=fl;break}let e=c.x-b.x,f=c.y-b.y;if(d.hasOwnProperty(e)){let g=d[e];if(g.hasOwnProperty(f))return g[f]}return null}function Ve(a,b,c,d,e={x:0,y:0}){e===!0&&(e=cq);let f,g;switch(a.mode){case pa.orthogonal:f=Kc[c][0],g=Kc[c][1];break;case pa.isometric:f=nd[c][0],g=nd[c][1];break}return d===1?(e.x=b.x+f,e.y=b.y+g):(e.x=b.x+d*f,e.y=b.y+d*g),e}let cq={x:0,y:0};function kl(a,b,c,d={x:0,y:0}){return Ve(a,b,c,1,d)}function ll(a,b,c,d){return aq[d]}const aq={0:2,1:3,2:0,3:1,4:6,5:7,6:4,7:5};function ml(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=bq),b-=a.x,c-=a.y;let e=b/a.width,f=c/a.height;switch(a.mode){case pa.orthogonal:d.x=Math.round(e),d.y=Math.round(f);break;case pa.isometric:d.x=Math.round(+e+f),d.y=Math.round(-e+f);break}return d}let bq={x:0,y:0};function nl(a,b,c,d={x:0,y:0}){return typeof c==="string"&&(c=gc[c]),d===!0&&(d=eq),d.x=c&1?-b.x:b.x,d.y=c&2?-b.y:b.y,d}let eq={x:0,y:0};function ic(a,b,c,d,e={x:0,y:0}){e===!0&&(e=fq);let f=b.x+c,g=b.y+d;return e.x=f,e.y=g,e}let fq={x:0,y:0};function pl(a,b,c,d=[]){let e,f;for(e=c,f=-c;f<=c;f++)d.push(ic(a,b,e,f));for(f=c,e=c-1;e>=-c;e--)d.push(ic(a,b,e,f));for(e=-c,f=c-1;f>=-c;f--)d.push(ic(a,b,e,f));for(f=-c,e=-c+1;e<=c-1;e++)d.push(ic(a,b,e,f));return d}function ql(a,b,c,d={x:0,y:0}){d===!0&&(d=kq),c=vb(c,0,3);let e,f;switch(c){case 1:e=-b.y,f=b.x;break;case 2:e=-b.x,f=-b.y;break;case 3:e=b.y,f=-b.x;break;default:e=b.x,f=b.y;break}return d.x=e,d.y=f,d}let kq={x:0,y:0};function Se(a){a._savedOriginX=a.x,a._savedOriginY=a.y}function Te(a){a.x=a._savedOriginX,a.y=a._savedOriginY}class cl extends ol{get sides(){return 4}get allDirections(){return this.directions===4?gq:hq}get halfDirections(){return this.directions===4?iq:jq}directionBetween(a,b,c=!0){return gl(this,a,b,c)}directionNormalize(a){return Re(this,a)}getDistance(a,b,c=!1){return hl(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return il(this,a,b,c)}getNeighborTileDirection(a,b){return jl(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return kl(this,a,b,c)}getOppositeDirection(a,b,c){return ll(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return ml(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return Ve(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return Ue(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return nl(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return ic(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return pl(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return ql(this,a,b,c)}restoreOrigin(){return Te(this),this}saveOrigin(){return Se(this),this}}const gq=[0,1,2,3],hq=[0,1,2,3,4,5,6,7],iq=[0,1],jq=[0,1,4,5];var da;(function(a){a[a.ODD_R=0]="ODD_R",a[a.EVEN_R=1]="EVEN_R",a[a.ODD_Q=2]="ODD_Q",a[a.EVEN_Q=3]="EVEN_Q"})(da||(da={}));var jb;(function(a){a[a.y=0]="y",a[a.flat=0]="flat",a[a.x=1]="x",a[a.pointy=1]="pointy"})(jb||(jb={}));var Kb;(function(a){a[a.even=0]="even",a[a.odd=1]="odd"})(Kb||(Kb={}));class Xk{constructor({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=jb.x,staggerIndex:g=Kb.odd}={}){this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e)}fromJSON({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=jb.x,staggerIndex:g=Kb.odd}={}){return this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e),this}toJSON(){return{x:this.x,y:this.y,radius:this.radius,cellWidth:this.cellWidth,cellHeight:this.cellHeight,staggerAxis:this.staggerAxis,staggerIndex:this.staggerIndex}}setOriginPosition(a,b){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this.radius=void 0,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setRadius(a=0){let b,c;return this.staggerAxis===jb.y?(b=2*a,c=bl*a):(b=bl*a,c=2*a),this.setCellSize(b,c),this.radius=a,this}setDirectionMode(){return this.directions=6,this}setType(a=1,b=1){return typeof a==="string"&&(a=jb[a]),typeof b==="string"&&(b=Kb[b]),this.staggerAxis=a,this.staggerIndex=b,a===jb.y?this.mode=b===Kb.even?da.EVEN_Q:da.ODD_Q:this.mode=b===Kb.even?da.EVEN_R:da.ODD_R,this}}const bl=Math.sqrt(3);function Va(a,b,c,d={x:0,y:0,z:0}){d===!0&&(d=Zg);switch(a){case da.ODD_R:d.x=b-(c-(c&1))/2,d.z=c;break;case da.EVEN_R:d.x=b-(c+(c&1))/2,d.z=c;break;case da.ODD_Q:d.x=b,d.z=c-(b-(b&1))/2;break;case da.EVEN_Q:d.x=b,d.z=c-(b+(b&1))/2;break}return d.y=-d.x-d.z,d}function Lk(a,b,c,d={x:0,y:0,z:0}){typeof a!=="number"&&(d=a,a=d.x,b=d.y,c=d.z),d===!0&&(d=Zg);let e=Math.round(a),f=Math.round(b),g=Math.round(c),i=Math.abs(e-a),h=Math.abs(f-b),k=Math.abs(g-c);return i>h&&i>k?e=-f-g:h>k?f=-e-g:g=-e-f,d.x=e,d.y=f,d.z=g,d}function Ea(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Mp);switch(a){case da.ODD_R:e.x=b+(d-(d&1))/2,e.y=d;break;case da.EVEN_R:e.x=b+(d+(d&1))/2,e.y=d;break;case da.ODD_Q:e.x=b,e.y=d+(b-(b&1))/2;break;case da.EVEN_Q:e.x=b,e.y=d+(b+(b&1))/2;break}return e}function Mk(a,b,c={x:0,y:0,z:0}){return c===!0&&(c=Zg),c.x=a,c.y=-a-b,c.z=b,c}let Zg={x:0,y:0,z:0},Mp={x:0,y:0};function Ok(a,b,c,d=!0){let e;Va(a.mode,b.x,b.y,Je),Va(a.mode,c.x,c.y,Ke);let f=Ke.x-Je.x,g=Ke.y-Je.y,i=Ke.z-Je.z;return i===0?e=f>0?0:3:f===0?e=i>0?1:4:g===0?e=i>0?2:5:f>0&&g<0&&i>0?e=0+i/-g:f<0&&g<0&&i>0?e=1+-g/i:f<0&&g>0&&i>0?e=2+g/-f:f<0&&g>0&&i<0?e=3+-i/g:f>0&&g>0&&i<0?e=4+f/-i:e=5+-g/f,d&&(e=Math.round(e)),e}let Je={x:0,y:0,z:0},Ke={x:0,y:0,z:0};function Pk(a,b,c,d=!1){Va(a.mode,b.x,b.y,Le),Va(a.mode,c.x,c.y,Me);let e=Me.x-Le.x,f=Me.y-Le.y,g=Me.z-Le.z;return(Math.abs(e)+Math.abs(f)+Math.abs(g))/2}let Le={x:0,y:0,z:0},Me={x:0,y:0,z:0};function Oe(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Vp);let e=b*a.width,f=c*a.height;switch(a.mode){case da.ODD_R:c&1&&(e+=a._halfWidth),f*=.75;break;case da.EVEN_R:c&1&&(e-=a._halfWidth),f*=.75;break;case da.ODD_Q:e*=.75,b&1&&(f+=a._halfHeight);break;case da.EVEN_Q:e*=.75,b&1&&(f-=a._halfHeight);break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let Vp={x:0,y:0};function Qk(a,b=0,c=0,d=[]){if(typeof b==="object"){let g=b;c=g.y,b=g.x}d===!0&&(d=Rp),Ne(6,d);let e,f;({x:e,y:f}=Oe(a,b,c));if(a.radius!==void 0){let g=a.radius,i=a.staggerAxis===jb.flat?0:-30;for(let h=0;h<6;h++){let k=60*h+i,n=Ib(k);d[h].x=e+g*Math.cos(n),d[h].y=f+g*Math.sin(n)}}else{let g=a._halfWidth,i=g/2,h=a._halfHeight,k=h/2;a.staggerAxis===jb.flat?(d[0].x=e+g,d[0].y=f,d[1].x=e+i,d[1].y=f+h,d[2].x=e-i,d[2].y=f+h,d[3].x=e-g,d[3].y=f,d[4].x=e-i,d[4].y=f-h,d[5].x=e+i,d[5].y=f-h):(d[0].x=e+g,d[0].y=f-k,d[1].x=e+g,d[1].y=f+k,d[2].x=e,d[2].y=f+h,d[3].x=e-g,d[3].y=f+k,d[4].x=e-g,d[4].y=f-k,d[5].x=e,d[5].y=f-h)}return d}let Rp=[];const Np=[[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]]],Op=[[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]],[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]]],Pp=[[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]],[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]]],Qp=[[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]],[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]]],db=[Np,Op,Pp,Qp];function Jb(a){let b={},c,d;for(let e in a)[c,d]=a[e],b.hasOwnProperty(c)||(b[c]={}),b[c][d]=parseInt(e);return b}const Nk=[[Jb(db[0][0]),Jb(db[0][1])],[Jb(db[1][0]),Jb(db[1][1])],[Jb(db[2][0]),Jb(db[2][1])],[Jb(db[3][0]),Jb(db[3][1])]];function Pe(a,b,c){let d;switch(a){case da.ODD_R:case da.EVEN_R:d=c&1;break;case da.ODD_Q:case da.EVEN_Q:d=b&1;break}return d}function Rk(a,b,c){let d=a.mode,e=Pe(d,b.x,b.y),f=Nk[d][e],g=c.x-b.x,i=c.y-b.y;if(f.hasOwnProperty(g)){let h=f[g];if(h.hasOwnProperty(i))return h[i]}return null}function Qe(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Up);let f=a.mode,g=b.x,i=b.y;if(d===1){let h=Pe(f,g,i);e.x=g+db[f][h][c][0],e.y=i+db[f][h][c][1]}else if(d===0)e.x=g,e.y=i;else{let h=Va(f,g,i,!0),k,n,o;switch(c){case 1:k=h.x,n=h.y-d,o=h.z+d;break;case 2:k=h.x-d,n=h.y,o=h.z+d;break;case 3:k=h.x-d,n=h.y+d,o=h.z;break;case 4:k=h.x,n=h.y+d,o=h.z-d;break;case 5:k=h.x+d,n=h.y,o=h.z-d;break;default:k=h.x+d,n=h.y-d,o=h.z;break}Ea(f,k,n,o,e)}return e}let Up={x:0,y:0};function Sk(a,b,c,d={x:0,y:0}){return Qe(a,b,c,1,d)}function Tk(a,b,c,d){return(d+3)%6}const Uk=4/3,Vk=2/3;function Wk(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Tp),b-=a.x,c-=a.y;let e,f;switch(a.mode){case da.ODD_R:case da.EVEN_R:f=c*Uk/a.height,e=b/a.width-Vk*(c/a.height);break;case da.ODD_Q:case da.EVEN_Q:f=c/a.height-Vk*(b/a.width),e=b*Uk/a.width;break}let g=Mk(e,f,Sp);return Lk(g),Ea(a.mode,g.x,g.y,g.z,d),d}let Sp={x:0,y:0,z:0},Tp={x:0,y:0};function Yk(a,b,c,d={x:0,y:0}){typeof c==="string"&&(c=gc[c]),d===!0&&(d=Yp);let e=Va(a.mode,b.x,b.y,!0),f=a.mode===da.ODD_R||a.mode===da.EVEN_R,g,i,h;return c&1&&(f?(g=e.y,i=e.x,h=e.z):(g=-e.x,i=-e.z,h=-e.y),e.x=g,e.y=i,e.z=h),c&2&&(f?(g=-e.y,i=-e.x,h=-e.z):(g=e.x,i=e.z,h=e.y)),Ea(a.mode,g,i,h,d),d}let Yp={x:0,y:0};function Zk(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Zp);let f=b.x+c,g=b.y+d;switch(a.mode){case da.ODD_R:(d&1)!==0&&((g&1)===0&&(f+=1));break;case da.EVEN_R:(d&1)!==0&&((g&1)===0&&(f-=1));break;case da.ODD_Q:(c&1)!==0&&((f&1)==0&&(g+=1));break;case da.EVEN_Q:(c&1)!==0&&((f&1)==0&&(g-=1));break}return e.x=f,e.y=g,e}let Zp={x:0,y:0};function _k(a,b,c,d=[]){let e=Va(a.mode,b.x,b.y,!0),f=e.x,g=e.y,i=e.z,h,k,n;for(n=c,h=0;h>=-c;h--)k=-h-n,d.push(Ea(a.mode,f+h,g+k,i+n));for(h=-c,k=1;k<=c;k++)n=-h-k,d.push(Ea(a.mode,f+h,g+k,i+n));for(k=c,n=-1;n>=-c;n--)h=-k-n,d.push(Ea(a.mode,f+h,g+k,i+n));for(n=-c,h=1;h<=c;h++)k=-h-n,d.push(Ea(a.mode,f+h,g+k,i+n));for(h=c,k=-1;k>=-c;k--)n=-h-k,d.push(Ea(a.mode,f+h,g+k,i+n));for(k=-c,n=1;n<=c-1;n++)h=-k-n,d.push(Ea(a.mode,f+h,g+k,i+n));return d}function $k(a,b,c,d={x:0,y:0}){d===!0&&(d=_p),c=vb(c,0,5);let e=Va(a.mode,b.x,b.y,!0),f,g,i;switch(c){case 1:f=-e.z,g=-e.x,i=-e.y;break;case 2:f=e.y,g=e.z,i=e.x;break;case 3:f=-e.x,g=-e.y,i=-e.z;break;case 4:f=e.z,g=e.x,i=e.y;break;case 5:f=-e.y,g=-e.z,i=-e.x;break;default:f=e.x,g=e.y,i=e.z;break}return Ea(a.mode,f,g,i,d),d}let _p={x:0,y:0};class al extends Xk{get sides(){return 6}get allDirections(){return Wp}get halfDirections(){return Xp}directionBetween(a,b,c=!0){return Ok(this,a,b,c)}directionNormalize(a){return Re(this,a)}getDistance(a,b,c=!1){return Pk(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return Qk(this,a,b,c)}getNeighborTileDirection(a,b){return Rk(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return Sk(this,a,b,c)}getOppositeDirection(a,b,c){return Tk(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return Wk(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return Qe(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return Oe(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return Yk(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return Zk(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return _k(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return $k(this,a,b,c)}restoreOrigin(){return Te(this),this}saveOrigin(){return Se(this),this}}const Wp=[0,1,2,3,4,5],Xp=[0,1,2];var Aa;(function(a){a[a.random=0]="random",a[a.diagonal=1]="diagonal",a[a.straight=2]="straight",a[a.line=3]="line",a[a.astar=10]="astar",a[a["astar-random"]=11]="astar-random",a[a["astar-line"]=12]="astar-line"})(Aa||(Aa={}));const jc=null;class Ko{constructor(a){this.content=[],this.scoreFunction=a}clear(){this.content.length=0}push(a){this.content.push(a),this.sinkDown(this.content.length-1)}pop(){let a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.bubbleUp(0)),a}remove(a){let b=this.content.indexOf(a),c=this.content.pop();b!==this.content.length-1&&(this.content[b]=c,this.scoreFunction(c)<this.scoreFunction(a)?this.sinkDown(b):this.bubbleUp(b))}get size(){return this.content.length}rescoreElement(a){this.sinkDown(this.content.indexOf(a))}sinkDown(a){let b=this.content[a];for(;a>0;){let c=(a+1>>1)-1,d=this.content[c];if(this.scoreFunction(b)<this.scoreFunction(d))this.content[c]=b,this.content[a]=d,a=c;else break}}bubbleUp(a){let b=this.content.length,c=this.content[a],d=this.scoreFunction(c);for(;;){let e=a+1<<1,f=e-1,g=null,i;if(f<b){let h=this.content[f];i=this.scoreFunction(h),i<d&&(g=f)}if(e<b){let h=this.content[e],k=this.scoreFunction(h);k<(g===null?d:i)&&(g=e)}if(g!==null)this.content[a]=this.content[g],this.content[g]=c,a=g;else break}}}let lpa=new Ko(a=>a.f);const Qf=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d=d.prevNodes[0];return c.reverse()};const No=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d.prevNodes.length===1?d=d.prevNodes[0]:d=Ic(d.prevNodes);return c.reverse()};const Mo=function(a,b,c=[]){let d=b,e=b.angleTo(a);for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1)d=d.prevNodes[0];else{let f=Infinity;for(let g=1,i=d.prevNodes.length;g<i;g++){let h=d.prevNodes[g],k=Math.abs(b.angleTo(h)-e);k<f&&(f=k,d=h)}}}return c.reverse()};const Lo=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let i=0,h=d.prevNodes.length;i<h;i++){f=d.prevNodes[i],g=f.logicDirTo(d);if(g!==e)break}e=g,d=f}}return c.reverse()};const Oo=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let i=0,h=d.prevNodes.length;i<h;i++){f=d.prevNodes[i],g=f.logicDirTo(d);if(g===e)break}e=g,d=f}}return c.reverse()};let wc={};wc[Aa.astar]=Qf;wc[Aa["astar-line"]]=Qf;wc[Aa["astar-random"]]=Qf;wc[Aa.random]=No;wc[Aa.line]=Mo;wc[Aa.diagonal]=Lo;wc[Aa.straight]=Oo;class tl{constructor(){this.prevNodes=[]}shutdown(){this.key=void 0,this.prevNodes.length=0}destroy(){this.shutdown()}reset(a){this.key=a,this.f=0,this.g=0,this.h=void 0,this.closerH=void 0,this.visited=!1,this.closed=!1}heuristic(a,b,c){if(b===null)return 0;let d,e=this.distanceTo(a)*this.manager.weight;switch(b){case Aa.astar:d=e;break;case Aa["astar-line"]:if(c!==void 0){let f=a.angleTo(c)-this.angleTo(c);d=e+Math.abs(f)}else d=e;case Aa["astar-random"]:d=e+Math.random();break;default:d=e;break}return d}getNextNodes(){return[]}getCost(a){return jc}distanceTo(a){return 0}angleTo(a){return 0}logicDirTo(a){return 0}getNode(a,b=!1){return this.manager.getNode(a,b)}}function kc(a){for(let b=a.length-1;b>0;b--){let c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a}class uq extends tl{constructor(a){super();this.isTileXYZ=!0;this.pathFinder=a}reset(a){super.reset(a),this.key=a,ul(a,this),this._px=void 0,this._py=void 0,this.cost=void 0}getNextNodes(){let a=ec.GetNeighborTileXY(this.board,this);this.pathFinder.shuffleNeighbors&&kc(a);let b=[];return a.forEach(c=>{let d=this.getNode(Ya(c.x,c.y),!0);b.push(d)}),b}getCost(a){return this.pathFinder.cacheCost?this.cost===void 0&&(this.cost=this.pathFinder.getCost(this,a)):this.cost=this.pathFinder.getCost(this,a),this.cost}distanceTo(a){return cb.GetDistance(this.board,this,a,!0)}angleTo(a){return hc(this.worldX,this.wroldY,a.worldX,a.worldX)}logicDirTo(a){return ec.GetNeighborTileDirection(this.board,this,a)}get board(){return this.pathFinder.board}get worldX(){if(this._px===void 0){let a=Hb.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._px}get wroldY(){if(this._py===void 0){let a=Hb.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._py}}class pq{constructor(){this.data=[];this.visited=new Set()}push(a,b){if(Array.isArray(a)){let d=a;for(let e=0,f=d.length;e<f;e++)this.push(d[e]);return this}if(typeof a==="object"){let d=a;a=d.x,b=d.y}let c=`${a},${b}`;return this.visited.has(c)?this:(this.data.push({x:a,y:b}),this.visited.add(c),this)}pop(){return this.data.pop()}get length(){return this.data.length}clear(){return this.data.length=0,this.visited.clear(),this}}let h1=new pq();var Ie;(function(a){a[a.direction=0]="direction",a[a.angle=1]="angle"})(Ie||(Ie={}));function gj(a,b){return a.events.delete(b),a}function fj(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);let e=d.size;for(const f of d){f.callback.apply(f.context,c),f.once&&d.delete(f),e--;if(e===0)break}return d.size===0&&a.events.delete(b),!0}class Rd{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function ij(a){return[...a.events.keys()]}function hj(a,b){const c=a.events.get(b);return c?c.size:0}function jj(a,b){const c=[],d=a.events.get(b);return d.forEach(e=>{c.push(e.callback)}),c}function ej(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof Rd)g.delete(c);else{const i=!d,h=e!==void 0;for(const k of g)k.callback===c&&(i&&k.context===d)&&(h&&k.once===e)&&g.delete(k)}return g.size===0&&f.delete(b),a}function Qd(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new Rd(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function dj(a,b,c,d=a){return Qd(a,b,c,d,!0)}function Sf(a,b){b?a.events.delete(b):a.events.clear()}function Uo(a){return class extends a{constructor(){super(...arguments);this.events=null}setEventEmitter(b){return this.destroyEventEmitter(),this.privateEE=b===void 0,this.privateEE?this.events=new Map():b?this.events=b.events:this.events=null,this.lastEventInstance=null,this}getEventEmitter(){return this}clearEventEmitter(){return this.setEventEmitter(null),this}destroyEventEmitter(){return this.lastEventInstance=null,this.events&&this.privateEE&&(Sf(this),this.events=null),this}on(b,c,d=this,e=!1){return this.lastEventInstance=null,this.events&&(this.lastEventInstance=Qd(this,b,c,d,e)),this}once(b,c,d=this){return this.lastEventInstance=null,this.events&&(this.lastEventInstance=dj(this,b,c,d)),this}off(b,c,d,e){return this.lastEventInstance=null,this.events&&ej(this,b,c,d,e),this}emit(b,...c){return this.lastEventInstance=null,this.events&&fj(this,b,...c),this}removeAllListeners(b){return this.lastEventInstance=null,this.events&&Sf(this,b),this}clearEvent(b){return this.lastEventInstance=null,this.events&&gj(this,b),this}getListenerCount(b){return this.lastEventInstance=null,this.events?hj(this,b):0}getEventNames(){return this.lastEventInstance=null,this.events?ij(this):[]}getListeners(b){return this.lastEventInstance=null,this.events?jj(this,b):[]}}}const va=Uo(class{});var pb;(function(a){a[a.no=0]="no",a[a.lazy=1]="lazy",a[a.always=2]="always"})(pb||(pb={}));const lj="complete";class Of extends va{constructor(a,{eventEmitter:b,tickingMode:c=pb.lazy}={}){super();this._isRunning=!1;this.tickingState=!1;this.parent=a,this.setEventEmitter(b),this.setTickingMode(c)}boot(){this.tickingMode===pb.always&&!this.tickingState&&this.startTicking()}shutdown(){this.destroyEventEmitter(),this.tickingState&&this.stopTicking()}setTickingMode(a){typeof a==="string"&&(a=pb[a]),this.tickingMode=a}startTicking(){this.tickingState=!0}stopTicking(){this.tickingState=!1}get isRunning(){return this._isRunning}set isRunning(a){if(this._isRunning===a)return;this._isRunning=a,this.tickingMode===pb.lazy&&a!=this.tickingState&&(a?this.startTicking():this.stopTicking())}start(){return this.isRunning=!0,this}pause(){return this.isRunning=!1,this}resume(){return this.isRunning=!0,this}stop(){return this.isRunning=!1,this}complete(a=lj){this.isRunning=!1,this.emit(a,this.parent,this)}}class Mf extends Of{constructor(a,{updater:b=a,isRunning:c=!1,timeScale:d=1,now:e=0,tickingMode:f=pb.lazy}={}){super(a,arguments[1]);this.updater=null;this.timeScale=1;this.now=0;this.parent=a,this.setUpdater(b),this.isRunning=c,this.timeScale=d,this.now=e,this.setTickingMode(f),this.boot()}resetFromJSON({isRunning:a=!1,timeScale:b=1,now:c=0,tickingMode:d=pb.lazy}={}){return this.isRunning=a,this.timeScale=b,this.now=c,this.setTickingMode(d),this}toJSON(){return{isRunning:this.isRunning,timeScale:this.timeScale,now:this.now,tickingMode:this.tickingMode}}boot(){super.boot(),$a(this.parent,"destroy",this.destroy,this)}shutdown(){super.shutdown(),this.parent=void 0,this.updater=void 0}destroy(){this.shutdown()}setUpdater(a){return a instanceof ub&&(a=a.world),a instanceof Td||a instanceof $b?this.updater=a:this.updater=null,this}startTicking(){this.update===null&&this.setUpdater(this.parent);if(this.update===null)return;super.startTicking(),this.updater&&$a(this.updater,"update",this.update,this)}stopTicking(){super.stopTicking(),this.updater&&tb(this.updater,"update",this.update,this)}start(a=0){return this.now=a,super.start(),this}seek(a){return this.now=a,this}update(a){return!this.isRunning||this.timeScale===0?this:(this.now+=a*this.timeScale,this)}}const $qa=Ka(Dg());const ah="receive";const wl={receive:ah};function xl(a,b){(!a.sendToRef||a.sendToRef.key!==a.receiverID)&&(a.sendToRef=a.database.ref(a.rootPath).child(a.receiverID));if(b===void 0)return a.sendToRef.remove();let c={message:b,senderID:a.userID,stamp:a.stamp};return a.userName!==void 0&&(c.senderName=a.userName),a.skipFirst=!1,a.stamp=!a.stamp,a.sendToRef.set(c)}function yl(a){if(a.isReceiving&&a.receiverRef.key===a.receiverID)return;$g(a),a.isReceiving=!0,a.skipFirst=!0,a.receiverRef=a.database.ref(a.rootPath).child(a.receiverID),a.receiverRef.on("value",Al,a),a.receiverRef.onDisconnect().remove()}function $g(a){if(!a.isReceiving)return;a.isReceiving=!1,a.receiverRef.off("value",Al,a),a.receiverRef.remove(),a.receiverRef.onDisconnect().cancel()}function Al(a){if(this.skipFirst){this.skipFirst=!1;return}let b=a.val();if(b==null)return;delete b.stamp,this.history.add(b),this.emit(this.eventNames.receive,b)}class zl{constructor({maxLength:a=-1}={}){this.maxLength=a,this.records=[]}add(a){return this.maxLength===0?this:(this.records.push(a),this.maxLength>0&&this.records.length>this.maxLength&&this.records.shift(),this)}clear(){return this.records.length=0,this}changeUserName(a,b){return this.maxLength===0?this:(this.records.forEach(c=>{c.senderID===a&&(c.senderName=b)}),this)}}const m4=Ka(Ra());class Mc extends va{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d,receiverID:e="",history:f=0,eventNames:g=wl}={}){super();this.setEventEmitter(a),this.eventNames=g,this.database=m4.database(),this.setRootPath(b),this.skipFirst=!0,this.stamp=!1,this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.isReceiving=!1,f===!0?f=-1:f===!1&&(f=0),this.history=new zl({maxLength:f})}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.sendToRef=void 0,this.receiverRef=void 0,this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.receiverID=a,this}changeUserName(a,b){return a===this.userID&&(this.userName=b),this.history.changeUserName(a,b),this}getHistory(){return this.history.records}clearHistory(){return this.history.clear(),this}send(a){return xl(this,a)}startReceiving(){return yl(this),this}stopReceiving(){return $g(this),this}}const Ur="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function bf(a,b,c=Ur){let d=b===void 0?a:kd(a,b),e="";for(let f=0;f<d;f++)e+=Ic(Array.from(c));return e}const yca=Ka(Ra());var ra;(function(a){a[a["1d"]=1]="1d",a[a["2d"]=2]="2d",a[a["3d"]=3]="3d"})(ra||(ra={}));const hh="init";const ih="update";const bh="addkey0";const ch="addkey1";const dh="addkey2";const jh="removekey0";const kh="removekey1";const lh="removekey2";const eh="changekey0";const fh="changekey1";const gh="changekey2";const Bl={init:hh,update:ih,addkey0:bh,removekey0:jh,changekey0:eh,addkey1:ch,removekey1:kh,changekey1:fh,addkey2:dh,removekey2:lh,changekey2:gh};function Xo(a){return a==null||a===""||a.length===0}function Tr(a,b,c={}){let d=a;if(!Xo(b)){typeof b==="string"&&(b=b.split("."));let e;for(let f=0,g=b.length;f<g;f++){e=b[f];if(d[e]==null||typeof d[e]!=="object"){let i;f===g-1?i=c:i={},d[e]=i}d=d[e]}}return d}function Yo(a,b,c){if(typeof a!=="object")return;if(Xo(b)){if(c==null)return;typeof c==="object"&&(a=c)}else{typeof b==="string"&&(b=b.split("."));let d=b.pop(),e=Tr(a,b);e[d]=c}return a}function Wo(a){return JSON.parse(JSON.stringify(a))}class Cl{constructor(){this.data={}}setValue(a,b){return a==null?this.clear():typeof a==="object"?this.data=a:Yo(this.data,a,b),this}getValue(a){if(a==null)return this.data;{typeof a==="string"&&(a=a.split("."));let b=this.data;for(let c=0,d=a.length;c<d;c++){if(!kj(b))return;b=b[a[c]]}return b}}cloneValue(a){return Wo(this.getValue(a))}removeKey(a){if(a==null)this.clear();else{typeof a==="string"&&(a=a.split("."));let b=a.pop(),c=this.data;for(let d=0,e=a.length;d<e;d++){if(!kj(c))return this;c=c[a[d]]}kj(c)&&delete c[b]}return this}clear(){return Tf(this.data),this}incValue(a,b=1){let c=this.getValue(a);return typeof c!=="number"&&(c=0),this.setValue(a,c+b),this}mulValue(a,b){let c=this.getValue(a);return typeof c!=="number"&&(c=1),this.setValue(a,c*b),this}}function kj(a){return a!=null&&typeof a==="object"}const D5=Ka(Ra());class lc extends va{constructor({eventEmitter:a,parent:b,key:c,type:d,eventNames:e,table:f}={}){super();this.setEventEmitter(a),this.parent=b,this.children=new Map(),this.key=c,this.parent?this.fullKeyPath=Ml(this.parent.fullKeyPath,this.key):this.fullKeyPath="",this.type=d,this.eventNames=e,this.table=f,this.database=D5.database(),this.setRootPath()}destroy(){this.stopUpdate().clear().destroyEventEmitter()}setRootPath(a){if(a===void 0){let b=this.parent?this.parent.rootPath:"";a=`${b}/${this.key}`}this.rootPath=a,this.rootRef=a!==""?this.database.ref(a):void 0;for(const[b,c]of this.children)c instanceof lc&&c.setRootPath();return this}setData(a,b){if(arguments.length===0)this.clear();else if(typeof a=="string")this.setChildData(a,b);else{let c=a;for(const[d,e]of this.children)c.hasOwnProperty(d)||this.removeChild(d);for(let d in c)this.setChildData(d,c[d])}return this}clear(){this.table.removeKey(this.fullKeyPath);for(const[a,b]of this.children)this.removeChild(a);return this}get childClass(){return null}setChildData(a,b){const c=Ml(this.fullKeyPath,a);this.table.setValue(c,b);if(!(typeof b!=="object")){if(this.children.has(a))this.children.get(a).setData(b);else if(this.childClass){let d=new this.childClass({parent:this,key:a,type:this.type,eventEmitter:this.eventEmitter,eventNames:this.eventNames,table:this.table});d.startUpdate(),this.children.set(a,d)}}return this}removeChild(a){return this.children.has(a)&&(this.children.get(a).destroy(),this.children.delete(a)),this}startUpdate(){return this}stopUpdate(){return this}}function Ml(a,b){return a==null||a===""?b:b==null||b===""?a:`${a}.${b}`}class od extends lc{startUpdate(){return this.rootRef.on("child_added",this.addCol,this),this.rootRef.on("child_removed",this.removeCol,this),this.rootRef.on("child_changed",this.changeColValue,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addCol,this),this.rootRef.off("child_removed",this.removeCol,this),this.rootRef.off("child_changed",this.changeColValue,this),this}addCol(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["1d"]:this.emit(this.eventNames.addkey0,b,c);break;case ra["2d"]:this.emit(this.eventNames.addkey1,this.key,b,c);break;default:this.emit(this.eventNames.addkey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}removeCol(a){const b=a.key;this.removeChild(b);switch(this.type){case ra["1d"]:this.emit(this.eventNames.removekey0,b);break;case ra["2d"]:this.emit(this.eventNames.removekey1,this.key,b);break;default:this.emit(this.eventNames.removekey2,this.pageKey,this.key,b);break}this.emit(this.eventNames.update,this.table.data)}changeColValue(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["1d"]:this.emit(this.eventNames.changekey0,b,c);break;case ra["2d"]:this.emit(this.eventNames.changekey1,this.key,b,c);break;default:this.emit(this.eventNames.changekey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}get pageKey(){return this.parent.key}}class pd extends lc{startUpdate(){return this.rootRef.on("child_added",this.addRow,this),this.rootRef.on("child_removed",this.removeRow,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addRow,this),this.rootRef.off("child_removed",this.removeRow,this),this}addRow(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["2d"]:this.emit(this.eventNames.addkey0,b,c);break;default:this.emit(this.eventNames.addkey1,this.key,b,c);break}}removeRow(a){const b=a.key;this.removeChild(b);switch(this.type){case ra["2d"]:this.emit(this.eventNames.removekey0,b);break;default:this.emit(this.eventNames.removekey1,this.key,b);break}}get childClass(){return od}}class mh extends lc{startUpdate(){return this.rootRef.on("child_added",this.addPage,this),this.rootRef.on("child_removed",this.removePage,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addPage,this),this.rootRef.off("child_removed",this.removePage,this),this}addPage(a){const b=a.key,c=a.val();this.setData(b,c),this.emit(this.eventNames.addkey0,b,c)}removePage(a){const b=a.key;this.removeChild(b),this.emit(this.eventNames.removekey0,b)}get childClass(){return pd}}const Ze={};Ze[ra["1d"]]=od;Ze[ra["2d"]]=pd;Ze[ra["3d"]]=mh;function Dl(a){return new Ze[a.tableType]({type:a.tableType,eventEmitter:a.eventEmitter,eventNames:a.eventNames,table:a.table})}function El(a){return a.updater.clear(),a.initialFlag=!1,a.rootRef.once("value").then(function(b){let c=b.val()??{};return a.table.setValue(c),a.emit(a.eventNames.init,c),a.initialFlag=!0,Promise.resolve(c)})}function Ja(a,b,c,d){let e=a.rootRef;return e=b?e.child(b):e,e=c?e.child(c):e,e=d?e.child(d):e,e}function Fl(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ja(a,c,d,e).set(f)}function Gl(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;default:c=b[0];break}return Ja(a,c,d,e).remove()}function Hl(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ja(a,c,d,e).transaction(function(g){return g===null&&(g=0),g+f})}function Il(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ja(a,c,d,e).transaction(f)}function Jl(a,b){return Ja(a).update(b)}function Kl(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;case 1:c=b[0];break}return Ja(a,c,d,e).onDisconnect().remove()}function Ll(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ja(a,c,d,e).onDisconnect().set(f)}const G4=Ka(Ra());class Nc extends va{constructor({eventEmitter:a,root:b="",type:c=ra["3d"],eventNames:d=Bl}={}){super();this.setEventEmitter(a),this.eventNames=d,this.database=G4.database(),this.table=new Cl(),this.setTableType(c),this.setRootPath(b),this.initialFlag=!1}destroy(){this.updater.destroy(),this.destroyEventEmitter().stopUpdate()}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):null,this.updater.setRootPath(a),this}setTableType(a){return typeof a==="string"&&(a=ra[a]),this.tableType=a,this.updater&&this.updater.destroy(),this.updater=Dl(this),this}startUpdate(){return El(this),this.updater.startUpdate(),this}stopUpdate(){return this.updater.stopUpdate(),this}clear(){return this.updater.clear(),this}getData(){return this.table.getValue(...arguments)}cloneData(){return this.table.cloneValue(...arguments)}getItemRef(a,b,c){return Ja(this,a,b,c)}setData(...a){return Fl(this,...a)}removeData(...a){return Gl(this,...a)}incValue(...a){return Hl(this,...a)}transaction(...a){return Il(this,...a)}updateData(a){return Jl(this,a)}removeDataOnDisconnect(...a){return Kl(this,...a)}setDataOnDisconnect(...a){return Ll(this,...a)}}const Iba=Ka(Ra());var ki;(function(a){a.d="d",a.w="w",a.m="m",a.y="y",a.day="d",a.week="w",a.month="m",a.year="y"})(ki||(ki={}));var yd;(function(a){a.d="tagD",a.w="tagW",a.m="tagM",a.y="tagY"})(yd||(yd={}));var zd;(function(a){a.d="scoreD",a.w="scoreW",a.m="scoreM",a.y="scoreY"})(zd||(zd={}));var Tm;(function(a){a.d="day",a.w="week",a.m="month",a.y="year"})(Tm||(Tm={}));function oi({query:a,totalLines:b=Infinity,linesPerPage:c=1e3,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g}){return kn({query:a,remainderLines:b,linesPerPage:c,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g})}function kn(a){let b=a.query;a.startDocRef&&(b=b[a.startMode](a.startDocRef));let c=Math.min(a.remainderLines,a.linesPerPage);return a.remainderLines-=c,b.limit(c).get().then(function(d){let e=a.remainderLines===0||d.size<c,f=!1;a.forEachPageCallback&&(f=a.forEachPageCallback(d)||!1),e=e||f;if(e){let g;return a.resolveCallback&&(g=a.resolveCallback()),Promise.resolve(g)}else return a.startDocRef=d.docs[d.size-1],a.startMode="startAfter",kn(a)})}function Pa(a,b=Infinity,c=0,d,e){let f=[],g=0;return oi({query:a,totalLines:c+b,startDocRef:d,startMode:e,forEachPageCallback:function(i){let h,k=i.size,n=c-g;n<=0?h=i.docs:n<k&&(h=i.docs.slice(n,k)),h&&f.push(...h),g+=k},resolveCallback:function(){return f}})}const Nea=Ka(Ra());function an(a,b,c=0){return Pa(a.nextQuery,b,c,a.baselineDocRef,a.baselineMode).then(function(d){let e=d.length;return a.cacheItems=d,a.pageIndex=void 0,a.startItemIndex=c,a.endItemIndex=a.startItemIndex+e-1,a.isFullPage=b===void 0?!0:e===b,Promise.resolve(a.cacheItems)})}const lea=Ka(Ra());class qf{constructor({query:a={next:void 0,previous:void 0},itemCount:b=100,baselineDoc:c,baselineMode:d="startAt"}={}){this.setQuery(a),this.setItemCount(b),this.setBaselineDoc(c,d),this.pageIndex=void 0,this.baselineDocRef=void 0,this.baselineMode="startAt",this.startItemIndex=void 0,this.endItemIndex=void 0,this.cacheItems=void 0,this.isFullPage=void 0}setQuery(a,b){if(a instanceof lea.firestore.Query)this.nextQuery=a,this.prevQuery=b;else{var c=a;this.nextQuery=c.next,this.prevQuery=c.previous}return this.pageIndex=null,this.isFullPage=!0,this}setItemCount(a){return this.itemCount=a,this}setBaselineDoc(a,b){return a?(this.baselineDocRef=a.ref,this.baselineMode=b):this.baselineDocRef=void 0,this}load(a,b=0){return an(this,a,b)}loadFirstPage(){return this._loadFirstPage()}loadNextPage(){return this.pageIndex==null?this._loadFirstPage():this._loadNextPage()}loadPreviousPage(){return this.pageIndex==null||this.pageIndex===1?this._loadFirstPage():this._loadPreviousPage()}loadCurrentPage(){return this.pageIndex==null||this.pageIndex===0?this._loadFirstPage():this._loadCurrentPage()}}function gn(a){return Pa(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=null,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function bn(a){return Pa(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,Promise.resolve(a.cacheItems)})}function hn(a){return Pa(a.nextQuery,a.itemCount,0,a.currPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=a.currPageEndDocRef,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function cn(a){let b=(a.pageIndex+1)*a.itemCount;return Pa(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function jn(a){return Pa(a.prevQuery,a.itemCount+1,0,a.currPageStartDocRef,"startAfter").then(function(b){let c=b.length-1;return a.cacheItems=b,a.cacheItems.pop(),a.cacheItems.reverse(),a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-c+1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=b[c].ref,a.currPageStartDocRef=b[c-1].ref,a.currPageEndDocRef=b[0].ref,Promise.resolve(a.cacheItems)})}function dn(a){let b=(a.pageIndex-1)*a.itemCount;return Pa(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-d+1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function fn(a){return Pa(a.nextQuery,a.itemCount,0,a.prevPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function en(a){let b=a.pageIndex*a.itemCount;return Pa(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}class li extends qf{_loadFirstPage(){return bn(this)}_loadNextPage(){return cn(this)}_loadPreviousPage(){return dn(this)}_loadCurrentPage(){return en(this)}}const lda=Ka(Ra());class pf extends qf{_loadFirstPage(){return gn(this)}_loadNextPage(){return hn(this)}_loadPreviousPage(){return jn(this)}_loadCurrentPage(){return fn(this)}}const eea=Ka(Ra());function Vm(a,b){let c={senderID:a.userID,message:b,timestamp:eea.firestore.FieldValue.serverTimestamp()};return a.userName!==void 0&&(c.senderName=a.userName),a.receiverID!==void 0&&(c.receiverID=a.receiverID),a.rootRef.add(c)}function mi(a,b=a.receiverID){let c=a.rootRef;return c=b!==void 0?c.where("receiverID","==",b):c,c}function Um(a,b=a.receiverID){let c=mi(a,b),d=c.orderBy("timestamp"),e=c.orderBy("timestamp","desc");return{next:d,previous:e}}const ni="receive";function Wm(a){let b=mi(a).orderBy("timestamp","desc").limit(1);a.unsubscribe=b.onSnapshot({includeMetadataChanges:!0},function(c){if(c.size>0){let d=c.docs[0];if(d.metadata.hasPendingWrites){a.skipFirst&&(a.skipFirst=!1);return}_m(a,a.receiverID,d);if(a.skipFirst)a.skipFirst=!1;else{let e=$m(d);a.cacheMessages.push(e),a.emit(ni,e)}}else a.skipFirst&&(a.skipFirst=!1)},function(c){debugger})}function Xm(a){a.unsubscribe&&a.unsubscribe(),a.resetQueryFlag=!0,a.cacheMessages.length=0}function Ym(a){return _m(a),a.page.loadNextPage().then(function(b){let c=[];for(let d=0,e=b.length;d<e;d++)c.push($m(b[d]));return a.cacheMessages.splice(0,0,...c),Promise.resolve(c)})}function _m(a,b=a.receiverID,c){if(!a.resetQueryFlag)return;a.resetQueryFlag=!1;let d=a.skipFirst?"startAt":"startAfter";a.page.setBaselineDoc(c,d).setQuery(Um(a,b));return}function $m(a){let b=a.data();return b.timestamp=b.timestamp.toDate(),b}const Xda=Ka(Ra());class Zm extends va{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d="",receiverID:e,pageItemCount:f=100}={}){super();this.setEventEmitter(a),this.database=Xda.firestore(),this.setRootPath(b),this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.skipFirst=!0,this.unsubscribe=void 0,this.page=new pf(),this.setPageItemCount(f),this.resetQueryFlag=!0,this.cacheMessages=[]}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.resetQueryFlag=this.resetQueryFlag||this.rootPath!==a,this.rootPath=a,this.rootRef=this.database.collection(a),this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.resetQueryFlag=this.resetQueryFlag||this.receiverID!==a,this.receiverID=a,this}setPageItemCount(a){return this.page.setItemCount(a),this}get hasPreviousMessage(){return this.page.isFullPage!==!1}send(a){return Vm(this,a)}startReceiving(){return Wm(this),this}stopReceiving(){return Xm(this),this}loadPreviousMessages(){return Ym(this)}}const qh="join";const rh="leave";const th="init";const sh="update";const ph="changename";const oh="change";const Rl={join:qh,leave:rh,update:sh,change:oh,init:th,changename:ph};var zb;(function(a){a[a.once=0]="once",a[a.child=1]="child",a[a.all=2]="all"})(zb||(zb={}));const bi="add";const di="remove";const ci="change";const ei="update";const Jm={add:bi,remove:di,update:ei,change:ci};function nf(a){a.items.length=0,a.itemID2Index.clear()}function Km(a){return a.items}function Lm(a,b){return a.itemID2Index.has(b)}function ai(a,b){return b==null?null:a.itemID2Index.get(b)}function Mm(a,b){if(b==null)return null;let c=ai(a,b);return c==null?null:a.items[c]}function Nm(a,b,c){a.items.forEach(b,c)}function Pb(a){a.itemID2Index.clear();let b=a.items;for(var c=0,d=b.length;c<d;c++){let e=b[c][a.keyItemID];a.itemID2Index.set(e,c)}}function fi(a,b){let c=hi.call(this,a,b);Pb(this),this.emit(this.eventNames.add,c),this.emit(this.eventNames.update,this.items)}function wd(a,b){let c=Om.call(this,a);Pb(this);let d=hi.call(this,a,b);Pb(this),this.emit(this.eventNames.change,d,c),this.emit(this.eventNames.update,this.items)}function gi(a){let b=Om.call(this,a);Pb(this),this.emit(this.eventNames.remove,b),this.emit(this.eventNames.update,this.items)}function xd(a){nf(this),a.forEach(function(b){hi.call(this,b,null,!0)}.bind(this)),Pb(this),this.emit(this.eventNames.update,this.items)}function hi(a,b,c=!1){let d,e=this.getItemCallback,f=this.getItemCallbackScope;f?d=e.call(f,a):d=e(a);if(c)return this.items.push(d),d;if(b==null)this.items.unshift(d);else{let g=this.itemID2Index.get(b);g===this.items.length-1?this.items.push(d):this.items.splice(g+1,0,d)}return d}function Om(a){let b=this.itemID2Index.get(a.key),c=vd(this.items,b);return c}const Rm={start(a,b){a.isUpdating=!1,b.once("value",xd,a)},stop(a){}};const Qm={start(a,b){b.on("child_added",fi,a),b.on("child_removed",gi,a),b.on("child_moved",wd,a),b.on("child_changed",wd,a)},stop(a){a.query.off("child_added",fi,a),a.query.off("child_removed",gi,a),a.query.off("child_moved",wd,a),a.query.off("child_changed",wd,a)}};const Pm={start(a,b){b.on("value",xd,a)},stop(a){a.query.off("value",xd,a)}};const ud={};ud[zb.all]=Pm;ud[zb.child]=Qm;ud[zb.once]=Rm;class mc extends va{constructor({eventEmitter:a,itemIDKey:b="__itemID__",mode:c=zb.child,getItemCallback:d=Qq,getItemCallbackScope:e,query:f,eventNames:g=Jm}={}){super();this.setEventEmitter(a),this.eventNames=g,this.isUpdating=!1,this.items=[],this.itemID2Index=new Map(),this.setItemIDKey(b),this.setMode(c),e===void 0&&(e=this),this.setGetitemCallback(d,e),this.setQuery(f)}destroy(){this.stopUpdate().clear()}setItemIDKey(a){return this.keyItemID=a,this}setMode(a){return typeof a==="string"&&(a=zb[a]),this.mode=a,this.updater=ud[a],this}setGetitemCallback(a,b){return this.getItemCallback=a,this.getItemCallbackScope=b,this}setQuery(a){return this.query=a,this}startUpdate(a){if(a)this.setQuery(a);else if(this.query)a=this.query;else return this;return this.stopUpdate().clear(),this.isUpdating=!0,this.updater.start(this,a),this}stopUpdate(){return!this.query||!this.isUpdating?this:(this.isUpdating=!1,this.updater.stop(this),this)}clear(){return nf(this),this}getItems(){return Km(this)}hasItem(a){return Lm(this,a)}getItemIndexFromItemID(a){return ai(this,a)}getItemFromItemID(a){return Mm(this,a)}forEach(a,b){return Nm(this,a,b),this}updateItemID2Index(){return Pb(this),this}}const Qq=function(a){let b=a.val();return b[this.keyItemID]=a.key,b};function Lb(a,b=a.userID){return a.userID2ItemID.has(b)}function _e(a,b=a.userID){if(!Lb(a,b))return null;let c=a.userID2ItemID.get(b);return a.rootRef.child(c)}function Sl(a,b=a.userID){if(!Lb(a,b))return null;let c=a.userID2ItemID.get(b);return a.userList.getItemFromItemID(c)}function nh(a){return a.userList.getItems()}function Tl(a){a.userList.clear()}function Ul(a,b,c){a.userList.forEach(b,c)}function Vl(a,b=a.userID){let c=a.userList.getItems()[0];return c&&c.userID===b}function Wl(a){return a.maxUsers===0?!1:a.userList.getItems().length>=a.maxUsers}function Ol(a=0,b){return new Promise(function(c,d){setTimeout(function(){c(b)},a)})}function Pl(a,b=a.userID,c=a.userName){if(Lb(a,b))return Promise.resolve();let d={userID:b,userName:c},e=a.maxUsers,f=a.database.ref(a.rootPath),g=f.push();return g.onDisconnect().remove().then(function(){return g.set(d)}).then(function(){return Ol(0)}).then(function(){return e===0?(a.isInList=!0,Promise.resolve()):f.limitToFirst(e).once("value").then(function(i){return Eq(i,b)?(a.isInList=!0,Promise.resolve()):(a.isInList=!1,g.remove().then(function(){return g.onDisconnect().cancel()}).then(function(){return Promise.reject()}))})})}function Eq(a,b){let c=!1;return a.forEach(function(d){let e=d.val();if(e.userID===b)return c=!0,!0}),c}function Ql(a,b=a.userID){if(!Lb(a,b))return Promise.resolve();let c=a.userID2ItemID.get(b),d=a.database.ref(a.rootPath).child(c);return d.remove()}function Nl(a,b){return new Promise(function(c,d){let e=_e(a);if(e)return c(e);{let f=a.rootRef.orderByChild("userID").equalTo(a.userID);f.once("child_added").then(function(g){return c(g.ref)})}}).then(function(c){return c.child("userName").set(b)}).then(function(){return a.userName=b,Promise.resolve()})}const n6=Ka(Ra());class Oc extends va{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,eventNames:f=Rl}={}){super();this.setEventEmitter(a),this.eventNames=f,this.database=n6.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.setMaxUsers(e),this.userList=new mc({eventEmitter:this.eventEmitter,itemIDKey:"joinAt",eventNames:{add:f.join,remove:f.leave,update:f.update,change:f.change}}),this.isInList=!1,this.userID2ItemID=new Map(),this.userList.on(this.eventNames.join,function(g){this.userID2ItemID.set(g.userID,g.joinAt),g.userID===this.userInfo.userID&&this.emit(this.eventNames.init,nh(this))},this).on(this.eventNames.leave,function(g){this.userID2ItemID.delete(g.userID),g.userID===this.userID&&(this.isInList=!1)},this).on(this.eventNames.change,function(g,i){let h=g.userID,k=g.userName,n=i.userName;k!==n&&this.emit(this.eventNames.changename,h,k,n)},this)}destroy(){this.stopUpdate().destroyEventEmitter().leave(),this.userList.destroy()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setMaxUsers(a){return this.maxUsers=a,this}clear(){return Tl(this),this}forEach(a,b){return Ul(this,a,b),this}isFull(){return Wl(this)}isFirstUser(a=this.userID){return Vl(this,a)}getUser(a=this.userID){return Sl(this,a)}getUsers(){return nh(this)}getUserRef(a=this.userID){return _e(this,a)}contains(a=this.userID){return Lb(this,a)}join(a=this.userID,b=this.userName){return Pl(this,a,b)}leave(a=this.userID){return Ql(this,a)}changeUserName(a){return Nl(this,a)}startUpdate(){let a=this.rootRef;return this.maxUsers>0&&(a=a.limitToFirst(this.maxUsers)),this.userList.startUpdate(a),this}stopUpdate(){return this.userList.stopUpdate(),this}}const nc="room.join";const Nb="room.leave";const Jh="userlist.join";const Kh="userlist.leave";const Mh="userlist.init";const Lh="userlist.update";const rd="userlist.changename";const uh="broadcast.receive";function yh(a){return`tables.${a}.init`}function zh(a){return`tables.${a}.update`}function Ah(a){return`tables.${a}.addkey0`}function Bh(a){return`tables.${a}.addkey1`}function Ch(a){return`tables.${a}.addkey2`}function Dh(a){return`tables.${a}.removekey0`}function Eh(a){return`tables.${a}.removekey1`}function Fh(a){return`tables.${a}.removekey2`}function Gh(a){return`tables.${a}.changekey0`}function Hh(a){return`tables.${a}.changekey1`}function Ih(a){return`tables.${a}.changekey2`}const vh="roomlist.add";const wh="roomlist.remove";const xh="roomlist.update";function hm(a){const b=new Oc({eventEmitter:a.eventEmitter,eventNames:{join:Jh,leave:Kh,update:Lh,change:"userlist.change",init:Mh,changename:rd},userID:a.userInfo});return b.on("userlist.leave",function(c){c.userID===a.userID&&Jq(a)}),a.on(nc,function(){b.startUpdate()}).on(Nb,function(){b.stopUpdate().clear()}),b}function Jq(a){a.emit(Nb),setTimeout(function(){a.roomID=void 0,a.roomName=void 0,a.doorState=void 0,a.leftRoomFlag=!1},0)}function em(a){const b=new mc({eventEmitter:a.eventEmitter,itemIDKey:"roomID",eventNames:{update:xh,add:vh,remove:wh,change:"roomlist.change"},mode:"once"});return b}function om(a){return a.split("|")[0]}function nm(a){return a.split("|")[1]}function Pc(a,b=""){return`${a}|${b}`}function kb(a,b){let c=a.rootRef;return b&&(c=c.child(b)),c}function sd(a,b,c){let d=kb(a,"rooms");return b!==void 0&&(d=d.child(b),c!==void 0&&(d=d.child(c))),d}function dm(a,b){return sd(a,b,"alive")}function im(a,b){return sd(a,b,"users")}function qd(a,b){let c=kb(a,"room-filters");return b!==void 0&&(c=c.child(b)),c}function Qc(a,b){let c=kb(a,"room-metadata");return b!==void 0&&(c=c.child(b)),c}function af(a,b,c){let d=`${a.rootPath}/rooms/${b}`;return c&&(d+=`/${c}`),d}function df(a,b){return af(a,b,"users")}function fm(a,b,c){let d=af(a,b,"tables");return c&&(d+=`/${c}`),d}function jm(a,b,c="open"){let d=qd(a);return d=d.orderByChild("filter"),b===void 0?d=d.startAt(c).endAt(`${c}~`):d=d.equalTo(Pc(c,b)),d}function am(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new Mc({eventEmitter:a.eventEmitter,eventNames:{receive:uh},receiverID:"boradcast",senderID:a.userInfo,history:b.history});return a.on(nc,function(d){c.setRootPath(af(a,d.roomID)).startReceiving()}).on(Nb,function(){c.stopReceiving()}).on(rd,function(d,e){c.changeUserName(d,e)}),c}function gm(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,Iq(a,d))}),a.on(nc,function(d){for(const[e,f]of c)f.setRootPath(fm(a,d.roomID,e)).startUpdate()}).on(Nb,function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function Iq(a,{key:b,type:c=ra["1d"]}){const d=new Nc({eventEmitter:a.eventEmitter,type:c,eventNames:{init:yh(b),update:zh(b),addkey0:Ah(b),removekey0:Dh(b),changekey0:Gh(b),addkey1:Bh(b),removekey1:Eh(b),changekey1:Hh(b),addkey2:Ch(b),removekey2:Fh(b),changekey2:Ih(b)}});return d}function Wa(a,b=a.roomID,c=a.roomName){return{roomID:b,roomName:c}}function hf(a,b){return b===void 0?a.roomID!==void 0:a.roomID===b}function rm(a){return a.userList.isFull()}function sm(a,b=a.userID){return a.userList.isFirstUser(b)}function tm(a){return a.userList.getUsers()}function ef(a,b,c,d){a.roomID=b,a.roomName=c,a.roomType=d,a.emit("room.join",Wa(a))}function cf(a,b={}){return b.roomID==null&&(b.roomID=sd(a).push().key),Gq(a,b.roomID).then(function(){return Hq(a,b)})}function Gq(a,b){return dm(a,b).transaction(function(c){return c===null?!0:void 0})}function Hq(a,{roomID:b,roomName:c="",roomType:d="",maxUsers:e=0,presisted:f=!1,door:g="open",join:i=!0,filterData:h}){let k=sd(a,b),n=qd(a,b),o=Qc(a,b);a.isRemoveRoomWhenLeft=!f,a.isRemoveRoomWhenLeft&&(k.onDisconnect().remove(),n.onDisconnect().remove(),o.onDisconnect().remove());const s=Pc(g,d),u={},v={filter:s,name:c};h&&(v.data=h),u[`room-filters/${b}`]=v;const y={name:c,filter:s,maxUsers:e,moderators:{}};return y.moderators[a.userID]=a.userName,u[`room-metadata/${b}`]=y,new Promise(function(G,K){if(i){const J=a.userList.setRootPath(df(a,b)).setMaxUsers(0).join();return a.userList.setMaxUsers(e),J.then(G,K)}else return G()}).then(function(){return kb(a).update(u)}).then(function(){return a.isRoomCreator=!0,i&&ef(a,b,c,d),Promise.resolve(Wa(a))})}function bm(a,{digits:b=10,candidates:c="0123456789",retry:d=1e3}){let e=arguments[1];return cm(a,b,c,d,e)}function cm(a,b,c,d,e){return e.roomID=bf(b,b,c),d<=0?Promise.reject(e):(d--,cf(a,e).catch(function(){return cm(a,b,c,d,e)}))}function jf(a,b=a.roomID){const c={};c[`room-filter/${b}`]=null,c[`room-metadata/${b}`]=null,c[`rooms/${b}`]=null;const d=Wa(a);return kb(a).update(c).then(function(){return Promise.resolve(d)})}function Rc(a){if(!hf(a))return Promise.resolve(Wa(a));a.leftRoomFlag=!0;if(a.isRemoveRoomWhenLeft)return jf(a);{const b=Wa(a);return a.userList.leave().then(function(){return Promise.resolve(b)})}}function gf(a,{leftThenJoin:b=!0,roomID:c}){return b?Rc(a).then(function(){return pm(a,c)}):pm(a,c)}function pm(a,b){return b==null?Promise.reject(Wa(a,b,"")):(a.isRemoveRoomWhenLeft=!1,Kq(a,b).then(function(c){return a.userList.setRootPath(df(a,b)).setMaxUsers(c.maxUsers).join().then(function(){return Promise.resolve(c)})}).then(function(c){return ef(a,b,c.name,nm(c.filter)),Promise.resolve(Wa(a))}))}function Kq(a,b){return Qc(a,b).once("value").then(function(c){let d=c.val();return Lq(a,d)?Promise.resolve(d):Promise.reject()})}function Lq(a,b){if(b==null)return!1;if(om(b.filter)==="closed")return!1;const c=a.userID;if(b.moderators[c])return!0;switch(b.permission){case"blocklist":const d=b.blocklist;return!(d&&d[c]);case"allowlist":const e=b.allowlist;return e&&e[c];default:return!0}}function ff(a,b,c){return new Promise(function(d,e){a.roomList.once("roomlist.update",function(f){d(f)}).startUpdate(jm(a,b,c))})}function lm(a,{roomType:b="",leftThenJoin:c=!0}={}){return ff(a,b,"open").then(function(d){if(d.length===0)return Promise.reject("No filtered room");kc(d);const e={leftThenJoin:c,roomID:""};return mm(a,e,d)})}function mm(a,b,c,d=0){return d===c.length?Promise.reject("Can't join any room"):(b.roomID=c[d].roomID,d++,gf(a,b).catch(function(){return mm(a,b,c,d)}))}function qm(a,b){return a.userList.contains(b)?b===a.userID?Rc(a):a.userList.leave(b):Promise.resolve()}function Mb(a,b){return b===a.roomID?Promise.resolve(!0):Qc(a,b).once("value").then(function(c){const d=c.val()!==null;return Promise.resolve(d)})}function $e(a,b,c=a.roomID){return Mb(a,c).then(function(d){if(!d)return Promise.resolve();const e=Pc(b,a.roomType),f={};return f[`room-filters/${c}/filter`]=e,f[`room-metadata/${c}/filter`]=e,kb(a).update(f)})}function Zl(a,b=a.roomID){return $e(a,"open",b)}function _l(a,b=a.roomID){return $e(a,"closed",b)}function Xl(a,b,c=a.roomID){return Mb(a,c).then(function(d){return d?qd(a,c).child("data").update(b):Promise.resolve()})}function $l(a,b){return a.userList.changeUserName(b)}function Yl(a,b,c=a.roomID){return Mb(a,c).then(function(d){if(!d)return Promise.resolve();const e={};return e[`room-filters/${c}/name`]=b,e[`room-metadata/${c}/name`]=b,kb(a).update(e)})}function km(a,b=a.roomID){return b===a.roomID?a.userList.getUsers():new Promise(function(c,d){const e=new mc({itemIDKey:"joinAt",mode:"once"});e.once("update",function(f){c(f)}).startUpdate(im(a,b))})}const _7=Ka(Ra());class um extends va{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",broadcast:e=!0,tables:f=!1}={}){super();this.setEventEmitter(a),this.database=_7.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.isRoomCreator=!1,this.roomID=void 0,this.roomName=void 0,this.roomType=void 0,this.doorState=void 0,this.leftRoomFlag=!1,this.isRemoveRoomWhenLeft=void 0,this.userList=hm(this),this.roomList=em(this),this.broadcast=am(this,e),this.tables=gm(this,f)}destroy(){var a=this;this.destroyEventEmitter().leaveRoom().then(function(){a.userList.destroy(),a.userList=void 0,a.roomList.destroy(),a.roomList=void 0,a.broadcast.destroy(),a.broadcast=void 0})}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}getRoomInfo(a,b){return Wa(this,a,b)}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(a){return hf(this,a)}isFull(){return rm(this)}isFirstUser(a=this.userID){return sm(this,a)}getUsers(){return tm(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}createRoom(a){return cf(this,a)}createRandomRoom(a={}){return bm(this,a)}joinRoom(a){return gf(this,a)}joinRandomRoom(a={}){return lm(this,a)}leaveRoom(){return Rc(this)}removeRoom(a=this.roomID){return jf(this,a)}kickUser(a){return qm(this,a)}changeRoomState(a,b=this.roomID){return $e(this,a,b)}openRoom(a=this.roomID){return Zl(this,a)}closeRoom(a=this.roomID){return _l(this,a)}changeUserName(a){return $l(this,a)}changeFilterData(a,b=this.roomID){return Xl(this,a,b)}changeRoomName(a,b,c=a.roomID){return Yl(this,b,c)}getUserList(a=this.roomID){return km(this,a)}getRoomList(a,b){return ff(this,a,b)}HasRoom(a){return Mb(this,a)}}function Bm(a,b){let c=a.rootPath;return b&&(c+=`/${b}`),c}function zm(a){return Bm(a,"users")}function xm(a,b){return`${Bm(a,"tables")}/${b}`}const yb="room.join";const Ob="room.leave";const Zh="userlist.join";const kf="userlist.leave";const $h="userlist.init";const _h="userlist.update";const td="userlist.changename";const Nh="broadcast.receive";function Oh(a){return`tables.${a}.init`}function Ph(a){return`tables.${a}.update`}function Qh(a){return`tables.${a}.addkey0`}function Rh(a){return`tables.${a}.addkey1`}function Sh(a){return`tables.${a}.addkey2`}function Th(a){return`tables.${a}.removekey0`}function Uh(a){return`tables.${a}.removekey1`}function Vh(a){return`tables.${a}.removekey2`}function Wh(a){return`tables.${a}.changekey0`}function Xh(a){return`tables.${a}.changekey1`}function Yh(a){return`tables.${a}.changekey2`}function Am(a,b=0){const c=new Oc({eventEmitter:a.eventEmitter,eventNames:{join:Zh,leave:kf,update:_h,change:"userlist.change",init:$h,changename:td},root:zm(a),userID:a.userInfo,maxUsers:b});return c.on(kf,function(d){d.userID===a.userID&&Oq(a)}),a.on(yb,function(){c.startUpdate()}).on(Ob,function(){c.stopUpdate().clear()}),c}function Oq(a){a.emit(Ob),setTimeout(function(){a.leftRoomFlag=!1},0)}function wm(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new Mc({eventEmitter:a.eventEmitter,eventNames:{receive:Nh},receiverID:"broadcast",senderID:a.userInfo,history:b.history});return a.on(yb,function(){c.setRootPath(a.rootPath).startReceiving()}).on(Ob,function(){c.stopReceiving()}).on(td,function(d,e){c.changeUserName(d,e)}),c}function ym(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,Nq(a,d))}),a.on(yb,function(){for(const[d,e]of c)e.setRootPath(xm(a,d)).startUpdate()}).on(Ob,function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function Nq(a,{key:b,type:c=ra["1d"]}){const d=new Nc({eventEmitter:a.eventEmitter,type:c,eventNames:{init:Oh(b),update:Ph(b),addkey0:Qh(b),removekey0:Th(b),changekey0:Wh(b),addkey1:Rh(b),removekey1:Uh(b),changekey1:Xh(b),addkey2:Sh(b),removekey2:Vh(b),changekey2:Yh(b)}});return d}function mf(a){return a.userList.isInList}function Fm(a){return a.userList.isFull()}function Gm(a,b=a.userID){return a.userList.isFirstUser(b)}function Hm(a){return a.userList.getUsers()}function Dm(a){return a.userList.join().then(function(){return a.emit(yb),Promise.resolve()})}function lf(a){return mf(a)?(a.leftRoomFlag=!0,a.userList.leave()):Promise.resolve()}function Cm(a){return a.userList.getUsers()}function Em(a,b){return a.userList.contains(b)?b===a.userID?lf(a):a.userList.leave(b):Promise.resolve()}function vm(a,b){return a.userList.changeUserName(b)}const M9=Ka(Ra());class Im extends va{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,broadcast:f=!0,tables:g=!1}={}){const i=arguments[0];super();this.setEventEmitter(a),this.database=M9.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.leftRoomFlag=!1,this.userList=Am(this,e),this.broadcast=wm(this,f),this.tables=ym(this,g)}shutdown(){}destroy(){this.shutdown()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(){return mf(this)}isFull(){return Fm(this)}isFirstUser(a=this.userID){return Gm(this,a)}getUsers(){return Hm(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}joinRoom(){return Dm(this)}leaveRoom(){return lf(this)}getUserList(){return Cm(this)}kickUser(a){return Em(this,a)}changeUserName(a){return vm(this,a)}}const Yi="statechange";function Zi(a){return`exit_${a.toString()}`}function _i(a){return`enter_${a.toString()}`}class Co extends va{constructor({eventEmitter:a}={}){super();this._states=new Map();this.enable=!0;this.setEventEmitter(a)}destroy(){this.destroyEventEmitter()}toJSON(){return{curState:this.state,prevState:this.prevState,enable:this.enable,start:this._start}}setEnable(a=!0){return this.enable=a,this}getState(a){return this._states.get(a)}addState(a){return this._states.set(a.name,a),this}addStates(a){for(let b=0,c=a.length;b<c;b++)this.addState(a[b]);return this}removeState(a){return this._states.delete(a),this}removeAllStates(){return this._states.clear(),this}set state(a){if(!this.enable||this._stateLock)return;if(this._state===a)return;this._prevState=this._state,this._state=a,this._stateLock=!0,this.emit(Yi,this);if(this._prevState!=null){const b=this.getState(this._prevState);b&&b.exit&&b.exit(this),this.emit(Zi(this._prevState),this)}this._stateLock=!1;if(this._state!=null){const b=this.getState(this._state);b&&b.enter&&b.enter(this),this.emit(_i(this._state),this)}}get state(){return this._state}get prevState(){return this._prevState}get stateList(){return Array.from(this._states.keys())}start(a){return this._start=a,this._prevState=void 0,this._state=a,this}goto(a){return a!=null&&(this.state=a),this}next(){const a=this.getState(this.state);if(!a||!a.next)return this;let b;return typeof a.next==="string"?b=a.next:b=a.next(this),this.goto(b),this}update(a,b,c="update"){const d=this.getState(this.state);d&&d[c]&&d[c](this,a,b)}preupdate(a,b){this.update(b,a,"preupdate")}postupdate(a,b){this.update(b,a,"postupdate")}}var $i;(function(a){a[a.shuffle=0]="shuffle",a[a.random=1]="random"})($i||($i={}));const cj="die";class Do extends Mf{constructor(a,{lifeTime:b=1e3,destroy:c=!0}={}){super(a,arguments[1]);this.setLifeTime(b),this.setDestroyMode(c)}resetFromJSON({lifeTime:a=1e3,destroy:b=!0}={}){return super.resetFromJSON(arguments[0]),this.setLifeTime(a),this.setDestroyMode(b),this}toJSON(){const a=super.toJSON();return a.lifeTime=this.lifeTime,a.destroy=this.destroyMode,a}setLifeTime(a){return this.lifeTime=a,this}addToLifeTime(a){return this.lifeTime+=a,this}setDestroyMode(a=!0){return this.destroyMode=a,this}get isAlive(){return this.now<this.lifeTime}get remainder(){let a=this.lifeTime-this.now;return a<0&&(a=0),a}update(a){return this.isRunning?(super.update(a),this.isAlive||(this.complete(cj),this.destroyMode&&this.gameObject.destroy&&this.gameObject.destroy()),this):this}get gameObject(){return this.parent}}class Nf{constructor(a,b,c,d,e){this.key=a,this.start=b,this.end=c,this.step=d,this.items=e,this._current=b}reset(){this._current=this.start}get isEnd(){return this.step>=0?this._current>=this.end:this._current<=this.end}get length(){return this.step>=0&&this.start>this.end||this.step<0&&this.start<this.end?0:Math.floor(this.end-this.start)+1}next(){return this.isEnd?this._current=this.start:this._current+=this.step,this}get current(){return this.items?this.items[this._current]:this._current}}class Fo{constructor(){this.indexes=[];this.length=0;this.firstPass=!0;this.currentCount=0}reset(){for(let a=0,b=this.indexes.length;a<b;a++)this.indexes[a].reset();return this.firstPass=!0,this.currentCount=0,this}addNumberLoop(a,b,c,d=c>=b?1:-1){return this.indexes.push(new Nf(a,b,c,d)),this.length=this._getLength(),this}addItemsLoop(a,b,c=!1){const d=b.length-1,e=c?d:0,f=c?0:d,g=c?-1:1;return this.indexes.push(new Nf(a,e,f,g,b)),this.length=this._getLength(),this}addLoop({key:a,start:b,end:c,step:d,items:e}){return this.indexes.push(new Nf(a,b,c,d,e)),this.length=this._getLength(),this}removeLoops(){return this.indexes.length=0,this.length=0,this}_getLength(){let a=this.indexes[0]?.length;for(let b=1,c=this.indexes.length;b<c;b++)a*=this.indexes[b].length;return a??0}get progress(){return this.currentCount/this.length}get isEnd(){for(let a=this.indexes.length-1;a>=0;a--)if(!this.indexes[a].isEnd)return!1;return!0}next(){for(let a=this.indexes.length-1;a>=0;a--){const b=this.indexes[a],c=b.isEnd;b.next();if(!c)break}return this}getCurrent(a={}){for(let b=this.indexes.length-1;b>=0;b--){const c=this.indexes[b];a[c.key]=c.current}return a}getNext(a={}){return this.firstPass?this.firstPass=!1:this.next(),this.getCurrent(a),this.currentCount++,a}}const Ui="tickstart";const Vi="tickend";const Kr=1e3/60;class Eo extends Of{constructor(a,{callback:b,scope:c,deltaPercentage:d=1}={}){super(a,arguments[1]);this.deltaPercentage=1;this.loopIndexGenerator=new Fo();this.currentIndexes={};this.scene=a,this.setCallback(b,c),this.setDeltaPercentage(d),this.boot()}boot(){super.boot(),Xb(this.scene,"shutdown",this.destroy,this)}shutdown(){super.shutdown(),this.scene=void 0}destroy(){this.shutdown()}startTicking(){super.startTicking(),$a(this.scene,"update",this.preupdate,this)}stopTicking(){super.stopTicking(),this.scene&&tb(this.scene,"update",this.preupdate,this)}setCallback(a,b){return this.callback=a,this.scope=b,this}setDeltaPercentage(a){return this.deltaPercentage=a,this}addNumberLoop(a,b,c,d){return this.loopIndexGenerator.addNumberLoop(a,b,c,d),this}addItemsLoop(a,b,c=!1){return this.loopIndexGenerator.addItemsLoop(a,b,c),this}addLoop(a){return this.loopIndexGenerator.addLoop(a),this}get curTime(){return new Date().getTime()}get progress(){return this.loopIndexGenerator.progress}preupdate(){if(!this.callback)return;const a=this.curTime,b=Kr*this.deltaPercentage;let c;this.emit(Ui);do{if(this.loopIndexGenerator.isEnd){this.complete();return}this.currentIndexes=this.loopIndexGenerator.getNext(this.currentIndexes),this.scope?this.callback.call(this.scope,this.currentIndexes,this):this.callback(this.currentIndexes,this),c=this.curTime-a>=b}while(!c);this.emit(Vi)}}const Zqa=Ka($o());var aj;(function(a){a[a.none=0]="none",a[a.base64=1]="base64",a[a.utf16=2]="utf16",a[a.uri=3]="uri"})(aj||(aj={}));let Vr=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i;function Lc(a){let b;return a===""?b=null:Vr.test(a)?b=parseFloat(a):a==="false"?b=!1:a==="true"?b=!0:b=a,b}const uma=Ka(Dg());function Go(a,{delimiter:b=",",convert:c=!0,types:d={}}={}){const e=uma.default.parse(a,{header:!0,delimiter:b}).data,f=d.question??"q",g=d.option??"",i=c===!0?Lc:c,h=[];let k,n;for(let o=0,s=e.length;o<s;o++){let u=e[o],v=u.type;delete u.type,v===f?(k=u,k.key===""&&delete k.key,Io(k,i),k.options=[],h.push(k)):v===g&&(k&&(n=u,n.key===""&&delete n.key,Io(n,i),k.options.push(n)))}return h}function Io(a,b){const c=a;if(!b)return c;for(const d in a)c[d]=b(a[d],d);return c}function Xi(a,b,c){typeof b==="string"&&(b=Go(b,c));if(Array.isArray(b))for(let d=0,e=b.length;d<e;d++)Ho(a,b[d]);else Ho(a,b)}function Ho(a,b){const c=b.options;if(c)for(let d=0,e=c.length;d<e;d++){let f=c[d];f.hasOwnProperty("key")||(f.key=`_${d}`)}b.hasOwnProperty("key")||(b.key=`_${a.questions.size}`),a.questions.set(b.key,b)}class Wi{constructor({questions:a}={}){this.questions=new Map();a&&Xi(this,a,arguments[0])}add(a,b){return Xi(this,a,b),this}remove(a){return this.questions.delete(a),this}removeAll(){return this.questions.clear(),this}has(a){return this.questions.has(a)}get(a){return this.questions.get(a)}getKeys(a=[]){const b=this.questions.keys();for(const c of b)a.push(c);return a}getOption(a,b){typeof a==="string"&&(a=this.get(a));if(!a)return null;const c=a.options;if(c)for(let d=0,e=c.length;d<e;d++){let f=c[d];if(f.key===b)return f}return null}}const Pf="quest";class Lr extends va{constructor(a,{eventEmitter:b,shuffleQuestions:c=!1,shuffleOptions:d=!1}={}){super();this.questionKeys=[];this.setEventEmitter(b),We(a)&&(a=new Wi(a)),this.questionsManager=a,this.setShuffleQuestionsEnable(c),this.setShuffleOptionsEnable(d),this.init()}setShuffleQuestionsEnable(a=!0){return this.shuffleQuestionsEnable=a,this}setShuffleOptionsEnable(a=!0){return this.shuffleOptionsEnable=a,this}init(){return this.questionKeys.length=0,this.questionsManager.getKeys(this.questionKeys),this.shuffleQuestionsEnable&&kc(this.questionKeys),this.nextIndex=-1,this.nextKey=void 0,this}setNextKey(a){return a===void 0?(this.nextIndex++,this.nextKey=this.questionKeys[this.nextIndex]):this.questionsManager.has(a)&&(this.nextKey=a,this.nextIndex=this.questionKeys.indexOf(a)),this}setPrevKey(){return this.nextIndex--,this.nextKey=this.questionKeys[this.nextIndex],this}getQuestion(){const a=this.questionsManager.get(this.nextKey);if(a&&this.shuffleOptionsEnable){const b=a.options;b&&kc(b)}return a}getNextQuestion(a){return this.setNextKey(a).getQuestion()}getPrevQuestion(){return this.setPrevKey().getQuestion()}getOption(a,b){return b===void 0&&(b=a,a=this.getQuestion()),this.questionsManager.getOption(a,b)}next(a){const b=this.getNextQuestion(a);return b&&this.emit(Pf,b,this,this.questionsManager),this}prev(){const a=this.getPrevQuestion();return a&&this.emit(Pf,a,this,this.questionsManager),this}restart(a){return this.init(),this.next(a),this}get isLastQuestion(){return this.nextIndex===this.questionKeys.length-1}}var _g;(function(a){a[a.ascending=0]="ascending",a[a.descending=1]="descending",a[a.logical_ascending=2]="logical_ascending",a[a.logical_descending=3]="logical_descending"})(_g||(_g={}));const cp=8085079,dp=2493956;class ep extends Td{constructor(){super();bg("icon",{width:32,height:32,fillStyle:"white"});const a=new lb.Label({orientation:"x",background:nj(),icon:Ud("icon"),text:Vd("Hello"),action:Ud("icon"),space:{left:20,right:20,top:20,bottom:20,icon:10,text:10}}),b=new lb.Label({orientation:"y",background:nj(),icon:Ud("icon"),text:Vd("World"),action:Ud("icon"),space:{left:20,right:20,top:20,bottom:20,icon:10,text:10}}),c=new lb.Sizer({orientation:"y"}).add(Vd("Horizontal Label"),{padding:{bottom:30}}).add(a),d=new lb.Sizer({orientation:"y"}).add(Vd("Vertical Label"),{padding:{bottom:30}}).add(b),e=new lb.Sizer({x:400,y:300,width:600,orientation:"x"}).add(c,{proportion:1,expand:!0,align:"TOP_LEFT"}).add(d,{proportion:1,expand:!0,align:"TOP_RIGHT"}).layout(),f=new $f(this);xc(f,e)}}function nj(a=dp,b=cp,c=20){return new lb.RoundRectangleCanvas({radius:c,fillStyle:a,strokeStyle:b,lineWidth:3})}function Ud(a,b){return new fb(0,0,a,b)}function Vd(a="",b="30px monospace"){return new ag(0,0,a,b)}new mj(_f(),Zf(800,600),Xf("game"),Wf(2960685),Yf(ep));})();
/* @license
Papa Parse
v5.3.0
https://github.com/mholt/PapaParse
License: MIT
*/
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

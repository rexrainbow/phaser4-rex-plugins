(()=>{let Nc=Object.defineProperty,fg=Object.prototype.hasOwnProperty,ab=(a,b)=>()=>(b||(b={exports:{}},a(b.exports,b)),b.exports),gg=a=>Nc(a,"__esModule",{value:!0}),sb=(a,b)=>{gg(a);for(let c in b)Nc(a,c,{get:b[c],enumerable:!0})},Xk=(a,b)=>{gg(a);if(typeof b==="object"||typeof b==="function")for(let c in b)fg.call(b,c)&&!fg.call(a,c)&&c!=="default"&&Nc(a,c,{get:()=>b[c],enumerable:!0});return a},Fa=a=>a&&a.__esModule?a:Xk(Nc({},"default",{value:a,enumerable:!0}),a);var vh=ab((a,b)=>{!function(c,d){"function"==typeof define&&define.amd?define([],d):"object"==typeof b&&"undefined"!=typeof a?b.exports=d():c.Papa=d()}(a,function c(){"use strict";var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==d?d:{},e=!d.document&&!!d.postMessage,f=e&&/blob:/i.test((d.location||{}).protocol),g={},k=0,i={parse:function(q,r){var h=(r=r||{}).dynamicTyping||!1;P(h)&&(r.dynamicTypingFunction=h,h={});if(r.dynamicTyping=h,r.transform=!!P(r.transform)&&r.transform,r.worker&&i.WORKERS_SUPPORTED){var l=function(){if(!i.WORKERS_SUPPORTED)return!1;var p=(n=d.URL||d.webkitURL||null,D=c.toString(),i.BLOB_URL||(i.BLOB_URL=n.createObjectURL(new Blob(["(",D,")();"],{type:"text/javascript"})))),t=new d.Worker(p),n,D;return t.onmessage=R,t.id=k++,g[t.id]=t}();return l.userStep=r.step,l.userChunk=r.chunk,l.userComplete=r.complete,l.userError=r.error,r.step=P(r.step),r.chunk=P(r.chunk),r.complete=P(r.complete),r.error=P(r.error),delete r.worker,void l.postMessage({input:q,config:r,workerId:l.id})}var j=null;return i.NODE_STREAM_INPUT,"string"==typeof q?j=r.download?new u(r):new B(r):!0===q.readable&&P(q.read)&&P(q.on)?j=new E(r):(d.File&&q instanceof File||q instanceof Object)&&(j=new A(r)),j.stream(q)},unparse:function(q,r){var h=!1,l=!0,j=",",p=`\r
`,t='"',n=t+t,D=!1,F=null;!function(){if("object"!=typeof r)return;"string"!=typeof r.delimiter||i.BAD_DELIMITERS.filter(function(z){return-1!==r.delimiter.indexOf(z)}).length||(j=r.delimiter),("boolean"==typeof r.quotes||"function"==typeof r.quotes||Array.isArray(r.quotes))&&(h=r.quotes),"boolean"!=typeof r.skipEmptyLines&&"string"!=typeof r.skipEmptyLines||(D=r.skipEmptyLines),"string"==typeof r.newline&&(p=r.newline),"string"==typeof r.quoteChar&&(t=r.quoteChar),"boolean"==typeof r.header&&(l=r.header);if(Array.isArray(r.columns)){if(0===r.columns.length)throw new Error("Option columns is empty");F=r.columns}void 0!==r.escapeChar&&(n=r.escapeChar+t)}();var V=new RegExp(I(t),"g");"string"==typeof q&&(q=JSON.parse(q));if(Array.isArray(q)){if(!q.length||Array.isArray(q[0]))return W(null,q,D);if("object"==typeof q[0])return W(F||y(q[0]),q,D)}else if("object"==typeof q)return"string"==typeof q.data&&(q.data=JSON.parse(q.data)),Array.isArray(q.data)&&(q.fields||(q.fields=q.meta&&q.meta.fields),q.fields||(q.fields=Array.isArray(q.data[0])?q.fields:y(q.data[0])),Array.isArray(q.data[0])||"object"==typeof q.data[0]||(q.data=[q.data])),W(q.fields||[],q.data||[],D);throw new Error("Unable to serialize unrecognized input");function y(z){if("object"!=typeof z)return[];var H=[];for(var Y in z)H.push(Y);return H}function W(z,H,Y){var ia="";"string"==typeof z&&(z=JSON.parse(z)),"string"==typeof H&&(H=JSON.parse(H));var na=Array.isArray(z)&&0<z.length,pa=!Array.isArray(H[0]);if(na&&l){for(var ma=0;ma<z.length;ma++)0<ma&&(ia+=j),ia+=J(z[ma],ma);0<H.length&&(ia+=p)}for(var T=0;T<H.length;T++){var ea=na?z.length:H[T].length,ja=!1,ka=na?0===Object.keys(H[T]).length:0===H[T].length;if(Y&&!na&&(ja="greedy"===Y?""===H[T].join("").trim():1===H[T].length&&0===H[T][0].length),"greedy"===Y&&na){for(var Q=[],S=0;S<ea;S++){var ga=pa?z[S]:S;Q.push(H[T][ga])}ja=""===Q.join("").trim()}if(!ja){for(var K=0;K<ea;K++){0<K&&!ka&&(ia+=j);var fa=na&&pa?z[K]:K;ia+=J(H[T][fa],K)}T<H.length-1&&(!Y||0<ea&&!ka)&&(ia+=p)}}return ia}function J(z,H){if(null==z)return"";if(z.constructor===Date)return JSON.stringify(z).slice(1,25);var Y=z.toString().replace(V,n),ia="boolean"==typeof h&&h||"function"==typeof h&&h(z,H)||Array.isArray(h)&&h[H]||function(na,pa){for(var ma=0;ma<pa.length;ma++)if(-1<na.indexOf(pa[ma]))return!0;return!1}(Y,i.BAD_DELIMITERS)||-1<Y.indexOf(j)||" "===Y.charAt(0)||" "===Y.charAt(Y.length-1);return ia?t+Y+t:Y}}};if(i.RECORD_SEP=String.fromCharCode(30),i.UNIT_SEP=String.fromCharCode(31),i.BYTE_ORDER_MARK="ï»¿",i.BAD_DELIMITERS=["\r",`
`,'"',i.BYTE_ORDER_MARK],i.WORKERS_SUPPORTED=!e&&!!d.Worker,i.NODE_STREAM_INPUT=1,i.LocalChunkSize=10485760,i.RemoteChunkSize=5242880,i.DefaultDelimiter=",",i.Parser=L,i.ParserHandle=G,i.NetworkStreamer=u,i.FileStreamer=A,i.StringStreamer=B,i.ReadableStreamStreamer=E,d.jQuery){var m=d.jQuery;m.fn.parse=function(q){var r=q.config||{},h=[];return this.each(function(p){if(!("INPUT"===m(this).prop("tagName").toUpperCase()&&"file"===m(this).attr("type").toLowerCase()&&d.FileReader)||!this.files||0===this.files.length)return!0;for(var t=0;t<this.files.length;t++)h.push({file:this.files[t],inputElem:this,instanceConfig:m.extend({},r)})}),l(),this;function l(){if(0!==h.length){var p,t,n,D,F=h[0];if(P(q.before)){var V=q.before(F.file,F.inputElem);if("object"==typeof V){if("abort"===V.action)return p="AbortError",t=F.file,n=F.inputElem,D=V.reason,void(P(q.error)&&q.error({name:p},t,n,D));if("skip"===V.action)return void j();"object"==typeof V.config&&(F.instanceConfig=m.extend(F.instanceConfig,V.config))}else if("skip"===V)return void j()}var y=F.instanceConfig.complete;F.instanceConfig.complete=function(W){P(y)&&y(W,F.file,F.inputElem),j()},i.parse(F.file,F.instanceConfig)}else P(q.complete)&&q.complete()}function j(){h.splice(0,1),l()}}}function o(q){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(r){var h=_(r);h.chunkSize=parseInt(h.chunkSize),r.step||r.chunk||(h.chunkSize=null),this._handle=new G(h),(this._handle.streamer=this)._config=h}.call(this,q),this.parseChunk=function(r,h){if(this.isFirstChunk&&P(this._config.beforeFirstChunk)){var l=this._config.beforeFirstChunk(r);void 0!==l&&(r=l)}this.isFirstChunk=!1,this._halted=!1;var j=this._partialLine+r;this._partialLine="";var p=this._handle.parse(j,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var t=p.meta.cursor;this._finished||(this._partialLine=j.substring(t-this._baseIndex),this._baseIndex=t),p&&p.data&&(this._rowCount+=p.data.length);var n=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(f)d.postMessage({results:p,workerId:i.WORKER_ID,finished:n});else if(P(this._config.chunk)&&!h){if(this._config.chunk(p,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);p=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(p.data),this._completeResults.errors=this._completeResults.errors.concat(p.errors),this._completeResults.meta=p.meta),this._completed||!n||!P(this._config.complete)||p&&p.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),n||p&&p.meta.paused||this._nextChunk(),p}this._halted=!0},this._sendError=function(r){P(this._config.error)?this._config.error(r):f&&this._config.error&&d.postMessage({workerId:i.WORKER_ID,error:r,finished:!1})}}function u(q){var r;(q=q||{}).chunkSize||(q.chunkSize=i.RemoteChunkSize),o.call(this,q),this._nextChunk=e?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(h){this._input=h,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(r=new XMLHttpRequest(),this._config.withCredentials&&(r.withCredentials=this._config.withCredentials),e||(r.onload=X(this._chunkLoaded,this),r.onerror=X(this._chunkError,this)),r.open(this._config.downloadRequestBody?"POST":"GET",this._input,!e),this._config.downloadRequestHeaders){var h=this._config.downloadRequestHeaders;for(var l in h)r.setRequestHeader(l,h[l])}if(this._config.chunkSize){var j=this._start+this._config.chunkSize-1;r.setRequestHeader("Range","bytes="+this._start+"-"+j)}try{r.send(this._config.downloadRequestBody)}catch(p){this._chunkError(p.message)}e&&0===r.status&&this._chunkError()}},this._chunkLoaded=function(){4===r.readyState&&(r.status<200||400<=r.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:r.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(h){var l=h.getResponseHeader("Content-Range");return null===l?-1:parseInt(l.substring(l.lastIndexOf("/")+1))}(r),this.parseChunk(r.responseText)))},this._chunkError=function(h){var l=r.statusText||h;this._sendError(new Error(l))}}function A(q){var r,h;(q=q||{}).chunkSize||(q.chunkSize=i.LocalChunkSize),o.call(this,q);var l="undefined"!=typeof FileReader;this.stream=function(j){this._input=j,h=j.slice||j.webkitSlice||j.mozSlice,l?((r=new FileReader()).onload=X(this._chunkLoaded,this),r.onerror=X(this._chunkError,this)):r=new FileReaderSync(),this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var j=this._input;if(this._config.chunkSize){var p=Math.min(this._start+this._config.chunkSize,this._input.size);j=h.call(j,this._start,p)}var t=r.readAsText(j,this._config.encoding);l||this._chunkLoaded({target:{result:t}})},this._chunkLoaded=function(j){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(j.target.result)},this._chunkError=function(){this._sendError(r.error)}}function B(q){var r;o.call(this,q=q||{}),this.stream=function(h){return r=h,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var h,l=this._config.chunkSize;return l?(h=r.substring(0,l),r=r.substring(l)):(h=r,r=""),this._finished=!r,this.parseChunk(h)}}}function E(q){o.call(this,q=q||{});var r=[],h=!0,l=!1;this.pause=function(){o.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){o.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(j){this._input=j,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){l&&1===r.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),r.length?this.parseChunk(r.shift()):h=!0},this._streamData=X(function(j){try{r.push("string"==typeof j?j:j.toString(this._config.encoding)),h&&(h=!1,this._checkIsFinished(),this.parseChunk(r.shift()))}catch(p){this._streamError(p)}},this),this._streamError=X(function(j){this._streamCleanUp(),this._sendError(j)},this),this._streamEnd=X(function(){this._streamCleanUp(),l=!0,this._streamData("")},this),this._streamCleanUp=X(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function G(q){var r,h,l,j=Math.pow(2,53),p=-j,t=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)(e[-+]?\d+)?\s*$/,n=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,D=this,F=0,V=0,y=!1,W=!1,J=[],z={data:[],errors:[],meta:{}};if(P(q.step)){var H=q.step;q.step=function(T){if(z=T,na())ia();else{if(ia(),0===z.data.length)return;F+=T.data.length,q.preview&&F>q.preview?h.abort():(z.data=z.data[0],H(z,D))}}}function Y(T){return"greedy"===q.skipEmptyLines?""===T.join("").trim():1===T.length&&0===T[0].length}function ia(){if(z&&l&&(ma("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+i.DefaultDelimiter+"'"),l=!1),q.skipEmptyLines)for(var T=0;T<z.data.length;T++)Y(z.data[T])&&z.data.splice(T--,1);return na()&&function(){if(!z)return;function ea(ka){P(q.transformHeader)&&(ka=q.transformHeader(ka)),J.push(ka)}if(Array.isArray(z.data[0])){for(var ja=0;na()&&ja<z.data.length;ja++)z.data[ja].forEach(ea);z.data.splice(0,1)}else z.data.forEach(ea)}(),function(){if(!z||!q.header&&!q.dynamicTyping&&!q.transform)return z;function ea(ka,Q){var S,ga=q.header?{}:[];for(S=0;S<ka.length;S++){var K=S,fa=ka[S];q.header&&(K=S>=J.length?"__parsed_extra":J[S]),q.transform&&(fa=q.transform(fa,K)),fa=pa(K,fa),"__parsed_extra"===K?(ga[K]=ga[K]||[],ga[K].push(fa)):ga[K]=fa}return q.header&&(S>J.length?ma("FieldMismatch","TooManyFields","Too many fields: expected "+J.length+" fields but parsed "+S,V+Q):S<J.length&&ma("FieldMismatch","TooFewFields","Too few fields: expected "+J.length+" fields but parsed "+S,V+Q)),ga}var ja=1;return!z.data.length||Array.isArray(z.data[0])?(z.data=z.data.map(ea),ja=z.data.length):z.data=ea(z.data,0),q.header&&z.meta&&(z.meta.fields=J),V+=ja,z}()}function na(){return q.header&&0===J.length}function pa(T,ea){return ja=T,q.dynamicTypingFunction&&void 0===q.dynamicTyping[ja]&&(q.dynamicTyping[ja]=q.dynamicTypingFunction(ja)),!0===(q.dynamicTyping[ja]||q.dynamicTyping)?"true"===ea||"TRUE"===ea||"false"!==ea&&"FALSE"!==ea&&(function(ka){if(t.test(ka)){var Q=parseFloat(ka);if(p<Q&&Q<j)return!0}return!1}(ea)?parseFloat(ea):n.test(ea)?new Date(ea):""===ea?null:ea):ea;var ja}function ma(T,ea,ja,ka){var Q={type:T,code:ea,message:ja};void 0!==ka&&(Q.row=ka),z.errors.push(Q)}this.parse=function(T,ea,ja){var ka=q.quoteChar||'"';if(q.newline||(q.newline=function(ga,K){ga=ga.substring(0,1048576);var fa=new RegExp(I(K)+"([^]*?)"+I(K),"gm"),M=(ga=ga.replace(fa,"")).split("\r"),ta=ga.split(`
`),v=1<ta.length&&ta[0].length<M[0].length;if(1===M.length||v)return`
`;for(var s=0,x=0;x<M.length;x++)`
`===M[x][0]&&s++;return s>=M.length/2?`\r
`:"\r"}(T,ka)),l=!1,q.delimiter)P(q.delimiter)&&(q.delimiter=q.delimiter(T),z.meta.delimiter=q.delimiter);else{var Q=function(ga,K,fa,M,ta){var v,s,x,C;ta=ta||[",","	","|",";",i.RECORD_SEP,i.UNIT_SEP];for(var w=0;w<ta.length;w++){var U=ta[w],$=0,Z=0,ha=0;x=void 0;for(var da=new L({comments:M,delimiter:U,newline:K,preview:10}).parse(ga),sa=0;sa<da.data.length;sa++)if(fa&&Y(da.data[sa]))ha++;else{var la=da.data[sa].length;Z+=la,void 0!==x?0<la&&($+=Math.abs(la-x),x=la):x=la}0<da.data.length&&(Z/=da.data.length-ha),(void 0===s||$<=s)&&(void 0===C||C<Z)&&1.99<Z&&(s=$,v=U,C=Z)}return{successful:!!(q.delimiter=v),bestDelimiter:v}}(T,q.newline,q.skipEmptyLines,q.comments,q.delimitersToGuess);Q.successful?q.delimiter=Q.bestDelimiter:(l=!0,q.delimiter=i.DefaultDelimiter),z.meta.delimiter=q.delimiter}var S=_(q);return q.preview&&q.header&&S.preview++,r=T,h=new L(S),z=h.parse(r,ea,ja),ia(),y?{meta:{paused:!0}}:z||{meta:{paused:!1}}},this.paused=function(){return y},this.pause=function(){y=!0,h.abort(),r=P(q.chunk)?"":r.substring(h.getCharIndex())},this.resume=function(){D.streamer._halted?(y=!1,D.streamer.parseChunk(r,!0)):setTimeout(D.resume,3)},this.aborted=function(){return W},this.abort=function(){W=!0,h.abort(),z.meta.aborted=!0,P(q.complete)&&q.complete(z),r=""}}function I(q){return q.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function L(q){var r,h=(q=q||{}).delimiter,l=q.newline,j=q.comments,p=q.step,t=q.preview,n=q.fastMode,D=r=void 0===q.quoteChar?'"':q.quoteChar;if(void 0!==q.escapeChar&&(D=q.escapeChar),("string"!=typeof h||-1<i.BAD_DELIMITERS.indexOf(h))&&(h=","),j===h)throw new Error("Comment character same as delimiter");!0===j?j="#":("string"!=typeof j||-1<i.BAD_DELIMITERS.indexOf(j))&&(j=!1),`
`!==l&&"\r"!==l&&`\r
`!==l&&(l=`
`);var F=0,V=!1;this.parse=function(y,W,J){if("string"!=typeof y)throw new Error("Input must be a string");var z=y.length,H=h.length,Y=l.length,ia=j.length,na=P(p),pa=[],ma=[],T=[],ea=F=0;if(!y)return w();if(n||!1!==n&&-1===y.indexOf(r)){for(var ja=y.split(l),ka=0;ka<ja.length;ka++){if(T=ja[ka],F+=T.length,ka!==ja.length-1)F+=l.length;else if(J)return w();if(!j||T.substring(0,ia)!==j){if(na){if(pa=[],v(T.split(h)),U(),V)return w()}else v(T.split(h));if(t&&t<=ka)return pa=pa.slice(0,t),w(!0)}}return w()}for(var Q=y.indexOf(h,F),S=y.indexOf(l,F),ga=new RegExp(I(D)+I(r),"g"),K=y.indexOf(r,F);;)if(y[F]!==r)if(j&&0===T.length&&y.substring(F,F+ia)===j){if(-1===S)return w();F=S+Y,S=y.indexOf(l,F),Q=y.indexOf(h,F)}else{if(-1!==Q&&(Q<S||-1===S)){if(!(Q<K)){T.push(y.substring(F,Q)),F=Q+H,Q=y.indexOf(h,F);continue}var fa=$(Q,K,S);if(fa&&void 0!==fa.nextDelim){Q=fa.nextDelim,K=fa.quoteSearch,T.push(y.substring(F,Q)),F=Q+H,Q=y.indexOf(h,F);continue}}if(-1===S)break;if(T.push(y.substring(F,S)),C(S+Y),na&&(U(),V))return w();if(t&&pa.length>=t)return w(!0)}else for(K=F,F++;;){if(-1===(K=y.indexOf(r,K+1)))return J||ma.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:pa.length,index:F}),x();if(K===z-1)return x(y.substring(F,K).replace(ga,r));if(r!==D||y[K+1]!==D){if(r===D||0===K||y[K-1]!==D){-1!==Q&&Q<K+1&&(Q=y.indexOf(h,K+1)),-1!==S&&S<K+1&&(S=y.indexOf(l,K+1));var M=s(-1===S?Q:Math.min(Q,S));if(y[K+1+M]===h){T.push(y.substring(F,K).replace(ga,r)),y[F=K+1+M+H]!==r&&(K=y.indexOf(r,F)),Q=y.indexOf(h,F),S=y.indexOf(l,F);break}var ta=s(S);if(y.substring(K+1+ta,K+1+ta+Y)===l){if(T.push(y.substring(F,K).replace(ga,r)),C(K+1+ta+Y),Q=y.indexOf(h,F),K=y.indexOf(r,F),na&&(U(),V))return w();if(t&&pa.length>=t)return w(!0);break}ma.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:pa.length,index:F}),K++}}else K++}return x();function v(Z){pa.push(Z),ea=F}function s(Z){var ha=0;if(-1!==Z){var da=y.substring(K+1,Z);da&&""===da.trim()&&(ha=da.length)}return ha}function x(Z){return J||(void 0===Z&&(Z=y.substring(F)),T.push(Z),F=z,v(T),na&&U()),w()}function C(Z){F=Z,v(T),T=[],S=y.indexOf(l,F)}function w(Z){return{data:pa,errors:ma,meta:{delimiter:h,linebreak:l,aborted:V,truncated:!!Z,cursor:ea+(W||0)}}}function U(){p(w()),pa=[],ma=[]}function $(Z,ha,da){var sa={nextDelim:void 0,quoteSearch:void 0},la=y.indexOf(r,ha+1);if(ha<Z&&Z<la&&(la<da||-1===da)){var xa=y.indexOf(h,la);if(-1===xa)return sa;la<xa&&(la=y.indexOf(r,la+1)),sa=$(xa,la,da)}else sa={nextDelim:Z,quoteSearch:ha};return sa}},this.abort=function(){V=!0},this.getCharIndex=function(){return F}}function R(q){var r=q.data,h=g[r.workerId],l=!1;if(r.error)h.userError(r.error,r.file);else if(r.results&&r.results.data){var j={abort:function(){l=!0,N(r.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:O,resume:O};if(P(h.userStep)){for(var p=0;p<r.results.data.length&&(h.userStep({data:r.results.data[p],errors:r.results.errors,meta:r.results.meta},j),!l);p++);delete r.results}else P(h.userChunk)&&(h.userChunk(r.results,j,r.file),delete r.results)}r.finished&&!l&&N(r.workerId,r.results)}function N(q,r){var h=g[q];P(h.userComplete)&&h.userComplete(r),h.terminate(),delete g[q]}function O(){throw new Error("Not implemented.")}function _(q){if("object"!=typeof q||null===q)return q;var r=Array.isArray(q)?[]:{};for(var h in q)r[h]=_(q[h]);return r}function X(q,r){return function(){q.apply(r,arguments)}}function P(q){return"function"==typeof q}return f&&(d.onmessage=function(q){var r=q.data;void 0===i.WORKER_ID&&r&&(i.WORKER_ID=r.workerId);if("string"==typeof r.input)d.postMessage({workerId:i.WORKER_ID,results:i.parse(r.input,r.config),finished:!0});else if(d.File&&r.input instanceof File||r.input instanceof Object){var h=i.parse(r.input,r.config);h&&d.postMessage({workerId:i.WORKER_ID,results:h,finished:!0})}}),(u.prototype=Object.create(o.prototype)).constructor=u,(A.prototype=Object.create(o.prototype)).constructor=A,(B.prototype=Object.create(B.prototype)).constructor=B,(E.prototype=Object.create(o.prototype)).constructor=E,i})});var kg=ab(q=>{sb(q,{__assign:()=>c,__asyncDelegator:()=>L,__asyncGenerator:()=>I,__asyncValues:()=>R,__await:()=>G,__awaiter:()=>k,__classPrivateFieldGet:()=>X,__classPrivateFieldSet:()=>P,__createBinding:()=>m,__decorate:()=>e,__exportStar:()=>o,__extends:()=>b,__generator:()=>i,__importDefault:()=>_,__importStar:()=>O,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>A,__rest:()=>d,__spread:()=>B,__spreadArrays:()=>E,__values:()=>u});var a=function(h,l){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(j,p){j.__proto__=p}||function(j,p){for(var t in p)p.hasOwnProperty(t)&&(j[t]=p[t])},a(h,l)};function b(h,l){a(h,l);function j(){this.constructor=h}h.prototype=l===null?Object.create(l):(j.prototype=l.prototype,new j())}var c=function(){return c=Object.assign||function h(l){for(var j,p=1,t=arguments.length;p<t;p++){j=arguments[p];for(var n in j)Object.prototype.hasOwnProperty.call(j,n)&&(l[n]=j[n])}return l},c.apply(this,arguments)};function d(h,l){var j={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&l.indexOf(p)<0&&(j[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var t=0,p=Object.getOwnPropertySymbols(h);t<p.length;t++)l.indexOf(p[t])<0&&Object.prototype.propertyIsEnumerable.call(h,p[t])&&(j[p[t]]=h[p[t]]);return j}function e(h,l,j,p){var t=arguments.length,n=t<3?l:p===null?p=Object.getOwnPropertyDescriptor(l,j):p,D;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")n=Reflect.decorate(h,l,j,p);else for(var F=h.length-1;F>=0;F--)(D=h[F])&&(n=(t<3?D(n):t>3?D(l,j,n):D(l,j))||n);return t>3&&n&&Object.defineProperty(l,j,n),n}function f(h,l){return function(j,p){l(j,p,h)}}function g(h,l){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,l)}function k(h,l,j,p){function t(n){return n instanceof j?n:new j(function(D){D(n)})}return new(j||(j=Promise))(function(n,D){function F(W){try{y(p.next(W))}catch(J){D(J)}}function V(W){try{y(p.throw(W))}catch(J){D(J)}}function y(W){W.done?n(W.value):t(W.value).then(F,V)}y((p=p.apply(h,l||[])).next())})}function i(h,l){var j={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},p,t,n,D;return D={next:F(0),throw:F(1),return:F(2)},typeof Symbol==="function"&&(D[Symbol.iterator]=function(){return this}),D;function F(y){return function(W){return V([y,W])}}function V(y){if(p)throw new TypeError("Generator is already executing.");for(;j;)try{if(p=1,t&&(n=y[0]&2?t.return:y[0]?t.throw||((n=t.return)&&n.call(t),0):t.next)&&!(n=n.call(t,y[1])).done)return n;(t=0,n)&&(y=[y[0]&2,n.value]);switch(y[0]){case 0:case 1:n=y;break;case 4:return j.label++,{value:y[1],done:!1};case 5:j.label++,t=y[1],y=[0];continue;case 7:y=j.ops.pop(),j.trys.pop();continue;default:if(!(n=j.trys,n=n.length>0&&n[n.length-1])&&(y[0]===6||y[0]===2)){j=0;continue}if(y[0]===3&&(!n||y[1]>n[0]&&y[1]<n[3])){j.label=y[1];break}if(y[0]===6&&j.label<n[1]){j.label=n[1],n=y;break}if(n&&j.label<n[2]){j.label=n[2],j.ops.push(y);break}n[2]&&j.ops.pop(),j.trys.pop();continue}y=l.call(h,j)}catch(W){y=[6,W],t=0}finally{p=n=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}function m(h,l,j,p){p===void 0&&(p=j),h[p]=l[j]}function o(h,l){for(var j in h)j!=="default"&&!l.hasOwnProperty(j)&&(l[j]=h[j])}function u(h){var l=typeof Symbol==="function"&&Symbol.iterator,j=l&&h[l],p=0;if(j)return j.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")}function A(h,l){var j=typeof Symbol==="function"&&h[Symbol.iterator];if(!j)return h;var p=j.call(h),t,n=[],D;try{for(;(l===void 0||l-- >0)&&!(t=p.next()).done;)n.push(t.value)}catch(F){D={error:F}}finally{try{t&&!t.done&&(j=p.return)&&j.call(p)}finally{if(D)throw D.error}}return n}function B(){for(var h=[],l=0;l<arguments.length;l++)h=h.concat(A(arguments[l]));return h}function E(){for(var h=0,l=0,j=arguments.length;l<j;l++)h+=arguments[l].length;for(var p=Array(h),t=0,l=0;l<j;l++)for(var n=arguments[l],D=0,F=n.length;D<F;D++,t++)p[t]=n[D];return p}function G(h){return this instanceof G?(this.v=h,this):new G(h)}function I(h,l,j){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=j.apply(h,l||[]),t,n=[];return t={},D("next"),D("throw"),D("return"),t[Symbol.asyncIterator]=function(){return this},t;function D(z){p[z]&&(t[z]=function(H){return new Promise(function(Y,ia){n.push([z,H,Y,ia])>1||F(z,H)})})}function F(z,H){try{V(p[z](H))}catch(Y){J(n[0][3],Y)}}function V(z){z.value instanceof G?Promise.resolve(z.value.v).then(y,W):J(n[0][2],z)}function y(z){F("next",z)}function W(z){F("throw",z)}function J(z,H){(z(H),n.shift(),n.length)&&F(n[0][0],n[0][1])}}function L(h){var l,j;return l={},p("next"),p("throw",function(t){throw t}),p("return"),l[Symbol.iterator]=function(){return this},l;function p(t,n){l[t]=h[t]?function(D){return(j=!j)?{value:G(h[t](D)),done:t==="return"}:n?n(D):D}:n}}function R(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l=h[Symbol.asyncIterator],j;return l?l.call(h):(h=typeof u==="function"?u(h):h[Symbol.iterator](),j={},p("next"),p("throw"),p("return"),j[Symbol.asyncIterator]=function(){return this},j);function p(n){j[n]=h[n]&&function(D){return new Promise(function(F,V){D=h[n](D),t(F,V,D.done,D.value)})}}function t(n,D,F,V){Promise.resolve(V).then(function(y){n({value:y,done:F})},D)}}function N(h,l){return Object.defineProperty?Object.defineProperty(h,"raw",{value:l}):h.raw=l,h}function O(h){if(h&&h.__esModule)return h;var l={};if(h!=null)for(var j in h)Object.hasOwnProperty.call(h,j)&&(l[j]=h[j]);return l.default=h,l}function _(h){return h&&h.__esModule?h:{default:h}}function X(h,l){if(!l.has(h))throw new TypeError("attempted to get private field on non-instance");return l.get(h)}function P(h,l,j){if(!l.has(h))throw new TypeError("attempted to set private field on non-instance");return l.set(h,j),j}});var og=ab(q=>{sb(q,{__assign:()=>c,__asyncDelegator:()=>L,__asyncGenerator:()=>I,__asyncValues:()=>R,__await:()=>G,__awaiter:()=>k,__classPrivateFieldGet:()=>X,__classPrivateFieldSet:()=>P,__createBinding:()=>m,__decorate:()=>e,__exportStar:()=>o,__extends:()=>b,__generator:()=>i,__importDefault:()=>_,__importStar:()=>O,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>A,__rest:()=>d,__spread:()=>B,__spreadArrays:()=>E,__values:()=>u});var a=function(h,l){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(j,p){j.__proto__=p}||function(j,p){for(var t in p)p.hasOwnProperty(t)&&(j[t]=p[t])},a(h,l)};function b(h,l){a(h,l);function j(){this.constructor=h}h.prototype=l===null?Object.create(l):(j.prototype=l.prototype,new j())}var c=function(){return c=Object.assign||function h(l){for(var j,p=1,t=arguments.length;p<t;p++){j=arguments[p];for(var n in j)Object.prototype.hasOwnProperty.call(j,n)&&(l[n]=j[n])}return l},c.apply(this,arguments)};function d(h,l){var j={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&l.indexOf(p)<0&&(j[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var t=0,p=Object.getOwnPropertySymbols(h);t<p.length;t++)l.indexOf(p[t])<0&&Object.prototype.propertyIsEnumerable.call(h,p[t])&&(j[p[t]]=h[p[t]]);return j}function e(h,l,j,p){var t=arguments.length,n=t<3?l:p===null?p=Object.getOwnPropertyDescriptor(l,j):p,D;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")n=Reflect.decorate(h,l,j,p);else for(var F=h.length-1;F>=0;F--)(D=h[F])&&(n=(t<3?D(n):t>3?D(l,j,n):D(l,j))||n);return t>3&&n&&Object.defineProperty(l,j,n),n}function f(h,l){return function(j,p){l(j,p,h)}}function g(h,l){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,l)}function k(h,l,j,p){function t(n){return n instanceof j?n:new j(function(D){D(n)})}return new(j||(j=Promise))(function(n,D){function F(W){try{y(p.next(W))}catch(J){D(J)}}function V(W){try{y(p.throw(W))}catch(J){D(J)}}function y(W){W.done?n(W.value):t(W.value).then(F,V)}y((p=p.apply(h,l||[])).next())})}function i(h,l){var j={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},p,t,n,D;return D={next:F(0),throw:F(1),return:F(2)},typeof Symbol==="function"&&(D[Symbol.iterator]=function(){return this}),D;function F(y){return function(W){return V([y,W])}}function V(y){if(p)throw new TypeError("Generator is already executing.");for(;j;)try{if(p=1,t&&(n=y[0]&2?t.return:y[0]?t.throw||((n=t.return)&&n.call(t),0):t.next)&&!(n=n.call(t,y[1])).done)return n;(t=0,n)&&(y=[y[0]&2,n.value]);switch(y[0]){case 0:case 1:n=y;break;case 4:return j.label++,{value:y[1],done:!1};case 5:j.label++,t=y[1],y=[0];continue;case 7:y=j.ops.pop(),j.trys.pop();continue;default:if(!(n=j.trys,n=n.length>0&&n[n.length-1])&&(y[0]===6||y[0]===2)){j=0;continue}if(y[0]===3&&(!n||y[1]>n[0]&&y[1]<n[3])){j.label=y[1];break}if(y[0]===6&&j.label<n[1]){j.label=n[1],n=y;break}if(n&&j.label<n[2]){j.label=n[2],j.ops.push(y);break}n[2]&&j.ops.pop(),j.trys.pop();continue}y=l.call(h,j)}catch(W){y=[6,W],t=0}finally{p=n=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}function m(h,l,j,p){p===void 0&&(p=j),h[p]=l[j]}function o(h,l){for(var j in h)j!=="default"&&!l.hasOwnProperty(j)&&(l[j]=h[j])}function u(h){var l=typeof Symbol==="function"&&Symbol.iterator,j=l&&h[l],p=0;if(j)return j.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")}function A(h,l){var j=typeof Symbol==="function"&&h[Symbol.iterator];if(!j)return h;var p=j.call(h),t,n=[],D;try{for(;(l===void 0||l-- >0)&&!(t=p.next()).done;)n.push(t.value)}catch(F){D={error:F}}finally{try{t&&!t.done&&(j=p.return)&&j.call(p)}finally{if(D)throw D.error}}return n}function B(){for(var h=[],l=0;l<arguments.length;l++)h=h.concat(A(arguments[l]));return h}function E(){for(var h=0,l=0,j=arguments.length;l<j;l++)h+=arguments[l].length;for(var p=Array(h),t=0,l=0;l<j;l++)for(var n=arguments[l],D=0,F=n.length;D<F;D++,t++)p[t]=n[D];return p}function G(h){return this instanceof G?(this.v=h,this):new G(h)}function I(h,l,j){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=j.apply(h,l||[]),t,n=[];return t={},D("next"),D("throw"),D("return"),t[Symbol.asyncIterator]=function(){return this},t;function D(z){p[z]&&(t[z]=function(H){return new Promise(function(Y,ia){n.push([z,H,Y,ia])>1||F(z,H)})})}function F(z,H){try{V(p[z](H))}catch(Y){J(n[0][3],Y)}}function V(z){z.value instanceof G?Promise.resolve(z.value.v).then(y,W):J(n[0][2],z)}function y(z){F("next",z)}function W(z){F("throw",z)}function J(z,H){(z(H),n.shift(),n.length)&&F(n[0][0],n[0][1])}}function L(h){var l,j;return l={},p("next"),p("throw",function(t){throw t}),p("return"),l[Symbol.iterator]=function(){return this},l;function p(t,n){l[t]=h[t]?function(D){return(j=!j)?{value:G(h[t](D)),done:t==="return"}:n?n(D):D}:n}}function R(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l=h[Symbol.asyncIterator],j;return l?l.call(h):(h=typeof u==="function"?u(h):h[Symbol.iterator](),j={},p("next"),p("throw"),p("return"),j[Symbol.asyncIterator]=function(){return this},j);function p(n){j[n]=h[n]&&function(D){return new Promise(function(F,V){D=h[n](D),t(F,V,D.done,D.value)})}}function t(n,D,F,V){Promise.resolve(V).then(function(y){n({value:y,done:F})},D)}}function N(h,l){return Object.defineProperty?Object.defineProperty(h,"raw",{value:l}):h.raw=l,h}function O(h){if(h&&h.__esModule)return h;var l={};if(h!=null)for(var j in h)Object.hasOwnProperty.call(h,j)&&(l[j]=h[j]);return l.default=h,l}function _(h){return h&&h.__esModule?h:{default:h}}function X(h,l){if(!l.has(h))throw new TypeError("attempted to get private field on non-instance");return l.get(h)}function P(h,l,j){if(!l.has(h))throw new TypeError("attempted to set private field on non-instance");return l.set(h,j),j}});var ye=ab(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});var a=og();var b={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};var c=function(v,s){if(!v)throw d(s)},d=function(v){return new Error("Firebase Database ("+b.SDK_VERSION+") INTERNAL ASSERT FAILED: "+v)};var e=function(v){for(var s=[],x=0,C=0;C<v.length;C++){var w=v.charCodeAt(C);w<128?s[x++]=w:w<2048?(s[x++]=w>>6|192,s[x++]=w&63|128):(w&64512)===55296&&C+1<v.length&&(v.charCodeAt(C+1)&64512)===56320?(w=65536+((w&1023)<<10)+(v.charCodeAt(++C)&1023),s[x++]=w>>18|240,s[x++]=w>>12&63|128,s[x++]=w>>6&63|128,s[x++]=w&63|128):(s[x++]=w>>12|224,s[x++]=w>>6&63|128,s[x++]=w&63|128)}return s},f=function(v){for(var s=[],x=0,C=0;x<v.length;){var w=v[x++];if(w<128)s[C++]=String.fromCharCode(w);else if(w>191&&w<224){var U=v[x++];s[C++]=String.fromCharCode((w&31)<<6|U&63)}else if(w>239&&w<365){var U=v[x++],$=v[x++],Z=v[x++],ha=((w&7)<<18|(U&63)<<12|($&63)<<6|Z&63)-65536;s[C++]=String.fromCharCode(55296+(ha>>10)),s[C++]=String.fromCharCode(56320+(ha&1023))}else{var U=v[x++],$=v[x++];s[C++]=String.fromCharCode((w&15)<<12|(U&63)<<6|$&63)}}return s.join("")},g={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob==="function",encodeByteArray:function(v,s){if(!Array.isArray(v))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var x=s?this.byteToCharMapWebSafe_:this.byteToCharMap_,C=[],w=0;w<v.length;w+=3){var U=v[w],$=w+1<v.length,Z=$?v[w+1]:0,ha=w+2<v.length,da=ha?v[w+2]:0,sa=U>>2,la=(U&3)<<4|Z>>4,xa=(Z&15)<<2|da>>6,re=da&63;ha||(re=64,$||(xa=64)),C.push(x[sa],x[la],x[xa],x[re])}return C.join("")},encodeString:function(v,s){return this.HAS_NATIVE_SUPPORT&&!s?btoa(v):this.encodeByteArray(e(v),s)},decodeString:function(v,s){return this.HAS_NATIVE_SUPPORT&&!s?atob(v):f(this.decodeStringToByteArray(v,s))},decodeStringToByteArray:function(v,s){this.init_();for(var x=s?this.charToByteMapWebSafe_:this.charToByteMap_,C=[],w=0;w<v.length;){var U=x[v.charAt(w++)],$=w<v.length,Z=$?x[v.charAt(w)]:0;++w;var ha=w<v.length,da=ha?x[v.charAt(w)]:64;++w;var sa=w<v.length,la=sa?x[v.charAt(w)]:64;++w;if(U==null||Z==null||da==null||la==null)throw Error();var xa=U<<2|Z>>4;C.push(xa);if(da!==64){var re=Z<<4&240|da>>2;C.push(re);if(la!==64){var Cn=da<<6&192|la;C.push(Cn)}}}return C},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var v=0;v<this.ENCODED_VALS.length;v++)this.byteToCharMap_[v]=this.ENCODED_VALS.charAt(v),this.charToByteMap_[this.byteToCharMap_[v]]=v,this.byteToCharMapWebSafe_[v]=this.ENCODED_VALS_WEBSAFE.charAt(v),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[v]]=v,v>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(v)]=v,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(v)]=v)}}},k=function(v){var s=e(v);return g.encodeByteArray(s,!0)},i=function(v){try{return g.decodeString(v,!0)}catch(s){console.error("base64Decode failed: ",s)}return null};function m(v){return o(void 0,v)}function o(v,s){if(!(s instanceof Object))return s;switch(s.constructor){case Date:var x=s;return new Date(x.getTime());case Object:v===void 0&&(v={});break;case Array:v=[];break;default:return s}for(var C in s){if(!s.hasOwnProperty(C))continue;v[C]=o(v[C],s[C])}return v}var u=function(){function v(){var s=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(x,C){s.resolve=x,s.reject=C})}return v.prototype.wrapCallback=function(s){var x=this;return function(C,w){C?x.reject(C):x.resolve(w),typeof s==="function"&&(x.promise.catch(function(){}),s.length===1?s(C):s(C,w))}},v}();function A(){return typeof navigator!=="undefined"&&typeof navigator.userAgent==="string"?navigator.userAgent:""}function B(){return typeof window!=="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(A())}function E(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(v){return!1}}function G(){return typeof self==="object"&&self.self===self}function I(){var v=typeof chrome==="object"?chrome.runtime:typeof browser==="object"?browser.runtime:void 0;return typeof v==="object"&&v.id!==void 0}function L(){return typeof navigator==="object"&&navigator.product==="ReactNative"}function R(){return A().indexOf("Electron/")>=0}function N(){var v=A();return v.indexOf("MSIE ")>=0||v.indexOf("Trident/")>=0}function O(){return A().indexOf("MSAppHost/")>=0}function _(){return b.NODE_CLIENT===!0||b.NODE_ADMIN===!0}function X(){return!E()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}var P="FirebaseError",q=function(v){a.__extends(s,v);function s(x,C){var w=v.call(this,C)||this;return w.code=x,w.name=P,Object.setPrototypeOf(w,s.prototype),Error.captureStackTrace&&Error.captureStackTrace(w,r.prototype.create),w}return s}(Error),r=function(){function v(s,x,C){this.service=s,this.serviceName=x,this.errors=C}return v.prototype.create=function(s){for(var x=[],C=1;C<arguments.length;C++)x[C-1]=arguments[C];for(var w=x[0]||{},U=this.service+"/"+s,$=this.errors[s],Z=$?h($,w):"Error",ha=this.serviceName+": "+Z+" ("+U+").",da=new q(U,ha),sa=0,la=Object.keys(w);sa<la.length;sa++){var xa=la[sa];xa.slice(-1)!=="_"&&(xa in da&&console.warn('Overwriting FirebaseError base field "'+xa+'" can cause unexpected behavior.'),da[xa]=w[xa])}return da},v}();function h(v,s){return v.replace(l,function(x,C){var w=s[C];return w!=null?String(w):"<"+C+"?>"})}var l=/\{\$([^}]+)}/g;function j(v){return JSON.parse(v)}function p(v){return JSON.stringify(v)}var t=function(v){var s={},x={},C={},w="";try{var U=v.split(".");s=j(i(U[0])||""),x=j(i(U[1])||""),w=U[2],C=x.d||{},delete x.d}catch($){}return{header:s,claims:x,data:C,signature:w}},n=function(v){var s=t(v).claims,x=Math.floor(new Date().getTime()/1e3),C=0,w=0;return typeof s==="object"&&(s.hasOwnProperty("nbf")?C=s.nbf:s.hasOwnProperty("iat")&&(C=s.iat),s.hasOwnProperty("exp")?w=s.exp:w=C+86400),!!x&&!!C&&!!w&&x>=C&&x<=w},D=function(v){var s=t(v).claims;return typeof s==="object"&&s.hasOwnProperty("iat")?s.iat:null},F=function(v){var s=t(v),x=s.claims;return!!x&&typeof x==="object"&&x.hasOwnProperty("iat")},V=function(v){var s=t(v).claims;return typeof s==="object"&&s.admin===!0};function y(v,s){return Object.prototype.hasOwnProperty.call(v,s)}function W(v,s){return Object.prototype.hasOwnProperty.call(v,s)?v[s]:void 0}function J(v){for(var s in v)if(Object.prototype.hasOwnProperty.call(v,s))return!1;return!0}function z(v,s,x){var C={};for(var w in v)Object.prototype.hasOwnProperty.call(v,w)&&(C[w]=s.call(x,v[w],w,v));return C}function H(v){for(var s=[],x=function(ha,da){Array.isArray(da)?da.forEach(function(sa){s.push(encodeURIComponent(ha)+"="+encodeURIComponent(sa))}):s.push(encodeURIComponent(ha)+"="+encodeURIComponent(da))},C=0,w=Object.entries(v);C<w.length;C++){var U=w[C],$=U[0],Z=U[1];x($,Z)}return s.length?"&"+s.join("&"):""}function Y(v){var s={},x=v.replace(/^\?/,"").split("&");return x.forEach(function(C){if(C){var w=C.split("=");s[w[0]]=w[1]}}),s}var ia=function(){function v(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(var s=1;s<this.blockSize;++s)this.pad_[s]=0;this.reset()}return v.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},v.prototype.compress_=function(s,x){x||(x=0);var C=this.W_;if(typeof s==="string")for(var w=0;w<16;w++)C[w]=s.charCodeAt(x)<<24|s.charCodeAt(x+1)<<16|s.charCodeAt(x+2)<<8|s.charCodeAt(x+3),x+=4;else for(var w=0;w<16;w++)C[w]=s[x]<<24|s[x+1]<<16|s[x+2]<<8|s[x+3],x+=4;for(var w=16;w<80;w++){var U=C[w-3]^C[w-8]^C[w-14]^C[w-16];C[w]=(U<<1|U>>>31)&4294967295}for(var $=this.chain_[0],Z=this.chain_[1],ha=this.chain_[2],da=this.chain_[3],sa=this.chain_[4],la,xa,w=0;w<80;w++){w<40?w<20?(la=da^Z&(ha^da),xa=1518500249):(la=Z^ha^da,xa=1859775393):w<60?(la=Z&ha|da&(Z|ha),xa=2400959708):(la=Z^ha^da,xa=3395469782);var U=($<<5|$>>>27)+la+sa+xa+C[w]&4294967295;sa=da,da=ha,ha=(Z<<30|Z>>>2)&4294967295,Z=$,$=U}this.chain_[0]=this.chain_[0]+$&4294967295,this.chain_[1]=this.chain_[1]+Z&4294967295,this.chain_[2]=this.chain_[2]+ha&4294967295,this.chain_[3]=this.chain_[3]+da&4294967295,this.chain_[4]=this.chain_[4]+sa&4294967295},v.prototype.update=function(s,x){if(s==null)return;x===void 0&&(x=s.length);for(var C=x-this.blockSize,w=0,U=this.buf_,$=this.inbuf_;w<x;){if($===0)for(;w<=C;)this.compress_(s,w),w+=this.blockSize;if(typeof s==="string")for(;w<x;){U[$]=s.charCodeAt(w),++$,++w;if($===this.blockSize){this.compress_(U),$=0;break}}else for(;w<x;){U[$]=s[w],++$,++w;if($===this.blockSize){this.compress_(U),$=0;break}}}this.inbuf_=$,this.total_+=x},v.prototype.digest=function(){var s=[],x=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var C=this.blockSize-1;C>=56;C--)this.buf_[C]=x&255,x/=256;this.compress_(this.buf_);for(var w=0,C=0;C<5;C++)for(var U=24;U>=0;U-=8)s[w]=this.chain_[C]>>U&255,++w;return s},v}();function na(v,s){var x=new pa(v,s);return x.subscribe.bind(x)}var pa=function(){function v(s,x){var C=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=x,this.task.then(function(){s(C)}).catch(function(w){C.error(w)})}return v.prototype.next=function(s){this.forEachObserver(function(x){x.next(s)})},v.prototype.error=function(s){this.forEachObserver(function(x){x.error(s)}),this.close(s)},v.prototype.complete=function(){this.forEachObserver(function(s){s.complete()}),this.close()},v.prototype.subscribe=function(s,x,C){var w=this,U;if(s===void 0&&x===void 0&&C===void 0)throw new Error("Missing Observer.");T(s,["next","error","complete"])?U=s:U={next:s,error:x,complete:C},U.next===void 0&&(U.next=ea),U.error===void 0&&(U.error=ea),U.complete===void 0&&(U.complete=ea);var $=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{w.finalError?U.error(w.finalError):U.complete()}catch(Z){}return}),this.observers.push(U),$},v.prototype.unsubscribeOne=function(s){if(this.observers===void 0||this.observers[s]===void 0)return;delete this.observers[s],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this)},v.prototype.forEachObserver=function(s){if(this.finalized)return;for(var x=0;x<this.observers.length;x++)this.sendOne(x,s)},v.prototype.sendOne=function(s,x){var C=this;this.task.then(function(){if(C.observers!==void 0&&C.observers[s]!==void 0)try{x(C.observers[s])}catch(w){typeof console!=="undefined"&&console.error&&console.error(w)}})},v.prototype.close=function(s){var x=this;if(this.finalized)return;this.finalized=!0,s!==void 0&&(this.finalError=s),this.task.then(function(){x.observers=void 0,x.onNoObservers=void 0})},v}();function ma(v,s){return function(){for(var x=[],C=0;C<arguments.length;C++)x[C]=arguments[C];Promise.resolve(!0).then(function(){v.apply(void 0,x)}).catch(function(w){s&&s(w)})}}function T(v,s){if(typeof v!=="object"||v===null)return!1;for(var x=0,C=s;x<C.length;x++){var w=C[x];if(w in v&&typeof v[w]==="function")return!0}return!1}function ea(){}var ja=function(v,s,x,C){var w;C<s?w="at least "+s:C>x&&(w=x===0?"none":"no more than "+x);if(w){var U=v+" failed: Was called with "+C+(C===1?" argument.":" arguments.")+" Expects "+w+".";throw new Error(U)}};function ka(v,s,x){var C="";switch(s){case 1:C=x?"first":"First";break;case 2:C=x?"second":"Second";break;case 3:C=x?"third":"Third";break;case 4:C=x?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var w=v+" failed: ";return w+=C+" argument ",w}function Q(v,s,x,C){if(C&&!x)return;if(typeof x!=="string")throw new Error(ka(v,s,C)+"must be a valid firebase namespace.")}function S(v,s,x,C){if(C&&!x)return;if(typeof x!=="function")throw new Error(ka(v,s,C)+"must be a valid function.")}function ga(v,s,x,C){if(C&&!x)return;if(typeof x!=="object"||x===null)throw new Error(ka(v,s,C)+"must be a valid context object.")}var K=function(v){for(var s=[],x=0,C=0;C<v.length;C++){var w=v.charCodeAt(C);if(w>=55296&&w<=56319){var U=w-55296;C++,c(C<v.length,"Surrogate pair missing trail surrogate.");var $=v.charCodeAt(C)-56320;w=65536+(U<<10)+$}w<128?s[x++]=w:w<2048?(s[x++]=w>>6|192,s[x++]=w&63|128):w<65536?(s[x++]=w>>12|224,s[x++]=w>>6&63|128,s[x++]=w&63|128):(s[x++]=w>>18|240,s[x++]=w>>12&63|128,s[x++]=w>>6&63|128,s[x++]=w&63|128)}return s},fa=function(v){for(var s=0,x=0;x<v.length;x++){var C=v.charCodeAt(x);C<128?s++:C<2048?s+=2:C>=55296&&C<=56319?(s+=4,x++):s+=3}return s};M.CONSTANTS=b;M.Deferred=u;M.ErrorFactory=r;M.FirebaseError=q;M.Sha1=ia;M.assert=c;M.assertionError=d;M.async=ma;M.base64=g;M.base64Decode=i;M.base64Encode=k;M.contains=y;M.createSubscribe=na;M.decode=t;M.deepCopy=m;M.deepExtend=o;M.errorPrefix=ka;M.getUA=A;M.isAdmin=V;M.isBrowser=G;M.isBrowserExtension=I;M.isElectron=R;M.isEmpty=J;M.isIE=N;M.isMobileCordova=B;M.isNode=E;M.isNodeSdk=_;M.isReactNative=L;M.isSafari=X;M.isUWP=O;M.isValidFormat=F;M.isValidTimestamp=n;M.issuedAtTime=D;M.jsonEval=j;M.map=z;M.querystring=H;M.querystringDecode=Y;M.safeGet=W;M.stringLength=fa;M.stringToByteArray=K;M.stringify=p;M.validateArgCount=ja;M.validateCallback=S;M.validateContextObject=ga;M.validateNamespace=Q});var mg=ab(q=>{sb(q,{__assign:()=>c,__asyncDelegator:()=>L,__asyncGenerator:()=>I,__asyncValues:()=>R,__await:()=>G,__awaiter:()=>k,__classPrivateFieldGet:()=>X,__classPrivateFieldSet:()=>P,__createBinding:()=>m,__decorate:()=>e,__exportStar:()=>o,__extends:()=>b,__generator:()=>i,__importDefault:()=>_,__importStar:()=>O,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>A,__rest:()=>d,__spread:()=>B,__spreadArrays:()=>E,__values:()=>u});var a=function(h,l){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(j,p){j.__proto__=p}||function(j,p){for(var t in p)p.hasOwnProperty(t)&&(j[t]=p[t])},a(h,l)};function b(h,l){a(h,l);function j(){this.constructor=h}h.prototype=l===null?Object.create(l):(j.prototype=l.prototype,new j())}var c=function(){return c=Object.assign||function h(l){for(var j,p=1,t=arguments.length;p<t;p++){j=arguments[p];for(var n in j)Object.prototype.hasOwnProperty.call(j,n)&&(l[n]=j[n])}return l},c.apply(this,arguments)};function d(h,l){var j={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&l.indexOf(p)<0&&(j[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var t=0,p=Object.getOwnPropertySymbols(h);t<p.length;t++)l.indexOf(p[t])<0&&Object.prototype.propertyIsEnumerable.call(h,p[t])&&(j[p[t]]=h[p[t]]);return j}function e(h,l,j,p){var t=arguments.length,n=t<3?l:p===null?p=Object.getOwnPropertyDescriptor(l,j):p,D;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")n=Reflect.decorate(h,l,j,p);else for(var F=h.length-1;F>=0;F--)(D=h[F])&&(n=(t<3?D(n):t>3?D(l,j,n):D(l,j))||n);return t>3&&n&&Object.defineProperty(l,j,n),n}function f(h,l){return function(j,p){l(j,p,h)}}function g(h,l){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,l)}function k(h,l,j,p){function t(n){return n instanceof j?n:new j(function(D){D(n)})}return new(j||(j=Promise))(function(n,D){function F(W){try{y(p.next(W))}catch(J){D(J)}}function V(W){try{y(p.throw(W))}catch(J){D(J)}}function y(W){W.done?n(W.value):t(W.value).then(F,V)}y((p=p.apply(h,l||[])).next())})}function i(h,l){var j={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},p,t,n,D;return D={next:F(0),throw:F(1),return:F(2)},typeof Symbol==="function"&&(D[Symbol.iterator]=function(){return this}),D;function F(y){return function(W){return V([y,W])}}function V(y){if(p)throw new TypeError("Generator is already executing.");for(;j;)try{if(p=1,t&&(n=y[0]&2?t.return:y[0]?t.throw||((n=t.return)&&n.call(t),0):t.next)&&!(n=n.call(t,y[1])).done)return n;(t=0,n)&&(y=[y[0]&2,n.value]);switch(y[0]){case 0:case 1:n=y;break;case 4:return j.label++,{value:y[1],done:!1};case 5:j.label++,t=y[1],y=[0];continue;case 7:y=j.ops.pop(),j.trys.pop();continue;default:if(!(n=j.trys,n=n.length>0&&n[n.length-1])&&(y[0]===6||y[0]===2)){j=0;continue}if(y[0]===3&&(!n||y[1]>n[0]&&y[1]<n[3])){j.label=y[1];break}if(y[0]===6&&j.label<n[1]){j.label=n[1],n=y;break}if(n&&j.label<n[2]){j.label=n[2],j.ops.push(y);break}n[2]&&j.ops.pop(),j.trys.pop();continue}y=l.call(h,j)}catch(W){y=[6,W],t=0}finally{p=n=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}function m(h,l,j,p){p===void 0&&(p=j),h[p]=l[j]}function o(h,l){for(var j in h)j!=="default"&&!l.hasOwnProperty(j)&&(l[j]=h[j])}function u(h){var l=typeof Symbol==="function"&&Symbol.iterator,j=l&&h[l],p=0;if(j)return j.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")}function A(h,l){var j=typeof Symbol==="function"&&h[Symbol.iterator];if(!j)return h;var p=j.call(h),t,n=[],D;try{for(;(l===void 0||l-- >0)&&!(t=p.next()).done;)n.push(t.value)}catch(F){D={error:F}}finally{try{t&&!t.done&&(j=p.return)&&j.call(p)}finally{if(D)throw D.error}}return n}function B(){for(var h=[],l=0;l<arguments.length;l++)h=h.concat(A(arguments[l]));return h}function E(){for(var h=0,l=0,j=arguments.length;l<j;l++)h+=arguments[l].length;for(var p=Array(h),t=0,l=0;l<j;l++)for(var n=arguments[l],D=0,F=n.length;D<F;D++,t++)p[t]=n[D];return p}function G(h){return this instanceof G?(this.v=h,this):new G(h)}function I(h,l,j){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=j.apply(h,l||[]),t,n=[];return t={},D("next"),D("throw"),D("return"),t[Symbol.asyncIterator]=function(){return this},t;function D(z){p[z]&&(t[z]=function(H){return new Promise(function(Y,ia){n.push([z,H,Y,ia])>1||F(z,H)})})}function F(z,H){try{V(p[z](H))}catch(Y){J(n[0][3],Y)}}function V(z){z.value instanceof G?Promise.resolve(z.value.v).then(y,W):J(n[0][2],z)}function y(z){F("next",z)}function W(z){F("throw",z)}function J(z,H){(z(H),n.shift(),n.length)&&F(n[0][0],n[0][1])}}function L(h){var l,j;return l={},p("next"),p("throw",function(t){throw t}),p("return"),l[Symbol.iterator]=function(){return this},l;function p(t,n){l[t]=h[t]?function(D){return(j=!j)?{value:G(h[t](D)),done:t==="return"}:n?n(D):D}:n}}function R(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l=h[Symbol.asyncIterator],j;return l?l.call(h):(h=typeof u==="function"?u(h):h[Symbol.iterator](),j={},p("next"),p("throw"),p("return"),j[Symbol.asyncIterator]=function(){return this},j);function p(n){j[n]=h[n]&&function(D){return new Promise(function(F,V){D=h[n](D),t(F,V,D.done,D.value)})}}function t(n,D,F,V){Promise.resolve(V).then(function(y){n({value:y,done:F})},D)}}function N(h,l){return Object.defineProperty?Object.defineProperty(h,"raw",{value:l}):h.raw=l,h}function O(h){if(h&&h.__esModule)return h;var l={};if(h!=null)for(var j in h)Object.hasOwnProperty.call(h,j)&&(l[j]=h[j]);return l.default=h,l}function _(h){return h&&h.__esModule?h:{default:h}}function X(h,l){if(!l.has(h))throw new TypeError("attempted to get private field on non-instance");return l.get(h)}function P(h,l,j){if(!l.has(h))throw new TypeError("attempted to set private field on non-instance");return l.set(h,j),j}});var lg=ab(i=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=mg(),b=ye(),c=function(){function o(u,A,B){this.name=u,this.instanceFactory=A,this.type=B,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return o.prototype.setInstantiationMode=function(u){return this.instantiationMode=u,this},o.prototype.setMultipleInstances=function(u){return this.multipleInstances=u,this},o.prototype.setServiceProps=function(u){return this.serviceProps=u,this},o}();var d="[DEFAULT]";var e=function(){function o(u,A){this.name=u,this.container=A,this.component=null,this.instances=new Map(),this.instancesDeferred=new Map()}return o.prototype.get=function(u){u===void 0&&(u=d);var A=this.normalizeInstanceIdentifier(u);if(!this.instancesDeferred.has(A)){var B=new b.Deferred();this.instancesDeferred.set(A,B);try{var E=this.getOrInitializeService(A);E&&B.resolve(E)}catch(G){}}return this.instancesDeferred.get(A).promise},o.prototype.getImmediate=function(u){var A=a.__assign({identifier:d,optional:!1},u),B=A.identifier,E=A.optional,G=this.normalizeInstanceIdentifier(B);try{var I=this.getOrInitializeService(G);if(!I){if(E)return null;throw Error("Service "+this.name+" is not available")}return I}catch(L){if(E)return null;throw L}},o.prototype.getComponent=function(){return this.component},o.prototype.setComponent=function(u){var A,B;if(u.name!==this.name)throw Error("Mismatching Component "+u.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");this.component=u;if(g(u))try{this.getOrInitializeService(d)}catch(_){}try{for(var E=a.__values(this.instancesDeferred.entries()),G=E.next();!G.done;G=E.next()){var I=a.__read(G.value,2),L=I[0],R=I[1],N=this.normalizeInstanceIdentifier(L);try{var O=this.getOrInitializeService(N);R.resolve(O)}catch(_){}}}catch(_){A={error:_}}finally{try{G&&!G.done&&(B=E.return)&&B.call(E)}finally{if(A)throw A.error}}},o.prototype.clearInstance=function(u){u===void 0&&(u=d),this.instancesDeferred.delete(u),this.instances.delete(u)},o.prototype.delete=function(){return a.__awaiter(this,void 0,void 0,function(){var u;return a.__generator(this,function(A){switch(A.label){case 0:return u=Array.from(this.instances.values()),[4,Promise.all(u.filter(function(B){return"INTERNAL"in B}).map(function(B){return B.INTERNAL.delete()}))];case 1:return A.sent(),[2]}})})},o.prototype.isComponentSet=function(){return this.component!=null},o.prototype.getOrInitializeService=function(u){var A=this.instances.get(u);return!A&&this.component&&(A=this.component.instanceFactory(this.container,f(u)),this.instances.set(u,A)),A||null},o.prototype.normalizeInstanceIdentifier=function(u){return this.component?this.component.multipleInstances?u:d:u},o}();function f(o){return o===d?void 0:o}function g(o){return o.instantiationMode==="EAGER"}var k=function(){function o(u){this.name=u,this.providers=new Map()}return o.prototype.addComponent=function(u){var A=this.getProvider(u.name);if(A.isComponentSet())throw new Error("Component "+u.name+" has already been registered with "+this.name);A.setComponent(u)},o.prototype.addOrOverwriteComponent=function(u){var A=this.getProvider(u.name);A.isComponentSet()&&this.providers.delete(u.name),this.addComponent(u)},o.prototype.getProvider=function(u){if(this.providers.has(u))return this.providers.get(u);var A=new e(u,this);return this.providers.set(u,A),A},o.prototype.getProviders=function(){return Array.from(this.providers.values())},o}();i.Component=c;i.ComponentContainer=k;i.Provider=e});var ng=ab(u=>{sb(u,{LogLevel:()=>d,Logger:()=>i,setLogLevel:()=>m,setUserLogHandler:()=>o});function a(){for(var B=0,E=0,G=arguments.length;E<G;E++)B+=arguments[E].length;for(var I=Array(B),L=0,E=0;E<G;E++)for(var R=arguments[E],N=0,O=R.length;N<O;N++,L++)I[L]=R[N];return I}var b,c=[],d;(function(B){B[B.DEBUG=0]="DEBUG",B[B.VERBOSE=1]="VERBOSE",B[B.INFO=2]="INFO",B[B.WARN=3]="WARN",B[B.ERROR=4]="ERROR",B[B.SILENT=5]="SILENT"})(d||(d={}));var e={debug:d.DEBUG,verbose:d.VERBOSE,info:d.INFO,warn:d.WARN,error:d.ERROR,silent:d.SILENT},f=d.INFO,g=(b={},b[d.DEBUG]="log",b[d.VERBOSE]="log",b[d.INFO]="info",b[d.WARN]="warn",b[d.ERROR]="error",b),k=function(B,E){for(var G=[],I=2;I<arguments.length;I++)G[I-2]=arguments[I];if(E<B.logLevel)return;var L=new Date().toISOString(),R=g[E];if(R)console[R].apply(console,a(["["+L+"]  "+B.name+":"],G));else throw new Error("Attempted to log a message with an invalid logType (value: "+E+")")},i=function(){function B(E){this.name=E,this._logLevel=f,this._logHandler=k,this._userLogHandler=null,c.push(this)}return Object.defineProperty(B.prototype,"logLevel",{get:function(){return this._logLevel},set:function(E){if(!(E in d))throw new TypeError('Invalid value "'+E+'" assigned to `logLevel`');this._logLevel=E},enumerable:!0,configurable:!0}),B.prototype.setLogLevel=function(E){this._logLevel=typeof E==="string"?e[E]:E},Object.defineProperty(B.prototype,"logHandler",{get:function(){return this._logHandler},set:function(E){if(typeof E!=="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=E},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(E){this._userLogHandler=E},enumerable:!0,configurable:!0}),B.prototype.debug=function(){for(var E=[],G=0;G<arguments.length;G++)E[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.DEBUG],E)),this._logHandler.apply(this,a([this,d.DEBUG],E))},B.prototype.log=function(){for(var E=[],G=0;G<arguments.length;G++)E[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.VERBOSE],E)),this._logHandler.apply(this,a([this,d.VERBOSE],E))},B.prototype.info=function(){for(var E=[],G=0;G<arguments.length;G++)E[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.INFO],E)),this._logHandler.apply(this,a([this,d.INFO],E))},B.prototype.warn=function(){for(var E=[],G=0;G<arguments.length;G++)E[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.WARN],E)),this._logHandler.apply(this,a([this,d.WARN],E))},B.prototype.error=function(){for(var E=[],G=0;G<arguments.length;G++)E[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.ERROR],E)),this._logHandler.apply(this,a([this,d.ERROR],E))},B}();function m(B){c.forEach(function(E){E.setLogLevel(B)})}function o(B,E){for(var G=function(N){var O=null;E&&E.level&&(O=e[E.level]),B===null?N.userLogHandler=null:N.userLogHandler=function(_,X){for(var P=[],q=2;q<arguments.length;q++)P[q-2]=arguments[q];var r=P.map(function(h){if(h==null)return null;{if(typeof h==="string")return h;{if(typeof h==="number"||typeof h==="boolean")return h.toString();{if(h instanceof Error)return h.message;try{return JSON.stringify(h)}catch(l){return null}}}}}).filter(function(h){return h}).join(" ");X>=(O!==null&&O!==void 0?O:_.logLevel)&&B({level:d[X].toLowerCase(),message:r,args:P,type:_.name})}},I=0,L=c;I<L.length;I++){var R=L[I];G(R)}}});var jg=ab(y=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0});var a=kg(),b=ye(),c=lg(),d=ng();var e,f=(e={},e["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",e["bad-app-name"]="Illegal App name: '{$appName}",e["duplicate-app"]="Firebase App named '{$appName}' already exists",e["app-deleted"]="Firebase App named '{$appName}' already deleted",e["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",e["invalid-log-argument"]="First argument to `onLog` must be null or a function.",e),g=new b.ErrorFactory("app","Firebase",f),k="@firebase/app",i="0.6.7",m="@firebase/analytics",o="@firebase/auth",u="@firebase/database",A="@firebase/functions",B="@firebase/installations",E="@firebase/messaging",G="@firebase/performance",I="@firebase/remote-config",L="@firebase/storage",R="@firebase/firestore",N="firebase-wrapper";var O,_="[DEFAULT]",X=(O={},O[k]="fire-core",O[m]="fire-analytics",O[o]="fire-auth",O[u]="fire-rtdb",O[A]="fire-fn",O[B]="fire-iid",O[E]="fire-fcm",O[G]="fire-perf",O[I]="fire-rc",O[L]="fire-gcs",O[R]="fire-fst",O["fire-js"]="fire-js",O[N]="fire-js-all",O);var P=new d.Logger("@firebase/app");var q=function(){function J(z,H,Y){var ia,na,pa=this;this.firebase_=Y,this.isDeleted_=!1,this.name_=H.name,this.automaticDataCollectionEnabled_=H.automaticDataCollectionEnabled||!1,this.options_=b.deepCopy(z),this.container=new c.ComponentContainer(H.name),this._addComponent(new c.Component("app",function(){return pa},"PUBLIC"));try{for(var ma=a.__values(this.firebase_.INTERNAL.components.values()),T=ma.next();!T.done;T=ma.next()){var ea=T.value;this._addComponent(ea)}}catch(ja){ia={error:ja}}finally{try{T&&!T.done&&(na=ma.return)&&na.call(ma)}finally{if(ia)throw ia.error}}}return Object.defineProperty(J.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(z){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=z},enumerable:!0,configurable:!0}),Object.defineProperty(J.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(J.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),J.prototype.delete=function(){var z=this;return new Promise(function(H){z.checkDestroyed_(),H()}).then(function(){return z.firebase_.INTERNAL.removeApp(z.name_),Promise.all(z.container.getProviders().map(function(H){return H.delete()}))}).then(function(){z.isDeleted_=!0})},J.prototype._getService=function(z,H){return H===void 0&&(H=_),this.checkDestroyed_(),this.container.getProvider(z).getImmediate({identifier:H})},J.prototype._removeServiceInstance=function(z,H){H===void 0&&(H=_),this.container.getProvider(z).clearInstance(H)},J.prototype._addComponent=function(z){try{this.container.addComponent(z)}catch(H){P.debug("Component "+z.name+" failed to register with FirebaseApp "+this.name,H)}},J.prototype._addOrOverwriteComponent=function(z){this.container.addOrOverwriteComponent(z)},J.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw g.create("app-deleted",{appName:this.name_})},J}();q.prototype.name&&q.prototype.options||q.prototype.delete||console.log("dc");var r="7.15.5";function h(J){var z={},H=new Map(),Y={__esModule:!0,initializeApp:pa,app:na,registerVersion:ea,setLogLevel:d.setLogLevel,onLog:ja,apps:null,SDK_VERSION:r,INTERNAL:{registerComponent:T,removeApp:ia,components:H,useAsService:ka}};Y.default=Y,Object.defineProperty(Y,"apps",{get:ma});function ia(Q){delete z[Q]}function na(Q){Q=Q||_;if(!b.contains(z,Q))throw g.create("no-app",{appName:Q});return z[Q]}na.App=J;function pa(Q,S){S===void 0&&(S={});if(typeof S!=="object"||S===null){var ga=S;S={name:ga}}var K=S;K.name===void 0&&(K.name=_);var fa=K.name;if(typeof fa!=="string"||!fa)throw g.create("bad-app-name",{appName:String(fa)});if(b.contains(z,fa))throw g.create("duplicate-app",{appName:fa});var M=new J(Q,K,Y);return z[fa]=M,M}function ma(){return Object.keys(z).map(function(Q){return z[Q]})}function T(Q){var S,ga,K=Q.name;if(H.has(K))return P.debug("There were multiple attempts to register component "+K+"."),Q.type==="PUBLIC"?Y[K]:null;H.set(K,Q);if(Q.type==="PUBLIC"){var fa=function(s){s===void 0&&(s=na());if(typeof s[K]!=="function")throw g.create("invalid-app-argument",{appName:K});return s[K]()};Q.serviceProps!==void 0&&b.deepExtend(fa,Q.serviceProps),Y[K]=fa,J.prototype[K]=function(){for(var s=[],x=0;x<arguments.length;x++)s[x]=arguments[x];var C=this._getService.bind(this,K);return C.apply(this,Q.multipleInstances?s:[])}}try{for(var M=a.__values(Object.keys(z)),ta=M.next();!ta.done;ta=M.next()){var v=ta.value;z[v]._addComponent(Q)}}catch(s){S={error:s}}finally{try{ta&&!ta.done&&(ga=M.return)&&ga.call(M)}finally{if(S)throw S.error}}return Q.type==="PUBLIC"?Y[K]:null}function ea(Q,S,ga){var K,fa=(K=X[Q])!==null&&K!==void 0?K:Q;ga&&(fa+="-"+ga);var M=fa.match(/\s|\//),ta=S.match(/\s|\//);if(M||ta){var v=['Unable to register library "'+fa+'" with version "'+S+'":'];M&&v.push('library name "'+fa+'" contains illegal characters (whitespace or "/")'),M&&ta&&v.push("and"),ta&&v.push('version name "'+S+'" contains illegal characters (whitespace or "/")'),P.warn(v.join(" "));return}T(new c.Component(fa+"-version",function(){return{library:fa,version:S}},"VERSION"))}function ja(Q,S){if(Q!==null&&typeof Q!=="function")throw g.create("invalid-log-argument",{appName:name});d.setUserLogHandler(Q,S)}function ka(Q,S){if(S==="serverAuth")return null;var ga=S;return ga}return Y}function l(){var J=h(q);J.INTERNAL=a.__assign(a.__assign({},J.INTERNAL),{createFirebaseNamespace:l,extendNamespace:z,createSubscribe:b.createSubscribe,ErrorFactory:b.ErrorFactory,deepExtend:b.deepExtend});function z(H){b.deepExtend(J,H)}return J}var j=l();var p=function(){function J(z){this.container=z}return J.prototype.getPlatformInfoString=function(){var z=this.container.getProviders();return z.map(function(H){if(t(H)){var Y=H.getImmediate();return Y.library+"/"+Y.version}else return null}).filter(function(H){return H}).join(" ")},J}();function t(J){var z=J.getComponent();return(z===null||z===void 0?void 0:z.type)==="VERSION"}function n(J,z){J.INTERNAL.registerComponent(new c.Component("platform-logger",function(H){return new p(H)},"PRIVATE")),J.registerVersion(k,i,z),J.registerVersion("fire-js","")}if(b.isBrowser()&&self.firebase!==void 0){P.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);var D=self.firebase.SDK_VERSION;D&&D.indexOf("LITE")>=0&&P.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}var F=j.initializeApp;j.initializeApp=function(){for(var J=[],z=0;z<arguments.length;z++)J[z]=arguments[z];return b.isNode()&&P.warn(`
      Warning: This is a browser-targeted Firebase bundle but it appears it is being
      run in a Node environment.  If running in a Node environment, make sure you
      are using the bundle specified by the "main" field in package.json.
      
      If you are using Webpack, you can specify "main" as the first item in
      "resolve.mainFields":
      https://webpack.js.org/configuration/resolve/#resolvemainfields
      
      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"
      as the first item in "mainFields", e.g. ['main', 'module'].
      https://github.com/rollup/rollup-plugin-node-resolve
      `),F.apply(void 0,J)};var V=j;n(V);y.default=V;y.firebase=V});var Ja=ab((e,f)=>{"use strict";function a(g){return g&&typeof g==="object"&&"default"in g?g.default:g}var b=a(jg()),c="firebase",d="7.15.5";b.registerVersion(c,d,"app");f.exports=b});var Wk=ab((b,c)=>{var a=function(){function d(m,o){if(!k[m]){k[m]={};for(var u=0;u<m.length;u++)k[m][m.charAt(u)]=u}return k[m][o]}var e=String.fromCharCode,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",k={},i={compressToBase64:function(m){if(null==m)return"";var o=i._compress(m,6,function(u){return f.charAt(u)});switch(o.length%4){default:case 0:return o;case 1:return o+"===";case 2:return o+"==";case 3:return o+"="}},decompressFromBase64:function(m){return null==m?"":""==m?null:i._decompress(m.length,32,function(o){return d(f,m.charAt(o))})},compressToUTF16:function(m){return null==m?"":i._compress(m,15,function(o){return e(o+32)})+" "},decompressFromUTF16:function(m){return null==m?"":""==m?null:i._decompress(m.length,16384,function(o){return m.charCodeAt(o)-32})},compressToUint8Array:function(m){for(var o=i.compress(m),u=new Uint8Array(2*o.length),A=0,B=o.length;B>A;A++){var E=o.charCodeAt(A);u[2*A]=E>>>8,u[2*A+1]=E%256}return u},decompressFromUint8Array:function(m){if(null===m||void 0===m)return i.decompress(m);for(var o=new Array(m.length/2),u=0,A=o.length;A>u;u++)o[u]=256*m[2*u]+m[2*u+1];var B=[];return o.forEach(function(E){B.push(e(E))}),i.decompress(B.join(""))},compressToEncodedURIComponent:function(m){return null==m?"":i._compress(m,6,function(o){return g.charAt(o)})},decompressFromEncodedURIComponent:function(m){return null==m?"":""==m?null:(m=m.replace(/ /g,"+"),i._decompress(m.length,32,function(o){return d(g,m.charAt(o))}))},compress:function(m){return i._compress(m,16,function(o){return e(o)})},_compress:function(m,o,u){if(null==m)return"";var A,B,E,G={},I={},L="",R="",N="",O=2,_=3,X=2,P=[],q=0,r=0;for(E=0;E<m.length;E+=1)if(L=m.charAt(E),Object.prototype.hasOwnProperty.call(G,L)||(G[L]=_++,I[L]=!0),R=N+L,Object.prototype.hasOwnProperty.call(G,R))N=R;else{if(Object.prototype.hasOwnProperty.call(I,N)){if(N.charCodeAt(0)<256){for(A=0;X>A;A++)q<<=1,r==o-1?(r=0,P.push(u(q)),q=0):r++;for(B=N.charCodeAt(0),A=0;8>A;A++)q=q<<1|1&B,r==o-1?(r=0,P.push(u(q)),q=0):r++,B>>=1}else{for(B=1,A=0;X>A;A++)q=q<<1|B,r==o-1?(r=0,P.push(u(q)),q=0):r++,B=0;for(B=N.charCodeAt(0),A=0;16>A;A++)q=q<<1|1&B,r==o-1?(r=0,P.push(u(q)),q=0):r++,B>>=1}O--,0==O&&(O=Math.pow(2,X),X++),delete I[N]}else for(B=G[N],A=0;X>A;A++)q=q<<1|1&B,r==o-1?(r=0,P.push(u(q)),q=0):r++,B>>=1;O--,0==O&&(O=Math.pow(2,X),X++),G[R]=_++,N=String(L)}if(""!==N){if(Object.prototype.hasOwnProperty.call(I,N)){if(N.charCodeAt(0)<256){for(A=0;X>A;A++)q<<=1,r==o-1?(r=0,P.push(u(q)),q=0):r++;for(B=N.charCodeAt(0),A=0;8>A;A++)q=q<<1|1&B,r==o-1?(r=0,P.push(u(q)),q=0):r++,B>>=1}else{for(B=1,A=0;X>A;A++)q=q<<1|B,r==o-1?(r=0,P.push(u(q)),q=0):r++,B=0;for(B=N.charCodeAt(0),A=0;16>A;A++)q=q<<1|1&B,r==o-1?(r=0,P.push(u(q)),q=0):r++,B>>=1}O--,0==O&&(O=Math.pow(2,X),X++),delete I[N]}else for(B=G[N],A=0;X>A;A++)q=q<<1|1&B,r==o-1?(r=0,P.push(u(q)),q=0):r++,B>>=1;O--,0==O&&(O=Math.pow(2,X),X++)}for(B=2,A=0;X>A;A++)q=q<<1|1&B,r==o-1?(r=0,P.push(u(q)),q=0):r++,B>>=1;for(;;){if(q<<=1,r==o-1){P.push(u(q));break}r++}return P.join("")},decompress:function(m){return null==m?"":""==m?null:i._decompress(m.length,32768,function(o){return m.charCodeAt(o)})},_decompress:function(m,o,u){var A,B,E,G,I,L,R,N,O=[],_=4,X=4,P=3,q="",r=[],h={val:u(0),position:o,index:1};for(B=0;3>B;B+=1)O[B]=B;for(G=0,L=Math.pow(2,2),R=1;R!=L;)I=h.val&h.position,h.position>>=1,0==h.position&&(h.position=o,h.val=u(h.index++)),G|=(I>0?1:0)*R,R<<=1;switch(A=G){case 0:for(G=0,L=Math.pow(2,8),R=1;R!=L;)I=h.val&h.position,h.position>>=1,0==h.position&&(h.position=o,h.val=u(h.index++)),G|=(I>0?1:0)*R,R<<=1;N=e(G);break;case 1:for(G=0,L=Math.pow(2,16),R=1;R!=L;)I=h.val&h.position,h.position>>=1,0==h.position&&(h.position=o,h.val=u(h.index++)),G|=(I>0?1:0)*R,R<<=1;N=e(G);break;case 2:return""}for(O[3]=N,E=N,r.push(N);;){if(h.index>m)return"";for(G=0,L=Math.pow(2,P),R=1;R!=L;)I=h.val&h.position,h.position>>=1,0==h.position&&(h.position=o,h.val=u(h.index++)),G|=(I>0?1:0)*R,R<<=1;switch(N=G){case 0:for(G=0,L=Math.pow(2,8),R=1;R!=L;)I=h.val&h.position,h.position>>=1,0==h.position&&(h.position=o,h.val=u(h.index++)),G|=(I>0?1:0)*R,R<<=1;O[X++]=e(G),N=X-1,_--;break;case 1:for(G=0,L=Math.pow(2,16),R=1;R!=L;)I=h.val&h.position,h.position>>=1,0==h.position&&(h.position=o,h.val=u(h.index++)),G|=(I>0?1:0)*R,R<<=1;O[X++]=e(G),N=X-1,_--;break;case 2:return r.join("")}if(0==_&&(_=Math.pow(2,P),P++),O[N])q=O[N];else{if(N!==X)return null;q=E+E.charAt(0)}r.push(q),O[X++]=E+q.charAt(0),_--,E=q,0==_&&(_=Math.pow(2,P),P++)}}};return i}();"function"==typeof define&&define.amd?define(function(){return a}):"undefined"!=typeof c&&null!=c&&(c.exports=a)});let ug,vg=0,wg=0;const va={get:()=>ug,set:a=>{ug=a},getFrame:()=>vg,setFrame:a=>{vg=a},getElapsed:()=>wg,setElapsed:a=>{wg=a}};let Ag=0;function se(a=0){return()=>{Ag=a}}function Pc(){return Ag}let Ce="Phaser",Zk="https://phaser4.io",_k="#fff",$k="linear-gradient(#3e0081 40%, #00bcc3)";function ze(){if(Ce!==""){const a=va.get(),b=Ce==="Phaser"?" v"+a.VERSION:"";console.log(`%c${Ce}${b}%c ${Zk}`,`padding: 4px 16px; color: ${_k}; background: ${$k}`,"")}}let Fg=800,Gg=600,Hg=1;function ve(a=800,b=600,c=1){return c===0&&(c=window.devicePixelRatio),()=>{Fg=a,Gg=b,Hg=c}}function Nb(){return Fg}function Ob(){return Gg}function Pb(){return Hg}const Qe=[],Rb={add:a=>{Qe.push(a)},get:()=>Qe,clear:()=>{Qe.length=0}};let Eg;function Qc(a){Eg=a}function Ae(){return Eg}let De=.5,Ee=.5;let Bg=0;function Fe(a){Bg=a}function ic(){return Bg}function Rc(a){let b;return a&&(typeof a==="string"?b=document.getElementById(a):typeof a==="object"&&a.nodeType===1&&(b=a)),b||(b=document.body),b}let Cg;function te(a){return()=>{a&&(Cg=Rc(a))}}function Be(){return Cg}let Dg=[];function ue(a){return()=>{Dg=[].concat(a)}}function Ge(){return Dg}let bl={alpha:!1,antialias:!1,depth:!1,premultipliedAlpha:!1};function He(){return bl}class bh{constructor(a){this.stack=[],this.current=null,this.renderer=a}reset(){this.stack=[],this.current=null;const a=this.renderer,b=a.gl;b.bindFramebuffer(b.FRAMEBUFFER,null),b.viewport(0,0,a.width,a.height)}add(a,b=!0,c=0,d=0){this.stack.push({framebuffer:a,width:c,height:d}),this.set(a,b,c,d)}set(a,b=!0,c=0,d=0){const e=this.renderer,f=e.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),b&&(f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),c>0&&f.viewport(0,0,c,d),this.current=a}pop(){this.stack.pop();const a=this.stack.length;if(a>0){const b=this.stack[a-1];this.set(b.framebuffer,!1,b.width,b.height)}else this.reset()}rebind(){const a=this.renderer.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.current)}destroy(){this.stack=[]}}let ah;const Aa={get:()=>ah,set:a=>{ah=a}};function ch(a,b=[]){const c=a>>16&255,d=a>>8&255,e=a&255,f=a>16777215?a>>>24:255;return b[0]=c/255,b[1]=d/255,b[2]=e/255,b[3]=f/255,b}function Zg(a,b){return a.a===b.a&&a.b===b.b&&a.c===b.c&&a.d===b.d&&a.tx===b.tx&&a.ty===b.ty}function jh(a,b){const c=Aa.get();b||(b=c.COLOR_ATTACHMENT0);const d=c.createFramebuffer();return c.bindFramebuffer(c.FRAMEBUFFER,d),c.framebufferTexture2D(c.FRAMEBUFFER,b,c.TEXTURE_2D,a,0),c.bindFramebuffer(c.FRAMEBUFFER,null),d}function ed(a){const b=Aa.get();if(!b)return;const{parent:c,flipY:d,unpackPremultiplyAlpha:e,minFilter:f,magFilter:g,wrapS:k,wrapT:i,generateMipmap:m,isPOT:o}=a,u=c.image;let A=c.width,B=c.height;const E=b.createTexture();return b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,E),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,d),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),u?(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,u),A=u.width,B=u.height):b.texImage2D(b.TEXTURE_2D,0,b.RGBA,A,B,0,b.RGBA,b.UNSIGNED_BYTE,null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,g),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,k),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,i),m&&o&&b.generateMipmap(b.TEXTURE_2D),a.texture=E,E}function kh(a){const b=Aa.get();b&&b.isFramebuffer(a)&&b.deleteFramebuffer(a)}function Re(a){const b=Aa.get();if(!b)return;b.isTexture(a)&&b.deleteTexture(a)}function _g(a,b){return a<1||b<1?!1:(a&a-1)===0&&(b&b-1)===0}function nh(a,b=!0){const c=Aa.get();c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,a);const d=b?c.LINEAR:c.NEAREST;c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,d),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,d)}function oh(a){const b=Aa.get(),c=a.parent.image,d=c.width,e=c.height;return d>0&&e>0&&(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,a.texture),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,a.flipY),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,c)),a.texture}class dd{constructor(a,b={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1;const c=Aa.get();this.parent=a,this.isPOT=_g(a.width,a.height);const{texture:d=null,framebuffer:e=null,unpackPremultiplyAlpha:f=!0,minFilter:g=c.LINEAR,magFilter:k=c.LINEAR,wrapS:i=c.CLAMP_TO_EDGE,wrapT:m=c.CLAMP_TO_EDGE,generateMipmap:o=this.isPOT,flipY:u=!1}=b;this.minFilter=g,this.magFilter=k,this.wrapS=i,this.wrapT=m,this.generateMipmap=o,this.flipY=u,this.unpackPremultiplyAlpha=f,e&&(this.framebuffer=e),d?this.texture=d:ed(this)}setFilter(a){this.texture&&nh(this.texture,a)}create(){const a=this.texture;return a&&Re(a),ed(this)}update(){const a=this.texture;return a?oh(this):ed(this)}setIndex(a){this.dirtyIndex=a!==this.index,this.index=a}destroy(){Re(this.texture),kh(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}}class ih{constructor(a,b,c,d,e){this.batchSize=a,this.dataSize=b,this.indexSize=c,this.vertexElementSize=d,this.quadIndexSize=e,this.vertexByteSize=d*b,this.quadByteSize=this.vertexByteSize*4,this.quadElementSize=d*4,this.bufferByteSize=a*this.quadByteSize,this.create()}create(){let a=[];for(let c=0;c<this.batchSize*this.indexSize;c+=this.indexSize)a.push(c+0,c+1,c+2,c+2,c+3,c+0);this.data=new ArrayBuffer(this.bufferByteSize),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const b=Aa.get();this.vertexBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.data,b.DYNAMIC_DRAW),this.indexBuffer=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.index,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,null),a=[]}destroy(){}}class Se{constructor(a,b,c,d,e,f){this.trimmed=!1,this.texture=a,this.key=b,this.x=c,this.y=d,this.width=e,this.height=f,this.sourceSizeWidth=e,this.sourceSizeHeight=f,this.updateUVs()}setPivot(a,b){this.pivot={x:a,y:b}}setSize(a,b){this.width=a,this.height=b,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.updateUVs()}setSourceSize(a,b){this.sourceSizeWidth=a,this.sourceSizeHeight=b}setTrim(a,b,c,d,e,f){this.trimmed=!0,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.spriteSourceSizeX=c,this.spriteSourceSizeY=d,this.spriteSourceSizeWidth=e,this.spriteSourceSizeHeight=f}getExtent(a,b){const c=this.sourceSizeWidth,d=this.sourceSizeHeight;let e,f,g,k;return this.trimmed?(e=this.spriteSourceSizeX-a*c,f=e+this.spriteSourceSizeWidth,g=this.spriteSourceSizeY-b*d,k=g+this.spriteSourceSizeHeight):(e=-a*c,f=e+c,g=-b*d,k=g+d),{left:e,right:f,top:g,bottom:k}}setExtent(a){const b=a.transform,c=b.origin.x,d=b.origin.y,e=this.sourceSizeWidth,f=this.sourceSizeHeight;let g,k,i,m;this.trimmed?(g=this.spriteSourceSizeX-c*e,k=this.spriteSourceSizeY-d*f,i=this.spriteSourceSizeWidth,m=this.spriteSourceSizeHeight):(g=-c*e,k=-d*f,i=e,m=f),b.setExtent(g,k,i,m)}updateUVs(){const{x:a,y:b,width:c,height:d}=this,e=this.texture.width,f=this.texture.height;this.u0=a/e,this.v0=b/f,this.u1=(a+c)/e,this.v1=(b+d)/f}}class Xa{constructor(a,b,c){this.key="",a&&(b=a.width,c=a.height),this.image=a,this.width=b,this.height=c,this.frames=new Map(),this.data={},this.addFrame("__BASE",0,0,b,c),Rb.add(this)}addFrame(a,b,c,d,e){if(this.frames.has(a))return null;const f=new Se(this,a,b,c,d,e);return this.frames.set(a,f),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=f),f}getFrame(a){if(!a)return this.firstFrame;a instanceof Se&&(a=a.key);let b=this.frames.get(a);return b||(console.warn(`Frame missing: ${a}`),b=this.firstFrame),b}setSize(a,b){this.width=a,this.height=b;const c=this.frames.get("__BASE");c.setSize(a,b)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}}let hh;const nc={get:()=>hh,set:a=>{hh=a}};const mh={fragmentShader:`\r
#define SHADER_NAME SINGLE_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture;\r
\r
void main (void)\r
{\r
    vec4 color = texture2D(uTexture, vTextureCoord);\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`,vertexShader:`\r
#define SHADER_NAME SINGLE_QUAD_VERT\r
\r
precision highp float;\r
\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
attribute float aTextureId;\r
attribute vec4 aTintColor;\r
\r
uniform mat4 uProjectionMatrix;\r
uniform mat4 uCameraMatrix;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
void main (void)\r
{\r
    vTextureCoord = aTextureCoord;\r
    vTextureId = aTextureId;\r
    vTintColor = aTintColor;\r
\r
    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\r
}`};class cd{constructor(a={}){this.attribs={aVertexPosition:0,aTextureCoord:0,aTextureId:0,aTintColor:0},this.uniforms={uProjectionMatrix:0,uCameraMatrix:0,uTexture:0,uTime:0,uResolution:0},this.renderToFBO=!1,this.renderer=nc.get();const{batchSize:b=4096,dataSize:c=4,indexSize:d=4,vertexElementSize:e=6,quadIndexSize:f=6,fragmentShader:g=mh.fragmentShader,vertexShader:k=mh.vertexShader,width:i=Nb(),height:m=Ob(),resolution:o=Pb(),renderToFBO:u=!1}=a;this.buffer=new ih(b,c,d,e,f),this.createShaders(g,k),this.count=0,this.renderToFBO=u;const A=new Xa(null,i*o,m*o),B=new dd(A);A.binding=B,B.framebuffer=jh(B.texture),this.texture=A,this.framebuffer=B.framebuffer}createShaders(a,b){const c=this.renderer.gl,d=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(d,a),c.compileShader(d);let e=!1,f=c.getShaderInfoLog(d);f.length>0&&(e=!0,console.error(f));const g=c.createShader(c.VERTEX_SHADER);c.shaderSource(g,b),c.compileShader(g),f=c.getShaderInfoLog(d),f.length>0&&(e=!0,console.error(f));if(e)return;const k=c.createProgram();c.attachShader(k,g),c.attachShader(k,d),c.linkProgram(k),c.useProgram(k),this.program=k;for(const i of Object.keys(this.attribs)){const m=c.getAttribLocation(k,i);c.enableVertexAttribArray(m),this.attribs[i]=m}for(const i of Object.keys(this.uniforms))this.uniforms[i]=c.getUniformLocation(k,i)}bind(a,b,c){if(!this.program)return!1;const d=this.renderer,e=d.gl,f=this.uniforms;return e.useProgram(this.program),e.uniformMatrix4fv(f.uProjectionMatrix,!1,a),e.uniformMatrix4fv(f.uCameraMatrix,!1,b),e.uniform1i(f.uTexture,d.textures.textureIndex[c]),e.uniform1f(f.uTime,performance.now()),e.uniform2f(f.uResolution,d.width,d.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}bindBuffers(a,b){const c=this.renderer.gl,d=this.buffer.vertexByteSize,e=this.attribs;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a),c.bindBuffer(c.ARRAY_BUFFER,b),c.vertexAttribPointer(e.aVertexPosition,2,c.FLOAT,!1,d,0),c.vertexAttribPointer(e.aTextureCoord,2,c.FLOAT,!1,d,8),c.vertexAttribPointer(e.aTextureId,1,c.FLOAT,!1,d,16),c.vertexAttribPointer(e.aTintColor,4,c.UNSIGNED_BYTE,!0,d,20),this.count=0}draw(a){const b=this.renderer,c=b.gl,d=this.buffer;if(a===d.batchSize)c.bufferData(c.ARRAY_BUFFER,d.data,c.DYNAMIC_DRAW);else{const e=d.vertexViewF32.subarray(0,a*d.quadElementSize);c.bufferSubData(c.ARRAY_BUFFER,0,e)}this.renderToFBO&&b.fbo.add(this.framebuffer,!0),c.drawElements(c.TRIANGLES,a*d.quadIndexSize,c.UNSIGNED_SHORT,0),this.renderToFBO&&b.fbo.pop()}flush(){const a=this.count;return a===0?!1:(this.draw(a),this.prevCount=a,this.count=0,!0)}}const ll=`\r
#define SHADER_NAME MULTI_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture[%count%];\r
\r
void main (void)\r
{\r
    vec4 color;\r
\r
    %forloop%\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`;class dh extends cd{constructor(a={fragmentShader:ll}){super(a)}createShaders(a,b){const c=ic();let d="";for(let e=1;e<c;e++)e>1&&(d+=`
	else `),e<c-1&&(d+=`if (vTextureId < ${e}.5)`),d+=`
	{`,d+=`
		color = texture2D(uTexture[${e}], vTextureCoord);`,d+=`
	}`;a=a.replace(/%count%/gi,`${c}`),a=a.replace(/%forloop%/gi,d),super.createShaders(a,b)}bind(a,b){if(!this.program)return!1;const c=this.renderer,d=c.gl,e=this.uniforms;return d.useProgram(this.program),d.uniformMatrix4fv(e.uProjectionMatrix,!1,a),d.uniformMatrix4fv(e.uCameraMatrix,!1,b),d.uniform1iv(e.uTexture,c.textures.textureIndex),d.uniform1f(e.uTime,performance.now()),d.uniform2f(e.uResolution,c.width,c.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}}function eh(a,b,c=-1,d=1){const e=-2*(1/-a),f=-2*(1/b),g=2*(1/(c-d));return new Float32Array([e,0,0,0,0,f,0,0,0,0,g,0,-1,1,0,1])}class fh{constructor(a,b){this.renderer=a;const c={shader:new b()};this.stack=[c],this.currentEntry=c,this.current=c.shader,this.singleQuadShader=new cd()}add(a,b){const c={shader:a,textureID:b};return this.stack.push(c),c}set(a,b){this.flush();const c=this.renderer,d=c.projectionMatrix,e=c.currentCamera.matrix,f=a.bind(d,e,b);if(f){const g=this.add(a,b);this.currentEntry=g,this.current=a}return f}setDefault(a){this.set(this.singleQuadShader,a)}pop(){this.flush();const a=this.stack;a.length>1&&a.pop(),this.currentEntry=a[a.length-1],this.current=this.currentEntry.shader}reset(){this.pop(),this.rebind()}flush(){return this.current.flush()?(this.renderer.flushTotal++,!0):!1}rebind(){const a=this.renderer,b=a.projectionMatrix,c=a.currentCamera.matrix,d=this.currentEntry;d.shader.bind(b,c,d.textureID)}popAndRebind(){this.pop(),this.rebind()}clear(){}destroy(){}}const jl=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function kl(a){let b="";for(let c=0;c<a;++c)c>0&&(b+=`
else `),c<a-1&&(b+=`if(test == ${c}.0){}`);return b}function lh(a,b){const c=b.createShader(b.FRAGMENT_SHADER);for(;;){const d=jl.replace(/%forloop%/gi,kl(a));b.shaderSource(c,d),b.compileShader(c);if(!b.getShaderParameter(c,b.COMPILE_STATUS))a=a/2|0;else break}return a}class gh{constructor(a){this.startActiveTexture=0,this.renderer=a,this.tempTextures=[],this.textureIndex=[]}init(){const a=this.renderer.gl;let b=lh(a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),a);const c=ic();c===0||c>0&&c>b?Fe(b):c>0&&c<b&&(b=Math.max(8,c));const d=this.tempTextures;d.length&&d.forEach(f=>{a.deleteTexture(f)});const e=[];for(let f=0;f<b;f++){const g=a.createTexture();a.activeTexture(a.TEXTURE0+f),a.bindTexture(a.TEXTURE_2D,g),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),d[f]=g,e.push(f)}this.maxTextures=b,this.textureIndex=e,this.currentActiveTexture=1}update(){const a=Rb.get();for(let b=0;b<a.length;b++){const c=a[b];c.binding||(c.binding=new dd(c))}Rb.clear()}reset(){const a=this.renderer.gl,b=this.tempTextures;for(let c=0;c<b.length;c++)a.activeTexture(a.TEXTURE0+c),a.bindTexture(a.TEXTURE_2D,b[c]);this.currentActiveTexture=1,this.startActiveTexture++}bind(a,b=0){const c=this.renderer.gl,d=a.binding;d.setIndex(b),c.activeTexture(c.TEXTURE0+b),c.bindTexture(c.TEXTURE_2D,d.texture)}unbind(a=0){const b=this.renderer.gl;b.activeTexture(b.TEXTURE0+a),b.bindTexture(b.TEXTURE_2D,this.tempTextures[a]),a>0&&this.startActiveTexture++}request(a){const b=this.renderer.gl,c=a.binding,d=this.currentActiveTexture;return c.indexCounter>=this.startActiveTexture?!1:(c.indexCounter=this.startActiveTexture,d<this.maxTextures?(c.setIndex(d),b.activeTexture(b.TEXTURE0+d),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture++):(this.renderer.flush(),this.startActiveTexture++,c.indexCounter=this.startActiveTexture,c.setIndex(1),b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture=2),!0)}}class Ig{constructor(){this.clearColor=[0,0,0,1],this.flushTotal=0,this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.currentCamera=null,this.width=Nb(),this.height=Ob(),this.resolution=Pb(),this.setBackgroundColor(Pc());const a=document.createElement("canvas");a.addEventListener("webglcontextlost",b=>this.onContextLost(b),!1),a.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=a,this.fbo=new bh(this),this.textures=new gh(this),this.initContext(),nc.set(this),this.shaders=new fh(this,dh)}initContext(){const a=this.canvas.getContext("webgl",He());Aa.set(a),this.gl=a,a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE),this.resize(this.width,this.height,this.resolution),this.textures.init()}resize(a,b,c=1){this.width=a*c,this.height=b*c,this.resolution=c;const d=this.canvas;d.width=this.width,d.height=this.height,this.autoResize&&(d.style.width=(this.width/c).toString()+"px",d.style.height=(this.height/c).toString()+"px"),this.gl.viewport(0,0,this.width,this.height),this.projectionMatrix=eh(a,b)}onContextLost(a){a.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(a){return ch(a,this.clearColor),this}reset(a=null,b=this.width,c=this.height){const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),d.viewport(0,0,b,c),d.enable(d.BLEND),d.blendFunc(d.ONE,d.ONE_MINUS_SRC_ALPHA),this.flushTotal=0,this.currentCamera=null,this.textures.update()}render(a){if(this.contextLost)return;this.reset();if(this.optimizeRedraw&&a.numDirtyFrames===0&&a.numDirtyCameras===0)return;const b=this.gl;if(this.clearBeforeRender){const d=this.clearColor;b.clearColor(d[0],d[1],d[2],d[3]),b.clear(b.COLOR_BUFFER_BIT)}const c=a.worldData;for(let d=0;d<c.length;d++){const{camera:e,renderList:f}=c[d];(!this.currentCamera||!Zg(e.worldTransform,this.currentCamera.worldTransform))&&(this.flush(),this.currentCamera=e,this.shaders.rebind()),f.forEach(g=>{g.children.length?this.renderNode(g):g.node.renderGL(this)})}this.flush()}renderNode(a){a.node.renderGL(this),a.children.forEach(b=>{b.children.length>0?this.renderNode(b):b.node.renderGL(this)}),a.node.postRenderGL(this)}flush(){this.shaders.flush()}destroy(){nc.set(void 0)}}function we(){return()=>{Qc(Ig)}}function ya(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);for(const e of d)e.callback.apply(e.context,c),e.once&&d.delete(e);return d.size===0&&a.events.delete(b),!0}function pg(a,b){const c=Rc(b);return c.appendChild(a),a}function qg(a){const b=document.readyState;if(b==="complete"||b==="interactive"){a();return}const c=()=>{document.removeEventListener("deviceready",c,!0),document.removeEventListener("DOMContentLoaded",c,!0),window.removeEventListener("load",c,!0),a()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",c,!0):(document.addEventListener("DOMContentLoaded",c,!0),window.addEventListener("load",c,!0)):window.setTimeout(c,20)}class rg{constructor(){this.events=new Map()}}class Tc{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function Qb(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new Tc(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function Vc(a,b,c,d=a){return Qb(a,b,c,d,!0)}function ph(){return{gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]}}function sh(a,b=0){a.gameFrame=b,a.numTotalFrames=0,a.numDirtyFrames=0,a.numDirtyCameras=0,a.worldData.length=0}let th;const fd={get:()=>th,set:a=>{th=a}};class sg{constructor(){this.scenes=new Map(),this.sceneIndex=0,this.flush=!1,this.renderResult=ph(),this.game=va.get(),fd.set(this),Vc(this.game,"boot",()=>this.boot())}boot(){Ge().forEach(a=>new a())}update(a,b){for(const c of this.scenes.values())ya(c,"update",a,b)}render(a){const b=this.renderResult;sh(b,a);for(const c of this.scenes.values())ya(c,"render",b);return this.flush&&(b.numDirtyFrames++,this.flush=!1),b}}function pc(a,b){const c=document.createElement("canvas");return c.width=a,c.height=b,c.getContext("2d")}let uh;const jb={get:()=>uh,set:a=>{uh=a}};class tg{constructor(){this.textures=new Map(),this.createDefaultTextures(),jb.set(this)}createDefaultTextures(){this.add("__BLANK",new Xa(pc(32,32).canvas));const a=pc(32,32);a.strokeStyle="#0f0",a.moveTo(0,0),a.lineTo(32,32),a.stroke(),a.strokeRect(.5,.5,31,31),this.add("__MISSING",new Xa(a.canvas))}get(a){const b=this.textures;return b.has(a)?b.get(a):b.get("__MISSING")}has(a){return this.textures.has(a)}add(a,b){let c;const d=this.textures;return d.has(a)||(b instanceof Xa?c=b:c=new Xa(b),c.key=a,d.set(a,c)),c}}class hg extends rg{constructor(...a){super();this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,va.set(this),qg(()=>this.boot(a))}boot(a){a.forEach(d=>d());const b=Ae();this.renderer=new b(),this.textureManager=new tg(),this.sceneManager=new sg();const c=Be();c&&pg(this.renderer.canvas,c),this.isBooted=!0,ze(),ya(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(a){const b=a-this.lastTick;this.lastTick=a,this.elapsed+=b,this.isPaused||(this.willUpdate&&(this.sceneManager.update(b,a),ya(this,"update",b,a)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,va.setFrame(this.frame),va.setElapsed(this.elapsed),requestAnimationFrame(c=>this.step(c))}destroy(){}}function qh(a,b,c){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:c}function rh(a,b={}){const c=fd.get(),d=c.scenes.size,e=c.sceneIndex,f=d===0;typeof b==="string"?a.key=b:(b||!b&&f)&&(a.key=qh(b,"key","scene"+e.toString())),c.scenes.has(a.key)?console.warn("Scene key already in use: "+a.key):(c.scenes.set(a.key,a),c.flush=!0,c.sceneIndex++)}class ig{constructor(a){this.game=va.get(),this.events=new Map(),rh(this,a)}}class tb{constructor(a=1,b=0,c=0,d=1,e=0,f=0){this.set(a,b,c,d,e,f)}set(a=1,b=0,c=0,d=1,e=0,f=0){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=e,this.ty=f,this}identity(){return this.set()}toArray(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]}fromArray(a){return this.set(a[0],a[1],a[2],a[3],a[4],a[5])}}function $c(a,b,c){return a.width<=0||a.height<=0?!1:a.x<=b&&a.x+a.width>=b&&a.y<=c&&a.y+a.height>=c}class Ga{constructor(a=0,b=0,c=0,d=0){this.set(a,b,c,d)}set(a=0,b=0,c=0,d=0){return this.x=a,this.y=b,this.width=c,this.height=d,this}contains(a,b){return $c(this,a,b)}set right(a){a<=this.x?this.width=0:this.width=a-this.x}get right(){return this.x+this.width}set bottom(a){a<=this.y?this.height=0:this.height=a-this.y}get bottom(){return this.y+this.height}}function $g(){}class db{constructor(a,b=0,c=0,d=!1){this.compareValue=!1,this._x=b,this._y=c,this.callback=a,this.compareValue=d}set(a=0,b=0){return this._x=a,this._y=b,this.callback(this),this}destroy(){this.callback=$g}set x(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._x=a,this.callback(this))}get x(){return this._x}set y(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._y=a,this.callback(this))}get y(){return this._y}}function Yg(a,b,c){const d=c-b;return b+((a-b)%d+d)%d}function xg(a){return Yg(a,-Math.PI,Math.PI)}class yg{constructor(){this._rotation=0,this.type="Camera",this.dirtyRender=!0;const a=va.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1]),this.bounds=new Ga(),this.worldTransform=new tb(),this.position=new db(()=>this.updateTransform(),0,0),this.scale=new db(()=>this.updateTransform(),1,1),this.origin=new db(()=>this.updateTransform(),.5,.5),this.reset()}updateTransform(){const a=this.matrix,b=this.position.x,c=this.position.y,d=this.scale.x,e=this.scale.y,f=-b+this.width*this.origin.x,g=-c+this.height*this.origin.y,k=Math.sin(this.rotation),i=Math.cos(this.rotation),m=k+k,o=k*m,u=i*m,A=(1-o)*d,B=u*d,E=-u*e,G=(1-o)*e;a[0]=A,a[1]=B,a[4]=E,a[5]=G,a[12]=b+f-(A*f+E*g),a[13]=c+g-(B*f+G*g),this.worldTransform.set(i*d,k*d,-k*e,i*e,-b,-c);const I=this.width*(1/d),L=this.height*(1/e);this.bounds.set(f-I/2,g-L/2,I,L),this.dirtyRender=!0}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}set rotation(a){a!==this._rotation&&(this._rotation=xg(a),this.updateTransform())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.origin.destroy(),this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}class zg{constructor(){this.type="StaticCamera",this.dirtyRender=!0;const a=va.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.bounds=new Ga(),this.worldTransform=new tb(),this.reset()}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}function vb(a){const b=[a],c=[];for(;b.length>0;){const d=b.shift();c.push(d);const e=d.numChildren;if(e>0)for(let f=e-1;f>=0;f--)b.unshift(d.children[f])}return c.shift(),c}function eb(a,b){return a.children.indexOf(b)}function Sc(a,b){const c=a.children;let d;if(b>=0&&b<c.length){const e=c.splice(b,1);e[0]&&(d=e[0],d.parent=null)}return d}function kc(a,b){const c=eb(a,b);return c>-1&&Sc(a,c),b}const Me="addedtoworld";const Wc="destroy";const Pg="postupdate";const Ne="removedfromworld";const Qg="update";function Le(a,...b){return b.forEach(c=>{c.world&&(ya(c.world,Ne,c,c.world),ya(c,Ne,c,c.world)),c.world=a,ya(a,Me,c,a),ya(c,Me,c,a)}),b}function ub(a,...b){b.forEach(d=>{d.parent&&kc(d.parent,d),d.parent=a});const c=a.world;return c&&Le(c,...vb(a)),b}const aa={CLEAR:0,TRANSFORM:1,UPDATE:2,CHILD_CACHE:4,POST_RENDER:8,COLORS:16,BOUNDS:32,TEXTURE:64,FRAME:128,ALPHA:256,CHILD:512,DEFAULT:1+2+16+32,USER1:536870912,USER2:1073741824,USER3:2147483648,USER4:4294967296};function jc(a,b=0,c){const d=a.children;c===void 0&&(c=d.length);const e=c-b;if(e>0&&e<=c){const f=d.splice(b,e);return f.forEach(g=>{g.parent=null}),f}else return[]}function Ie(a,b=0,c){const d=jc(a,b,c);d.forEach(e=>{e.destroy()})}function Je(a,...b){return b.forEach(c=>{kc(a,c)}),b}function Ke(a,b,c=0,d){const e=jc(a,c,d);return ub(b,...e),e.forEach(f=>{f.transform.updateWorld()}),e}function Uc(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof Tc)g.delete(c);else{const k=!d,i=e!==void 0;for(const m of g)m.callback===c&&(k&&m.context===d)&&(i&&m.once===e)&&g.delete(m)}return g.size===0&&f.delete(b),a}function Yc(a){const{a:b,b:c,c:d,d:e,tx:f,ty:g}=a.world,{x:k,y:i,right:m,bottom:o}=a.extent,u=k*b+i*d+f,A=k*c+i*e+g,B=k*b+o*d+f,E=k*c+o*e+g,G=m*b+o*d+f,I=m*c+o*e+g,L=m*b+i*d+f,R=m*c+i*e+g;return{x0:u,y0:A,x1:B,y1:E,x2:G,y2:I,x3:L,y3:R}}class Jg{constructor(a){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=a,this.area=new Ga()}set(a,b,c,d){this.area.set(a,b,c,d)}get(){return this.entity.isDirty(aa.BOUNDS)&&!this.fixed&&this.update(),this.area}updateLocal(){const{x0:a,y0:b,x1:c,y1:d,x2:e,y2:f,x3:g,y3:k}=Yc(this.entity.transform),i=Math.min(a,c,e,g),m=Math.min(b,d,f,k),o=Math.max(a,c,e,g),u=Math.max(b,d,f,k);return this.area.set(i,m,o-i,u-m)}update(){const a=this.updateLocal();this.entity.clearDirty(aa.BOUNDS);if(!this.includeChildren||!this.entity.numChildren)return a;const b=this.visibleOnly,c=this.entity.children;let d=a.x,e=a.y,f=a.right,g=a.bottom;for(let k=0;k<c.length;k++){const i=c[k];if(!i||b&&!i.visible)continue;const m=i.bounds.get();m.x<d&&(d=m.x),m.y<e&&(e=m.y),m.right>f&&(f=m.right),m.bottom>g&&(g=m.bottom)}return a.set(d,e,f-d,g-e)}destroy(){this.entity=null,this.area=null}}class Kg{constructor(a){this.enabled=!1,this.enabledChildren=!0,this.entity=a}destroy(){this.entity=null,this.hitArea=null}}class Wa{constructor(a=0,b=0){this.set(a,b)}set(a=0,b=0){return this.x=a,this.y=b,this}getArray(){return[this.x,this.y]}fromArray(a){return this.set(a[0],a[1])}toString(){return`[x=${this.x}, y=${this.y}]`}}function Mg(a){const b=a.local,c=a.position.x,d=a.position.y,e=a.rotation,f=a.scale.x,g=a.scale.y,k=a.skew.x,i=a.skew.y;b.set(Math.cos(e+i)*f,Math.sin(e+i)*f,-Math.sin(e-k)*g,Math.cos(e-k)*g,c,d)}function Oe(a,b){return b.set(a.a,a.b,a.c,a.d,a.tx,a.ty)}function Ng(a){const b=a.parent,c=a.transform,d=c.local,e=c.world;if(!b)Oe(d,e);else if(c.passthru)Oe(b.transform.world,e);else{const{a:f,b:g,c:k,d:i,tx:m,ty:o}=d,{a:u,b:A,c:B,d:E,tx:G,ty:I}=b.transform.world;e.set(f*u+g*B,f*A+g*E,k*u+i*B,k*A+i*E,m*u+o*B+G,m*A+o*E+I)}}class Lg{constructor(a,b=0,c=0){this.passthru=!1,this._rotation=0,this.entity=a,this.local=new tb(),this.world=new tb(),this.position=new db(()=>this.update(),b,c),this.scale=new db(()=>this.update(),1,1,!0),this.skew=new db(()=>this.update(),0,0,!0),this.origin=new db(()=>this.updateExtent(),De,Ee),this.extent=new Ga()}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(aa.TRANSFORM,aa.BOUNDS),Mg(this)}updateWorld(){const a=this.entity;a.setDirty(aa.TRANSFORM,aa.BOUNDS),Ng(a),a.numChildren&&this.updateChildren()}updateChildren(){const a=this.entity.children;for(let b=0;b<a.length;b++){const c=a[b];c.transform.updateWorld()}}globalToLocal(a,b,c=new Wa()){const{a:d,b:e,c:f,d:g,tx:k,ty:i}=this.world,m=1/(d*g+f*-e);return c.x=g*m*a+-f*m*b+(i*f-k*g)*m,c.y=d*m*b+-e*m*a+(-i*d+k*e)*m,c}localToGlobal(a,b,c=new Wa()){const{a:d,b:e,c:f,d:g,tx:k,ty:i}=this.world;return c.x=d*a+f*b+k,c.y=e*a+g*b+i,c}setExtent(a,b,c,d){this.extent.set(a,b,c,d),this.entity.setDirty(aa.TRANSFORM,aa.BOUNDS)}updateExtent(a,b){const c=this.extent,d=this.entity;a!==void 0&&(c.width=a),b!==void 0&&(c.height=b),c.x=-this.origin.x*c.width,c.y=-this.origin.y*c.height,d.setDirty(aa.TRANSFORM,aa.BOUNDS)}set rotation(a){a!==this._rotation&&(this._rotation=a,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}}class Xc{constructor(a=0,b=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.events=new Map(),this.transform=new Lg(this,a,b),this.bounds=new Jg(this),this.input=new Kg(this),this.dirty=aa.DEFAULT,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(a){return(this.dirty&a)!==0}clearDirty(a){return this.isDirty(a)&&(this.dirty^=a),this}setDirty(a,b){return this.isDirty(a)||(this.dirty^=a,this.dirtyFrame=va.getFrame()),this.isDirty(b)||(this.dirty^=b),this}update(a,b){if(this.willUpdateChildren){const c=this.children;for(let d=0;d<c.length;d++){const e=c[d];e&&e.willUpdate&&e.update(a,b)}}this.postUpdate(a,b)}postUpdate(a,b){}renderGL(a){}renderCanvas(a){}postRenderGL(a){}postRenderCanvas(a){}get numChildren(){return this.children.length}destroy(a){a?Ke(this,a):Ie(this),ya(this,Wc,this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}}const ad="worldrender";const bd="worldshutdown";var il=Object.freeze({__proto__:null,WorldRenderEvent:ad,WorldShutdownEvent:bd});function gd(a,b){b.numRendered++,b.numRenderable++,a.node.dirtyFrame>=b.gameFrame&&b.dirtyFrame++,a.children.forEach(c=>{c.children.length>0&&gd(c,b)})}function We(a){if(a.node.isDirty(aa.CHILD_CACHE))return!0;const b=[a];for(;b.length>0;){const c=b.pop();if(c.node.isDirty(aa.TRANSFORM))return!0;const d=c.children.length;if(d>0)for(let e=0;e<d;e++)b.push(c.children[e])}return b.length=0,!1}function Ve(a,b){a.forEach(c=>{b||We(c)?c.node.setDirty(aa.CHILD_CACHE):c.children.length=0})}function hd(a,b,c=[]){for(let d=0;d<b.numChildren;d++){const e=b.children[d];if(e.isRenderable()){const f=[],g={node:e,children:f};c.push(g),e.willRenderChildren&&e.numChildren>0&&(e.willCacheChildren&&a.push(g),hd(a,e,f))}}return c}function Te(a){const b=[],c=[],d=hd(b,a,c),e=a.renderData;b.length>0&&Ve(b,a.camera.dirtyRender),d.forEach(f=>{f.children.length?gd(f,e):(e.numRendered++,e.numRenderable++,f.node.dirtyFrame>=e.gameFrame&&e.dirtyFrame++)}),e.renderList=d,a.forceRefresh&&(e.dirtyFrame++,a.forceRefresh=!1)}function Ue(a,b){a.numDirtyFrames+=b.dirtyFrame,a.numTotalFrames+=b.numRendered,b.camera.dirtyRender&&a.numDirtyCameras++,a.worldData.push(b)}function qc(a,b){a.gameFrame=b,a.dirtyFrame=0,a.numRendered=0,a.numRenderable=0,a.renderList.length=0}class rc extends Xc{constructor(a){super();this.forceRefresh=!1,this.type="BaseWorld",this.scene=a,this.world=this,this.events=new Map(),this._updateListener=Qb(a,"update",(b,c)=>this.update(b,c)),this._renderListener=Qb(a,"render",b=>this.render(b)),this._shutdownListener=Qb(a,"shutdown",()=>this.shutdown()),Vc(a,"destroy",()=>this.destroy())}update(a,b){if(!this.willUpdate)return;ya(this,Qg,a,b,this),super.update(a,b)}postUpdate(a,b){ya(this,Pg,a,b,this)}render(a){const b=this.renderData;qc(b,a.gameFrame);if(!this.willRender||!this.visible)return;Te(this),ya(this,ad,b,this),Ue(a,b),this.camera&&(this.camera.dirtyRender=!1)}shutdown(){const a=this.scene;Uc(a,"update",this._updateListener),Uc(a,"render",this._renderListener),Uc(a,"shutdown",this._shutdownListener),Je(this),ya(this,bd,this),qc(this.renderData,0),this.camera&&this.camera.reset()}destroy(a){super.destroy(a),ya(this,Wc,this),qc(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}}function sc(a){return{camera:a,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0,renderList:[]}}class xe extends rc{constructor(a){super(a);this.type="StaticWorld",this.camera=new zg(),this.renderData=sc(this.camera)}}class ml extends rc{constructor(a){super(a);this.enableCameraCull=!0,this.type="World",this.camera=new yg(),this.renderData=sc(this.camera)}}function hc(a,b){return a.children.push(b),ub(a,b),b.transform.updateWorld(),b}var Xf;(function(a){a[a.IDLE=0]="IDLE",a[a.UPDATING=1]="UPDATING"})(Xf||(Xf={}));function Pa(a,b){return a===void 0||b===void 0?void 0:`${a}|${b}`}function xi(a,b){let c=a.split("|");return b===void 0&&(b=jm),b.x=parseInt(c[0]),b.y=parseInt(c[1]),b}let jm={x:0,y:0};class Lb{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(a){return this.items.push(a),this}pushMultiple(a){return this.items.push.apply(this.items,a),a.length=0,this}clear(){return this.items.length=0,this}}let Uk=new Lb();function Fh(){let a=Uk.pop();return a===null&&(a=new Map()),a}function Ad(a){Uk.push(a)}function Dh(a,b,c,d,e,f,g,k){if(c===f&&d===g&&e===k)return;let i=Pa(c,d),m=Pa(f,g);if(i){let o=b.get(i);o.delete(e);if(i===m){o.set(k,a);return}else o.size===0&&(Ad(o),b.delete(i))}if(m){let o=b.get(m);o?o.set(k,a):(o=Fh(),o.set(k,a),b.set(m,o))}}function of(a,b,c,d){let e=Pa(b,c),f=a.get(e);f&&(d!==void 0?(f.delete(d),f.size===0&&(Ad(f),a.delete(e))):(f.clear(),Ad(f),a.delete(e)))}let Vk=new Lb();function Eh(){let a=Vk.pop();return a===null&&(a=new Set()),a}function nf(a){Vk.push(a)}function zd(a,b,c,d){if(c===d)return;if(c!==void 0){let e=b.get(c);e&&(e.delete(a),e.size===0&&(nf(e),b.delete(c)))}if(d!==void 0){let e=b.get(d);e?e.add(a):(e=Eh(),e.add(a),b.set(d,e))}}function zb(a,b,c){let d=a.get(b);d&&(d.delete(c),d.size===0&&(nf(d),a.delete(b)))}function yh(a,b,c,d,e){let f=a.chessToXYZ.get(b),g=f?f.x:void 0,k=f?f.y:void 0,i=f?f.y:void 0;f?(f.x=c,f.y=d,f.z=e):a.chessToXYZ.set(b,{x:c,y:d,z:e}),Dh(b,a.XYToZMap,g,k,i,c,d,e),zd(b,a.XToChessSet,g,c),zd(b,a.YToChessSet,k,d),zd(b,a.ZToChessSet,i,e)}function yb(a,b,c,d){let e=a.XYToZMap.get(Pa(b,c));return e===void 0?null:d!==void 0?e.has(d)?e.get(d):null:e}function zh(a,b,c,d){if(d!==void 0){let e=yb(a,b,c,d);if(e===void 0)return;a.chessToXYZ.delete(e),of(a.XYToZMap,b,c,d),zb(a.XToChessSet,b,e),zb(a.YToChessSet,c,e),zb(a.ZToChessSet,d,e)}else{let e=yb(a,b,c);if(e){for(const[f,g]of e)a.chessToXYZ.delete(g),zb(a.XToChessSet,b,g),zb(a.YToChessSet,c,g),zb(a.ZToChessSet,f,g);of(a.XYToZMap,b,c)}}}function Ah(a,b){return a.chessToXYZ.has(b)}function Bh(a,b,c,d){return yb(a,b,c,d)!==null}function Ch(a,b){return a.chessToXYZ.get(b)||null}function lf(a){let b=-Infinity;for(const[c,d]of a)b<c&&(b=c);return b}function mf(a){let b=Infinity;for(const[c,d]of a)b>c&&(b=c);return b}class Xe{constructor(){this.chessToXYZ=new Map(),this.XYToZMap=new Map(),this.XToChessSet=new Map(),this.YToChessSet=new Map(),this.ZToChessSet=new Map(),this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0}destroy(){this.clear()}clear(){return this.chessToXYZ.clear(),this.XYToZMap.clear(),this.XToChessSet.clear(),this.YToChessSet.clear(),this.ZToChessSet.clear(),this.clearBounds(),this}clearBounds(){return this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0,this}addChess(a,b,c,d){return yh(this,a,b,c,d),this.clearBounds(),this}getChess(a,b,c){return yb(this,a,b,c)}removeChess(a,b,c){return zh(this,a,b,c),this.clearBounds(),this}hasChess(a){return Ah(this,a)}contains(a,b,c){return Bh(this,a,b,c)}getXYZ(a){return Ch(this,a)}get xMax(){return this._xMax===void 0&&(this._xMax=lf(this.XToChessSet)),this._xMax}get xMin(){return this._xMin===void 0&&(this._xMin=mf(this.XToChessSet)),this._xMin}get yMax(){return this._yMax===void 0&&(this._yMax=lf(this.YToChessSet)),this._yMax}get yMin(){return this._yMin===void 0&&(this._yMin=mf(this.YToChessSet)),this._yMin}}function Ya(a,b=[]){let c=a.boardData.chessToXYZ;for(const[d,e]of c)b.push(d);return b}function yi(a){if(typeof a!=="object"||a.nodeType||a===a.window)return!1;try{if(a.constructor&&!{}.hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0}function xc(a){return yi(a)?!0:typeof a==="object"?a.isTileXYZ:!1}function ba(a,b){let c=a.boardData.getXYZ(b);return c?c:xc(b)?b:null}function qa(a,b,c,d){return a.boardData.getChess(b,c,d)}class Gh{constructor(a){this.parent=a,this.board=null,this.blocker=!1,this.boot()}boot(){typeof this.parent==="object"&&this.parent.on&&this.parent.on("destroy",this.destroy,this)}destroy(){if(this.board){let a=this.tileXYZ;this.board.boardData.removeChess(a.x,a.y,a.z)}this.parent=void 0,this.board=null}setBoard(a){return this.board=a,this}get tileXYZ(){return this.board==null?null:this.board.boardData.getXYZ(this.parent)}setBlocker(a=!0){return this.blocker=a,this}setBlockEdge(a,b=!0){typeof this.blocker==="boolean"&&(this.blocker={});let c=this.blocker;if(typeof a==="object"){let d=a;for(let e in d)c[e]=d[e]}else c[a]=b;return this}getBlockEdge(a){return typeof this.blocker==="boolean"?!1:this.blocker.hasOwnProperty(a)?this.blocker[a]:!1}}function Ra(a){return a.hasOwnProperty("rexChess")||(a.rexChess=new Gh(a)),a.rexChess}function La(a,b,c,d,e,f=!1,g=!1){if(b){let k=ba(a,b);if(k)c=k.x,d=k.y,e=k.z;else return}else{b=qa(a,c,d,e);if(!b)return}g||a.boardData.removeChess(c,d,e),a._isBoard&&Ra(b).setBoard(null),f&&b.destroy&&b.destroy()}function xb(a,b){if(a.infinityMode)return;if(a.height===void 0||a.height<=b){a.height=b;return}let c=Ya(a);c.forEach(d=>{let e=ba(a,d);e.y>b&&La(a,d)}),a.height=b}function wb(a,b){if(a.infinityMode)return;if(a.width===void 0||a.width<=b){a.width=b;return}let c=Ya(a);c.forEach(d=>{let e=ba(a,d);e.x>b&&La(a,d)}),a.width=b}class id{constructor({grid:a=void 0,wrap:b=!1,inifinity:c=!1,width:d=0,height:e=0}={}){this.boardData=new Xe(),this._isBoard=!0,this.setGrid(a),this.setWrapMode(b),this.setInfinityMode(c),this.setBoardSize(d,e)}destroy(){}setGrid(a){return this.grid=a,this}setWrapMode(a=!0){return this.wrapMode=a,this}setInfinityMode(a=!0){return this.infinityMode=a,this}setBoardSize(a=0,b=0){return wb(this,a),xb(this,b),this}}function Qa(a,b,c,d){let e;return a.infinityMode?e=!0:e=b>=0&&b<a.width&&c>=0&&c<a.height,e&&d!==void 0&&(e=a.boardData.contains(b,c,d)),e}function Da(a,b,c,d){return a.grid.getWorldXY(b,c,d)}function Yb(a,b,c,d){if(b===void 0){let e=Ya(a);for(let f=0,g=e.length;f<g;f++){let k=e[f],i=ba(a,k);Da(a,i.x,i.y,k)}}else{if(c===void 0){let e=ba(a,b);c=e.x,d=e.y}Da(a,c,d,b)}}function kb(a,b,c,d,e,f=!0){if(!Qa(a,c,d))return;let g=ba(a,b);e===void 0&&(g?e=g.z:e=0);if(g&&g.x===c&&g.y===d&&g.z===e)return;let k=qa(a,c,d,e);k&&La(a,null,c,d,e),a.boardData.addChess(b,c,d,e),a._isBoard&&Ra(b).setBoard(a),f&&Yb(a,b,c,d)}function Db(a,b,c,d){return Math.atan2(d-b,c-a)}function lb(a,b,c){let d=ba(a,b),e=ba(a,c),f=Da(a,d.x,d.y,!0),g=f.x,k=f.y;f=Da(a,e.x,e.y,!0);let i=f.x,m=f.y;return Db(g,k,i,m)}function fb(a,b,c){let d=c-b;return b+((a-b)%d+d)%d}function Xb(a,b,c,d={x:0,y:0}){return d===!0&&(d=sl),a.wrapMode?b=fb(b,0,a.width):!a.infinityMode&&(b<0||b>=a.width)&&(b=null),a.wrapMode?c=fb(c,0,a.height):!a.infinityMode&&(c<0||c>=a.height)&&(c=null),d.x=b,d.y=c,d}let sl={x:0,y:0};function Ka(a,b,c,d,e){let f=ba(a,b);if(f===null)return null;typeof c==="string"&&(c.indexOf(",")===-1?c=parseInt(c):c=c.split(".").map(m=>parseInt(m,10)));let g=typeof c==="number",k=typeof d==="number";if(g&&k){let m=a.grid.getTileXYAtDirection(f,c,d,e);return Xb(a,m.x,m.y,m),(m.x===null||m.y===null)&&(m=null),m}Array.isArray(e)||(e=[]),c===null&&(c=a.grid.allDirections);let i;if(g)if(Array.isArray(d))for(let m=0,o=d.length;m<o;m++)i=Ka(a,f,c,d[m]),i!==null&&e.push(i);else{let m,o,u;({end:m=1,start:o=m>0?1:-1,step:u=m>=o?1:-1}=d);if(o===m)i=Ka(a,f,c,m),i!==null&&e.push(i);else if(o<m)for(let A=o;A<=m;A+=u)i=Ka(a,f,c,A),i!==null&&e.push(i);else for(let A=o;A>=m;A+=u)i=Ka(a,f,c,A),i!==null&&e.push(i)}else for(let m=0,o=c.length;m<o;m++)k?(i=Ka(a,f,c[m],d),i!==null&&e.push(i)):Ka(a,f,c[m],d,e);return e}function bb(a,b,c=null,d={x:0,y:0}){return Ka(a,b,c,1,d)}function Ub(a,b,c){b===void 0&&(b=wl);let d=a.wrapMode,e=a.infinityMode;a.wrapMode=!1,a.infinityMode=!0;let f=bb(a,b,c,!0);return a.wrapMode=d,a.infinityMode=e,lb(a,b,f)}let wl={x:0,y:0};const yn=180/Math.PI;function $b(a){return a*yn}function Kh(a,b){let c=b-a;if(c===0)return 0;let d=Math.floor((c- -180)/360);return c-d*360}function Tb(a,b,c){c=$b(c);let d=a.grid.allDirections,e=Infinity,f;for(let g=0,k=d.length;g<k;g++){let i=$b(Ub(a,b,d[g])),m=Math.abs(Kh(c,i));m<e&&(e=m,f=g)}return f}function Wb(a,b,c){if(b===null||c===null)return null;if(b.x===c.x&&b.y===c.y)return null;let d=a.grid.getNeighborTileDirection(b,c);if(a.wrapMode&&d===null){let e=bb(a,b,null);for(let f=0,g=e.length;f<g;f++){let k=e[f];if(c.x===k.x&&c.y===k.y){d=f;break}}}return d}function Vb(a,b,c){let d=ba(a,b),e=ba(a,c);return Wb(a,d,e)}function kd(a,b,c){return Vb(a,b,c)!==null}function ld(a,b,c,d=!0){let e=ba(a,b),f=ba(a,c);return e===null||f===null?null:a.grid.directionBetween(e,f,d)}function uc(a,b,c=1,d=[]){let e=a.grid.ringToTileXYArray(b,c);for(let f=0,g=e.length;f<g;f++){let k=e[f];Qa(a,k.x,k.y)&&d.push(k)}return d}function Ye(a,b,c,d=!0,e=[]){for(let f=0;f<=c;f++){let g=d?f:c-f;uc(a,b,g,e)}return e}function Za(a,b,c,d,e={x:0,y:0}){return e===!0&&(e=ul),c===0&&d===0?(e.x=b.x,e.y=b.y):a.grid.offset(b,c,d,e),e}let ul={x:0,y:0};function Ze(a,b){let c=Infinity,d=Infinity,e;for(let k=0,i=b.length;k<i;k++)e=b[k],c=Math.min(c,e.x),d=Math.min(d,e.y);if(c!==0||d!==0)for(let k=0,i=b.length;k<i;k++)e=b[k],Za(a,e,-c,-d,e);let f=-Infinity,g=-Infinity;for(let k=0,i=b.length;k<i;k++)e=b[k],f=Math.max(f,e.x),g=Math.max(g,e.y);return wb(a,f+1),xb(a,g+1),b}var Bb;(function(a){a[a["x+,y+"]=0]="x+,y+",a[a["x-,y+"]=1]="x-,y+",a[a["y+,x+"]=2]="y+,x+",a[a["y-,x+"]=3]="y-,x+"})(Bb||(Bb={}));function md(a,b,c,d=0){let e={x:0,y:0};switch(d){case 0:for(let f=0;f<a.height;f++)for(let g=0;g<a.width;g++)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 1:for(let f=0;f<a.height;f++)for(let g=a.width-1;g>=0;g--)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 2:for(let f=0;f<a.width;f++)for(let g=0;g<a.height;g++)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a);break;case 3:for(let f=0;f<a.width;f++)for(let g=a.height-1;g>=0;g--)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a)}}function nd(a,b,c,d){return a.grid.getDistance(b,c,d)}function tc(a,b=0,c=[]){if(Array.isArray(b)){let d=b;for(let e=0;e<a.height;e++)for(let f=0;f<a.width;f++){let g=!0;for(let k=0,i=d.length;k<i;k++)if(qa(a,f,e,d[k])!==null){g=!1;break}g&&c.push({x:f,y:e})}}else for(let d=0;d<a.height;d++)for(let e=0;e<a.width;e++)qa(a,e,d,b)===null&&c.push({x:e,y:d});return c}function od(a,b,c,d){return a.grid.getGridPoints(b,c,d)}function Ma(a,b,c,d=[]){let e=a.boardData.getChess(b,c);for(const[f,g]of e)d.push(g);return d}function Zb(a,b,c,d=[]){let e=c!=null,f,g;for(let k=0,i=b.length;k<i;k++)f=b[k],e?(g=qa(a,f.x,f.y,c),g!==null&&d.push(g)):Ma(a,f.x,f.y,d);return d}function pd(a,b,c,d,e){let f=ba(a,b);if(f===null)return null;d==null&&(d=f.hasOwnProperty("z")?f.z:null);let g=bb(a,f,c,!0);return g===null?null:Array.isArray(g)?(e===void 0&&(e=[]),Zb(a,g,d,e)):d==null?(e===void 0&&(e=[]),Ma(a,g.x,g.y,e)):qa(a,g.x,g.y,d)}function qd(a,b,c,d={x:0,y:0}){let e=Tb(a,b,c);return Ka(a,b,e,1,d)}function rd(a,b,c,d){return a.grid.getOppositeDirection(b,c,d)}function vc(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function _b(a,b=0,c=a.length){let d=b+Math.floor(Math.random()*c);return a[d]===void 0?null:a[d]}function _e(a,b=0,c={x:0,y:0}){c===!0&&(c=pl);let d=Math.floor(a.width*a.height*.3);for(let f=0;f<d;f++){let g=vc(0,a.width-1),k=vc(0,a.height-1);if(qa(a,g,k,b)===null)return c.x=g,c.y=k,c}let e=tc(a,b);if(e.length===0)return null;{let f=_b(e);return c.x=f.x,c.y=f.y,c}}let pl={x:0,y:0};function $e(a,b,c,d){if(d===void 0){let e=Ma(a,b,c);for(let f=0,g=e.length;f<g;f++){let k=Ra(e[f]).blocker;if(k===!0)return!0}return!1}else{let e=qa(a,b,c,d);if(e===null)return!1;let f=Ra(e).blocker;return f===!0}}function af(a,b){return a.boardData.chessToXYZ.has(b)}function bf(a,b,c,d,e){if(d===void 0){let f=Ma(a,b,c);for(let g=0,k=f.length;g<k;g++)if(xh(Ra(f[g]).blocker,e))return!0;return!1}else{let f=qa(a,b,c,d);return f===null?!1:xh(Ra(f).blocker,e)}}function xh(a,b){return a===!1||a===!0?a:a[b]===!0}function qf(a){return a=a%Qk,a>=0?a:a+Qk}const Qk=Math.PI*2;function Lh(a,b,c=1e-4){return Math.abs(a-b)<c}function sd(a,b,c,d,e){let f=ba(a,b),g=ba(a,c),k=lb(a,f,g);k=qf(k);let i=Math.abs(k-d);i=Math.min(i,xl-i);let m=e/2;return Lh(i,m)||i<m}const xl=Math.PI*2;function td(a,b,c,d,e){let f=ba(a,b),g=ba(a,c),k=a.grid.directions;a.grid.directions=a.grid.sides;let i=a.grid.directionBetween(f,g,!1);a.grid.directions=k;let m=Math.abs(i-d);return m=Math.min(m,a.grid.directions-m),m<=e/2}function Ha(a,b,c,d={x:0,y:0}){return a.grid.getTileXY(b,c,d)}function ud(a,b,c,d){if(a.infinityMode&&d===void 0)return!0;let e=Ha(a,b,c,!0);return Qa(a,e.x,e.y,d)}function Jh(a,b,c,d){let e=a-c,f=b-d;return Math.sqrt(e*e+f*f)}function pf(a,b,c){return(b-a)*c+a}function cf(a,b,c,d,e,f=[]){let g=Jh(b,c,d,e),k=Math.min(a.grid.width,a.grid.height),i=Math.ceil(g/(k/4)),m;for(let o=0;o<=i;o++){let u=o/i,A=pf(b,d,u),B=pf(c,e,u),E=Ha(a,A,B);if(!Qa(a,E.x,E.y))continue;if(m&&m.x===E.x&&m.y===E.y)continue;f.push(E),m=E}return f}var Cb;(function(a){a[a.x=1]="x",a[a.horizontal=1]="horizontal",a[a.h=1]="h",a[a.y=2]="y",a[a.vertical=2]="vertical",a[a.v=2]="v",a[a.xy=3]="xy"})(Cb||(Cb={}));function df(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=tl),d!==null?Za(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.mirror(e,c,e),d!==null&&Za(a,e,d.x,d.y,e),e}let tl={x:0,y:0};function ef(a,b=!1,c=!1){let d=Ya(a);for(let e=0,f=d.length;e<f;e++)La(a,d[e],void 0,void 0,void 0,b,c)}function ff(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=vl),d!==null?Za(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.rotate(e,c,e),d!==null&&Za(a,e,d.x,d.y,e),e}let vl={x:0,y:0};function gf(a,b,c){let d=ba(a,b);if(d===null)return;kb(a,b,d.x,d.y,c)}function wc(a,b,c){return Math.max(b,Math.min(c,a))}function hf(a,b,c,d=[]){let e=Ha(a,b.left,b.top,!0),f=e.x-1,g=e.y-1,k=Ha(a,b.right,b.bottom,!0),i=k.x+1,m=k.y+1;a.infinityMode||(f=wc(f,0,a.width-1),g=wc(g,0,a.height-1),i=wc(i,0,a.width-1),m=wc(m,0,a.height-1));for(let o=f;o<=i;o++)for(let u=g;u<=m;u++){let A=Da(a,o,u,!0);c(b,A.x,A.y)&&d.push({x:o,y:u})}return d}function jf(a,b,c,d=!0){let e=ba(a,b),f=ba(a,c);if(e==null||f==null)return;La(a,b),La(a,c),kb(a,b,f.x,f.y,f.z,d),kb(a,c,e.x,e.y,e.z,d)}function vd(a,b,c=[]){let d=a.boardData.ZToChessSet.get(b);if(d)for(const e of d)c.push(e);return c}function wd(a,b,c=[]){for(let d=0,e=b.length;d<e;d++){let f=b[d];c.push(Da(a,f.x,f.y))}return c}function xd(a,b,c,d={x:0,y:0}){return d===!0&&(d=yl),Ha(a,b,c,d),Da(a,d.x,d.y,d),d}let yl={x:0,y:0};function yd(a,b,c,d,e){let f=Ha(a,b,c,!0);return d!==void 0?qa(a,f.x,f.y,d):Ma(a,f.x,f.y,e)}class jd extends id{addChess(a,b,c,d,e=!0){return kb(this,a,b,c,d,e),this}angleBetween(a,b){return lb(this,a,b)}angleSnapToDirection(a,b){return Tb(this,a,b)}angleToward(a,b){return Ub(this,a,b)}areNeighbors(a,b){return kd(this,a,b)}chessToTileXYZ(a){return ba(this,a)}contains(a,b,c){return Qa(this,a,b,c)}directionBetween(a,b,c=!0){return ld(this,a,b,c)}filledRingToTileXYArray(a,b,c=!0,d=[]){return Ye(this,a,b,c,d)}fit(a){return Ze(this,a)}forEachTileXY(a,b,c=0){return md(this,a,b,c),this}getAllChess(a=[]){return Ya(this,a)}getChessData(a){return Ra(a)}getDistance(a,b,c=!1){return nd(this,a,b,c)}getEmptyTileXYArray(a=0,b=[]){return tc(this,a,b)}getGridPoints(a,b,c){return od(this,a,b,c)}getNeighborChess(a,b,c,d){return pd(this,a,b,c,d)}getNeighborChessDirection(a,b){return Vb(this,a,b)}getNeighborTileDirection(a,b){return Wb(this,a,b)}getNeighborTileXY(a,b=null,c={x:0,y:0}){return bb(this,a,b,c)}getNeighborTileXYAtAngle(a,b,c={x:0,y:0}){return qd(this,a,b,c)}getOppositeDirection(a,b,c){return rd(this,a,b,c)}getRandomEmptyTileXY(a=0,b={x:0,y:0}){return _e(this,a,b)}getTileXYAtDirection(a,b,c,d){return Ka(this,a,b,c,d)}getWrapTileXY(a,b,c={x:0,y:0}){return Xb(this,a,b,c)}gridAlign(a,b,c){return Yb(this,a,b,c),this}hasBlocker(a,b,c){return $e(this,a,b,c)}hasChess(a){return af(this,a)}hasEdgeBlocker(a,b,c,d){return bf(this,a,b,c,d)}isAngleInCone(a,b,c,d){return sd(this,a,b,c,d)}isDirectionInCone(a,b,c,d){return td(this,a,b,c,d)}isOverlappingPoint(a,b,c){return ud(this,a,b,c)}lineToTileXYArray(a,b,c,d,e=[]){return cf(this,a,b,c,d,e)}mirror(a,b,c=null,d={x:0,y:0}){return df(this,a,b,c,d)}offset(a,b,c,d){return Za(this,a,b,c,d)}removeAllChess(a=!1,b=!1){return ef(this,a,b),this}removeChess(a,b,c,d,e=!1,f=!1){return La(this,a,b,c,d,e,f),this}ringToTileXYArray(a,b=1,c=[]){return uc(this,a,b,c)}rotate(a,b,c=null,d={x:0,y:0}){return ff(this,a,b,c,d)}setBoardWidth(a=0){return wb(this,a),this}setBoardHeight(a=0){return xb(this,a),this}setTileZ(a,b){return gf(this,a,b),this}shapeToTileXYArray(a,b,c=[]){return hf(this,a,b,c)}swapChess(a,b,c=!0){return jf(this,a,b,c),this}tileXYArrayToChessArray(a,b,c=[]){return Zb(this,a,b,c)}tileXYToChessArray(a,b,c=[]){return Ma(this,a,b,c)}tileXYZToChess(a,b,c){return qa(this,a,b,c)}tileZToChessArray(a,b=[]){return vd(this,a,b)}tileXYArrayToWorldXYArray(a,b=[]){return wd(this,a,b)}tileXYToWorldXY(a,b,c={x:0,y:0}){return Da(this,a,b,c)}worldXYSnapToGrid(a,b,c={x:0,y:0}){return xd(this,a,b,c)}worldXYToChess(a,b,c,d){return yd(this,a,b,c,d)}worldXYToTileXY(a,b,c){return Ha(this,a,b,c)}}class wh extends jd{}const Sa={};sb(Sa,{ChessToTileXYZ:()=>ba,Contains:()=>Qa,DirectionBetween:()=>ld,ForEachTileXY:()=>md,GetDistance:()=>nd,GetOppositeDirection:()=>rd,GetTileXYAtDirection:()=>Ka,GetWrapTileXY:()=>Xb,IsDirectionInCone:()=>td,TileXYArrayToChessArray:()=>Zb,TileXYToChessArray:()=>Ma,TileXYZToChess:()=>qa,TileZToChessArray:()=>vd});const mb={};sb(mb,{AngleBetween:()=>lb,AngleSnapToDirection:()=>Tb,AngleToward:()=>Ub,GetGridPoints:()=>od,GridAlign:()=>Yb,IsAngleInCone:()=>sd,IsOverlappingPoint:()=>ud,TileXYArrayToWorldXYArray:()=>wd,TileXYToWorldXY:()=>Da,WorldXYSnapToGrid:()=>xd,WorldXYToChess:()=>yd,WorldXYToTileXY:()=>Ha});const Ab={};sb(Ab,{AreNeighbors:()=>kd,GetNeighborChess:()=>pd,GetNeighborChessDirection:()=>Vb,GetNeighborTileDirection:()=>Wb,GetNeighborTileXY:()=>bb,GetNeighborTileXYAtAngle:()=>qd});var oa;(function(a){a[a.orthogonal=0]="orthogonal",a[a.isometric=1]="isometric"})(oa||(oa={}));var gb;(function(a){a[a["4dir"]=4]="4dir",a[a["8dir"]=8]="8dir"})(gb||(gb={}));class ri{constructor({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=oa.orthogonal,dir:f=gb["4dir"]}={}){this.setOriginPosition(a,b),this.setCellSize(c,d),this.setType(e),this.setDirectionMode(f)}fromJSON({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=oa.orthogonal,dir:f=gb["4dir"]}={}){return this.setType(e),this.setDirectionMode(f),this.setOriginPosition(a,b),this.setCellSize(c,d),this}toJSON(){return{x:this.x,y:this.y,cellWidth:this.cellWidth,cellHeight:this.cellHeight,type:this.mode,dir:this.directions}}setOriginPosition(a=0,b=0){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setType(a=oa.orthogonal){return typeof a==="string"&&(a=oa[a]),this.mode=a,this}setDirectionMode(a=gb["4dir"]){return typeof a==="string"&&(a=gb[a]),this.directions=a,this}}function ji(a,b,c,d=!0){let e;switch(a.mode){case oa.orthogonal:case oa.isometric:if(b.y===c.y)e=c.x>=b.x?0:2;else if(b.x===c.x)e=c.y>=b.y?1:3;else if(a.directions===gb["4dir"]){let f=$b(Db(b.x,b.y,c.x,c.y));f<0&&(f+=360),e=f/90,d&&(e=Math.round(e))}else{let f=c.x-b.x,g=c.y-b.y;if(f===g)e=f>0?4:6;else if(f===-g)e=f>0?7:5;else{let k=$b(Math.atan2(g,f));k<0&&(k+=360);let i=k/45;d&&(i=Math.round(i)),i>=0&&i<1?e=i:i>=1&&i<2?e=i+3:i>=2&&i<3?e=i-1:i>=3&&i<4?e=i+2:i>=4&&i<5?e=i-2:i>=5&&i<6?e=i+1:i>=6&&i<7?e=i-3:e=i}}break}return e===a.directions&&(e=0),e}function Kd(a,b){return fb(b,0,a.directions)}function ki(a,b,c,d=!1){let e=c.x-b.x,f=c.y-b.y,g;return d?g=Math.abs(e)+Math.abs(f):g=Math.sqrt(e*e+f*f),g}function Gd(a,b=[]){if(!(b.length===a))if(b.length<a)for(let c=b.length;c<a;c++)b.push({x:0,y:0});else b.length=a;return b}function Nd(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Tl);let e,f;switch(a.mode){case oa.orthogonal:e=b*a.width,f=c*a.height;break;case oa.isometric:e=(b-c)*a._halfWidth,f=(b+c)*a._halfHeight;break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let Tl={x:0,y:0};function li(a,b=0,c=0,d=[]){if(typeof b==="object"){let i=b;c=i.y,b=i.x}d===!0&&(d=Pl),Gd(4,d);let e,f;({x:e,y:f}=Nd(a,b,c));let g=a._halfWidth,k=a._halfHeight;switch(a.mode){case oa.orthogonal:d[0].x=e+g,d[0].y=f-k,d[1].x=e+g,d[1].y=f+k,d[2].x=e-g,d[2].y=f+k,d[3].x=e-g,d[3].y=f-k;break;case oa.isometric:d[0].x=e+g,d[0].y=f,d[1].x=e,d[1].y=f+k,d[2].x=e-g,d[2].y=f,d[3].x=e,d[3].y=f-k;break}return d}let Pl=[];const ac=[[1,0],[0,1],[-1,0],[0,-1],[1,1],[-1,1],[-1,-1],[1,-1]],yc=ac;function gi(a){let b={},c,d,e;for(let f in a)c=a[f],d=c[0],e=c[1],b.hasOwnProperty(d)||(b[d]={}),b[d][e]=parseInt(f);return b}const hi=gi(ac),ii=gi(yc);function mi(a,b,c){let d;switch(a.mode){case oa.orthogonal:d=hi;break;case oa.isometric:d=ii;break}let e=c.x-b.x,f=c.y-b.y;if(d.hasOwnProperty(e)){let g=d[e];if(g.hasOwnProperty(f))return g[f]}return null}function Od(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Sl);let f,g;switch(a.mode){case oa.orthogonal:f=ac[c][0],g=ac[c][1];break;case oa.isometric:f=yc[c][0],g=yc[c][1];break}return d===1?(e.x=b.x+f,e.y=b.y+g):(e.x=b.x+d*f,e.y=b.y+d*g),e}let Sl={x:0,y:0};function ni(a,b,c,d={x:0,y:0}){return Od(a,b,c,1,d)}function oi(a,b,c,d){return Ql[d]}const Ql={0:2,1:3,2:0,3:1,4:6,5:7,6:4,7:5};function pi(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Rl),b-=a.x,c-=a.y;let e=b/a.width,f=c/a.height;switch(a.mode){case oa.orthogonal:d.x=Math.round(e),d.y=Math.round(f);break;case oa.isometric:d.x=Math.round(+e+f),d.y=Math.round(-e+f);break}return d}let Rl={x:0,y:0};function qi(a,b,c,d={x:0,y:0}){return typeof c==="string"&&(c=Cb[c]),d===!0&&(d=Ul),d.x=c&1?-b.x:b.x,d.y=c&2?-b.y:b.y,d}let Ul={x:0,y:0};function Eb(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Vl);let f=b.x+c,g=b.y+d;return e.x=f,e.y=g,e}let Vl={x:0,y:0};function si(a,b,c,d=[]){let e,f;for(e=c,f=-c;f<=c;f++)d.push(Eb(a,b,e,f));for(f=c,e=c-1;e>=-c;e--)d.push(Eb(a,b,e,f));for(e=-c,f=c-1;f>=-c;f--)d.push(Eb(a,b,e,f));for(f=-c,e=-c+1;e<=c-1;e++)d.push(Eb(a,b,e,f));return d}function ti(a,b,c,d={x:0,y:0}){d===!0&&(d=_l),c=fb(c,0,3);let e,f;switch(c){case 1:e=-b.y,f=b.x;break;case 2:e=-b.x,f=-b.y;break;case 3:e=b.y,f=-b.x;break;default:e=b.x,f=b.y;break}return d.x=e,d.y=f,d}let _l={x:0,y:0};function Ld(a){a._savedOriginX=a.x,a._savedOriginY=a.y}function Md(a){a.x=a._savedOriginX,a.y=a._savedOriginY}class fi extends ri{get sides(){return 4}get allDirections(){return this.directions===4?Wl:Xl}get halfDirections(){return this.directions===4?Yl:Zl}directionBetween(a,b,c=!0){return ji(this,a,b,c)}directionNormalize(a){return Kd(this,a)}getDistance(a,b,c=!1){return ki(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return li(this,a,b,c)}getNeighborTileDirection(a,b){return mi(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return ni(this,a,b,c)}getOppositeDirection(a,b,c){return oi(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return pi(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return Od(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return Nd(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return qi(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return Eb(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return si(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return ti(this,a,b,c)}restoreOrigin(){return Md(this),this}saveOrigin(){return Ld(this),this}}const Wl=[0,1,2,3],Xl=[0,1,2,3,4,5,6,7],Yl=[0,1],Zl=[0,1,4,5];var ca;(function(a){a[a.ODD_R=0]="ODD_R",a[a.EVEN_R=1]="EVEN_R",a[a.ODD_Q=2]="ODD_Q",a[a.EVEN_Q=3]="EVEN_Q"})(ca||(ca={}));var _a;(function(a){a[a.y=0]="y",a[a.flat=0]="flat",a[a.x=1]="x",a[a.pointy=1]="pointy"})(_a||(_a={}));var ob;(function(a){a[a.even=0]="even",a[a.odd=1]="odd"})(ob||(ob={}));class _h{constructor({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=_a.x,staggerIndex:g=ob.odd}={}){this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e)}fromJSON({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=_a.x,staggerIndex:g=ob.odd}={}){return this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e),this}toJSON(){return{x:this.x,y:this.y,radius:this.radius,cellWidth:this.cellWidth,cellHeight:this.cellHeight,staggerAxis:this.staggerAxis,staggerIndex:this.staggerIndex}}setOriginPosition(a,b){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this.radius=void 0,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setRadius(a=0){let b,c;return this.staggerAxis===_a.y?(b=2*a,c=ei*a):(b=ei*a,c=2*a),this.setCellSize(b,c),this.radius=a,this}setDirectionMode(){return this.directions=6,this}setType(a=1,b=1){return typeof a==="string"&&(a=_a[a]),typeof b==="string"&&(b=ob[b]),this.staggerAxis=a,this.staggerIndex=b,a===_a.y?this.mode=b===ob.even?ca.EVEN_Q:ca.ODD_Q:this.mode=b===ob.even?ca.EVEN_R:ca.ODD_R,this}}const ei=Math.sqrt(3);function Na(a,b,c,d={x:0,y:0,z:0}){d===!0&&(d=sf);switch(a){case ca.ODD_R:d.x=b-(c-(c&1))/2,d.z=c;break;case ca.EVEN_R:d.x=b-(c+(c&1))/2,d.z=c;break;case ca.ODD_Q:d.x=b,d.z=c-(b-(b&1))/2;break;case ca.EVEN_Q:d.x=b,d.z=c-(b+(b&1))/2;break}return d.y=-d.x-d.z,d}function Oh(a,b,c,d={x:0,y:0,z:0}){typeof a!=="number"&&(d=a,a=d.x,b=d.y,c=d.z),d===!0&&(d=sf);let e=Math.round(a),f=Math.round(b),g=Math.round(c),k=Math.abs(e-a),i=Math.abs(f-b),m=Math.abs(g-c);return k>i&&k>m?e=-f-g:i>m?f=-e-g:g=-e-f,d.x=e,d.y=f,d.z=g,d}function Ba(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Al);switch(a){case ca.ODD_R:e.x=b+(d-(d&1))/2,e.y=d;break;case ca.EVEN_R:e.x=b+(d+(d&1))/2,e.y=d;break;case ca.ODD_Q:e.x=b,e.y=d+(b-(b&1))/2;break;case ca.EVEN_Q:e.x=b,e.y=d+(b+(b&1))/2;break}return e}function Ph(a,b,c={x:0,y:0,z:0}){return c===!0&&(c=sf),c.x=a,c.y=-a-b,c.z=b,c}let sf={x:0,y:0,z:0},Al={x:0,y:0};function Rh(a,b,c,d=!0){let e;Na(a.mode,b.x,b.y,Cd),Na(a.mode,c.x,c.y,Dd);let f=Dd.x-Cd.x,g=Dd.y-Cd.y,k=Dd.z-Cd.z;return k===0?e=f>0?0:3:f===0?e=k>0?1:4:g===0?e=k>0?2:5:f>0&&g<0&&k>0?e=0+k/-g:f<0&&g<0&&k>0?e=1+-g/k:f<0&&g>0&&k>0?e=2+g/-f:f<0&&g>0&&k<0?e=3+-k/g:f>0&&g>0&&k<0?e=4+f/-k:e=5+-g/f,d&&(e=Math.round(e)),e}let Cd={x:0,y:0,z:0},Dd={x:0,y:0,z:0};function Sh(a,b,c,d=!1){Na(a.mode,b.x,b.y,Ed),Na(a.mode,c.x,c.y,Fd);let e=Fd.x-Ed.x,f=Fd.y-Ed.y,g=Fd.z-Ed.z;return(Math.abs(e)+Math.abs(f)+Math.abs(g))/2}let Ed={x:0,y:0,z:0},Fd={x:0,y:0,z:0};function Hd(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Jl);let e=b*a.width,f=c*a.height;switch(a.mode){case ca.ODD_R:c&1&&(e+=a._halfWidth),f*=.75;break;case ca.EVEN_R:c&1&&(e-=a._halfWidth),f*=.75;break;case ca.ODD_Q:e*=.75,b&1&&(f+=a._halfHeight);break;case ca.EVEN_Q:e*=.75,b&1&&(f-=a._halfHeight);break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let Jl={x:0,y:0};const xn=Math.PI/180;function rf(a){return a*xn}function Th(a,b=0,c=0,d=[]){if(typeof b==="object"){let g=b;c=g.y,b=g.x}d===!0&&(d=Fl),Gd(6,d);let e,f;({x:e,y:f}=Hd(a,b,c));if(a.radius!==void 0){let g=a.radius,k=a.staggerAxis===_a.flat?0:-30;for(let i=0;i<6;i++){let m=60*i+k,o=rf(m);d[i].x=e+g*Math.cos(o),d[i].y=f+g*Math.sin(o)}}else{let g=a._halfWidth,k=g/2,i=a._halfHeight,m=i/2;a.staggerAxis===_a.flat?(d[0].x=e+g,d[0].y=f,d[1].x=e+k,d[1].y=f+i,d[2].x=e-k,d[2].y=f+i,d[3].x=e-g,d[3].y=f,d[4].x=e-k,d[4].y=f-i,d[5].x=e+k,d[5].y=f-i):(d[0].x=e+g,d[0].y=f-m,d[1].x=e+g,d[1].y=f+m,d[2].x=e,d[2].y=f+i,d[3].x=e-g,d[3].y=f+m,d[4].x=e-g,d[4].y=f-m,d[5].x=e,d[5].y=f-i)}return d}let Fl=[];const Bl=[[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]]],Cl=[[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]],[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]]],Dl=[[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]],[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]]],El=[[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]],[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]]],Ta=[Bl,Cl,Dl,El];function nb(a){let b={},c,d;for(let e in a)[c,d]=a[e],b.hasOwnProperty(c)||(b[c]={}),b[c][d]=parseInt(e);return b}const Qh=[[nb(Ta[0][0]),nb(Ta[0][1])],[nb(Ta[1][0]),nb(Ta[1][1])],[nb(Ta[2][0]),nb(Ta[2][1])],[nb(Ta[3][0]),nb(Ta[3][1])]];function Id(a,b,c){let d;switch(a){case ca.ODD_R:case ca.EVEN_R:d=c&1;break;case ca.ODD_Q:case ca.EVEN_Q:d=b&1;break}return d}function Uh(a,b,c){let d=a.mode,e=Id(d,b.x,b.y),f=Qh[d][e],g=c.x-b.x,k=c.y-b.y;if(f.hasOwnProperty(g)){let i=f[g];if(i.hasOwnProperty(k))return i[k]}return null}function Jd(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Il);let f=a.mode,g=b.x,k=b.y;if(d===1){let i=Id(f,g,k);e.x=g+Ta[f][i][c][0],e.y=k+Ta[f][i][c][1]}else if(d===0)e.x=g,e.y=k;else{let i=Na(f,g,k,!0),m,o,u;switch(c){case 1:m=i.x,o=i.y-d,u=i.z+d;break;case 2:m=i.x-d,o=i.y,u=i.z+d;break;case 3:m=i.x-d,o=i.y+d,u=i.z;break;case 4:m=i.x,o=i.y+d,u=i.z-d;break;case 5:m=i.x+d,o=i.y,u=i.z-d;break;default:m=i.x+d,o=i.y-d,u=i.z;break}Ba(f,m,o,u,e)}return e}let Il={x:0,y:0};function Vh(a,b,c,d={x:0,y:0}){return Jd(a,b,c,1,d)}function Wh(a,b,c,d){return(d+3)%6}const Xh=4/3,Yh=2/3;function Zh(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Hl),b-=a.x,c-=a.y;let e,f;switch(a.mode){case ca.ODD_R:case ca.EVEN_R:f=c*Xh/a.height,e=b/a.width-Yh*(c/a.height);break;case ca.ODD_Q:case ca.EVEN_Q:f=c/a.height-Yh*(b/a.width),e=b*Xh/a.width;break}let g=Ph(e,f,Gl);return Oh(g),Ba(a.mode,g.x,g.y,g.z,d),d}let Gl={x:0,y:0,z:0},Hl={x:0,y:0};function $h(a,b,c,d={x:0,y:0}){typeof c==="string"&&(c=Cb[c]),d===!0&&(d=Ml);let e=Na(a.mode,b.x,b.y,!0),f=a.mode===ca.ODD_R||a.mode===ca.EVEN_R,g,k,i;return c&1&&(f?(g=e.y,k=e.x,i=e.z):(g=-e.x,k=-e.z,i=-e.y),e.x=g,e.y=k,e.z=i),c&2&&(f?(g=-e.y,k=-e.x,i=-e.z):(g=e.x,k=e.z,i=e.y)),Ba(a.mode,g,k,i,d),d}let Ml={x:0,y:0};function ai(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Nl);let f=b.x+c,g=b.y+d;switch(a.mode){case ca.ODD_R:(d&1)!==0&&((g&1)===0&&(f+=1));break;case ca.EVEN_R:(d&1)!==0&&((g&1)===0&&(f-=1));break;case ca.ODD_Q:(c&1)!==0&&((f&1)==0&&(g+=1));break;case ca.EVEN_Q:(c&1)!==0&&((f&1)==0&&(g-=1));break}return e.x=f,e.y=g,e}let Nl={x:0,y:0};function bi(a,b,c,d=[]){let e=Na(a.mode,b.x,b.y,!0),f=e.x,g=e.y,k=e.z,i,m,o;for(o=c,i=0;i>=-c;i--)m=-i-o,d.push(Ba(a.mode,f+i,g+m,k+o));for(i=-c,m=1;m<=c;m++)o=-i-m,d.push(Ba(a.mode,f+i,g+m,k+o));for(m=c,o=-1;o>=-c;o--)i=-m-o,d.push(Ba(a.mode,f+i,g+m,k+o));for(o=-c,i=1;i<=c;i++)m=-i-o,d.push(Ba(a.mode,f+i,g+m,k+o));for(i=c,m=-1;m>=-c;m--)o=-i-m,d.push(Ba(a.mode,f+i,g+m,k+o));for(m=-c,o=1;o<=c-1;o++)i=-m-o,d.push(Ba(a.mode,f+i,g+m,k+o));return d}function ci(a,b,c,d={x:0,y:0}){d===!0&&(d=Ol),c=fb(c,0,5);let e=Na(a.mode,b.x,b.y,!0),f,g,k;switch(c){case 1:f=-e.z,g=-e.x,k=-e.y;break;case 2:f=e.y,g=e.z,k=e.x;break;case 3:f=-e.x,g=-e.y,k=-e.z;break;case 4:f=e.z,g=e.x,k=e.y;break;case 5:f=-e.y,g=-e.z,k=-e.x;break;default:f=e.x,g=e.y,k=e.z;break}return Ba(a.mode,f,g,k,d),d}let Ol={x:0,y:0};class di extends _h{get sides(){return 6}get allDirections(){return Kl}get halfDirections(){return Ll}directionBetween(a,b,c=!0){return Rh(this,a,b,c)}directionNormalize(a){return Kd(this,a)}getDistance(a,b,c=!1){return Sh(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return Th(this,a,b,c)}getNeighborTileDirection(a,b){return Uh(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return Vh(this,a,b,c)}getOppositeDirection(a,b,c){return Wh(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return Zh(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return Jd(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return Hd(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return $h(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return ai(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return bi(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return ci(this,a,b,c)}restoreOrigin(){return Md(this),this}saveOrigin(){return Ld(this),this}}const Kl=[0,1,2,3,4,5],Ll=[0,1,2];var za;(function(a){a[a.random=0]="random",a[a.diagonal=1]="diagonal",a[a.straight=2]="straight",a[a.line=3]="line",a[a.astar=10]="astar",a[a["astar-random"]=11]="astar-random",a[a["astar-line"]=12]="astar-line"})(za||(za={}));const Fb=null;class Lk{constructor(a){this.content=[],this.scoreFunction=a}clear(){this.content.length=0}push(a){this.content.push(a),this.sinkDown(this.content.length-1)}pop(){let a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.bubbleUp(0)),a}remove(a){let b=this.content.indexOf(a),c=this.content.pop();b!==this.content.length-1&&(this.content[b]=c,this.scoreFunction(c)<this.scoreFunction(a)?this.sinkDown(b):this.bubbleUp(b))}get size(){return this.content.length}rescoreElement(a){this.sinkDown(this.content.indexOf(a))}sinkDown(a){let b=this.content[a];for(;a>0;){let c=(a+1>>1)-1,d=this.content[c];if(this.scoreFunction(b)<this.scoreFunction(d))this.content[c]=b,this.content[a]=d,a=c;else break}}bubbleUp(a){let b=this.content.length,c=this.content[a],d=this.scoreFunction(c);for(;;){let e=a+1<<1,f=e-1,g=null,k;if(f<b){let i=this.content[f];k=this.scoreFunction(i),k<d&&(g=f)}if(e<b){let i=this.content[e],m=this.scoreFunction(i);m<(g===null?d:k)&&(g=e)}if(g!==null)this.content[a]=this.content[g],this.content[g]=c,a=g;else break}}}let _4=new Lk(a=>a.f);const oe=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d=d.prevNodes[0];return c.reverse()};const Ok=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d.prevNodes.length===1?d=d.prevNodes[0]:d=_b(d.prevNodes);return c.reverse()};const Nk=function(a,b,c=[]){let d=b,e=b.angleTo(a);for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1)d=d.prevNodes[0];else{let f=Infinity;for(let g=1,k=d.prevNodes.length;g<k;g++){let i=d.prevNodes[g],m=Math.abs(b.angleTo(i)-e);m<f&&(f=m,d=i)}}}return c.reverse()};const Mk=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let k=0,i=d.prevNodes.length;k<i;k++){f=d.prevNodes[k],g=f.logicDirTo(d);if(g!==e)break}e=g,d=f}}return c.reverse()};const Pk=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let k=0,i=d.prevNodes.length;k<i;k++){f=d.prevNodes[k],g=f.logicDirTo(d);if(g===e)break}e=g,d=f}}return c.reverse()};let Mb={};Mb[za.astar]=oe;Mb[za["astar-line"]]=oe;Mb[za["astar-random"]]=oe;Mb[za.random]=Ok;Mb[za.line]=Nk;Mb[za.diagonal]=Mk;Mb[za.straight]=Pk;class wi{constructor(){this.prevNodes=[]}shutdown(){this.key=void 0,this.prevNodes.length=0}destroy(){this.shutdown()}reset(a){this.key=a,this.f=0,this.g=0,this.h=void 0,this.closerH=void 0,this.visited=!1,this.closed=!1}heuristic(a,b,c){if(b===null)return 0;let d,e=this.distanceTo(a)*this.manager.weight;switch(b){case za.astar:d=e;break;case za["astar-line"]:if(c!==void 0){let f=a.angleTo(c)-this.angleTo(c);d=e+Math.abs(f)}else d=e;case za["astar-random"]:d=e+Math.random();break;default:d=e;break}return d}getNextNodes(){return[]}getCost(a){return Fb}distanceTo(a){return 0}angleTo(a){return 0}logicDirTo(a){return 0}getNode(a,b=!1){return this.manager.getNode(a,b)}}function Pd(a){for(let b=a.length-1;b>0;b--){let c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a}class im extends wi{constructor(a){super();this.isTileXYZ=!0;this.pathFinder=a}reset(a){super.reset(a),this.key=a,xi(a,this),this._px=void 0,this._py=void 0,this.cost=void 0}getNextNodes(){let a=Ab.GetNeighborTileXY(this.board,this);this.pathFinder.shuffleNeighbors&&Pd(a);let b=[];return a.forEach(c=>{let d=this.getNode(Pa(c.x,c.y),!0);b.push(d)}),b}getCost(a){return this.pathFinder.cacheCost?this.cost===void 0&&(this.cost=this.pathFinder.getCost(this,a)):this.cost=this.pathFinder.getCost(this,a),this.cost}distanceTo(a){return Sa.GetDistance(this.board,this,a,!0)}angleTo(a){return Db(this.worldX,this.wroldY,a.worldX,a.worldX)}logicDirTo(a){return Ab.GetNeighborTileDirection(this.board,this,a)}get board(){return this.pathFinder.board}get worldX(){if(this._px===void 0){let a=mb.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._px}get wroldY(){if(this._py===void 0){let a=mb.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._py}}class dm{constructor(){this.data=[];this.visited=new Set()}push(a,b){if(Array.isArray(a)){let d=a;for(let e=0,f=d.length;e<f;e++)this.push(d[e]);return this}if(typeof a==="object"){let d=a;a=d.x,b=d.y}let c=`${a},${b}`;return this.visited.has(c)?this:(this.data.push({x:a,y:b}),this.visited.add(c),this)}pop(){return this.data.pop()}get length(){return this.data.length}clear(){return this.data.length=0,this.visited.clear(),this}}let dS=new dm();var Bd;(function(a){a[a.direction=0]="direction",a[a.angle=1]="angle"})(Bd||(Bd={}));function Sb(a=32,b=32){const c=pc(a,b);return new Xa(c.canvas)}function Sg(a,b){const c=a.texture,d=b.shaders.current,e=d.buffer,f=c.binding;d.count===e.batchSize&&b.flush();const g=a.vertexData;b.textures.request(c);const k=f.index;g[4]=k,g[10]=k,g[16]=k,g[22]=k;const i=d.count*e.quadElementSize;e.vertexViewF32.set(g,i);const m=a.vertexColor,o=e.vertexViewU32;o[i+5]=m[0],o[i+11]=m[2],o[i+17]=m[3],o[i+23]=m[1],d.count++}class Og extends Xc{constructor(a=0,b=0){super(a,b);this._alpha=1,this.type="Container"}setSize(a,b=a){return this.transform.updateExtent(a,b),this}setPosition(a,b){return this.transform.position.set(a,b),this}setOrigin(a,b=a){return this.transform.origin.set(a,b),this}setSkew(a,b=a){return this.transform.skew.set(a,b),this}setScale(a,b=a){return this.transform.scale.set(a,b),this}setRotation(a){return this.transform.rotation=a,this}set width(a){this.transform.updateExtent(a)}get width(){return this.transform.extent.width}set height(a){this.transform.updateExtent(void 0,a)}get height(){return this.transform.extent.height}set x(a){this.transform.position.x=a}get x(){return this.transform.position.x}set y(a){this.transform.position.y=a}get y(){return this.transform.position.y}set originX(a){this.transform.origin.x=a}get originX(){return this.transform.origin.x}set originY(a){this.transform.origin.y=a}get originY(){return this.transform.origin.y}set skewX(a){this.transform.skew.x=a}get skewX(){return this.transform.skew.x}set skewY(a){this.transform.skew.y=a}get skewY(){return this.transform.skew.y}set scaleX(a){this.transform.scale.x=a}get scaleX(){return this.transform.scale.x}set scaleY(a){this.transform.scale.y=a}get scaleY(){return this.transform.scale.y}set rotation(a){this.transform.rotation=a}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(a){a!==this._alpha&&(this._alpha=a,this.setDirty(aa.TRANSFORM))}}function Tg(a,b){const c=a.frame;if(!c)return;const d=b.ctx,e=a.transform,{a:f,b:g,c:k,d:i,tx:m,ty:o}=e.world,{x:u,y:A}=e.extent;d.save(),d.setTransform(f,g,k,i,m,o),d.globalAlpha=a.alpha,d.drawImage(c.texture.image,c.x,c.y,c.width,c.height,u,A,c.width,c.height),d.restore()}function oc(a,b){const c=(b*255|0)&255;return(c<<24|a)>>>0}function Ug(a){const b=a.vertexAlpha,c=a.vertexTint,d=a.vertexColor;return d[0]=oc(c[0],b[0]),d[1]=oc(c[1],b[1]),d[2]=oc(c[2],b[2]),d[3]=oc(c[3],b[3]),a}function Zc(a,b,...c){const d=a.getFrame(b),{u0:e,u1:f,v0:g,v1:k,pivot:i}=d;return c.forEach(m=>{if(!m||d===m.frame)return;m.frame=d,i&&m.setOrigin(i.x,i.y),m.frame.setExtent(m),m.hasTexture=!0;const o=m.vertexData;o[2]=e,o[3]=g,o[8]=e,o[9]=k,o[14]=f,o[15]=k,o[20]=f,o[21]=g}),c}function Rg(a,b,...c){if(!a)c.forEach(d=>{d.texture=null,d.frame=null,d.hasTexture=!1});else{let d;a instanceof Xa?d=a:d=jb.get().get(a),d?(c.forEach(e=>{e.texture=d}),Zc(d,b,...c)):console.warn(`Invalid Texture key: ${a}`)}return c}function Vg(a){const b=a.vertexData,{x0:c,y0:d,x1:e,y1:f,x2:g,y2:k,x3:i,y3:m}=Yc(a.transform);return b[0]=c,b[1]=d,b[6]=e,b[7]=f,b[12]=g,b[13]=k,b[18]=i,b[19]=m,a}class _c extends Og{constructor(a,b,c,d){super(a,b);this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertexData=new Float32Array(24).fill(0),this.vertexColor=new Uint32Array(4).fill(4294967295),this.vertexAlpha=new Float32Array(4).fill(1),this.vertexTint=new Uint32Array(4).fill(16777215),this.setTexture(c,d)}setTexture(a,b){return Rg(a,b,this),this}setFrame(a){return Zc(this.texture,a,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}preRender(){this.isDirty(aa.COLORS)&&(Ug(this),this.clearDirty(aa.COLORS)),this.isDirty(aa.TRANSFORM)&&(Vg(this),this.clearDirty(aa.TRANSFORM))}renderGL(a){this.preRender(),Sg(this,a)}renderCanvas(a){this.preRender(),Tg(this,a)}get alpha(){return this._alpha}set alpha(a){if(a!==this._alpha){this._alpha=a;const b=this.vertexAlpha;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(aa.ALPHA)}}get tint(){return this._tint}set tint(a){if(a!==this._tint){this._tint=a;const b=this.vertexTint;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(aa.COLORS)}}destroy(a){super.destroy(a),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertexData=null,this.vertexColor=null,this.vertexAlpha=null,this.vertexTint=null}}function ie(a,b,c){let d=Math.ceil(b*a.resolution),e=Math.ceil(c*a.resolution),f=a.canvas;if(f.width===d||f.height===e){je(a);return}f.width=d,f.height=e,a.texture.setSize(b,c),a.setSize(b,c),a.updateTexture()}function je(a){a.context.clearRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function Jf(a,b="#fff"){let c=a.context;c.fillStyle=b,c.fillRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function ke(a,b,c){let d=new Image();d.onload=function(){let e=a.resolution,f=d.width/e,g=d.height/e;ie(a,f,g),a.context.drawImage(d,0,0),a.updateTexture(),c&&c(),d.onload=null,d.src="",d.remove()},d.src=b}function Kf(a,b){return new Promise(function(c,d){ke(a,b,c)})}function Lf(a,b,c){return a.canvas.toDataURL(b,c)}function Mf(a,b,c,d=[0,0,0,0]){let e=a.context.getImageData(b,c,1,1).data;return d[0]=e[0],d[1]=e[1],d[2]=e[2],d[3]=e[3],d}function Nf(a,b,c,d,e,f,g){g===void 0&&(g=d!==0||e!==0||f!==0?255:0);let k=a.context.createImageData(1,1);k.data[0]=d,k.data[1]=e,k.data[2]=f,k.data[3]=g,a.context.putImageData(k,b,c),a.updateTexture()}class If extends _c{constructor(a=0,b=0,c=32,d=32){super(a,b,Sb());this.type="rexCanvas";const e=va.get();this.resolution=e.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.resize(c,d)}updateTexture(){return this.texture.binding&&this.texture.binding.update(),this.setDirty(aa.TEXTURE),this}destroy(a){this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}resize(a,b){return ie(this,a,b),this}clear(){return je(this),this}}function Ib(a,b,c,d=1){let e;if(typeof a==="string"){let k=jb.get();k.has(a)||k.add(a,Sb()),e=k.get(a)}else e=a;let f=e.image,g=f.getContext("2d");return c?b.call(c,f,g):b(f,g),e.setSize(f.width/d,f.height/d),e.binding&&e.binding.update(),e}var Kk;(function(a){a[a.right=0]="right",a[a.down=1]="down",a[a.left=2]="left",a[a.up=3]="up"})(Kk||(Kk={}));function qk(a,b){b.width!==a.width&&(b.width=a.width),b.height!==a.height&&(b.height=a.height);let c=b.getContext("2d");c.drawImage(a.texture.image,a.x,a.y,a.width,a.height)}function Of(a,b,c=0,d=0,e=a.width,f=a.height){let g=a.resolution,k=a.canvas,i=Math.ceil(e*g),m=Math.ceil(f*g);Ib(b,function(o,u){o.width!==i&&(o.width=i),o.height!==m&&(o.height=m),u.clearRect(0,0,i,m),u.drawImage(k,c,d,i,m)},void 0,a.resolution)}function Pf(a,b,c){let d=jb.get();if(!d.has(b))return;qk(d.get(b).getFrame(c),a.canvas);let e=a.canvas.width,f=a.canvas.height,g=a.resolution,k=e/g,i=f/g;a.texture.setSize(k,i),a.setSize(k,i),a.updateTexture()}class pk extends If{fill(a="#fff"){return Jf(this,a),this}getCanvas(){return this.canvas}getContext(){return this.context}getDataURL(a,b){return Lf(this,a,b)}getPixel(a,b,c=[0,0,0,0]){return Mf(this,a,b,c)}generateTexture(a,b=0,c=0,d=this.width,e=this.height){return Of(this,a,b,c,d,e),this}loadFromURL(a,b){return ke(this,a,b),this}loadFromURLPromise(a){return Kf(this,a)}loadTexture(a,b){return Pf(this,a,b),this}setPixel(a,b,c,d,e,f){return Nf(this,a,b,c,d,e,f),this}}const v6=Fa(vh());const Ai={receive:"receive"};function ag(a,b){return a.events.delete(b),a}function $f(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);for(const e of d)e.callback.apply(e.context,c),e.once&&d.delete(e);return d.size===0&&a.events.delete(b),!0}class Yf{constructor(){this.events=new Map()}}class Lc{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function cg(a){return[...a.events.keys()]}function bg(a,b){const c=a.events.get(b);return c?c.size:0}function dg(a,b){const c=[],d=a.events.get(b);return d.forEach(e=>{c.push(e.callback)}),c}function _f(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof Lc)g.delete(c);else{const k=!d,i=e!==void 0;for(const m of g)m.callback===c&&(k&&m.context===d)&&(i&&m.once===e)&&g.delete(m)}return g.size===0&&f.delete(b),a}function Kc(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new Lc(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function Zf(a,b,c,d=a){return Kc(a,b,c,d,!0)}function pe(a,b){b?a.events.delete(b):a.events.clear()}class Ca{setEventEmitter(a){return this.privateEE=a===void 0,this.eventEmitter=this.privateEE?new Yf():a,this}clearEventEmitter(){return this.setEventEmitter(null),this}destroyEventEmitter(){return this.eventEmitter&&this.privateEE&&(pe(this.eventEmitter),this.eventEmitter=null),this}on(a,b,c=this,d=!1){return this.eventEmitter&&Kc(this.eventEmitter,a,b,c,d),this}once(a,b,c=this){return this.eventEmitter&&Zf(this.eventEmitter,a,b,c),this}off(a,b,c,d){return this.eventEmitter&&_f(this.eventEmitter,a,b,c,d),this}emit(a,...b){return this.eventEmitter&&$f(this.eventEmitter,a,...b),this}removeAllListeners(a){return this.eventEmitter&&pe(this.eventEmitter,a),this}clearEvent(a){return this.eventEmitter&&ag(this.eventEmitter,a),this}getListenerCount(a){return this.eventEmitter?bg(this.eventEmitter,a):0}getEventNames(){return this.eventEmitter?cg(this.eventEmitter):[]}getListeners(a){return this.eventEmitter?dg(this.eventEmitter,a):[]}}function Bi(a,b){(!a.sendToRef||a.sendToRef.key!==a.receiverID)&&(a.sendToRef=a.database.ref(a.rootPath).child(a.receiverID));if(b===void 0)return a.sendToRef.remove();let c={message:b,senderID:a.userID,stamp:a.stamp};return a.userName!==void 0&&(c.senderName=a.userName),a.skipFirst=!1,a.stamp=!a.stamp,a.sendToRef.set(c)}function Ci(a){if(a.isReceiving&&a.receiverRef.key===a.receiverID)return;vf(a),a.isReceiving=!0,a.skipFirst=!0,a.receiverRef=a.database.ref(a.rootPath).child(a.receiverID),a.receiverRef.on("value",Ei,a),a.receiverRef.onDisconnect().remove()}function vf(a){if(!a.isReceiving)return;a.isReceiving=!1,a.receiverRef.off("value",Ei,a),a.receiverRef.remove(),a.receiverRef.onDisconnect().cancel()}function Ei(a){if(this.skipFirst){this.skipFirst=!1;return}let b=a.val();if(b==null)return;delete b.stamp,this.history.add(b),this.emit(this.eventNames.receive,b)}class Di{constructor({maxLength:a=-1}={}){this.maxLength=a,this.records=[]}add(a){return this.maxLength===0?this:(this.records.push(a),this.maxLength>0&&this.records.length>this.maxLength&&this.records.shift(),this)}clear(){return this.records.length=0,this}changeUserName(a,b){return this.maxLength===0?this:(this.records.forEach(c=>{c.senderID===a&&(c.senderName=b)}),this)}}const iV=Fa(Ja());class bc extends Ca{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d,receiverID:e="",history:f=0,eventNames:g=Ai}={}){super();this.setEventEmitter(a),this.eventNames=g,this.database=iV.database(),this.setRootPath(b),this.skipFirst=!0,this.stamp=!1,this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.isReceiving=!1,f===!0?f=-1:f===!1&&(f=0),this.history=new Di({maxLength:f})}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.sendToRef=void 0,this.receiverRef=void 0,this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.receiverID=a,this}changeUserName(a,b){return a===this.userID&&(this.userName=b),this.history.changeUserName(a,b),this}getHistory(){return this.history.records}clearHistory(){return this.history.clear(),this}send(a){return Bi(this,a)}startReceiving(){return Ci(this),this}stopReceiving(){return vf(this),this}}const An="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function Wd(a,b,c=An){let d=b===void 0?a:vc(a,b),e="";for(let f=0;f<d;f++)e+=_b(Array.from(c));return e}const P_=Fa(Ja());var ra;(function(a){a[a["1d"]=1]="1d",a[a["2d"]=2]="2d",a[a["3d"]=3]="3d"})(ra||(ra={}));const Fi={init:"init",update:"update",addkey0:"addkey0",removekey0:"removekey0",changekey0:"changekey0",addkey1:"addkey1",removekey1:"removekey1",changekey1:"changekey1",addkey2:"addkey2",removekey2:"removekey2",changekey2:"changekey2"};function Sk(a){return a==null||a===""||a.length===0}function zn(a,b,c={}){let d=a;if(!Sk(b)){typeof b==="string"&&(b=b.split("."));let e;for(let f=0,g=b.length;f<g;f++){e=b[f];if(d[e]==null||typeof d[e]!=="object"){let k;f===g-1?k=c:k={},d[e]=k}d=d[e]}}return d}function Tk(a,b,c){if(typeof a!=="object")return;if(Sk(b)){if(c==null)return;typeof c==="object"&&(a=c)}else{typeof b==="string"&&(b=b.split("."));let d=b.pop(),e=zn(a,b);e[d]=c}return a}function qe(a){if(Array.isArray(a))a.length=0;else for(let b in a)delete a[b]}function Rk(a){return JSON.parse(JSON.stringify(a))}class Gi{constructor(){this.data={}}setValue(a,b){return a==null?this.clear():typeof a==="object"?this.data=a:Tk(this.data,a,b),this}getValue(a){if(a==null)return this.data;{typeof a==="string"&&(a=a.split("."));let b=this.data;for(let c=0,d=a.length;c<d;c++){if(!eg(b))return;b=b[a[c]]}return b}}cloneValue(a){return Rk(this.getValue(a))}removeKey(a){if(a==null)this.clear();else{typeof a==="string"&&(a=a.split("."));let b=a.pop(),c=this.data;for(let d=0,e=a.length;d<e;d++){if(!eg(c))return this;c=c[a[d]]}eg(c)&&delete c[b]}return this}clear(){return qe(this.data),this}}function eg(a){return a!=null&&typeof a==="object"}const $V=Fa(Ja());class Gb extends Ca{constructor({eventEmitter:a,parent:b,key:c,type:d,eventNames:e,table:f}={}){super();this.setEventEmitter(a),this.parent=b,this.children=new Map(),this.key=c,this.parent?this.fullKeyPath=Qi(this.parent.fullKeyPath,this.key):this.fullKeyPath="",this.type=d,this.eventNames=e,this.table=f,this.database=$V.database(),this.setRootPath()}destroy(){this.stopUpdate().clear().destroyEventEmitter()}setRootPath(a){if(a===void 0){let b=this.parent?this.parent.rootPath:"";a=`${b}/${this.key}`}this.rootPath=a,this.rootRef=a!==""?this.database.ref(a):void 0;for(const[b,c]of this.children)c instanceof Gb&&c.setRootPath();return this}setData(a,b){if(arguments.length===0)this.clear();else if(typeof a=="string")this.setChildData(a,b);else{let c=a;for(const[d,e]of this.children)c.hasOwnProperty(d)||this.removeChild(d);for(let d in c)this.setChildData(d,c[d])}return this}clear(){this.table.removeKey(this.fullKeyPath);for(const[a,b]of this.children)this.removeChild(a);return this}get childClass(){return null}setChildData(a,b){const c=Qi(this.fullKeyPath,a);this.table.setValue(c,b);if(!(typeof b!=="object")){if(this.children.has(a))this.children.get(a).setData(b);else if(this.childClass){let d=new this.childClass({parent:this,key:a,type:this.type,eventEmitter:this.eventEmitter,eventNames:this.eventNames,table:this.table});d.startUpdate(),this.children.set(a,d)}}return this}removeChild(a){return this.children.has(a)&&(this.children.get(a).destroy(),this.children.delete(a)),this}startUpdate(){return this}stopUpdate(){return this}}function Qi(a,b){return a==null||a===""?b:b==null||b===""?a:`${a}.${b}`}class zc extends Gb{startUpdate(){return this.rootRef.on("child_added",this.addCol,this),this.rootRef.on("child_removed",this.removeCol,this),this.rootRef.on("child_changed",this.changeColValue,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addCol,this),this.rootRef.off("child_removed",this.removeCol,this),this.rootRef.off("child_changed",this.changeColValue,this),this}addCol(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["1d"]:this.emit(this.eventNames.addkey0,b,c);break;case ra["2d"]:this.emit(this.eventNames.addkey1,this.key,b,c);break;default:this.emit(this.eventNames.addkey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}removeCol(a){const b=a.key;this.removeChild(b);switch(this.type){case ra["1d"]:this.emit(this.eventNames.removekey0,b);break;case ra["2d"]:this.emit(this.eventNames.removekey1,this.key,b);break;default:this.emit(this.eventNames.removekey2,this.pageKey,this.key,b);break}this.emit(this.eventNames.update,this.table.data)}changeColValue(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["1d"]:this.emit(this.eventNames.changekey0,b,c);break;case ra["2d"]:this.emit(this.eventNames.changekey1,this.key,b,c);break;default:this.emit(this.eventNames.changekey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}get pageKey(){return this.parent.key}}class Ac extends Gb{startUpdate(){return this.rootRef.on("child_added",this.addRow,this),this.rootRef.on("child_removed",this.removeRow,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addRow,this),this.rootRef.off("child_removed",this.removeRow,this),this}addRow(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["2d"]:this.emit(this.eventNames.addkey0,this.key,b,c);break;default:this.emit(this.eventNames.addkey1,this.key,b,c);break}}removeRow(a){const b=a.key;this.removeChild(b);switch(this.type){case ra["2d"]:this.emit(this.eventNames.removekey0,b);break;default:this.emit(this.eventNames.removekey1,this.key,b);break}}get childClass(){return zc}}class wf extends Gb{startUpdate(){return this.rootRef.on("child_added",this.addPage,this),this.rootRef.on("child_removed",this.removePage,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addPage,this),this.rootRef.off("child_removed",this.removePage,this),this}addPage(a){const b=a.key,c=a.val();this.setData(b,c),this.emit(this.eventNames.addkey0,b,c)}removePage(a){const b=a.key;this.removeChild(b),this.emit(this.eventNames.removekey0,b)}get childClass(){return Ac}}const Sd={};Sd[ra["1d"]]=zc;Sd[ra["2d"]]=Ac;Sd[ra["3d"]]=wf;function Hi(a){return new Sd[a.tableType]({type:a.tableType,eventEmitter:a.eventEmitter,eventNames:a.eventNames,table:a.table})}function Ii(a){return a.updater.clear(),a.initialFlag=!1,a.rootRef.once("value").then(function(b){let c=b.val()||{};return a.table.setValue(c),a.emit(a.eventNames.init,c),a.initialFlag=!0,Promise.resolve(c)})}function Ea(a,b,c,d){let e=a.rootRef;return e=b?e.child(b):e,e=c?e.child(c):e,e=d?e.child(d):e,e}function Ji(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ea(a,c,d,e).set(f)}function Ki(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;default:c=b[0];break}return Ea(a,c,d,e).remove()}function Li(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ea(a,c,d,e).transaction(function(g){return g===null&&(g=0),g+f})}function Mi(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ea(a,c,d,e).transaction(f)}function Ni(a,b){return Ea(a).update(b)}function Oi(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;case 1:c=b[0];break}return Ea(a,c,d,e).onDisconnect().remove()}function Pi(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ea(a,c,d,e).onDisconnect().set(f)}const CV=Fa(Ja());class cc extends Ca{constructor({eventEmitter:a,root:b="",type:c=ra["3d"],eventNames:d=Fi}={}){super();this.setEventEmitter(a),this.eventNames=d,this.database=CV.database(),this.table=new Gi(),this.setTableType(c),this.setRootPath(b),this.initialFlag=!1}destroy(){this.updater.destroy(),this.destroyEventEmitter().stopUpdate()}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):null,this.updater.setRootPath(a),this}setTableType(a){return typeof a==="string"&&(a=ra[a]),this.tableType=a,this.updater&&this.updater.destroy(),this.updater=Hi(this),this}startUpdate(){return Ii(this),this.updater.startUpdate(),this}stopUpdate(){return this.updater.stopUpdate(),this}clear(){return this.updater.clear(),this}getData(){return this.table.getValue(...arguments)}cloneData(){return this.table.cloneValue(...arguments)}getItemRef(a,b,c){return Ea(this,a,b,c)}setData(...a){return Ji(this,...a)}removeData(...a){return Ki(this,...a)}incValue(...a){return Li(this,...a)}transaction(...a){return Mi(this,...a)}updateData(a){return Ni(this,a)}removeDataOnDisconnect(...a){return Oi(this,...a)}setDataOnDisconnect(...a){return Pi(this,...a)}}const ZZ=Fa(Ja());var Ef;(function(a){a.d="d",a.w="w",a.m="m",a.y="y",a.day="d",a.week="w",a.month="m",a.year="y"})(Ef||(Ef={}));var Gc;(function(a){a.d="tagD",a.w="tagW",a.m="tagM",a.y="tagY"})(Gc||(Gc={}));var Hc;(function(a){a.d="scoreD",a.w="scoreW",a.m="scoreM",a.y="scoreY"})(Hc||(Hc={}));var Yj;(function(a){a.d="day",a.w="week",a.m="month",a.y="year"})(Yj||(Yj={}));function Hf({query:a,totalLines:b=Infinity,linesPerPage:c=1e3,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g}){return ok({query:a,remainderLines:b,linesPerPage:c,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g})}function ok(a){let b=a.query;a.startDocRef&&(b=b[a.startMode](a.startDocRef));let c=Math.min(a.remainderLines,a.linesPerPage);return a.remainderLines-=c,b.limit(c).get().then(function(d){let e=a.remainderLines===0||d.size<c,f=!1;a.forEachPageCallback&&(f=a.forEachPageCallback(d)||!1),e=e||f;if(e){let g;return a.resolveCallback&&(g=a.resolveCallback()),Promise.resolve(g)}else return a.startDocRef=d.docs[d.size-1],a.startMode="startAfter",ok(a)})}function Ia(a,b=Infinity,c=0,d,e){let f=[],g=0;return Hf({query:a,totalLines:c+b,startDocRef:d,startMode:e,forEachPageCallback:function(k){let i,m=k.size,o=c-g;o<=0?i=k.docs:o<m&&(i=k.docs.slice(o,m)),i&&f.push(...i),g+=m},resolveCallback:function(){return f}})}const _0=Fa(Ja());function fk(a,b,c=0){return Ia(a.nextQuery,b,c,a.baselineDocRef,a.baselineMode).then(function(d){let e=d.length;return a.cacheItems=d,a.pageIndex=void 0,a.startItemIndex=c,a.endItemIndex=a.startItemIndex+e-1,a.isFullPage=b===void 0?!0:e===b,Promise.resolve(a.cacheItems)})}const y0=Fa(Ja());class he{constructor({query:a={next:void 0,previous:void 0},itemCount:b=100,baselineDoc:c,baselineMode:d="startAt"}={}){this.setQuery(a),this.setItemCount(b),this.setBaselineDoc(c,d),this.pageIndex=void 0,this.baselineDocRef=void 0,this.baselineMode="startAt",this.startItemIndex=void 0,this.endItemIndex=void 0,this.cacheItems=void 0,this.isFullPage=void 0}setQuery(a,b){if(a instanceof y0.firestore.Query)this.nextQuery=a,this.prevQuery=b;else{var c=a;this.nextQuery=c.next,this.prevQuery=c.previous}return this.pageIndex=null,this.isFullPage=!0,this}setItemCount(a){return this.itemCount=a,this}setBaselineDoc(a,b){return a?(this.baselineDocRef=a.ref,this.baselineMode=b):this.baselineDocRef=void 0,this}load(a,b=0){return fk(this,a,b)}loadFirstPage(){return this._loadFirstPage()}loadNextPage(){return this.pageIndex==null?this._loadFirstPage():this._loadNextPage()}loadPreviousPage(){return this.pageIndex==null||this.pageIndex===1?this._loadFirstPage():this._loadPreviousPage()}loadCurrentPage(){return this.pageIndex==null||this.pageIndex===0?this._loadFirstPage():this._loadCurrentPage()}}function lk(a){return Ia(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=null,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function gk(a){return Ia(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,Promise.resolve(a.cacheItems)})}function mk(a){return Ia(a.nextQuery,a.itemCount,0,a.currPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=a.currPageEndDocRef,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function hk(a){let b=(a.pageIndex+1)*a.itemCount;return Ia(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function nk(a){return Ia(a.prevQuery,a.itemCount+1,0,a.currPageStartDocRef,"startAfter").then(function(b){let c=b.length-1;return a.cacheItems=b,a.cacheItems.pop(),a.cacheItems.reverse(),a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-c+1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=b[c].ref,a.currPageStartDocRef=b[c-1].ref,a.currPageEndDocRef=b[0].ref,Promise.resolve(a.cacheItems)})}function ik(a){let b=(a.pageIndex-1)*a.itemCount;return Ia(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-d+1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function kk(a){return Ia(a.nextQuery,a.itemCount,0,a.prevPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function jk(a){let b=a.pageIndex*a.itemCount;return Ia(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}class Ff extends he{_loadFirstPage(){return gk(this)}_loadNextPage(){return hk(this)}_loadPreviousPage(){return ik(this)}_loadCurrentPage(){return jk(this)}}const C$=Fa(Ja());class ge extends he{_loadFirstPage(){return lk(this)}_loadNextPage(){return mk(this)}_loadPreviousPage(){return nk(this)}_loadCurrentPage(){return kk(this)}}const u0=Fa(Ja());function _j(a,b){let c={senderID:a.userID,message:b,timestamp:u0.firestore.FieldValue.serverTimestamp()};return a.userName!==void 0&&(c.senderName=a.userName),a.receiverID!==void 0&&(c.receiverID=a.receiverID),a.rootRef.add(c)}function Gf(a,b=a.receiverID){let c=a.rootRef;return c=b!==void 0?c.where("receiverID","==",b):c,c}function Zj(a,b=a.receiverID){let c=Gf(a,b),d=c.orderBy("timestamp"),e=c.orderBy("timestamp","desc");return{next:d,previous:e}}function $j(a){let b=Gf(a).orderBy("timestamp","desc").limit(1);a.unsubscribe=b.onSnapshot({includeMetadataChanges:!0},function(c){if(c.size>0){let d=c.docs[0];if(d.metadata.hasPendingWrites){a.skipFirst&&(a.skipFirst=!1);return}dk(a,a.receiverID,d);if(a.skipFirst)a.skipFirst=!1;else{let e=ek(d);a.cacheMessages.push(e),a.emit("receive",e)}}else a.skipFirst&&(a.skipFirst=!1)},function(c){debugger})}function ak(a){a.unsubscribe&&a.unsubscribe(),a.resetQueryFlag=!0,a.cacheMessages.length=0}function bk(a){return dk(a),a.page.loadNextPage().then(function(b){let c=[];for(let d=0,e=b.length;d<e;d++)c.push(ek(b[d]));return a.cacheMessages.splice(0,0,...c),Promise.resolve(c)})}function dk(a,b=a.receiverID,c){if(!a.resetQueryFlag)return;a.resetQueryFlag=!1;let d=a.skipFirst?"startAt":"startAfter";a.page.setBaselineDoc(c,d).setQuery(Zj(a,b));return}function ek(a){let b=a.data();return b.timestamp=b.timestamp.toDate(),b}const m0=Fa(Ja());class ck extends Ca{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d="",receiverID:e,pageItemCount:f=100}={}){super();this.setEventEmitter(a),this.database=m0.firestore(),this.setRootPath(b),this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.skipFirst=!0,this.unsubscribe=void 0,this.page=new ge(),this.setPageItemCount(f),this.resetQueryFlag=!0,this.cacheMessages=[]}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.resetQueryFlag=this.resetQueryFlag||this.rootPath!==a,this.rootPath=a,this.rootRef=this.database.collection(a),this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.resetQueryFlag=this.resetQueryFlag||this.receiverID!==a,this.receiverID=a,this}setPageItemCount(a){return this.page.setItemCount(a),this}get hasPreviousMessage(){return this.page.isFullPage!==!1}send(a){return _j(this,a)}startReceiving(){return $j(this),this}stopReceiving(){return ak(this),this}loadPreviousMessages(){return bk(this)}}const Si={join:"join",leave:"leave",update:"update",change:"change",init:"init",changename:"changename"};var ib;(function(a){a[a.once=0]="once",a[a.child=1]="child",a[a.all=2]="all"})(ib||(ib={}));const Nj={update:"update",add:"add",remove:"remove",change:"change"};function ee(a){a.items.length=0,a.itemID2Index.clear()}function Oj(a){return a.items}function Pj(a,b){return a.itemID2Index.has(b)}function yf(a,b){return b==null?null:a.itemID2Index.get(b)}function Qj(a,b){if(b==null)return null;let c=yf(a,b);return c==null?null:a.items[c]}function Rj(a,b,c){a.items.forEach(b,c)}function rb(a){a.itemID2Index.clear();let b=a.items;for(var c=0,d=b.length;c<d;c++){let e=b[c][a.keyItemID];a.itemID2Index.set(e,c)}}function Sj(a,b){if(b>=a.length)return;let c=a.length-1,d=a[b];for(let e=b;e<c;e++)a[e]=a[e+1];return a.length=c,d}function zf(a,b){let c=Bf.call(this,a,b);rb(this),this.emit(this.eventNames.add,c),this.emit(this.eventNames.update,this.items)}function Ec(a,b){let c=Tj.call(this,a);rb(this);let d=Bf.call(this,a,b);rb(this),this.emit(this.eventNames.change,d,c),this.emit(this.eventNames.update,this.items)}function Af(a){let b=Tj.call(this,a);rb(this),this.emit(this.eventNames.remove,b),this.emit(this.eventNames.update,this.items)}function Fc(a){ee(this),a.forEach(function(b){Bf.call(this,b,null,!0)}.bind(this)),rb(this),this.emit(this.eventNames.update,this.items)}function Bf(a,b,c=!1){let d,e=this.getItemCallback,f=this.getItemCallbackScope;f?d=e.call(f,a):d=e(a);if(c)return this.items.push(d),d;if(b==null)this.items.unshift(d);else{let g=this.itemID2Index.get(b);g===this.items.length-1?this.items.push(d):this.items.splice(g+1,0,d)}return d}function Tj(a){let b=this.itemID2Index.get(a.key),c=Sj(this.items,b);return c}const Wj={start(a,b){a.isUpdating=!1,b.once("value",Fc,a)},stop(a){}};const Vj={start(a,b){b.on("child_added",zf,a),b.on("child_removed",Af,a),b.on("child_moved",Ec,a),b.on("child_changed",Ec,a)},stop(a){a.query.off("child_added",zf,a),a.query.off("child_removed",Af,a),a.query.off("child_moved",Ec,a),a.query.off("child_changed",Ec,a)}};const Uj={start(a,b){b.on("value",Fc,a)},stop(a){a.query.off("value",Fc,a)}};const Dc={};Dc[ib.all]=Uj;Dc[ib.child]=Vj;Dc[ib.once]=Wj;class Hb extends Ca{constructor({eventEmitter:a,itemIDKey:b="__itemID__",mode:c=ib.child,getItemCallback:d=Em,getItemCallbackScope:e,query:f,eventNames:g=Nj}={}){super();this.setEventEmitter(a),this.eventNames=g,this.isUpdating=!1,this.items=[],this.itemID2Index=new Map(),this.setItemIDKey(b),this.setMode(c),e===void 0&&(e=this),this.setGetitemCallback(d,e),this.setQuery(f)}destroy(){this.stopUpdate().clear()}setItemIDKey(a){return this.keyItemID=a,this}setMode(a){return typeof a==="string"&&(a=ib[a]),this.mode=a,this.updater=Dc[a],this}setGetitemCallback(a,b){return this.getItemCallback=a,this.getItemCallbackScope=b,this}setQuery(a){return this.query=a,this}startUpdate(a){if(a)this.setQuery(a);else if(this.query)a=this.query;else return this;return this.stopUpdate().clear(),this.isUpdating=!0,this.updater.start(this,a),this}stopUpdate(){return!this.query||!this.isUpdating?this:(this.isUpdating=!1,this.updater.stop(this),this)}clear(){return ee(this),this}getItems(){return Oj(this)}hasItem(a){return Pj(this,a)}getItemIndexFromItemID(a){return yf(this,a)}getItemFromItemID(a){return Qj(this,a)}forEach(a,b){return Rj(this,a,b),this}updateItemID2Index(){return rb(this),this}}const Em=function(a){let b=a.val();return b[this.keyItemID]=a.key,b};function pb(a,b=a.userID){return a.userID2ItemID.has(b)}function Td(a,b=a.userID){if(!pb(a,b))return null;let c=a.userID2ItemID.get(b);return a.rootRef.child(c)}function Wi(a,b=a.userID){if(!pb(a,b))return null;let c=a.userID2ItemID.get(b);return a.userList.getItemFromItemID(c)}function xf(a){return a.userList.getItems()}function Xi(a){a.userList.clear()}function Yi(a,b,c){a.userList.forEach(b,c)}function Zi(a,b=a.userID){let c=a.userList.getItems()[0];return c&&c.userID===b}function _i(a){return a.maxUsers===0?!1:a.userList.getItems().length>=a.maxUsers}function Ti(a=0,b){return new Promise(function(c,d){setTimeout(function(){c(b)},a)})}function Ui(a,b=a.userID,c=a.userName){if(pb(a,b))return Promise.resolve();let d={userID:b,userName:c},e=a.maxUsers,f=a.database.ref(a.rootPath),g=f.push();return g.onDisconnect().remove().then(function(){return g.set(d)}).then(function(){return Ti(0)}).then(function(){return e===0?(a.isInList=!0,Promise.resolve()):f.limitToFirst(e).once("value").then(function(k){return sm(k,b)?(a.isInList=!0,Promise.resolve()):(a.isInList=!1,g.remove().then(function(){return g.onDisconnect().cancel()}).then(function(){return Promise.reject()}))})})}function sm(a,b){let c=!1;return a.forEach(function(d){let e=d.val();if(e.userID===b)return c=!0,!0}),c}function Vi(a,b=a.userID){if(!pb(a,b))return Promise.resolve();let c=a.userID2ItemID.get(b),d=a.database.ref(a.rootPath).child(c);return d.remove()}function Ri(a,b){return new Promise(function(c,d){let e=Td(a);if(e)return c(e);{let f=a.rootRef.orderByChild("userID").equalTo(a.userID);f.once("child_added").then(function(g){return c(g.ref)})}}).then(function(c){return c.child("userName").set(b)}).then(function(){return a.userName=b,Promise.resolve()})}const MW=Fa(Ja());class dc extends Ca{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,eventNames:f=Si}={}){super();this.setEventEmitter(a),this.eventNames=f,this.database=MW.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.setMaxUsers(e),this.userList=new Hb({eventEmitter:this.eventEmitter,itemIDKey:"joinAt",eventNames:{add:f.join,remove:f.leave,update:f.update,change:f.change}}),this.isInList=!1,this.userID2ItemID=new Map(),this.userList.on(this.eventNames.join,function(g){this.userID2ItemID.set(g.userID,g.joinAt),g.userID===this.userInfo.userID&&this.emit(this.eventNames.init,xf(this))},this).on(this.eventNames.leave,function(g){this.userID2ItemID.delete(g.userID),g.userID===this.userID&&(this.isInList=!1)},this).on(this.eventNames.change,function(g,k){let i=g.userID,m=g.userName,o=k.userName;m!==o&&this.emit(this.eventNames.changename,i,m,o)},this)}destroy(){this.stopUpdate().destroyEventEmitter().leave(),this.userList.destroy()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setMaxUsers(a){return this.maxUsers=a,this}clear(){return Xi(this),this}forEach(a,b){return Yi(this,a,b),this}isFull(){return _i(this)}isFirstUser(a=this.userID){return Zi(this,a)}getUser(a=this.userID){return Wi(this,a)}getUsers(){return xf(this)}getUserRef(a=this.userID){return Td(this,a)}contains(a=this.userID){return pb(this,a)}join(a=this.userID,b=this.userName){return Ui(this,a,b)}leave(a=this.userID){return Vi(this,a)}changeUserName(a){return Ri(this,a)}startUpdate(){let a=this.rootRef;return this.maxUsers>0&&(a=a.limitToFirst(this.maxUsers)),this.userList.startUpdate(a),this}stopUpdate(){return this.userList.stopUpdate(),this}}function lj(a){const b=new dc({eventEmitter:a.eventEmitter,eventNames:{join:"userlist.join",leave:"userlist.leave",update:"userlist.update",change:"userlist.change",init:"userlist.init",changename:"userlist.changename"},userID:a.userInfo});return b.on("userlist.leave",function(c){c.userID===a.userID&&xm(a)}),a.on("room.join",function(){b.startUpdate()}).on("room.leave",function(){b.stopUpdate().clear()}),b}function xm(a){a.emit("room.leave"),setTimeout(function(){a.roomID=void 0,a.roomName=void 0,a.doorState=void 0,a.leftRoomFlag=!1},0)}function ij(a){const b=new Hb({eventEmitter:a.eventEmitter,itemIDKey:"roomID",eventNames:{update:"roomlist.update",add:"roomlist.add",remove:"roomlist.remove",change:"roomlist.change"},mode:"once"});return b}function sj(a){return a.split("|")[0]}function rj(a){return a.split("|")[1]}function ec(a,b=""){return`${a}|${b}`}function $a(a,b){let c=a.rootRef;return b&&(c=c.child(b)),c}function Cc(a,b,c){let d=$a(a,"rooms");return b!==void 0&&(d=d.child(b),c!==void 0&&(d=d.child(c))),d}function hj(a,b){return Cc(a,b,"alive")}function mj(a,b){return Cc(a,b,"users")}function Bc(a,b){let c=$a(a,"room-filters");return b!==void 0&&(c=c.child(b)),c}function fc(a,b){let c=$a(a,"room-metadata");return b!==void 0&&(c=c.child(b)),c}function Vd(a,b,c){let d=`${a.rootPath}/rooms/${b}`;return c&&(d+=`/${c}`),d}function Yd(a,b){return Vd(a,b,"users")}function jj(a,b,c){let d=Vd(a,b,"tables");return c&&(d+=`/${c}`),d}function nj(a,b,c="open"){let d=Bc(a);return d=d.orderByChild("filter"),b===void 0?d=d.startAt(c).endAt(`${c}~`):d=d.equalTo(ec(c,b)),d}function ej(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new bc({eventEmitter:a.eventEmitter,eventNames:{receive:"broadcast.receive"},receiverID:"boradcast",senderID:a.userInfo,history:b.history});return a.on("room.join",function(d){c.setRootPath(Vd(a,d.roomID)).startReceiving()}).on("room.leave",function(){c.stopReceiving()}).on("userlist.changename",function(d,e){c.changeUserName(d,e)}),c}function kj(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,wm(a,d))}),a.on("room.join",function(d){for(const[e,f]of c)f.setRootPath(jj(a,d.roomID,e)).startUpdate()}).on("room.leave",function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function wm(a,{key:b,type:c=ra["1d"]}){const d=new cc({eventEmitter:a.eventEmitter,type:c,eventNames:{init:`tables.${b}.init`,update:`tables.${b}.update`,addkey0:`tables.${b}.addkey0`,removekey0:`tables.${b}.removekey0`,changekey0:`tables.${b}.changekey0`,addkey1:`tables.${b}.addkey1`,removekey1:`tables.${b}.removekey1`,changekey1:`tables.${b}.changekey1`,addkey2:`tables.${b}.addkey2`,removekey2:`tables.${b}.removekey2`,changekey2:`tables.${b}.changekey2`}});return d}function Oa(a,b=a.roomID,c=a.roomName){return{roomID:b,roomName:c}}function ae(a,b){return b===void 0?a.roomID!==void 0:a.roomID===b}function vj(a){return a.userList.isFull()}function wj(a,b=a.userID){return a.userList.isFirstUser(b)}function xj(a){return a.userList.getUsers()}function Zd(a,b,c,d){a.roomID=b,a.roomName=c,a.roomType=d,a.emit("room.join",Oa(a))}function Xd(a,b={}){return b.roomID==null&&(b.roomID=Cc(a).push().key),um(a,b.roomID).then(function(){return vm(a,b)})}function um(a,b){return hj(a,b).transaction(function(c){return c===null?!0:void 0})}function vm(a,{roomID:b,roomName:c="",roomType:d="",maxUsers:e=0,presisted:f=!1,door:g="open",join:k=!0,filterData:i}){let m=Cc(a,b),o=Bc(a,b),u=fc(a,b);a.isRemoveRoomWhenLeft=!f,a.isRemoveRoomWhenLeft&&(m.onDisconnect().remove(),o.onDisconnect().remove(),u.onDisconnect().remove());const A=ec(g,d),B={},E={filter:A,name:c};i&&(E.data=i),B[`room-filters/${b}`]=E;const G={name:c,filter:A,maxUsers:e,moderators:{}};return G.moderators[a.userID]=a.userName,B[`room-metadata/${b}`]=G,new Promise(function(I,L){if(k){const R=a.userList.setRootPath(Yd(a,b)).setMaxUsers(0).join();return a.userList.setMaxUsers(e),R.then(I,L)}else return I()}).then(function(){return $a(a).update(B)}).then(function(){return a.isRoomCreator=!0,k&&Zd(a,b,c,d),Promise.resolve(Oa(a))})}function fj(a,{digits:b=10,candidates:c="0123456789",retry:d=1e3}){let e=arguments[1];return gj(a,b,c,d,e)}function gj(a,b,c,d,e){return e.roomID=Wd(b,b,c),d<=0?Promise.reject(e):(d--,Xd(a,e).catch(function(){return gj(a,b,c,d,e)}))}function be(a,b=a.roomID){const c={};c[`room-filter/${b}`]=null,c[`room-metadata/${b}`]=null,c[`rooms/${b}`]=null;const d=Oa(a);return $a(a).update(c).then(function(){return Promise.resolve(d)})}function gc(a){if(!ae(a))return Promise.resolve(Oa(a));a.leftRoomFlag=!0;if(a.isRemoveRoomWhenLeft)return be(a);{const b=Oa(a);return a.userList.leave().then(function(){return Promise.resolve(b)})}}function $d(a,{leftThenJoin:b=!0,roomID:c}){return b?gc(a).then(function(){return tj(a,c)}):tj(a,c)}function tj(a,b){return b==null?Promise.reject(Oa(a,b,"")):(a.isRemoveRoomWhenLeft=!1,ym(a,b).then(function(c){return a.userList.setRootPath(Yd(a,b)).setMaxUsers(c.maxUsers).join().then(function(){return Promise.resolve(c)})}).then(function(c){return Zd(a,b,c.name,rj(c.filter)),Promise.resolve(Oa(a))}))}function ym(a,b){return fc(a,b).once("value").then(function(c){let d=c.val();return zm(a,d)?Promise.resolve(d):Promise.reject()})}function zm(a,b){if(b==null)return!1;if(sj(b.filter)==="closed")return!1;const c=a.userID;if(b.moderators[c])return!0;switch(b.permission){case"blocklist":const d=b.blocklist;return!(d&&d[c]);case"allowlist":const e=b.allowlist;return e&&e[c];default:return!0}}function _d(a,b,c){return new Promise(function(d,e){a.roomList.once("roomlist.update",function(f){d(f)}).startUpdate(nj(a,b,c))})}function pj(a,{roomType:b="",leftThenJoin:c=!0}={}){return _d(a,b,"open").then(function(d){if(d.length===0)return Promise.reject("No filtered room");Pd(d);const e={leftThenJoin:c,roomID:""};return qj(a,e,d)})}function qj(a,b,c,d=0){return d===c.length?Promise.reject("Can't join any room"):(b.roomID=c[d].roomID,d++,$d(a,b).catch(function(){return qj(a,b,c,d)}))}function uj(a,b){return a.userList.contains(b)?b===a.userID?gc(a):a.userList.leave(b):Promise.resolve()}function qb(a,b){return b===a.roomID?Promise.resolve(!0):fc(a,b).once("value").then(function(c){const d=c.val()!==null;return Promise.resolve(d)})}function Ud(a,b,c=a.roomID){return qb(a,c).then(function(d){if(!d)return Promise.resolve();const e=ec(b,a.roomType),f={};return f[`room-filters/${c}/filter`]=e,f[`room-metadata/${c}/filter`]=e,$a(a).update(f)})}function bj(a,b=a.roomID){return Ud(a,"open",b)}function cj(a,b=a.roomID){return Ud(a,"closed",b)}function $i(a,b,c=a.roomID){return qb(a,c).then(function(d){return d?Bc(a,c).child("data").update(b):Promise.resolve()})}function dj(a,b){return a.userList.changeUserName(b)}function aj(a,b,c=a.roomID){return qb(a,c).then(function(d){if(!d)return Promise.resolve();const e={};return e[`room-filters/${c}/name`]=b,e[`room-metadata/${c}/name`]=b,$a(a).update(e)})}function oj(a,b=a.roomID){return b===a.roomID?a.userList.getUsers():new Promise(function(c,d){const e=new Hb({itemIDKey:"joinAt",mode:"once"});e.once("update",function(f){c(f)}).startUpdate(mj(a,b))})}const hY=Fa(Ja());class yj extends Ca{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",broadcast:e=!0,tables:f=!1}={}){super();this.setEventEmitter(a),this.database=hY.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.isRoomCreator=!1,this.roomID=void 0,this.roomName=void 0,this.roomType=void 0,this.doorState=void 0,this.leftRoomFlag=!1,this.isRemoveRoomWhenLeft=void 0,this.userList=lj(this),this.roomList=ij(this),this.broadcast=ej(this,e),this.tables=kj(this,f)}destroy(){var a=this;this.destroyEventEmitter().leaveRoom().then(function(){a.userList.destroy(),a.userList=void 0,a.roomList.destroy(),a.roomList=void 0,a.broadcast.destroy(),a.broadcast=void 0})}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}getRoomInfo(a,b){return Oa(this,a,b)}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(a){return ae(this,a)}isFull(){return vj(this)}isFirstUser(a=this.userID){return wj(this,a)}getUsers(){return xj(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}createRoom(a){return Xd(this,a)}createRandomRoom(a={}){return fj(this,a)}joinRoom(a){return $d(this,a)}joinRandomRoom(a={}){return pj(this,a)}leaveRoom(){return gc(this)}removeRoom(a=this.roomID){return be(this,a)}kickUser(a){return uj(this,a)}changeRoomState(a,b=this.roomID){return Ud(this,a,b)}openRoom(a=this.roomID){return bj(this,a)}closeRoom(a=this.roomID){return cj(this,a)}changeUserName(a){return dj(this,a)}changeFilterData(a,b=this.roomID){return $i(this,a,b)}changeRoomName(a,b,c=a.roomID){return aj(this,b,c)}getUserList(a=this.roomID){return oj(this,a)}getRoomList(a,b){return _d(this,a,b)}HasRoom(a){return qb(this,a)}}function Fj(a,b){let c=a.rootPath;return b&&(c+=`/${b}`),c}function Dj(a){return Fj(a,"users")}function Bj(a,b){return`${Fj(a,"tables")}/${b}`}function Ej(a,b=0){const c=new dc({eventEmitter:a.eventEmitter,eventNames:{join:"userlist.join",leave:"userlist.leave",update:"userlist.update",change:"userlist.change",init:"userlist.init",changename:"userlist.changename"},root:Dj(a),userID:a.userInfo,maxUsers:b});return c.on("userlist.leave",function(d){d.userID===a.userID&&Cm(a)}),a.on("room.join",function(){c.startUpdate()}).on("room.leave",function(){c.stopUpdate().clear()}),c}function Cm(a){a.emit("room.leave"),setTimeout(function(){a.leftRoomFlag=!1},0)}function Aj(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new bc({eventEmitter:a.eventEmitter,eventNames:{receive:"broadcast.receive"},receiverID:"broadcast",senderID:a.userInfo,history:b.history});return a.on("room.join",function(){c.setRootPath(a.rootPath).startReceiving()}).on("room.leave",function(){c.stopReceiving()}).on("userlist.changename",function(d,e){c.changeUserName(d,e)}),c}function Cj(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,Bm(a,d))}),a.on("room.join",function(){for(const[d,e]of c)e.setRootPath(Bj(a,d)).startUpdate()}).on("room.leave",function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function Bm(a,{key:b,type:c=ra["1d"]}){const d=new cc({eventEmitter:a.eventEmitter,type:c,eventNames:{init:`tables.${b}.init`,update:`tables.${b}.update`,addkey0:`tables.${b}.addkey0`,removekey0:`tables.${b}.removekey0`,changekey0:`tables.${b}.changekey0`,addkey1:`tables.${b}.addkey1`,removekey1:`tables.${b}.removekey1`,changekey1:`tables.${b}.changekey1`,addkey2:`tables.${b}.addkey2`,removekey2:`tables.${b}.removekey2`,changekey2:`tables.${b}.changekey2`}});return d}function de(a){return a.userList.isInList}function Jj(a){return a.userList.isFull()}function Kj(a,b=a.userID){return a.userList.isFirstUser(b)}function Lj(a){return a.userList.getUsers()}function Hj(a){return a.userList.join().then(function(){return a.emit("room.join"),Promise.resolve()})}function ce(a){return de(a)?(a.leftRoomFlag=!0,a.userList.leave()):Promise.resolve()}function Gj(a){return a.userList.getUsers()}function Ij(a,b){return a.userList.contains(b)?b===a.userID?ce(a):a.userList.leave(b):Promise.resolve()}function zj(a,b){return a.userList.changeUserName(b)}const _Y=Fa(Ja());class Mj extends Ca{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,broadcast:f=!0,tables:g=!1}={}){const k=arguments[0];super();this.setEventEmitter(a),this.database=_Y.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.leftRoomFlag=!1,this.userList=Ej(this,e),this.broadcast=Aj(this,f),this.tables=Cj(this,g)}shutdown(){}destroy(){this.shutdown()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(){return de(this)}isFull(){return Jj(this)}isFirstUser(a=this.userID){return Kj(this,a)}getUsers(){return Lj(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}joinRoom(){return Hj(this)}leaveRoom(){return ce(this)}getUserList(){return Gj(this)}kickUser(a){return Ij(this,a)}changeUserName(a){return zj(this,a)}}class Uf extends Ca{constructor({eventEmitter:a=!0}={}){super();this.enable=!0;a&&this.setEventEmitter()}destroy(){this.destroyEventEmitter()}toJSON(){return{curState:this.state,prevState:this.prevState,enable:this.enable,start:this._start}}setEnable(a=!0){return this.enable=a,this}set state(a){if(!this.enable||this._stateLock)return;if(this._state===a)return;this._prevState=this._state,this._state=a,this._stateLock=!0,this.emit("statechange",this);if(this._prevState!=null){let b=`exit_${this._prevState}`,c=this[b];c&&c.call(this),this.emit(b,this)}this._stateLock=!1;if(this._state!=null){let b=`enter_${this._state}`,c=this[b];c&&c.call(this),this.emit(b,this)}}get state(){return this._state}get prevState(){return this._prevState}start(a){return this._start=a,this._prevState=void 0,this._state=a,this}goto(a){return a!=null&&(this.state=a),this}next(){let a,b=this["next_"+this.state];return b?(typeof b==="string"?a=b:a=b.call(this),this.goto(a),this):this}update(a,b,c="update"){let d=this[`${c}_${this.state}`];d&&d.call(this,a,b)}preupdate(a,b){this.update(a,b,"preupdate")}postupdate(a,b){this.update(a,b,"postupdate")}addState(a,{next:b,exit:c,enter:d}){return b&&(this[`next_${a}`]=b),c&&(this[`exit_${a}`]=c),d&&(this[`enter_${a}`]=d),this}addStates(a){for(const b in a)this.addState(b,a[b]);return this}}var Vf;(function(a){a[a.shuffle=0]="shuffle",a[a.random=1]="random"})(Vf||(Vf={}));const t6=Fa(Wk());var Wf;(function(a){a[a.none=0]="none",a[a.base64=1]="base64",a[a.utf16=2]="utf16",a[a.uri=3]="uri"})(Wf||(Wf={}));var Ua;(function(a){a[a.none=0]="none",a[a.word=1]="word",a[a.char=2]="char"})(Ua||(Ua={}));var wa;(function(a){a[a.none=0]="none",a[a.raw=1]="raw",a[a.wrapped=2]="wrapped"})(wa||(wa={}));const Bn=/(?:\r\n|\r|\n)/;function Ak(a,b,c,d,e,f=0){e<=0&&(d=0);let g=[];if(!a||!a.length)return g;let k=a.split(Bn),i;for(let m=0,o=k.length;m<o;m++){let u=k[m],A=m===o-1?0:1;if(d===0){g.push(Mc(u,b(u,c),A));continue}m===0?i=e-f:i=e;if(u.length<=100){let L=b(u,c);if(L<=i){g.push(Mc(u,L,A));continue}}let B;d===1?B=u.split(" "):B=u;let E="",G="",I=0;for(let L=0,R=B.length;L<R;L++){let N=B[L];d===1?(E+=N,L<R-1&&(E+=" ")):E+=N;let O=b(E,c);O>i&&(L===0?g.push(Mc("",0,2)):(g.push(Mc(G,I,2)),E=N,d===1&&(L<R-1&&(E+=" ")),O=b(E,c)),i=e),G=E,I=O}g.push(Mc(G,I,A))}return g}let Mc=function(a,b,c){return{text:a,width:b,newLineMode:c}};var Jb;(function(a){a[a.left=0]="left",a[a.center=1]="center",a[a.right=2]="right"})(Jb||(Jb={}));var Kb;(function(a){a[a.top=0]="top",a[a.center=1]="center",a[a.bottom=2]="bottom"})(Kb||(Kb={}));class Rf{constructor(){this.pens=[]}destroy(){this.pens.length=0}addPen(a){return this.pens.push(a),this}get firstPen(){return this.pens[0]}get lastPen(){return this.pens[this.pens.length-1]}hasPen(){return this.pens.length>0}get pensCount(){return this.pens.length}get startIndex(){let a=this.pens[0];return a?a.startIndex:0}get width(){let a=this.lastPen;return a?a.lastX:0}}function Jc(a,b=Array.isArray(a)?[]:{}){qe(b);if(Array.isArray(a)){b.length=a.length;for(let c=0,d=a.length;c<d;c++)b[c]=a[c]}else for(let c in a)b[c]=a[c];return b}class Sf{constructor(){this.text="";this.x=0;this.y=0;this.width=0;this.height=0;this.ascent=0;this.prop={};this.newLineMode=wa.none;this.startIndex=0}set(a="",b=0,c=0,d=0,e=0,f=0,g={},k=wa.none,i=0){return this.text=a,this.x=b,this.y=c,this.width=d,this.height=e,this.ascent=f,this.prop=g,this.newLineMode=k,this.startIndex=i,this}clone(){let a=new Sf();return a.set(this.text,this.x,this.y,this.ascent,this.width,this.height,Jc(this.prop),this.newLineMode,this.startIndex),a}get plainText(){return this.newLineMode===wa.raw?`${this.text}
`:this.text}get wrapText(){return this.newLineMode!==wa.none?`${this.text}
`:this.text}get plainTextLength(){let a=this.text.length;return this.newLineMode===wa.raw&&(a+=1),a}get endIndex(){return this.startIndex+this.plainTextLength}get lastX(){return this.x+this.width}get isTextPen(){return this.text!==""}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}}class Ic{constructor({penPool:a}){this.pens=[];this.lines=[];this.pens=[],this.lines=[],this.penPool=a}destroy(){this.freePens()}freePens(){return this.penPool.pushMultiple(this.pens),this.lines.forEach(a=>{a.destroy()}),this.lines.length=0,this.totalLineHeight=0,this}addTextPen(a,b,c,d,e,f,g,k=wa.none){let i=this.penPool.pop();return i==null&&(i=new Sf()),i.set(a,b,c,d,e,f,g,k),this.addPen(i),this}addImagePen(a,b,c,d,e){return this.addTextPen(null,a,b,c,d,0,e,wa.none),this}addNewLinePen(){let a=this.lastPen;return a&&(a.newLineMode=wa.wrapped),this}addPen(a){let b=this.lastPen;b==null?a.startIndex=0:a.startIndex=b.endIndex,this.pens.push(a);let c=this.lastLine;return c==null&&(c=new Rf(),this.lines.push(c)),c.addPen(a),a.newLineMode!==wa.none&&(c=new Rf(),this.lines.push(c)),this}clone(a){return a==null&&(a=new Ic({penPool:this.penPool})),a.freePens(),this.pens.forEach(b=>{a.addPen(b.clone())}),a}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(a){if(a>=this.lines.length)return this.getLineEndIndex(a);{let b=this.lines[a];if(!b)return 0;let c=b.firstPen;return c?c.startIndex:0}}getLineEndIndex(a){let b=this.lines.length;a>=b&&(a=b-1);for(let c=a;c>=0;c--){let d=this.lines[c];if(d&&d.hasPen())return d.lastPen.endIndex}return 0}getLineWidth(a){let b=this.lines[a];return b?b.width:0}getLineHeights(a=[]){return this.lines.forEach(function(b){a.push(b.height)}),a}get lineCount(){return this.lines.length}get plainText(){let a=[],b=this.pens;for(let c=0,d=b.length;c<d;c++)a.push(b[c].plainText);return a.join()}get plainTextLength(){let a=0;for(let b=0,c=this.pens.length;b<c;b++)a+=this.pens[b].plainTextLength;return a}getSliceTagText(a,b,c=0,d,e=!1){if(d===void 0){let m=this.lastPen;if(!m)return"";d=m.endIndex}let f=[],g;for(var k=0,i=this.pens.length;k<i;k++){let m=this.pens[k],o=m.endIndex;if(o<=c)continue;let u=e?m.wrapText:m.plainText,A=m.prop,B=m.startIndex,E=B>=c&&o<=d;E||(u=u.substring(c-B,d-B)),b?f.push(a.call(b,u,A,g)):f.push(a(u,A,g)),g=A;if(o>=d)break}return f.join()}}function le(a,b){a.font=b.font}function me(a,b){a.textBaseline="alphabetic",a.textAlign="start",a.fillStyle=b.fillStyle,a.strokeStyle=b.strokeStyle,a.lineWidth=b.strokeThickness,a.lineCap="round",a.lineJoin="round",a.imageSmoothingEnabled=b.antialias}function Qf(a,b,c){c?(a.shadowOffsetX=b.shadowOffsetX,a.shadowOffsetY=b.shadowOffsetY,a.shadowColor=b.shadowColor,a.shadowBlur=b.shadowBlur):(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowColor="#000",a.shadowBlur=0)}function yk(a,b){return b.measureText(a).width}function zk(a,b,c=0){let d=b.measureText(a),e=d.actualBoundingBoxAscent,f=d.actualBoundingBoxDescent;return(!e&&!f||a==="")&&(e=c,f=0),ne.ascent=e,ne.descent=f,ne.height=Math.ceil(Math.abs(e)+Math.abs(f)),ne}let ne={ascent:0,descent:0,height:0};function tk(a,b,c,d,e){a.freePens();if(b==="")return a;let f=c.canvas,g=c.context,k=c.defatultStyle,i=c.parser.splitText(b),m,o,u=0;for(var A=0,B=i.length;A<B;A++){let N=c.parser.tagTextToProp(i[A],m),O=N.text;m=N.prop;if(m.img){let _,X;c.imageManager?(_=c.imageManager.getOuterWidth(m.img),X=c.imageManager.getOuterHeight(m.img)):(_=0,X=0),e>0&&d!==Ua.none&&(e<u+_&&(a.addNewLinePen(),u=0)),a.addImagePen(u,0,_,X,Jc(m)),u+=_}else if(O!==""){g.save();let _=c.parser.propToStyle(k,m);le(g,_),me(g,_);let X=_.strokeThickness,P=X/2;o=Ak(O,yk,g,d,e,u);let q=zk("|MÃq",g);for(let r=0,h=o.length;r<h;r++){let l=o[r],j=q.height+X,p=q.ascent+P;a.addTextPen(l.text,u,0,l.width,j,p,Jc(m),l.newLineMode),l.newLineMode!==wa.none?u=0:u+=l.width}g.restore()}}let E=c.defatultStyle.lineSpacing,G=0,I=0,L=0,R=0;return a.lines[0].pens.forEach(function(N){I=Math.max(I,N.ascent)}),a.lines.forEach(function(N){G=0,N.pens.forEach(function(O){O.y+=I,G=Math.max(G,O.height)}),N.y=I,N.height=G,I+=G+E,L=Math.max(L,N.width),R+=G+E}),a.maxLineWidth=L,a.totalLineHeight=R-E,a}const Xg={PI2:Math.PI*2,HALF_PI:Math.PI*.5,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};class Xm extends Ga{constructor(a,b,c,d,e){super(a,b,c,d);this.name=e}}class vk{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return this.hitAreas.length=0,this}add(a,b,c,d,e){let f=new Xm(b,c,d,e,a);return this.hitAreas.push(f),this}getFirstHitArea(a,b){for(let c=0,d=this.hitAreas.length;c<d;c++){let e=this.hitAreas[c];if(e.contains(a,b))return e}return null}}function uk(a,b=0,c=0,d=a.textWidth,e=a.textHeight,f=a.penManager){a.hitAreaManager&&a.hitAreaManager.clear();let g=f.totalLineHeight;if(g===0)return;let k=a.context;k.save();let i=a.defatultStyle;Tm(a,i.backgroundStyle),b+=a.startXOffset,c+=a.startYOffset;let m=i.halign,o=i.valign,u=c;switch(o){case Kb.center:u+=(e-g)/2;break;case Kb.bottom:u+=e-g-2;break}let A=f.lines;for(let B=0,E=A.length;B<E;B++){let G=A[B],I=G.width;if(I===0)continue;let L=b;switch(m){case Jb.center:L+=(d-I)/2;break;case Jb.right:L+=d-I;break}let R=G.pens;for(let N=0,O=R.length;N<O;N++)Sm(a,R[N],L,u)}k.restore()}function Sm(a,b,c,d){c+=b.x,d+=b.y;let e=a.canvas,f=a.context,g=a.defatultStyle;f.save();let k=a.parser.propToStyle(g,b.prop);le(f,k),me(f,k),k.underlineThickness>0&&b.width>0&&Um(a,c,d,b.width,k),b.isTextPen&&Vm(a,c,d,b.text,k),b.isImagePen&&Wm(a,c,d,b.prop.img,k),f.restore(),b.hasAreaMarker&&b.width>0&&(a.hitAreaManager||(a.hitAreaManager=new vk()),a.hitAreaManager.add(b.prop.area,c,d-a.startYOffset,b.width,b.height))}function Tm(a,b){let c=a.canvas,d=a.context;b==null?d.clearRect(0,0,c.width,c.height):(d.fillStyle=b,d.fillRect(0,0,c.width,c.height))}function Um(a,b,c,d,e){c+=e.underlineOffset-e.underlineThickness/2;let f=a.context,g=f.lineCap;f.lineCap="butt",f.beginPath(),f.strokeStyle=e.underlineStyle,f.lineWidth=e.underlineThickness,f.moveTo(b,c),f.lineTo(b+d,c),f.stroke(),f.lineCap=g}function Vm(a,b,c,d,e){let f=a.context;e.strokeThickness&&(Qf(f,e,e.shadowStroke),f.strokeText(d,b,c)),e.fillStyle&&e.fillStyle!=="none"&&(Qf(f,e,e.shadowFill),f.fillText(d,b,c))}function Wm(a,b,c,d,e){let f=a.imageManager;if(!f)return;let g=f.get(d),k=f.getFrame(d);b+=g.left,c+=-a.startYOffset+g.y;let i=a.context;i.drawImage(k.texture.image,k.x,k.y,k.width,k.height,b,c,g.width,g.height)}class rk{constructor({canvas:a,context:b,defatultStyle:c,parser:d,penPool:e=new Lb()}){this.canvas=a,this.context=b,this.parser=d,this.defatultStyle=c,this.penPool=e,this.penManager=new Ic({penPool:e})}destroy(){this.canvas=null,this.context=null,this.parser=null,this.defatultStyle=null,this.penManager&&(this.penManager.destroy(),this.penManager=null),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=null),this.imageManager&&(this.imageManager.destroy(),this.imageManager=null),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=null)}get textWidth(){return this.penManager.maxLineWidth}get textHeight(){return this.penManager.totalLineHeight}updatePenManager(a,b,c,d=this.penManager){return tk(d,a,this,b,c)}draw(a=0,b=0,c=this.textWidth,d=this.textHeight){return uk(this,a,b,c,d,this.penManager),this}get startXOffset(){let a=this.defatultStyle.strokeStyle,b=this.defatultStyle.strokeThickness;return a!=null&&b!=null?b/2:0}get startYOffset(){let a=this.defatultStyle.strokeStyle,b=this.defatultStyle.strokeThickness;return a!=null&&b!=null?b/2:0}get lines(){return this.penManager.lines}get tmpPenManager(){return this._tmpPenManager===null&&(this._tmpPenManager=new Ic({penPool:this.penPool})),this._tmpPenManager}getPlainText(a,b,c){let d;return a==null?d=this.penManager.plainText:d=this.parser.splitText(a,!0).join(""),(b!=null||c!=null)&&(b==null&&(b=0),c==null&&(c=d.length),d=d.substring(b,c)),d}getPenManager(a,b){return a===void 0?this.clonePenManager(b,this.penManager):(b===void 0&&(b=new Ic({penPool:this.penPool})),this.updatePenManager(a,this.defatultStyle.wrapMode,this.defatultStyle.wrapWidth,b),b)}getText(a,b,c,d){if(a==null)return this.penManager.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d);let e=this.tmpPenManager;return this.updatePenManager(a,this.defatultStyle.wrapMode,this.defatultStyle.wrapWidth,e),e.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d)}clonePenManager(a,b=this.penManager){return b.clone(a)}getLastPen(a=this.penManager){return a.lastPen}}class sk extends _c{constructor(a,b,c="",d,e,f){super(a,b,Sb());this.padding={left:0,right:0,top:0,bottom:0};this.antialias=!1;this.font="16px monospace";this.fillStyle="#fff";this.lineSpacing=0;this.halign=Jb.left;this.valign=Kb.top;this.wrapMode=Ua.word;this.wrapWidth=0;this.fixedWidth=0;this.fixedHeight=0;this.type="rexText";const g=va.get();this.resolution=g.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.canvasText=new rk({canvas:this.canvas,context:this.context,defatultStyle:this,parser:f}),d&&(this.font=d),e&&(this.fillStyle=e),this.setText(c)}destroy(a){this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}updateText(a){let b=this.canvasText;this.canvasText.updatePenManager(this._text,this.wrapMode,this.wrapWidth);let c=this.padding,d,e,f,g;this.fixedWidth===0?(d=b.textWidth,f=d+c.left+c.right):(f=this.fixedWidth,d=f-c.left-c.right,d<b.textWidth&&(d=b.textWidth)),this.fixedHeight===0?(e=b.textHeight,g=e+c.top+c.bottom):(g=this.fixedHeight,e=g-c.top-c.bottom,e<b.textHeight&&(e=b.textHeight));let k=this.resolution,i=Math.ceil(f*k),m=Math.ceil(g*k),o=this.canvas;(o.width!==i||o.height!==m)&&(o.width=i,o.height=m,this.texture.setSize(f,g),this.setSize(f,g));let u=this.context;return u.save(),u.scale(k,k),b.draw(c.left,c.top,d,e),u.restore(),this.texture.binding&&this.texture.binding.update(),this.setDirty(aa.TEXTURE),this}get text(){return this._text}set text(a){this.setText(a)}setText(a="",b=!0){return Array.isArray(a)&&(a=a.join(`
`)),a!==this._text&&(this._text=a.toString(),b&&this.updateText()),this}}class wk{}const xk={font:void 0,fontFamily:void 0,fontStyle:void 0,fontSize:void 0,fillStyle:void 0,strokeStyle:void 0,strokeThickness:void 0,shadowColor:void 0,shadowOffsetX:void 0,shadowOffsetY:void 0,shadowBlur:void 0,shadowStroke:void 0,shadowFill:void 0,underlineStyle:void 0,underlineThickness:void 0,underlineOffset:void 0,image:void 0};class Bk extends wk{splitText(a,b=!1){let c=[],d=0;for(;;){const f=Tf.exec(a);if(!f)break;const g=f[0],k=Tf.lastIndex-g.length;d<k&&c.push(a.substring(d,k)),b||c.push(g),d=Tf.lastIndex}let e=a.length;return d<e&&c.push(a.substring(d,e)),c}tagTextToProp(a,b){let c,d;b==null&&(b={}),b.img&&ua(b,cb,"img"),$m.test(a)?(ua(b,Va,"b",!0),c=""):an.test(a)?(ua(b,cb,"b"),c=""):bn.test(a)?(ua(b,Va,"i",!0),c=""):cn.test(a)?(ua(b,cb,"i"),c=""):Ck.test(a)?(d=a.match(Ck),ua(b,Va,"size",d[1]+"px"),c=""):dn.test(a)?(ua(b,cb,"size"),c=""):Dk.test(a)?(d=a.match(Dk),ua(b,Va,"color",d[1]),c=""):en.test(a)?(ua(b,cb,"color"),c=""):Ek.test(a)?(d=a.match(Ek),ua(b,Va,"u",!0),c=""):Fk.test(a)?(d=a.match(Fk),ua(b,Va,"u",d[1]),c=""):fn.test(a)?(ua(b,cb,"u"),c=""):gn.test(a)?(ua(b,Va,"shadow",!0),c=""):hn.test(a)?(ua(b,cb,"shadow"),c=""):jn.test(a)?(ua(b,Va,"stroke",!0),c=""):Gk.test(a)?(d=a.match(Gk),ua(b,Va,"stroke",d[1]),c=""):kn.test(a)?(ua(b,cb,"stroke"),c=""):Hk.test(a)?(d=a.match(Hk),ua(b,Va,"img",d[1]),c=""):ln.test(a)?(ua(b,cb,"img"),c=""):Ik.test(a)?(d=a.match(Ik),ua(b,Va,"area",d[1]),c=""):mn.test(a)?(ua(b,cb,"area"),c=""):c=a;let e=Zm;return e.text=c,e.prop=b,e}propToStyle(a,b){let c=xk;return b.hasOwnProperty("img")?c.image=b.img:(c.image=null,c.fontFamily=a.fontFamily,b.hasOwnProperty("size")?c.fontSize=b.size:c.fontSize=a.fontSize,c.fontStyle=Ym(b.b,b.i),c.font=a.font,b.hasOwnProperty("color")?c.fillStyle=b.color:c.fillStyle=a.fillStyle,b.hasOwnProperty("stroke")?b.stroke===!0?(c.strokeStyle=a.strokeStyle,c.strokeThickness=a.strokeThickness):(c.strokeStyle=b.stroke,c.strokeThickness=a.strokeThickness):(c.strokeStyle=a.strokeStyle,c.strokeThickness=0)),b.hasOwnProperty("shadow")?b.shadow===!0?(c.shadowColor=a.shadowColor,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor=b.shadow,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor="#000",c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=0,c.shadowStroke=!1,c.shadowFill=!1),b.hasOwnProperty("u")?b.u===!0?(c.underlineStyle=a.underlineStyle,c.underlineThickness=a.underlineThickness,c.underlineOffset=a.underlineOffset):(c.underlineStyle=b.u,c.underlineThickness=a.underlineThickness,c.underlineOffset=a.underlineOffset):(c.underlineStyle="#000",c.underlineThickness=0,c.underlineOffset=0),c}propToTagText(a,b,c){c==null&&(c=_m);let d=[];for(const f in c){if(b.hasOwnProperty(f))continue;d.push(`[/${f}]`)}a=`${d.join()}${a}`;let e=[];for(const f in b){if(c[f]===b[f])continue;switch(f){case"size":const g=b.size.replace("px","");e.push(`[size=${g}]`);break;case"color":case"img":case"area":e.push(`[${f}=${b[f]}]`);break;case"stroke":case"u":b[f]===!0?e.push(`[${f}]`):e.push(`[${f}=${b[f]}]`);break;default:e.push(`[${f}]`);break}}return a=`${a}${e.join()}`,a}}const ua=function(a,b,c,d){return b===Va?a[c]=d:a.hasOwnProperty(c)&&delete a[c],a};var Ym=function(a,b){return a&&b?"bold italic":a?"bold":b?"italic":""};const Zm={text:null,prop:null},_m={},Tf=/\[b\]|\[\/b\]|\[i\]|\[\/i\]|\[size=(\d+)\]|\[\/size\]|\[color=([a-z]+|#[0-9abcdef]+)\]|\[\/color\]|\[u\]|\[u=([a-z]+|#[0-9abcdef]+)\]|\[\/u\]|\[shadow\]|\[\/shadow\]|\[stroke\]|\[stroke=([a-z]+|#[0-9abcdef]+)\]|\[\/stroke\]|\[img=([^\]]+)\]|\[\/img\]|\[area=([^\]]+)\]|\[\/area\]/ig;var $m=/\[b\]/i,an=/\[\/b\]/i,bn=/\[i\]/i,cn=/\[\/i\]/i,Ck=/\[size=(\d+)\]/i,dn=/\[\/size\]/i,Dk=/\[color=([a-z]+|#[0-9abcdef]+)\]/i,en=/\[\/color\]/i,Ek=/\[u\]/i,Fk=/\[u=([a-z]+|#[0-9abcdef]+)\]/i,fn=/\[\/u\]/i,gn=/\[shadow\]/i,hn=/\[\/shadow\]/i,jn=/\[stroke\]/i,Gk=/\[stroke=([a-z]+|#[0-9abcdef]+)\]/i,kn=/\[\/stroke\]/i,Hk=/\[img=([^\]]+)\]/i,ln=/\[\/img\]/i,Ik=/\[area=([^\]]+)\]/i,mn=/\[\/area\]/i;const cb=!1,Va=!0;class Oc extends sk{constructor(a,b,c="",d,e){super(a,b,c,d,e,new Bk());this.type="rexBBcodeText"}}var uf;(function(a){a[a.ascending=0]="ascending",a[a.descending=1]="descending",a[a.logical_ascending=2]="logical_ascending",a[a.logical_descending=3]="logical_descending"})(uf||(uf={}));class Yk extends ig{constructor(){super();const a=new xe(this),b=new Oc(400,300);hc(a,b),b.backgroundStyle="aliceblue",b.padding={left:10,right:10,top:10,bottom:10},b.font="40px monospace",b.text="[color=red]A[color=blue]B[color=green]C[/color]",hc(a,b)}}new hg(we(),ve(800,600),te("game"),se(2960685),ue(Yk));})();
/* @license
Papa Parse
v5.2.0
https://github.com/mholt/PapaParse
License: MIT
*/
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
//# sourceMappingURL=bundle.js.map

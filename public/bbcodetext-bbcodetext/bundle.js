(()=>{var te=Object.defineProperty,il=Object.prototype.hasOwnProperty,db=(a,b)=>()=>(b||(b={exports:{}},a(b.exports,b)),b.exports),jl=a=>te(a,"__esModule",{value:!0}),Ob=(a,b)=>{jl(a);for(var c in b)te(a,c,{get:b[c],enumerable:!0})},Qn=(a,b)=>{jl(a);if(typeof b==="object"||typeof b==="function")for(let c in b)il.call(b,c)&&!il.call(a,c)&&c!=="default"&&te(a,c,{get:()=>b[c],enumerable:!0});return a},Ia=a=>a&&a.__esModule?a:Qn(te({},"default",{value:a,enumerable:!0}),a);var Ah=db((a,b)=>{!function(c,d){"function"==typeof define&&define.amd?define([],d):"object"==typeof b&&"undefined"!=typeof a?b.exports=d():c.Papa=d()}(a,function c(){"use strict";var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==d?d:{},e=!d.document&&!!d.postMessage,f=e&&/blob:/i.test((d.location||{}).protocol),g={},j=0,i={parse:function(q,r){var h=(r=r||{}).dynamicTyping||!1;P(h)&&(r.dynamicTypingFunction=h,h={});if(r.dynamicTyping=h,r.transform=!!P(r.transform)&&r.transform,r.worker&&i.WORKERS_SUPPORTED){var l=function(){if(!i.WORKERS_SUPPORTED)return!1;var p=(o=d.URL||d.webkitURL||null,E=c.toString(),i.BLOB_URL||(i.BLOB_URL=o.createObjectURL(new Blob(["(",E,")();"],{type:"text/javascript"})))),t=new d.Worker(p),o,E;return t.onmessage=R,t.id=j++,g[t.id]=t}();return l.userStep=r.step,l.userChunk=r.chunk,l.userComplete=r.complete,l.userError=r.error,r.step=P(r.step),r.chunk=P(r.chunk),r.complete=P(r.complete),r.error=P(r.error),delete r.worker,void l.postMessage({input:q,config:r,workerId:l.id})}var k=null;return i.NODE_STREAM_INPUT,"string"==typeof q?k=r.download?new u(r):new B(r):!0===q.readable&&P(q.read)&&P(q.on)?k=new C(r):(d.File&&q instanceof File||q instanceof Object)&&(k=new w(r)),k.stream(q)},unparse:function(q,r){var h=!1,l=!0,k=",",p=`\r
`,t='"',o=t+t,E=!1,F=null;!function(){if("object"!=typeof r)return;"string"!=typeof r.delimiter||i.BAD_DELIMITERS.filter(function(A){return-1!==r.delimiter.indexOf(A)}).length||(k=r.delimiter),("boolean"==typeof r.quotes||"function"==typeof r.quotes||Array.isArray(r.quotes))&&(h=r.quotes),"boolean"!=typeof r.skipEmptyLines&&"string"!=typeof r.skipEmptyLines||(E=r.skipEmptyLines),"string"==typeof r.newline&&(p=r.newline),"string"==typeof r.quoteChar&&(t=r.quoteChar),"boolean"==typeof r.header&&(l=r.header);if(Array.isArray(r.columns)){if(0===r.columns.length)throw new Error("Option columns is empty");F=r.columns}void 0!==r.escapeChar&&(o=r.escapeChar+t)}();var V=new RegExp(I(t),"g");"string"==typeof q&&(q=JSON.parse(q));if(Array.isArray(q)){if(!q.length||Array.isArray(q[0]))return W(null,q,E);if("object"==typeof q[0])return W(F||z(q[0]),q,E)}else if("object"==typeof q)return"string"==typeof q.data&&(q.data=JSON.parse(q.data)),Array.isArray(q.data)&&(q.fields||(q.fields=q.meta&&q.meta.fields),q.fields||(q.fields=Array.isArray(q.data[0])?q.fields:z(q.data[0])),Array.isArray(q.data[0])||"object"==typeof q.data[0]||(q.data=[q.data])),W(q.fields||[],q.data||[],E);throw new Error("Unable to serialize unrecognized input");function z(A){if("object"!=typeof A)return[];var H=[];for(var Y in A)H.push(Y);return H}function W(A,H,Y){var ia="";"string"==typeof A&&(A=JSON.parse(A)),"string"==typeof H&&(H=JSON.parse(H));var na=Array.isArray(A)&&0<A.length,pa=!Array.isArray(H[0]);if(na&&l){for(var ma=0;ma<A.length;ma++)0<ma&&(ia+=k),ia+=J(A[ma],ma);0<H.length&&(ia+=p)}for(var T=0;T<H.length;T++){var ea=na?A.length:H[T].length,ja=!1,ka=na?0===Object.keys(H[T]).length:0===H[T].length;if(Y&&!na&&(ja="greedy"===Y?""===H[T].join("").trim():1===H[T].length&&0===H[T][0].length),"greedy"===Y&&na){for(var Q=[],S=0;S<ea;S++){var ga=pa?A[S]:S;Q.push(H[T][ga])}ja=""===Q.join("").trim()}if(!ja){for(var K=0;K<ea;K++){0<K&&!ka&&(ia+=k);var fa=na&&pa?A[K]:K;ia+=J(H[T][fa],K)}T<H.length-1&&(!Y||0<ea&&!ka)&&(ia+=p)}}return ia}function J(A,H){if(null==A)return"";if(A.constructor===Date)return JSON.stringify(A).slice(1,25);var Y=A.toString().replace(V,o),ia="boolean"==typeof h&&h||"function"==typeof h&&h(A,H)||Array.isArray(h)&&h[H]||function(na,pa){for(var ma=0;ma<pa.length;ma++)if(-1<na.indexOf(pa[ma]))return!0;return!1}(Y,i.BAD_DELIMITERS)||-1<Y.indexOf(k)||" "===Y.charAt(0)||" "===Y.charAt(Y.length-1);return ia?t+Y+t:Y}}};if(i.RECORD_SEP=String.fromCharCode(30),i.UNIT_SEP=String.fromCharCode(31),i.BYTE_ORDER_MARK="ï»¿",i.BAD_DELIMITERS=["\r",`
`,'"',i.BYTE_ORDER_MARK],i.WORKERS_SUPPORTED=!e&&!!d.Worker,i.NODE_STREAM_INPUT=1,i.LocalChunkSize=10485760,i.RemoteChunkSize=5242880,i.DefaultDelimiter=",",i.Parser=L,i.ParserHandle=G,i.NetworkStreamer=u,i.FileStreamer=w,i.StringStreamer=B,i.ReadableStreamStreamer=C,d.jQuery){var m=d.jQuery;m.fn.parse=function(q){var r=q.config||{},h=[];return this.each(function(p){if(!("INPUT"===m(this).prop("tagName").toUpperCase()&&"file"===m(this).attr("type").toLowerCase()&&d.FileReader)||!this.files||0===this.files.length)return!0;for(var t=0;t<this.files.length;t++)h.push({file:this.files[t],inputElem:this,instanceConfig:m.extend({},r)})}),l(),this;function l(){if(0!==h.length){var p,t,o,E,F=h[0];if(P(q.before)){var V=q.before(F.file,F.inputElem);if("object"==typeof V){if("abort"===V.action)return p="AbortError",t=F.file,o=F.inputElem,E=V.reason,void(P(q.error)&&q.error({name:p},t,o,E));if("skip"===V.action)return void k();"object"==typeof V.config&&(F.instanceConfig=m.extend(F.instanceConfig,V.config))}else if("skip"===V)return void k()}var z=F.instanceConfig.complete;F.instanceConfig.complete=function(W){P(z)&&z(W,F.file,F.inputElem),k()},i.parse(F.file,F.instanceConfig)}else P(q.complete)&&q.complete()}function k(){h.splice(0,1),l()}}}function n(q){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(r){var h=_(r);h.chunkSize=parseInt(h.chunkSize),r.step||r.chunk||(h.chunkSize=null),this._handle=new G(h),(this._handle.streamer=this)._config=h}.call(this,q),this.parseChunk=function(r,h){if(this.isFirstChunk&&P(this._config.beforeFirstChunk)){var l=this._config.beforeFirstChunk(r);void 0!==l&&(r=l)}this.isFirstChunk=!1,this._halted=!1;var k=this._partialLine+r;this._partialLine="";var p=this._handle.parse(k,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var t=p.meta.cursor;this._finished||(this._partialLine=k.substring(t-this._baseIndex),this._baseIndex=t),p&&p.data&&(this._rowCount+=p.data.length);var o=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(f)d.postMessage({results:p,workerId:i.WORKER_ID,finished:o});else if(P(this._config.chunk)&&!h){if(this._config.chunk(p,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);p=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(p.data),this._completeResults.errors=this._completeResults.errors.concat(p.errors),this._completeResults.meta=p.meta),this._completed||!o||!P(this._config.complete)||p&&p.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),o||p&&p.meta.paused||this._nextChunk(),p}this._halted=!0},this._sendError=function(r){P(this._config.error)?this._config.error(r):f&&this._config.error&&d.postMessage({workerId:i.WORKER_ID,error:r,finished:!1})}}function u(q){var r;(q=q||{}).chunkSize||(q.chunkSize=i.RemoteChunkSize),n.call(this,q),this._nextChunk=e?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(h){this._input=h,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(r=new XMLHttpRequest(),this._config.withCredentials&&(r.withCredentials=this._config.withCredentials),e||(r.onload=X(this._chunkLoaded,this),r.onerror=X(this._chunkError,this)),r.open(this._config.downloadRequestBody?"POST":"GET",this._input,!e),this._config.downloadRequestHeaders){var h=this._config.downloadRequestHeaders;for(var l in h)r.setRequestHeader(l,h[l])}if(this._config.chunkSize){var k=this._start+this._config.chunkSize-1;r.setRequestHeader("Range","bytes="+this._start+"-"+k)}try{r.send(this._config.downloadRequestBody)}catch(p){this._chunkError(p.message)}e&&0===r.status&&this._chunkError()}},this._chunkLoaded=function(){4===r.readyState&&(r.status<200||400<=r.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:r.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(h){var l=h.getResponseHeader("Content-Range");return null===l?-1:parseInt(l.substring(l.lastIndexOf("/")+1))}(r),this.parseChunk(r.responseText)))},this._chunkError=function(h){var l=r.statusText||h;this._sendError(new Error(l))}}function w(q){var r,h;(q=q||{}).chunkSize||(q.chunkSize=i.LocalChunkSize),n.call(this,q);var l="undefined"!=typeof FileReader;this.stream=function(k){this._input=k,h=k.slice||k.webkitSlice||k.mozSlice,l?((r=new FileReader()).onload=X(this._chunkLoaded,this),r.onerror=X(this._chunkError,this)):r=new FileReaderSync(),this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var k=this._input;if(this._config.chunkSize){var p=Math.min(this._start+this._config.chunkSize,this._input.size);k=h.call(k,this._start,p)}var t=r.readAsText(k,this._config.encoding);l||this._chunkLoaded({target:{result:t}})},this._chunkLoaded=function(k){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(k.target.result)},this._chunkError=function(){this._sendError(r.error)}}function B(q){var r;n.call(this,q=q||{}),this.stream=function(h){return r=h,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var h,l=this._config.chunkSize;return l?(h=r.substring(0,l),r=r.substring(l)):(h=r,r=""),this._finished=!r,this.parseChunk(h)}}}function C(q){n.call(this,q=q||{});var r=[],h=!0,l=!1;this.pause=function(){n.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){n.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(k){this._input=k,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){l&&1===r.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),r.length?this.parseChunk(r.shift()):h=!0},this._streamData=X(function(k){try{r.push("string"==typeof k?k:k.toString(this._config.encoding)),h&&(h=!1,this._checkIsFinished(),this.parseChunk(r.shift()))}catch(p){this._streamError(p)}},this),this._streamError=X(function(k){this._streamCleanUp(),this._sendError(k)},this),this._streamEnd=X(function(){this._streamCleanUp(),l=!0,this._streamData("")},this),this._streamCleanUp=X(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function G(q){var r,h,l,k=Math.pow(2,53),p=-k,t=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)(e[-+]?\d+)?\s*$/,o=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,E=this,F=0,V=0,z=!1,W=!1,J=[],A={data:[],errors:[],meta:{}};if(P(q.step)){var H=q.step;q.step=function(T){if(A=T,na())ia();else{if(ia(),0===A.data.length)return;F+=T.data.length,q.preview&&F>q.preview?h.abort():(A.data=A.data[0],H(A,E))}}}function Y(T){return"greedy"===q.skipEmptyLines?""===T.join("").trim():1===T.length&&0===T[0].length}function ia(){if(A&&l&&(ma("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+i.DefaultDelimiter+"'"),l=!1),q.skipEmptyLines)for(var T=0;T<A.data.length;T++)Y(A.data[T])&&A.data.splice(T--,1);return na()&&function(){if(!A)return;function ea(ka){P(q.transformHeader)&&(ka=q.transformHeader(ka)),J.push(ka)}if(Array.isArray(A.data[0])){for(var ja=0;na()&&ja<A.data.length;ja++)A.data[ja].forEach(ea);A.data.splice(0,1)}else A.data.forEach(ea)}(),function(){if(!A||!q.header&&!q.dynamicTyping&&!q.transform)return A;function ea(ka,Q){var S,ga=q.header?{}:[];for(S=0;S<ka.length;S++){var K=S,fa=ka[S];q.header&&(K=S>=J.length?"__parsed_extra":J[S]),q.transform&&(fa=q.transform(fa,K)),fa=pa(K,fa),"__parsed_extra"===K?(ga[K]=ga[K]||[],ga[K].push(fa)):ga[K]=fa}return q.header&&(S>J.length?ma("FieldMismatch","TooManyFields","Too many fields: expected "+J.length+" fields but parsed "+S,V+Q):S<J.length&&ma("FieldMismatch","TooFewFields","Too few fields: expected "+J.length+" fields but parsed "+S,V+Q)),ga}var ja=1;return!A.data.length||Array.isArray(A.data[0])?(A.data=A.data.map(ea),ja=A.data.length):A.data=ea(A.data,0),q.header&&A.meta&&(A.meta.fields=J),V+=ja,A}()}function na(){return q.header&&0===J.length}function pa(T,ea){return ja=T,q.dynamicTypingFunction&&void 0===q.dynamicTyping[ja]&&(q.dynamicTyping[ja]=q.dynamicTypingFunction(ja)),!0===(q.dynamicTyping[ja]||q.dynamicTyping)?"true"===ea||"TRUE"===ea||"false"!==ea&&"FALSE"!==ea&&(function(ka){if(t.test(ka)){var Q=parseFloat(ka);if(p<Q&&Q<k)return!0}return!1}(ea)?parseFloat(ea):o.test(ea)?new Date(ea):""===ea?null:ea):ea;var ja}function ma(T,ea,ja,ka){var Q={type:T,code:ea,message:ja};void 0!==ka&&(Q.row=ka),A.errors.push(Q)}this.parse=function(T,ea,ja){var ka=q.quoteChar||'"';if(q.newline||(q.newline=function(ga,K){ga=ga.substring(0,1048576);var fa=new RegExp(I(K)+"([^]*?)"+I(K),"gm"),M=(ga=ga.replace(fa,"")).split("\r"),ta=ga.split(`
`),v=1<ta.length&&ta[0].length<M[0].length;if(1===M.length||v)return`
`;for(var s=0,y=0;y<M.length;y++)`
`===M[y][0]&&s++;return s>=M.length/2?`\r
`:"\r"}(T,ka)),l=!1,q.delimiter)P(q.delimiter)&&(q.delimiter=q.delimiter(T),A.meta.delimiter=q.delimiter);else{var Q=function(ga,K,fa,M,ta){var v,s,y,D;ta=ta||[",","	","|",";",i.RECORD_SEP,i.UNIT_SEP];for(var x=0;x<ta.length;x++){var U=ta[x],$=0,Z=0,ha=0;y=void 0;for(var da=new L({comments:M,delimiter:U,newline:K,preview:10}).parse(ga),sa=0;sa<da.data.length;sa++)if(fa&&Y(da.data[sa]))ha++;else{var la=da.data[sa].length;Z+=la,void 0!==y?0<la&&($+=Math.abs(la-y),y=la):y=la}0<da.data.length&&(Z/=da.data.length-ha),(void 0===s||$<=s)&&(void 0===D||D<Z)&&1.99<Z&&(s=$,v=U,D=Z)}return{successful:!!(q.delimiter=v),bestDelimiter:v}}(T,q.newline,q.skipEmptyLines,q.comments,q.delimitersToGuess);Q.successful?q.delimiter=Q.bestDelimiter:(l=!0,q.delimiter=i.DefaultDelimiter),A.meta.delimiter=q.delimiter}var S=_(q);return q.preview&&q.header&&S.preview++,r=T,h=new L(S),A=h.parse(r,ea,ja),ia(),z?{meta:{paused:!0}}:A||{meta:{paused:!1}}},this.paused=function(){return z},this.pause=function(){z=!0,h.abort(),r=P(q.chunk)?"":r.substring(h.getCharIndex())},this.resume=function(){E.streamer._halted?(z=!1,E.streamer.parseChunk(r,!0)):setTimeout(E.resume,3)},this.aborted=function(){return W},this.abort=function(){W=!0,h.abort(),A.meta.aborted=!0,P(q.complete)&&q.complete(A),r=""}}function I(q){return q.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function L(q){var r,h=(q=q||{}).delimiter,l=q.newline,k=q.comments,p=q.step,t=q.preview,o=q.fastMode,E=r=void 0===q.quoteChar?'"':q.quoteChar;if(void 0!==q.escapeChar&&(E=q.escapeChar),("string"!=typeof h||-1<i.BAD_DELIMITERS.indexOf(h))&&(h=","),k===h)throw new Error("Comment character same as delimiter");!0===k?k="#":("string"!=typeof k||-1<i.BAD_DELIMITERS.indexOf(k))&&(k=!1),`
`!==l&&"\r"!==l&&`\r
`!==l&&(l=`
`);var F=0,V=!1;this.parse=function(z,W,J){if("string"!=typeof z)throw new Error("Input must be a string");var A=z.length,H=h.length,Y=l.length,ia=k.length,na=P(p),pa=[],ma=[],T=[],ea=F=0;if(!z)return x();if(o||!1!==o&&-1===z.indexOf(r)){for(var ja=z.split(l),ka=0;ka<ja.length;ka++){if(T=ja[ka],F+=T.length,ka!==ja.length-1)F+=l.length;else if(J)return x();if(!k||T.substring(0,ia)!==k){if(na){if(pa=[],v(T.split(h)),U(),V)return x()}else v(T.split(h));if(t&&t<=ka)return pa=pa.slice(0,t),x(!0)}}return x()}for(var Q=z.indexOf(h,F),S=z.indexOf(l,F),ga=new RegExp(I(E)+I(r),"g"),K=z.indexOf(r,F);;)if(z[F]!==r)if(k&&0===T.length&&z.substring(F,F+ia)===k){if(-1===S)return x();F=S+Y,S=z.indexOf(l,F),Q=z.indexOf(h,F)}else{if(-1!==Q&&(Q<S||-1===S)){if(!(Q<K)){T.push(z.substring(F,Q)),F=Q+H,Q=z.indexOf(h,F);continue}var fa=$(Q,K,S);if(fa&&void 0!==fa.nextDelim){Q=fa.nextDelim,K=fa.quoteSearch,T.push(z.substring(F,Q)),F=Q+H,Q=z.indexOf(h,F);continue}}if(-1===S)break;if(T.push(z.substring(F,S)),D(S+Y),na&&(U(),V))return x();if(t&&pa.length>=t)return x(!0)}else for(K=F,F++;;){if(-1===(K=z.indexOf(r,K+1)))return J||ma.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:pa.length,index:F}),y();if(K===A-1)return y(z.substring(F,K).replace(ga,r));if(r!==E||z[K+1]!==E){if(r===E||0===K||z[K-1]!==E){-1!==Q&&Q<K+1&&(Q=z.indexOf(h,K+1)),-1!==S&&S<K+1&&(S=z.indexOf(l,K+1));var M=s(-1===S?Q:Math.min(Q,S));if(z[K+1+M]===h){T.push(z.substring(F,K).replace(ga,r)),z[F=K+1+M+H]!==r&&(K=z.indexOf(r,F)),Q=z.indexOf(h,F),S=z.indexOf(l,F);break}var ta=s(S);if(z.substring(K+1+ta,K+1+ta+Y)===l){if(T.push(z.substring(F,K).replace(ga,r)),D(K+1+ta+Y),Q=z.indexOf(h,F),K=z.indexOf(r,F),na&&(U(),V))return x();if(t&&pa.length>=t)return x(!0);break}ma.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:pa.length,index:F}),K++}}else K++}return y();function v(Z){pa.push(Z),ea=F}function s(Z){var ha=0;if(-1!==Z){var da=z.substring(K+1,Z);da&&""===da.trim()&&(ha=da.length)}return ha}function y(Z){return J||(void 0===Z&&(Z=z.substring(F)),T.push(Z),F=A,v(T),na&&U()),x()}function D(Z){F=Z,v(T),T=[],S=z.indexOf(l,F)}function x(Z){return{data:pa,errors:ma,meta:{delimiter:h,linebreak:l,aborted:V,truncated:!!Z,cursor:ea+(W||0)}}}function U(){p(x()),pa=[],ma=[]}function $(Z,ha,da){var sa={nextDelim:void 0,quoteSearch:void 0},la=z.indexOf(r,ha+1);if(ha<Z&&Z<la&&(la<da||-1===da)){var xa=z.indexOf(h,la);if(-1===xa)return sa;la<xa&&(la=z.indexOf(r,la+1)),sa=$(xa,la,da)}else sa={nextDelim:Z,quoteSearch:ha};return sa}},this.abort=function(){V=!0},this.getCharIndex=function(){return F}}function R(q){var r=q.data,h=g[r.workerId],l=!1;if(r.error)h.userError(r.error,r.file);else if(r.results&&r.results.data){var k={abort:function(){l=!0,N(r.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:O,resume:O};if(P(h.userStep)){for(var p=0;p<r.results.data.length&&(h.userStep({data:r.results.data[p],errors:r.results.errors,meta:r.results.meta},k),!l);p++);delete r.results}else P(h.userChunk)&&(h.userChunk(r.results,k,r.file),delete r.results)}r.finished&&!l&&N(r.workerId,r.results)}function N(q,r){var h=g[q];P(h.userComplete)&&h.userComplete(r),h.terminate(),delete g[q]}function O(){throw new Error("Not implemented.")}function _(q){if("object"!=typeof q||null===q)return q;var r=Array.isArray(q)?[]:{};for(var h in q)r[h]=_(q[h]);return r}function X(q,r){return function(){q.apply(r,arguments)}}function P(q){return"function"==typeof q}return f&&(d.onmessage=function(q){var r=q.data;void 0===i.WORKER_ID&&r&&(i.WORKER_ID=r.workerId);if("string"==typeof r.input)d.postMessage({workerId:i.WORKER_ID,results:i.parse(r.input,r.config),finished:!0});else if(d.File&&r.input instanceof File||r.input instanceof Object){var h=i.parse(r.input,r.config);h&&d.postMessage({workerId:i.WORKER_ID,results:h,finished:!0})}}),(u.prototype=Object.create(n.prototype)).constructor=u,(w.prototype=Object.create(n.prototype)).constructor=w,(B.prototype=Object.create(B.prototype)).constructor=B,(C.prototype=Object.create(n.prototype)).constructor=C,i})});var pg=db(q=>{Ob(q,{__assign:()=>c,__asyncDelegator:()=>L,__asyncGenerator:()=>I,__asyncValues:()=>R,__await:()=>G,__awaiter:()=>j,__classPrivateFieldGet:()=>X,__classPrivateFieldSet:()=>P,__createBinding:()=>m,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>_,__importStar:()=>O,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>w,__rest:()=>d,__spread:()=>B,__spreadArrays:()=>C,__values:()=>u});var a=function(h,l){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,p){k.__proto__=p}||function(k,p){for(var t in p)p.hasOwnProperty(t)&&(k[t]=p[t])},a(h,l)};function b(h,l){a(h,l);function k(){this.constructor=h}h.prototype=l===null?Object.create(l):(k.prototype=l.prototype,new k())}var c=function(){return c=Object.assign||function h(l){for(var k,p=1,t=arguments.length;p<t;p++){k=arguments[p];for(var o in k)Object.prototype.hasOwnProperty.call(k,o)&&(l[o]=k[o])}return l},c.apply(this,arguments)};function d(h,l){var k={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&l.indexOf(p)<0&&(k[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var t=0,p=Object.getOwnPropertySymbols(h);t<p.length;t++)l.indexOf(p[t])<0&&Object.prototype.propertyIsEnumerable.call(h,p[t])&&(k[p[t]]=h[p[t]]);return k}function e(h,l,k,p){var t=arguments.length,o=t<3?l:p===null?p=Object.getOwnPropertyDescriptor(l,k):p,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(h,l,k,p);else for(var F=h.length-1;F>=0;F--)(E=h[F])&&(o=(t<3?E(o):t>3?E(l,k,o):E(l,k))||o);return t>3&&o&&Object.defineProperty(l,k,o),o}function f(h,l){return function(k,p){l(k,p,h)}}function g(h,l){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,l)}function j(h,l,k,p){function t(o){return o instanceof k?o:new k(function(E){E(o)})}return new(k||(k=Promise))(function(o,E){function F(W){try{z(p.next(W))}catch(J){E(J)}}function V(W){try{z(p.throw(W))}catch(J){E(J)}}function z(W){W.done?o(W.value):t(W.value).then(F,V)}z((p=p.apply(h,l||[])).next())})}function i(h,l){var k={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},p,t,o,E;return E={next:F(0),throw:F(1),return:F(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function F(z){return function(W){return V([z,W])}}function V(z){if(p)throw new TypeError("Generator is already executing.");for(;k;)try{if(p=1,t&&(o=z[0]&2?t.return:z[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,z[1])).done)return o;(t=0,o)&&(z=[z[0]&2,o.value]);switch(z[0]){case 0:case 1:o=z;break;case 4:return k.label++,{value:z[1],done:!1};case 5:k.label++,t=z[1],z=[0];continue;case 7:z=k.ops.pop(),k.trys.pop();continue;default:if(!(o=k.trys,o=o.length>0&&o[o.length-1])&&(z[0]===6||z[0]===2)){k=0;continue}if(z[0]===3&&(!o||z[1]>o[0]&&z[1]<o[3])){k.label=z[1];break}if(z[0]===6&&k.label<o[1]){k.label=o[1],o=z;break}if(o&&k.label<o[2]){k.label=o[2],k.ops.push(z);break}o[2]&&k.ops.pop(),k.trys.pop();continue}z=l.call(h,k)}catch(W){z=[6,W],t=0}finally{p=o=0}if(z[0]&5)throw z[1];return{value:z[0]?z[1]:void 0,done:!0}}}function m(h,l,k,p){p===void 0&&(p=k),h[p]=l[k]}function n(h,l){for(var k in h)k!=="default"&&!l.hasOwnProperty(k)&&(l[k]=h[k])}function u(h){var l=typeof Symbol==="function"&&Symbol.iterator,k=l&&h[l],p=0;if(k)return k.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")}function w(h,l){var k=typeof Symbol==="function"&&h[Symbol.iterator];if(!k)return h;var p=k.call(h),t,o=[],E;try{for(;(l===void 0||l-- >0)&&!(t=p.next()).done;)o.push(t.value)}catch(F){E={error:F}}finally{try{t&&!t.done&&(k=p.return)&&k.call(p)}finally{if(E)throw E.error}}return o}function B(){for(var h=[],l=0;l<arguments.length;l++)h=h.concat(w(arguments[l]));return h}function C(){for(var h=0,l=0,k=arguments.length;l<k;l++)h+=arguments[l].length;for(var p=Array(h),t=0,l=0;l<k;l++)for(var o=arguments[l],E=0,F=o.length;E<F;E++,t++)p[t]=o[E];return p}function G(h){return this instanceof G?(this.v=h,this):new G(h)}function I(h,l,k){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=k.apply(h,l||[]),t,o=[];return t={},E("next"),E("throw"),E("return"),t[Symbol.asyncIterator]=function(){return this},t;function E(A){p[A]&&(t[A]=function(H){return new Promise(function(Y,ia){o.push([A,H,Y,ia])>1||F(A,H)})})}function F(A,H){try{V(p[A](H))}catch(Y){J(o[0][3],Y)}}function V(A){A.value instanceof G?Promise.resolve(A.value.v).then(z,W):J(o[0][2],A)}function z(A){F("next",A)}function W(A){F("throw",A)}function J(A,H){(A(H),o.shift(),o.length)&&F(o[0][0],o[0][1])}}function L(h){var l,k;return l={},p("next"),p("throw",function(t){throw t}),p("return"),l[Symbol.iterator]=function(){return this},l;function p(t,o){l[t]=h[t]?function(E){return(k=!k)?{value:G(h[t](E)),done:t==="return"}:o?o(E):E}:o}}function R(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l=h[Symbol.asyncIterator],k;return l?l.call(h):(h=typeof u==="function"?u(h):h[Symbol.iterator](),k={},p("next"),p("throw"),p("return"),k[Symbol.asyncIterator]=function(){return this},k);function p(o){k[o]=h[o]&&function(E){return new Promise(function(F,V){E=h[o](E),t(F,V,E.done,E.value)})}}function t(o,E,F,V){Promise.resolve(V).then(function(z){o({value:z,done:F})},E)}}function N(h,l){return Object.defineProperty?Object.defineProperty(h,"raw",{value:l}):h.raw=l,h}function O(h){if(h&&h.__esModule)return h;var l={};if(h!=null)for(var k in h)Object.hasOwnProperty.call(h,k)&&(l[k]=h[k]);return l.default=h,l}function _(h){return h&&h.__esModule?h:{default:h}}function X(h,l){if(!l.has(h))throw new TypeError("attempted to get private field on non-instance");return l.get(h)}function P(h,l,k){if(!l.has(h))throw new TypeError("attempted to set private field on non-instance");return l.set(h,k),k}});var tg=db(q=>{Ob(q,{__assign:()=>c,__asyncDelegator:()=>L,__asyncGenerator:()=>I,__asyncValues:()=>R,__await:()=>G,__awaiter:()=>j,__classPrivateFieldGet:()=>X,__classPrivateFieldSet:()=>P,__createBinding:()=>m,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>_,__importStar:()=>O,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>w,__rest:()=>d,__spread:()=>B,__spreadArrays:()=>C,__values:()=>u});var a=function(h,l){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,p){k.__proto__=p}||function(k,p){for(var t in p)p.hasOwnProperty(t)&&(k[t]=p[t])},a(h,l)};function b(h,l){a(h,l);function k(){this.constructor=h}h.prototype=l===null?Object.create(l):(k.prototype=l.prototype,new k())}var c=function(){return c=Object.assign||function h(l){for(var k,p=1,t=arguments.length;p<t;p++){k=arguments[p];for(var o in k)Object.prototype.hasOwnProperty.call(k,o)&&(l[o]=k[o])}return l},c.apply(this,arguments)};function d(h,l){var k={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&l.indexOf(p)<0&&(k[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var t=0,p=Object.getOwnPropertySymbols(h);t<p.length;t++)l.indexOf(p[t])<0&&Object.prototype.propertyIsEnumerable.call(h,p[t])&&(k[p[t]]=h[p[t]]);return k}function e(h,l,k,p){var t=arguments.length,o=t<3?l:p===null?p=Object.getOwnPropertyDescriptor(l,k):p,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(h,l,k,p);else for(var F=h.length-1;F>=0;F--)(E=h[F])&&(o=(t<3?E(o):t>3?E(l,k,o):E(l,k))||o);return t>3&&o&&Object.defineProperty(l,k,o),o}function f(h,l){return function(k,p){l(k,p,h)}}function g(h,l){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,l)}function j(h,l,k,p){function t(o){return o instanceof k?o:new k(function(E){E(o)})}return new(k||(k=Promise))(function(o,E){function F(W){try{z(p.next(W))}catch(J){E(J)}}function V(W){try{z(p.throw(W))}catch(J){E(J)}}function z(W){W.done?o(W.value):t(W.value).then(F,V)}z((p=p.apply(h,l||[])).next())})}function i(h,l){var k={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},p,t,o,E;return E={next:F(0),throw:F(1),return:F(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function F(z){return function(W){return V([z,W])}}function V(z){if(p)throw new TypeError("Generator is already executing.");for(;k;)try{if(p=1,t&&(o=z[0]&2?t.return:z[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,z[1])).done)return o;(t=0,o)&&(z=[z[0]&2,o.value]);switch(z[0]){case 0:case 1:o=z;break;case 4:return k.label++,{value:z[1],done:!1};case 5:k.label++,t=z[1],z=[0];continue;case 7:z=k.ops.pop(),k.trys.pop();continue;default:if(!(o=k.trys,o=o.length>0&&o[o.length-1])&&(z[0]===6||z[0]===2)){k=0;continue}if(z[0]===3&&(!o||z[1]>o[0]&&z[1]<o[3])){k.label=z[1];break}if(z[0]===6&&k.label<o[1]){k.label=o[1],o=z;break}if(o&&k.label<o[2]){k.label=o[2],k.ops.push(z);break}o[2]&&k.ops.pop(),k.trys.pop();continue}z=l.call(h,k)}catch(W){z=[6,W],t=0}finally{p=o=0}if(z[0]&5)throw z[1];return{value:z[0]?z[1]:void 0,done:!0}}}function m(h,l,k,p){p===void 0&&(p=k),h[p]=l[k]}function n(h,l){for(var k in h)k!=="default"&&!l.hasOwnProperty(k)&&(l[k]=h[k])}function u(h){var l=typeof Symbol==="function"&&Symbol.iterator,k=l&&h[l],p=0;if(k)return k.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")}function w(h,l){var k=typeof Symbol==="function"&&h[Symbol.iterator];if(!k)return h;var p=k.call(h),t,o=[],E;try{for(;(l===void 0||l-- >0)&&!(t=p.next()).done;)o.push(t.value)}catch(F){E={error:F}}finally{try{t&&!t.done&&(k=p.return)&&k.call(p)}finally{if(E)throw E.error}}return o}function B(){for(var h=[],l=0;l<arguments.length;l++)h=h.concat(w(arguments[l]));return h}function C(){for(var h=0,l=0,k=arguments.length;l<k;l++)h+=arguments[l].length;for(var p=Array(h),t=0,l=0;l<k;l++)for(var o=arguments[l],E=0,F=o.length;E<F;E++,t++)p[t]=o[E];return p}function G(h){return this instanceof G?(this.v=h,this):new G(h)}function I(h,l,k){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=k.apply(h,l||[]),t,o=[];return t={},E("next"),E("throw"),E("return"),t[Symbol.asyncIterator]=function(){return this},t;function E(A){p[A]&&(t[A]=function(H){return new Promise(function(Y,ia){o.push([A,H,Y,ia])>1||F(A,H)})})}function F(A,H){try{V(p[A](H))}catch(Y){J(o[0][3],Y)}}function V(A){A.value instanceof G?Promise.resolve(A.value.v).then(z,W):J(o[0][2],A)}function z(A){F("next",A)}function W(A){F("throw",A)}function J(A,H){(A(H),o.shift(),o.length)&&F(o[0][0],o[0][1])}}function L(h){var l,k;return l={},p("next"),p("throw",function(t){throw t}),p("return"),l[Symbol.iterator]=function(){return this},l;function p(t,o){l[t]=h[t]?function(E){return(k=!k)?{value:G(h[t](E)),done:t==="return"}:o?o(E):E}:o}}function R(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l=h[Symbol.asyncIterator],k;return l?l.call(h):(h=typeof u==="function"?u(h):h[Symbol.iterator](),k={},p("next"),p("throw"),p("return"),k[Symbol.asyncIterator]=function(){return this},k);function p(o){k[o]=h[o]&&function(E){return new Promise(function(F,V){E=h[o](E),t(F,V,E.done,E.value)})}}function t(o,E,F,V){Promise.resolve(V).then(function(z){o({value:z,done:F})},E)}}function N(h,l){return Object.defineProperty?Object.defineProperty(h,"raw",{value:l}):h.raw=l,h}function O(h){if(h&&h.__esModule)return h;var l={};if(h!=null)for(var k in h)Object.hasOwnProperty.call(h,k)&&(l[k]=h[k]);return l.default=h,l}function _(h){return h&&h.__esModule?h:{default:h}}function X(h,l){if(!l.has(h))throw new TypeError("attempted to get private field on non-instance");return l.get(h)}function P(h,l,k){if(!l.has(h))throw new TypeError("attempted to set private field on non-instance");return l.set(h,k),k}});var Be=db(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});var a=tg();var b={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};var c=function(v,s){if(!v)throw d(s)},d=function(v){return new Error("Firebase Database ("+b.SDK_VERSION+") INTERNAL ASSERT FAILED: "+v)};var e=function(v){for(var s=[],y=0,D=0;D<v.length;D++){var x=v.charCodeAt(D);x<128?s[y++]=x:x<2048?(s[y++]=x>>6|192,s[y++]=x&63|128):(x&64512)===55296&&D+1<v.length&&(v.charCodeAt(D+1)&64512)===56320?(x=65536+((x&1023)<<10)+(v.charCodeAt(++D)&1023),s[y++]=x>>18|240,s[y++]=x>>12&63|128,s[y++]=x>>6&63|128,s[y++]=x&63|128):(s[y++]=x>>12|224,s[y++]=x>>6&63|128,s[y++]=x&63|128)}return s},f=function(v){for(var s=[],y=0,D=0;y<v.length;){var x=v[y++];if(x<128)s[D++]=String.fromCharCode(x);else if(x>191&&x<224){var U=v[y++];s[D++]=String.fromCharCode((x&31)<<6|U&63)}else if(x>239&&x<365){var U=v[y++],$=v[y++],Z=v[y++],ha=((x&7)<<18|(U&63)<<12|($&63)<<6|Z&63)-65536;s[D++]=String.fromCharCode(55296+(ha>>10)),s[D++]=String.fromCharCode(56320+(ha&1023))}else{var U=v[y++],$=v[y++];s[D++]=String.fromCharCode((x&15)<<12|(U&63)<<6|$&63)}}return s.join("")},g={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob==="function",encodeByteArray:function(v,s){if(!Array.isArray(v))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var y=s?this.byteToCharMapWebSafe_:this.byteToCharMap_,D=[],x=0;x<v.length;x+=3){var U=v[x],$=x+1<v.length,Z=$?v[x+1]:0,ha=x+2<v.length,da=ha?v[x+2]:0,sa=U>>2,la=(U&3)<<4|Z>>4,xa=(Z&15)<<2|da>>6,ue=da&63;ha||(ue=64,$||(xa=64)),D.push(y[sa],y[la],y[xa],y[ue])}return D.join("")},encodeString:function(v,s){return this.HAS_NATIVE_SUPPORT&&!s?btoa(v):this.encodeByteArray(e(v),s)},decodeString:function(v,s){return this.HAS_NATIVE_SUPPORT&&!s?atob(v):f(this.decodeStringToByteArray(v,s))},decodeStringToByteArray:function(v,s){this.init_();for(var y=s?this.charToByteMapWebSafe_:this.charToByteMap_,D=[],x=0;x<v.length;){var U=y[v.charAt(x++)],$=x<v.length,Z=$?y[v.charAt(x)]:0;++x;var ha=x<v.length,da=ha?y[v.charAt(x)]:64;++x;var sa=x<v.length,la=sa?y[v.charAt(x)]:64;++x;if(U==null||Z==null||da==null||la==null)throw Error();var xa=U<<2|Z>>4;D.push(xa);if(da!==64){var ue=Z<<4&240|da>>2;D.push(ue);if(la!==64){var Rn=da<<6&192|la;D.push(Rn)}}}return D},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var v=0;v<this.ENCODED_VALS.length;v++)this.byteToCharMap_[v]=this.ENCODED_VALS.charAt(v),this.charToByteMap_[this.byteToCharMap_[v]]=v,this.byteToCharMapWebSafe_[v]=this.ENCODED_VALS_WEBSAFE.charAt(v),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[v]]=v,v>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(v)]=v,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(v)]=v)}}},j=function(v){var s=e(v);return g.encodeByteArray(s,!0)},i=function(v){try{return g.decodeString(v,!0)}catch(s){console.error("base64Decode failed: ",s)}return null};function m(v){return n(void 0,v)}function n(v,s){if(!(s instanceof Object))return s;switch(s.constructor){case Date:var y=s;return new Date(y.getTime());case Object:v===void 0&&(v={});break;case Array:v=[];break;default:return s}for(var D in s){if(!s.hasOwnProperty(D))continue;v[D]=n(v[D],s[D])}return v}var u=function(){function v(){var s=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(y,D){s.resolve=y,s.reject=D})}return v.prototype.wrapCallback=function(s){var y=this;return function(D,x){D?y.reject(D):y.resolve(x),typeof s==="function"&&(y.promise.catch(function(){}),s.length===1?s(D):s(D,x))}},v}();function w(){return typeof navigator!=="undefined"&&typeof navigator.userAgent==="string"?navigator.userAgent:""}function B(){return typeof window!=="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(w())}function C(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(v){return!1}}function G(){return typeof self==="object"&&self.self===self}function I(){var v=typeof chrome==="object"?chrome.runtime:typeof browser==="object"?browser.runtime:void 0;return typeof v==="object"&&v.id!==void 0}function L(){return typeof navigator==="object"&&navigator.product==="ReactNative"}function R(){return w().indexOf("Electron/")>=0}function N(){var v=w();return v.indexOf("MSIE ")>=0||v.indexOf("Trident/")>=0}function O(){return w().indexOf("MSAppHost/")>=0}function _(){return b.NODE_CLIENT===!0||b.NODE_ADMIN===!0}function X(){return!C()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}var P="FirebaseError",q=function(v){a.__extends(s,v);function s(y,D){var x=v.call(this,D)||this;return x.code=y,x.name=P,Object.setPrototypeOf(x,s.prototype),Error.captureStackTrace&&Error.captureStackTrace(x,r.prototype.create),x}return s}(Error),r=function(){function v(s,y,D){this.service=s,this.serviceName=y,this.errors=D}return v.prototype.create=function(s){for(var y=[],D=1;D<arguments.length;D++)y[D-1]=arguments[D];for(var x=y[0]||{},U=this.service+"/"+s,$=this.errors[s],Z=$?h($,x):"Error",ha=this.serviceName+": "+Z+" ("+U+").",da=new q(U,ha),sa=0,la=Object.keys(x);sa<la.length;sa++){var xa=la[sa];xa.slice(-1)!=="_"&&(xa in da&&console.warn('Overwriting FirebaseError base field "'+xa+'" can cause unexpected behavior.'),da[xa]=x[xa])}return da},v}();function h(v,s){return v.replace(l,function(y,D){var x=s[D];return x!=null?String(x):"<"+D+"?>"})}var l=/\{\$([^}]+)}/g;function k(v){return JSON.parse(v)}function p(v){return JSON.stringify(v)}var t=function(v){var s={},y={},D={},x="";try{var U=v.split(".");s=k(i(U[0])||""),y=k(i(U[1])||""),x=U[2],D=y.d||{},delete y.d}catch($){}return{header:s,claims:y,data:D,signature:x}},o=function(v){var s=t(v).claims,y=Math.floor(new Date().getTime()/1e3),D=0,x=0;return typeof s==="object"&&(s.hasOwnProperty("nbf")?D=s.nbf:s.hasOwnProperty("iat")&&(D=s.iat),s.hasOwnProperty("exp")?x=s.exp:x=D+86400),!!y&&!!D&&!!x&&y>=D&&y<=x},E=function(v){var s=t(v).claims;return typeof s==="object"&&s.hasOwnProperty("iat")?s.iat:null},F=function(v){var s=t(v),y=s.claims;return!!y&&typeof y==="object"&&y.hasOwnProperty("iat")},V=function(v){var s=t(v).claims;return typeof s==="object"&&s.admin===!0};function z(v,s){return Object.prototype.hasOwnProperty.call(v,s)}function W(v,s){return Object.prototype.hasOwnProperty.call(v,s)?v[s]:void 0}function J(v){for(var s in v)if(Object.prototype.hasOwnProperty.call(v,s))return!1;return!0}function A(v,s,y){var D={};for(var x in v)Object.prototype.hasOwnProperty.call(v,x)&&(D[x]=s.call(y,v[x],x,v));return D}function H(v){for(var s=[],y=function(ha,da){Array.isArray(da)?da.forEach(function(sa){s.push(encodeURIComponent(ha)+"="+encodeURIComponent(sa))}):s.push(encodeURIComponent(ha)+"="+encodeURIComponent(da))},D=0,x=Object.entries(v);D<x.length;D++){var U=x[D],$=U[0],Z=U[1];y($,Z)}return s.length?"&"+s.join("&"):""}function Y(v){var s={},y=v.replace(/^\?/,"").split("&");return y.forEach(function(D){if(D){var x=D.split("=");s[x[0]]=x[1]}}),s}var ia=function(){function v(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(var s=1;s<this.blockSize;++s)this.pad_[s]=0;this.reset()}return v.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},v.prototype.compress_=function(s,y){y||(y=0);var D=this.W_;if(typeof s==="string")for(var x=0;x<16;x++)D[x]=s.charCodeAt(y)<<24|s.charCodeAt(y+1)<<16|s.charCodeAt(y+2)<<8|s.charCodeAt(y+3),y+=4;else for(var x=0;x<16;x++)D[x]=s[y]<<24|s[y+1]<<16|s[y+2]<<8|s[y+3],y+=4;for(var x=16;x<80;x++){var U=D[x-3]^D[x-8]^D[x-14]^D[x-16];D[x]=(U<<1|U>>>31)&4294967295}for(var $=this.chain_[0],Z=this.chain_[1],ha=this.chain_[2],da=this.chain_[3],sa=this.chain_[4],la,xa,x=0;x<80;x++){x<40?x<20?(la=da^Z&(ha^da),xa=1518500249):(la=Z^ha^da,xa=1859775393):x<60?(la=Z&ha|da&(Z|ha),xa=2400959708):(la=Z^ha^da,xa=3395469782);var U=($<<5|$>>>27)+la+sa+xa+D[x]&4294967295;sa=da,da=ha,ha=(Z<<30|Z>>>2)&4294967295,Z=$,$=U}this.chain_[0]=this.chain_[0]+$&4294967295,this.chain_[1]=this.chain_[1]+Z&4294967295,this.chain_[2]=this.chain_[2]+ha&4294967295,this.chain_[3]=this.chain_[3]+da&4294967295,this.chain_[4]=this.chain_[4]+sa&4294967295},v.prototype.update=function(s,y){if(s==null)return;y===void 0&&(y=s.length);for(var D=y-this.blockSize,x=0,U=this.buf_,$=this.inbuf_;x<y;){if($===0)for(;x<=D;)this.compress_(s,x),x+=this.blockSize;if(typeof s==="string")for(;x<y;){U[$]=s.charCodeAt(x),++$,++x;if($===this.blockSize){this.compress_(U),$=0;break}}else for(;x<y;){U[$]=s[x],++$,++x;if($===this.blockSize){this.compress_(U),$=0;break}}}this.inbuf_=$,this.total_+=y},v.prototype.digest=function(){var s=[],y=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var D=this.blockSize-1;D>=56;D--)this.buf_[D]=y&255,y/=256;this.compress_(this.buf_);for(var x=0,D=0;D<5;D++)for(var U=24;U>=0;U-=8)s[x]=this.chain_[D]>>U&255,++x;return s},v}();function na(v,s){var y=new pa(v,s);return y.subscribe.bind(y)}var pa=function(){function v(s,y){var D=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=y,this.task.then(function(){s(D)}).catch(function(x){D.error(x)})}return v.prototype.next=function(s){this.forEachObserver(function(y){y.next(s)})},v.prototype.error=function(s){this.forEachObserver(function(y){y.error(s)}),this.close(s)},v.prototype.complete=function(){this.forEachObserver(function(s){s.complete()}),this.close()},v.prototype.subscribe=function(s,y,D){var x=this,U;if(s===void 0&&y===void 0&&D===void 0)throw new Error("Missing Observer.");T(s,["next","error","complete"])?U=s:U={next:s,error:y,complete:D},U.next===void 0&&(U.next=ea),U.error===void 0&&(U.error=ea),U.complete===void 0&&(U.complete=ea);var $=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{x.finalError?U.error(x.finalError):U.complete()}catch(Z){}return}),this.observers.push(U),$},v.prototype.unsubscribeOne=function(s){if(this.observers===void 0||this.observers[s]===void 0)return;delete this.observers[s],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this)},v.prototype.forEachObserver=function(s){if(this.finalized)return;for(var y=0;y<this.observers.length;y++)this.sendOne(y,s)},v.prototype.sendOne=function(s,y){var D=this;this.task.then(function(){if(D.observers!==void 0&&D.observers[s]!==void 0)try{y(D.observers[s])}catch(x){typeof console!=="undefined"&&console.error&&console.error(x)}})},v.prototype.close=function(s){var y=this;if(this.finalized)return;this.finalized=!0,s!==void 0&&(this.finalError=s),this.task.then(function(){y.observers=void 0,y.onNoObservers=void 0})},v}();function ma(v,s){return function(){for(var y=[],D=0;D<arguments.length;D++)y[D]=arguments[D];Promise.resolve(!0).then(function(){v.apply(void 0,y)}).catch(function(x){s&&s(x)})}}function T(v,s){if(typeof v!=="object"||v===null)return!1;for(var y=0,D=s;y<D.length;y++){var x=D[y];if(x in v&&typeof v[x]==="function")return!0}return!1}function ea(){}var ja=function(v,s,y,D){var x;D<s?x="at least "+s:D>y&&(x=y===0?"none":"no more than "+y);if(x){var U=v+" failed: Was called with "+D+(D===1?" argument.":" arguments.")+" Expects "+x+".";throw new Error(U)}};function ka(v,s,y){var D="";switch(s){case 1:D=y?"first":"First";break;case 2:D=y?"second":"Second";break;case 3:D=y?"third":"Third";break;case 4:D=y?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var x=v+" failed: ";return x+=D+" argument ",x}function Q(v,s,y,D){if(D&&!y)return;if(typeof y!=="string")throw new Error(ka(v,s,D)+"must be a valid firebase namespace.")}function S(v,s,y,D){if(D&&!y)return;if(typeof y!=="function")throw new Error(ka(v,s,D)+"must be a valid function.")}function ga(v,s,y,D){if(D&&!y)return;if(typeof y!=="object"||y===null)throw new Error(ka(v,s,D)+"must be a valid context object.")}var K=function(v){for(var s=[],y=0,D=0;D<v.length;D++){var x=v.charCodeAt(D);if(x>=55296&&x<=56319){var U=x-55296;D++,c(D<v.length,"Surrogate pair missing trail surrogate.");var $=v.charCodeAt(D)-56320;x=65536+(U<<10)+$}x<128?s[y++]=x:x<2048?(s[y++]=x>>6|192,s[y++]=x&63|128):x<65536?(s[y++]=x>>12|224,s[y++]=x>>6&63|128,s[y++]=x&63|128):(s[y++]=x>>18|240,s[y++]=x>>12&63|128,s[y++]=x>>6&63|128,s[y++]=x&63|128)}return s},fa=function(v){for(var s=0,y=0;y<v.length;y++){var D=v.charCodeAt(y);D<128?s++:D<2048?s+=2:D>=55296&&D<=56319?(s+=4,y++):s+=3}return s};M.CONSTANTS=b;M.Deferred=u;M.ErrorFactory=r;M.FirebaseError=q;M.Sha1=ia;M.assert=c;M.assertionError=d;M.async=ma;M.base64=g;M.base64Decode=i;M.base64Encode=j;M.contains=z;M.createSubscribe=na;M.decode=t;M.deepCopy=m;M.deepExtend=n;M.errorPrefix=ka;M.getUA=w;M.isAdmin=V;M.isBrowser=G;M.isBrowserExtension=I;M.isElectron=R;M.isEmpty=J;M.isIE=N;M.isMobileCordova=B;M.isNode=C;M.isNodeSdk=_;M.isReactNative=L;M.isSafari=X;M.isUWP=O;M.isValidFormat=F;M.isValidTimestamp=o;M.issuedAtTime=E;M.jsonEval=k;M.map=A;M.querystring=H;M.querystringDecode=Y;M.safeGet=W;M.stringLength=fa;M.stringToByteArray=K;M.stringify=p;M.validateArgCount=ja;M.validateCallback=S;M.validateContextObject=ga;M.validateNamespace=Q});var rg=db(q=>{Ob(q,{__assign:()=>c,__asyncDelegator:()=>L,__asyncGenerator:()=>I,__asyncValues:()=>R,__await:()=>G,__awaiter:()=>j,__classPrivateFieldGet:()=>X,__classPrivateFieldSet:()=>P,__createBinding:()=>m,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>_,__importStar:()=>O,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>w,__rest:()=>d,__spread:()=>B,__spreadArrays:()=>C,__values:()=>u});var a=function(h,l){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,p){k.__proto__=p}||function(k,p){for(var t in p)p.hasOwnProperty(t)&&(k[t]=p[t])},a(h,l)};function b(h,l){a(h,l);function k(){this.constructor=h}h.prototype=l===null?Object.create(l):(k.prototype=l.prototype,new k())}var c=function(){return c=Object.assign||function h(l){for(var k,p=1,t=arguments.length;p<t;p++){k=arguments[p];for(var o in k)Object.prototype.hasOwnProperty.call(k,o)&&(l[o]=k[o])}return l},c.apply(this,arguments)};function d(h,l){var k={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&l.indexOf(p)<0&&(k[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var t=0,p=Object.getOwnPropertySymbols(h);t<p.length;t++)l.indexOf(p[t])<0&&Object.prototype.propertyIsEnumerable.call(h,p[t])&&(k[p[t]]=h[p[t]]);return k}function e(h,l,k,p){var t=arguments.length,o=t<3?l:p===null?p=Object.getOwnPropertyDescriptor(l,k):p,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(h,l,k,p);else for(var F=h.length-1;F>=0;F--)(E=h[F])&&(o=(t<3?E(o):t>3?E(l,k,o):E(l,k))||o);return t>3&&o&&Object.defineProperty(l,k,o),o}function f(h,l){return function(k,p){l(k,p,h)}}function g(h,l){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,l)}function j(h,l,k,p){function t(o){return o instanceof k?o:new k(function(E){E(o)})}return new(k||(k=Promise))(function(o,E){function F(W){try{z(p.next(W))}catch(J){E(J)}}function V(W){try{z(p.throw(W))}catch(J){E(J)}}function z(W){W.done?o(W.value):t(W.value).then(F,V)}z((p=p.apply(h,l||[])).next())})}function i(h,l){var k={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},p,t,o,E;return E={next:F(0),throw:F(1),return:F(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function F(z){return function(W){return V([z,W])}}function V(z){if(p)throw new TypeError("Generator is already executing.");for(;k;)try{if(p=1,t&&(o=z[0]&2?t.return:z[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,z[1])).done)return o;(t=0,o)&&(z=[z[0]&2,o.value]);switch(z[0]){case 0:case 1:o=z;break;case 4:return k.label++,{value:z[1],done:!1};case 5:k.label++,t=z[1],z=[0];continue;case 7:z=k.ops.pop(),k.trys.pop();continue;default:if(!(o=k.trys,o=o.length>0&&o[o.length-1])&&(z[0]===6||z[0]===2)){k=0;continue}if(z[0]===3&&(!o||z[1]>o[0]&&z[1]<o[3])){k.label=z[1];break}if(z[0]===6&&k.label<o[1]){k.label=o[1],o=z;break}if(o&&k.label<o[2]){k.label=o[2],k.ops.push(z);break}o[2]&&k.ops.pop(),k.trys.pop();continue}z=l.call(h,k)}catch(W){z=[6,W],t=0}finally{p=o=0}if(z[0]&5)throw z[1];return{value:z[0]?z[1]:void 0,done:!0}}}function m(h,l,k,p){p===void 0&&(p=k),h[p]=l[k]}function n(h,l){for(var k in h)k!=="default"&&!l.hasOwnProperty(k)&&(l[k]=h[k])}function u(h){var l=typeof Symbol==="function"&&Symbol.iterator,k=l&&h[l],p=0;if(k)return k.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")}function w(h,l){var k=typeof Symbol==="function"&&h[Symbol.iterator];if(!k)return h;var p=k.call(h),t,o=[],E;try{for(;(l===void 0||l-- >0)&&!(t=p.next()).done;)o.push(t.value)}catch(F){E={error:F}}finally{try{t&&!t.done&&(k=p.return)&&k.call(p)}finally{if(E)throw E.error}}return o}function B(){for(var h=[],l=0;l<arguments.length;l++)h=h.concat(w(arguments[l]));return h}function C(){for(var h=0,l=0,k=arguments.length;l<k;l++)h+=arguments[l].length;for(var p=Array(h),t=0,l=0;l<k;l++)for(var o=arguments[l],E=0,F=o.length;E<F;E++,t++)p[t]=o[E];return p}function G(h){return this instanceof G?(this.v=h,this):new G(h)}function I(h,l,k){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=k.apply(h,l||[]),t,o=[];return t={},E("next"),E("throw"),E("return"),t[Symbol.asyncIterator]=function(){return this},t;function E(A){p[A]&&(t[A]=function(H){return new Promise(function(Y,ia){o.push([A,H,Y,ia])>1||F(A,H)})})}function F(A,H){try{V(p[A](H))}catch(Y){J(o[0][3],Y)}}function V(A){A.value instanceof G?Promise.resolve(A.value.v).then(z,W):J(o[0][2],A)}function z(A){F("next",A)}function W(A){F("throw",A)}function J(A,H){(A(H),o.shift(),o.length)&&F(o[0][0],o[0][1])}}function L(h){var l,k;return l={},p("next"),p("throw",function(t){throw t}),p("return"),l[Symbol.iterator]=function(){return this},l;function p(t,o){l[t]=h[t]?function(E){return(k=!k)?{value:G(h[t](E)),done:t==="return"}:o?o(E):E}:o}}function R(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l=h[Symbol.asyncIterator],k;return l?l.call(h):(h=typeof u==="function"?u(h):h[Symbol.iterator](),k={},p("next"),p("throw"),p("return"),k[Symbol.asyncIterator]=function(){return this},k);function p(o){k[o]=h[o]&&function(E){return new Promise(function(F,V){E=h[o](E),t(F,V,E.done,E.value)})}}function t(o,E,F,V){Promise.resolve(V).then(function(z){o({value:z,done:F})},E)}}function N(h,l){return Object.defineProperty?Object.defineProperty(h,"raw",{value:l}):h.raw=l,h}function O(h){if(h&&h.__esModule)return h;var l={};if(h!=null)for(var k in h)Object.hasOwnProperty.call(h,k)&&(l[k]=h[k]);return l.default=h,l}function _(h){return h&&h.__esModule?h:{default:h}}function X(h,l){if(!l.has(h))throw new TypeError("attempted to get private field on non-instance");return l.get(h)}function P(h,l,k){if(!l.has(h))throw new TypeError("attempted to set private field on non-instance");return l.set(h,k),k}});var qg=db(i=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=rg(),b=Be(),c=function(){function n(u,w,B){this.name=u,this.instanceFactory=w,this.type=B,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return n.prototype.setInstantiationMode=function(u){return this.instantiationMode=u,this},n.prototype.setMultipleInstances=function(u){return this.multipleInstances=u,this},n.prototype.setServiceProps=function(u){return this.serviceProps=u,this},n}();var d="[DEFAULT]";var e=function(){function n(u,w){this.name=u,this.container=w,this.component=null,this.instances=new Map(),this.instancesDeferred=new Map()}return n.prototype.get=function(u){u===void 0&&(u=d);var w=this.normalizeInstanceIdentifier(u);if(!this.instancesDeferred.has(w)){var B=new b.Deferred();this.instancesDeferred.set(w,B);try{var C=this.getOrInitializeService(w);C&&B.resolve(C)}catch(G){}}return this.instancesDeferred.get(w).promise},n.prototype.getImmediate=function(u){var w=a.__assign({identifier:d,optional:!1},u),B=w.identifier,C=w.optional,G=this.normalizeInstanceIdentifier(B);try{var I=this.getOrInitializeService(G);if(!I){if(C)return null;throw Error("Service "+this.name+" is not available")}return I}catch(L){if(C)return null;throw L}},n.prototype.getComponent=function(){return this.component},n.prototype.setComponent=function(u){var w,B;if(u.name!==this.name)throw Error("Mismatching Component "+u.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");this.component=u;if(g(u))try{this.getOrInitializeService(d)}catch(_){}try{for(var C=a.__values(this.instancesDeferred.entries()),G=C.next();!G.done;G=C.next()){var I=a.__read(G.value,2),L=I[0],R=I[1],N=this.normalizeInstanceIdentifier(L);try{var O=this.getOrInitializeService(N);R.resolve(O)}catch(_){}}}catch(_){w={error:_}}finally{try{G&&!G.done&&(B=C.return)&&B.call(C)}finally{if(w)throw w.error}}},n.prototype.clearInstance=function(u){u===void 0&&(u=d),this.instancesDeferred.delete(u),this.instances.delete(u)},n.prototype.delete=function(){return a.__awaiter(this,void 0,void 0,function(){var u;return a.__generator(this,function(w){switch(w.label){case 0:return u=Array.from(this.instances.values()),[4,Promise.all(u.filter(function(B){return"INTERNAL"in B}).map(function(B){return B.INTERNAL.delete()}))];case 1:return w.sent(),[2]}})})},n.prototype.isComponentSet=function(){return this.component!=null},n.prototype.getOrInitializeService=function(u){var w=this.instances.get(u);return!w&&this.component&&(w=this.component.instanceFactory(this.container,f(u)),this.instances.set(u,w)),w||null},n.prototype.normalizeInstanceIdentifier=function(u){return this.component?this.component.multipleInstances?u:d:u},n}();function f(n){return n===d?void 0:n}function g(n){return n.instantiationMode==="EAGER"}var j=function(){function n(u){this.name=u,this.providers=new Map()}return n.prototype.addComponent=function(u){var w=this.getProvider(u.name);if(w.isComponentSet())throw new Error("Component "+u.name+" has already been registered with "+this.name);w.setComponent(u)},n.prototype.addOrOverwriteComponent=function(u){var w=this.getProvider(u.name);w.isComponentSet()&&this.providers.delete(u.name),this.addComponent(u)},n.prototype.getProvider=function(u){if(this.providers.has(u))return this.providers.get(u);var w=new e(u,this);return this.providers.set(u,w),w},n.prototype.getProviders=function(){return Array.from(this.providers.values())},n}();i.Component=c;i.ComponentContainer=j;i.Provider=e});var sg=db(u=>{Ob(u,{LogLevel:()=>d,Logger:()=>i,setLogLevel:()=>m,setUserLogHandler:()=>n});function a(){for(var B=0,C=0,G=arguments.length;C<G;C++)B+=arguments[C].length;for(var I=Array(B),L=0,C=0;C<G;C++)for(var R=arguments[C],N=0,O=R.length;N<O;N++,L++)I[L]=R[N];return I}var b,c=[],d;(function(B){B[B.DEBUG=0]="DEBUG",B[B.VERBOSE=1]="VERBOSE",B[B.INFO=2]="INFO",B[B.WARN=3]="WARN",B[B.ERROR=4]="ERROR",B[B.SILENT=5]="SILENT"})(d||(d={}));var e={debug:d.DEBUG,verbose:d.VERBOSE,info:d.INFO,warn:d.WARN,error:d.ERROR,silent:d.SILENT},f=d.INFO,g=(b={},b[d.DEBUG]="log",b[d.VERBOSE]="log",b[d.INFO]="info",b[d.WARN]="warn",b[d.ERROR]="error",b),j=function(B,C){for(var G=[],I=2;I<arguments.length;I++)G[I-2]=arguments[I];if(C<B.logLevel)return;var L=new Date().toISOString(),R=g[C];if(R)console[R].apply(console,a(["["+L+"]  "+B.name+":"],G));else throw new Error("Attempted to log a message with an invalid logType (value: "+C+")")},i=function(){function B(C){this.name=C,this._logLevel=f,this._logHandler=j,this._userLogHandler=null,c.push(this)}return Object.defineProperty(B.prototype,"logLevel",{get:function(){return this._logLevel},set:function(C){if(!(C in d))throw new TypeError('Invalid value "'+C+'" assigned to `logLevel`');this._logLevel=C},enumerable:!1,configurable:!0}),B.prototype.setLogLevel=function(C){this._logLevel=typeof C==="string"?e[C]:C},Object.defineProperty(B.prototype,"logHandler",{get:function(){return this._logHandler},set:function(C){if(typeof C!=="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=C},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(C){this._userLogHandler=C},enumerable:!1,configurable:!0}),B.prototype.debug=function(){for(var C=[],G=0;G<arguments.length;G++)C[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.DEBUG],C)),this._logHandler.apply(this,a([this,d.DEBUG],C))},B.prototype.log=function(){for(var C=[],G=0;G<arguments.length;G++)C[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.VERBOSE],C)),this._logHandler.apply(this,a([this,d.VERBOSE],C))},B.prototype.info=function(){for(var C=[],G=0;G<arguments.length;G++)C[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.INFO],C)),this._logHandler.apply(this,a([this,d.INFO],C))},B.prototype.warn=function(){for(var C=[],G=0;G<arguments.length;G++)C[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.WARN],C)),this._logHandler.apply(this,a([this,d.WARN],C))},B.prototype.error=function(){for(var C=[],G=0;G<arguments.length;G++)C[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.ERROR],C)),this._logHandler.apply(this,a([this,d.ERROR],C))},B}();function m(B){c.forEach(function(C){C.setLogLevel(B)})}function n(B,C){for(var G=function(N){var O=null;C&&C.level&&(O=e[C.level]),B===null?N.userLogHandler=null:N.userLogHandler=function(_,X){for(var P=[],q=2;q<arguments.length;q++)P[q-2]=arguments[q];var r=P.map(function(h){if(h==null)return null;{if(typeof h==="string")return h;{if(typeof h==="number"||typeof h==="boolean")return h.toString();{if(h instanceof Error)return h.message;try{return JSON.stringify(h)}catch(l){return null}}}}}).filter(function(h){return h}).join(" ");X>=(O!==null&&O!==void 0?O:_.logLevel)&&B({level:d[X].toLowerCase(),message:r,args:P,type:_.name})}},I=0,L=c;I<L.length;I++){var R=L[I];G(R)}}});var og=db(z=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0});var a=pg(),b=Be(),c=qg(),d=sg();var e,f=(e={},e["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",e["bad-app-name"]="Illegal App name: '{$appName}",e["duplicate-app"]="Firebase App named '{$appName}' already exists",e["app-deleted"]="Firebase App named '{$appName}' already deleted",e["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",e["invalid-log-argument"]="First argument to `onLog` must be null or a function.",e),g=new b.ErrorFactory("app","Firebase",f),j="@firebase/app",i="0.6.8",m="@firebase/analytics",n="@firebase/auth",u="@firebase/database",w="@firebase/functions",B="@firebase/installations",C="@firebase/messaging",G="@firebase/performance",I="@firebase/remote-config",L="@firebase/storage",R="@firebase/firestore",N="firebase-wrapper";var O,_="[DEFAULT]",X=(O={},O[j]="fire-core",O[m]="fire-analytics",O[n]="fire-auth",O[u]="fire-rtdb",O[w]="fire-fn",O[B]="fire-iid",O[C]="fire-fcm",O[G]="fire-perf",O[I]="fire-rc",O[L]="fire-gcs",O[R]="fire-fst",O["fire-js"]="fire-js",O[N]="fire-js-all",O);var P=new d.Logger("@firebase/app");var q=function(){function J(A,H,Y){var ia,na,pa=this;this.firebase_=Y,this.isDeleted_=!1,this.name_=H.name,this.automaticDataCollectionEnabled_=H.automaticDataCollectionEnabled||!1,this.options_=b.deepCopy(A),this.container=new c.ComponentContainer(H.name),this._addComponent(new c.Component("app",function(){return pa},"PUBLIC"));try{for(var ma=a.__values(this.firebase_.INTERNAL.components.values()),T=ma.next();!T.done;T=ma.next()){var ea=T.value;this._addComponent(ea)}}catch(ja){ia={error:ja}}finally{try{T&&!T.done&&(na=ma.return)&&na.call(ma)}finally{if(ia)throw ia.error}}}return Object.defineProperty(J.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(A){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=A},enumerable:!1,configurable:!0}),Object.defineProperty(J.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(J.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),J.prototype.delete=function(){var A=this;return new Promise(function(H){A.checkDestroyed_(),H()}).then(function(){return A.firebase_.INTERNAL.removeApp(A.name_),Promise.all(A.container.getProviders().map(function(H){return H.delete()}))}).then(function(){A.isDeleted_=!0})},J.prototype._getService=function(A,H){return H===void 0&&(H=_),this.checkDestroyed_(),this.container.getProvider(A).getImmediate({identifier:H})},J.prototype._removeServiceInstance=function(A,H){H===void 0&&(H=_),this.container.getProvider(A).clearInstance(H)},J.prototype._addComponent=function(A){try{this.container.addComponent(A)}catch(H){P.debug("Component "+A.name+" failed to register with FirebaseApp "+this.name,H)}},J.prototype._addOrOverwriteComponent=function(A){this.container.addOrOverwriteComponent(A)},J.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw g.create("app-deleted",{appName:this.name_})},J}();q.prototype.name&&q.prototype.options||q.prototype.delete||console.log("dc");var r="7.16.0";function h(J){var A={},H=new Map(),Y={__esModule:!0,initializeApp:pa,app:na,registerVersion:ea,setLogLevel:d.setLogLevel,onLog:ja,apps:null,SDK_VERSION:r,INTERNAL:{registerComponent:T,removeApp:ia,components:H,useAsService:ka}};Y.default=Y,Object.defineProperty(Y,"apps",{get:ma});function ia(Q){delete A[Q]}function na(Q){Q=Q||_;if(!b.contains(A,Q))throw g.create("no-app",{appName:Q});return A[Q]}na.App=J;function pa(Q,S){S===void 0&&(S={});if(typeof S!=="object"||S===null){var ga=S;S={name:ga}}var K=S;K.name===void 0&&(K.name=_);var fa=K.name;if(typeof fa!=="string"||!fa)throw g.create("bad-app-name",{appName:String(fa)});if(b.contains(A,fa))throw g.create("duplicate-app",{appName:fa});var M=new J(Q,K,Y);return A[fa]=M,M}function ma(){return Object.keys(A).map(function(Q){return A[Q]})}function T(Q){var S,ga,K=Q.name;if(H.has(K))return P.debug("There were multiple attempts to register component "+K+"."),Q.type==="PUBLIC"?Y[K]:null;H.set(K,Q);if(Q.type==="PUBLIC"){var fa=function(s){s===void 0&&(s=na());if(typeof s[K]!=="function")throw g.create("invalid-app-argument",{appName:K});return s[K]()};Q.serviceProps!==void 0&&b.deepExtend(fa,Q.serviceProps),Y[K]=fa,J.prototype[K]=function(){for(var s=[],y=0;y<arguments.length;y++)s[y]=arguments[y];var D=this._getService.bind(this,K);return D.apply(this,Q.multipleInstances?s:[])}}try{for(var M=a.__values(Object.keys(A)),ta=M.next();!ta.done;ta=M.next()){var v=ta.value;A[v]._addComponent(Q)}}catch(s){S={error:s}}finally{try{ta&&!ta.done&&(ga=M.return)&&ga.call(M)}finally{if(S)throw S.error}}return Q.type==="PUBLIC"?Y[K]:null}function ea(Q,S,ga){var K,fa=(K=X[Q])!==null&&K!==void 0?K:Q;ga&&(fa+="-"+ga);var M=fa.match(/\s|\//),ta=S.match(/\s|\//);if(M||ta){var v=['Unable to register library "'+fa+'" with version "'+S+'":'];M&&v.push('library name "'+fa+'" contains illegal characters (whitespace or "/")'),M&&ta&&v.push("and"),ta&&v.push('version name "'+S+'" contains illegal characters (whitespace or "/")'),P.warn(v.join(" "));return}T(new c.Component(fa+"-version",function(){return{library:fa,version:S}},"VERSION"))}function ja(Q,S){if(Q!==null&&typeof Q!=="function")throw g.create("invalid-log-argument",{appName:name});d.setUserLogHandler(Q,S)}function ka(Q,S){if(S==="serverAuth")return null;var ga=S;return ga}return Y}function l(){var J=h(q);J.INTERNAL=a.__assign(a.__assign({},J.INTERNAL),{createFirebaseNamespace:l,extendNamespace:A,createSubscribe:b.createSubscribe,ErrorFactory:b.ErrorFactory,deepExtend:b.deepExtend});function A(H){b.deepExtend(J,H)}return J}var k=l();var p=function(){function J(A){this.container=A}return J.prototype.getPlatformInfoString=function(){var A=this.container.getProviders();return A.map(function(H){if(t(H)){var Y=H.getImmediate();return Y.library+"/"+Y.version}else return null}).filter(function(H){return H}).join(" ")},J}();function t(J){var A=J.getComponent();return(A===null||A===void 0?void 0:A.type)==="VERSION"}function o(J,A){J.INTERNAL.registerComponent(new c.Component("platform-logger",function(H){return new p(H)},"PRIVATE")),J.registerVersion(j,i,A),J.registerVersion("fire-js","")}if(b.isBrowser()&&self.firebase!==void 0){P.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);var E=self.firebase.SDK_VERSION;E&&E.indexOf("LITE")>=0&&P.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}var F=k.initializeApp;k.initializeApp=function(){for(var J=[],A=0;A<arguments.length;A++)J[A]=arguments[A];return b.isNode()&&P.warn(`
      Warning: This is a browser-targeted Firebase bundle but it appears it is being
      run in a Node environment.  If running in a Node environment, make sure you
      are using the bundle specified by the "main" field in package.json.
      
      If you are using Webpack, you can specify "main" as the first item in
      "resolve.mainFields":
      https://webpack.js.org/configuration/resolve/#resolvemainfields
      
      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"
      as the first item in "mainFields", e.g. ['main', 'module'].
      https://github.com/rollup/rollup-plugin-node-resolve
      `),F.apply(void 0,J)};var V=k;o(V);z.default=V;z.firebase=V});var Ja=db((e,f)=>{"use strict";function a(g){return g&&typeof g==="object"&&"default"in g?g.default:g}var b=a(og()),c="firebase",d="7.16.0";b.registerVersion(c,d,"app");f.exports=b});var hl=db((b,c)=>{var a=function(){function d(m,n){if(!j[m]){j[m]={};for(var u=0;u<m.length;u++)j[m][m.charAt(u)]=u}return j[m][n]}var e=String.fromCharCode,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",j={},i={compressToBase64:function(m){if(null==m)return"";var n=i._compress(m,6,function(u){return f.charAt(u)});switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(m){return null==m?"":""==m?null:i._decompress(m.length,32,function(n){return d(f,m.charAt(n))})},compressToUTF16:function(m){return null==m?"":i._compress(m,15,function(n){return e(n+32)})+" "},decompressFromUTF16:function(m){return null==m?"":""==m?null:i._decompress(m.length,16384,function(n){return m.charCodeAt(n)-32})},compressToUint8Array:function(m){for(var n=i.compress(m),u=new Uint8Array(2*n.length),w=0,B=n.length;B>w;w++){var C=n.charCodeAt(w);u[2*w]=C>>>8,u[2*w+1]=C%256}return u},decompressFromUint8Array:function(m){if(null===m||void 0===m)return i.decompress(m);for(var n=new Array(m.length/2),u=0,w=n.length;w>u;u++)n[u]=256*m[2*u]+m[2*u+1];var B=[];return n.forEach(function(C){B.push(e(C))}),i.decompress(B.join(""))},compressToEncodedURIComponent:function(m){return null==m?"":i._compress(m,6,function(n){return g.charAt(n)})},decompressFromEncodedURIComponent:function(m){return null==m?"":""==m?null:(m=m.replace(/ /g,"+"),i._decompress(m.length,32,function(n){return d(g,m.charAt(n))}))},compress:function(m){return i._compress(m,16,function(n){return e(n)})},_compress:function(m,n,u){if(null==m)return"";var w,B,C,G={},I={},L="",R="",N="",O=2,_=3,X=2,P=[],q=0,r=0;for(C=0;C<m.length;C+=1)if(L=m.charAt(C),Object.prototype.hasOwnProperty.call(G,L)||(G[L]=_++,I[L]=!0),R=N+L,Object.prototype.hasOwnProperty.call(G,R))N=R;else{if(Object.prototype.hasOwnProperty.call(I,N)){if(N.charCodeAt(0)<256){for(w=0;X>w;w++)q<<=1,r==n-1?(r=0,P.push(u(q)),q=0):r++;for(B=N.charCodeAt(0),w=0;8>w;w++)q=q<<1|1&B,r==n-1?(r=0,P.push(u(q)),q=0):r++,B>>=1}else{for(B=1,w=0;X>w;w++)q=q<<1|B,r==n-1?(r=0,P.push(u(q)),q=0):r++,B=0;for(B=N.charCodeAt(0),w=0;16>w;w++)q=q<<1|1&B,r==n-1?(r=0,P.push(u(q)),q=0):r++,B>>=1}O--,0==O&&(O=Math.pow(2,X),X++),delete I[N]}else for(B=G[N],w=0;X>w;w++)q=q<<1|1&B,r==n-1?(r=0,P.push(u(q)),q=0):r++,B>>=1;O--,0==O&&(O=Math.pow(2,X),X++),G[R]=_++,N=String(L)}if(""!==N){if(Object.prototype.hasOwnProperty.call(I,N)){if(N.charCodeAt(0)<256){for(w=0;X>w;w++)q<<=1,r==n-1?(r=0,P.push(u(q)),q=0):r++;for(B=N.charCodeAt(0),w=0;8>w;w++)q=q<<1|1&B,r==n-1?(r=0,P.push(u(q)),q=0):r++,B>>=1}else{for(B=1,w=0;X>w;w++)q=q<<1|B,r==n-1?(r=0,P.push(u(q)),q=0):r++,B=0;for(B=N.charCodeAt(0),w=0;16>w;w++)q=q<<1|1&B,r==n-1?(r=0,P.push(u(q)),q=0):r++,B>>=1}O--,0==O&&(O=Math.pow(2,X),X++),delete I[N]}else for(B=G[N],w=0;X>w;w++)q=q<<1|1&B,r==n-1?(r=0,P.push(u(q)),q=0):r++,B>>=1;O--,0==O&&(O=Math.pow(2,X),X++)}for(B=2,w=0;X>w;w++)q=q<<1|1&B,r==n-1?(r=0,P.push(u(q)),q=0):r++,B>>=1;for(;;){if(q<<=1,r==n-1){P.push(u(q));break}r++}return P.join("")},decompress:function(m){return null==m?"":""==m?null:i._decompress(m.length,32768,function(n){return m.charCodeAt(n)})},_decompress:function(m,n,u){var w,B,C,G,I,L,R,N,O=[],_=4,X=4,P=3,q="",r=[],h={val:u(0),position:n,index:1};for(B=0;3>B;B+=1)O[B]=B;for(G=0,L=Math.pow(2,2),R=1;R!=L;)I=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),G|=(I>0?1:0)*R,R<<=1;switch(w=G){case 0:for(G=0,L=Math.pow(2,8),R=1;R!=L;)I=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),G|=(I>0?1:0)*R,R<<=1;N=e(G);break;case 1:for(G=0,L=Math.pow(2,16),R=1;R!=L;)I=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),G|=(I>0?1:0)*R,R<<=1;N=e(G);break;case 2:return""}for(O[3]=N,C=N,r.push(N);;){if(h.index>m)return"";for(G=0,L=Math.pow(2,P),R=1;R!=L;)I=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),G|=(I>0?1:0)*R,R<<=1;switch(N=G){case 0:for(G=0,L=Math.pow(2,8),R=1;R!=L;)I=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),G|=(I>0?1:0)*R,R<<=1;O[X++]=e(G),N=X-1,_--;break;case 1:for(G=0,L=Math.pow(2,16),R=1;R!=L;)I=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),G|=(I>0?1:0)*R,R<<=1;O[X++]=e(G),N=X-1,_--;break;case 2:return r.join("")}if(0==_&&(_=Math.pow(2,P),P++),O[N])q=O[N];else{if(N!==X)return null;q=C+C.charAt(0)}r.push(q),O[X++]=C+q.charAt(0),_--,C=q,0==_&&(_=Math.pow(2,P),P++)}}};return i}();"function"==typeof define&&define.amd?define(function(){return a}):"undefined"!=typeof c&&null!=c&&(c.exports=a)});let zg,Ag=0,Bg=0;const va={get:()=>zg,set:a=>{zg=a},getFrame:()=>Ag,setFrame:a=>{Ag=a},getElapsed:()=>Bg,setElapsed:a=>{Bg=a}};let Fg=0;function ve(a=0){return()=>{Fg=a}}function Qc(){return Fg}let Fe="Phaser",ll="https://phaser4.io",ml="#fff",nl="linear-gradient(#3e0081 40%, #00bcc3)";function Ce(){if(Fe!==""){const a=va.get(),b=Fe==="Phaser"?" v"+a.VERSION:"";console.log(`%c${Fe}${b}%c ${ll}`,`padding: 4px 16px; color: ${ml}; background: ${nl}`,"")}}let Kg=800,Lg=600,Mg=1;function ye(a=800,b=600,c=1){return c===0&&(c=window.devicePixelRatio),()=>{Kg=a,Lg=b,Mg=c}}function Pb(){return Kg}function Qb(){return Lg}function Rb(){return Mg}const Te=[],Tb={add:a=>{Te.push(a)},get:()=>Te,clear:()=>{Te.length=0}};let Jg;function Rc(a){Jg=a}function De(){return Jg}let Ge=.5,He=.5;let Gg=0;function Ie(a){Gg=a}function jc(){return Gg}function Sc(a){let b;return a&&(typeof a==="string"?b=document.getElementById(a):typeof a==="object"&&a.nodeType===1&&(b=a)),b||(b=document.body),b}let Hg;function we(a){return()=>{a&&(Hg=Sc(a))}}function Ee(){return Hg}let Ig=[];function xe(a){return()=>{Ig=[].concat(a)}}function Je(){return Ig}let pl={alpha:!1,antialias:!1,depth:!1,premultipliedAlpha:!1};function Ke(){return pl}class gh{constructor(a){this.stack=[],this.current=null,this.renderer=a}reset(){this.stack=[],this.current=null;const a=this.renderer,b=a.gl;b.bindFramebuffer(b.FRAMEBUFFER,null),b.viewport(0,0,a.width,a.height)}add(a,b=!0,c=0,d=0){this.stack.push({framebuffer:a,width:c,height:d}),this.set(a,b,c,d)}set(a,b=!0,c=0,d=0){const e=this.renderer,f=e.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),b&&(f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),c>0&&f.viewport(0,0,c,d),this.current=a}pop(){this.stack.pop();const a=this.stack.length;if(a>0){const b=this.stack[a-1];this.set(b.framebuffer,!1,b.width,b.height)}else this.reset()}rebind(){const a=this.renderer.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.current)}destroy(){this.stack=[]}}let fh;const Aa={get:()=>fh,set:a=>{fh=a}};function hh(a,b=[]){const c=a>>16&255,d=a>>8&255,e=a&255,f=a>16777215?a>>>24:255;return b[0]=c/255,b[1]=d/255,b[2]=e/255,b[3]=f/255,b}function ch(a,b){return a.a===b.a&&a.b===b.b&&a.c===b.c&&a.d===b.d&&a.tx===b.tx&&a.ty===b.ty}function oh(a,b){const c=Aa.get();b||(b=c.COLOR_ATTACHMENT0);const d=c.createFramebuffer();return c.bindFramebuffer(c.FRAMEBUFFER,d),c.framebufferTexture2D(c.FRAMEBUFFER,b,c.TEXTURE_2D,a,0),c.bindFramebuffer(c.FRAMEBUFFER,null),d}function fd(a){const b=Aa.get();if(!b)return;const{parent:c,flipY:d,unpackPremultiplyAlpha:e,minFilter:f,magFilter:g,wrapS:j,wrapT:i,generateMipmap:m,isPOT:n}=a,u=c.image;let w=c.width,B=c.height;const C=b.createTexture();return b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,C),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,d),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),u?(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,u),w=u.width,B=u.height):b.texImage2D(b.TEXTURE_2D,0,b.RGBA,w,B,0,b.RGBA,b.UNSIGNED_BYTE,null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,g),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,j),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,i),m&&n&&b.generateMipmap(b.TEXTURE_2D),a.texture=C,C}function ph(a){const b=Aa.get();b&&b.isFramebuffer(a)&&b.deleteFramebuffer(a)}function Ue(a){const b=Aa.get();if(!b)return;b.isTexture(a)&&b.deleteTexture(a)}function dh(a,b){return a<1||b<1?!1:(a&a-1)===0&&(b&b-1)===0}function sh(a,b=!0){const c=Aa.get();c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,a);const d=b?c.LINEAR:c.NEAREST;c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,d),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,d)}function th(a){const b=Aa.get(),c=a.parent.image,d=c.width,e=c.height;return d>0&&e>0&&(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,a.texture),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,a.flipY),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,c)),a.texture}class ed{constructor(a,b={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1;const c=Aa.get();this.parent=a,this.isPOT=dh(a.width,a.height);const{texture:d=null,framebuffer:e=null,unpackPremultiplyAlpha:f=!0,minFilter:g=c.LINEAR,magFilter:j=c.LINEAR,wrapS:i=c.CLAMP_TO_EDGE,wrapT:m=c.CLAMP_TO_EDGE,generateMipmap:n=this.isPOT,flipY:u=!1}=b;this.minFilter=g,this.magFilter=j,this.wrapS=i,this.wrapT=m,this.generateMipmap=n,this.flipY=u,this.unpackPremultiplyAlpha=f,e&&(this.framebuffer=e),d?this.texture=d:fd(this)}setFilter(a){this.texture&&sh(this.texture,a)}create(){const a=this.texture;return a&&Ue(a),fd(this)}update(){const a=this.texture;return a?th(this):fd(this)}setIndex(a){this.dirtyIndex=a!==this.index,this.index=a}destroy(){Ue(this.texture),ph(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}}class nh{constructor(a,b,c,d,e){this.batchSize=a,this.dataSize=b,this.indexSize=c,this.vertexElementSize=d,this.quadIndexSize=e,this.vertexByteSize=d*b,this.quadByteSize=this.vertexByteSize*4,this.quadElementSize=d*4,this.bufferByteSize=a*this.quadByteSize,this.create()}create(){let a=[];for(let c=0;c<this.batchSize*this.indexSize;c+=this.indexSize)a.push(c+0,c+1,c+2,c+2,c+3,c+0);this.data=new ArrayBuffer(this.bufferByteSize),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const b=Aa.get();this.vertexBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.data,b.DYNAMIC_DRAW),this.indexBuffer=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.index,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,null),a=[]}destroy(){}}class Ve{constructor(a,b,c,d,e,f){this.trimmed=!1,this.texture=a,this.key=b,this.x=c,this.y=d,this.width=e,this.height=f,this.sourceSizeWidth=e,this.sourceSizeHeight=f,this.updateUVs()}setPivot(a,b){this.pivot={x:a,y:b}}setSize(a,b){this.width=a,this.height=b,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.updateUVs()}setSourceSize(a,b){this.sourceSizeWidth=a,this.sourceSizeHeight=b}setTrim(a,b,c,d,e,f){this.trimmed=!0,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.spriteSourceSizeX=c,this.spriteSourceSizeY=d,this.spriteSourceSizeWidth=e,this.spriteSourceSizeHeight=f}getExtent(a,b){const c=this.sourceSizeWidth,d=this.sourceSizeHeight;let e,f,g,j;return this.trimmed?(e=this.spriteSourceSizeX-a*c,f=e+this.spriteSourceSizeWidth,g=this.spriteSourceSizeY-b*d,j=g+this.spriteSourceSizeHeight):(e=-a*c,f=e+c,g=-b*d,j=g+d),{left:e,right:f,top:g,bottom:j}}setExtent(a){const b=a.transform,c=b.origin.x,d=b.origin.y,e=this.sourceSizeWidth,f=this.sourceSizeHeight;let g,j,i,m;this.trimmed?(g=this.spriteSourceSizeX-c*e,j=this.spriteSourceSizeY-d*f,i=this.spriteSourceSizeWidth,m=this.spriteSourceSizeHeight):(g=-c*e,j=-d*f,i=e,m=f),b.setExtent(g,j,i,m)}updateUVs(){const{x:a,y:b,width:c,height:d}=this,e=this.texture.width,f=this.texture.height;this.u0=a/e,this.v0=b/f,this.u1=(a+c)/e,this.v1=(b+d)/f}}class Ya{constructor(a,b,c){this.key="",a&&(b=a.width,c=a.height),this.image=a,this.width=b,this.height=c,this.frames=new Map(),this.data={},this.addFrame("__BASE",0,0,b,c),Tb.add(this)}addFrame(a,b,c,d,e){if(this.frames.has(a))return null;const f=new Ve(this,a,b,c,d,e);return this.frames.set(a,f),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=f),f}getFrame(a){if(!a)return this.firstFrame;a instanceof Ve&&(a=a.key);let b=this.frames.get(a);return b||(console.warn(`Frame missing: ${a}`),b=this.firstFrame),b}setSize(a,b){this.width=a,this.height=b;const c=this.frames.get("__BASE");c.setSize(a,b)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}}let mh;const oc={get:()=>mh,set:a=>{mh=a}};const rh={fragmentShader:`\r
#define SHADER_NAME SINGLE_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture;\r
\r
void main (void)\r
{\r
    vec4 color = texture2D(uTexture, vTextureCoord);\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`,vertexShader:`\r
#define SHADER_NAME SINGLE_QUAD_VERT\r
\r
precision highp float;\r
\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
attribute float aTextureId;\r
attribute vec4 aTintColor;\r
\r
uniform mat4 uProjectionMatrix;\r
uniform mat4 uCameraMatrix;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
void main (void)\r
{\r
    vTextureCoord = aTextureCoord;\r
    vTextureId = aTextureId;\r
    vTintColor = aTintColor;\r
\r
    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\r
}`};class dd{constructor(a={}){this.attribs={aVertexPosition:0,aTextureCoord:0,aTextureId:0,aTintColor:0},this.uniforms={uProjectionMatrix:0,uCameraMatrix:0,uTexture:0,uTime:0,uResolution:0},this.renderToFBO=!1,this.renderer=oc.get();const{batchSize:b=4096,dataSize:c=4,indexSize:d=4,vertexElementSize:e=6,quadIndexSize:f=6,fragmentShader:g=rh.fragmentShader,vertexShader:j=rh.vertexShader,width:i=Pb(),height:m=Qb(),resolution:n=Rb(),renderToFBO:u=!1}=a;this.buffer=new nh(b,c,d,e,f),this.createShaders(g,j),this.count=0,this.renderToFBO=u;const w=new Ya(null,i*n,m*n),B=new ed(w);w.binding=B,B.framebuffer=oh(B.texture),this.texture=w,this.framebuffer=B.framebuffer}createShaders(a,b){const c=this.renderer.gl,d=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(d,a),c.compileShader(d);let e=!1,f=c.getShaderInfoLog(d);f.length>0&&(e=!0,console.error(f));const g=c.createShader(c.VERTEX_SHADER);c.shaderSource(g,b),c.compileShader(g),f=c.getShaderInfoLog(d),f.length>0&&(e=!0,console.error(f));if(e)return;const j=c.createProgram();c.attachShader(j,g),c.attachShader(j,d),c.linkProgram(j),c.useProgram(j),this.program=j;for(const i of Object.keys(this.attribs)){const m=c.getAttribLocation(j,i);c.enableVertexAttribArray(m),this.attribs[i]=m}for(const i of Object.keys(this.uniforms))this.uniforms[i]=c.getUniformLocation(j,i)}bind(a,b,c){if(!this.program)return!1;const d=this.renderer,e=d.gl,f=this.uniforms;return e.useProgram(this.program),e.uniformMatrix4fv(f.uProjectionMatrix,!1,a),e.uniformMatrix4fv(f.uCameraMatrix,!1,b),e.uniform1i(f.uTexture,d.textures.textureIndex[c]),e.uniform1f(f.uTime,performance.now()),e.uniform2f(f.uResolution,d.width,d.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}bindBuffers(a,b){const c=this.renderer.gl,d=this.buffer.vertexByteSize,e=this.attribs;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a),c.bindBuffer(c.ARRAY_BUFFER,b),c.vertexAttribPointer(e.aVertexPosition,2,c.FLOAT,!1,d,0),c.vertexAttribPointer(e.aTextureCoord,2,c.FLOAT,!1,d,8),c.vertexAttribPointer(e.aTextureId,1,c.FLOAT,!1,d,16),c.vertexAttribPointer(e.aTintColor,4,c.UNSIGNED_BYTE,!0,d,20),this.count=0}draw(a){const b=this.renderer,c=b.gl,d=this.buffer;if(a===d.batchSize)c.bufferData(c.ARRAY_BUFFER,d.data,c.DYNAMIC_DRAW);else{const e=d.vertexViewF32.subarray(0,a*d.quadElementSize);c.bufferSubData(c.ARRAY_BUFFER,0,e)}this.renderToFBO&&b.fbo.add(this.framebuffer,!0),c.drawElements(c.TRIANGLES,a*d.quadIndexSize,c.UNSIGNED_SHORT,0),this.renderToFBO&&b.fbo.pop()}flush(){const a=this.count;return a===0?!1:(this.draw(a),this.prevCount=a,this.count=0,!0)}}const zl=`\r
#define SHADER_NAME MULTI_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture[%count%];\r
\r
void main (void)\r
{\r
    vec4 color;\r
\r
    %forloop%\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`;class ih extends dd{constructor(a={fragmentShader:zl}){super(a)}createShaders(a,b){const c=jc();let d="";for(let e=1;e<c;e++)e>1&&(d+=`
	else `),e<c-1&&(d+=`if (vTextureId < ${e}.5)`),d+=`
	{`,d+=`
		color = texture2D(uTexture[${e}], vTextureCoord);`,d+=`
	}`;a=a.replace(/%count%/gi,`${c}`),a=a.replace(/%forloop%/gi,d),super.createShaders(a,b)}bind(a,b){if(!this.program)return!1;const c=this.renderer,d=c.gl,e=this.uniforms;return d.useProgram(this.program),d.uniformMatrix4fv(e.uProjectionMatrix,!1,a),d.uniformMatrix4fv(e.uCameraMatrix,!1,b),d.uniform1iv(e.uTexture,c.textures.textureIndex),d.uniform1f(e.uTime,performance.now()),d.uniform2f(e.uResolution,c.width,c.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}}function jh(a,b,c=-1,d=1){const e=-2*(1/-a),f=-2*(1/b),g=2*(1/(c-d));return new Float32Array([e,0,0,0,0,f,0,0,0,0,g,0,-1,1,0,1])}class kh{constructor(a,b){this.renderer=a;const c={shader:new b()};this.stack=[c],this.currentEntry=c,this.current=c.shader,this.singleQuadShader=new dd()}add(a,b){const c={shader:a,textureID:b};return this.stack.push(c),c}set(a,b){this.flush();const c=this.renderer,d=c.projectionMatrix,e=c.currentCamera.matrix,f=a.bind(d,e,b);if(f){const g=this.add(a,b);this.currentEntry=g,this.current=a}return f}setDefault(a){this.set(this.singleQuadShader,a)}pop(){this.flush();const a=this.stack;a.length>1&&a.pop(),this.currentEntry=a[a.length-1],this.current=this.currentEntry.shader}reset(){this.pop(),this.rebind()}flush(){return this.current.flush()?(this.renderer.flushTotal++,!0):!1}rebind(){const a=this.renderer,b=a.projectionMatrix,c=a.currentCamera.matrix,d=this.currentEntry;d.shader.bind(b,c,d.textureID)}popAndRebind(){this.pop(),this.rebind()}clear(){}destroy(){}}const xl=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function yl(a){let b="";for(let c=0;c<a;++c)c>0&&(b+=`
else `),c<a-1&&(b+=`if(test == ${c}.0){}`);return b}function qh(a,b){const c=b.createShader(b.FRAGMENT_SHADER);for(;;){const d=xl.replace(/%forloop%/gi,yl(a));b.shaderSource(c,d),b.compileShader(c);if(!b.getShaderParameter(c,b.COMPILE_STATUS))a=a/2|0;else break}return a}class lh{constructor(a){this.startActiveTexture=0,this.renderer=a,this.tempTextures=[],this.textureIndex=[]}init(){const a=this.renderer.gl;let b=qh(a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),a);const c=jc();c===0||c>0&&c>b?Ie(b):c>0&&c<b&&(b=Math.max(8,c));const d=this.tempTextures;d.length&&d.forEach(f=>{a.deleteTexture(f)});const e=[];for(let f=0;f<b;f++){const g=a.createTexture();a.activeTexture(a.TEXTURE0+f),a.bindTexture(a.TEXTURE_2D,g),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),d[f]=g,e.push(f)}this.maxTextures=b,this.textureIndex=e,this.currentActiveTexture=1}update(){const a=Tb.get();for(let b=0;b<a.length;b++){const c=a[b];c.binding||(c.binding=new ed(c))}Tb.clear()}reset(){const a=this.renderer.gl,b=this.tempTextures;for(let c=0;c<b.length;c++)a.activeTexture(a.TEXTURE0+c),a.bindTexture(a.TEXTURE_2D,b[c]);this.currentActiveTexture=1,this.startActiveTexture++}bind(a,b=0){const c=this.renderer.gl,d=a.binding;d.setIndex(b),c.activeTexture(c.TEXTURE0+b),c.bindTexture(c.TEXTURE_2D,d.texture)}unbind(a=0){const b=this.renderer.gl;b.activeTexture(b.TEXTURE0+a),b.bindTexture(b.TEXTURE_2D,this.tempTextures[a]),a>0&&this.startActiveTexture++}request(a){const b=this.renderer.gl,c=a.binding,d=this.currentActiveTexture;return c.indexCounter>=this.startActiveTexture?!1:(c.indexCounter=this.startActiveTexture,d<this.maxTextures?(c.setIndex(d),b.activeTexture(b.TEXTURE0+d),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture++):(this.renderer.flush(),this.startActiveTexture++,c.indexCounter=this.startActiveTexture,c.setIndex(1),b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture=2),!0)}}class Ng{constructor(){this.clearColor=[0,0,0,1],this.flushTotal=0,this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.currentCamera=null,this.width=Pb(),this.height=Qb(),this.resolution=Rb(),this.setBackgroundColor(Qc());const a=document.createElement("canvas");a.addEventListener("webglcontextlost",b=>this.onContextLost(b),!1),a.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=a,this.fbo=new gh(this),this.textures=new lh(this),this.initContext(),oc.set(this),this.shaders=new kh(this,ih)}initContext(){const a=this.canvas.getContext("webgl",Ke());Aa.set(a),this.gl=a,a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE),this.resize(this.width,this.height,this.resolution),this.textures.init()}resize(a,b,c=1){this.width=a*c,this.height=b*c,this.resolution=c;const d=this.canvas;d.width=this.width,d.height=this.height,this.autoResize&&(d.style.width=(this.width/c).toString()+"px",d.style.height=(this.height/c).toString()+"px"),this.gl.viewport(0,0,this.width,this.height),this.projectionMatrix=jh(a,b)}onContextLost(a){a.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(a){return hh(a,this.clearColor),this}reset(a=null,b=this.width,c=this.height){const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),d.viewport(0,0,b,c),d.enable(d.BLEND),d.blendFunc(d.ONE,d.ONE_MINUS_SRC_ALPHA),this.flushTotal=0,this.currentCamera=null,this.textures.update()}render(a){if(this.contextLost)return;this.reset();if(this.optimizeRedraw&&a.numDirtyFrames===0&&a.numDirtyCameras===0)return;const b=this.gl;if(this.clearBeforeRender){const d=this.clearColor;b.clearColor(d[0],d[1],d[2],d[3]),b.clear(b.COLOR_BUFFER_BIT)}const c=a.worldData;for(let d=0;d<c.length;d++){const{camera:e,renderList:f}=c[d];(!this.currentCamera||!ch(e.worldTransform,this.currentCamera.worldTransform))&&(this.flush(),this.currentCamera=e,this.shaders.rebind()),f.forEach(g=>{g.children.length?this.renderNode(g):g.node.renderGL(this)})}this.flush()}renderNode(a){a.node.renderGL(this),a.children.forEach(b=>{b.children.length>0?this.renderNode(b):b.node.renderGL(this)}),a.node.postRenderGL(this)}flush(){this.shaders.flush()}destroy(){oc.set(void 0)}}function ze(){return()=>{Rc(Ng)}}function ya(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);for(const e of d)e.callback.apply(e.context,c),e.once&&d.delete(e);return d.size===0&&a.events.delete(b),!0}function ug(a,b){const c=Sc(b);return c.appendChild(a),a}function vg(a){const b=document.readyState;if(b==="complete"||b==="interactive"){a();return}const c=()=>{document.removeEventListener("deviceready",c,!0),document.removeEventListener("DOMContentLoaded",c,!0),window.removeEventListener("load",c,!0),a()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",c,!0):(document.addEventListener("DOMContentLoaded",c,!0),window.addEventListener("load",c,!0)):window.setTimeout(c,20)}class wg{constructor(){this.events=new Map()}}class Uc{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function Sb(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new Uc(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function Wc(a,b,c,d=a){return Sb(a,b,c,d,!0)}function uh(){return{gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]}}function xh(a,b=0){a.gameFrame=b,a.numTotalFrames=0,a.numDirtyFrames=0,a.numDirtyCameras=0,a.worldData.length=0}let yh;const gd={get:()=>yh,set:a=>{yh=a}};class xg{constructor(){this.scenes=new Map(),this.sceneIndex=0,this.flush=!1,this.renderResult=uh(),this.game=va.get(),gd.set(this),Wc(this.game,"boot",()=>this.boot())}boot(){Je().forEach(a=>new a())}update(a,b){for(const c of this.scenes.values())ya(c,"update",a,b)}render(a){const b=this.renderResult;xh(b,a);for(const c of this.scenes.values())ya(c,"render",b);return this.flush&&(b.numDirtyFrames++,this.flush=!1),b}}function qc(a,b){const c=document.createElement("canvas");return c.width=a,c.height=b,c.getContext("2d")}let zh;const kb={get:()=>zh,set:a=>{zh=a}};class yg{constructor(){this.textures=new Map(),this.createDefaultTextures(),kb.set(this)}createDefaultTextures(){this.add("__BLANK",new Ya(qc(32,32).canvas));const a=qc(32,32);a.strokeStyle="#0f0",a.moveTo(0,0),a.lineTo(32,32),a.stroke(),a.strokeRect(.5,.5,31,31),this.add("__MISSING",new Ya(a.canvas))}get(a){const b=this.textures;return b.has(a)?b.get(a):b.get("__MISSING")}has(a){return this.textures.has(a)}add(a,b){let c;const d=this.textures;return d.has(a)||(b instanceof Ya?c=b:c=new Ya(b),c.key=a,d.set(a,c)),c}}class mg extends wg{constructor(...a){super();this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,va.set(this),vg(()=>this.boot(a))}boot(a){a.forEach(d=>d());const b=De();this.renderer=new b(),this.textureManager=new yg(),this.sceneManager=new xg();const c=Ee();c&&ug(this.renderer.canvas,c),this.isBooted=!0,Ce(),ya(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(a){const b=a-this.lastTick;this.lastTick=a,this.elapsed+=b,this.isPaused||(this.willUpdate&&(this.sceneManager.update(b,a),ya(this,"update",b,a)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,va.setFrame(this.frame),va.setElapsed(this.elapsed),requestAnimationFrame(c=>this.step(c))}destroy(){}}function vh(a,b,c){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:c}function wh(a,b={}){const c=gd.get(),d=c.scenes.size,e=c.sceneIndex,f=d===0;typeof b==="string"?a.key=b:(b||!b&&f)&&(a.key=vh(b,"key","scene"+e.toString())),c.scenes.has(a.key)?console.warn("Scene key already in use: "+a.key):(c.scenes.set(a.key,a),c.flush=!0,c.sceneIndex++)}class ng{constructor(a){this.game=va.get(),this.events=new Map(),wh(this,a)}}class vb{constructor(a=1,b=0,c=0,d=1,e=0,f=0){this.set(a,b,c,d,e,f)}set(a=1,b=0,c=0,d=1,e=0,f=0){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=e,this.ty=f,this}identity(){return this.set()}toArray(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]}fromArray(a){return this.set(a[0],a[1],a[2],a[3],a[4],a[5])}}function ad(a,b,c){return a.width<=0||a.height<=0?!1:a.x<=b&&a.x+a.width>=b&&a.y<=c&&a.y+a.height>=c}class Fa{constructor(a=0,b=0,c=0,d=0){this.set(a,b,c,d)}set(a=0,b=0,c=0,d=0){return this.x=a,this.y=b,this.width=c,this.height=d,this}contains(a,b){return ad(this,a,b)}set right(a){a<=this.x?this.width=0:this.width=a-this.x}get right(){return this.x+this.width}set bottom(a){a<=this.y?this.height=0:this.height=a-this.y}get bottom(){return this.y+this.height}}function eh(){}class eb{constructor(a,b=0,c=0,d=!1){this.compareValue=!1,this._x=b,this._y=c,this.callback=a,this.compareValue=d}set(a=0,b=0){return this._x=a,this._y=b,this.callback(this),this}destroy(){this.callback=eh}set x(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._x=a,this.callback(this))}get x(){return this._x}set y(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._y=a,this.callback(this))}get y(){return this._y}}function bh(a,b,c){const d=c-b;return b+((a-b)%d+d)%d}function Cg(a){return bh(a,-Math.PI,Math.PI)}class Dg{constructor(){this._rotation=0,this.type="Camera",this.dirtyRender=!0;const a=va.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1]),this.bounds=new Fa(),this.worldTransform=new vb(),this.position=new eb(()=>this.updateTransform(),0,0),this.scale=new eb(()=>this.updateTransform(),1,1),this.origin=new eb(()=>this.updateTransform(),.5,.5),this.reset()}updateTransform(){const a=this.matrix,b=this.position.x,c=this.position.y,d=this.scale.x,e=this.scale.y,f=-b+this.width*this.origin.x,g=-c+this.height*this.origin.y,j=Math.sin(this.rotation),i=Math.cos(this.rotation),m=j+j,n=j*m,u=i*m,w=(1-n)*d,B=u*d,C=-u*e,G=(1-n)*e;a[0]=w,a[1]=B,a[4]=C,a[5]=G,a[12]=b+f-(w*f+C*g),a[13]=c+g-(B*f+G*g),this.worldTransform.set(i*d,j*d,-j*e,i*e,-b,-c);const I=this.width*(1/d),L=this.height*(1/e);this.bounds.set(f-I/2,g-L/2,I,L),this.dirtyRender=!0}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}set rotation(a){a!==this._rotation&&(this._rotation=Cg(a),this.updateTransform())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.origin.destroy(),this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}class Eg{constructor(){this.type="StaticCamera",this.dirtyRender=!0;const a=va.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.bounds=new Fa(),this.worldTransform=new vb(),this.reset()}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}function xb(a){const b=[a],c=[];for(;b.length>0;){const d=b.shift();c.push(d);const e=d.numChildren;if(e>0)for(let f=e-1;f>=0;f--)b.unshift(d.children[f])}return c.shift(),c}function fb(a,b){return a.children.indexOf(b)}function Tc(a,b){const c=a.children;let d;if(b>=0&&b<c.length){const e=c.splice(b,1);e[0]&&(d=e[0],d.parent=null)}return d}function lc(a,b){const c=fb(a,b);return c>-1&&Tc(a,c),b}const Pe="addedtoworld";const Xc="destroy";const Ug="postupdate";const Qe="removedfromworld";const Vg="update";function Oe(a,...b){return b.forEach(c=>{c.world&&(ya(c.world,Qe,c,c.world),ya(c,Qe,c,c.world)),c.world=a,ya(a,Pe,c,a),ya(c,Pe,c,a)}),b}function wb(a,...b){b.forEach(d=>{d.parent&&lc(d.parent,d),d.parent=a});const c=a.world;return c&&Oe(c,...xb(a)),b}const aa={CLEAR:0,TRANSFORM:1,UPDATE:2,CHILD_CACHE:4,POST_RENDER:8,COLORS:16,BOUNDS:32,TEXTURE:64,FRAME:128,ALPHA:256,CHILD:512,DEFAULT:1+2+16+32,USER1:536870912,USER2:1073741824,USER3:2147483648,USER4:4294967296};function kc(a,b=0,c){const d=a.children;c===void 0&&(c=d.length);const e=c-b;if(e>0&&e<=c){const f=d.splice(b,e);return f.forEach(g=>{g.parent=null}),f}else return[]}function Le(a,b=0,c){const d=kc(a,b,c);d.forEach(e=>{e.destroy()})}function Me(a,...b){return b.forEach(c=>{lc(a,c)}),b}function Ne(a,b,c=0,d){const e=kc(a,c,d);return wb(b,...e),e.forEach(f=>{f.transform.updateWorld()}),e}function Vc(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof Uc)g.delete(c);else{const j=!d,i=e!==void 0;for(const m of g)m.callback===c&&(j&&m.context===d)&&(i&&m.once===e)&&g.delete(m)}return g.size===0&&f.delete(b),a}function Zc(a){const{a:b,b:c,c:d,d:e,tx:f,ty:g}=a.world,{x:j,y:i,right:m,bottom:n}=a.extent,u=j*b+i*d+f,w=j*c+i*e+g,B=j*b+n*d+f,C=j*c+n*e+g,G=m*b+n*d+f,I=m*c+n*e+g,L=m*b+i*d+f,R=m*c+i*e+g;return{x0:u,y0:w,x1:B,y1:C,x2:G,y2:I,x3:L,y3:R}}class Og{constructor(a){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=a,this.area=new Fa()}set(a,b,c,d){this.area.set(a,b,c,d)}get(){return this.entity.isDirty(aa.BOUNDS)&&!this.fixed&&this.update(),this.area}updateLocal(){const{x0:a,y0:b,x1:c,y1:d,x2:e,y2:f,x3:g,y3:j}=Zc(this.entity.transform),i=Math.min(a,c,e,g),m=Math.min(b,d,f,j),n=Math.max(a,c,e,g),u=Math.max(b,d,f,j);return this.area.set(i,m,n-i,u-m)}update(){const a=this.updateLocal();this.entity.clearDirty(aa.BOUNDS);if(!this.includeChildren||!this.entity.numChildren)return a;const b=this.visibleOnly,c=this.entity.children;let d=a.x,e=a.y,f=a.right,g=a.bottom;for(let j=0;j<c.length;j++){const i=c[j];if(!i||b&&!i.visible)continue;const m=i.bounds.get();m.x<d&&(d=m.x),m.y<e&&(e=m.y),m.right>f&&(f=m.right),m.bottom>g&&(g=m.bottom)}return a.set(d,e,f-d,g-e)}destroy(){this.entity=null,this.area=null}}class Pg{constructor(a){this.enabled=!1,this.enabledChildren=!0,this.entity=a}destroy(){this.entity=null,this.hitArea=null}}class Xa{constructor(a=0,b=0){this.set(a,b)}set(a=0,b=0){return this.x=a,this.y=b,this}getArray(){return[this.x,this.y]}fromArray(a){return this.set(a[0],a[1])}toString(){return`[x=${this.x}, y=${this.y}]`}}function Rg(a){const b=a.local,c=a.position.x,d=a.position.y,e=a.rotation,f=a.scale.x,g=a.scale.y,j=a.skew.x,i=a.skew.y;b.set(Math.cos(e+i)*f,Math.sin(e+i)*f,-Math.sin(e-j)*g,Math.cos(e-j)*g,c,d)}function Re(a,b){return b.set(a.a,a.b,a.c,a.d,a.tx,a.ty)}function Sg(a){const b=a.parent,c=a.transform,d=c.local,e=c.world;if(!b)Re(d,e);else if(c.passthru)Re(b.transform.world,e);else{const{a:f,b:g,c:j,d:i,tx:m,ty:n}=d,{a:u,b:w,c:B,d:C,tx:G,ty:I}=b.transform.world;e.set(f*u+g*B,f*w+g*C,j*u+i*B,j*w+i*C,m*u+n*B+G,m*w+n*C+I)}}class Qg{constructor(a,b=0,c=0){this.passthru=!1,this._rotation=0,this.entity=a,this.local=new vb(),this.world=new vb(),this.position=new eb(()=>this.update(),b,c),this.scale=new eb(()=>this.update(),1,1,!0),this.skew=new eb(()=>this.update(),0,0,!0),this.origin=new eb(()=>this.updateExtent(),Ge,He),this.extent=new Fa()}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(aa.TRANSFORM,aa.BOUNDS),Rg(this)}updateWorld(){const a=this.entity;a.setDirty(aa.TRANSFORM,aa.BOUNDS),Sg(a),a.numChildren&&this.updateChildren()}updateChildren(){const a=this.entity.children;for(let b=0;b<a.length;b++){const c=a[b];c.transform.updateWorld()}}globalToLocal(a,b,c=new Xa()){const{a:d,b:e,c:f,d:g,tx:j,ty:i}=this.world,m=1/(d*g+f*-e);return c.x=g*m*a+-f*m*b+(i*f-j*g)*m,c.y=d*m*b+-e*m*a+(-i*d+j*e)*m,c}localToGlobal(a,b,c=new Xa()){const{a:d,b:e,c:f,d:g,tx:j,ty:i}=this.world;return c.x=d*a+f*b+j,c.y=e*a+g*b+i,c}setExtent(a,b,c,d){this.extent.set(a,b,c,d),this.entity.setDirty(aa.TRANSFORM,aa.BOUNDS)}updateExtent(a,b){const c=this.extent,d=this.entity;a!==void 0&&(c.width=a),b!==void 0&&(c.height=b),c.x=-this.origin.x*c.width,c.y=-this.origin.y*c.height,d.setDirty(aa.TRANSFORM,aa.BOUNDS)}set rotation(a){a!==this._rotation&&(this._rotation=a,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}}class Yc{constructor(a=0,b=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.events=new Map(),this.transform=new Qg(this,a,b),this.bounds=new Og(this),this.input=new Pg(this),this.dirty=aa.DEFAULT,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(a){return(this.dirty&a)!==0}clearDirty(a){return this.isDirty(a)&&(this.dirty^=a),this}setDirty(a,b){return this.isDirty(a)||(this.dirty^=a,this.dirtyFrame=va.getFrame()),this.isDirty(b)||(this.dirty^=b),this}update(a,b){if(this.willUpdateChildren){const c=this.children;for(let d=0;d<c.length;d++){const e=c[d];e&&e.willUpdate&&e.update(a,b)}}this.postUpdate(a,b)}postUpdate(a,b){}renderGL(a){}renderCanvas(a){}postRenderGL(a){}postRenderCanvas(a){}get numChildren(){return this.children.length}destroy(a){a?Ne(this,a):Le(this),ya(this,Xc,this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}}const bd="worldrender";const cd="worldshutdown";var wl=Object.freeze({__proto__:null,WorldRenderEvent:bd,WorldShutdownEvent:cd});function hd(a,b){b.numRendered++,b.numRenderable++,a.node.dirtyFrame>=b.gameFrame&&b.dirtyFrame++,a.children.forEach(c=>{c.children.length>0&&hd(c,b)})}function Ze(a){if(a.node.isDirty(aa.CHILD_CACHE))return!0;const b=[a];for(;b.length>0;){const c=b.pop();if(c.node.isDirty(aa.TRANSFORM))return!0;const d=c.children.length;if(d>0)for(let e=0;e<d;e++)b.push(c.children[e])}return b.length=0,!1}function Ye(a,b){a.forEach(c=>{b||Ze(c)?c.node.setDirty(aa.CHILD_CACHE):c.children.length=0})}function id(a,b,c=[]){for(let d=0;d<b.numChildren;d++){const e=b.children[d];if(e.isRenderable()){const f=[],g={node:e,children:f};c.push(g),e.willRenderChildren&&e.numChildren>0&&(e.willCacheChildren&&a.push(g),id(a,e,f))}}return c}function We(a){const b=[],c=[],d=id(b,a,c),e=a.renderData;b.length>0&&Ye(b,a.camera.dirtyRender),d.forEach(f=>{f.children.length?hd(f,e):(e.numRendered++,e.numRenderable++,f.node.dirtyFrame>=e.gameFrame&&e.dirtyFrame++)}),e.renderList=d,a.forceRefresh&&(e.dirtyFrame++,a.forceRefresh=!1)}function Xe(a,b){a.numDirtyFrames+=b.dirtyFrame,a.numTotalFrames+=b.numRendered,b.camera.dirtyRender&&a.numDirtyCameras++,a.worldData.push(b)}function rc(a,b){a.gameFrame=b,a.dirtyFrame=0,a.numRendered=0,a.numRenderable=0,a.renderList.length=0}class sc extends Yc{constructor(a){super();this.forceRefresh=!1,this.type="BaseWorld",this.scene=a,this.world=this,this.events=new Map(),this._updateListener=Sb(a,"update",(b,c)=>this.update(b,c)),this._renderListener=Sb(a,"render",b=>this.render(b)),this._shutdownListener=Sb(a,"shutdown",()=>this.shutdown()),Wc(a,"destroy",()=>this.destroy())}update(a,b){if(!this.willUpdate)return;ya(this,Vg,a,b,this),super.update(a,b)}postUpdate(a,b){ya(this,Ug,a,b,this)}render(a){const b=this.renderData;rc(b,a.gameFrame);if(!this.willRender||!this.visible)return;We(this),ya(this,bd,b,this),Xe(a,b),this.camera&&(this.camera.dirtyRender=!1)}shutdown(){const a=this.scene;Vc(a,"update",this._updateListener),Vc(a,"render",this._renderListener),Vc(a,"shutdown",this._shutdownListener),Me(this),ya(this,cd,this),rc(this.renderData,0),this.camera&&this.camera.reset()}destroy(a){super.destroy(a),ya(this,Xc,this),rc(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}}function tc(a){return{camera:a,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0,renderList:[]}}class Ae extends sc{constructor(a){super(a);this.type="StaticWorld",this.camera=new Eg(),this.renderData=tc(this.camera)}}class Al extends sc{constructor(a){super(a);this.enableCameraCull=!0,this.type="World",this.camera=new Dg(),this.renderData=tc(this.camera)}}function Oc(a,b){return a.children.push(b),wb(a,b),b.transform.updateWorld(),b}var cg;(function(a){a[a.IDLE=0]="IDLE",a[a.UPDATING=1]="UPDATING"})(cg||(cg={}));function Qa(a,b){return a===void 0||b===void 0?void 0:`${a}|${b}`}function Ci(a,b){let c=a.split("|");return b===void 0&&(b=xm),b.x=parseInt(c[0]),b.y=parseInt(c[1]),b}let xm={x:0,y:0};class Mb{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(a){return this.items.push(a),this}pushMultiple(a){return this.items.push.apply(this.items,a),a.length=0,this}clear(){return this.items.length=0,this}}let fl=new Mb();function Kh(){let a=fl.pop();return a===null&&(a=new Map()),a}function Bd(a){fl.push(a)}function Ih(a,b,c,d,e,f,g,j){if(c===f&&d===g&&e===j)return;let i=Qa(c,d),m=Qa(f,g);if(i){let n=b.get(i);n.delete(e);if(i===m){n.set(j,a);return}else n.size===0&&(Bd(n),b.delete(i))}if(m){let n=b.get(m);n?n.set(j,a):(n=Kh(),n.set(j,a),b.set(m,n))}}function rf(a,b,c,d){let e=Qa(b,c),f=a.get(e);f&&(d!==void 0?(f.delete(d),f.size===0&&(Bd(f),a.delete(e))):(f.clear(),Bd(f),a.delete(e)))}let gl=new Mb();function Jh(){let a=gl.pop();return a===null&&(a=new Set()),a}function qf(a){gl.push(a)}function Ad(a,b,c,d){if(c===d)return;if(c!==void 0){let e=b.get(c);e&&(e.delete(a),e.size===0&&(qf(e),b.delete(c)))}if(d!==void 0){let e=b.get(d);e?e.add(a):(e=Jh(),e.add(a),b.set(d,e))}}function Bb(a,b,c){let d=a.get(b);d&&(d.delete(c),d.size===0&&(qf(d),a.delete(b)))}function Dh(a,b,c,d,e){let f=a.chessToXYZ.get(b),g=f?f.x:void 0,j=f?f.y:void 0,i=f?f.y:void 0;f?(f.x=c,f.y=d,f.z=e):a.chessToXYZ.set(b,{x:c,y:d,z:e}),Ih(b,a.XYToZMap,g,j,i,c,d,e),Ad(b,a.XToChessSet,g,c),Ad(b,a.YToChessSet,j,d),Ad(b,a.ZToChessSet,i,e)}function Ab(a,b,c,d){let e=a.XYToZMap.get(Qa(b,c));return e===void 0?null:d!==void 0?e.has(d)?e.get(d):null:e}function Eh(a,b,c,d){if(d!==void 0){let e=Ab(a,b,c,d);if(e===void 0)return;a.chessToXYZ.delete(e),rf(a.XYToZMap,b,c,d),Bb(a.XToChessSet,b,e),Bb(a.YToChessSet,c,e),Bb(a.ZToChessSet,d,e)}else{let e=Ab(a,b,c);if(e){for(const[f,g]of e)a.chessToXYZ.delete(g),Bb(a.XToChessSet,b,g),Bb(a.YToChessSet,c,g),Bb(a.ZToChessSet,f,g);rf(a.XYToZMap,b,c)}}}function Fh(a,b){return a.chessToXYZ.has(b)}function Gh(a,b,c,d){return Ab(a,b,c,d)!==null}function Hh(a,b){return a.chessToXYZ.get(b)||null}function of(a){let b=-Infinity;for(const[c,d]of a)b<c&&(b=c);return b}function pf(a){let b=Infinity;for(const[c,d]of a)b>c&&(b=c);return b}class _e{constructor(){this.chessToXYZ=new Map(),this.XYToZMap=new Map(),this.XToChessSet=new Map(),this.YToChessSet=new Map(),this.ZToChessSet=new Map(),this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0}destroy(){this.clear()}clear(){return this.chessToXYZ.clear(),this.XYToZMap.clear(),this.XToChessSet.clear(),this.YToChessSet.clear(),this.ZToChessSet.clear(),this.clearBounds(),this}clearBounds(){return this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0,this}addChess(a,b,c,d){return Dh(this,a,b,c,d),this.clearBounds(),this}getChess(a,b,c){return Ab(this,a,b,c)}removeChess(a,b,c){return Eh(this,a,b,c),this.clearBounds(),this}hasChess(a){return Fh(this,a)}contains(a,b,c){return Gh(this,a,b,c)}getXYZ(a){return Hh(this,a)}get xMax(){return this._xMax===void 0&&(this._xMax=of(this.XToChessSet)),this._xMax}get xMin(){return this._xMin===void 0&&(this._xMin=pf(this.XToChessSet)),this._xMin}get yMax(){return this._yMax===void 0&&(this._yMax=of(this.YToChessSet)),this._yMax}get yMin(){return this._yMin===void 0&&(this._yMin=pf(this.YToChessSet)),this._yMin}}function Za(a,b=[]){let c=a.boardData.chessToXYZ;for(const[d,e]of c)b.push(d);return b}function Di(a){if(typeof a!=="object"||a.nodeType||a===a.window)return!1;try{if(a.constructor&&!{}.hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0}function yc(a){return Di(a)?!0:typeof a==="object"?a.isTileXYZ:!1}function ba(a,b){let c=a.boardData.getXYZ(b);return c?c:yc(b)?b:null}function qa(a,b,c,d){return a.boardData.getChess(b,c,d)}class Lh{constructor(a){this.parent=a,this.board=null,this.blocker=!1,this.boot()}boot(){typeof this.parent==="object"&&this.parent.on&&this.parent.on("destroy",this.destroy,this)}destroy(){if(this.board){let a=this.tileXYZ;this.board.boardData.removeChess(a.x,a.y,a.z)}this.parent=void 0,this.board=null}setBoard(a){return this.board=a,this}get tileXYZ(){return this.board==null?null:this.board.boardData.getXYZ(this.parent)}setBlocker(a=!0){return this.blocker=a,this}setBlockEdge(a,b=!0){typeof this.blocker==="boolean"&&(this.blocker={});let c=this.blocker;if(typeof a==="object"){let d=a;for(let e in d)c[e]=d[e]}else c[a]=b;return this}getBlockEdge(a){return typeof this.blocker==="boolean"?!1:this.blocker.hasOwnProperty(a)?this.blocker[a]:!1}}function Sa(a){return a.hasOwnProperty("rexChess")||(a.rexChess=new Lh(a)),a.rexChess}function La(a,b,c,d,e,f=!1,g=!1){if(b){let j=ba(a,b);if(j)c=j.x,d=j.y,e=j.z;else return}else{b=qa(a,c,d,e);if(!b)return}g||a.boardData.removeChess(c,d,e),a._isBoard&&Sa(b).setBoard(null),f&&b.destroy&&b.destroy()}function zb(a,b){if(a.infinityMode)return;if(a.height===void 0||a.height<=b){a.height=b;return}let c=Za(a);c.forEach(d=>{let e=ba(a,d);e.y>b&&La(a,d)}),a.height=b}function yb(a,b){if(a.infinityMode)return;if(a.width===void 0||a.width<=b){a.width=b;return}let c=Za(a);c.forEach(d=>{let e=ba(a,d);e.x>b&&La(a,d)}),a.width=b}class jd{constructor({grid:a=void 0,wrap:b=!1,inifinity:c=!1,width:d=0,height:e=0}={}){this.boardData=new _e(),this._isBoard=!0,this.setGrid(a),this.setWrapMode(b),this.setInfinityMode(c),this.setBoardSize(d,e)}destroy(){}setGrid(a){return this.grid=a,this}setWrapMode(a=!0){return this.wrapMode=a,this}setInfinityMode(a=!0){return this.infinityMode=a,this}setBoardSize(a=0,b=0){return yb(this,a),zb(this,b),this}}function Ra(a,b,c,d){let e;return a.infinityMode?e=!0:e=b>=0&&b<a.width&&c>=0&&c<a.height,e&&d!==void 0&&(e=a.boardData.contains(b,c,d)),e}function Da(a,b,c,d){return a.grid.getWorldXY(b,c,d)}function _b(a,b,c,d){if(b===void 0){let e=Za(a);for(let f=0,g=e.length;f<g;f++){let j=e[f],i=ba(a,j);Da(a,i.x,i.y,j)}}else{if(c===void 0){let e=ba(a,b);c=e.x,d=e.y}Da(a,c,d,b)}}function lb(a,b,c,d,e,f=!0){if(!Ra(a,c,d))return;let g=ba(a,b);e===void 0&&(g?e=g.z:e=0);if(g&&g.x===c&&g.y===d&&g.z===e)return;let j=qa(a,c,d,e);j&&La(a,null,c,d,e),a.boardData.addChess(b,c,d,e),a._isBoard&&Sa(b).setBoard(a),f&&_b(a,b,c,d)}function Fb(a,b,c,d){return Math.atan2(d-b,c-a)}function mb(a,b,c){let d=ba(a,b),e=ba(a,c),f=Da(a,d.x,d.y,!0),g=f.x,j=f.y;f=Da(a,e.x,e.y,!0);let i=f.x,m=f.y;return Fb(g,j,i,m)}function gb(a,b,c){let d=c-b;return b+((a-b)%d+d)%d}function Zb(a,b,c,d={x:0,y:0}){return d===!0&&(d=Gl),a.wrapMode?b=gb(b,0,a.width):!a.infinityMode&&(b<0||b>=a.width)&&(b=null),a.wrapMode?c=gb(c,0,a.height):!a.infinityMode&&(c<0||c>=a.height)&&(c=null),d.x=b,d.y=c,d}let Gl={x:0,y:0};function Ka(a,b,c,d,e){let f=ba(a,b);if(f===null)return null;typeof c==="string"&&(c.indexOf(",")===-1?c=parseInt(c):c=c.split(".").map(m=>parseInt(m,10)));let g=typeof c==="number",j=typeof d==="number";if(g&&j){let m=a.grid.getTileXYAtDirection(f,c,d,e);return Zb(a,m.x,m.y,m),(m.x===null||m.y===null)&&(m=null),m}Array.isArray(e)||(e=[]),c===null&&(c=a.grid.allDirections);let i;if(g)if(Array.isArray(d))for(let m=0,n=d.length;m<n;m++)i=Ka(a,f,c,d[m]),i!==null&&e.push(i);else{let m,n,u;({end:m=1,start:n=m>0?1:-1,step:u=m>=n?1:-1}=d);if(n===m)i=Ka(a,f,c,m),i!==null&&e.push(i);else if(n<m)for(let w=n;w<=m;w+=u)i=Ka(a,f,c,w),i!==null&&e.push(i);else for(let w=n;w>=m;w+=u)i=Ka(a,f,c,w),i!==null&&e.push(i)}else for(let m=0,n=c.length;m<n;m++)j?(i=Ka(a,f,c[m],d),i!==null&&e.push(i)):Ka(a,f,c[m],d,e);return e}function bb(a,b,c=null,d={x:0,y:0}){return Ka(a,b,c,1,d)}function Wb(a,b,c){b===void 0&&(b=Kl);let d=a.wrapMode,e=a.infinityMode;a.wrapMode=!1,a.infinityMode=!0;let f=bb(a,b,c,!0);return a.wrapMode=d,a.infinityMode=e,mb(a,b,f)}let Kl={x:0,y:0};const Mn=180/Math.PI;function bc(a){return a*Mn}function Ph(a,b){let c=b-a;if(c===0)return 0;let d=Math.floor((c- -180)/360);return c-d*360}function Vb(a,b,c){c=bc(c);let d=a.grid.allDirections,e=Infinity,f;for(let g=0,j=d.length;g<j;g++){let i=bc(Wb(a,b,d[g])),m=Math.abs(Ph(c,i));m<e&&(e=m,f=g)}return f}function Yb(a,b,c){if(b===null||c===null)return null;if(b.x===c.x&&b.y===c.y)return null;let d=a.grid.getNeighborTileDirection(b,c);if(a.wrapMode&&d===null){let e=bb(a,b,null);for(let f=0,g=e.length;f<g;f++){let j=e[f];if(c.x===j.x&&c.y===j.y){d=f;break}}}return d}function Xb(a,b,c){let d=ba(a,b),e=ba(a,c);return Yb(a,d,e)}function ld(a,b,c){return Xb(a,b,c)!==null}function md(a,b,c,d=!0){let e=ba(a,b),f=ba(a,c);return e===null||f===null?null:a.grid.directionBetween(e,f,d)}function vc(a,b,c=1,d=[]){let e=a.grid.ringToTileXYArray(b,c);for(let f=0,g=e.length;f<g;f++){let j=e[f];Ra(a,j.x,j.y)&&d.push(j)}return d}function $e(a,b,c,d=!0,e=[]){for(let f=0;f<=c;f++){let g=d?f:c-f;vc(a,b,g,e)}return e}function _a(a,b,c,d,e={x:0,y:0}){return e===!0&&(e=Il),c===0&&d===0?(e.x=b.x,e.y=b.y):a.grid.offset(b,c,d,e),e}let Il={x:0,y:0};function af(a,b){let c=Infinity,d=Infinity,e;for(let j=0,i=b.length;j<i;j++)e=b[j],c=Math.min(c,e.x),d=Math.min(d,e.y);if(c!==0||d!==0)for(let j=0,i=b.length;j<i;j++)e=b[j],_a(a,e,-c,-d,e);let f=-Infinity,g=-Infinity;for(let j=0,i=b.length;j<i;j++)e=b[j],f=Math.max(f,e.x),g=Math.max(g,e.y);return yb(a,f+1),zb(a,g+1),b}var Db;(function(a){a[a["x+,y+"]=0]="x+,y+",a[a["x-,y+"]=1]="x-,y+",a[a["y+,x+"]=2]="y+,x+",a[a["y-,x+"]=3]="y-,x+"})(Db||(Db={}));function nd(a,b,c,d=0){let e={x:0,y:0};switch(d){case 0:for(let f=0;f<a.height;f++)for(let g=0;g<a.width;g++)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 1:for(let f=0;f<a.height;f++)for(let g=a.width-1;g>=0;g--)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 2:for(let f=0;f<a.width;f++)for(let g=0;g<a.height;g++)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a);break;case 3:for(let f=0;f<a.width;f++)for(let g=a.height-1;g>=0;g--)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a)}}function od(a,b,c,d){return a.grid.getDistance(b,c,d)}function uc(a,b=0,c=[]){if(Array.isArray(b)){let d=b;for(let e=0;e<a.height;e++)for(let f=0;f<a.width;f++){let g=!0;for(let j=0,i=d.length;j<i;j++)if(qa(a,f,e,d[j])!==null){g=!1;break}g&&c.push({x:f,y:e})}}else for(let d=0;d<a.height;d++)for(let e=0;e<a.width;e++)qa(a,e,d,b)===null&&c.push({x:e,y:d});return c}function pd(a,b,c,d){return a.grid.getGridPoints(b,c,d)}function Ma(a,b,c,d=[]){let e=a.boardData.getChess(b,c);for(const[f,g]of e)d.push(g);return d}function $b(a,b,c,d=[]){let e=c!=null,f,g;for(let j=0,i=b.length;j<i;j++)f=b[j],e?(g=qa(a,f.x,f.y,c),g!==null&&d.push(g)):Ma(a,f.x,f.y,d);return d}function qd(a,b,c,d,e){let f=ba(a,b);if(f===null)return null;d==null&&(d=f.hasOwnProperty("z")?f.z:null);let g=bb(a,f,c,!0);return g===null?null:Array.isArray(g)?(e===void 0&&(e=[]),$b(a,g,d,e)):d==null?(e===void 0&&(e=[]),Ma(a,g.x,g.y,e)):qa(a,g.x,g.y,d)}function rd(a,b,c,d={x:0,y:0}){let e=Vb(a,b,c);return Ka(a,b,e,1,d)}function sd(a,b,c,d){return a.grid.getOppositeDirection(b,c,d)}function wc(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function ac(a,b=0,c=a.length){let d=b+Math.floor(Math.random()*c);return a[d]===void 0?null:a[d]}function bf(a,b=0,c={x:0,y:0}){c===!0&&(c=Dl);let d=Math.floor(a.width*a.height*.3);for(let f=0;f<d;f++){let g=wc(0,a.width-1),j=wc(0,a.height-1);if(qa(a,g,j,b)===null)return c.x=g,c.y=j,c}let e=uc(a,b);if(e.length===0)return null;{let f=ac(e);return c.x=f.x,c.y=f.y,c}}let Dl={x:0,y:0};function cf(a,b,c,d){if(d===void 0){let e=Ma(a,b,c);for(let f=0,g=e.length;f<g;f++){let j=Sa(e[f]).blocker;if(j===!0)return!0}return!1}else{let e=qa(a,b,c,d);if(e===null)return!1;let f=Sa(e).blocker;return f===!0}}function df(a,b){return a.boardData.chessToXYZ.has(b)}function ef(a,b,c,d,e){if(d===void 0){let f=Ma(a,b,c);for(let g=0,j=f.length;g<j;g++)if(Ch(Sa(f[g]).blocker,e))return!0;return!1}else{let f=qa(a,b,c,d);return f===null?!1:Ch(Sa(f).blocker,e)}}function Ch(a,b){return a===!1||a===!0?a:a[b]===!0}function tf(a){return a=a%bl,a>=0?a:a+bl}const bl=Math.PI*2;function Qh(a,b,c=1e-4){return Math.abs(a-b)<c}function td(a,b,c,d,e){let f=ba(a,b),g=ba(a,c),j=mb(a,f,g);j=tf(j);let i=Math.abs(j-d);i=Math.min(i,Ll-i);let m=e/2;return Qh(i,m)||i<m}const Ll=Math.PI*2;function ud(a,b,c,d,e){let f=ba(a,b),g=ba(a,c),j=a.grid.directions;a.grid.directions=a.grid.sides;let i=a.grid.directionBetween(f,g,!1);a.grid.directions=j;let m=Math.abs(i-d);return m=Math.min(m,a.grid.directions-m),m<=e/2}function Ga(a,b,c,d={x:0,y:0}){return a.grid.getTileXY(b,c,d)}function vd(a,b,c,d){if(a.infinityMode&&d===void 0)return!0;let e=Ga(a,b,c,!0);return Ra(a,e.x,e.y,d)}function Oh(a,b,c,d){let e=a-c,f=b-d;return Math.sqrt(e*e+f*f)}function sf(a,b,c){return(b-a)*c+a}function ff(a,b,c,d,e,f=[]){let g=Oh(b,c,d,e),j=Math.min(a.grid.width,a.grid.height),i=Math.ceil(g/(j/4)),m;for(let n=0;n<=i;n++){let u=n/i,w=sf(b,d,u),B=sf(c,e,u),C=Ga(a,w,B);if(!Ra(a,C.x,C.y))continue;if(m&&m.x===C.x&&m.y===C.y)continue;f.push(C),m=C}return f}var Eb;(function(a){a[a.x=1]="x",a[a.horizontal=1]="horizontal",a[a.h=1]="h",a[a.y=2]="y",a[a.vertical=2]="vertical",a[a.v=2]="v",a[a.xy=3]="xy"})(Eb||(Eb={}));function gf(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=Hl),d!==null?_a(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.mirror(e,c,e),d!==null&&_a(a,e,d.x,d.y,e),e}let Hl={x:0,y:0};function hf(a,b=!1,c=!1){let d=Za(a);for(let e=0,f=d.length;e<f;e++)La(a,d[e],void 0,void 0,void 0,b,c)}function jf(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=Jl),d!==null?_a(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.rotate(e,c,e),d!==null&&_a(a,e,d.x,d.y,e),e}let Jl={x:0,y:0};function kf(a,b,c){let d=ba(a,b);if(d===null)return;lb(a,b,d.x,d.y,c)}function xc(a,b,c){return Math.max(b,Math.min(c,a))}function lf(a,b,c,d=[]){let e=Ga(a,b.left,b.top,!0),f=e.x-1,g=e.y-1,j=Ga(a,b.right,b.bottom,!0),i=j.x+1,m=j.y+1;a.infinityMode||(f=xc(f,0,a.width-1),g=xc(g,0,a.height-1),i=xc(i,0,a.width-1),m=xc(m,0,a.height-1));for(let n=f;n<=i;n++)for(let u=g;u<=m;u++){let w=Da(a,n,u,!0);c(b,w.x,w.y)&&d.push({x:n,y:u})}return d}function mf(a,b,c,d=!0){let e=ba(a,b),f=ba(a,c);if(e==null||f==null)return;La(a,b),La(a,c),lb(a,b,f.x,f.y,f.z,d),lb(a,c,e.x,e.y,e.z,d)}function wd(a,b,c=[]){let d=a.boardData.ZToChessSet.get(b);if(d)for(const e of d)c.push(e);return c}function xd(a,b,c=[]){for(let d=0,e=b.length;d<e;d++){let f=b[d];c.push(Da(a,f.x,f.y))}return c}function yd(a,b,c,d={x:0,y:0}){return d===!0&&(d=Ml),Ga(a,b,c,d),Da(a,d.x,d.y,d),d}let Ml={x:0,y:0};function zd(a,b,c,d,e){let f=Ga(a,b,c,!0);return d!==void 0?qa(a,f.x,f.y,d):Ma(a,f.x,f.y,e)}class kd extends jd{addChess(a,b,c,d,e=!0){return lb(this,a,b,c,d,e),this}angleBetween(a,b){return mb(this,a,b)}angleSnapToDirection(a,b){return Vb(this,a,b)}angleToward(a,b){return Wb(this,a,b)}areNeighbors(a,b){return ld(this,a,b)}chessToTileXYZ(a){return ba(this,a)}contains(a,b,c){return Ra(this,a,b,c)}directionBetween(a,b,c=!0){return md(this,a,b,c)}filledRingToTileXYArray(a,b,c=!0,d=[]){return $e(this,a,b,c,d)}fit(a){return af(this,a)}forEachTileXY(a,b,c=0){return nd(this,a,b,c),this}getAllChess(a=[]){return Za(this,a)}getChessData(a){return Sa(a)}getDistance(a,b,c=!1){return od(this,a,b,c)}getEmptyTileXYArray(a=0,b=[]){return uc(this,a,b)}getGridPoints(a,b,c){return pd(this,a,b,c)}getNeighborChess(a,b,c,d){return qd(this,a,b,c,d)}getNeighborChessDirection(a,b){return Xb(this,a,b)}getNeighborTileDirection(a,b){return Yb(this,a,b)}getNeighborTileXY(a,b=null,c={x:0,y:0}){return bb(this,a,b,c)}getNeighborTileXYAtAngle(a,b,c={x:0,y:0}){return rd(this,a,b,c)}getOppositeDirection(a,b,c){return sd(this,a,b,c)}getRandomEmptyTileXY(a=0,b={x:0,y:0}){return bf(this,a,b)}getTileXYAtDirection(a,b,c,d){return Ka(this,a,b,c,d)}getWrapTileXY(a,b,c={x:0,y:0}){return Zb(this,a,b,c)}gridAlign(a,b,c){return _b(this,a,b,c),this}hasBlocker(a,b,c){return cf(this,a,b,c)}hasChess(a){return df(this,a)}hasEdgeBlocker(a,b,c,d){return ef(this,a,b,c,d)}isAngleInCone(a,b,c,d){return td(this,a,b,c,d)}isDirectionInCone(a,b,c,d){return ud(this,a,b,c,d)}isOverlappingPoint(a,b,c){return vd(this,a,b,c)}lineToTileXYArray(a,b,c,d,e=[]){return ff(this,a,b,c,d,e)}mirror(a,b,c=null,d={x:0,y:0}){return gf(this,a,b,c,d)}offset(a,b,c,d){return _a(this,a,b,c,d)}removeAllChess(a=!1,b=!1){return hf(this,a,b),this}removeChess(a,b,c,d,e=!1,f=!1){return La(this,a,b,c,d,e,f),this}ringToTileXYArray(a,b=1,c=[]){return vc(this,a,b,c)}rotate(a,b,c=null,d={x:0,y:0}){return jf(this,a,b,c,d)}setBoardWidth(a=0){return yb(this,a),this}setBoardHeight(a=0){return zb(this,a),this}setTileZ(a,b){return kf(this,a,b),this}shapeToTileXYArray(a,b,c=[]){return lf(this,a,b,c)}swapChess(a,b,c=!0){return mf(this,a,b,c),this}tileXYArrayToChessArray(a,b,c=[]){return $b(this,a,b,c)}tileXYToChessArray(a,b,c=[]){return Ma(this,a,b,c)}tileXYZToChess(a,b,c){return qa(this,a,b,c)}tileZToChessArray(a,b=[]){return wd(this,a,b)}tileXYArrayToWorldXYArray(a,b=[]){return xd(this,a,b)}tileXYToWorldXY(a,b,c={x:0,y:0}){return Da(this,a,b,c)}worldXYSnapToGrid(a,b,c={x:0,y:0}){return yd(this,a,b,c)}worldXYToChess(a,b,c,d){return zd(this,a,b,c,d)}worldXYToTileXY(a,b,c){return Ga(this,a,b,c)}}class Bh extends kd{}const Ta={};Ob(Ta,{ChessToTileXYZ:()=>ba,Contains:()=>Ra,DirectionBetween:()=>md,ForEachTileXY:()=>nd,GetDistance:()=>od,GetOppositeDirection:()=>sd,GetTileXYAtDirection:()=>Ka,GetWrapTileXY:()=>Zb,IsDirectionInCone:()=>ud,TileXYArrayToChessArray:()=>$b,TileXYToChessArray:()=>Ma,TileXYZToChess:()=>qa,TileZToChessArray:()=>wd});const nb={};Ob(nb,{AngleBetween:()=>mb,AngleSnapToDirection:()=>Vb,AngleToward:()=>Wb,GetGridPoints:()=>pd,GridAlign:()=>_b,IsAngleInCone:()=>td,IsOverlappingPoint:()=>vd,TileXYArrayToWorldXYArray:()=>xd,TileXYToWorldXY:()=>Da,WorldXYSnapToGrid:()=>yd,WorldXYToChess:()=>zd,WorldXYToTileXY:()=>Ga});const Cb={};Ob(Cb,{AreNeighbors:()=>ld,GetNeighborChess:()=>qd,GetNeighborChessDirection:()=>Xb,GetNeighborTileDirection:()=>Yb,GetNeighborTileXY:()=>bb,GetNeighborTileXYAtAngle:()=>rd});var oa;(function(a){a[a.orthogonal=0]="orthogonal",a[a.isometric=1]="isometric"})(oa||(oa={}));var hb;(function(a){a[a["4dir"]=4]="4dir",a[a["8dir"]=8]="8dir"})(hb||(hb={}));class wi{constructor({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=oa.orthogonal,dir:f=hb["4dir"]}={}){this.setOriginPosition(a,b),this.setCellSize(c,d),this.setType(e),this.setDirectionMode(f)}fromJSON({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=oa.orthogonal,dir:f=hb["4dir"]}={}){return this.setType(e),this.setDirectionMode(f),this.setOriginPosition(a,b),this.setCellSize(c,d),this}toJSON(){return{x:this.x,y:this.y,cellWidth:this.cellWidth,cellHeight:this.cellHeight,type:this.mode,dir:this.directions}}setOriginPosition(a=0,b=0){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setType(a=oa.orthogonal){return typeof a==="string"&&(a=oa[a]),this.mode=a,this}setDirectionMode(a=hb["4dir"]){return typeof a==="string"&&(a=hb[a]),this.directions=a,this}}function oi(a,b,c,d=!0){let e;switch(a.mode){case oa.orthogonal:case oa.isometric:if(b.y===c.y)e=c.x>=b.x?0:2;else if(b.x===c.x)e=c.y>=b.y?1:3;else if(a.directions===hb["4dir"]){let f=bc(Fb(b.x,b.y,c.x,c.y));f<0&&(f+=360),e=f/90,d&&(e=Math.round(e))}else{let f=c.x-b.x,g=c.y-b.y;if(f===g)e=f>0?4:6;else if(f===-g)e=f>0?7:5;else{let j=bc(Math.atan2(g,f));j<0&&(j+=360);let i=j/45;d&&(i=Math.round(i)),i>=0&&i<1?e=i:i>=1&&i<2?e=i+3:i>=2&&i<3?e=i-1:i>=3&&i<4?e=i+2:i>=4&&i<5?e=i-2:i>=5&&i<6?e=i+1:i>=6&&i<7?e=i-3:e=i}}break}return e===a.directions&&(e=0),e}function Ld(a,b){return gb(b,0,a.directions)}function pi(a,b,c,d=!1){let e=c.x-b.x,f=c.y-b.y,g;return d?g=Math.abs(e)+Math.abs(f):g=Math.sqrt(e*e+f*f),g}function Hd(a,b=[]){if(!(b.length===a))if(b.length<a)for(let c=b.length;c<a;c++)b.push({x:0,y:0});else b.length=a;return b}function Od(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=fm);let e,f;switch(a.mode){case oa.orthogonal:e=b*a.width,f=c*a.height;break;case oa.isometric:e=(b-c)*a._halfWidth,f=(b+c)*a._halfHeight;break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let fm={x:0,y:0};function qi(a,b=0,c=0,d=[]){if(typeof b==="object"){let i=b;c=i.y,b=i.x}d===!0&&(d=bm),Hd(4,d);let e,f;({x:e,y:f}=Od(a,b,c));let g=a._halfWidth,j=a._halfHeight;switch(a.mode){case oa.orthogonal:d[0].x=e+g,d[0].y=f-j,d[1].x=e+g,d[1].y=f+j,d[2].x=e-g,d[2].y=f+j,d[3].x=e-g,d[3].y=f-j;break;case oa.isometric:d[0].x=e+g,d[0].y=f,d[1].x=e,d[1].y=f+j,d[2].x=e-g,d[2].y=f,d[3].x=e,d[3].y=f-j;break}return d}let bm=[];const cc=[[1,0],[0,1],[-1,0],[0,-1],[1,1],[-1,1],[-1,-1],[1,-1]],zc=cc;function li(a){let b={},c,d,e;for(let f in a)c=a[f],d=c[0],e=c[1],b.hasOwnProperty(d)||(b[d]={}),b[d][e]=parseInt(f);return b}const mi=li(cc),ni=li(zc);function ri(a,b,c){let d;switch(a.mode){case oa.orthogonal:d=mi;break;case oa.isometric:d=ni;break}let e=c.x-b.x,f=c.y-b.y;if(d.hasOwnProperty(e)){let g=d[e];if(g.hasOwnProperty(f))return g[f]}return null}function Pd(a,b,c,d,e={x:0,y:0}){e===!0&&(e=em);let f,g;switch(a.mode){case oa.orthogonal:f=cc[c][0],g=cc[c][1];break;case oa.isometric:f=zc[c][0],g=zc[c][1];break}return d===1?(e.x=b.x+f,e.y=b.y+g):(e.x=b.x+d*f,e.y=b.y+d*g),e}let em={x:0,y:0};function si(a,b,c,d={x:0,y:0}){return Pd(a,b,c,1,d)}function ti(a,b,c,d){return cm[d]}const cm={0:2,1:3,2:0,3:1,4:6,5:7,6:4,7:5};function ui(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=dm),b-=a.x,c-=a.y;let e=b/a.width,f=c/a.height;switch(a.mode){case oa.orthogonal:d.x=Math.round(e),d.y=Math.round(f);break;case oa.isometric:d.x=Math.round(+e+f),d.y=Math.round(-e+f);break}return d}let dm={x:0,y:0};function vi(a,b,c,d={x:0,y:0}){return typeof c==="string"&&(c=Eb[c]),d===!0&&(d=gm),d.x=c&1?-b.x:b.x,d.y=c&2?-b.y:b.y,d}let gm={x:0,y:0};function Gb(a,b,c,d,e={x:0,y:0}){e===!0&&(e=hm);let f=b.x+c,g=b.y+d;return e.x=f,e.y=g,e}let hm={x:0,y:0};function xi(a,b,c,d=[]){let e,f;for(e=c,f=-c;f<=c;f++)d.push(Gb(a,b,e,f));for(f=c,e=c-1;e>=-c;e--)d.push(Gb(a,b,e,f));for(e=-c,f=c-1;f>=-c;f--)d.push(Gb(a,b,e,f));for(f=-c,e=-c+1;e<=c-1;e++)d.push(Gb(a,b,e,f));return d}function yi(a,b,c,d={x:0,y:0}){d===!0&&(d=mm),c=gb(c,0,3);let e,f;switch(c){case 1:e=-b.y,f=b.x;break;case 2:e=-b.x,f=-b.y;break;case 3:e=b.y,f=-b.x;break;default:e=b.x,f=b.y;break}return d.x=e,d.y=f,d}let mm={x:0,y:0};function Md(a){a._savedOriginX=a.x,a._savedOriginY=a.y}function Nd(a){a.x=a._savedOriginX,a.y=a._savedOriginY}class ki extends wi{get sides(){return 4}get allDirections(){return this.directions===4?im:jm}get halfDirections(){return this.directions===4?km:lm}directionBetween(a,b,c=!0){return oi(this,a,b,c)}directionNormalize(a){return Ld(this,a)}getDistance(a,b,c=!1){return pi(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return qi(this,a,b,c)}getNeighborTileDirection(a,b){return ri(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return si(this,a,b,c)}getOppositeDirection(a,b,c){return ti(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return ui(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return Pd(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return Od(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return vi(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return Gb(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return xi(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return yi(this,a,b,c)}restoreOrigin(){return Nd(this),this}saveOrigin(){return Md(this),this}}const im=[0,1,2,3],jm=[0,1,2,3,4,5,6,7],km=[0,1],lm=[0,1,4,5];var ca;(function(a){a[a.ODD_R=0]="ODD_R",a[a.EVEN_R=1]="EVEN_R",a[a.ODD_Q=2]="ODD_Q",a[a.EVEN_Q=3]="EVEN_Q"})(ca||(ca={}));var $a;(function(a){a[a.y=0]="y",a[a.flat=0]="flat",a[a.x=1]="x",a[a.pointy=1]="pointy"})($a||($a={}));var qb;(function(a){a[a.even=0]="even",a[a.odd=1]="odd"})(qb||(qb={}));class di{constructor({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=$a.x,staggerIndex:g=qb.odd}={}){this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e)}fromJSON({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=$a.x,staggerIndex:g=qb.odd}={}){return this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e),this}toJSON(){return{x:this.x,y:this.y,radius:this.radius,cellWidth:this.cellWidth,cellHeight:this.cellHeight,staggerAxis:this.staggerAxis,staggerIndex:this.staggerIndex}}setOriginPosition(a,b){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this.radius=void 0,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setRadius(a=0){let b,c;return this.staggerAxis===$a.y?(b=2*a,c=ji*a):(b=ji*a,c=2*a),this.setCellSize(b,c),this.radius=a,this}setDirectionMode(){return this.directions=6,this}setType(a=1,b=1){return typeof a==="string"&&(a=$a[a]),typeof b==="string"&&(b=qb[b]),this.staggerAxis=a,this.staggerIndex=b,a===$a.y?this.mode=b===qb.even?ca.EVEN_Q:ca.ODD_Q:this.mode=b===qb.even?ca.EVEN_R:ca.ODD_R,this}}const ji=Math.sqrt(3);function Na(a,b,c,d={x:0,y:0,z:0}){d===!0&&(d=uf);switch(a){case ca.ODD_R:d.x=b-(c-(c&1))/2,d.z=c;break;case ca.EVEN_R:d.x=b-(c+(c&1))/2,d.z=c;break;case ca.ODD_Q:d.x=b,d.z=c-(b-(b&1))/2;break;case ca.EVEN_Q:d.x=b,d.z=c-(b+(b&1))/2;break}return d.y=-d.x-d.z,d}function Th(a,b,c,d={x:0,y:0,z:0}){typeof a!=="number"&&(d=a,a=d.x,b=d.y,c=d.z),d===!0&&(d=uf);let e=Math.round(a),f=Math.round(b),g=Math.round(c),j=Math.abs(e-a),i=Math.abs(f-b),m=Math.abs(g-c);return j>i&&j>m?e=-f-g:i>m?f=-e-g:g=-e-f,d.x=e,d.y=f,d.z=g,d}function Ba(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Ol);switch(a){case ca.ODD_R:e.x=b+(d-(d&1))/2,e.y=d;break;case ca.EVEN_R:e.x=b+(d+(d&1))/2,e.y=d;break;case ca.ODD_Q:e.x=b,e.y=d+(b-(b&1))/2;break;case ca.EVEN_Q:e.x=b,e.y=d+(b+(b&1))/2;break}return e}function Uh(a,b,c={x:0,y:0,z:0}){return c===!0&&(c=uf),c.x=a,c.y=-a-b,c.z=b,c}let uf={x:0,y:0,z:0},Ol={x:0,y:0};function Wh(a,b,c,d=!0){let e;Na(a.mode,b.x,b.y,Dd),Na(a.mode,c.x,c.y,Ed);let f=Ed.x-Dd.x,g=Ed.y-Dd.y,j=Ed.z-Dd.z;return j===0?e=f>0?0:3:f===0?e=j>0?1:4:g===0?e=j>0?2:5:f>0&&g<0&&j>0?e=0+j/-g:f<0&&g<0&&j>0?e=1+-g/j:f<0&&g>0&&j>0?e=2+g/-f:f<0&&g>0&&j<0?e=3+-j/g:f>0&&g>0&&j<0?e=4+f/-j:e=5+-g/f,d&&(e=Math.round(e)),e}let Dd={x:0,y:0,z:0},Ed={x:0,y:0,z:0};function Xh(a,b,c,d=!1){Na(a.mode,b.x,b.y,Fd),Na(a.mode,c.x,c.y,Gd);let e=Gd.x-Fd.x,f=Gd.y-Fd.y,g=Gd.z-Fd.z;return(Math.abs(e)+Math.abs(f)+Math.abs(g))/2}let Fd={x:0,y:0,z:0},Gd={x:0,y:0,z:0};function Id(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Xl);let e=b*a.width,f=c*a.height;switch(a.mode){case ca.ODD_R:c&1&&(e+=a._halfWidth),f*=.75;break;case ca.EVEN_R:c&1&&(e-=a._halfWidth),f*=.75;break;case ca.ODD_Q:e*=.75,b&1&&(f+=a._halfHeight);break;case ca.EVEN_Q:e*=.75,b&1&&(f-=a._halfHeight);break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let Xl={x:0,y:0};const Ln=Math.PI/180;function ob(a){return a*Ln}function Yh(a,b=0,c=0,d=[]){if(typeof b==="object"){let g=b;c=g.y,b=g.x}d===!0&&(d=Tl),Hd(6,d);let e,f;({x:e,y:f}=Id(a,b,c));if(a.radius!==void 0){let g=a.radius,j=a.staggerAxis===$a.flat?0:-30;for(let i=0;i<6;i++){let m=60*i+j,n=ob(m);d[i].x=e+g*Math.cos(n),d[i].y=f+g*Math.sin(n)}}else{let g=a._halfWidth,j=g/2,i=a._halfHeight,m=i/2;a.staggerAxis===$a.flat?(d[0].x=e+g,d[0].y=f,d[1].x=e+j,d[1].y=f+i,d[2].x=e-j,d[2].y=f+i,d[3].x=e-g,d[3].y=f,d[4].x=e-j,d[4].y=f-i,d[5].x=e+j,d[5].y=f-i):(d[0].x=e+g,d[0].y=f-m,d[1].x=e+g,d[1].y=f+m,d[2].x=e,d[2].y=f+i,d[3].x=e-g,d[3].y=f+m,d[4].x=e-g,d[4].y=f-m,d[5].x=e,d[5].y=f-i)}return d}let Tl=[];const Pl=[[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]]],Ql=[[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]],[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]]],Rl=[[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]],[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]]],Sl=[[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]],[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]]],Ua=[Pl,Ql,Rl,Sl];function pb(a){let b={},c,d;for(let e in a)[c,d]=a[e],b.hasOwnProperty(c)||(b[c]={}),b[c][d]=parseInt(e);return b}const Vh=[[pb(Ua[0][0]),pb(Ua[0][1])],[pb(Ua[1][0]),pb(Ua[1][1])],[pb(Ua[2][0]),pb(Ua[2][1])],[pb(Ua[3][0]),pb(Ua[3][1])]];function Jd(a,b,c){let d;switch(a){case ca.ODD_R:case ca.EVEN_R:d=c&1;break;case ca.ODD_Q:case ca.EVEN_Q:d=b&1;break}return d}function Zh(a,b,c){let d=a.mode,e=Jd(d,b.x,b.y),f=Vh[d][e],g=c.x-b.x,j=c.y-b.y;if(f.hasOwnProperty(g)){let i=f[g];if(i.hasOwnProperty(j))return i[j]}return null}function Kd(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Wl);let f=a.mode,g=b.x,j=b.y;if(d===1){let i=Jd(f,g,j);e.x=g+Ua[f][i][c][0],e.y=j+Ua[f][i][c][1]}else if(d===0)e.x=g,e.y=j;else{let i=Na(f,g,j,!0),m,n,u;switch(c){case 1:m=i.x,n=i.y-d,u=i.z+d;break;case 2:m=i.x-d,n=i.y,u=i.z+d;break;case 3:m=i.x-d,n=i.y+d,u=i.z;break;case 4:m=i.x,n=i.y+d,u=i.z-d;break;case 5:m=i.x+d,n=i.y,u=i.z-d;break;default:m=i.x+d,n=i.y-d,u=i.z;break}Ba(f,m,n,u,e)}return e}let Wl={x:0,y:0};function _h(a,b,c,d={x:0,y:0}){return Kd(a,b,c,1,d)}function $h(a,b,c,d){return(d+3)%6}const ai=4/3,bi=2/3;function ci(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Vl),b-=a.x,c-=a.y;let e,f;switch(a.mode){case ca.ODD_R:case ca.EVEN_R:f=c*ai/a.height,e=b/a.width-bi*(c/a.height);break;case ca.ODD_Q:case ca.EVEN_Q:f=c/a.height-bi*(b/a.width),e=b*ai/a.width;break}let g=Uh(e,f,Ul);return Th(g),Ba(a.mode,g.x,g.y,g.z,d),d}let Ul={x:0,y:0,z:0},Vl={x:0,y:0};function ei(a,b,c,d={x:0,y:0}){typeof c==="string"&&(c=Eb[c]),d===!0&&(d=_l);let e=Na(a.mode,b.x,b.y,!0),f=a.mode===ca.ODD_R||a.mode===ca.EVEN_R,g,j,i;return c&1&&(f?(g=e.y,j=e.x,i=e.z):(g=-e.x,j=-e.z,i=-e.y),e.x=g,e.y=j,e.z=i),c&2&&(f?(g=-e.y,j=-e.x,i=-e.z):(g=e.x,j=e.z,i=e.y)),Ba(a.mode,g,j,i,d),d}let _l={x:0,y:0};function fi(a,b,c,d,e={x:0,y:0}){e===!0&&(e=$l);let f=b.x+c,g=b.y+d;switch(a.mode){case ca.ODD_R:(d&1)!==0&&((g&1)===0&&(f+=1));break;case ca.EVEN_R:(d&1)!==0&&((g&1)===0&&(f-=1));break;case ca.ODD_Q:(c&1)!==0&&((f&1)==0&&(g+=1));break;case ca.EVEN_Q:(c&1)!==0&&((f&1)==0&&(g-=1));break}return e.x=f,e.y=g,e}let $l={x:0,y:0};function gi(a,b,c,d=[]){let e=Na(a.mode,b.x,b.y,!0),f=e.x,g=e.y,j=e.z,i,m,n;for(n=c,i=0;i>=-c;i--)m=-i-n,d.push(Ba(a.mode,f+i,g+m,j+n));for(i=-c,m=1;m<=c;m++)n=-i-m,d.push(Ba(a.mode,f+i,g+m,j+n));for(m=c,n=-1;n>=-c;n--)i=-m-n,d.push(Ba(a.mode,f+i,g+m,j+n));for(n=-c,i=1;i<=c;i++)m=-i-n,d.push(Ba(a.mode,f+i,g+m,j+n));for(i=c,m=-1;m>=-c;m--)n=-i-m,d.push(Ba(a.mode,f+i,g+m,j+n));for(m=-c,n=1;n<=c-1;n++)i=-m-n,d.push(Ba(a.mode,f+i,g+m,j+n));return d}function hi(a,b,c,d={x:0,y:0}){d===!0&&(d=am),c=gb(c,0,5);let e=Na(a.mode,b.x,b.y,!0),f,g,j;switch(c){case 1:f=-e.z,g=-e.x,j=-e.y;break;case 2:f=e.y,g=e.z,j=e.x;break;case 3:f=-e.x,g=-e.y,j=-e.z;break;case 4:f=e.z,g=e.x,j=e.y;break;case 5:f=-e.y,g=-e.z,j=-e.x;break;default:f=e.x,g=e.y,j=e.z;break}return Ba(a.mode,f,g,j,d),d}let am={x:0,y:0};class ii extends di{get sides(){return 6}get allDirections(){return Yl}get halfDirections(){return Zl}directionBetween(a,b,c=!0){return Wh(this,a,b,c)}directionNormalize(a){return Ld(this,a)}getDistance(a,b,c=!1){return Xh(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return Yh(this,a,b,c)}getNeighborTileDirection(a,b){return Zh(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return _h(this,a,b,c)}getOppositeDirection(a,b,c){return $h(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return ci(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return Kd(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return Id(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return ei(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return fi(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return gi(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return hi(this,a,b,c)}restoreOrigin(){return Nd(this),this}saveOrigin(){return Md(this),this}}const Yl=[0,1,2,3,4,5],Zl=[0,1,2];var za;(function(a){a[a.random=0]="random",a[a.diagonal=1]="diagonal",a[a.straight=2]="straight",a[a.line=3]="line",a[a.astar=10]="astar",a[a["astar-random"]=11]="astar-random",a[a["astar-line"]=12]="astar-line"})(za||(za={}));const Hb=null;class Tk{constructor(a){this.content=[],this.scoreFunction=a}clear(){this.content.length=0}push(a){this.content.push(a),this.sinkDown(this.content.length-1)}pop(){let a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.bubbleUp(0)),a}remove(a){let b=this.content.indexOf(a),c=this.content.pop();b!==this.content.length-1&&(this.content[b]=c,this.scoreFunction(c)<this.scoreFunction(a)?this.sinkDown(b):this.bubbleUp(b))}get size(){return this.content.length}rescoreElement(a){this.sinkDown(this.content.indexOf(a))}sinkDown(a){let b=this.content[a];for(;a>0;){let c=(a+1>>1)-1,d=this.content[c];if(this.scoreFunction(b)<this.scoreFunction(d))this.content[c]=b,this.content[a]=d,a=c;else break}}bubbleUp(a){let b=this.content.length,c=this.content[a],d=this.scoreFunction(c);for(;;){let e=a+1<<1,f=e-1,g=null,j;if(f<b){let i=this.content[f];j=this.scoreFunction(i),j<d&&(g=f)}if(e<b){let i=this.content[e],m=this.scoreFunction(i);m<(g===null?d:j)&&(g=e)}if(g!==null)this.content[a]=this.content[g],this.content[g]=c,a=g;else break}}}let L5=new Tk(a=>a.f);const pe=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d=d.prevNodes[0];return c.reverse()};const Wk=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d.prevNodes.length===1?d=d.prevNodes[0]:d=ac(d.prevNodes);return c.reverse()};const Vk=function(a,b,c=[]){let d=b,e=b.angleTo(a);for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1)d=d.prevNodes[0];else{let f=Infinity;for(let g=1,j=d.prevNodes.length;g<j;g++){let i=d.prevNodes[g],m=Math.abs(b.angleTo(i)-e);m<f&&(f=m,d=i)}}}return c.reverse()};const Uk=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let j=0,i=d.prevNodes.length;j<i;j++){f=d.prevNodes[j],g=f.logicDirTo(d);if(g!==e)break}e=g,d=f}}return c.reverse()};const Xk=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let j=0,i=d.prevNodes.length;j<i;j++){f=d.prevNodes[j],g=f.logicDirTo(d);if(g===e)break}e=g,d=f}}return c.reverse()};let Nb={};Nb[za.astar]=pe;Nb[za["astar-line"]]=pe;Nb[za["astar-random"]]=pe;Nb[za.random]=Wk;Nb[za.line]=Vk;Nb[za.diagonal]=Uk;Nb[za.straight]=Xk;class Bi{constructor(){this.prevNodes=[]}shutdown(){this.key=void 0,this.prevNodes.length=0}destroy(){this.shutdown()}reset(a){this.key=a,this.f=0,this.g=0,this.h=void 0,this.closerH=void 0,this.visited=!1,this.closed=!1}heuristic(a,b,c){if(b===null)return 0;let d,e=this.distanceTo(a)*this.manager.weight;switch(b){case za.astar:d=e;break;case za["astar-line"]:if(c!==void 0){let f=a.angleTo(c)-this.angleTo(c);d=e+Math.abs(f)}else d=e;case za["astar-random"]:d=e+Math.random();break;default:d=e;break}return d}getNextNodes(){return[]}getCost(a){return Hb}distanceTo(a){return 0}angleTo(a){return 0}logicDirTo(a){return 0}getNode(a,b=!1){return this.manager.getNode(a,b)}}function Qd(a){for(let b=a.length-1;b>0;b--){let c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a}class wm extends Bi{constructor(a){super();this.isTileXYZ=!0;this.pathFinder=a}reset(a){super.reset(a),this.key=a,Ci(a,this),this._px=void 0,this._py=void 0,this.cost=void 0}getNextNodes(){let a=Cb.GetNeighborTileXY(this.board,this);this.pathFinder.shuffleNeighbors&&Qd(a);let b=[];return a.forEach(c=>{let d=this.getNode(Qa(c.x,c.y),!0);b.push(d)}),b}getCost(a){return this.pathFinder.cacheCost?this.cost===void 0&&(this.cost=this.pathFinder.getCost(this,a)):this.cost=this.pathFinder.getCost(this,a),this.cost}distanceTo(a){return Ta.GetDistance(this.board,this,a,!0)}angleTo(a){return Fb(this.worldX,this.wroldY,a.worldX,a.worldX)}logicDirTo(a){return Cb.GetNeighborTileDirection(this.board,this,a)}get board(){return this.pathFinder.board}get worldX(){if(this._px===void 0){let a=nb.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._px}get wroldY(){if(this._py===void 0){let a=nb.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._py}}class rm{constructor(){this.data=[];this.visited=new Set()}push(a,b){if(Array.isArray(a)){let d=a;for(let e=0,f=d.length;e<f;e++)this.push(d[e]);return this}if(typeof a==="object"){let d=a;a=d.x,b=d.y}let c=`${a},${b}`;return this.visited.has(c)?this:(this.data.push({x:a,y:b}),this.visited.add(c),this)}pop(){return this.data.pop()}get length(){return this.data.length}clear(){return this.data.length=0,this.visited.clear(),this}}let rS=new rm();var Cd;(function(a){a[a.direction=0]="direction",a[a.angle=1]="angle"})(Cd||(Cd={}));function Ub(a=32,b=32){const c=qc(a,b);return new Ya(c.canvas)}function Xg(a,b){const c=a.texture,d=b.shaders.current,e=d.buffer,f=c.binding;d.count===e.batchSize&&b.flush();const g=a.vertexData;b.textures.request(c);const j=f.index;g[4]=j,g[10]=j,g[16]=j,g[22]=j;const i=d.count*e.quadElementSize;e.vertexViewF32.set(g,i);const m=a.vertexColor,n=e.vertexViewU32;n[i+5]=m[0],n[i+11]=m[2],n[i+17]=m[3],n[i+23]=m[1],d.count++}class Tg extends Yc{constructor(a=0,b=0){super(a,b);this._alpha=1,this.type="Container"}setSize(a,b=a){return this.transform.updateExtent(a,b),this}setPosition(a,b){return this.transform.position.set(a,b),this}setOrigin(a,b=a){return this.transform.origin.set(a,b),this}setSkew(a,b=a){return this.transform.skew.set(a,b),this}setScale(a,b=a){return this.transform.scale.set(a,b),this}setRotation(a){return this.transform.rotation=a,this}set width(a){this.transform.updateExtent(a)}get width(){return this.transform.extent.width}set height(a){this.transform.updateExtent(void 0,a)}get height(){return this.transform.extent.height}set x(a){this.transform.position.x=a}get x(){return this.transform.position.x}set y(a){this.transform.position.y=a}get y(){return this.transform.position.y}set originX(a){this.transform.origin.x=a}get originX(){return this.transform.origin.x}set originY(a){this.transform.origin.y=a}get originY(){return this.transform.origin.y}set skewX(a){this.transform.skew.x=a}get skewX(){return this.transform.skew.x}set skewY(a){this.transform.skew.y=a}get skewY(){return this.transform.skew.y}set scaleX(a){this.transform.scale.x=a}get scaleX(){return this.transform.scale.x}set scaleY(a){this.transform.scale.y=a}get scaleY(){return this.transform.scale.y}set rotation(a){this.transform.rotation=a}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(a){a!==this._alpha&&(this._alpha=a,this.setDirty(aa.TRANSFORM))}}function Yg(a,b){const c=a.frame;if(!c)return;const d=b.ctx,e=a.transform,{a:f,b:g,c:j,d:i,tx:m,ty:n}=e.world,{x:u,y:w}=e.extent;d.save(),d.setTransform(f,g,j,i,m,n),d.globalAlpha=a.alpha,d.drawImage(c.texture.image,c.x,c.y,c.width,c.height,u,w,c.width,c.height),d.restore()}function pc(a,b){const c=(b*255|0)&255;return(c<<24|a)>>>0}function Zg(a){const b=a.vertexAlpha,c=a.vertexTint,d=a.vertexColor;return d[0]=pc(c[0],b[0]),d[1]=pc(c[1],b[1]),d[2]=pc(c[2],b[2]),d[3]=pc(c[3],b[3]),a}function _c(a,b,...c){const d=a.getFrame(b),{u0:e,u1:f,v0:g,v1:j,pivot:i}=d;return c.forEach(m=>{if(!m||d===m.frame)return;m.frame=d,i&&m.setOrigin(i.x,i.y),m.frame.setExtent(m),m.hasTexture=!0;const n=m.vertexData;n[2]=e,n[3]=g,n[8]=e,n[9]=j,n[14]=f,n[15]=j,n[20]=f,n[21]=g}),c}function Wg(a,b,...c){if(!a)c.forEach(d=>{d.texture=null,d.frame=null,d.hasTexture=!1});else{let d;a instanceof Ya?d=a:d=kb.get().get(a),d?(c.forEach(e=>{e.texture=d}),_c(d,b,...c)):console.warn(`Invalid Texture key: ${a}`)}return c}function _g(a){const b=a.vertexData,{x0:c,y0:d,x1:e,y1:f,x2:g,y2:j,x3:i,y3:m}=Zc(a.transform);return b[0]=c,b[1]=d,b[6]=e,b[7]=f,b[12]=g,b[13]=j,b[18]=i,b[19]=m,a}class $c extends Tg{constructor(a,b,c,d){super(a,b);this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertexData=new Float32Array(24).fill(0),this.vertexColor=new Uint32Array(4).fill(4294967295),this.vertexAlpha=new Float32Array(4).fill(1),this.vertexTint=new Uint32Array(4).fill(16777215),this.setTexture(c,d)}setTexture(a,b){return Wg(a,b,this),this}setFrame(a){return _c(this.texture,a,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}preRender(){this.isDirty(aa.COLORS)&&(Zg(this),this.clearDirty(aa.COLORS)),this.isDirty(aa.TRANSFORM)&&(_g(this),this.clearDirty(aa.TRANSFORM))}renderGL(a){this.preRender(),Xg(this,a)}renderCanvas(a){this.preRender(),Yg(this,a)}get alpha(){return this._alpha}set alpha(a){if(a!==this._alpha){this._alpha=a;const b=this.vertexAlpha;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(aa.ALPHA)}}get tint(){return this._tint}set tint(a){if(a!==this._tint){this._tint=a;const b=this.vertexTint;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(aa.COLORS)}}destroy(a){super.destroy(a),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertexData=null,this.vertexColor=null,this.vertexAlpha=null,this.vertexTint=null}}function je(a,b,c){let d=Math.ceil(b*a.resolution),e=Math.ceil(c*a.resolution),f=a.canvas;if(f.width===d||f.height===e){ke(a);return}f.width=d,f.height=e,a.texture.setSize(b,c),a.setSize(b,c),a.updateTexture()}function ke(a){a.context.clearRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function Lf(a,b="#fff"){let c=a.context;c.fillStyle=b,c.fillRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function le(a,b,c){let d=new Image();d.onload=function(){let e=a.resolution,f=d.width/e,g=d.height/e;je(a,f,g),a.context.drawImage(d,0,0),a.updateTexture(),c&&c(),d.onload=null,d.src="",d.remove()},d.src=b}function Mf(a,b){return new Promise(function(c,d){le(a,b,c)})}function Nf(a,b,c){return a.canvas.toDataURL(b,c)}function Of(a,b,c,d=[0,0,0,0]){let e=a.context.getImageData(b,c,1,1).data;return d[0]=e[0],d[1]=e[1],d[2]=e[2],d[3]=e[3],d}function Pf(a,b,c,d,e,f,g){g===void 0&&(g=d!==0||e!==0||f!==0?255:0);let j=a.context.createImageData(1,1);j.data[0]=d,j.data[1]=e,j.data[2]=f,j.data[3]=g,a.context.putImageData(j,b,c),a.updateTexture()}class Kf extends $c{constructor(a=0,b=0,c=32,d=32){super(a,b,Ub());this.type="rexCanvas";const e=va.get();this.resolution=e.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.resize(c,d)}updateTexture(){return this.texture.binding&&this.texture.binding.update(),this.setDirty(aa.TEXTURE),this}destroy(a){this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}resize(a,b){return je(this,a,b),this}clear(){return ke(this),this}}function ub(a,b,c,d=1){let e;if(typeof a==="string"){let j=kb.get();j.has(a)||j.add(a,Ub()),e=j.get(a)}else e=a;let f=e.image,g=f.getContext("2d");return c?b.call(c,f,g):b(f,g),e.setSize(f.width/d,f.height/d),e.binding&&e.binding.update(),e}class Yk{constructor(a=0,b=a,c=0,d=c,e=0){this._width=0;this._height=0;this.cornerRadius={tl:Wa(0),tr:Wa(0),bl:Wa(0),br:Wa(0)};this.setTo(a,b,c,d,e)}setTo(a=0,b=a,c=0,d=c,e=0){return this.setPosition(a,b),this.setRadius(e),this.setSize(c,d),this}setPosition(a=0,b=a){return this.x=a,this.y=b,this}setRadius(a=0){let b=this.cornerRadius;if(typeof a==="number"){const c=a,d=a;b.tl=Wa(void 0,c,d),b.tr=Wa(void 0,c,d),b.bl=Wa(void 0,c,d),b.br=Wa(void 0,c,d)}else{const c=a.x||0,d=a.y||0;b.tl=Wa(a.tl,c,d),b.tr=Wa(a.tr,c,d),b.bl=Wa(a.bl,c,d),b.br=Wa(a.br,c,d)}return this}setSize(a=0,b=a){return this.width=a,this.height=b,this}get minWidth(){let a=this.cornerRadius;return Math.max(a.tl.x+a.tr.x,a.bl.x+a.br.x)}get minHeight(){let a=this.cornerRadius;return Math.max(a.tl.y+a.bl.y,a.tr.y+a.br.y)}get width(){return this._width}set width(a){a==null&&(a=0),this._width=Math.max(a,this.minWidth)}get height(){return this._height}set height(a){a==null&&(a=0),this._height=Math.max(a,this.minHeight)}get radius(){let a=this.cornerRadius,b=Math.max(a.tl.x,a.tl.y,a.tr.x,a.tr.y,a.bl.x,a.bl.y,a.br.x,a.br.y);return b}}function Wa(a,b,c){return a===void 0?{x:b,y:c}:typeof a==="number"?{x:a,y:a}:a}const Zk=ob(0),_k=ob(90),$k=ob(180),al=ob(270);function Wf(a,b,c,d,e,f,g,j,i,m){const n=new Yk(c,d,e,f,g);let u=n.cornerRadius,w,B,C;b.beginPath(),b.translate(c,d),w=u.br,B=n.width-w.x,C=n.height-w.y,qe(w)?b.ellipse(B,C,w.x,w.y,0,Zk,_k):(b.moveTo(n.width,C),b.lineTo(n.width,n.height),b.lineTo(B,n.height)),w=u.bl,B=w.x,C=n.height-w.y,b.lineTo(w.x,n.height),qe(w)?b.ellipse(B,C,w.x,w.y,0,_k,$k):(b.lineTo(0,n.height),b.lineTo(0,C)),w=u.tl,B=w.x,C=w.y,b.lineTo(0,C),qe(w)?b.ellipse(B,C,w.x,w.y,0,$k,al):(b.lineTo(0,0),b.lineTo(B,0)),w=u.tr,B=n.width-w.x,C=w.y,b.lineTo(B,0),qe(w)?b.ellipse(B,C,w.x,w.y,0,al,Zk):(b.lineTo(n.width,0),b.lineTo(n.width,C)),b.closePath(),j&&(b.fillStyle=j,b.fill()),i&&(b.strokeStyle=i,b.lineWidth=m,b.stroke())}function qe(a){return a.x!==0&&a.y!==0}var Sk;(function(a){a[a.right=0]="right",a[a.down=1]="down",a[a.left=2]="left",a[a.up=3]="up"})(Sk||(Sk={}));function vk(a,b){b.width!==a.width&&(b.width=a.width),b.height!==a.height&&(b.height=a.height);let c=b.getContext("2d");c.drawImage(a.texture.image,a.x,a.y,a.width,a.height)}function Qf(a,b,c=0,d=0,e=a.width,f=a.height){let g=a.resolution,j=a.canvas,i=Math.ceil(e*g),m=Math.ceil(f*g);ub(b,function(n,u){n.width!==i&&(n.width=i),n.height!==m&&(n.height=m),u.clearRect(0,0,i,m),u.drawImage(j,c,d,i,m)},void 0,a.resolution)}function Rf(a,b,c){let d=kb.get();if(!d.has(b))return;vk(d.get(b).getFrame(c),a.canvas);let e=a.canvas.width,f=a.canvas.height,g=a.resolution,j=e/g,i=f/g;a.texture.setSize(j,i),a.setSize(j,i),a.updateTexture()}class uk extends Kf{fill(a="#fff"){return Lf(this,a),this}getCanvas(){return this.canvas}getContext(){return this.context}getDataURL(a,b){return Nf(this,a,b)}getPixel(a,b,c=[0,0,0,0]){return Of(this,a,b,c)}generateTexture(a,b=0,c=0,d=this.width,e=this.height){return Qf(this,a,b,c,d,e),this}loadFromURL(a,b){return le(this,a,b),this}loadFromURLPromise(a){return Mf(this,a)}loadTexture(a,b){return Rf(this,a,b),this}setPixel(a,b,c,d,e,f){return Pf(this,a,b,c,d,e,f),this}}const n7=Ia(Ah());const Fi={receive:"receive"};function hg(a,b){return a.events.delete(b),a}function gg(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);for(const e of d)e.callback.apply(e.context,c),e.once&&d.delete(e);return d.size===0&&a.events.delete(b),!0}class dg{constructor(){this.events=new Map()}}class Mc{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function jg(a){return[...a.events.keys()]}function ig(a,b){const c=a.events.get(b);return c?c.size:0}function kg(a,b){const c=[],d=a.events.get(b);return d.forEach(e=>{c.push(e.callback)}),c}function fg(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof Mc)g.delete(c);else{const j=!d,i=e!==void 0;for(const m of g)m.callback===c&&(j&&m.context===d)&&(i&&m.once===e)&&g.delete(m)}return g.size===0&&f.delete(b),a}function Lc(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new Mc(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function eg(a,b,c,d=a){return Lc(a,b,c,d,!0)}function re(a,b){b?a.events.delete(b):a.events.clear()}class Ca{setEventEmitter(a){return this.privateEE=a===void 0,this.eventEmitter=this.privateEE?new dg():a,this}clearEventEmitter(){return this.setEventEmitter(null),this}destroyEventEmitter(){return this.eventEmitter&&this.privateEE&&(re(this.eventEmitter),this.eventEmitter=null),this}on(a,b,c=this,d=!1){return this.eventEmitter&&Lc(this.eventEmitter,a,b,c,d),this}once(a,b,c=this){return this.eventEmitter&&eg(this.eventEmitter,a,b,c),this}off(a,b,c,d){return this.eventEmitter&&fg(this.eventEmitter,a,b,c,d),this}emit(a,...b){return this.eventEmitter&&gg(this.eventEmitter,a,...b),this}removeAllListeners(a){return this.eventEmitter&&re(this.eventEmitter,a),this}clearEvent(a){return this.eventEmitter&&hg(this.eventEmitter,a),this}getListenerCount(a){return this.eventEmitter?ig(this.eventEmitter,a):0}getEventNames(){return this.eventEmitter?jg(this.eventEmitter):[]}getListeners(a){return this.eventEmitter?kg(this.eventEmitter,a):[]}}function Gi(a,b){(!a.sendToRef||a.sendToRef.key!==a.receiverID)&&(a.sendToRef=a.database.ref(a.rootPath).child(a.receiverID));if(b===void 0)return a.sendToRef.remove();let c={message:b,senderID:a.userID,stamp:a.stamp};return a.userName!==void 0&&(c.senderName=a.userName),a.skipFirst=!1,a.stamp=!a.stamp,a.sendToRef.set(c)}function Hi(a){if(a.isReceiving&&a.receiverRef.key===a.receiverID)return;xf(a),a.isReceiving=!0,a.skipFirst=!0,a.receiverRef=a.database.ref(a.rootPath).child(a.receiverID),a.receiverRef.on("value",Ji,a),a.receiverRef.onDisconnect().remove()}function xf(a){if(!a.isReceiving)return;a.isReceiving=!1,a.receiverRef.off("value",Ji,a),a.receiverRef.remove(),a.receiverRef.onDisconnect().cancel()}function Ji(a){if(this.skipFirst){this.skipFirst=!1;return}let b=a.val();if(b==null)return;delete b.stamp,this.history.add(b),this.emit(this.eventNames.receive,b)}class Ii{constructor({maxLength:a=-1}={}){this.maxLength=a,this.records=[]}add(a){return this.maxLength===0?this:(this.records.push(a),this.maxLength>0&&this.records.length>this.maxLength&&this.records.shift(),this)}clear(){return this.records.length=0,this}changeUserName(a,b){return this.maxLength===0?this:(this.records.forEach(c=>{c.senderID===a&&(c.senderName=b)}),this)}}const wV=Ia(Ja());class dc extends Ca{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d,receiverID:e="",history:f=0,eventNames:g=Fi}={}){super();this.setEventEmitter(a),this.eventNames=g,this.database=wV.database(),this.setRootPath(b),this.skipFirst=!0,this.stamp=!1,this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.isReceiving=!1,f===!0?f=-1:f===!1&&(f=0),this.history=new Ii({maxLength:f})}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.sendToRef=void 0,this.receiverRef=void 0,this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.receiverID=a,this}changeUserName(a,b){return a===this.userID&&(this.userName=b),this.history.changeUserName(a,b),this}getHistory(){return this.history.records}clearHistory(){return this.history.clear(),this}send(a){return Gi(this,a)}startReceiving(){return Hi(this),this}stopReceiving(){return xf(this),this}}const On="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function Xd(a,b,c=On){let d=b===void 0?a:wc(a,b),e="";for(let f=0;f<d;f++)e+=ac(Array.from(c));return e}const b$=Ia(Ja());var ra;(function(a){a[a["1d"]=1]="1d",a[a["2d"]=2]="2d",a[a["3d"]=3]="3d"})(ra||(ra={}));const Ki={init:"init",update:"update",addkey0:"addkey0",removekey0:"removekey0",changekey0:"changekey0",addkey1:"addkey1",removekey1:"removekey1",changekey1:"changekey1",addkey2:"addkey2",removekey2:"removekey2",changekey2:"changekey2"};function dl(a){return a==null||a===""||a.length===0}function Nn(a,b,c={}){let d=a;if(!dl(b)){typeof b==="string"&&(b=b.split("."));let e;for(let f=0,g=b.length;f<g;f++){e=b[f];if(d[e]==null||typeof d[e]!=="object"){let j;f===g-1?j=c:j={},d[e]=j}d=d[e]}}return d}function el(a,b,c){if(typeof a!=="object")return;if(dl(b)){if(c==null)return;typeof c==="object"&&(a=c)}else{typeof b==="string"&&(b=b.split("."));let d=b.pop(),e=Nn(a,b);e[d]=c}return a}function se(a){if(Array.isArray(a))a.length=0;else for(let b in a)delete a[b]}function cl(a){return JSON.parse(JSON.stringify(a))}class Li{constructor(){this.data={}}setValue(a,b){return a==null?this.clear():typeof a==="object"?this.data=a:el(this.data,a,b),this}getValue(a){if(a==null)return this.data;{typeof a==="string"&&(a=a.split("."));let b=this.data;for(let c=0,d=a.length;c<d;c++){if(!lg(b))return;b=b[a[c]]}return b}}cloneValue(a){return cl(this.getValue(a))}removeKey(a){if(a==null)this.clear();else{typeof a==="string"&&(a=a.split("."));let b=a.pop(),c=this.data;for(let d=0,e=a.length;d<e;d++){if(!lg(c))return this;c=c[a[d]]}lg(c)&&delete c[b]}return this}clear(){return se(this.data),this}}function lg(a){return a!=null&&typeof a==="object"}const nW=Ia(Ja());class Ib extends Ca{constructor({eventEmitter:a,parent:b,key:c,type:d,eventNames:e,table:f}={}){super();this.setEventEmitter(a),this.parent=b,this.children=new Map(),this.key=c,this.parent?this.fullKeyPath=Vi(this.parent.fullKeyPath,this.key):this.fullKeyPath="",this.type=d,this.eventNames=e,this.table=f,this.database=nW.database(),this.setRootPath()}destroy(){this.stopUpdate().clear().destroyEventEmitter()}setRootPath(a){if(a===void 0){let b=this.parent?this.parent.rootPath:"";a=`${b}/${this.key}`}this.rootPath=a,this.rootRef=a!==""?this.database.ref(a):void 0;for(const[b,c]of this.children)c instanceof Ib&&c.setRootPath();return this}setData(a,b){if(arguments.length===0)this.clear();else if(typeof a=="string")this.setChildData(a,b);else{let c=a;for(const[d,e]of this.children)c.hasOwnProperty(d)||this.removeChild(d);for(let d in c)this.setChildData(d,c[d])}return this}clear(){this.table.removeKey(this.fullKeyPath);for(const[a,b]of this.children)this.removeChild(a);return this}get childClass(){return null}setChildData(a,b){const c=Vi(this.fullKeyPath,a);this.table.setValue(c,b);if(!(typeof b!=="object")){if(this.children.has(a))this.children.get(a).setData(b);else if(this.childClass){let d=new this.childClass({parent:this,key:a,type:this.type,eventEmitter:this.eventEmitter,eventNames:this.eventNames,table:this.table});d.startUpdate(),this.children.set(a,d)}}return this}removeChild(a){return this.children.has(a)&&(this.children.get(a).destroy(),this.children.delete(a)),this}startUpdate(){return this}stopUpdate(){return this}}function Vi(a,b){return a==null||a===""?b:b==null||b===""?a:`${a}.${b}`}class Ac extends Ib{startUpdate(){return this.rootRef.on("child_added",this.addCol,this),this.rootRef.on("child_removed",this.removeCol,this),this.rootRef.on("child_changed",this.changeColValue,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addCol,this),this.rootRef.off("child_removed",this.removeCol,this),this.rootRef.off("child_changed",this.changeColValue,this),this}addCol(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["1d"]:this.emit(this.eventNames.addkey0,b,c);break;case ra["2d"]:this.emit(this.eventNames.addkey1,this.key,b,c);break;default:this.emit(this.eventNames.addkey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}removeCol(a){const b=a.key;this.removeChild(b);switch(this.type){case ra["1d"]:this.emit(this.eventNames.removekey0,b);break;case ra["2d"]:this.emit(this.eventNames.removekey1,this.key,b);break;default:this.emit(this.eventNames.removekey2,this.pageKey,this.key,b);break}this.emit(this.eventNames.update,this.table.data)}changeColValue(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["1d"]:this.emit(this.eventNames.changekey0,b,c);break;case ra["2d"]:this.emit(this.eventNames.changekey1,this.key,b,c);break;default:this.emit(this.eventNames.changekey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}get pageKey(){return this.parent.key}}class Bc extends Ib{startUpdate(){return this.rootRef.on("child_added",this.addRow,this),this.rootRef.on("child_removed",this.removeRow,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addRow,this),this.rootRef.off("child_removed",this.removeRow,this),this}addRow(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["2d"]:this.emit(this.eventNames.addkey0,this.key,b,c);break;default:this.emit(this.eventNames.addkey1,this.key,b,c);break}}removeRow(a){const b=a.key;this.removeChild(b);switch(this.type){case ra["2d"]:this.emit(this.eventNames.removekey0,b);break;default:this.emit(this.eventNames.removekey1,this.key,b);break}}get childClass(){return Ac}}class yf extends Ib{startUpdate(){return this.rootRef.on("child_added",this.addPage,this),this.rootRef.on("child_removed",this.removePage,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addPage,this),this.rootRef.off("child_removed",this.removePage,this),this}addPage(a){const b=a.key,c=a.val();this.setData(b,c),this.emit(this.eventNames.addkey0,b,c)}removePage(a){const b=a.key;this.removeChild(b),this.emit(this.eventNames.removekey0,b)}get childClass(){return Bc}}const Td={};Td[ra["1d"]]=Ac;Td[ra["2d"]]=Bc;Td[ra["3d"]]=yf;function Mi(a){return new Td[a.tableType]({type:a.tableType,eventEmitter:a.eventEmitter,eventNames:a.eventNames,table:a.table})}function Ni(a){return a.updater.clear(),a.initialFlag=!1,a.rootRef.once("value").then(function(b){let c=b.val()||{};return a.table.setValue(c),a.emit(a.eventNames.init,c),a.initialFlag=!0,Promise.resolve(c)})}function Ea(a,b,c,d){let e=a.rootRef;return e=b?e.child(b):e,e=c?e.child(c):e,e=d?e.child(d):e,e}function Oi(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ea(a,c,d,e).set(f)}function Pi(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;default:c=b[0];break}return Ea(a,c,d,e).remove()}function Qi(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ea(a,c,d,e).transaction(function(g){return g===null&&(g=0),g+f})}function Ri(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ea(a,c,d,e).transaction(f)}function Si(a,b){return Ea(a).update(b)}function Ti(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;case 1:c=b[0];break}return Ea(a,c,d,e).onDisconnect().remove()}function Ui(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ea(a,c,d,e).onDisconnect().set(f)}const QV=Ia(Ja());class ec extends Ca{constructor({eventEmitter:a,root:b="",type:c=ra["3d"],eventNames:d=Ki}={}){super();this.setEventEmitter(a),this.eventNames=d,this.database=QV.database(),this.table=new Li(),this.setTableType(c),this.setRootPath(b),this.initialFlag=!1}destroy(){this.updater.destroy(),this.destroyEventEmitter().stopUpdate()}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):null,this.updater.setRootPath(a),this}setTableType(a){return typeof a==="string"&&(a=ra[a]),this.tableType=a,this.updater&&this.updater.destroy(),this.updater=Mi(this),this}startUpdate(){return Ni(this),this.updater.startUpdate(),this}stopUpdate(){return this.updater.stopUpdate(),this}clear(){return this.updater.clear(),this}getData(){return this.table.getValue(...arguments)}cloneData(){return this.table.cloneValue(...arguments)}getItemRef(a,b,c){return Ea(this,a,b,c)}setData(...a){return Oi(this,...a)}removeData(...a){return Pi(this,...a)}incValue(...a){return Qi(this,...a)}transaction(...a){return Ri(this,...a)}updateData(a){return Si(this,a)}removeDataOnDisconnect(...a){return Ti(this,...a)}setDataOnDisconnect(...a){return Ui(this,...a)}}const l_=Ia(Ja());var Gf;(function(a){a.d="d",a.w="w",a.m="m",a.y="y",a.day="d",a.week="w",a.month="m",a.year="y"})(Gf||(Gf={}));var Hc;(function(a){a.d="tagD",a.w="tagW",a.m="tagM",a.y="tagY"})(Hc||(Hc={}));var Ic;(function(a){a.d="scoreD",a.w="scoreW",a.m="scoreM",a.y="scoreY"})(Ic||(Ic={}));var bk;(function(a){a.d="day",a.w="week",a.m="month",a.y="year"})(bk||(bk={}));function Jf({query:a,totalLines:b=Infinity,linesPerPage:c=1e3,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g}){return tk({query:a,remainderLines:b,linesPerPage:c,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g})}function tk(a){let b=a.query;a.startDocRef&&(b=b[a.startMode](a.startDocRef));let c=Math.min(a.remainderLines,a.linesPerPage);return a.remainderLines-=c,b.limit(c).get().then(function(d){let e=a.remainderLines===0||d.size<c,f=!1;a.forEachPageCallback&&(f=a.forEachPageCallback(d)||!1),e=e||f;if(e){let g;return a.resolveCallback&&(g=a.resolveCallback()),Promise.resolve(g)}else return a.startDocRef=d.docs[d.size-1],a.startMode="startAfter",tk(a)})}function Ha(a,b=Infinity,c=0,d,e){let f=[],g=0;return Jf({query:a,totalLines:c+b,startDocRef:d,startMode:e,forEachPageCallback:function(j){let i,m=j.size,n=c-g;n<=0?i=j.docs:n<m&&(i=j.docs.slice(n,m)),i&&f.push(...i),g+=m},resolveCallback:function(){return f}})}const m1=Ia(Ja());function kk(a,b,c=0){return Ha(a.nextQuery,b,c,a.baselineDocRef,a.baselineMode).then(function(d){let e=d.length;return a.cacheItems=d,a.pageIndex=void 0,a.startItemIndex=c,a.endItemIndex=a.startItemIndex+e-1,a.isFullPage=b===void 0?!0:e===b,Promise.resolve(a.cacheItems)})}const M0=Ia(Ja());class ie{constructor({query:a={next:void 0,previous:void 0},itemCount:b=100,baselineDoc:c,baselineMode:d="startAt"}={}){this.setQuery(a),this.setItemCount(b),this.setBaselineDoc(c,d),this.pageIndex=void 0,this.baselineDocRef=void 0,this.baselineMode="startAt",this.startItemIndex=void 0,this.endItemIndex=void 0,this.cacheItems=void 0,this.isFullPage=void 0}setQuery(a,b){if(a instanceof M0.firestore.Query)this.nextQuery=a,this.prevQuery=b;else{var c=a;this.nextQuery=c.next,this.prevQuery=c.previous}return this.pageIndex=null,this.isFullPage=!0,this}setItemCount(a){return this.itemCount=a,this}setBaselineDoc(a,b){return a?(this.baselineDocRef=a.ref,this.baselineMode=b):this.baselineDocRef=void 0,this}load(a,b=0){return kk(this,a,b)}loadFirstPage(){return this._loadFirstPage()}loadNextPage(){return this.pageIndex==null?this._loadFirstPage():this._loadNextPage()}loadPreviousPage(){return this.pageIndex==null||this.pageIndex===1?this._loadFirstPage():this._loadPreviousPage()}loadCurrentPage(){return this.pageIndex==null||this.pageIndex===0?this._loadFirstPage():this._loadCurrentPage()}}function qk(a){return Ha(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=null,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function lk(a){return Ha(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,Promise.resolve(a.cacheItems)})}function rk(a){return Ha(a.nextQuery,a.itemCount,0,a.currPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=a.currPageEndDocRef,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function mk(a){let b=(a.pageIndex+1)*a.itemCount;return Ha(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function sk(a){return Ha(a.prevQuery,a.itemCount+1,0,a.currPageStartDocRef,"startAfter").then(function(b){let c=b.length-1;return a.cacheItems=b,a.cacheItems.pop(),a.cacheItems.reverse(),a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-c+1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=b[c].ref,a.currPageStartDocRef=b[c-1].ref,a.currPageEndDocRef=b[0].ref,Promise.resolve(a.cacheItems)})}function nk(a){let b=(a.pageIndex-1)*a.itemCount;return Ha(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-d+1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function pk(a){return Ha(a.nextQuery,a.itemCount,0,a.prevPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function ok(a){let b=a.pageIndex*a.itemCount;return Ha(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}class Hf extends ie{_loadFirstPage(){return lk(this)}_loadNextPage(){return mk(this)}_loadPreviousPage(){return nk(this)}_loadCurrentPage(){return ok(this)}}const Q$=Ia(Ja());class he extends ie{_loadFirstPage(){return qk(this)}_loadNextPage(){return rk(this)}_loadPreviousPage(){return sk(this)}_loadCurrentPage(){return pk(this)}}const I0=Ia(Ja());function dk(a,b){let c={senderID:a.userID,message:b,timestamp:I0.firestore.FieldValue.serverTimestamp()};return a.userName!==void 0&&(c.senderName=a.userName),a.receiverID!==void 0&&(c.receiverID=a.receiverID),a.rootRef.add(c)}function If(a,b=a.receiverID){let c=a.rootRef;return c=b!==void 0?c.where("receiverID","==",b):c,c}function ck(a,b=a.receiverID){let c=If(a,b),d=c.orderBy("timestamp"),e=c.orderBy("timestamp","desc");return{next:d,previous:e}}function ek(a){let b=If(a).orderBy("timestamp","desc").limit(1);a.unsubscribe=b.onSnapshot({includeMetadataChanges:!0},function(c){if(c.size>0){let d=c.docs[0];if(d.metadata.hasPendingWrites){a.skipFirst&&(a.skipFirst=!1);return}ik(a,a.receiverID,d);if(a.skipFirst)a.skipFirst=!1;else{let e=jk(d);a.cacheMessages.push(e),a.emit("receive",e)}}else a.skipFirst&&(a.skipFirst=!1)},function(c){debugger})}function fk(a){a.unsubscribe&&a.unsubscribe(),a.resetQueryFlag=!0,a.cacheMessages.length=0}function gk(a){return ik(a),a.page.loadNextPage().then(function(b){let c=[];for(let d=0,e=b.length;d<e;d++)c.push(jk(b[d]));return a.cacheMessages.splice(0,0,...c),Promise.resolve(c)})}function ik(a,b=a.receiverID,c){if(!a.resetQueryFlag)return;a.resetQueryFlag=!1;let d=a.skipFirst?"startAt":"startAfter";a.page.setBaselineDoc(c,d).setQuery(ck(a,b));return}function jk(a){let b=a.data();return b.timestamp=b.timestamp.toDate(),b}const A0=Ia(Ja());class hk extends Ca{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d="",receiverID:e,pageItemCount:f=100}={}){super();this.setEventEmitter(a),this.database=A0.firestore(),this.setRootPath(b),this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.skipFirst=!0,this.unsubscribe=void 0,this.page=new he(),this.setPageItemCount(f),this.resetQueryFlag=!0,this.cacheMessages=[]}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.resetQueryFlag=this.resetQueryFlag||this.rootPath!==a,this.rootPath=a,this.rootRef=this.database.collection(a),this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.resetQueryFlag=this.resetQueryFlag||this.receiverID!==a,this.receiverID=a,this}setPageItemCount(a){return this.page.setItemCount(a),this}get hasPreviousMessage(){return this.page.isFullPage!==!1}send(a){return dk(this,a)}startReceiving(){return ek(this),this}stopReceiving(){return fk(this),this}loadPreviousMessages(){return gk(this)}}const Xi={join:"join",leave:"leave",update:"update",change:"change",init:"init",changename:"changename"};var jb;(function(a){a[a.once=0]="once",a[a.child=1]="child",a[a.all=2]="all"})(jb||(jb={}));const Sj={update:"update",add:"add",remove:"remove",change:"change"};function fe(a){a.items.length=0,a.itemID2Index.clear()}function Tj(a){return a.items}function Uj(a,b){return a.itemID2Index.has(b)}function Af(a,b){return b==null?null:a.itemID2Index.get(b)}function Vj(a,b){if(b==null)return null;let c=Af(a,b);return c==null?null:a.items[c]}function Wj(a,b,c){a.items.forEach(b,c)}function tb(a){a.itemID2Index.clear();let b=a.items;for(var c=0,d=b.length;c<d;c++){let e=b[c][a.keyItemID];a.itemID2Index.set(e,c)}}function Xj(a,b){if(b>=a.length)return;let c=a.length-1,d=a[b];for(let e=b;e<c;e++)a[e]=a[e+1];return a.length=c,d}function Bf(a,b){let c=Df.call(this,a,b);tb(this),this.emit(this.eventNames.add,c),this.emit(this.eventNames.update,this.items)}function Fc(a,b){let c=Yj.call(this,a);tb(this);let d=Df.call(this,a,b);tb(this),this.emit(this.eventNames.change,d,c),this.emit(this.eventNames.update,this.items)}function Cf(a){let b=Yj.call(this,a);tb(this),this.emit(this.eventNames.remove,b),this.emit(this.eventNames.update,this.items)}function Gc(a){fe(this),a.forEach(function(b){Df.call(this,b,null,!0)}.bind(this)),tb(this),this.emit(this.eventNames.update,this.items)}function Df(a,b,c=!1){let d,e=this.getItemCallback,f=this.getItemCallbackScope;f?d=e.call(f,a):d=e(a);if(c)return this.items.push(d),d;if(b==null)this.items.unshift(d);else{let g=this.itemID2Index.get(b);g===this.items.length-1?this.items.push(d):this.items.splice(g+1,0,d)}return d}function Yj(a){let b=this.itemID2Index.get(a.key),c=Xj(this.items,b);return c}const $j={start(a,b){a.isUpdating=!1,b.once("value",Gc,a)},stop(a){}};const _j={start(a,b){b.on("child_added",Bf,a),b.on("child_removed",Cf,a),b.on("child_moved",Fc,a),b.on("child_changed",Fc,a)},stop(a){a.query.off("child_added",Bf,a),a.query.off("child_removed",Cf,a),a.query.off("child_moved",Fc,a),a.query.off("child_changed",Fc,a)}};const Zj={start(a,b){b.on("value",Gc,a)},stop(a){a.query.off("value",Gc,a)}};const Ec={};Ec[jb.all]=Zj;Ec[jb.child]=_j;Ec[jb.once]=$j;class Jb extends Ca{constructor({eventEmitter:a,itemIDKey:b="__itemID__",mode:c=jb.child,getItemCallback:d=Sm,getItemCallbackScope:e,query:f,eventNames:g=Sj}={}){super();this.setEventEmitter(a),this.eventNames=g,this.isUpdating=!1,this.items=[],this.itemID2Index=new Map(),this.setItemIDKey(b),this.setMode(c),e===void 0&&(e=this),this.setGetitemCallback(d,e),this.setQuery(f)}destroy(){this.stopUpdate().clear()}setItemIDKey(a){return this.keyItemID=a,this}setMode(a){return typeof a==="string"&&(a=jb[a]),this.mode=a,this.updater=Ec[a],this}setGetitemCallback(a,b){return this.getItemCallback=a,this.getItemCallbackScope=b,this}setQuery(a){return this.query=a,this}startUpdate(a){if(a)this.setQuery(a);else if(this.query)a=this.query;else return this;return this.stopUpdate().clear(),this.isUpdating=!0,this.updater.start(this,a),this}stopUpdate(){return!this.query||!this.isUpdating?this:(this.isUpdating=!1,this.updater.stop(this),this)}clear(){return fe(this),this}getItems(){return Tj(this)}hasItem(a){return Uj(this,a)}getItemIndexFromItemID(a){return Af(this,a)}getItemFromItemID(a){return Vj(this,a)}forEach(a,b){return Wj(this,a,b),this}updateItemID2Index(){return tb(this),this}}const Sm=function(a){let b=a.val();return b[this.keyItemID]=a.key,b};function rb(a,b=a.userID){return a.userID2ItemID.has(b)}function Ud(a,b=a.userID){if(!rb(a,b))return null;let c=a.userID2ItemID.get(b);return a.rootRef.child(c)}function $i(a,b=a.userID){if(!rb(a,b))return null;let c=a.userID2ItemID.get(b);return a.userList.getItemFromItemID(c)}function zf(a){return a.userList.getItems()}function aj(a){a.userList.clear()}function bj(a,b,c){a.userList.forEach(b,c)}function cj(a,b=a.userID){let c=a.userList.getItems()[0];return c&&c.userID===b}function dj(a){return a.maxUsers===0?!1:a.userList.getItems().length>=a.maxUsers}function Yi(a=0,b){return new Promise(function(c,d){setTimeout(function(){c(b)},a)})}function Zi(a,b=a.userID,c=a.userName){if(rb(a,b))return Promise.resolve();let d={userID:b,userName:c},e=a.maxUsers,f=a.database.ref(a.rootPath),g=f.push();return g.onDisconnect().remove().then(function(){return g.set(d)}).then(function(){return Yi(0)}).then(function(){return e===0?(a.isInList=!0,Promise.resolve()):f.limitToFirst(e).once("value").then(function(j){return Gm(j,b)?(a.isInList=!0,Promise.resolve()):(a.isInList=!1,g.remove().then(function(){return g.onDisconnect().cancel()}).then(function(){return Promise.reject()}))})})}function Gm(a,b){let c=!1;return a.forEach(function(d){let e=d.val();if(e.userID===b)return c=!0,!0}),c}function _i(a,b=a.userID){if(!rb(a,b))return Promise.resolve();let c=a.userID2ItemID.get(b),d=a.database.ref(a.rootPath).child(c);return d.remove()}function Wi(a,b){return new Promise(function(c,d){let e=Ud(a);if(e)return c(e);{let f=a.rootRef.orderByChild("userID").equalTo(a.userID);f.once("child_added").then(function(g){return c(g.ref)})}}).then(function(c){return c.child("userName").set(b)}).then(function(){return a.userName=b,Promise.resolve()})}const _W=Ia(Ja());class fc extends Ca{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,eventNames:f=Xi}={}){super();this.setEventEmitter(a),this.eventNames=f,this.database=_W.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.setMaxUsers(e),this.userList=new Jb({eventEmitter:this.eventEmitter,itemIDKey:"joinAt",eventNames:{add:f.join,remove:f.leave,update:f.update,change:f.change}}),this.isInList=!1,this.userID2ItemID=new Map(),this.userList.on(this.eventNames.join,function(g){this.userID2ItemID.set(g.userID,g.joinAt),g.userID===this.userInfo.userID&&this.emit(this.eventNames.init,zf(this))},this).on(this.eventNames.leave,function(g){this.userID2ItemID.delete(g.userID),g.userID===this.userID&&(this.isInList=!1)},this).on(this.eventNames.change,function(g,j){let i=g.userID,m=g.userName,n=j.userName;m!==n&&this.emit(this.eventNames.changename,i,m,n)},this)}destroy(){this.stopUpdate().destroyEventEmitter().leave(),this.userList.destroy()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setMaxUsers(a){return this.maxUsers=a,this}clear(){return aj(this),this}forEach(a,b){return bj(this,a,b),this}isFull(){return dj(this)}isFirstUser(a=this.userID){return cj(this,a)}getUser(a=this.userID){return $i(this,a)}getUsers(){return zf(this)}getUserRef(a=this.userID){return Ud(this,a)}contains(a=this.userID){return rb(this,a)}join(a=this.userID,b=this.userName){return Zi(this,a,b)}leave(a=this.userID){return _i(this,a)}changeUserName(a){return Wi(this,a)}startUpdate(){let a=this.rootRef;return this.maxUsers>0&&(a=a.limitToFirst(this.maxUsers)),this.userList.startUpdate(a),this}stopUpdate(){return this.userList.stopUpdate(),this}}function qj(a){const b=new fc({eventEmitter:a.eventEmitter,eventNames:{join:"userlist.join",leave:"userlist.leave",update:"userlist.update",change:"userlist.change",init:"userlist.init",changename:"userlist.changename"},userID:a.userInfo});return b.on("userlist.leave",function(c){c.userID===a.userID&&Lm(a)}),a.on("room.join",function(){b.startUpdate()}).on("room.leave",function(){b.stopUpdate().clear()}),b}function Lm(a){a.emit("room.leave"),setTimeout(function(){a.roomID=void 0,a.roomName=void 0,a.doorState=void 0,a.leftRoomFlag=!1},0)}function nj(a){const b=new Jb({eventEmitter:a.eventEmitter,itemIDKey:"roomID",eventNames:{update:"roomlist.update",add:"roomlist.add",remove:"roomlist.remove",change:"roomlist.change"},mode:"once"});return b}function xj(a){return a.split("|")[0]}function wj(a){return a.split("|")[1]}function gc(a,b=""){return`${a}|${b}`}function ab(a,b){let c=a.rootRef;return b&&(c=c.child(b)),c}function Dc(a,b,c){let d=ab(a,"rooms");return b!==void 0&&(d=d.child(b),c!==void 0&&(d=d.child(c))),d}function mj(a,b){return Dc(a,b,"alive")}function rj(a,b){return Dc(a,b,"users")}function Cc(a,b){let c=ab(a,"room-filters");return b!==void 0&&(c=c.child(b)),c}function hc(a,b){let c=ab(a,"room-metadata");return b!==void 0&&(c=c.child(b)),c}function Wd(a,b,c){let d=`${a.rootPath}/rooms/${b}`;return c&&(d+=`/${c}`),d}function Zd(a,b){return Wd(a,b,"users")}function oj(a,b,c){let d=Wd(a,b,"tables");return c&&(d+=`/${c}`),d}function sj(a,b,c="open"){let d=Cc(a);return d=d.orderByChild("filter"),b===void 0?d=d.startAt(c).endAt(`${c}~`):d=d.equalTo(gc(c,b)),d}function jj(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new dc({eventEmitter:a.eventEmitter,eventNames:{receive:"broadcast.receive"},receiverID:"boradcast",senderID:a.userInfo,history:b.history});return a.on("room.join",function(d){c.setRootPath(Wd(a,d.roomID)).startReceiving()}).on("room.leave",function(){c.stopReceiving()}).on("userlist.changename",function(d,e){c.changeUserName(d,e)}),c}function pj(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,Km(a,d))}),a.on("room.join",function(d){for(const[e,f]of c)f.setRootPath(oj(a,d.roomID,e)).startUpdate()}).on("room.leave",function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function Km(a,{key:b,type:c=ra["1d"]}){const d=new ec({eventEmitter:a.eventEmitter,type:c,eventNames:{init:`tables.${b}.init`,update:`tables.${b}.update`,addkey0:`tables.${b}.addkey0`,removekey0:`tables.${b}.removekey0`,changekey0:`tables.${b}.changekey0`,addkey1:`tables.${b}.addkey1`,removekey1:`tables.${b}.removekey1`,changekey1:`tables.${b}.changekey1`,addkey2:`tables.${b}.addkey2`,removekey2:`tables.${b}.removekey2`,changekey2:`tables.${b}.changekey2`}});return d}function Oa(a,b=a.roomID,c=a.roomName){return{roomID:b,roomName:c}}function be(a,b){return b===void 0?a.roomID!==void 0:a.roomID===b}function Aj(a){return a.userList.isFull()}function Bj(a,b=a.userID){return a.userList.isFirstUser(b)}function Cj(a){return a.userList.getUsers()}function _d(a,b,c,d){a.roomID=b,a.roomName=c,a.roomType=d,a.emit("room.join",Oa(a))}function Yd(a,b={}){return b.roomID==null&&(b.roomID=Dc(a).push().key),Im(a,b.roomID).then(function(){return Jm(a,b)})}function Im(a,b){return mj(a,b).transaction(function(c){return c===null?!0:void 0})}function Jm(a,{roomID:b,roomName:c="",roomType:d="",maxUsers:e=0,presisted:f=!1,door:g="open",join:j=!0,filterData:i}){let m=Dc(a,b),n=Cc(a,b),u=hc(a,b);a.isRemoveRoomWhenLeft=!f,a.isRemoveRoomWhenLeft&&(m.onDisconnect().remove(),n.onDisconnect().remove(),u.onDisconnect().remove());const w=gc(g,d),B={},C={filter:w,name:c};i&&(C.data=i),B[`room-filters/${b}`]=C;const G={name:c,filter:w,maxUsers:e,moderators:{}};return G.moderators[a.userID]=a.userName,B[`room-metadata/${b}`]=G,new Promise(function(I,L){if(j){const R=a.userList.setRootPath(Zd(a,b)).setMaxUsers(0).join();return a.userList.setMaxUsers(e),R.then(I,L)}else return I()}).then(function(){return ab(a).update(B)}).then(function(){return a.isRoomCreator=!0,j&&_d(a,b,c,d),Promise.resolve(Oa(a))})}function kj(a,{digits:b=10,candidates:c="0123456789",retry:d=1e3}){let e=arguments[1];return lj(a,b,c,d,e)}function lj(a,b,c,d,e){return e.roomID=Xd(b,b,c),d<=0?Promise.reject(e):(d--,Yd(a,e).catch(function(){return lj(a,b,c,d,e)}))}function ce(a,b=a.roomID){const c={};c[`room-filter/${b}`]=null,c[`room-metadata/${b}`]=null,c[`rooms/${b}`]=null;const d=Oa(a);return ab(a).update(c).then(function(){return Promise.resolve(d)})}function ic(a){if(!be(a))return Promise.resolve(Oa(a));a.leftRoomFlag=!0;if(a.isRemoveRoomWhenLeft)return ce(a);{const b=Oa(a);return a.userList.leave().then(function(){return Promise.resolve(b)})}}function ae(a,{leftThenJoin:b=!0,roomID:c}){return b?ic(a).then(function(){return yj(a,c)}):yj(a,c)}function yj(a,b){return b==null?Promise.reject(Oa(a,b,"")):(a.isRemoveRoomWhenLeft=!1,Mm(a,b).then(function(c){return a.userList.setRootPath(Zd(a,b)).setMaxUsers(c.maxUsers).join().then(function(){return Promise.resolve(c)})}).then(function(c){return _d(a,b,c.name,wj(c.filter)),Promise.resolve(Oa(a))}))}function Mm(a,b){return hc(a,b).once("value").then(function(c){let d=c.val();return Nm(a,d)?Promise.resolve(d):Promise.reject()})}function Nm(a,b){if(b==null)return!1;if(xj(b.filter)==="closed")return!1;const c=a.userID;if(b.moderators[c])return!0;switch(b.permission){case"blocklist":const d=b.blocklist;return!(d&&d[c]);case"allowlist":const e=b.allowlist;return e&&e[c];default:return!0}}function $d(a,b,c){return new Promise(function(d,e){a.roomList.once("roomlist.update",function(f){d(f)}).startUpdate(sj(a,b,c))})}function uj(a,{roomType:b="",leftThenJoin:c=!0}={}){return $d(a,b,"open").then(function(d){if(d.length===0)return Promise.reject("No filtered room");Qd(d);const e={leftThenJoin:c,roomID:""};return vj(a,e,d)})}function vj(a,b,c,d=0){return d===c.length?Promise.reject("Can't join any room"):(b.roomID=c[d].roomID,d++,ae(a,b).catch(function(){return vj(a,b,c,d)}))}function zj(a,b){return a.userList.contains(b)?b===a.userID?ic(a):a.userList.leave(b):Promise.resolve()}function sb(a,b){return b===a.roomID?Promise.resolve(!0):hc(a,b).once("value").then(function(c){const d=c.val()!==null;return Promise.resolve(d)})}function Vd(a,b,c=a.roomID){return sb(a,c).then(function(d){if(!d)return Promise.resolve();const e=gc(b,a.roomType),f={};return f[`room-filters/${c}/filter`]=e,f[`room-metadata/${c}/filter`]=e,ab(a).update(f)})}function gj(a,b=a.roomID){return Vd(a,"open",b)}function hj(a,b=a.roomID){return Vd(a,"closed",b)}function ej(a,b,c=a.roomID){return sb(a,c).then(function(d){return d?Cc(a,c).child("data").update(b):Promise.resolve()})}function ij(a,b){return a.userList.changeUserName(b)}function fj(a,b,c=a.roomID){return sb(a,c).then(function(d){if(!d)return Promise.resolve();const e={};return e[`room-filters/${c}/name`]=b,e[`room-metadata/${c}/name`]=b,ab(a).update(e)})}function tj(a,b=a.roomID){return b===a.roomID?a.userList.getUsers():new Promise(function(c,d){const e=new Jb({itemIDKey:"joinAt",mode:"once"});e.once("update",function(f){c(f)}).startUpdate(rj(a,b))})}const vY=Ia(Ja());class Dj extends Ca{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",broadcast:e=!0,tables:f=!1}={}){super();this.setEventEmitter(a),this.database=vY.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.isRoomCreator=!1,this.roomID=void 0,this.roomName=void 0,this.roomType=void 0,this.doorState=void 0,this.leftRoomFlag=!1,this.isRemoveRoomWhenLeft=void 0,this.userList=qj(this),this.roomList=nj(this),this.broadcast=jj(this,e),this.tables=pj(this,f)}destroy(){var a=this;this.destroyEventEmitter().leaveRoom().then(function(){a.userList.destroy(),a.userList=void 0,a.roomList.destroy(),a.roomList=void 0,a.broadcast.destroy(),a.broadcast=void 0})}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}getRoomInfo(a,b){return Oa(this,a,b)}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(a){return be(this,a)}isFull(){return Aj(this)}isFirstUser(a=this.userID){return Bj(this,a)}getUsers(){return Cj(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}createRoom(a){return Yd(this,a)}createRandomRoom(a={}){return kj(this,a)}joinRoom(a){return ae(this,a)}joinRandomRoom(a={}){return uj(this,a)}leaveRoom(){return ic(this)}removeRoom(a=this.roomID){return ce(this,a)}kickUser(a){return zj(this,a)}changeRoomState(a,b=this.roomID){return Vd(this,a,b)}openRoom(a=this.roomID){return gj(this,a)}closeRoom(a=this.roomID){return hj(this,a)}changeUserName(a){return ij(this,a)}changeFilterData(a,b=this.roomID){return ej(this,a,b)}changeRoomName(a,b,c=a.roomID){return fj(this,b,c)}getUserList(a=this.roomID){return tj(this,a)}getRoomList(a,b){return $d(this,a,b)}HasRoom(a){return sb(this,a)}}function Kj(a,b){let c=a.rootPath;return b&&(c+=`/${b}`),c}function Ij(a){return Kj(a,"users")}function Gj(a,b){return`${Kj(a,"tables")}/${b}`}function Jj(a,b=0){const c=new fc({eventEmitter:a.eventEmitter,eventNames:{join:"userlist.join",leave:"userlist.leave",update:"userlist.update",change:"userlist.change",init:"userlist.init",changename:"userlist.changename"},root:Ij(a),userID:a.userInfo,maxUsers:b});return c.on("userlist.leave",function(d){d.userID===a.userID&&Qm(a)}),a.on("room.join",function(){c.startUpdate()}).on("room.leave",function(){c.stopUpdate().clear()}),c}function Qm(a){a.emit("room.leave"),setTimeout(function(){a.leftRoomFlag=!1},0)}function Fj(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new dc({eventEmitter:a.eventEmitter,eventNames:{receive:"broadcast.receive"},receiverID:"broadcast",senderID:a.userInfo,history:b.history});return a.on("room.join",function(){c.setRootPath(a.rootPath).startReceiving()}).on("room.leave",function(){c.stopReceiving()}).on("userlist.changename",function(d,e){c.changeUserName(d,e)}),c}function Hj(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,Pm(a,d))}),a.on("room.join",function(){for(const[d,e]of c)e.setRootPath(Gj(a,d)).startUpdate()}).on("room.leave",function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function Pm(a,{key:b,type:c=ra["1d"]}){const d=new ec({eventEmitter:a.eventEmitter,type:c,eventNames:{init:`tables.${b}.init`,update:`tables.${b}.update`,addkey0:`tables.${b}.addkey0`,removekey0:`tables.${b}.removekey0`,changekey0:`tables.${b}.changekey0`,addkey1:`tables.${b}.addkey1`,removekey1:`tables.${b}.removekey1`,changekey1:`tables.${b}.changekey1`,addkey2:`tables.${b}.addkey2`,removekey2:`tables.${b}.removekey2`,changekey2:`tables.${b}.changekey2`}});return d}function ee(a){return a.userList.isInList}function Oj(a){return a.userList.isFull()}function Pj(a,b=a.userID){return a.userList.isFirstUser(b)}function Qj(a){return a.userList.getUsers()}function Mj(a){return a.userList.join().then(function(){return a.emit("room.join"),Promise.resolve()})}function de(a){return ee(a)?(a.leftRoomFlag=!0,a.userList.leave()):Promise.resolve()}function Lj(a){return a.userList.getUsers()}function Nj(a,b){return a.userList.contains(b)?b===a.userID?de(a):a.userList.leave(b):Promise.resolve()}function Ej(a,b){return a.userList.changeUserName(b)}const mZ=Ia(Ja());class Rj extends Ca{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,broadcast:f=!0,tables:g=!1}={}){const j=arguments[0];super();this.setEventEmitter(a),this.database=mZ.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.leftRoomFlag=!1,this.userList=Jj(this,e),this.broadcast=Fj(this,f),this.tables=Hj(this,g)}shutdown(){}destroy(){this.shutdown()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(){return ee(this)}isFull(){return Oj(this)}isFirstUser(a=this.userID){return Pj(this,a)}getUsers(){return Qj(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}joinRoom(){return Mj(this)}leaveRoom(){return de(this)}getUserList(){return Lj(this)}kickUser(a){return Nj(this,a)}changeUserName(a){return Ej(this,a)}}class _f extends Ca{constructor({eventEmitter:a=!0}={}){super();this.enable=!0;a&&this.setEventEmitter()}destroy(){this.destroyEventEmitter()}toJSON(){return{curState:this.state,prevState:this.prevState,enable:this.enable,start:this._start}}setEnable(a=!0){return this.enable=a,this}set state(a){if(!this.enable||this._stateLock)return;if(this._state===a)return;this._prevState=this._state,this._state=a,this._stateLock=!0,this.emit("statechange",this);if(this._prevState!=null){let b=`exit_${this._prevState}`,c=this[b];c&&c.call(this),this.emit(b,this)}this._stateLock=!1;if(this._state!=null){let b=`enter_${this._state}`,c=this[b];c&&c.call(this),this.emit(b,this)}}get state(){return this._state}get prevState(){return this._prevState}start(a){return this._start=a,this._prevState=void 0,this._state=a,this}goto(a){return a!=null&&(this.state=a),this}next(){let a,b=this["next_"+this.state];return b?(typeof b==="string"?a=b:a=b.call(this),this.goto(a),this):this}update(a,b,c="update"){let d=this[`${c}_${this.state}`];d&&d.call(this,a,b)}preupdate(a,b){this.update(a,b,"preupdate")}postupdate(a,b){this.update(a,b,"postupdate")}addState(a,{next:b,exit:c,enter:d}){return b&&(this[`next_${a}`]=b),c&&(this[`exit_${a}`]=c),d&&(this[`enter_${a}`]=d),this}addStates(a){for(const b in a)this.addState(b,a[b]);return this}}var $f;(function(a){a[a.shuffle=0]="shuffle",a[a.random=1]="random"})($f||($f={}));const l7=Ia(hl());var ag;(function(a){a[a.none=0]="none",a[a.base64=1]="base64",a[a.utf16=2]="utf16",a[a.uri=3]="uri"})(ag||(ag={}));var Pa;(function(a){a[a.none=0]="none",a[a.word=1]="word",a[a.char=2]="char"})(Pa||(Pa={}));var wa;(function(a){a[a.none=0]="none",a[a.raw=1]="raw",a[a.wrapped=2]="wrapped"})(wa||(wa={}));const Pn=/(?:\r\n|\r|\n)/;function Jk(a,b,c,d,e,f=0){e<=0&&(d=0);let g=[];if(!a||!a.length)return g;let j=a.split(Pn),i;for(let m=0,n=j.length;m<n;m++){let u=j[m],w=m===n-1?0:1;if(d===0){g.push(Nc(u,b(u,c),w));continue}m===0?i=e-f:i=e;if(u.length<=100){let L=b(u,c);if(L<=i){g.push(Nc(u,L,w));continue}}let B;d===1?B=u.split(" "):B=u;let C="",G="",I=0;for(let L=0,R=B.length;L<R;L++){let N=B[L];d===1?(C+=N,L<R-1&&(C+=" ")):C+=N;let O=b(C,c);O>i&&(L===0?g.push(Nc("",0,2)):(g.push(Nc(G,I,2)),C=N,d===1&&(L<R-1&&(C+=" ")),O=b(C,c)),i=e),G=C,I=O}g.push(Nc(G,I,w))}return g}let Nc=function(a,b,c){return{text:a,width:b,newLineMode:c}};var Kb;(function(a){a[a.left=0]="left",a[a.center=1]="center",a[a.right=2]="right"})(Kb||(Kb={}));var Lb;(function(a){a[a.top=0]="top",a[a.center=1]="center",a[a.bottom=2]="bottom"})(Lb||(Lb={}));class Xf{constructor(){this.pens=[]}destroy(){this.pens.length=0}addPen(a){return this.pens.push(a),this}get firstPen(){return this.pens[0]}get lastPen(){return this.pens[this.pens.length-1]}hasPen(){return this.pens.length>0}get pensCount(){return this.pens.length}get startIndex(){let a=this.pens[0];return a?a.startIndex:0}get width(){let a=this.lastPen;return a?a.lastX:0}}function Kc(a,b=Array.isArray(a)?[]:{}){se(b);if(Array.isArray(a)){b.length=a.length;for(let c=0,d=a.length;c<d;c++)b[c]=a[c]}else for(let c in a)b[c]=a[c];return b}class Yf{constructor(){this.text="";this.x=0;this.y=0;this.width=0;this.height=0;this.ascent=0;this.prop={};this.newLineMode=wa.none;this.startIndex=0}set(a="",b=0,c=0,d=0,e=0,f=0,g={},j=wa.none,i=0){return this.text=a,this.x=b,this.y=c,this.width=d,this.height=e,this.ascent=f,this.prop=g,this.newLineMode=j,this.startIndex=i,this}clone(){let a=new Yf();return a.set(this.text,this.x,this.y,this.ascent,this.width,this.height,Kc(this.prop),this.newLineMode,this.startIndex),a}get plainText(){return this.newLineMode===wa.raw?`${this.text}
`:this.text}get wrapText(){return this.newLineMode!==wa.none?`${this.text}
`:this.text}get plainTextLength(){let a=this.text.length;return this.newLineMode===wa.raw&&(a+=1),a}get endIndex(){return this.startIndex+this.plainTextLength}get lastX(){return this.x+this.width}get isTextPen(){return this.text!==""}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}}class Jc{constructor({penPool:a}){this.pens=[];this.lines=[];this.pens=[],this.lines=[],this.penPool=a}destroy(){this.freePens()}freePens(){return this.penPool.pushMultiple(this.pens),this.lines.forEach(a=>{a.destroy()}),this.lines.length=0,this.totalLineHeight=0,this}addTextPen(a,b,c,d,e,f,g,j=wa.none){let i=this.penPool.pop();return i==null&&(i=new Yf()),i.set(a,b,c,d,e,f,g,j),this.addPen(i),this}addImagePen(a,b,c,d,e){return this.addTextPen(null,a,b,c,d,0,e,wa.none),this}addNewLinePen(){let a=this.lastPen;return a&&(a.newLineMode=wa.wrapped),this}addPen(a){let b=this.lastPen;b==null?a.startIndex=0:a.startIndex=b.endIndex,this.pens.push(a);let c=this.lastLine;return c==null&&(c=new Xf(),this.lines.push(c)),c.addPen(a),a.newLineMode!==wa.none&&(c=new Xf(),this.lines.push(c)),this}clone(a){return a==null&&(a=new Jc({penPool:this.penPool})),a.freePens(),this.pens.forEach(b=>{a.addPen(b.clone())}),a}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(a){if(a>=this.lines.length)return this.getLineEndIndex(a);{let b=this.lines[a];if(!b)return 0;let c=b.firstPen;return c?c.startIndex:0}}getLineEndIndex(a){let b=this.lines.length;a>=b&&(a=b-1);for(let c=a;c>=0;c--){let d=this.lines[c];if(d&&d.hasPen())return d.lastPen.endIndex}return 0}getLineWidth(a){let b=this.lines[a];return b?b.width:0}getLineHeights(a=[]){return this.lines.forEach(function(b){a.push(b.height)}),a}get lineCount(){return this.lines.length}get plainText(){let a=[],b=this.pens;for(let c=0,d=b.length;c<d;c++)a.push(b[c].plainText);return a.join()}get plainTextLength(){let a=0;for(let b=0,c=this.pens.length;b<c;b++)a+=this.pens[b].plainTextLength;return a}getSliceTagText(a,b,c=0,d,e=!1){if(d===void 0){let m=this.lastPen;if(!m)return"";d=m.endIndex}let f=[],g;for(var j=0,i=this.pens.length;j<i;j++){let m=this.pens[j],n=m.endIndex;if(n<=c)continue;let u=e?m.wrapText:m.plainText,w=m.prop,B=m.startIndex,C=B>=c&&n<=d;C||(u=u.substring(c-B,d-B)),b?f.push(a.call(b,u,w,g)):f.push(a(u,w,g)),g=w;if(n>=d)break}return f.join()}}function me(a,b){a.font=b.font}function ne(a,b){a.textBaseline="alphabetic",a.textAlign="start",a.fillStyle=b.fillStyle,a.strokeStyle=b.strokeStyle,a.lineWidth=b.strokeThickness,a.lineCap="round",a.lineJoin="round",a.imageSmoothingEnabled=b.antialias}function Vf(a,b,c){c?(a.shadowOffsetX=b.shadowOffsetX,a.shadowOffsetY=b.shadowOffsetY,a.shadowColor=b.shadowColor,a.shadowBlur=b.shadowBlur):(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowColor="#000",a.shadowBlur=0)}function Hk(a,b){return b.measureText(a).width}function Ik(a,b,c=0){let d=b.measureText(a),e=d.actualBoundingBoxAscent,f=d.actualBoundingBoxDescent;return(!e&&!f||a==="")&&(e=c,f=0),oe.ascent=e,oe.descent=f,oe.height=Math.ceil(Math.abs(e)+Math.abs(f)),oe}let oe={ascent:0,descent:0,height:0};function Ck(a,b,c,d,e){a.freePens();if(b==="")return a;let f=c.canvas,g=c.context,j=c.parent,i=c.parser.splitText(b),m,n,u=0;for(var w=0,B=i.length;w<B;w++){let N=c.parser.tagTextToProp(i[w],m),O=N.text;m=N.prop;if(m.img){let _,X;c.imageManager?(_=c.imageManager.getOuterWidth(m.img),X=c.imageManager.getOuterHeight(m.img)):(_=0,X=0),e>0&&d!==Pa.none&&(e<u+_&&(a.addNewLinePen(),u=0)),a.addImagePen(u,0,_,X,Kc(m)),u+=_}else if(O!==""){g.save();let _=c.parser.propToStyle(j,m);me(g,_),ne(g,_);let X=_.strokeThickness,P=X/2;n=Jk(O,Hk,g,d,e,u);let q=Ik("|MÃq",g);for(let r=0,h=n.length;r<h;r++){let l=n[r],k=q.height+X,p=q.ascent+P;a.addTextPen(l.text,u,0,l.width,k,p,Kc(m),l.newLineMode),l.newLineMode!==wa.none?u=0:u+=l.width}g.restore()}}let C=c.parent.lineSpacing,G=0,I=0,L=0,R=0;return a.lines[0].pens.forEach(function(N){I=Math.max(I,N.ascent)}),a.lines.forEach(function(N){G=0,N.pens.forEach(function(O){O.y+=I,G=Math.max(G,O.height)}),N.y=I,N.height=G,I+=G+C,L=Math.max(L,N.width),R+=G+C}),a.maxLineWidth=L,a.totalLineHeight=R-C,a}const ah={PI2:Math.PI*2,HALF_PI:Math.PI*.5,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};class kn extends Fa{constructor(a,b,c,d,e){super(a,b,c,d);this.name=e}}class Ek{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return this.hitAreas.length=0,this}add(a,b,c,d,e){let f=new kn(b,c,d,e,a);return this.hitAreas.push(f),this}getFirstHitArea(a,b){for(let c=0,d=this.hitAreas.length;c<d;c++){let e=this.hitAreas[c];if(e.contains(a,b))return e}return null}}function Dk(a,b=0,c=0,d=a.textWidth,e=a.textHeight,f=a.penManager){a.hitAreaManager&&a.hitAreaManager.clear();let g=f.totalLineHeight;if(g===0)return;let j=a.context;j.save();let i=a.parent;fn(a,i),b+=a.startXOffset,c+=a.startYOffset;let m=i.halign,n=i.valign,u=c;switch(n){case Lb.center:u+=(e-g)/2;break;case Lb.bottom:u+=e-g-2;break}let w=f.lines;for(let B=0,C=w.length;B<C;B++){let G=w[B],I=G.width;if(I===0)continue;let L=b;switch(m){case Kb.center:L+=(d-I)/2;break;case Kb.right:L+=d-I;break}let R=G.pens;for(let N=0,O=R.length;N<O;N++)en(a,R[N],L,u)}j.restore()}function en(a,b,c,d){c+=b.x,d+=b.y;let e=a.canvas,f=a.context,g=a.parent;f.save();let j=a.parser.propToStyle(g,b.prop);me(f,j),ne(f,j),j.underlineThickness>0&&b.width>0&&gn(a,c,d,b.width,j),b.isTextPen&&hn(a,c,d,b.text,j),b.isImagePen&&jn(a,c,d,b.prop.img,j),f.restore(),b.hasAreaMarker&&b.width>0&&(a.hitAreaManager||(a.hitAreaManager=new Ek()),a.hitAreaManager.add(b.prop.area,c,d-a.startYOffset,b.width,b.height))}function fn(a,b){let c=a.canvas,d=a.context;const e=b.backgroundFillStyle,f=b.backgroundStrokeStyle;if(e||f){const g=b.backgroundStrokeThickness,j=g/2,i=b.cornerRadius,m=j,n=j,u=c.width-g,w=c.height-g;Wf(c,d,m,n,u,w,i,e,f,g)}else d.clearRect(0,0,c.width,c.height)}function gn(a,b,c,d,e){c+=e.underlineOffset-e.underlineThickness/2;let f=a.context,g=f.lineCap;f.lineCap="butt",f.beginPath(),f.strokeStyle=e.underlineStyle,f.lineWidth=e.underlineThickness,f.moveTo(b,c),f.lineTo(b+d,c),f.stroke(),f.lineCap=g}function hn(a,b,c,d,e){let f=a.context;e.strokeThickness&&(Vf(f,e,e.shadowStroke),f.strokeText(d,b,c)),e.fillStyle&&e.fillStyle!=="none"&&(Vf(f,e,e.shadowFill),f.fillText(d,b,c))}function jn(a,b,c,d,e){let f=a.imageManager;if(!f)return;let g=f.get(d),j=f.getFrame(d);b+=g.left,c+=-a.startYOffset+g.y;let i=a.context;i.drawImage(j.texture.image,j.x,j.y,j.width,j.height,b,c,g.width,g.height)}class wk{constructor({canvas:a,context:b,parent:c,parser:d,penPool:e=new Mb()}){this.canvas=a,this.context=b,this.parser=d,this.parent=c,this.penPool=e,this.penManager=new Jc({penPool:e})}destroy(){this.canvas=null,this.context=null,this.parser=null,this.parent=null,this.penManager&&(this.penManager.destroy(),this.penManager=null),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=null),this.imageManager&&(this.imageManager.destroy(),this.imageManager=null),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=null)}get textWidth(){return this.penManager.maxLineWidth}get textHeight(){return this.penManager.totalLineHeight}updatePenManager(a,b,c,d=this.penManager){return Ck(d,a,this,b,c)}draw(a=0,b=0,c=this.textWidth,d=this.textHeight){return Dk(this,a,b,c,d,this.penManager),this}get startXOffset(){let a=this.parent.strokeStyle,b=this.parent.strokeThickness;return a!=null&&b!=null?b/2:0}get startYOffset(){let a=this.parent.strokeStyle,b=this.parent.strokeThickness;return a!=null&&b!=null?b/2:0}get lines(){return this.penManager.lines}get tmpPenManager(){return this._tmpPenManager===null&&(this._tmpPenManager=new Jc({penPool:this.penPool})),this._tmpPenManager}getPlainText(a,b,c){let d;return a==null?d=this.penManager.plainText:d=this.parser.splitText(a,!0).join(""),(b!=null||c!=null)&&(b==null&&(b=0),c==null&&(c=d.length),d=d.substring(b,c)),d}getPenManager(a,b){return a===void 0?this.clonePenManager(b,this.penManager):(b===void 0&&(b=new Jc({penPool:this.penPool})),this.updatePenManager(a,this.parent.wrapMode,this.parent.wrapWidth,b),b)}getText(a,b,c,d){if(a==null)return this.penManager.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d);let e=this.tmpPenManager;return this.updatePenManager(a,this.parent.wrapMode,this.parent.wrapWidth,e),e.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d)}clonePenManager(a,b=this.penManager){return b.clone(a)}getLastPen(a=this.penManager){return a.lastPen}}function xk(a){let b=a.canvasText;a.canvasText.updatePenManager(a.text,a.wrapMode,a.wrapWidth);let c=a.padding,d,e,f,g;a.fixedWidth===0?(d=b.textWidth,f=d+c.left+c.right):(f=a.fixedWidth,d=f-c.left-c.right,d<b.textWidth&&(d=b.textWidth)),a.fixedHeight===0?(e=b.textHeight,g=e+c.top+c.bottom):(g=a.fixedHeight,e=g-c.top-c.bottom,e<b.textHeight&&(e=b.textHeight));let j=a.resolution,i=Math.ceil(f*j),m=Math.ceil(g*j),n=a.canvas;(n.width!==i||n.height!==m)&&(n.width=i,n.height=m,a.texture.setSize(f,g),a.setSize(f,g));let u=a.context;u.save(),u.scale(j,j),b.draw(c.left,c.top,d,e),u.restore(),a.texture.binding&&a.texture.binding.update(),a.setDirty(aa.TEXTURE)}function Sf(a,b,c,d=0,e=0){c||(d=0),a.backgroundFillStyle=b,a.backgroundStrokeStyle=c,a.backgroundStrokeThickness=d,a.cornerRadius=e}function yk(a,b,c){b&&Tf(a,b),c&&Uf(a,c)}function Tf(a,b){a.fontFamily=b}function Uf(a,b){typeof b==="number"&&(b=`${b}px`),a.fontSize=b}function zk(a,b,c){a.fixedWidth=b,a.fixedHeight=c;if(a.wrapMode!==Pa.none){const d=a.padding;let e=b-d.left-d.right;a.wrapWidth=Math.max(e,0)}}function Ak(a,b,c=b,d=b,e=b){const f=a.padding;f.left=b,f.right=c,f.top=d,f.bottom=e}class Bk extends $c{constructor(a,b,c="",{backgroundFillStyle:d,backgroundStrokeStyle:e,backgroundStrokeThickness:f,cornerRadius:g=0,fontStyle:j,fontFamily:i,fontSize:m,fillStyle:n,strokeStyle:u}={},w){super(a,b,Ub());this.antialias=!1;this.fontFamily="monospace";this.fontSize="16px";this.fillStyle="#fff";this.halign=Kb.left;this.valign=Lb.top;this.lineSpacing=0;this.wrapMode=Pa.none;this.wrapWidth=0;this.fixedWidth=0;this.fixedHeight=0;this.padding={left:0,right:0,top:0,bottom:0};this.type="rexText";const B=va.get();this.resolution=B.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.canvasText=new wk({canvas:this.canvas,context:this.context,parent:this,parser:w}),Sf(this,d,e,f,g),i&&Tf(this,i),m&&Uf(this,m),n&&(this.fillStyle=n),this.setText(c)}destroy(a){this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}updateText(){return xk(this),this}get text(){return this._text}set text(a){this.setText(a)}setText(a="",b=!0){return Array.isArray(a)&&(a=a.join(`
`)),a!==this._text&&(this._text=a.toString(),b&&this.updateText()),this}setBackgroundStyle(a,b,c=2,d=0){return Sf(this,a,b,c,d),this}setFont(a,b){return yk(this,a,b),this}setFixedSize(a,b){return zk(this,a,b),this}setPadding(a,b=a,c=a,d=a){return Ak(this,a,b,c,d),this}}class Fk{}const Gk={font:void 0,fontFamily:void 0,fontStyle:void 0,fontSize:void 0,fillStyle:void 0,strokeStyle:void 0,strokeThickness:void 0,shadowColor:void 0,shadowOffsetX:void 0,shadowOffsetY:void 0,shadowBlur:void 0,shadowStroke:void 0,shadowFill:void 0,underlineStyle:void 0,underlineThickness:void 0,underlineOffset:void 0,image:void 0};class Kk extends Fk{splitText(a,b=!1){let c=[],d=0;for(;;){const f=Zf.exec(a);if(!f)break;const g=f[0],j=Zf.lastIndex-g.length;d<j&&c.push(a.substring(d,j)),b||c.push(g),d=Zf.lastIndex}let e=a.length;return d<e&&c.push(a.substring(d,e)),c}tagTextToProp(a,b){let c,d;b==null&&(b={}),b.img&&ua(b,cb,"img"),on.test(a)?(ua(b,Va,"b",!0),c=""):pn.test(a)?(ua(b,cb,"b"),c=""):qn.test(a)?(ua(b,Va,"i",!0),c=""):rn.test(a)?(ua(b,cb,"i"),c=""):Lk.test(a)?(d=a.match(Lk),ua(b,Va,"size",d[1]+"px"),c=""):sn.test(a)?(ua(b,cb,"size"),c=""):Mk.test(a)?(d=a.match(Mk),ua(b,Va,"color",d[1]),c=""):tn.test(a)?(ua(b,cb,"color"),c=""):Nk.test(a)?(d=a.match(Nk),ua(b,Va,"u",!0),c=""):Ok.test(a)?(d=a.match(Ok),ua(b,Va,"u",d[1]),c=""):un.test(a)?(ua(b,cb,"u"),c=""):vn.test(a)?(ua(b,Va,"shadow",!0),c=""):wn.test(a)?(ua(b,cb,"shadow"),c=""):xn.test(a)?(ua(b,Va,"stroke",!0),c=""):Pk.test(a)?(d=a.match(Pk),ua(b,Va,"stroke",d[1]),c=""):yn.test(a)?(ua(b,cb,"stroke"),c=""):Qk.test(a)?(d=a.match(Qk),ua(b,Va,"img",d[1]),c=""):zn.test(a)?(ua(b,cb,"img"),c=""):Rk.test(a)?(d=a.match(Rk),ua(b,Va,"area",d[1]),c=""):An.test(a)?(ua(b,cb,"area"),c=""):c=a;let e=mn;return e.text=c,e.prop=b,e}propToStyle(a,b){let c=Gk;return b.hasOwnProperty("img")?c.image=b.img:(c.image=null,c.fontFamily=a.fontFamily,b.hasOwnProperty("size")?c.fontSize=b.size:c.fontSize=a.fontSize,c.fontStyle=ln(b.b,b.i),c.font=`${c.fontStyle} ${c.fontSize} ${c.fontFamily}`,b.hasOwnProperty("color")?c.fillStyle=b.color:c.fillStyle=a.fillStyle,b.hasOwnProperty("stroke")?b.stroke===!0?(c.strokeStyle=a.strokeStyle,c.strokeThickness=a.strokeThickness):(c.strokeStyle=b.stroke,c.strokeThickness=a.strokeThickness):(c.strokeStyle=a.strokeStyle,c.strokeThickness=0)),b.hasOwnProperty("shadow")?b.shadow===!0?(c.shadowColor=a.shadowColor,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor=b.shadow,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor="#000",c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=0,c.shadowStroke=!1,c.shadowFill=!1),b.hasOwnProperty("u")?b.u===!0?(c.underlineStyle=a.underlineStyle,c.underlineThickness=a.underlineThickness,c.underlineOffset=a.underlineOffset):(c.underlineStyle=b.u,c.underlineThickness=a.underlineThickness,c.underlineOffset=a.underlineOffset):(c.underlineStyle="#000",c.underlineThickness=0,c.underlineOffset=0),c}propToTagText(a,b,c){c==null&&(c=nn);let d=[];for(const f in c){if(b.hasOwnProperty(f))continue;d.push(`[/${f}]`)}a=`${d.join()}${a}`;let e=[];for(const f in b){if(c[f]===b[f])continue;switch(f){case"size":const g=b.size.replace("px","");e.push(`[size=${g}]`);break;case"color":case"img":case"area":e.push(`[${f}=${b[f]}]`);break;case"stroke":case"u":b[f]===!0?e.push(`[${f}]`):e.push(`[${f}=${b[f]}]`);break;default:e.push(`[${f}]`);break}}return a=`${a}${e.join()}`,a}}const ua=function(a,b,c,d){return b===Va?a[c]=d:a.hasOwnProperty(c)&&delete a[c],a};var ln=function(a,b){return a&&b?"bold italic":a?"bold":b?"italic":""};const mn={text:null,prop:null},nn={},Zf=/\[b\]|\[\/b\]|\[i\]|\[\/i\]|\[size=(\d+)\]|\[\/size\]|\[color=([a-z]+|#[0-9abcdef]+)\]|\[\/color\]|\[u\]|\[u=([a-z]+|#[0-9abcdef]+)\]|\[\/u\]|\[shadow\]|\[\/shadow\]|\[stroke\]|\[stroke=([a-z]+|#[0-9abcdef]+)\]|\[\/stroke\]|\[img=([^\]]+)\]|\[\/img\]|\[area=([^\]]+)\]|\[\/area\]/ig;var on=/\[b\]/i,pn=/\[\/b\]/i,qn=/\[i\]/i,rn=/\[\/i\]/i,Lk=/\[size=(\d+)\]/i,sn=/\[\/size\]/i,Mk=/\[color=([a-z]+|#[0-9abcdef]+)\]/i,tn=/\[\/color\]/i,Nk=/\[u\]/i,Ok=/\[u=([a-z]+|#[0-9abcdef]+)\]/i,un=/\[\/u\]/i,vn=/\[shadow\]/i,wn=/\[\/shadow\]/i,xn=/\[stroke\]/i,Pk=/\[stroke=([a-z]+|#[0-9abcdef]+)\]/i,yn=/\[\/stroke\]/i,Qk=/\[img=([^\]]+)\]/i,zn=/\[\/img\]/i,Rk=/\[area=([^\]]+)\]/i,An=/\[\/area\]/i;const cb=!1,Va=!0;class Pc extends Bk{constructor(a,b,c="",d){super(a,b,c,d,new Kk());this.type="rexBBcodeText"}}var wf;(function(a){a[a.ascending=0]="ascending",a[a.descending=1]="descending",a[a.logical_ascending=2]="logical_ascending",a[a.logical_descending=3]="logical_descending"})(wf||(wf={}));class kl extends ng{constructor(){super();const a=new Ae(this),b=new Pc(400,300);Oc(a,b),b.setBackgroundStyle(null,"BurlyWood",4,20).setPadding(10).setFont("monospace",40).setText("[color=red]A[color=blue]B[color=green]C[/color]")}}new mg(ze(),ye(800,600),we("game"),ve(2960685),xe(kl));})();
/* @license
Papa Parse
v5.2.0
https://github.com/mholt/PapaParse
License: MIT
*/
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
//# sourceMappingURL=bundle.js.map

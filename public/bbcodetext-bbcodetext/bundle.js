(()=>{let Rc=Object.defineProperty,xh=Object.prototype.hasOwnProperty,eb=(a,b)=>()=>(b||(b={exports:{}},a(b.exports,b)),b.exports),yh=a=>Rc(a,"__esModule",{value:!0}),zb=(a,b)=>{yh(a);for(let c in b)Rc(a,c,{get:b[c],enumerable:!0})},Km=(a,b)=>{yh(a);if(typeof b==="object"||typeof b==="function")for(let c in b)xh.call(b,c)&&!xh.call(a,c)&&c!=="default"&&Rc(a,c,{get:()=>b[c],enumerable:!0});return a},Ga=a=>a&&a.__esModule?a:Km(Rc({},"default",{value:a,enumerable:!0}),a);var Ri=eb((a,b)=>{!function(c,d){"function"==typeof define&&define.amd?define([],d):"object"==typeof b&&"undefined"!=typeof a?b.exports=d():c.Papa=d()}(a,function c(){"use strict";var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==d?d:{},e=!d.document&&!!d.postMessage,f=e&&/blob:/i.test((d.location||{}).protocol),g={},j=0,i={parse:function(q,r){var h=(r=r||{}).dynamicTyping||!1;M(h)&&(r.dynamicTypingFunction=h,h={});if(r.dynamicTyping=h,r.transform=!!M(r.transform)&&r.transform,r.worker&&i.WORKERS_SUPPORTED){var m=function(){if(!i.WORKERS_SUPPORTED)return!1;var p=(o=d.URL||d.webkitURL||null,E=c.toString(),i.BLOB_URL||(i.BLOB_URL=o.createObjectURL(new Blob(["(",E,")();"],{type:"text/javascript"})))),t=new d.Worker(p),o,E;return t.onmessage=J,t.id=j++,g[t.id]=t}();return m.userStep=r.step,m.userChunk=r.chunk,m.userComplete=r.complete,m.userError=r.error,r.step=M(r.step),r.chunk=M(r.chunk),r.complete=M(r.complete),r.error=M(r.error),delete r.worker,void m.postMessage({input:q,config:r,workerId:m.id})}var k=null;return i.NODE_STREAM_INPUT,"string"==typeof q?k=r.download?new u(r):new B(r):!0===q.readable&&M(q.read)&&M(q.on)?k=new D(r):(d.File&&q instanceof File||q instanceof Object)&&(k=new A(r)),k.stream(q)},unparse:function(q,r){var h=!1,m=!0,k=",",p=`\r
`,t='"',o=t+t,E=!1,F=null;!function(){if("object"!=typeof r)return;"string"!=typeof r.delimiter||i.BAD_DELIMITERS.filter(function(z){return-1!==r.delimiter.indexOf(z)}).length||(k=r.delimiter),("boolean"==typeof r.quotes||"function"==typeof r.quotes||Array.isArray(r.quotes))&&(h=r.quotes),"boolean"!=typeof r.skipEmptyLines&&"string"!=typeof r.skipEmptyLines||(E=r.skipEmptyLines),"string"==typeof r.newline&&(p=r.newline),"string"==typeof r.quoteChar&&(t=r.quoteChar),"boolean"==typeof r.header&&(m=r.header);if(Array.isArray(r.columns)){if(0===r.columns.length)throw new Error("Option columns is empty");F=r.columns}void 0!==r.escapeChar&&(o=r.escapeChar+t)}();var X=new RegExp(H(t),"g");"string"==typeof q&&(q=JSON.parse(q));if(Array.isArray(q)){if(!q.length||Array.isArray(q[0]))return Y(null,q,E);if("object"==typeof q[0])return Y(F||y(q[0]),q,E)}else if("object"==typeof q)return"string"==typeof q.data&&(q.data=JSON.parse(q.data)),Array.isArray(q.data)&&(q.fields||(q.fields=q.meta&&q.meta.fields),q.fields||(q.fields=Array.isArray(q.data[0])?q.fields:y(q.data[0])),Array.isArray(q.data[0])||"object"==typeof q.data[0]||(q.data=[q.data])),Y(q.fields||[],q.data||[],E);throw new Error("Unable to serialize unrecognized input");function y(z){if("object"!=typeof z)return[];var K=[];for(var Z in z)K.push(Z);return K}function Y(z,K,Z){var ia="";"string"==typeof z&&(z=JSON.parse(z)),"string"==typeof K&&(K=JSON.parse(K));var na=Array.isArray(z)&&0<z.length,pa=!Array.isArray(K[0]);if(na&&m){for(var ma=0;ma<z.length;ma++)0<ma&&(ia+=k),ia+=O(z[ma],ma);0<K.length&&(ia+=p)}for(var T=0;T<K.length;T++){var ea=na?z.length:K[T].length,ja=!1,ka=na?0===Object.keys(K[T]).length:0===K[T].length;if(Z&&!na&&(ja="greedy"===Z?""===K[T].join("").trim():1===K[T].length&&0===K[T][0].length),"greedy"===Z&&na){for(var R=[],S=0;S<ea;S++){var ga=pa?z[S]:S;R.push(K[T][ga])}ja=""===R.join("").trim()}if(!ja){for(var P=0;P<ea;P++){0<P&&!ka&&(ia+=k);var fa=na&&pa?z[P]:P;ia+=O(K[T][fa],P)}T<K.length-1&&(!Z||0<ea&&!ka)&&(ia+=p)}}return ia}function O(z,K){if(null==z)return"";if(z.constructor===Date)return JSON.stringify(z).slice(1,25);var Z=z.toString().replace(X,o),ia="boolean"==typeof h&&h||"function"==typeof h&&h(z,K)||Array.isArray(h)&&h[K]||function(na,pa){for(var ma=0;ma<pa.length;ma++)if(-1<na.indexOf(pa[ma]))return!0;return!1}(Z,i.BAD_DELIMITERS)||-1<Z.indexOf(k)||" "===Z.charAt(0)||" "===Z.charAt(Z.length-1);return ia?t+Z+t:Z}}};if(i.RECORD_SEP=String.fromCharCode(30),i.UNIT_SEP=String.fromCharCode(31),i.BYTE_ORDER_MARK="ï»¿",i.BAD_DELIMITERS=["\r",`
`,'"',i.BYTE_ORDER_MARK],i.WORKERS_SUPPORTED=!e&&!!d.Worker,i.NODE_STREAM_INPUT=1,i.LocalChunkSize=10485760,i.RemoteChunkSize=5242880,i.DefaultDelimiter=",",i.Parser=L,i.ParserHandle=G,i.NetworkStreamer=u,i.FileStreamer=A,i.StringStreamer=B,i.ReadableStreamStreamer=D,d.jQuery){var l=d.jQuery;l.fn.parse=function(q){var r=q.config||{},h=[];return this.each(function(p){if(!("INPUT"===l(this).prop("tagName").toUpperCase()&&"file"===l(this).attr("type").toLowerCase()&&d.FileReader)||!this.files||0===this.files.length)return!0;for(var t=0;t<this.files.length;t++)h.push({file:this.files[t],inputElem:this,instanceConfig:l.extend({},r)})}),m(),this;function m(){if(0!==h.length){var p,t,o,E,F=h[0];if(M(q.before)){var X=q.before(F.file,F.inputElem);if("object"==typeof X){if("abort"===X.action)return p="AbortError",t=F.file,o=F.inputElem,E=X.reason,void(M(q.error)&&q.error({name:p},t,o,E));if("skip"===X.action)return void k();"object"==typeof X.config&&(F.instanceConfig=l.extend(F.instanceConfig,X.config))}else if("skip"===X)return void k()}var y=F.instanceConfig.complete;F.instanceConfig.complete=function(Y){M(y)&&y(Y,F.file,F.inputElem),k()},i.parse(F.file,F.instanceConfig)}else M(q.complete)&&q.complete()}function k(){h.splice(0,1),m()}}}function n(q){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(r){var h=V(r);h.chunkSize=parseInt(h.chunkSize),r.step||r.chunk||(h.chunkSize=null),this._handle=new G(h),(this._handle.streamer=this)._config=h}.call(this,q),this.parseChunk=function(r,h){if(this.isFirstChunk&&M(this._config.beforeFirstChunk)){var m=this._config.beforeFirstChunk(r);void 0!==m&&(r=m)}this.isFirstChunk=!1,this._halted=!1;var k=this._partialLine+r;this._partialLine="";var p=this._handle.parse(k,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var t=p.meta.cursor;this._finished||(this._partialLine=k.substring(t-this._baseIndex),this._baseIndex=t),p&&p.data&&(this._rowCount+=p.data.length);var o=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(f)d.postMessage({results:p,workerId:i.WORKER_ID,finished:o});else if(M(this._config.chunk)&&!h){if(this._config.chunk(p,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);p=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(p.data),this._completeResults.errors=this._completeResults.errors.concat(p.errors),this._completeResults.meta=p.meta),this._completed||!o||!M(this._config.complete)||p&&p.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),o||p&&p.meta.paused||this._nextChunk(),p}this._halted=!0},this._sendError=function(r){M(this._config.error)?this._config.error(r):f&&this._config.error&&d.postMessage({workerId:i.WORKER_ID,error:r,finished:!1})}}function u(q){var r;(q=q||{}).chunkSize||(q.chunkSize=i.RemoteChunkSize),n.call(this,q),this._nextChunk=e?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(h){this._input=h,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(r=new XMLHttpRequest(),this._config.withCredentials&&(r.withCredentials=this._config.withCredentials),e||(r.onload=W(this._chunkLoaded,this),r.onerror=W(this._chunkError,this)),r.open(this._config.downloadRequestBody?"POST":"GET",this._input,!e),this._config.downloadRequestHeaders){var h=this._config.downloadRequestHeaders;for(var m in h)r.setRequestHeader(m,h[m])}if(this._config.chunkSize){var k=this._start+this._config.chunkSize-1;r.setRequestHeader("Range","bytes="+this._start+"-"+k)}try{r.send(this._config.downloadRequestBody)}catch(p){this._chunkError(p.message)}e&&0===r.status&&this._chunkError()}},this._chunkLoaded=function(){4===r.readyState&&(r.status<200||400<=r.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:r.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(h){var m=h.getResponseHeader("Content-Range");return null===m?-1:parseInt(m.substring(m.lastIndexOf("/")+1))}(r),this.parseChunk(r.responseText)))},this._chunkError=function(h){var m=r.statusText||h;this._sendError(new Error(m))}}function A(q){var r,h;(q=q||{}).chunkSize||(q.chunkSize=i.LocalChunkSize),n.call(this,q);var m="undefined"!=typeof FileReader;this.stream=function(k){this._input=k,h=k.slice||k.webkitSlice||k.mozSlice,m?((r=new FileReader()).onload=W(this._chunkLoaded,this),r.onerror=W(this._chunkError,this)):r=new FileReaderSync(),this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var k=this._input;if(this._config.chunkSize){var p=Math.min(this._start+this._config.chunkSize,this._input.size);k=h.call(k,this._start,p)}var t=r.readAsText(k,this._config.encoding);m||this._chunkLoaded({target:{result:t}})},this._chunkLoaded=function(k){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(k.target.result)},this._chunkError=function(){this._sendError(r.error)}}function B(q){var r;n.call(this,q=q||{}),this.stream=function(h){return r=h,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var h,m=this._config.chunkSize;return m?(h=r.substring(0,m),r=r.substring(m)):(h=r,r=""),this._finished=!r,this.parseChunk(h)}}}function D(q){n.call(this,q=q||{});var r=[],h=!0,m=!1;this.pause=function(){n.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){n.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(k){this._input=k,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){m&&1===r.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),r.length?this.parseChunk(r.shift()):h=!0},this._streamData=W(function(k){try{r.push("string"==typeof k?k:k.toString(this._config.encoding)),h&&(h=!1,this._checkIsFinished(),this.parseChunk(r.shift()))}catch(p){this._streamError(p)}},this),this._streamError=W(function(k){this._streamCleanUp(),this._sendError(k)},this),this._streamEnd=W(function(){this._streamCleanUp(),m=!0,this._streamData("")},this),this._streamCleanUp=W(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function G(q){var r,h,m,k=Math.pow(2,53),p=-k,t=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)(e[-+]?\d+)?\s*$/,o=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,E=this,F=0,X=0,y=!1,Y=!1,O=[],z={data:[],errors:[],meta:{}};if(M(q.step)){var K=q.step;q.step=function(T){if(z=T,na())ia();else{if(ia(),0===z.data.length)return;F+=T.data.length,q.preview&&F>q.preview?h.abort():(z.data=z.data[0],K(z,E))}}}function Z(T){return"greedy"===q.skipEmptyLines?""===T.join("").trim():1===T.length&&0===T[0].length}function ia(){if(z&&m&&(ma("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+i.DefaultDelimiter+"'"),m=!1),q.skipEmptyLines)for(var T=0;T<z.data.length;T++)Z(z.data[T])&&z.data.splice(T--,1);return na()&&function(){if(!z)return;function ea(ka){M(q.transformHeader)&&(ka=q.transformHeader(ka)),O.push(ka)}if(Array.isArray(z.data[0])){for(var ja=0;na()&&ja<z.data.length;ja++)z.data[ja].forEach(ea);z.data.splice(0,1)}else z.data.forEach(ea)}(),function(){if(!z||!q.header&&!q.dynamicTyping&&!q.transform)return z;function ea(ka,R){var S,ga=q.header?{}:[];for(S=0;S<ka.length;S++){var P=S,fa=ka[S];q.header&&(P=S>=O.length?"__parsed_extra":O[S]),q.transform&&(fa=q.transform(fa,P)),fa=pa(P,fa),"__parsed_extra"===P?(ga[P]=ga[P]||[],ga[P].push(fa)):ga[P]=fa}return q.header&&(S>O.length?ma("FieldMismatch","TooManyFields","Too many fields: expected "+O.length+" fields but parsed "+S,X+R):S<O.length&&ma("FieldMismatch","TooFewFields","Too few fields: expected "+O.length+" fields but parsed "+S,X+R)),ga}var ja=1;return!z.data.length||Array.isArray(z.data[0])?(z.data=z.data.map(ea),ja=z.data.length):z.data=ea(z.data,0),q.header&&z.meta&&(z.meta.fields=O),X+=ja,z}()}function na(){return q.header&&0===O.length}function pa(T,ea){return ja=T,q.dynamicTypingFunction&&void 0===q.dynamicTyping[ja]&&(q.dynamicTyping[ja]=q.dynamicTypingFunction(ja)),!0===(q.dynamicTyping[ja]||q.dynamicTyping)?"true"===ea||"TRUE"===ea||"false"!==ea&&"FALSE"!==ea&&(function(ka){if(t.test(ka)){var R=parseFloat(ka);if(p<R&&R<k)return!0}return!1}(ea)?parseFloat(ea):o.test(ea)?new Date(ea):""===ea?null:ea):ea;var ja}function ma(T,ea,ja,ka){var R={type:T,code:ea,message:ja};void 0!==ka&&(R.row=ka),z.errors.push(R)}this.parse=function(T,ea,ja){var ka=q.quoteChar||'"';if(q.newline||(q.newline=function(ga,P){ga=ga.substring(0,1048576);var fa=new RegExp(H(P)+"([^]*?)"+H(P),"gm"),Q=(ga=ga.replace(fa,"")).split("\r"),ua=ga.split(`
`),v=1<ua.length&&ua[0].length<Q[0].length;if(1===Q.length||v)return`
`;for(var s=0,x=0;x<Q.length;x++)`
`===Q[x][0]&&s++;return s>=Q.length/2?`\r
`:"\r"}(T,ka)),m=!1,q.delimiter)M(q.delimiter)&&(q.delimiter=q.delimiter(T),z.meta.delimiter=q.delimiter);else{var R=function(ga,P,fa,Q,ua){var v,s,x,C;ua=ua||[",","	","|",";",i.RECORD_SEP,i.UNIT_SEP];for(var w=0;w<ua.length;w++){var U=ua[w],$=0,_=0,ha=0;x=void 0;for(var da=new L({comments:Q,delimiter:U,newline:P,preview:10}).parse(ga),sa=0;sa<da.data.length;sa++)if(fa&&Z(da.data[sa]))ha++;else{var la=da.data[sa].length;_+=la,void 0!==x?0<la&&($+=Math.abs(la-x),x=la):x=la}0<da.data.length&&(_/=da.data.length-ha),(void 0===s||$<=s)&&(void 0===C||C<_)&&1.99<_&&(s=$,v=U,C=_)}return{successful:!!(q.delimiter=v),bestDelimiter:v}}(T,q.newline,q.skipEmptyLines,q.comments,q.delimitersToGuess);R.successful?q.delimiter=R.bestDelimiter:(m=!0,q.delimiter=i.DefaultDelimiter),z.meta.delimiter=q.delimiter}var S=V(q);return q.preview&&q.header&&S.preview++,r=T,h=new L(S),z=h.parse(r,ea,ja),ia(),y?{meta:{paused:!0}}:z||{meta:{paused:!1}}},this.paused=function(){return y},this.pause=function(){y=!0,h.abort(),r=M(q.chunk)?"":r.substring(h.getCharIndex())},this.resume=function(){E.streamer._halted?(y=!1,E.streamer.parseChunk(r,!0)):setTimeout(E.resume,3)},this.aborted=function(){return Y},this.abort=function(){Y=!0,h.abort(),z.meta.aborted=!0,M(q.complete)&&q.complete(z),r=""}}function H(q){return q.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function L(q){var r,h=(q=q||{}).delimiter,m=q.newline,k=q.comments,p=q.step,t=q.preview,o=q.fastMode,E=r=void 0===q.quoteChar?'"':q.quoteChar;if(void 0!==q.escapeChar&&(E=q.escapeChar),("string"!=typeof h||-1<i.BAD_DELIMITERS.indexOf(h))&&(h=","),k===h)throw new Error("Comment character same as delimiter");!0===k?k="#":("string"!=typeof k||-1<i.BAD_DELIMITERS.indexOf(k))&&(k=!1),`
`!==m&&"\r"!==m&&`\r
`!==m&&(m=`
`);var F=0,X=!1;this.parse=function(y,Y,O){if("string"!=typeof y)throw new Error("Input must be a string");var z=y.length,K=h.length,Z=m.length,ia=k.length,na=M(p),pa=[],ma=[],T=[],ea=F=0;if(!y)return w();if(o||!1!==o&&-1===y.indexOf(r)){for(var ja=y.split(m),ka=0;ka<ja.length;ka++){if(T=ja[ka],F+=T.length,ka!==ja.length-1)F+=m.length;else if(O)return w();if(!k||T.substring(0,ia)!==k){if(na){if(pa=[],v(T.split(h)),U(),X)return w()}else v(T.split(h));if(t&&t<=ka)return pa=pa.slice(0,t),w(!0)}}return w()}for(var R=y.indexOf(h,F),S=y.indexOf(m,F),ga=new RegExp(H(E)+H(r),"g"),P=y.indexOf(r,F);;)if(y[F]!==r)if(k&&0===T.length&&y.substring(F,F+ia)===k){if(-1===S)return w();F=S+Z,S=y.indexOf(m,F),R=y.indexOf(h,F)}else{if(-1!==R&&(R<S||-1===S)){if(!(R<P)){T.push(y.substring(F,R)),F=R+K,R=y.indexOf(h,F);continue}var fa=$(R,P,S);if(fa&&void 0!==fa.nextDelim){R=fa.nextDelim,P=fa.quoteSearch,T.push(y.substring(F,R)),F=R+K,R=y.indexOf(h,F);continue}}if(-1===S)break;if(T.push(y.substring(F,S)),C(S+Z),na&&(U(),X))return w();if(t&&pa.length>=t)return w(!0)}else for(P=F,F++;;){if(-1===(P=y.indexOf(r,P+1)))return O||ma.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:pa.length,index:F}),x();if(P===z-1)return x(y.substring(F,P).replace(ga,r));if(r!==E||y[P+1]!==E){if(r===E||0===P||y[P-1]!==E){-1!==R&&R<P+1&&(R=y.indexOf(h,P+1)),-1!==S&&S<P+1&&(S=y.indexOf(m,P+1));var Q=s(-1===S?R:Math.min(R,S));if(y[P+1+Q]===h){T.push(y.substring(F,P).replace(ga,r)),y[F=P+1+Q+K]!==r&&(P=y.indexOf(r,F)),R=y.indexOf(h,F),S=y.indexOf(m,F);break}var ua=s(S);if(y.substring(P+1+ua,P+1+ua+Z)===m){if(T.push(y.substring(F,P).replace(ga,r)),C(P+1+ua+Z),R=y.indexOf(h,F),P=y.indexOf(r,F),na&&(U(),X))return w();if(t&&pa.length>=t)return w(!0);break}ma.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:pa.length,index:F}),P++}}else P++}return x();function v(_){pa.push(_),ea=F}function s(_){var ha=0;if(-1!==_){var da=y.substring(P+1,_);da&&""===da.trim()&&(ha=da.length)}return ha}function x(_){return O||(void 0===_&&(_=y.substring(F)),T.push(_),F=z,v(T),na&&U()),w()}function C(_){F=_,v(T),T=[],S=y.indexOf(m,F)}function w(_){return{data:pa,errors:ma,meta:{delimiter:h,linebreak:m,aborted:X,truncated:!!_,cursor:ea+(Y||0)}}}function U(){p(w()),pa=[],ma=[]}function $(_,ha,da){var sa={nextDelim:void 0,quoteSearch:void 0},la=y.indexOf(r,ha+1);if(ha<_&&_<la&&(la<da||-1===da)){var xa=y.indexOf(h,la);if(-1===xa)return sa;la<xa&&(la=y.indexOf(r,la+1)),sa=$(xa,la,da)}else sa={nextDelim:_,quoteSearch:ha};return sa}},this.abort=function(){X=!0},this.getCharIndex=function(){return F}}function J(q){var r=q.data,h=g[r.workerId],m=!1;if(r.error)h.userError(r.error,r.file);else if(r.results&&r.results.data){var k={abort:function(){m=!0,N(r.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:I,resume:I};if(M(h.userStep)){for(var p=0;p<r.results.data.length&&(h.userStep({data:r.results.data[p],errors:r.results.errors,meta:r.results.meta},k),!m);p++);delete r.results}else M(h.userChunk)&&(h.userChunk(r.results,k,r.file),delete r.results)}r.finished&&!m&&N(r.workerId,r.results)}function N(q,r){var h=g[q];M(h.userComplete)&&h.userComplete(r),h.terminate(),delete g[q]}function I(){throw new Error("Not implemented.")}function V(q){if("object"!=typeof q||null===q)return q;var r=Array.isArray(q)?[]:{};for(var h in q)r[h]=V(q[h]);return r}function W(q,r){return function(){q.apply(r,arguments)}}function M(q){return"function"==typeof q}return f&&(d.onmessage=function(q){var r=q.data;void 0===i.WORKER_ID&&r&&(i.WORKER_ID=r.workerId);if("string"==typeof r.input)d.postMessage({workerId:i.WORKER_ID,results:i.parse(r.input,r.config),finished:!0});else if(d.File&&r.input instanceof File||r.input instanceof Object){var h=i.parse(r.input,r.config);h&&d.postMessage({workerId:i.WORKER_ID,results:h,finished:!0})}}),(u.prototype=Object.create(n.prototype)).constructor=u,(A.prototype=Object.create(n.prototype)).constructor=A,(B.prototype=Object.create(B.prototype)).constructor=B,(D.prototype=Object.create(n.prototype)).constructor=D,i})});var Dh=eb(q=>{zb(q,{__assign:()=>c,__asyncDelegator:()=>L,__asyncGenerator:()=>H,__asyncValues:()=>J,__await:()=>G,__awaiter:()=>j,__classPrivateFieldGet:()=>W,__classPrivateFieldSet:()=>M,__createBinding:()=>l,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>V,__importStar:()=>I,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>A,__rest:()=>d,__spread:()=>B,__spreadArrays:()=>D,__values:()=>u});var a=function(h,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,p){k.__proto__=p}||function(k,p){for(var t in p)p.hasOwnProperty(t)&&(k[t]=p[t])},a(h,m)};function b(h,m){a(h,m);function k(){this.constructor=h}h.prototype=m===null?Object.create(m):(k.prototype=m.prototype,new k())}var c=function(){return c=Object.assign||function h(m){for(var k,p=1,t=arguments.length;p<t;p++){k=arguments[p];for(var o in k)Object.prototype.hasOwnProperty.call(k,o)&&(m[o]=k[o])}return m},c.apply(this,arguments)};function d(h,m){var k={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&m.indexOf(p)<0&&(k[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var t=0,p=Object.getOwnPropertySymbols(h);t<p.length;t++)m.indexOf(p[t])<0&&Object.prototype.propertyIsEnumerable.call(h,p[t])&&(k[p[t]]=h[p[t]]);return k}function e(h,m,k,p){var t=arguments.length,o=t<3?m:p===null?p=Object.getOwnPropertyDescriptor(m,k):p,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(h,m,k,p);else for(var F=h.length-1;F>=0;F--)(E=h[F])&&(o=(t<3?E(o):t>3?E(m,k,o):E(m,k))||o);return t>3&&o&&Object.defineProperty(m,k,o),o}function f(h,m){return function(k,p){m(k,p,h)}}function g(h,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,m)}function j(h,m,k,p){function t(o){return o instanceof k?o:new k(function(E){E(o)})}return new(k||(k=Promise))(function(o,E){function F(Y){try{y(p.next(Y))}catch(O){E(O)}}function X(Y){try{y(p.throw(Y))}catch(O){E(O)}}function y(Y){Y.done?o(Y.value):t(Y.value).then(F,X)}y((p=p.apply(h,m||[])).next())})}function i(h,m){var k={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},p,t,o,E;return E={next:F(0),throw:F(1),return:F(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function F(y){return function(Y){return X([y,Y])}}function X(y){if(p)throw new TypeError("Generator is already executing.");for(;k;)try{if(p=1,t&&(o=y[0]&2?t.return:y[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,y[1])).done)return o;(t=0,o)&&(y=[y[0]&2,o.value]);switch(y[0]){case 0:case 1:o=y;break;case 4:return k.label++,{value:y[1],done:!1};case 5:k.label++,t=y[1],y=[0];continue;case 7:y=k.ops.pop(),k.trys.pop();continue;default:if(!(o=k.trys,o=o.length>0&&o[o.length-1])&&(y[0]===6||y[0]===2)){k=0;continue}if(y[0]===3&&(!o||y[1]>o[0]&&y[1]<o[3])){k.label=y[1];break}if(y[0]===6&&k.label<o[1]){k.label=o[1],o=y;break}if(o&&k.label<o[2]){k.label=o[2],k.ops.push(y);break}o[2]&&k.ops.pop(),k.trys.pop();continue}y=m.call(h,k)}catch(Y){y=[6,Y],t=0}finally{p=o=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}function l(h,m,k,p){p===void 0&&(p=k),h[p]=m[k]}function n(h,m){for(var k in h)k!=="default"&&!m.hasOwnProperty(k)&&(m[k]=h[k])}function u(h){var m=typeof Symbol==="function"&&Symbol.iterator,k=m&&h[m],p=0;if(k)return k.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function A(h,m){var k=typeof Symbol==="function"&&h[Symbol.iterator];if(!k)return h;var p=k.call(h),t,o=[],E;try{for(;(m===void 0||m-- >0)&&!(t=p.next()).done;)o.push(t.value)}catch(F){E={error:F}}finally{try{t&&!t.done&&(k=p.return)&&k.call(p)}finally{if(E)throw E.error}}return o}function B(){for(var h=[],m=0;m<arguments.length;m++)h=h.concat(A(arguments[m]));return h}function D(){for(var h=0,m=0,k=arguments.length;m<k;m++)h+=arguments[m].length;for(var p=Array(h),t=0,m=0;m<k;m++)for(var o=arguments[m],E=0,F=o.length;E<F;E++,t++)p[t]=o[E];return p}function G(h){return this instanceof G?(this.v=h,this):new G(h)}function H(h,m,k){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=k.apply(h,m||[]),t,o=[];return t={},E("next"),E("throw"),E("return"),t[Symbol.asyncIterator]=function(){return this},t;function E(z){p[z]&&(t[z]=function(K){return new Promise(function(Z,ia){o.push([z,K,Z,ia])>1||F(z,K)})})}function F(z,K){try{X(p[z](K))}catch(Z){O(o[0][3],Z)}}function X(z){z.value instanceof G?Promise.resolve(z.value.v).then(y,Y):O(o[0][2],z)}function y(z){F("next",z)}function Y(z){F("throw",z)}function O(z,K){(z(K),o.shift(),o.length)&&F(o[0][0],o[0][1])}}function L(h){var m,k;return m={},p("next"),p("throw",function(t){throw t}),p("return"),m[Symbol.iterator]=function(){return this},m;function p(t,o){m[t]=h[t]?function(E){return(k=!k)?{value:G(h[t](E)),done:t==="return"}:o?o(E):E}:o}}function J(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=h[Symbol.asyncIterator],k;return m?m.call(h):(h=typeof u==="function"?u(h):h[Symbol.iterator](),k={},p("next"),p("throw"),p("return"),k[Symbol.asyncIterator]=function(){return this},k);function p(o){k[o]=h[o]&&function(E){return new Promise(function(F,X){E=h[o](E),t(F,X,E.done,E.value)})}}function t(o,E,F,X){Promise.resolve(X).then(function(y){o({value:y,done:F})},E)}}function N(h,m){return Object.defineProperty?Object.defineProperty(h,"raw",{value:m}):h.raw=m,h}function I(h){if(h&&h.__esModule)return h;var m={};if(h!=null)for(var k in h)Object.hasOwnProperty.call(h,k)&&(m[k]=h[k]);return m.default=h,m}function V(h){return h&&h.__esModule?h:{default:h}}function W(h,m){if(!m.has(h))throw new TypeError("attempted to get private field on non-instance");return m.get(h)}function M(h,m,k){if(!m.has(h))throw new TypeError("attempted to set private field on non-instance");return m.set(h,k),k}});var Hh=eb(q=>{zb(q,{__assign:()=>c,__asyncDelegator:()=>L,__asyncGenerator:()=>H,__asyncValues:()=>J,__await:()=>G,__awaiter:()=>j,__classPrivateFieldGet:()=>W,__classPrivateFieldSet:()=>M,__createBinding:()=>l,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>V,__importStar:()=>I,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>A,__rest:()=>d,__spread:()=>B,__spreadArrays:()=>D,__values:()=>u});var a=function(h,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,p){k.__proto__=p}||function(k,p){for(var t in p)p.hasOwnProperty(t)&&(k[t]=p[t])},a(h,m)};function b(h,m){a(h,m);function k(){this.constructor=h}h.prototype=m===null?Object.create(m):(k.prototype=m.prototype,new k())}var c=function(){return c=Object.assign||function h(m){for(var k,p=1,t=arguments.length;p<t;p++){k=arguments[p];for(var o in k)Object.prototype.hasOwnProperty.call(k,o)&&(m[o]=k[o])}return m},c.apply(this,arguments)};function d(h,m){var k={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&m.indexOf(p)<0&&(k[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var t=0,p=Object.getOwnPropertySymbols(h);t<p.length;t++)m.indexOf(p[t])<0&&Object.prototype.propertyIsEnumerable.call(h,p[t])&&(k[p[t]]=h[p[t]]);return k}function e(h,m,k,p){var t=arguments.length,o=t<3?m:p===null?p=Object.getOwnPropertyDescriptor(m,k):p,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(h,m,k,p);else for(var F=h.length-1;F>=0;F--)(E=h[F])&&(o=(t<3?E(o):t>3?E(m,k,o):E(m,k))||o);return t>3&&o&&Object.defineProperty(m,k,o),o}function f(h,m){return function(k,p){m(k,p,h)}}function g(h,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,m)}function j(h,m,k,p){function t(o){return o instanceof k?o:new k(function(E){E(o)})}return new(k||(k=Promise))(function(o,E){function F(Y){try{y(p.next(Y))}catch(O){E(O)}}function X(Y){try{y(p.throw(Y))}catch(O){E(O)}}function y(Y){Y.done?o(Y.value):t(Y.value).then(F,X)}y((p=p.apply(h,m||[])).next())})}function i(h,m){var k={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},p,t,o,E;return E={next:F(0),throw:F(1),return:F(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function F(y){return function(Y){return X([y,Y])}}function X(y){if(p)throw new TypeError("Generator is already executing.");for(;k;)try{if(p=1,t&&(o=y[0]&2?t.return:y[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,y[1])).done)return o;(t=0,o)&&(y=[y[0]&2,o.value]);switch(y[0]){case 0:case 1:o=y;break;case 4:return k.label++,{value:y[1],done:!1};case 5:k.label++,t=y[1],y=[0];continue;case 7:y=k.ops.pop(),k.trys.pop();continue;default:if(!(o=k.trys,o=o.length>0&&o[o.length-1])&&(y[0]===6||y[0]===2)){k=0;continue}if(y[0]===3&&(!o||y[1]>o[0]&&y[1]<o[3])){k.label=y[1];break}if(y[0]===6&&k.label<o[1]){k.label=o[1],o=y;break}if(o&&k.label<o[2]){k.label=o[2],k.ops.push(y);break}o[2]&&k.ops.pop(),k.trys.pop();continue}y=m.call(h,k)}catch(Y){y=[6,Y],t=0}finally{p=o=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}function l(h,m,k,p){p===void 0&&(p=k),h[p]=m[k]}function n(h,m){for(var k in h)k!=="default"&&!m.hasOwnProperty(k)&&(m[k]=h[k])}function u(h){var m=typeof Symbol==="function"&&Symbol.iterator,k=m&&h[m],p=0;if(k)return k.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function A(h,m){var k=typeof Symbol==="function"&&h[Symbol.iterator];if(!k)return h;var p=k.call(h),t,o=[],E;try{for(;(m===void 0||m-- >0)&&!(t=p.next()).done;)o.push(t.value)}catch(F){E={error:F}}finally{try{t&&!t.done&&(k=p.return)&&k.call(p)}finally{if(E)throw E.error}}return o}function B(){for(var h=[],m=0;m<arguments.length;m++)h=h.concat(A(arguments[m]));return h}function D(){for(var h=0,m=0,k=arguments.length;m<k;m++)h+=arguments[m].length;for(var p=Array(h),t=0,m=0;m<k;m++)for(var o=arguments[m],E=0,F=o.length;E<F;E++,t++)p[t]=o[E];return p}function G(h){return this instanceof G?(this.v=h,this):new G(h)}function H(h,m,k){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=k.apply(h,m||[]),t,o=[];return t={},E("next"),E("throw"),E("return"),t[Symbol.asyncIterator]=function(){return this},t;function E(z){p[z]&&(t[z]=function(K){return new Promise(function(Z,ia){o.push([z,K,Z,ia])>1||F(z,K)})})}function F(z,K){try{X(p[z](K))}catch(Z){O(o[0][3],Z)}}function X(z){z.value instanceof G?Promise.resolve(z.value.v).then(y,Y):O(o[0][2],z)}function y(z){F("next",z)}function Y(z){F("throw",z)}function O(z,K){(z(K),o.shift(),o.length)&&F(o[0][0],o[0][1])}}function L(h){var m,k;return m={},p("next"),p("throw",function(t){throw t}),p("return"),m[Symbol.iterator]=function(){return this},m;function p(t,o){m[t]=h[t]?function(E){return(k=!k)?{value:G(h[t](E)),done:t==="return"}:o?o(E):E}:o}}function J(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=h[Symbol.asyncIterator],k;return m?m.call(h):(h=typeof u==="function"?u(h):h[Symbol.iterator](),k={},p("next"),p("throw"),p("return"),k[Symbol.asyncIterator]=function(){return this},k);function p(o){k[o]=h[o]&&function(E){return new Promise(function(F,X){E=h[o](E),t(F,X,E.done,E.value)})}}function t(o,E,F,X){Promise.resolve(X).then(function(y){o({value:y,done:F})},E)}}function N(h,m){return Object.defineProperty?Object.defineProperty(h,"raw",{value:m}):h.raw=m,h}function I(h){if(h&&h.__esModule)return h;var m={};if(h!=null)for(var k in h)Object.hasOwnProperty.call(h,k)&&(m[k]=h[k]);return m.default=h,m}function V(h){return h&&h.__esModule?h:{default:h}}function W(h,m){if(!m.has(h))throw new TypeError("attempted to get private field on non-instance");return m.get(h)}function M(h,m,k){if(!m.has(h))throw new TypeError("attempted to set private field on non-instance");return m.set(h,k),k}});var Me=eb(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});var a=Hh();var b={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};var c=function(v,s){if(!v)throw d(s)},d=function(v){return new Error("Firebase Database ("+b.SDK_VERSION+") INTERNAL ASSERT FAILED: "+v)};var e=function(v){for(var s=[],x=0,C=0;C<v.length;C++){var w=v.charCodeAt(C);w<128?s[x++]=w:w<2048?(s[x++]=w>>6|192,s[x++]=w&63|128):(w&64512)===55296&&C+1<v.length&&(v.charCodeAt(C+1)&64512)===56320?(w=65536+((w&1023)<<10)+(v.charCodeAt(++C)&1023),s[x++]=w>>18|240,s[x++]=w>>12&63|128,s[x++]=w>>6&63|128,s[x++]=w&63|128):(s[x++]=w>>12|224,s[x++]=w>>6&63|128,s[x++]=w&63|128)}return s},f=function(v){for(var s=[],x=0,C=0;x<v.length;){var w=v[x++];if(w<128)s[C++]=String.fromCharCode(w);else if(w>191&&w<224){var U=v[x++];s[C++]=String.fromCharCode((w&31)<<6|U&63)}else if(w>239&&w<365){var U=v[x++],$=v[x++],_=v[x++],ha=((w&7)<<18|(U&63)<<12|($&63)<<6|_&63)-65536;s[C++]=String.fromCharCode(55296+(ha>>10)),s[C++]=String.fromCharCode(56320+(ha&1023))}else{var U=v[x++],$=v[x++];s[C++]=String.fromCharCode((w&15)<<12|(U&63)<<6|$&63)}}return s.join("")},g={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob==="function",encodeByteArray:function(v,s){if(!Array.isArray(v))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var x=s?this.byteToCharMapWebSafe_:this.byteToCharMap_,C=[],w=0;w<v.length;w+=3){var U=v[w],$=w+1<v.length,_=$?v[w+1]:0,ha=w+2<v.length,da=ha?v[w+2]:0,sa=U>>2,la=(U&3)<<4|_>>4,xa=(_&15)<<2|da>>6,Fe=da&63;ha||(Fe=64,$||(xa=64)),C.push(x[sa],x[la],x[xa],x[Fe])}return C.join("")},encodeString:function(v,s){return this.HAS_NATIVE_SUPPORT&&!s?btoa(v):this.encodeByteArray(e(v),s)},decodeString:function(v,s){return this.HAS_NATIVE_SUPPORT&&!s?atob(v):f(this.decodeStringToByteArray(v,s))},decodeStringToByteArray:function(v,s){this.init_();for(var x=s?this.charToByteMapWebSafe_:this.charToByteMap_,C=[],w=0;w<v.length;){var U=x[v.charAt(w++)],$=w<v.length,_=$?x[v.charAt(w)]:0;++w;var ha=w<v.length,da=ha?x[v.charAt(w)]:64;++w;var sa=w<v.length,la=sa?x[v.charAt(w)]:64;++w;if(U==null||_==null||da==null||la==null)throw Error();var xa=U<<2|_>>4;C.push(xa);if(da!==64){var Fe=_<<4&240|da>>2;C.push(Fe);if(la!==64){var sp=da<<6&192|la;C.push(sp)}}}return C},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var v=0;v<this.ENCODED_VALS.length;v++)this.byteToCharMap_[v]=this.ENCODED_VALS.charAt(v),this.charToByteMap_[this.byteToCharMap_[v]]=v,this.byteToCharMapWebSafe_[v]=this.ENCODED_VALS_WEBSAFE.charAt(v),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[v]]=v,v>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(v)]=v,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(v)]=v)}}},j=function(v){var s=e(v);return g.encodeByteArray(s,!0)},i=function(v){try{return g.decodeString(v,!0)}catch(s){console.error("base64Decode failed: ",s)}return null};function l(v){return n(void 0,v)}function n(v,s){if(!(s instanceof Object))return s;switch(s.constructor){case Date:var x=s;return new Date(x.getTime());case Object:v===void 0&&(v={});break;case Array:v=[];break;default:return s}for(var C in s){if(!s.hasOwnProperty(C))continue;v[C]=n(v[C],s[C])}return v}var u=function(){function v(){var s=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(x,C){s.resolve=x,s.reject=C})}return v.prototype.wrapCallback=function(s){var x=this;return function(C,w){C?x.reject(C):x.resolve(w),typeof s==="function"&&(x.promise.catch(function(){}),s.length===1?s(C):s(C,w))}},v}();function A(){return typeof navigator!=="undefined"&&typeof navigator.userAgent==="string"?navigator.userAgent:""}function B(){return typeof window!=="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(A())}function D(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(v){return!1}}function G(){return typeof self==="object"&&self.self===self}function H(){var v=typeof chrome==="object"?chrome.runtime:typeof browser==="object"?browser.runtime:void 0;return typeof v==="object"&&v.id!==void 0}function L(){return typeof navigator==="object"&&navigator.product==="ReactNative"}function J(){return A().indexOf("Electron/")>=0}function N(){var v=A();return v.indexOf("MSIE ")>=0||v.indexOf("Trident/")>=0}function I(){return A().indexOf("MSAppHost/")>=0}function V(){return b.NODE_CLIENT===!0||b.NODE_ADMIN===!0}function W(){return!D()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}var M="FirebaseError",q=function(v){a.__extends(s,v);function s(x,C){var w=v.call(this,C)||this;return w.code=x,w.name=M,Object.setPrototypeOf(w,s.prototype),Error.captureStackTrace&&Error.captureStackTrace(w,r.prototype.create),w}return s}(Error),r=function(){function v(s,x,C){this.service=s,this.serviceName=x,this.errors=C}return v.prototype.create=function(s){for(var x=[],C=1;C<arguments.length;C++)x[C-1]=arguments[C];for(var w=x[0]||{},U=this.service+"/"+s,$=this.errors[s],_=$?h($,w):"Error",ha=this.serviceName+": "+_+" ("+U+").",da=new q(U,ha),sa=0,la=Object.keys(w);sa<la.length;sa++){var xa=la[sa];xa.slice(-1)!=="_"&&(xa in da&&console.warn('Overwriting FirebaseError base field "'+xa+'" can cause unexpected behavior.'),da[xa]=w[xa])}return da},v}();function h(v,s){return v.replace(m,function(x,C){var w=s[C];return w!=null?String(w):"<"+C+"?>"})}var m=/\{\$([^}]+)}/g;function k(v){return JSON.parse(v)}function p(v){return JSON.stringify(v)}var t=function(v){var s={},x={},C={},w="";try{var U=v.split(".");s=k(i(U[0])||""),x=k(i(U[1])||""),w=U[2],C=x.d||{},delete x.d}catch($){}return{header:s,claims:x,data:C,signature:w}},o=function(v){var s=t(v).claims,x=Math.floor(new Date().getTime()/1e3),C=0,w=0;return typeof s==="object"&&(s.hasOwnProperty("nbf")?C=s.nbf:s.hasOwnProperty("iat")&&(C=s.iat),s.hasOwnProperty("exp")?w=s.exp:w=C+86400),!!x&&!!C&&!!w&&x>=C&&x<=w},E=function(v){var s=t(v).claims;return typeof s==="object"&&s.hasOwnProperty("iat")?s.iat:null},F=function(v){var s=t(v),x=s.claims;return!!x&&typeof x==="object"&&x.hasOwnProperty("iat")},X=function(v){var s=t(v).claims;return typeof s==="object"&&s.admin===!0};function y(v,s){return Object.prototype.hasOwnProperty.call(v,s)}function Y(v,s){return Object.prototype.hasOwnProperty.call(v,s)?v[s]:void 0}function O(v){for(var s in v)if(Object.prototype.hasOwnProperty.call(v,s))return!1;return!0}function z(v,s,x){var C={};for(var w in v)Object.prototype.hasOwnProperty.call(v,w)&&(C[w]=s.call(x,v[w],w,v));return C}function K(v){for(var s=[],x=function(ha,da){Array.isArray(da)?da.forEach(function(sa){s.push(encodeURIComponent(ha)+"="+encodeURIComponent(sa))}):s.push(encodeURIComponent(ha)+"="+encodeURIComponent(da))},C=0,w=Object.entries(v);C<w.length;C++){var U=w[C],$=U[0],_=U[1];x($,_)}return s.length?"&"+s.join("&"):""}function Z(v){var s={},x=v.replace(/^\?/,"").split("&");return x.forEach(function(C){if(C){var w=C.split("=");s[w[0]]=w[1]}}),s}var ia=function(){function v(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(var s=1;s<this.blockSize;++s)this.pad_[s]=0;this.reset()}return v.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},v.prototype.compress_=function(s,x){x||(x=0);var C=this.W_;if(typeof s==="string")for(var w=0;w<16;w++)C[w]=s.charCodeAt(x)<<24|s.charCodeAt(x+1)<<16|s.charCodeAt(x+2)<<8|s.charCodeAt(x+3),x+=4;else for(var w=0;w<16;w++)C[w]=s[x]<<24|s[x+1]<<16|s[x+2]<<8|s[x+3],x+=4;for(var w=16;w<80;w++){var U=C[w-3]^C[w-8]^C[w-14]^C[w-16];C[w]=(U<<1|U>>>31)&4294967295}for(var $=this.chain_[0],_=this.chain_[1],ha=this.chain_[2],da=this.chain_[3],sa=this.chain_[4],la,xa,w=0;w<80;w++){w<40?w<20?(la=da^_&(ha^da),xa=1518500249):(la=_^ha^da,xa=1859775393):w<60?(la=_&ha|da&(_|ha),xa=2400959708):(la=_^ha^da,xa=3395469782);var U=($<<5|$>>>27)+la+sa+xa+C[w]&4294967295;sa=da,da=ha,ha=(_<<30|_>>>2)&4294967295,_=$,$=U}this.chain_[0]=this.chain_[0]+$&4294967295,this.chain_[1]=this.chain_[1]+_&4294967295,this.chain_[2]=this.chain_[2]+ha&4294967295,this.chain_[3]=this.chain_[3]+da&4294967295,this.chain_[4]=this.chain_[4]+sa&4294967295},v.prototype.update=function(s,x){if(s==null)return;x===void 0&&(x=s.length);for(var C=x-this.blockSize,w=0,U=this.buf_,$=this.inbuf_;w<x;){if($===0)for(;w<=C;)this.compress_(s,w),w+=this.blockSize;if(typeof s==="string")for(;w<x;){U[$]=s.charCodeAt(w),++$,++w;if($===this.blockSize){this.compress_(U),$=0;break}}else for(;w<x;){U[$]=s[w],++$,++w;if($===this.blockSize){this.compress_(U),$=0;break}}}this.inbuf_=$,this.total_+=x},v.prototype.digest=function(){var s=[],x=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var C=this.blockSize-1;C>=56;C--)this.buf_[C]=x&255,x/=256;this.compress_(this.buf_);for(var w=0,C=0;C<5;C++)for(var U=24;U>=0;U-=8)s[w]=this.chain_[C]>>U&255,++w;return s},v}();function na(v,s){var x=new pa(v,s);return x.subscribe.bind(x)}var pa=function(){function v(s,x){var C=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=x,this.task.then(function(){s(C)}).catch(function(w){C.error(w)})}return v.prototype.next=function(s){this.forEachObserver(function(x){x.next(s)})},v.prototype.error=function(s){this.forEachObserver(function(x){x.error(s)}),this.close(s)},v.prototype.complete=function(){this.forEachObserver(function(s){s.complete()}),this.close()},v.prototype.subscribe=function(s,x,C){var w=this,U;if(s===void 0&&x===void 0&&C===void 0)throw new Error("Missing Observer.");T(s,["next","error","complete"])?U=s:U={next:s,error:x,complete:C},U.next===void 0&&(U.next=ea),U.error===void 0&&(U.error=ea),U.complete===void 0&&(U.complete=ea);var $=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{w.finalError?U.error(w.finalError):U.complete()}catch(_){}return}),this.observers.push(U),$},v.prototype.unsubscribeOne=function(s){if(this.observers===void 0||this.observers[s]===void 0)return;delete this.observers[s],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this)},v.prototype.forEachObserver=function(s){if(this.finalized)return;for(var x=0;x<this.observers.length;x++)this.sendOne(x,s)},v.prototype.sendOne=function(s,x){var C=this;this.task.then(function(){if(C.observers!==void 0&&C.observers[s]!==void 0)try{x(C.observers[s])}catch(w){typeof console!=="undefined"&&console.error&&console.error(w)}})},v.prototype.close=function(s){var x=this;if(this.finalized)return;this.finalized=!0,s!==void 0&&(this.finalError=s),this.task.then(function(){x.observers=void 0,x.onNoObservers=void 0})},v}();function ma(v,s){return function(){for(var x=[],C=0;C<arguments.length;C++)x[C]=arguments[C];Promise.resolve(!0).then(function(){v.apply(void 0,x)}).catch(function(w){s&&s(w)})}}function T(v,s){if(typeof v!=="object"||v===null)return!1;for(var x=0,C=s;x<C.length;x++){var w=C[x];if(w in v&&typeof v[w]==="function")return!0}return!1}function ea(){}var ja=function(v,s,x,C){var w;C<s?w="at least "+s:C>x&&(w=x===0?"none":"no more than "+x);if(w){var U=v+" failed: Was called with "+C+(C===1?" argument.":" arguments.")+" Expects "+w+".";throw new Error(U)}};function ka(v,s,x){var C="";switch(s){case 1:C=x?"first":"First";break;case 2:C=x?"second":"Second";break;case 3:C=x?"third":"Third";break;case 4:C=x?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var w=v+" failed: ";return w+=C+" argument ",w}function R(v,s,x,C){if(C&&!x)return;if(typeof x!=="string")throw new Error(ka(v,s,C)+"must be a valid firebase namespace.")}function S(v,s,x,C){if(C&&!x)return;if(typeof x!=="function")throw new Error(ka(v,s,C)+"must be a valid function.")}function ga(v,s,x,C){if(C&&!x)return;if(typeof x!=="object"||x===null)throw new Error(ka(v,s,C)+"must be a valid context object.")}var P=function(v){for(var s=[],x=0,C=0;C<v.length;C++){var w=v.charCodeAt(C);if(w>=55296&&w<=56319){var U=w-55296;C++,c(C<v.length,"Surrogate pair missing trail surrogate.");var $=v.charCodeAt(C)-56320;w=65536+(U<<10)+$}w<128?s[x++]=w:w<2048?(s[x++]=w>>6|192,s[x++]=w&63|128):w<65536?(s[x++]=w>>12|224,s[x++]=w>>6&63|128,s[x++]=w&63|128):(s[x++]=w>>18|240,s[x++]=w>>12&63|128,s[x++]=w>>6&63|128,s[x++]=w&63|128)}return s},fa=function(v){for(var s=0,x=0;x<v.length;x++){var C=v.charCodeAt(x);C<128?s++:C<2048?s+=2:C>=55296&&C<=56319?(s+=4,x++):s+=3}return s};Q.CONSTANTS=b;Q.Deferred=u;Q.ErrorFactory=r;Q.FirebaseError=q;Q.Sha1=ia;Q.assert=c;Q.assertionError=d;Q.async=ma;Q.base64=g;Q.base64Decode=i;Q.base64Encode=j;Q.contains=y;Q.createSubscribe=na;Q.decode=t;Q.deepCopy=l;Q.deepExtend=n;Q.errorPrefix=ka;Q.getUA=A;Q.isAdmin=X;Q.isBrowser=G;Q.isBrowserExtension=H;Q.isElectron=J;Q.isEmpty=O;Q.isIE=N;Q.isMobileCordova=B;Q.isNode=D;Q.isNodeSdk=V;Q.isReactNative=L;Q.isSafari=W;Q.isUWP=I;Q.isValidFormat=F;Q.isValidTimestamp=o;Q.issuedAtTime=E;Q.jsonEval=k;Q.map=z;Q.querystring=K;Q.querystringDecode=Z;Q.safeGet=Y;Q.stringLength=fa;Q.stringToByteArray=P;Q.stringify=p;Q.validateArgCount=ja;Q.validateCallback=S;Q.validateContextObject=ga;Q.validateNamespace=R});var Fh=eb(q=>{zb(q,{__assign:()=>c,__asyncDelegator:()=>L,__asyncGenerator:()=>H,__asyncValues:()=>J,__await:()=>G,__awaiter:()=>j,__classPrivateFieldGet:()=>W,__classPrivateFieldSet:()=>M,__createBinding:()=>l,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>V,__importStar:()=>I,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>A,__rest:()=>d,__spread:()=>B,__spreadArrays:()=>D,__values:()=>u});var a=function(h,m){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,p){k.__proto__=p}||function(k,p){for(var t in p)p.hasOwnProperty(t)&&(k[t]=p[t])},a(h,m)};function b(h,m){a(h,m);function k(){this.constructor=h}h.prototype=m===null?Object.create(m):(k.prototype=m.prototype,new k())}var c=function(){return c=Object.assign||function h(m){for(var k,p=1,t=arguments.length;p<t;p++){k=arguments[p];for(var o in k)Object.prototype.hasOwnProperty.call(k,o)&&(m[o]=k[o])}return m},c.apply(this,arguments)};function d(h,m){var k={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&m.indexOf(p)<0&&(k[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var t=0,p=Object.getOwnPropertySymbols(h);t<p.length;t++)m.indexOf(p[t])<0&&Object.prototype.propertyIsEnumerable.call(h,p[t])&&(k[p[t]]=h[p[t]]);return k}function e(h,m,k,p){var t=arguments.length,o=t<3?m:p===null?p=Object.getOwnPropertyDescriptor(m,k):p,E;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(h,m,k,p);else for(var F=h.length-1;F>=0;F--)(E=h[F])&&(o=(t<3?E(o):t>3?E(m,k,o):E(m,k))||o);return t>3&&o&&Object.defineProperty(m,k,o),o}function f(h,m){return function(k,p){m(k,p,h)}}function g(h,m){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,m)}function j(h,m,k,p){function t(o){return o instanceof k?o:new k(function(E){E(o)})}return new(k||(k=Promise))(function(o,E){function F(Y){try{y(p.next(Y))}catch(O){E(O)}}function X(Y){try{y(p.throw(Y))}catch(O){E(O)}}function y(Y){Y.done?o(Y.value):t(Y.value).then(F,X)}y((p=p.apply(h,m||[])).next())})}function i(h,m){var k={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},p,t,o,E;return E={next:F(0),throw:F(1),return:F(2)},typeof Symbol==="function"&&(E[Symbol.iterator]=function(){return this}),E;function F(y){return function(Y){return X([y,Y])}}function X(y){if(p)throw new TypeError("Generator is already executing.");for(;k;)try{if(p=1,t&&(o=y[0]&2?t.return:y[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,y[1])).done)return o;(t=0,o)&&(y=[y[0]&2,o.value]);switch(y[0]){case 0:case 1:o=y;break;case 4:return k.label++,{value:y[1],done:!1};case 5:k.label++,t=y[1],y=[0];continue;case 7:y=k.ops.pop(),k.trys.pop();continue;default:if(!(o=k.trys,o=o.length>0&&o[o.length-1])&&(y[0]===6||y[0]===2)){k=0;continue}if(y[0]===3&&(!o||y[1]>o[0]&&y[1]<o[3])){k.label=y[1];break}if(y[0]===6&&k.label<o[1]){k.label=o[1],o=y;break}if(o&&k.label<o[2]){k.label=o[2],k.ops.push(y);break}o[2]&&k.ops.pop(),k.trys.pop();continue}y=m.call(h,k)}catch(Y){y=[6,Y],t=0}finally{p=o=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}function l(h,m,k,p){p===void 0&&(p=k),h[p]=m[k]}function n(h,m){for(var k in h)k!=="default"&&!m.hasOwnProperty(k)&&(m[k]=h[k])}function u(h){var m=typeof Symbol==="function"&&Symbol.iterator,k=m&&h[m],p=0;if(k)return k.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function A(h,m){var k=typeof Symbol==="function"&&h[Symbol.iterator];if(!k)return h;var p=k.call(h),t,o=[],E;try{for(;(m===void 0||m-- >0)&&!(t=p.next()).done;)o.push(t.value)}catch(F){E={error:F}}finally{try{t&&!t.done&&(k=p.return)&&k.call(p)}finally{if(E)throw E.error}}return o}function B(){for(var h=[],m=0;m<arguments.length;m++)h=h.concat(A(arguments[m]));return h}function D(){for(var h=0,m=0,k=arguments.length;m<k;m++)h+=arguments[m].length;for(var p=Array(h),t=0,m=0;m<k;m++)for(var o=arguments[m],E=0,F=o.length;E<F;E++,t++)p[t]=o[E];return p}function G(h){return this instanceof G?(this.v=h,this):new G(h)}function H(h,m,k){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=k.apply(h,m||[]),t,o=[];return t={},E("next"),E("throw"),E("return"),t[Symbol.asyncIterator]=function(){return this},t;function E(z){p[z]&&(t[z]=function(K){return new Promise(function(Z,ia){o.push([z,K,Z,ia])>1||F(z,K)})})}function F(z,K){try{X(p[z](K))}catch(Z){O(o[0][3],Z)}}function X(z){z.value instanceof G?Promise.resolve(z.value.v).then(y,Y):O(o[0][2],z)}function y(z){F("next",z)}function Y(z){F("throw",z)}function O(z,K){(z(K),o.shift(),o.length)&&F(o[0][0],o[0][1])}}function L(h){var m,k;return m={},p("next"),p("throw",function(t){throw t}),p("return"),m[Symbol.iterator]=function(){return this},m;function p(t,o){m[t]=h[t]?function(E){return(k=!k)?{value:G(h[t](E)),done:t==="return"}:o?o(E):E}:o}}function J(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=h[Symbol.asyncIterator],k;return m?m.call(h):(h=typeof u==="function"?u(h):h[Symbol.iterator](),k={},p("next"),p("throw"),p("return"),k[Symbol.asyncIterator]=function(){return this},k);function p(o){k[o]=h[o]&&function(E){return new Promise(function(F,X){E=h[o](E),t(F,X,E.done,E.value)})}}function t(o,E,F,X){Promise.resolve(X).then(function(y){o({value:y,done:F})},E)}}function N(h,m){return Object.defineProperty?Object.defineProperty(h,"raw",{value:m}):h.raw=m,h}function I(h){if(h&&h.__esModule)return h;var m={};if(h!=null)for(var k in h)Object.hasOwnProperty.call(h,k)&&(m[k]=h[k]);return m.default=h,m}function V(h){return h&&h.__esModule?h:{default:h}}function W(h,m){if(!m.has(h))throw new TypeError("attempted to get private field on non-instance");return m.get(h)}function M(h,m,k){if(!m.has(h))throw new TypeError("attempted to set private field on non-instance");return m.set(h,k),k}});var Eh=eb(i=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=Fh(),b=Me(),c=function(){function n(u,A,B){this.name=u,this.instanceFactory=A,this.type=B,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return n.prototype.setInstantiationMode=function(u){return this.instantiationMode=u,this},n.prototype.setMultipleInstances=function(u){return this.multipleInstances=u,this},n.prototype.setServiceProps=function(u){return this.serviceProps=u,this},n}();var d="[DEFAULT]";var e=function(){function n(u,A){this.name=u,this.container=A,this.component=null,this.instances=new Map(),this.instancesDeferred=new Map()}return n.prototype.get=function(u){u===void 0&&(u=d);var A=this.normalizeInstanceIdentifier(u);if(!this.instancesDeferred.has(A)){var B=new b.Deferred();this.instancesDeferred.set(A,B);try{var D=this.getOrInitializeService(A);D&&B.resolve(D)}catch(G){}}return this.instancesDeferred.get(A).promise},n.prototype.getImmediate=function(u){var A=a.__assign({identifier:d,optional:!1},u),B=A.identifier,D=A.optional,G=this.normalizeInstanceIdentifier(B);try{var H=this.getOrInitializeService(G);if(!H){if(D)return null;throw Error("Service "+this.name+" is not available")}return H}catch(L){if(D)return null;throw L}},n.prototype.getComponent=function(){return this.component},n.prototype.setComponent=function(u){var A,B;if(u.name!==this.name)throw Error("Mismatching Component "+u.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");this.component=u;if(g(u))try{this.getOrInitializeService(d)}catch(V){}try{for(var D=a.__values(this.instancesDeferred.entries()),G=D.next();!G.done;G=D.next()){var H=a.__read(G.value,2),L=H[0],J=H[1],N=this.normalizeInstanceIdentifier(L);try{var I=this.getOrInitializeService(N);J.resolve(I)}catch(V){}}}catch(V){A={error:V}}finally{try{G&&!G.done&&(B=D.return)&&B.call(D)}finally{if(A)throw A.error}}},n.prototype.clearInstance=function(u){u===void 0&&(u=d),this.instancesDeferred.delete(u),this.instances.delete(u)},n.prototype.delete=function(){return a.__awaiter(this,void 0,void 0,function(){var u;return a.__generator(this,function(A){switch(A.label){case 0:return u=Array.from(this.instances.values()),[4,Promise.all(u.filter(function(B){return"INTERNAL"in B}).map(function(B){return B.INTERNAL.delete()}))];case 1:return A.sent(),[2]}})})},n.prototype.isComponentSet=function(){return this.component!=null},n.prototype.getOrInitializeService=function(u){var A=this.instances.get(u);return!A&&this.component&&(A=this.component.instanceFactory(this.container,f(u)),this.instances.set(u,A)),A||null},n.prototype.normalizeInstanceIdentifier=function(u){return this.component?this.component.multipleInstances?u:d:u},n}();function f(n){return n===d?void 0:n}function g(n){return n.instantiationMode==="EAGER"}var j=function(){function n(u){this.name=u,this.providers=new Map()}return n.prototype.addComponent=function(u){var A=this.getProvider(u.name);if(A.isComponentSet())throw new Error("Component "+u.name+" has already been registered with "+this.name);A.setComponent(u)},n.prototype.addOrOverwriteComponent=function(u){var A=this.getProvider(u.name);A.isComponentSet()&&this.providers.delete(u.name),this.addComponent(u)},n.prototype.getProvider=function(u){if(this.providers.has(u))return this.providers.get(u);var A=new e(u,this);return this.providers.set(u,A),A},n.prototype.getProviders=function(){return Array.from(this.providers.values())},n}();i.Component=c;i.ComponentContainer=j;i.Provider=e});var Gh=eb(u=>{zb(u,{LogLevel:()=>d,Logger:()=>i,setLogLevel:()=>l,setUserLogHandler:()=>n});function a(){for(var B=0,D=0,G=arguments.length;D<G;D++)B+=arguments[D].length;for(var H=Array(B),L=0,D=0;D<G;D++)for(var J=arguments[D],N=0,I=J.length;N<I;N++,L++)H[L]=J[N];return H}var b,c=[],d;(function(B){B[B.DEBUG=0]="DEBUG",B[B.VERBOSE=1]="VERBOSE",B[B.INFO=2]="INFO",B[B.WARN=3]="WARN",B[B.ERROR=4]="ERROR",B[B.SILENT=5]="SILENT"})(d||(d={}));var e={debug:d.DEBUG,verbose:d.VERBOSE,info:d.INFO,warn:d.WARN,error:d.ERROR,silent:d.SILENT},f=d.INFO,g=(b={},b[d.DEBUG]="log",b[d.VERBOSE]="log",b[d.INFO]="info",b[d.WARN]="warn",b[d.ERROR]="error",b),j=function(B,D){for(var G=[],H=2;H<arguments.length;H++)G[H-2]=arguments[H];if(D<B.logLevel)return;var L=new Date().toISOString(),J=g[D];if(J)console[J].apply(console,a(["["+L+"]  "+B.name+":"],G));else throw new Error("Attempted to log a message with an invalid logType (value: "+D+")")},i=function(){function B(D){this.name=D,this._logLevel=f,this._logHandler=j,this._userLogHandler=null,c.push(this)}return Object.defineProperty(B.prototype,"logLevel",{get:function(){return this._logLevel},set:function(D){if(!(D in d))throw new TypeError('Invalid value "'+D+'" assigned to `logLevel`');this._logLevel=D},enumerable:!0,configurable:!0}),B.prototype.setLogLevel=function(D){this._logLevel=typeof D==="string"?e[D]:D},Object.defineProperty(B.prototype,"logHandler",{get:function(){return this._logHandler},set:function(D){if(typeof D!=="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=D},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(D){this._userLogHandler=D},enumerable:!0,configurable:!0}),B.prototype.debug=function(){for(var D=[],G=0;G<arguments.length;G++)D[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.DEBUG],D)),this._logHandler.apply(this,a([this,d.DEBUG],D))},B.prototype.log=function(){for(var D=[],G=0;G<arguments.length;G++)D[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.VERBOSE],D)),this._logHandler.apply(this,a([this,d.VERBOSE],D))},B.prototype.info=function(){for(var D=[],G=0;G<arguments.length;G++)D[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.INFO],D)),this._logHandler.apply(this,a([this,d.INFO],D))},B.prototype.warn=function(){for(var D=[],G=0;G<arguments.length;G++)D[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.WARN],D)),this._logHandler.apply(this,a([this,d.WARN],D))},B.prototype.error=function(){for(var D=[],G=0;G<arguments.length;G++)D[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.ERROR],D)),this._logHandler.apply(this,a([this,d.ERROR],D))},B}();function l(B){c.forEach(function(D){D.setLogLevel(B)})}function n(B,D){for(var G=function(N){var I=null;D&&D.level&&(I=e[D.level]),B===null?N.userLogHandler=null:N.userLogHandler=function(V,W){for(var M=[],q=2;q<arguments.length;q++)M[q-2]=arguments[q];var r=M.map(function(h){if(h==null)return null;{if(typeof h==="string")return h;{if(typeof h==="number"||typeof h==="boolean")return h.toString();{if(h instanceof Error)return h.message;try{return JSON.stringify(h)}catch(m){return null}}}}}).filter(function(h){return h}).join(" ");W>=(I!==null&&I!==void 0?I:V.logLevel)&&B({level:d[W].toLowerCase(),message:r,args:M,type:V.name})}},H=0,L=c;H<L.length;H++){var J=L[H];G(J)}}});var Ch=eb(y=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0});var a=Dh(),b=Me(),c=Eh(),d=Gh();var e,f=(e={},e["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",e["bad-app-name"]="Illegal App name: '{$appName}",e["duplicate-app"]="Firebase App named '{$appName}' already exists",e["app-deleted"]="Firebase App named '{$appName}' already deleted",e["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",e["invalid-log-argument"]="First argument to `onLog` must be null or a function.",e),g=new b.ErrorFactory("app","Firebase",f),j="@firebase/app",i="0.6.7",l="@firebase/analytics",n="@firebase/auth",u="@firebase/database",A="@firebase/functions",B="@firebase/installations",D="@firebase/messaging",G="@firebase/performance",H="@firebase/remote-config",L="@firebase/storage",J="@firebase/firestore",N="firebase-wrapper";var I,V="[DEFAULT]",W=(I={},I[j]="fire-core",I[l]="fire-analytics",I[n]="fire-auth",I[u]="fire-rtdb",I[A]="fire-fn",I[B]="fire-iid",I[D]="fire-fcm",I[G]="fire-perf",I[H]="fire-rc",I[L]="fire-gcs",I[J]="fire-fst",I["fire-js"]="fire-js",I[N]="fire-js-all",I);var M=new d.Logger("@firebase/app");var q=function(){function O(z,K,Z){var ia,na,pa=this;this.firebase_=Z,this.isDeleted_=!1,this.name_=K.name,this.automaticDataCollectionEnabled_=K.automaticDataCollectionEnabled||!1,this.options_=b.deepCopy(z),this.container=new c.ComponentContainer(K.name),this._addComponent(new c.Component("app",function(){return pa},"PUBLIC"));try{for(var ma=a.__values(this.firebase_.INTERNAL.components.values()),T=ma.next();!T.done;T=ma.next()){var ea=T.value;this._addComponent(ea)}}catch(ja){ia={error:ja}}finally{try{T&&!T.done&&(na=ma.return)&&na.call(ma)}finally{if(ia)throw ia.error}}}return Object.defineProperty(O.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(z){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=z},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),O.prototype.delete=function(){var z=this;return new Promise(function(K){z.checkDestroyed_(),K()}).then(function(){return z.firebase_.INTERNAL.removeApp(z.name_),Promise.all(z.container.getProviders().map(function(K){return K.delete()}))}).then(function(){z.isDeleted_=!0})},O.prototype._getService=function(z,K){return K===void 0&&(K=V),this.checkDestroyed_(),this.container.getProvider(z).getImmediate({identifier:K})},O.prototype._removeServiceInstance=function(z,K){K===void 0&&(K=V),this.container.getProvider(z).clearInstance(K)},O.prototype._addComponent=function(z){try{this.container.addComponent(z)}catch(K){M.debug("Component "+z.name+" failed to register with FirebaseApp "+this.name,K)}},O.prototype._addOrOverwriteComponent=function(z){this.container.addOrOverwriteComponent(z)},O.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw g.create("app-deleted",{appName:this.name_})},O}();q.prototype.name&&q.prototype.options||q.prototype.delete||console.log("dc");var r="7.15.5";function h(O){var z={},K=new Map(),Z={__esModule:!0,initializeApp:pa,app:na,registerVersion:ea,setLogLevel:d.setLogLevel,onLog:ja,apps:null,SDK_VERSION:r,INTERNAL:{registerComponent:T,removeApp:ia,components:K,useAsService:ka}};Z.default=Z,Object.defineProperty(Z,"apps",{get:ma});function ia(R){delete z[R]}function na(R){R=R||V;if(!b.contains(z,R))throw g.create("no-app",{appName:R});return z[R]}na.App=O;function pa(R,S){S===void 0&&(S={});if(typeof S!=="object"||S===null){var ga=S;S={name:ga}}var P=S;P.name===void 0&&(P.name=V);var fa=P.name;if(typeof fa!=="string"||!fa)throw g.create("bad-app-name",{appName:String(fa)});if(b.contains(z,fa))throw g.create("duplicate-app",{appName:fa});var Q=new O(R,P,Z);return z[fa]=Q,Q}function ma(){return Object.keys(z).map(function(R){return z[R]})}function T(R){var S,ga,P=R.name;if(K.has(P))return M.debug("There were multiple attempts to register component "+P+"."),R.type==="PUBLIC"?Z[P]:null;K.set(P,R);if(R.type==="PUBLIC"){var fa=function(s){s===void 0&&(s=na());if(typeof s[P]!=="function")throw g.create("invalid-app-argument",{appName:P});return s[P]()};R.serviceProps!==void 0&&b.deepExtend(fa,R.serviceProps),Z[P]=fa,O.prototype[P]=function(){for(var s=[],x=0;x<arguments.length;x++)s[x]=arguments[x];var C=this._getService.bind(this,P);return C.apply(this,R.multipleInstances?s:[])}}try{for(var Q=a.__values(Object.keys(z)),ua=Q.next();!ua.done;ua=Q.next()){var v=ua.value;z[v]._addComponent(R)}}catch(s){S={error:s}}finally{try{ua&&!ua.done&&(ga=Q.return)&&ga.call(Q)}finally{if(S)throw S.error}}return R.type==="PUBLIC"?Z[P]:null}function ea(R,S,ga){var P,fa=(P=W[R])!==null&&P!==void 0?P:R;ga&&(fa+="-"+ga);var Q=fa.match(/\s|\//),ua=S.match(/\s|\//);if(Q||ua){var v=['Unable to register library "'+fa+'" with version "'+S+'":'];Q&&v.push('library name "'+fa+'" contains illegal characters (whitespace or "/")'),Q&&ua&&v.push("and"),ua&&v.push('version name "'+S+'" contains illegal characters (whitespace or "/")'),M.warn(v.join(" "));return}T(new c.Component(fa+"-version",function(){return{library:fa,version:S}},"VERSION"))}function ja(R,S){if(R!==null&&typeof R!=="function")throw g.create("invalid-log-argument",{appName:name});d.setUserLogHandler(R,S)}function ka(R,S){if(S==="serverAuth")return null;var ga=S;return ga}return Z}function m(){var O=h(q);O.INTERNAL=a.__assign(a.__assign({},O.INTERNAL),{createFirebaseNamespace:m,extendNamespace:z,createSubscribe:b.createSubscribe,ErrorFactory:b.ErrorFactory,deepExtend:b.deepExtend});function z(K){b.deepExtend(O,K)}return O}var k=m();var p=function(){function O(z){this.container=z}return O.prototype.getPlatformInfoString=function(){var z=this.container.getProviders();return z.map(function(K){if(t(K)){var Z=K.getImmediate();return Z.library+"/"+Z.version}else return null}).filter(function(K){return K}).join(" ")},O}();function t(O){var z=O.getComponent();return(z===null||z===void 0?void 0:z.type)==="VERSION"}function o(O,z){O.INTERNAL.registerComponent(new c.Component("platform-logger",function(K){return new p(K)},"PRIVATE")),O.registerVersion(j,i,z),O.registerVersion("fire-js","")}if(b.isBrowser()&&self.firebase!==void 0){M.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);var E=self.firebase.SDK_VERSION;E&&E.indexOf("LITE")>=0&&M.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}var F=k.initializeApp;k.initializeApp=function(){for(var O=[],z=0;z<arguments.length;z++)O[z]=arguments[z];return b.isNode()&&M.warn(`
      Warning: This is a browser-targeted Firebase bundle but it appears it is being
      run in a Node environment.  If running in a Node environment, make sure you
      are using the bundle specified by the "main" field in package.json.
      
      If you are using Webpack, you can specify "main" as the first item in
      "resolve.mainFields":
      https://webpack.js.org/configuration/resolve/#resolvemainfields
      
      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"
      as the first item in "mainFields", e.g. ['main', 'module'].
      https://github.com/rollup/rollup-plugin-node-resolve
      `),F.apply(void 0,O)};var X=k;o(X);y.default=X;y.firebase=X});var La=eb((e,f)=>{"use strict";function a(g){return g&&typeof g==="object"&&"default"in g?g.default:g}var b=a(Ch()),c="firebase",d="7.15.5";b.registerVersion(c,d,"app");f.exports=b});var Jm=eb((b,c)=>{var a=function(){function d(l,n){if(!j[l]){j[l]={};for(var u=0;u<l.length;u++)j[l][l.charAt(u)]=u}return j[l][n]}var e=String.fromCharCode,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",j={},i={compressToBase64:function(l){if(null==l)return"";var n=i._compress(l,6,function(u){return f.charAt(u)});switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(l){return null==l?"":""==l?null:i._decompress(l.length,32,function(n){return d(f,l.charAt(n))})},compressToUTF16:function(l){return null==l?"":i._compress(l,15,function(n){return e(n+32)})+" "},decompressFromUTF16:function(l){return null==l?"":""==l?null:i._decompress(l.length,16384,function(n){return l.charCodeAt(n)-32})},compressToUint8Array:function(l){for(var n=i.compress(l),u=new Uint8Array(2*n.length),A=0,B=n.length;B>A;A++){var D=n.charCodeAt(A);u[2*A]=D>>>8,u[2*A+1]=D%256}return u},decompressFromUint8Array:function(l){if(null===l||void 0===l)return i.decompress(l);for(var n=new Array(l.length/2),u=0,A=n.length;A>u;u++)n[u]=256*l[2*u]+l[2*u+1];var B=[];return n.forEach(function(D){B.push(e(D))}),i.decompress(B.join(""))},compressToEncodedURIComponent:function(l){return null==l?"":i._compress(l,6,function(n){return g.charAt(n)})},decompressFromEncodedURIComponent:function(l){return null==l?"":""==l?null:(l=l.replace(/ /g,"+"),i._decompress(l.length,32,function(n){return d(g,l.charAt(n))}))},compress:function(l){return i._compress(l,16,function(n){return e(n)})},_compress:function(l,n,u){if(null==l)return"";var A,B,D,G={},H={},L="",J="",N="",I=2,V=3,W=2,M=[],q=0,r=0;for(D=0;D<l.length;D+=1)if(L=l.charAt(D),Object.prototype.hasOwnProperty.call(G,L)||(G[L]=V++,H[L]=!0),J=N+L,Object.prototype.hasOwnProperty.call(G,J))N=J;else{if(Object.prototype.hasOwnProperty.call(H,N)){if(N.charCodeAt(0)<256){for(A=0;W>A;A++)q<<=1,r==n-1?(r=0,M.push(u(q)),q=0):r++;for(B=N.charCodeAt(0),A=0;8>A;A++)q=q<<1|1&B,r==n-1?(r=0,M.push(u(q)),q=0):r++,B>>=1}else{for(B=1,A=0;W>A;A++)q=q<<1|B,r==n-1?(r=0,M.push(u(q)),q=0):r++,B=0;for(B=N.charCodeAt(0),A=0;16>A;A++)q=q<<1|1&B,r==n-1?(r=0,M.push(u(q)),q=0):r++,B>>=1}I--,0==I&&(I=Math.pow(2,W),W++),delete H[N]}else for(B=G[N],A=0;W>A;A++)q=q<<1|1&B,r==n-1?(r=0,M.push(u(q)),q=0):r++,B>>=1;I--,0==I&&(I=Math.pow(2,W),W++),G[J]=V++,N=String(L)}if(""!==N){if(Object.prototype.hasOwnProperty.call(H,N)){if(N.charCodeAt(0)<256){for(A=0;W>A;A++)q<<=1,r==n-1?(r=0,M.push(u(q)),q=0):r++;for(B=N.charCodeAt(0),A=0;8>A;A++)q=q<<1|1&B,r==n-1?(r=0,M.push(u(q)),q=0):r++,B>>=1}else{for(B=1,A=0;W>A;A++)q=q<<1|B,r==n-1?(r=0,M.push(u(q)),q=0):r++,B=0;for(B=N.charCodeAt(0),A=0;16>A;A++)q=q<<1|1&B,r==n-1?(r=0,M.push(u(q)),q=0):r++,B>>=1}I--,0==I&&(I=Math.pow(2,W),W++),delete H[N]}else for(B=G[N],A=0;W>A;A++)q=q<<1|1&B,r==n-1?(r=0,M.push(u(q)),q=0):r++,B>>=1;I--,0==I&&(I=Math.pow(2,W),W++)}for(B=2,A=0;W>A;A++)q=q<<1|1&B,r==n-1?(r=0,M.push(u(q)),q=0):r++,B>>=1;for(;;){if(q<<=1,r==n-1){M.push(u(q));break}r++}return M.join("")},decompress:function(l){return null==l?"":""==l?null:i._decompress(l.length,32768,function(n){return l.charCodeAt(n)})},_decompress:function(l,n,u){var A,B,D,G,H,L,J,N,I=[],V=4,W=4,M=3,q="",r=[],h={val:u(0),position:n,index:1};for(B=0;3>B;B+=1)I[B]=B;for(G=0,L=Math.pow(2,2),J=1;J!=L;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),G|=(H>0?1:0)*J,J<<=1;switch(A=G){case 0:for(G=0,L=Math.pow(2,8),J=1;J!=L;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),G|=(H>0?1:0)*J,J<<=1;N=e(G);break;case 1:for(G=0,L=Math.pow(2,16),J=1;J!=L;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),G|=(H>0?1:0)*J,J<<=1;N=e(G);break;case 2:return""}for(I[3]=N,D=N,r.push(N);;){if(h.index>l)return"";for(G=0,L=Math.pow(2,M),J=1;J!=L;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),G|=(H>0?1:0)*J,J<<=1;switch(N=G){case 0:for(G=0,L=Math.pow(2,8),J=1;J!=L;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),G|=(H>0?1:0)*J,J<<=1;I[W++]=e(G),N=W-1,V--;break;case 1:for(G=0,L=Math.pow(2,16),J=1;J!=L;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),G|=(H>0?1:0)*J,J<<=1;I[W++]=e(G),N=W-1,V--;break;case 2:return r.join("")}if(0==V&&(V=Math.pow(2,M),M++),I[N])q=I[N];else{if(N!==W)return null;q=D+D.charAt(0)}r.push(q),I[W++]=D+q.charAt(0),V--,D=q,0==V&&(V=Math.pow(2,M),M++)}}};return i}();"function"==typeof define&&define.amd?define(function(){return a}):"undefined"!=typeof c&&null!=c&&(c.exports=a)});let Nh,Oh=0,Ph=0;const wa={get:()=>Nh,set:a=>{Nh=a},getFrame:()=>Oh,setFrame:a=>{Oh=a},getElapsed:()=>Ph,setElapsed:a=>{Ph=a}};let Th=0;function Ge(a=0){return()=>{Th=a}}function Uc(){return Th}let Qe="Phaser",Mm="https://phaser4.io",Nm="#fff",Om="linear-gradient(#3e0081 40%, #00bcc3)";function Ne(){if(Qe!==""){const a=wa.get(),b=Qe==="Phaser"?" v"+a.VERSION:"";console.log(`%c${Qe}${b}%c ${Mm}`,`padding: 4px 16px; color: ${Nm}; background: ${Om}`,"")}}let Yh=800,Zh=600,_h=1;function Je(a=800,b=600,c=1){return c===0&&(c=window.devicePixelRatio),()=>{Yh=a,Zh=b,_h=c}}function Sb(){return Yh}function Tb(){return Zh}function Ub(){return _h}const cf=[],Wb={add:a=>{cf.push(a)},get:()=>cf,clear:()=>{cf.length=0}};let Xh;function Vc(a){Xh=a}function Oe(){return Xh}let Re=.5,Se=.5;let Uh=0;function Te(a){Uh=a}function mc(){return Uh}function Wc(a){let b;return a&&(typeof a==="string"?b=document.getElementById(a):typeof a==="object"&&a.nodeType===1&&(b=a)),b||(b=document.body),b}let Vh;function He(a){return()=>{a&&(Vh=Wc(a))}}function Pe(){return Vh}let Wh=[];function Ie(a){return()=>{Wh=[].concat(a)}}function Ue(){return Wh}let Qm={alpha:!1,antialias:!1,depth:!1,premultipliedAlpha:!1};function Ve(){return Qm}class xi{constructor(a){this.stack=[],this.current=null,this.renderer=a}reset(){this.stack=[],this.current=null;const a=this.renderer,b=a.gl;b.bindFramebuffer(b.FRAMEBUFFER,null),b.viewport(0,0,a.width,a.height)}add(a,b=!0,c=0,d=0){this.stack.push({framebuffer:a,width:c,height:d}),this.set(a,b,c,d)}set(a,b=!0,c=0,d=0){const e=this.renderer,f=e.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),b&&(f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),c>0&&f.viewport(0,0,c,d),this.current=a}pop(){this.stack.pop();const a=this.stack.length;if(a>0){const b=this.stack[a-1];this.set(b.framebuffer,!1,b.width,b.height)}else this.reset()}rebind(){const a=this.renderer.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.current)}destroy(){this.stack=[]}}let wi;const Aa={get:()=>wi,set:a=>{wi=a}};function yi(a,b=[]){const c=a>>16&255,d=a>>8&255,e=a&255,f=a>16777215?a>>>24:255;return b[0]=c/255,b[1]=d/255,b[2]=e/255,b[3]=f/255,b}function ti(a,b){return a.a===b.a&&a.b===b.b&&a.c===b.c&&a.d===b.d&&a.tx===b.tx&&a.ty===b.ty}function Fi(a,b){const c=Aa.get();b||(b=c.COLOR_ATTACHMENT0);const d=c.createFramebuffer();return c.bindFramebuffer(c.FRAMEBUFFER,d),c.framebufferTexture2D(c.FRAMEBUFFER,b,c.TEXTURE_2D,a,0),c.bindFramebuffer(c.FRAMEBUFFER,null),d}function jd(a){const b=Aa.get();if(!b)return;const{parent:c,flipY:d,unpackPremultiplyAlpha:e,minFilter:f,magFilter:g,wrapS:j,wrapT:i,generateMipmap:l,isPOT:n}=a,u=c.image;let A=c.width,B=c.height;const D=b.createTexture();return b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,D),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,d),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),u?(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,u),A=u.width,B=u.height):b.texImage2D(b.TEXTURE_2D,0,b.RGBA,A,B,0,b.RGBA,b.UNSIGNED_BYTE,null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,g),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,j),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,i),l&&n&&b.generateMipmap(b.TEXTURE_2D),a.texture=D,D}function Gi(a){const b=Aa.get();b&&b.isFramebuffer(a)&&b.deleteFramebuffer(a)}function df(a){const b=Aa.get();if(!b)return;b.isTexture(a)&&b.deleteTexture(a)}function ui(a,b){return a<1||b<1?!1:(a&a-1)===0&&(b&b-1)===0}function Ji(a,b=!0){const c=Aa.get();c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,a);const d=b?c.LINEAR:c.NEAREST;c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,d),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,d)}function Ki(a){const b=Aa.get(),c=a.parent.image,d=c.width,e=c.height;return d>0&&e>0&&(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,a.texture),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,a.flipY),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,c)),a.texture}class id{constructor(a,b={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1;const c=Aa.get();this.parent=a,this.isPOT=ui(a.width,a.height);const{texture:d=null,framebuffer:e=null,unpackPremultiplyAlpha:f=!0,minFilter:g=c.LINEAR,magFilter:j=c.LINEAR,wrapS:i=c.CLAMP_TO_EDGE,wrapT:l=c.CLAMP_TO_EDGE,generateMipmap:n=this.isPOT,flipY:u=!1}=b;this.minFilter=g,this.magFilter=j,this.wrapS=i,this.wrapT=l,this.generateMipmap=n,this.flipY=u,this.unpackPremultiplyAlpha=f,e&&(this.framebuffer=e),d?this.texture=d:jd(this)}setFilter(a){this.texture&&Ji(this.texture,a)}create(){const a=this.texture;return a&&df(a),jd(this)}update(){const a=this.texture;return a?Ki(this):jd(this)}setIndex(a){this.dirtyIndex=a!==this.index,this.index=a}destroy(){df(this.texture),Gi(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}}class Ei{constructor(a,b,c,d,e){this.batchSize=a,this.dataSize=b,this.indexSize=c,this.vertexElementSize=d,this.quadIndexSize=e,this.vertexByteSize=d*b,this.quadByteSize=this.vertexByteSize*4,this.quadElementSize=d*4,this.bufferByteSize=a*this.quadByteSize,this.create()}create(){let a=[];for(let c=0;c<this.batchSize*this.indexSize;c+=this.indexSize)a.push(c+0,c+1,c+2,c+2,c+3,c+0);this.data=new ArrayBuffer(this.bufferByteSize),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const b=Aa.get();this.vertexBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.data,b.DYNAMIC_DRAW),this.indexBuffer=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.index,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,null),a=[]}destroy(){}}class ef{constructor(a,b,c,d,e,f){this.trimmed=!1,this.texture=a,this.key=b,this.x=c,this.y=d,this.width=e,this.height=f,this.sourceSizeWidth=e,this.sourceSizeHeight=f,this.updateUVs()}setPivot(a,b){this.pivot={x:a,y:b}}setSize(a,b){this.width=a,this.height=b,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.updateUVs()}setSourceSize(a,b){this.sourceSizeWidth=a,this.sourceSizeHeight=b}setTrim(a,b,c,d,e,f){this.trimmed=!0,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.spriteSourceSizeX=c,this.spriteSourceSizeY=d,this.spriteSourceSizeWidth=e,this.spriteSourceSizeHeight=f}getExtent(a,b){const c=this.sourceSizeWidth,d=this.sourceSizeHeight;let e,f,g,j;return this.trimmed?(e=this.spriteSourceSizeX-a*c,f=e+this.spriteSourceSizeWidth,g=this.spriteSourceSizeY-b*d,j=g+this.spriteSourceSizeHeight):(e=-a*c,f=e+c,g=-b*d,j=g+d),{left:e,right:f,top:g,bottom:j}}setExtent(a){const b=a.transform,c=b.origin.x,d=b.origin.y,e=this.sourceSizeWidth,f=this.sourceSizeHeight;let g,j,i,l;this.trimmed?(g=this.spriteSourceSizeX-c*e,j=this.spriteSourceSizeY-d*f,i=this.spriteSourceSizeWidth,l=this.spriteSourceSizeHeight):(g=-c*e,j=-d*f,i=e,l=f),b.setExtent(g,j,i,l)}updateUVs(){const{x:a,y:b,width:c,height:d}=this,e=this.texture.width,f=this.texture.height;this.u0=a/e,this.v0=b/f,this.u1=(a+c)/e,this.v1=(b+d)/f}}class $a{constructor(a,b,c){this.key="",a&&(b=a.width,c=a.height),this.image=a,this.width=b,this.height=c,this.frames=new Map(),this.data={},this.addFrame("__BASE",0,0,b,c),Wb.add(this)}addFrame(a,b,c,d,e){if(this.frames.has(a))return null;const f=new ef(this,a,b,c,d,e);return this.frames.set(a,f),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=f),f}getFrame(a){if(!a)return this.firstFrame;a instanceof ef&&(a=a.key);let b=this.frames.get(a);return b||(console.warn(`Frame missing: ${a}`),b=this.firstFrame),b}setSize(a,b){this.width=a,this.height=b;const c=this.frames.get("__BASE");c.setSize(a,b)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}}let Di;const rc={get:()=>Di,set:a=>{Di=a}};const Ii={fragmentShader:`\r
#define SHADER_NAME SINGLE_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture;\r
\r
void main (void)\r
{\r
    vec4 color = texture2D(uTexture, vTextureCoord);\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`,vertexShader:`\r
#define SHADER_NAME SINGLE_QUAD_VERT\r
\r
precision highp float;\r
\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
attribute float aTextureId;\r
attribute vec4 aTintColor;\r
\r
uniform mat4 uProjectionMatrix;\r
uniform mat4 uCameraMatrix;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
void main (void)\r
{\r
    vTextureCoord = aTextureCoord;\r
    vTextureId = aTextureId;\r
    vTintColor = aTintColor;\r
\r
    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\r
}`};class hd{constructor(a={}){this.attribs={aVertexPosition:0,aTextureCoord:0,aTextureId:0,aTintColor:0},this.uniforms={uProjectionMatrix:0,uCameraMatrix:0,uTexture:0,uTime:0,uResolution:0},this.renderToFBO=!1,this.renderer=rc.get();const{batchSize:b=4096,dataSize:c=4,indexSize:d=4,vertexElementSize:e=6,quadIndexSize:f=6,fragmentShader:g=Ii.fragmentShader,vertexShader:j=Ii.vertexShader,width:i=Sb(),height:l=Tb(),resolution:n=Ub(),renderToFBO:u=!1}=a;this.buffer=new Ei(b,c,d,e,f),this.createShaders(g,j),this.count=0,this.renderToFBO=u;const A=new $a(null,i*n,l*n),B=new id(A);A.binding=B,B.framebuffer=Fi(B.texture),this.texture=A,this.framebuffer=B.framebuffer}createShaders(a,b){const c=this.renderer.gl,d=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(d,a),c.compileShader(d);let e=!1,f=c.getShaderInfoLog(d);f.length>0&&(e=!0,console.error(f));const g=c.createShader(c.VERTEX_SHADER);c.shaderSource(g,b),c.compileShader(g),f=c.getShaderInfoLog(d),f.length>0&&(e=!0,console.error(f));if(e)return;const j=c.createProgram();c.attachShader(j,g),c.attachShader(j,d),c.linkProgram(j),c.useProgram(j),this.program=j;for(const i of Object.keys(this.attribs)){const l=c.getAttribLocation(j,i);c.enableVertexAttribArray(l),this.attribs[i]=l}for(const i of Object.keys(this.uniforms))this.uniforms[i]=c.getUniformLocation(j,i)}bind(a,b,c){if(!this.program)return!1;const d=this.renderer,e=d.gl,f=this.uniforms;return e.useProgram(this.program),e.uniformMatrix4fv(f.uProjectionMatrix,!1,a),e.uniformMatrix4fv(f.uCameraMatrix,!1,b),e.uniform1i(f.uTexture,d.textures.textureIndex[c]),e.uniform1f(f.uTime,performance.now()),e.uniform2f(f.uResolution,d.width,d.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}bindBuffers(a,b){const c=this.renderer.gl,d=this.buffer.vertexByteSize,e=this.attribs;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a),c.bindBuffer(c.ARRAY_BUFFER,b),c.vertexAttribPointer(e.aVertexPosition,2,c.FLOAT,!1,d,0),c.vertexAttribPointer(e.aTextureCoord,2,c.FLOAT,!1,d,8),c.vertexAttribPointer(e.aTextureId,1,c.FLOAT,!1,d,16),c.vertexAttribPointer(e.aTintColor,4,c.UNSIGNED_BYTE,!0,d,20),this.count=0}draw(a){const b=this.renderer,c=b.gl,d=this.buffer;if(a===d.batchSize)c.bufferData(c.ARRAY_BUFFER,d.data,c.DYNAMIC_DRAW);else{const e=d.vertexViewF32.subarray(0,a*d.quadElementSize);c.bufferSubData(c.ARRAY_BUFFER,0,e)}this.renderToFBO&&b.fbo.add(this.framebuffer,!0),c.drawElements(c.TRIANGLES,a*d.quadIndexSize,c.UNSIGNED_SHORT,0),this.renderToFBO&&b.fbo.pop()}flush(){const a=this.count;return a===0?!1:(this.draw(a),this.prevCount=a,this.count=0,!0)}}const _m=`\r
#define SHADER_NAME MULTI_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture[%count%];\r
\r
void main (void)\r
{\r
    vec4 color;\r
\r
    %forloop%\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`;class zi extends hd{constructor(a={fragmentShader:_m}){super(a)}createShaders(a,b){const c=mc();let d="";for(let e=1;e<c;e++)e>1&&(d+=`
	else `),e<c-1&&(d+=`if (vTextureId < ${e}.5)`),d+=`
	{`,d+=`
		color = texture2D(uTexture[${e}], vTextureCoord);`,d+=`
	}`;a=a.replace(/%count%/gi,`${c}`),a=a.replace(/%forloop%/gi,d),super.createShaders(a,b)}bind(a,b){if(!this.program)return!1;const c=this.renderer,d=c.gl,e=this.uniforms;return d.useProgram(this.program),d.uniformMatrix4fv(e.uProjectionMatrix,!1,a),d.uniformMatrix4fv(e.uCameraMatrix,!1,b),d.uniform1iv(e.uTexture,c.textures.textureIndex),d.uniform1f(e.uTime,performance.now()),d.uniform2f(e.uResolution,c.width,c.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}}function Ai(a,b,c=-1,d=1){const e=-2*(1/-a),f=-2*(1/b),g=2*(1/(c-d));return new Float32Array([e,0,0,0,0,f,0,0,0,0,g,0,-1,1,0,1])}class Bi{constructor(a,b){this.renderer=a;const c={shader:new b()};this.stack=[c],this.currentEntry=c,this.current=c.shader,this.singleQuadShader=new hd()}add(a,b){const c={shader:a,textureID:b};return this.stack.push(c),c}set(a,b){this.flush();const c=this.renderer,d=c.projectionMatrix,e=c.currentCamera.matrix,f=a.bind(d,e,b);if(f){const g=this.add(a,b);this.currentEntry=g,this.current=a}return f}setDefault(a){this.set(this.singleQuadShader,a)}pop(){this.flush();const a=this.stack;a.length>1&&a.pop(),this.currentEntry=a[a.length-1],this.current=this.currentEntry.shader}reset(){this.pop(),this.rebind()}flush(){return this.current.flush()?(this.renderer.flushTotal++,!0):!1}rebind(){const a=this.renderer,b=a.projectionMatrix,c=a.currentCamera.matrix,d=this.currentEntry;d.shader.bind(b,c,d.textureID)}popAndRebind(){this.pop(),this.rebind()}clear(){}destroy(){}}const Ym=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Zm(a){let b="";for(let c=0;c<a;++c)c>0&&(b+=`
else `),c<a-1&&(b+=`if(test == ${c}.0){}`);return b}function Hi(a,b){const c=b.createShader(b.FRAGMENT_SHADER);for(;;){const d=Ym.replace(/%forloop%/gi,Zm(a));b.shaderSource(c,d),b.compileShader(c);if(!b.getShaderParameter(c,b.COMPILE_STATUS))a=a/2|0;else break}return a}class Ci{constructor(a){this.startActiveTexture=0,this.renderer=a,this.tempTextures=[],this.textureIndex=[]}init(){const a=this.renderer.gl;let b=Hi(a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),a);const c=mc();c===0||c>0&&c>b?Te(b):c>0&&c<b&&(b=Math.max(8,c));const d=this.tempTextures;d.length&&d.forEach(f=>{a.deleteTexture(f)});const e=[];for(let f=0;f<b;f++){const g=a.createTexture();a.activeTexture(a.TEXTURE0+f),a.bindTexture(a.TEXTURE_2D,g),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),d[f]=g,e.push(f)}this.maxTextures=b,this.textureIndex=e,this.currentActiveTexture=1}update(){const a=Wb.get();for(let b=0;b<a.length;b++){const c=a[b];c.binding||(c.binding=new id(c))}Wb.clear()}reset(){const a=this.renderer.gl,b=this.tempTextures;for(let c=0;c<b.length;c++)a.activeTexture(a.TEXTURE0+c),a.bindTexture(a.TEXTURE_2D,b[c]);this.currentActiveTexture=1,this.startActiveTexture++}bind(a,b=0){const c=this.renderer.gl,d=a.binding;d.setIndex(b),c.activeTexture(c.TEXTURE0+b),c.bindTexture(c.TEXTURE_2D,d.texture)}unbind(a=0){const b=this.renderer.gl;b.activeTexture(b.TEXTURE0+a),b.bindTexture(b.TEXTURE_2D,this.tempTextures[a]),a>0&&this.startActiveTexture++}request(a){const b=this.renderer.gl,c=a.binding,d=this.currentActiveTexture;return c.indexCounter>=this.startActiveTexture?!1:(c.indexCounter=this.startActiveTexture,d<this.maxTextures?(c.setIndex(d),b.activeTexture(b.TEXTURE0+d),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture++):(this.renderer.flush(),this.startActiveTexture++,c.indexCounter=this.startActiveTexture,c.setIndex(1),b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture=2),!0)}}class $h{constructor(){this.clearColor=[0,0,0,1],this.flushTotal=0,this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.currentCamera=null,this.width=Sb(),this.height=Tb(),this.resolution=Ub(),this.setBackgroundColor(Uc());const a=document.createElement("canvas");a.addEventListener("webglcontextlost",b=>this.onContextLost(b),!1),a.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=a,this.fbo=new xi(this),this.textures=new Ci(this),this.initContext(),rc.set(this),this.shaders=new Bi(this,zi)}initContext(){const a=this.canvas.getContext("webgl",Ve());Aa.set(a),this.gl=a,a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE),this.resize(this.width,this.height,this.resolution),this.textures.init()}resize(a,b,c=1){this.width=a*c,this.height=b*c,this.resolution=c;const d=this.canvas;d.width=this.width,d.height=this.height,this.autoResize&&(d.style.width=(this.width/c).toString()+"px",d.style.height=(this.height/c).toString()+"px"),this.gl.viewport(0,0,this.width,this.height),this.projectionMatrix=Ai(a,b)}onContextLost(a){a.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(a){return yi(a,this.clearColor),this}reset(a=null,b=this.width,c=this.height){const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),d.viewport(0,0,b,c),d.enable(d.BLEND),d.blendFunc(d.ONE,d.ONE_MINUS_SRC_ALPHA),this.flushTotal=0,this.currentCamera=null,this.textures.update()}render(a){if(this.contextLost)return;this.reset();if(this.optimizeRedraw&&a.numDirtyFrames===0&&a.numDirtyCameras===0)return;const b=this.gl;if(this.clearBeforeRender){const d=this.clearColor;b.clearColor(d[0],d[1],d[2],d[3]),b.clear(b.COLOR_BUFFER_BIT)}const c=a.worldData;for(let d=0;d<c.length;d++){const{camera:e,renderList:f}=c[d];(!this.currentCamera||!ti(e.worldTransform,this.currentCamera.worldTransform))&&(this.flush(),this.currentCamera=e,this.shaders.rebind()),f.forEach(g=>{g.children.length?this.renderNode(g):g.node.renderGL(this)})}this.flush()}renderNode(a){a.node.renderGL(this),a.children.forEach(b=>{b.children.length>0?this.renderNode(b):b.node.renderGL(this)}),a.node.postRenderGL(this)}flush(){this.shaders.flush()}destroy(){rc.set(void 0)}}function Ke(){return()=>{Vc($h)}}function ya(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);for(const e of d)e.callback.apply(e.context,c),e.once&&d.delete(e);return d.size===0&&a.events.delete(b),!0}function Ih(a,b){const c=Wc(b);return c.appendChild(a),a}function Jh(a){const b=document.readyState;if(b==="complete"||b==="interactive"){a();return}const c=()=>{document.removeEventListener("deviceready",c,!0),document.removeEventListener("DOMContentLoaded",c,!0),window.removeEventListener("load",c,!0),a()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",c,!0):(document.addEventListener("DOMContentLoaded",c,!0),window.addEventListener("load",c,!0)):window.setTimeout(c,20)}class Kh{constructor(){this.events=new Map()}}class Yc{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function Vb(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new Yc(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function _c(a,b,c,d=a){return Vb(a,b,c,d,!0)}function Li(){return{gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]}}function Oi(a,b=0){a.gameFrame=b,a.numTotalFrames=0,a.numDirtyFrames=0,a.numDirtyCameras=0,a.worldData.length=0}let Pi;const kd={get:()=>Pi,set:a=>{Pi=a}};class Lh{constructor(){this.scenes=new Map(),this.sceneIndex=0,this.flush=!1,this.renderResult=Li(),this.game=wa.get(),kd.set(this),_c(this.game,"boot",()=>this.boot())}boot(){Ue().forEach(a=>new a())}update(a,b){for(const c of this.scenes.values())ya(c,"update",a,b)}render(a){const b=this.renderResult;Oi(b,a);for(const c of this.scenes.values())ya(c,"render",b);return this.flush&&(b.numDirtyFrames++,this.flush=!1),b}}function tc(a,b){const c=document.createElement("canvas");return c.width=a,c.height=b,c.getContext("2d")}let Qi;const Ka={get:()=>Qi,set:a=>{Qi=a}};class Mh{constructor(){this.textures=new Map(),this.createDefaultTextures(),Ka.set(this)}createDefaultTextures(){this.add("__BLANK",new $a(tc(32,32).canvas));const a=tc(32,32);a.strokeStyle="#0f0",a.moveTo(0,0),a.lineTo(32,32),a.stroke(),a.strokeRect(.5,.5,31,31),this.add("__MISSING",new $a(a.canvas))}get(a){const b=this.textures;return b.has(a)?b.get(a):b.get("__MISSING")}has(a){return this.textures.has(a)}add(a,b){let c;const d=this.textures;return d.has(a)||(b instanceof $a?c=b:c=new $a(b),c.key=a,d.set(a,c)),c}}class zh extends Kh{constructor(...a){super();this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,wa.set(this),Jh(()=>this.boot(a))}boot(a){a.forEach(d=>d());const b=Oe();this.renderer=new b(),this.textureManager=new Mh(),this.sceneManager=new Lh();const c=Pe();c&&Ih(this.renderer.canvas,c),this.isBooted=!0,Ne(),ya(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(a){const b=a-this.lastTick;this.lastTick=a,this.elapsed+=b,this.isPaused||(this.willUpdate&&(this.sceneManager.update(b,a),ya(this,"update",b,a)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,wa.setFrame(this.frame),wa.setElapsed(this.elapsed),requestAnimationFrame(c=>this.step(c))}destroy(){}}function Mi(a,b,c){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:c}function Ni(a,b={}){const c=kd.get(),d=c.scenes.size,e=c.sceneIndex,f=d===0;typeof b==="string"?a.key=b:(b||!b&&f)&&(a.key=Mi(b,"key","scene"+e.toString())),c.scenes.has(a.key)?console.warn("Scene key already in use: "+a.key):(c.scenes.set(a.key,a),c.flush=!0,c.sceneIndex++)}class Ah{constructor(a){this.game=wa.get(),this.events=new Map(),Ni(this,a)}}class Ab{constructor(a=1,b=0,c=0,d=1,e=0,f=0){this.set(a,b,c,d,e,f)}set(a=1,b=0,c=0,d=1,e=0,f=0){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=e,this.ty=f,this}identity(){return this.set()}toArray(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]}fromArray(a){return this.set(a[0],a[1],a[2],a[3],a[4],a[5])}}function ed(a,b,c){return a.width<=0||a.height<=0?!1:a.x<=b&&a.x+a.width>=b&&a.y<=c&&a.y+a.height>=c}class Ha{constructor(a=0,b=0,c=0,d=0){this.set(a,b,c,d)}set(a=0,b=0,c=0,d=0){return this.x=a,this.y=b,this.width=c,this.height=d,this}contains(a,b){return ed(this,a,b)}set right(a){a<=this.x?this.width=0:this.width=a-this.x}get right(){return this.x+this.width}set bottom(a){a<=this.y?this.height=0:this.height=a-this.y}get bottom(){return this.y+this.height}}function vi(){}class hb{constructor(a,b=0,c=0,d=!1){this.compareValue=!1,this._x=b,this._y=c,this.callback=a,this.compareValue=d}set(a=0,b=0){return this._x=a,this._y=b,this.callback(this),this}destroy(){this.callback=vi}set x(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._x=a,this.callback(this))}get x(){return this._x}set y(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._y=a,this.callback(this))}get y(){return this._y}}function si(a,b,c){const d=c-b;return b+((a-b)%d+d)%d}function Qh(a){return si(a,-Math.PI,Math.PI)}class Rh{constructor(){this._rotation=0,this.type="Camera",this.dirtyRender=!0;const a=wa.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1]),this.bounds=new Ha(),this.worldTransform=new Ab(),this.position=new hb(()=>this.updateTransform(),0,0),this.scale=new hb(()=>this.updateTransform(),1,1),this.origin=new hb(()=>this.updateTransform(),.5,.5),this.reset()}updateTransform(){const a=this.matrix,b=this.position.x,c=this.position.y,d=this.scale.x,e=this.scale.y,f=-b+this.width*this.origin.x,g=-c+this.height*this.origin.y,j=Math.sin(this.rotation),i=Math.cos(this.rotation),l=j+j,n=j*l,u=i*l,A=(1-n)*d,B=u*d,D=-u*e,G=(1-n)*e;a[0]=A,a[1]=B,a[4]=D,a[5]=G,a[12]=b+f-(A*f+D*g),a[13]=c+g-(B*f+G*g),this.worldTransform.set(i*d,j*d,-j*e,i*e,-b,-c);const H=this.width*(1/d),L=this.height*(1/e);this.bounds.set(f-H/2,g-L/2,H,L),this.dirtyRender=!0}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}set rotation(a){a!==this._rotation&&(this._rotation=Qh(a),this.updateTransform())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.origin.destroy(),this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}class Sh{constructor(){this.type="StaticCamera",this.dirtyRender=!0;const a=wa.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.bounds=new Ha(),this.worldTransform=new Ab(),this.reset()}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}function Cb(a){const b=[a],c=[];for(;b.length>0;){const d=b.shift();c.push(d);const e=d.numChildren;if(e>0)for(let f=e-1;f>=0;f--)b.unshift(d.children[f])}return c.shift(),c}function ib(a,b){return a.children.indexOf(b)}function Xc(a,b){const c=a.children;let d;if(b>=0&&b<c.length){const e=c.splice(b,1);e[0]&&(d=e[0],d.parent=null)}return d}function oc(a,b){const c=ib(a,b);return c>-1&&Xc(a,c),b}const _e="addedtoworld";const $c="destroy";const gi="postupdate";const $e="removedfromworld";const hi="update";function Ze(a,...b){return b.forEach(c=>{c.world&&(ya(c.world,$e,c,c.world),ya(c,$e,c,c.world)),c.world=a,ya(a,_e,c,a),ya(c,_e,c,a)}),b}function Bb(a,...b){b.forEach(d=>{d.parent&&oc(d.parent,d),d.parent=a});const c=a.world;return c&&Ze(c,...Cb(a)),b}const aa={CLEAR:0,TRANSFORM:1,UPDATE:2,CHILD_CACHE:4,POST_RENDER:8,COLORS:16,BOUNDS:32,TEXTURE:64,FRAME:128,ALPHA:256,CHILD:512,DEFAULT:1+2+16+32,USER1:536870912,USER2:1073741824,USER3:2147483648,USER4:4294967296};function nc(a,b=0,c){const d=a.children;c===void 0&&(c=d.length);const e=c-b;if(e>0&&e<=c){const f=d.splice(b,e);return f.forEach(g=>{g.parent=null}),f}else return[]}function We(a,b=0,c){const d=nc(a,b,c);d.forEach(e=>{e.destroy()})}function Xe(a,...b){return b.forEach(c=>{oc(a,c)}),b}function Ye(a,b,c=0,d){const e=nc(a,c,d);return Bb(b,...e),e.forEach(f=>{f.transform.updateWorld()}),e}function Zc(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof Yc)g.delete(c);else{const j=!d,i=e!==void 0;for(const l of g)l.callback===c&&(j&&l.context===d)&&(i&&l.once===e)&&g.delete(l)}return g.size===0&&f.delete(b),a}function bd(a){const{a:b,b:c,c:d,d:e,tx:f,ty:g}=a.world,{x:j,y:i,right:l,bottom:n}=a.extent,u=j*b+i*d+f,A=j*c+i*e+g,B=j*b+n*d+f,D=j*c+n*e+g,G=l*b+n*d+f,H=l*c+n*e+g,L=l*b+i*d+f,J=l*c+i*e+g;return{x0:u,y0:A,x1:B,y1:D,x2:G,y2:H,x3:L,y3:J}}class ai{constructor(a){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=a,this.area=new Ha()}set(a,b,c,d){this.area.set(a,b,c,d)}get(){return this.entity.isDirty(aa.BOUNDS)&&!this.fixed&&this.update(),this.area}updateLocal(){const{x0:a,y0:b,x1:c,y1:d,x2:e,y2:f,x3:g,y3:j}=bd(this.entity.transform),i=Math.min(a,c,e,g),l=Math.min(b,d,f,j),n=Math.max(a,c,e,g),u=Math.max(b,d,f,j);return this.area.set(i,l,n-i,u-l)}update(){const a=this.updateLocal();this.entity.clearDirty(aa.BOUNDS);if(!this.includeChildren||!this.entity.numChildren)return a;const b=this.visibleOnly,c=this.entity.children;let d=a.x,e=a.y,f=a.right,g=a.bottom;for(let j=0;j<c.length;j++){const i=c[j];if(!i||b&&!i.visible)continue;const l=i.bounds.get();l.x<d&&(d=l.x),l.y<e&&(e=l.y),l.right>f&&(f=l.right),l.bottom>g&&(g=l.bottom)}return a.set(d,e,f-d,g-e)}destroy(){this.entity=null,this.area=null}}class bi{constructor(a){this.enabled=!1,this.enabledChildren=!0,this.entity=a}destroy(){this.entity=null,this.hitArea=null}}class _a{constructor(a=0,b=0){this.set(a,b)}set(a=0,b=0){return this.x=a,this.y=b,this}getArray(){return[this.x,this.y]}fromArray(a){return this.set(a[0],a[1])}toString(){return`[x=${this.x}, y=${this.y}]`}}function di(a){const b=a.local,c=a.position.x,d=a.position.y,e=a.rotation,f=a.scale.x,g=a.scale.y,j=a.skew.x,i=a.skew.y;b.set(Math.cos(e+i)*f,Math.sin(e+i)*f,-Math.sin(e-j)*g,Math.cos(e-j)*g,c,d)}function af(a,b){return b.set(a.a,a.b,a.c,a.d,a.tx,a.ty)}function ei(a){const b=a.parent,c=a.transform,d=c.local,e=c.world;if(!b)af(d,e);else if(c.passthru)af(b.transform.world,e);else{const{a:f,b:g,c:j,d:i,tx:l,ty:n}=d,{a:u,b:A,c:B,d:D,tx:G,ty:H}=b.transform.world;e.set(f*u+g*B,f*A+g*D,j*u+i*B,j*A+i*D,l*u+n*B+G,l*A+n*D+H)}}class ci{constructor(a,b=0,c=0){this.passthru=!1,this._rotation=0,this.entity=a,this.local=new Ab(),this.world=new Ab(),this.position=new hb(()=>this.update(),b,c),this.scale=new hb(()=>this.update(),1,1,!0),this.skew=new hb(()=>this.update(),0,0,!0),this.origin=new hb(()=>this.updateExtent(),Re,Se),this.extent=new Ha()}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(aa.TRANSFORM,aa.BOUNDS),di(this)}updateWorld(){const a=this.entity;a.setDirty(aa.TRANSFORM,aa.BOUNDS),ei(a),a.numChildren&&this.updateChildren()}updateChildren(){const a=this.entity.children;for(let b=0;b<a.length;b++){const c=a[b];c.transform.updateWorld()}}globalToLocal(a,b,c=new _a()){const{a:d,b:e,c:f,d:g,tx:j,ty:i}=this.world,l=1/(d*g+f*-e);return c.x=g*l*a+-f*l*b+(i*f-j*g)*l,c.y=d*l*b+-e*l*a+(-i*d+j*e)*l,c}localToGlobal(a,b,c=new _a()){const{a:d,b:e,c:f,d:g,tx:j,ty:i}=this.world;return c.x=d*a+f*b+j,c.y=e*a+g*b+i,c}setExtent(a,b,c,d){this.extent.set(a,b,c,d),this.entity.setDirty(aa.TRANSFORM,aa.BOUNDS)}updateExtent(a,b){const c=this.extent,d=this.entity;a!==void 0&&(c.width=a),b!==void 0&&(c.height=b),c.x=-this.origin.x*c.width,c.y=-this.origin.y*c.height,d.setDirty(aa.TRANSFORM,aa.BOUNDS)}set rotation(a){a!==this._rotation&&(this._rotation=a,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}}class ad{constructor(a=0,b=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.events=new Map(),this.transform=new ci(this,a,b),this.bounds=new ai(this),this.input=new bi(this),this.dirty=aa.DEFAULT,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(a){return(this.dirty&a)!==0}clearDirty(a){return this.isDirty(a)&&(this.dirty^=a),this}setDirty(a,b){return this.isDirty(a)||(this.dirty^=a,this.dirtyFrame=wa.getFrame()),this.isDirty(b)||(this.dirty^=b),this}update(a,b){if(this.willUpdateChildren){const c=this.children;for(let d=0;d<c.length;d++){const e=c[d];e&&e.willUpdate&&e.update(a,b)}}this.postUpdate(a,b)}postUpdate(a,b){}renderGL(a){}renderCanvas(a){}postRenderGL(a){}postRenderCanvas(a){}get numChildren(){return this.children.length}destroy(a){a?Ye(this,a):We(this),ya(this,$c,this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}}const fd="worldrender";const gd="worldshutdown";var Xm=Object.freeze({__proto__:null,WorldRenderEvent:fd,WorldShutdownEvent:gd});function ld(a,b){b.numRendered++,b.numRenderable++,a.node.dirtyFrame>=b.gameFrame&&b.dirtyFrame++,a.children.forEach(c=>{c.children.length>0&&ld(c,b)})}function jf(a){if(a.node.isDirty(aa.CHILD_CACHE))return!0;const b=[a];for(;b.length>0;){const c=b.pop();if(c.node.isDirty(aa.TRANSFORM))return!0;const d=c.children.length;if(d>0)for(let e=0;e<d;e++)b.push(c.children[e])}return b.length=0,!1}function hf(a,b){a.forEach(c=>{b||jf(c)?c.node.setDirty(aa.CHILD_CACHE):c.children.length=0})}function md(a,b,c=[]){for(let d=0;d<b.numChildren;d++){const e=b.children[d];if(e.isRenderable()){const f=[],g={node:e,children:f};c.push(g),e.willRenderChildren&&e.numChildren>0&&(e.willCacheChildren&&a.push(g),md(a,e,f))}}return c}function ff(a){const b=[],c=[],d=md(b,a,c),e=a.renderData;b.length>0&&hf(b,a.camera.dirtyRender),d.forEach(f=>{f.children.length?ld(f,e):(e.numRendered++,e.numRenderable++,f.node.dirtyFrame>=e.gameFrame&&e.dirtyFrame++)}),e.renderList=d,a.forceRefresh&&(e.dirtyFrame++,a.forceRefresh=!1)}function gf(a,b){a.numDirtyFrames+=b.dirtyFrame,a.numTotalFrames+=b.numRendered,b.camera.dirtyRender&&a.numDirtyCameras++,a.worldData.push(b)}function uc(a,b){a.gameFrame=b,a.dirtyFrame=0,a.numRendered=0,a.numRenderable=0,a.renderList.length=0}class vc extends ad{constructor(a){super();this.forceRefresh=!1,this.type="BaseWorld",this.scene=a,this.world=this,this.events=new Map(),this._updateListener=Vb(a,"update",(b,c)=>this.update(b,c)),this._renderListener=Vb(a,"render",b=>this.render(b)),this._shutdownListener=Vb(a,"shutdown",()=>this.shutdown()),_c(a,"destroy",()=>this.destroy())}update(a,b){if(!this.willUpdate)return;ya(this,hi,a,b,this),super.update(a,b)}postUpdate(a,b){ya(this,gi,a,b,this)}render(a){const b=this.renderData;uc(b,a.gameFrame);if(!this.willRender||!this.visible)return;ff(this),ya(this,fd,b,this),gf(a,b),this.camera&&(this.camera.dirtyRender=!1)}shutdown(){const a=this.scene;Zc(a,"update",this._updateListener),Zc(a,"render",this._renderListener),Zc(a,"shutdown",this._shutdownListener),Xe(this),ya(this,gd,this),uc(this.renderData,0),this.camera&&this.camera.reset()}destroy(a){super.destroy(a),ya(this,$c,this),uc(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}}function wc(a){return{camera:a,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0,renderList:[]}}class Le extends vc{constructor(a){super(a);this.type="StaticWorld",this.camera=new Sh(),this.renderData=wc(this.camera)}}class $m extends vc{constructor(a){super(a);this.enableCameraCull=!0,this.type="World",this.camera=new Rh(),this.renderData=wc(this.camera)}}function Sc(a,b){return a.children.push(b),Bb(a,b),b.transform.updateWorld(),b}class pi{constructor(a,b,c){this.responseType="text",this.crossOrigin=void 0,this.skipCache=!1,this.hasLoaded=!1,this.key=a,this.url=b,this.config=c}}function qi(a,b,c,d){return b||(b=a+c),/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/.exec(b)?b:d?d.baseURL+d.path+b:b}function ri(a){return a.data=new Image(),a.crossOrigin&&(a.data.crossOrigin=a.crossOrigin),new Promise((b,c)=>{a.data.onload=()=>{a.data.onload&&(a.data.onload=null,a.data.onerror=null,b(a))},a.data.onerror=d=>{a.data.onload&&(a.data.onload=null,a.data.onerror=null,a.error=d,c(a))},a.data.src=a.url,a.data.complete&&a.data.width&&a.data.height&&(a.data.onload=null,a.data.onerror=null,b(a))})}function Bh(a,b){const c=new pi(a,b);return c.load=()=>(c.url=qi(c.key,c.url,".png",c.loader),c.loader&&(c.crossOrigin=c.loader.crossOrigin),new Promise((d,e)=>{const f=Ka.get();f.has(c.key)?d(c):ri(c).then(g=>{f.add(g.key,g.data),d(g)}).catch(g=>{e(g)})})),c}var nh;(function(a){a[a.IDLE=0]="IDLE",a[a.UPDATING=1]="UPDATING"})(nh||(nh={}));function Ra(a,b){return a===void 0||b===void 0?void 0:`${a}|${b}`}function Tj(a,b){let c=a.split("|");return b===void 0&&(b=Zn),b.x=parseInt(c[0]),b.y=parseInt(c[1]),b}let Zn={x:0,y:0};class Pb{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(a){return this.items.push(a),this}pushMultiple(a){return this.items.push.apply(this.items,a),a.length=0,this}clear(){return this.items.length=0,this}}let Hm=new Pb();function $i(){let a=Hm.pop();return a===null&&(a=new Map()),a}function Fd(a){Hm.push(a)}function Zi(a,b,c,d,e,f,g,j){if(c===f&&d===g&&e===j)return;let i=Ra(c,d),l=Ra(f,g);if(i){let n=b.get(i);n.delete(e);if(i===l){n.set(j,a);return}else n.size===0&&(Fd(n),b.delete(i))}if(l){let n=b.get(l);n?n.set(j,a):(n=$i(),n.set(j,a),b.set(l,n))}}function Cf(a,b,c,d){let e=Ra(b,c),f=a.get(e);f&&(d!==void 0?(f.delete(d),f.size===0&&(Fd(f),a.delete(e))):(f.clear(),Fd(f),a.delete(e)))}let Im=new Pb();function _i(){let a=Im.pop();return a===null&&(a=new Set()),a}function Bf(a){Im.push(a)}function Ed(a,b,c,d){if(c===d)return;if(c!==void 0){let e=b.get(c);e&&(e.delete(a),e.size===0&&(Bf(e),b.delete(c)))}if(d!==void 0){let e=b.get(d);e?e.add(a):(e=_i(),e.add(a),b.set(d,e))}}function Gb(a,b,c){let d=a.get(b);d&&(d.delete(c),d.size===0&&(Bf(d),a.delete(b)))}function Ui(a,b,c,d,e){let f=a.chessToXYZ.get(b),g=f?f.x:void 0,j=f?f.y:void 0,i=f?f.y:void 0;f?(f.x=c,f.y=d,f.z=e):a.chessToXYZ.set(b,{x:c,y:d,z:e}),Zi(b,a.XYToZMap,g,j,i,c,d,e),Ed(b,a.XToChessSet,g,c),Ed(b,a.YToChessSet,j,d),Ed(b,a.ZToChessSet,i,e)}function Fb(a,b,c,d){let e=a.XYToZMap.get(Ra(b,c));return e===void 0?null:d!==void 0?e.has(d)?e.get(d):null:e}function Vi(a,b,c,d){if(d!==void 0){let e=Fb(a,b,c,d);if(e===void 0)return;a.chessToXYZ.delete(e),Cf(a.XYToZMap,b,c,d),Gb(a.XToChessSet,b,e),Gb(a.YToChessSet,c,e),Gb(a.ZToChessSet,d,e)}else{let e=Fb(a,b,c);if(e){for(const[f,g]of e)a.chessToXYZ.delete(g),Gb(a.XToChessSet,b,g),Gb(a.YToChessSet,c,g),Gb(a.ZToChessSet,f,g);Cf(a.XYToZMap,b,c)}}}function Wi(a,b){return a.chessToXYZ.has(b)}function Xi(a,b,c,d){return Fb(a,b,c,d)!==null}function Yi(a,b){return a.chessToXYZ.get(b)||null}function zf(a){let b=-Infinity;for(const[c,d]of a)b<c&&(b=c);return b}function Af(a){let b=Infinity;for(const[c,d]of a)b>c&&(b=c);return b}class kf{constructor(){this.chessToXYZ=new Map(),this.XYToZMap=new Map(),this.XToChessSet=new Map(),this.YToChessSet=new Map(),this.ZToChessSet=new Map(),this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0}destroy(){this.clear()}clear(){return this.chessToXYZ.clear(),this.XYToZMap.clear(),this.XToChessSet.clear(),this.YToChessSet.clear(),this.ZToChessSet.clear(),this.clearBounds(),this}clearBounds(){return this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0,this}addChess(a,b,c,d){return Ui(this,a,b,c,d),this.clearBounds(),this}getChess(a,b,c){return Fb(this,a,b,c)}removeChess(a,b,c){return Vi(this,a,b,c),this.clearBounds(),this}hasChess(a){return Wi(this,a)}contains(a,b,c){return Xi(this,a,b,c)}getXYZ(a){return Yi(this,a)}get xMax(){return this._xMax===void 0&&(this._xMax=zf(this.XToChessSet)),this._xMax}get xMin(){return this._xMin===void 0&&(this._xMin=Af(this.XToChessSet)),this._xMin}get yMax(){return this._yMax===void 0&&(this._yMax=zf(this.YToChessSet)),this._yMax}get yMin(){return this._yMin===void 0&&(this._yMin=Af(this.YToChessSet)),this._yMin}}function ab(a,b=[]){let c=a.boardData.chessToXYZ;for(const[d,e]of c)b.push(d);return b}function Uj(a){if(typeof a!=="object"||a.nodeType||a===a.window)return!1;try{if(a.constructor&&!{}.hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0}function Bc(a){return Uj(a)?!0:typeof a==="object"?a.isTileXYZ:!1}function ba(a,b){let c=a.boardData.getXYZ(b);return c?c:Bc(b)?b:null}function qa(a,b,c,d){return a.boardData.getChess(b,c,d)}class aj{constructor(a){this.parent=a,this.board=null,this.blocker=!1,this.boot()}boot(){typeof this.parent==="object"&&this.parent.on&&this.parent.on("destroy",this.destroy,this)}destroy(){if(this.board){let a=this.tileXYZ;this.board.boardData.removeChess(a.x,a.y,a.z)}this.parent=void 0,this.board=null}setBoard(a){return this.board=a,this}get tileXYZ(){return this.board==null?null:this.board.boardData.getXYZ(this.parent)}setBlocker(a=!0){return this.blocker=a,this}setBlockEdge(a,b=!0){typeof this.blocker==="boolean"&&(this.blocker={});let c=this.blocker;if(typeof a==="object"){let d=a;for(let e in d)c[e]=d[e]}else c[a]=b;return this}getBlockEdge(a){return typeof this.blocker==="boolean"?!1:this.blocker.hasOwnProperty(a)?this.blocker[a]:!1}}function Ua(a){return a.hasOwnProperty("rexChess")||(a.rexChess=new aj(a)),a.rexChess}function Na(a,b,c,d,e,f=!1,g=!1){if(b){let j=ba(a,b);if(j)c=j.x,d=j.y,e=j.z;else return}else{b=qa(a,c,d,e);if(!b)return}g||a.boardData.removeChess(c,d,e),a._isBoard&&Ua(b).setBoard(null),f&&b.destroy&&b.destroy()}function Eb(a,b){if(a.infinityMode)return;if(a.height===void 0||a.height<=b){a.height=b;return}let c=ab(a);c.forEach(d=>{let e=ba(a,d);e.y>b&&Na(a,d)}),a.height=b}function Db(a,b){if(a.infinityMode)return;if(a.width===void 0||a.width<=b){a.width=b;return}let c=ab(a);c.forEach(d=>{let e=ba(a,d);e.x>b&&Na(a,d)}),a.width=b}class nd{constructor({grid:a=void 0,wrap:b=!1,inifinity:c=!1,width:d=0,height:e=0}={}){this.boardData=new kf(),this._isBoard=!0,this.setGrid(a),this.setWrapMode(b),this.setInfinityMode(c),this.setBoardSize(d,e)}destroy(){}setGrid(a){return this.grid=a,this}setWrapMode(a=!0){return this.wrapMode=a,this}setInfinityMode(a=!0){return this.infinityMode=a,this}setBoardSize(a=0,b=0){return Db(this,a),Eb(this,b),this}}function Ta(a,b,c,d){let e;return a.infinityMode?e=!0:e=b>=0&&b<a.width&&c>=0&&c<a.height,e&&d!==void 0&&(e=a.boardData.contains(b,c,d)),e}function Ea(a,b,c,d){return a.grid.getWorldXY(b,c,d)}function bc(a,b,c,d){if(b===void 0){let e=ab(a);for(let f=0,g=e.length;f<g;f++){let j=e[f],i=ba(a,j);Ea(a,i.x,i.y,j)}}else{if(c===void 0){let e=ba(a,b);c=e.x,d=e.y}Ea(a,c,d,b)}}function ob(a,b,c,d,e,f=!0){if(!Ta(a,c,d))return;let g=ba(a,b);e===void 0&&(g?e=g.z:e=0);if(g&&g.x===c&&g.y===d&&g.z===e)return;let j=qa(a,c,d,e);j&&Na(a,null,c,d,e),a.boardData.addChess(b,c,d,e),a._isBoard&&Ua(b).setBoard(a),f&&bc(a,b,c,d)}function Kb(a,b,c,d){return Math.atan2(d-b,c-a)}function pb(a,b,c){let d=ba(a,b),e=ba(a,c),f=Ea(a,d.x,d.y,!0),g=f.x,j=f.y;f=Ea(a,e.x,e.y,!0);let i=f.x,l=f.y;return Kb(g,j,i,l)}function jb(a,b,c){let d=c-b;return b+((a-b)%d+d)%d}function ac(a,b,c,d={x:0,y:0}){return d===!0&&(d=fn),a.wrapMode?b=jb(b,0,a.width):!a.infinityMode&&(b<0||b>=a.width)&&(b=null),a.wrapMode?c=jb(c,0,a.height):!a.infinityMode&&(c<0||c>=a.height)&&(c=null),d.x=b,d.y=c,d}let fn={x:0,y:0};function Ma(a,b,c,d,e){let f=ba(a,b);if(f===null)return null;typeof c==="string"&&(c.indexOf(",")===-1?c=parseInt(c):c=c.split(".").map(l=>parseInt(l,10)));let g=typeof c==="number",j=typeof d==="number";if(g&&j){let l=a.grid.getTileXYAtDirection(f,c,d,e);return ac(a,l.x,l.y,l),(l.x===null||l.y===null)&&(l=null),l}Array.isArray(e)||(e=[]),c===null&&(c=a.grid.allDirections);let i;if(g)if(Array.isArray(d))for(let l=0,n=d.length;l<n;l++)i=Ma(a,f,c,d[l]),i!==null&&e.push(i);else{let l,n,u;({end:l=1,start:n=l>0?1:-1,step:u=l>=n?1:-1}=d);if(n===l)i=Ma(a,f,c,l),i!==null&&e.push(i);else if(n<l)for(let A=n;A<=l;A+=u)i=Ma(a,f,c,A),i!==null&&e.push(i);else for(let A=n;A>=l;A+=u)i=Ma(a,f,c,A),i!==null&&e.push(i)}else for(let l=0,n=c.length;l<n;l++)j?(i=Ma(a,f,c[l],d),i!==null&&e.push(i)):Ma(a,f,c[l],d,e);return e}function fb(a,b,c=null,d={x:0,y:0}){return Ma(a,b,c,1,d)}function Zb(a,b,c){b===void 0&&(b=kn);let d=a.wrapMode,e=a.infinityMode;a.wrapMode=!1,a.infinityMode=!0;let f=fb(a,b,c,!0);return a.wrapMode=d,a.infinityMode=e,pb(a,b,f)}let kn={x:0,y:0};const pp=180/Math.PI;function ec(a){return a*pp}function ej(a,b){let c=b-a;if(c===0)return 0;let d=Math.floor((c- -180)/360);return c-d*360}function Yb(a,b,c){c=ec(c);let d=a.grid.allDirections,e=Infinity,f;for(let g=0,j=d.length;g<j;g++){let i=ec(Zb(a,b,d[g])),l=Math.abs(ej(c,i));l<e&&(e=l,f=g)}return f}function $b(a,b,c){if(b===null||c===null)return null;if(b.x===c.x&&b.y===c.y)return null;let d=a.grid.getNeighborTileDirection(b,c);if(a.wrapMode&&d===null){let e=fb(a,b,null);for(let f=0,g=e.length;f<g;f++){let j=e[f];if(c.x===j.x&&c.y===j.y){d=f;break}}}return d}function _b(a,b,c){let d=ba(a,b),e=ba(a,c);return $b(a,d,e)}function pd(a,b,c){return _b(a,b,c)!==null}function qd(a,b,c,d=!0){let e=ba(a,b),f=ba(a,c);return e===null||f===null?null:a.grid.directionBetween(e,f,d)}function yc(a,b,c=1,d=[]){let e=a.grid.ringToTileXYArray(b,c);for(let f=0,g=e.length;f<g;f++){let j=e[f];Ta(a,j.x,j.y)&&d.push(j)}return d}function lf(a,b,c,d=!0,e=[]){for(let f=0;f<=c;f++){let g=d?f:c-f;yc(a,b,g,e)}return e}function bb(a,b,c,d,e={x:0,y:0}){return e===!0&&(e=hn),c===0&&d===0?(e.x=b.x,e.y=b.y):a.grid.offset(b,c,d,e),e}let hn={x:0,y:0};function mf(a,b){let c=Infinity,d=Infinity,e;for(let j=0,i=b.length;j<i;j++)e=b[j],c=Math.min(c,e.x),d=Math.min(d,e.y);if(c!==0||d!==0)for(let j=0,i=b.length;j<i;j++)e=b[j],bb(a,e,-c,-d,e);let f=-Infinity,g=-Infinity;for(let j=0,i=b.length;j<i;j++)e=b[j],f=Math.max(f,e.x),g=Math.max(g,e.y);return Db(a,f+1),Eb(a,g+1),b}var Ib;(function(a){a[a["x+,y+"]=0]="x+,y+",a[a["x-,y+"]=1]="x-,y+",a[a["y+,x+"]=2]="y+,x+",a[a["y-,x+"]=3]="y-,x+"})(Ib||(Ib={}));function rd(a,b,c,d=0){let e={x:0,y:0};switch(d){case 0:for(let f=0;f<a.height;f++)for(let g=0;g<a.width;g++)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 1:for(let f=0;f<a.height;f++)for(let g=a.width-1;g>=0;g--)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 2:for(let f=0;f<a.width;f++)for(let g=0;g<a.height;g++)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a);break;case 3:for(let f=0;f<a.width;f++)for(let g=a.height-1;g>=0;g--)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a)}}function sd(a,b,c,d){return a.grid.getDistance(b,c,d)}function xc(a,b=0,c=[]){if(Array.isArray(b)){let d=b;for(let e=0;e<a.height;e++)for(let f=0;f<a.width;f++){let g=!0;for(let j=0,i=d.length;j<i;j++)if(qa(a,f,e,d[j])!==null){g=!1;break}g&&c.push({x:f,y:e})}}else for(let d=0;d<a.height;d++)for(let e=0;e<a.width;e++)qa(a,e,d,b)===null&&c.push({x:e,y:d});return c}function td(a,b,c,d){return a.grid.getGridPoints(b,c,d)}function Oa(a,b,c,d=[]){let e=a.boardData.getChess(b,c);for(const[f,g]of e)d.push(g);return d}function cc(a,b,c,d=[]){let e=c!=null,f,g;for(let j=0,i=b.length;j<i;j++)f=b[j],e?(g=qa(a,f.x,f.y,c),g!==null&&d.push(g)):Oa(a,f.x,f.y,d);return d}function ud(a,b,c,d,e){let f=ba(a,b);if(f===null)return null;d==null&&(d=f.hasOwnProperty("z")?f.z:null);let g=fb(a,f,c,!0);return g===null?null:Array.isArray(g)?(e===void 0&&(e=[]),cc(a,g,d,e)):d==null?(e===void 0&&(e=[]),Oa(a,g.x,g.y,e)):qa(a,g.x,g.y,d)}function vd(a,b,c,d={x:0,y:0}){let e=Yb(a,b,c);return Ma(a,b,e,1,d)}function wd(a,b,c,d){return a.grid.getOppositeDirection(b,c,d)}function zc(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function dc(a,b=0,c=a.length){let d=b+Math.floor(Math.random()*c);return a[d]===void 0?null:a[d]}function nf(a,b=0,c={x:0,y:0}){c===!0&&(c=cn);let d=Math.floor(a.width*a.height*.3);for(let f=0;f<d;f++){let g=zc(0,a.width-1),j=zc(0,a.height-1);if(qa(a,g,j,b)===null)return c.x=g,c.y=j,c}let e=xc(a,b);if(e.length===0)return null;{let f=dc(e);return c.x=f.x,c.y=f.y,c}}let cn={x:0,y:0};function of(a,b,c,d){if(d===void 0){let e=Oa(a,b,c);for(let f=0,g=e.length;f<g;f++){let j=Ua(e[f]).blocker;if(j===!0)return!0}return!1}else{let e=qa(a,b,c,d);if(e===null)return!1;let f=Ua(e).blocker;return f===!0}}function pf(a,b){return a.boardData.chessToXYZ.has(b)}function qf(a,b,c,d,e){if(d===void 0){let f=Oa(a,b,c);for(let g=0,j=f.length;g<j;g++)if(Ti(Ua(f[g]).blocker,e))return!0;return!1}else{let f=qa(a,b,c,d);return f===null?!1:Ti(Ua(f).blocker,e)}}function Ti(a,b){return a===!1||a===!0?a:a[b]===!0}function Ef(a){return a=a%Dm,a>=0?a:a+Dm}const Dm=Math.PI*2;function fj(a,b,c=1e-4){return Math.abs(a-b)<c}function xd(a,b,c,d,e){let f=ba(a,b),g=ba(a,c),j=pb(a,f,g);j=Ef(j);let i=Math.abs(j-d);i=Math.min(i,ln-i);let l=e/2;return fj(i,l)||i<l}const ln=Math.PI*2;function yd(a,b,c,d,e){let f=ba(a,b),g=ba(a,c),j=a.grid.directions;a.grid.directions=a.grid.sides;let i=a.grid.directionBetween(f,g,!1);a.grid.directions=j;let l=Math.abs(i-d);return l=Math.min(l,a.grid.directions-l),l<=e/2}function Ia(a,b,c,d={x:0,y:0}){return a.grid.getTileXY(b,c,d)}function zd(a,b,c,d){if(a.infinityMode&&d===void 0)return!0;let e=Ia(a,b,c,!0);return Ta(a,e.x,e.y,d)}function dj(a,b,c,d){let e=a-c,f=b-d;return Math.sqrt(e*e+f*f)}function Df(a,b,c){return(b-a)*c+a}function rf(a,b,c,d,e,f=[]){let g=dj(b,c,d,e),j=Math.min(a.grid.width,a.grid.height),i=Math.ceil(g/(j/4)),l;for(let n=0;n<=i;n++){let u=n/i,A=Df(b,d,u),B=Df(c,e,u),D=Ia(a,A,B);if(!Ta(a,D.x,D.y))continue;if(l&&l.x===D.x&&l.y===D.y)continue;f.push(D),l=D}return f}var Jb;(function(a){a[a.x=1]="x",a[a.horizontal=1]="horizontal",a[a.h=1]="h",a[a.y=2]="y",a[a.vertical=2]="vertical",a[a.v=2]="v",a[a.xy=3]="xy"})(Jb||(Jb={}));function sf(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=gn),d!==null?bb(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.mirror(e,c,e),d!==null&&bb(a,e,d.x,d.y,e),e}let gn={x:0,y:0};function tf(a,b=!1,c=!1){let d=ab(a);for(let e=0,f=d.length;e<f;e++)Na(a,d[e],void 0,void 0,void 0,b,c)}function uf(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=jn),d!==null?bb(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.rotate(e,c,e),d!==null&&bb(a,e,d.x,d.y,e),e}let jn={x:0,y:0};function vf(a,b,c){let d=ba(a,b);if(d===null)return;ob(a,b,d.x,d.y,c)}function Ac(a,b,c){return Math.max(b,Math.min(c,a))}function wf(a,b,c,d=[]){let e=Ia(a,b.left,b.top,!0),f=e.x-1,g=e.y-1,j=Ia(a,b.right,b.bottom,!0),i=j.x+1,l=j.y+1;a.infinityMode||(f=Ac(f,0,a.width-1),g=Ac(g,0,a.height-1),i=Ac(i,0,a.width-1),l=Ac(l,0,a.height-1));for(let n=f;n<=i;n++)for(let u=g;u<=l;u++){let A=Ea(a,n,u,!0);c(b,A.x,A.y)&&d.push({x:n,y:u})}return d}function xf(a,b,c,d=!0){let e=ba(a,b),f=ba(a,c);if(e==null||f==null)return;Na(a,b),Na(a,c),ob(a,b,f.x,f.y,f.z,d),ob(a,c,e.x,e.y,e.z,d)}function Ad(a,b,c=[]){let d=a.boardData.ZToChessSet.get(b);if(d)for(const e of d)c.push(e);return c}function Bd(a,b,c=[]){for(let d=0,e=b.length;d<e;d++){let f=b[d];c.push(Ea(a,f.x,f.y))}return c}function Cd(a,b,c,d={x:0,y:0}){return d===!0&&(d=mn),Ia(a,b,c,d),Ea(a,d.x,d.y,d),d}let mn={x:0,y:0};function Dd(a,b,c,d,e){let f=Ia(a,b,c,!0);return d!==void 0?qa(a,f.x,f.y,d):Oa(a,f.x,f.y,e)}class od extends nd{addChess(a,b,c,d,e=!0){return ob(this,a,b,c,d,e),this}angleBetween(a,b){return pb(this,a,b)}angleSnapToDirection(a,b){return Yb(this,a,b)}angleToward(a,b){return Zb(this,a,b)}areNeighbors(a,b){return pd(this,a,b)}chessToTileXYZ(a){return ba(this,a)}contains(a,b,c){return Ta(this,a,b,c)}directionBetween(a,b,c=!0){return qd(this,a,b,c)}filledRingToTileXYArray(a,b,c=!0,d=[]){return lf(this,a,b,c,d)}fit(a){return mf(this,a)}forEachTileXY(a,b,c=0){return rd(this,a,b,c),this}getAllChess(a=[]){return ab(this,a)}getChessData(a){return Ua(a)}getDistance(a,b,c=!1){return sd(this,a,b,c)}getEmptyTileXYArray(a=0,b=[]){return xc(this,a,b)}getGridPoints(a,b,c){return td(this,a,b,c)}getNeighborChess(a,b,c,d){return ud(this,a,b,c,d)}getNeighborChessDirection(a,b){return _b(this,a,b)}getNeighborTileDirection(a,b){return $b(this,a,b)}getNeighborTileXY(a,b=null,c={x:0,y:0}){return fb(this,a,b,c)}getNeighborTileXYAtAngle(a,b,c={x:0,y:0}){return vd(this,a,b,c)}getOppositeDirection(a,b,c){return wd(this,a,b,c)}getRandomEmptyTileXY(a=0,b={x:0,y:0}){return nf(this,a,b)}getTileXYAtDirection(a,b,c,d){return Ma(this,a,b,c,d)}getWrapTileXY(a,b,c={x:0,y:0}){return ac(this,a,b,c)}gridAlign(a,b,c){return bc(this,a,b,c),this}hasBlocker(a,b,c){return of(this,a,b,c)}hasChess(a){return pf(this,a)}hasEdgeBlocker(a,b,c,d){return qf(this,a,b,c,d)}isAngleInCone(a,b,c,d){return xd(this,a,b,c,d)}isDirectionInCone(a,b,c,d){return yd(this,a,b,c,d)}isOverlappingPoint(a,b,c){return zd(this,a,b,c)}lineToTileXYArray(a,b,c,d,e=[]){return rf(this,a,b,c,d,e)}mirror(a,b,c=null,d={x:0,y:0}){return sf(this,a,b,c,d)}offset(a,b,c,d){return bb(this,a,b,c,d)}removeAllChess(a=!1,b=!1){return tf(this,a,b),this}removeChess(a,b,c,d,e=!1,f=!1){return Na(this,a,b,c,d,e,f),this}ringToTileXYArray(a,b=1,c=[]){return yc(this,a,b,c)}rotate(a,b,c=null,d={x:0,y:0}){return uf(this,a,b,c,d)}setBoardWidth(a=0){return Db(this,a),this}setBoardHeight(a=0){return Eb(this,a),this}setTileZ(a,b){return vf(this,a,b),this}shapeToTileXYArray(a,b,c=[]){return wf(this,a,b,c)}swapChess(a,b,c=!0){return xf(this,a,b,c),this}tileXYArrayToChessArray(a,b,c=[]){return cc(this,a,b,c)}tileXYToChessArray(a,b,c=[]){return Oa(this,a,b,c)}tileXYZToChess(a,b,c){return qa(this,a,b,c)}tileZToChessArray(a,b=[]){return Ad(this,a,b)}tileXYArrayToWorldXYArray(a,b=[]){return Bd(this,a,b)}tileXYToWorldXY(a,b,c={x:0,y:0}){return Ea(this,a,b,c)}worldXYSnapToGrid(a,b,c={x:0,y:0}){return Cd(this,a,b,c)}worldXYToChess(a,b,c,d){return Dd(this,a,b,c,d)}worldXYToTileXY(a,b,c){return Ia(this,a,b,c)}}class Si extends od{}const Va={};zb(Va,{ChessToTileXYZ:()=>ba,Contains:()=>Ta,DirectionBetween:()=>qd,ForEachTileXY:()=>rd,GetDistance:()=>sd,GetOppositeDirection:()=>wd,GetTileXYAtDirection:()=>Ma,GetWrapTileXY:()=>ac,IsDirectionInCone:()=>yd,TileXYArrayToChessArray:()=>cc,TileXYToChessArray:()=>Oa,TileXYZToChess:()=>qa,TileZToChessArray:()=>Ad});const qb={};zb(qb,{AngleBetween:()=>pb,AngleSnapToDirection:()=>Yb,AngleToward:()=>Zb,GetGridPoints:()=>td,GridAlign:()=>bc,IsAngleInCone:()=>xd,IsOverlappingPoint:()=>zd,TileXYArrayToWorldXYArray:()=>Bd,TileXYToWorldXY:()=>Ea,WorldXYSnapToGrid:()=>Cd,WorldXYToChess:()=>Dd,WorldXYToTileXY:()=>Ia});const Hb={};zb(Hb,{AreNeighbors:()=>pd,GetNeighborChess:()=>ud,GetNeighborChessDirection:()=>_b,GetNeighborTileDirection:()=>$b,GetNeighborTileXY:()=>fb,GetNeighborTileXYAtAngle:()=>vd});var oa;(function(a){a[a.orthogonal=0]="orthogonal",a[a.isometric=1]="isometric"})(oa||(oa={}));var kb;(function(a){a[a["4dir"]=4]="4dir",a[a["8dir"]=8]="8dir"})(kb||(kb={}));class Nj{constructor({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=oa.orthogonal,dir:f=kb["4dir"]}={}){this.setOriginPosition(a,b),this.setCellSize(c,d),this.setType(e),this.setDirectionMode(f)}fromJSON({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=oa.orthogonal,dir:f=kb["4dir"]}={}){return this.setType(e),this.setDirectionMode(f),this.setOriginPosition(a,b),this.setCellSize(c,d),this}toJSON(){return{x:this.x,y:this.y,cellWidth:this.cellWidth,cellHeight:this.cellHeight,type:this.mode,dir:this.directions}}setOriginPosition(a=0,b=0){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setType(a=oa.orthogonal){return typeof a==="string"&&(a=oa[a]),this.mode=a,this}setDirectionMode(a=kb["4dir"]){return typeof a==="string"&&(a=kb[a]),this.directions=a,this}}function Fj(a,b,c,d=!0){let e;switch(a.mode){case oa.orthogonal:case oa.isometric:if(b.y===c.y)e=c.x>=b.x?0:2;else if(b.x===c.x)e=c.y>=b.y?1:3;else if(a.directions===kb["4dir"]){let f=ec(Kb(b.x,b.y,c.x,c.y));f<0&&(f+=360),e=f/90,d&&(e=Math.round(e))}else{let f=c.x-b.x,g=c.y-b.y;if(f===g)e=f>0?4:6;else if(f===-g)e=f>0?7:5;else{let j=ec(Math.atan2(g,f));j<0&&(j+=360);let i=j/45;d&&(i=Math.round(i)),i>=0&&i<1?e=i:i>=1&&i<2?e=i+3:i>=2&&i<3?e=i-1:i>=3&&i<4?e=i+2:i>=4&&i<5?e=i-2:i>=5&&i<6?e=i+1:i>=6&&i<7?e=i-3:e=i}}break}return e===a.directions&&(e=0),e}function Pd(a,b){return jb(b,0,a.directions)}function Gj(a,b,c,d=!1){let e=c.x-b.x,f=c.y-b.y,g;return d?g=Math.abs(e)+Math.abs(f):g=Math.sqrt(e*e+f*f),g}function Ld(a,b=[]){if(!(b.length===a))if(b.length<a)for(let c=b.length;c<a;c++)b.push({x:0,y:0});else b.length=a;return b}function Sd(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Hn);let e,f;switch(a.mode){case oa.orthogonal:e=b*a.width,f=c*a.height;break;case oa.isometric:e=(b-c)*a._halfWidth,f=(b+c)*a._halfHeight;break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let Hn={x:0,y:0};function Hj(a,b=0,c=0,d=[]){if(typeof b==="object"){let i=b;c=i.y,b=i.x}d===!0&&(d=Dn),Ld(4,d);let e,f;({x:e,y:f}=Sd(a,b,c));let g=a._halfWidth,j=a._halfHeight;switch(a.mode){case oa.orthogonal:d[0].x=e+g,d[0].y=f-j,d[1].x=e+g,d[1].y=f+j,d[2].x=e-g,d[2].y=f+j,d[3].x=e-g,d[3].y=f-j;break;case oa.isometric:d[0].x=e+g,d[0].y=f,d[1].x=e,d[1].y=f+j,d[2].x=e-g,d[2].y=f,d[3].x=e,d[3].y=f-j;break}return d}let Dn=[];const fc=[[1,0],[0,1],[-1,0],[0,-1],[1,1],[-1,1],[-1,-1],[1,-1]],Cc=fc;function Cj(a){let b={},c,d,e;for(let f in a)c=a[f],d=c[0],e=c[1],b.hasOwnProperty(d)||(b[d]={}),b[d][e]=parseInt(f);return b}const Dj=Cj(fc),Ej=Cj(Cc);function Ij(a,b,c){let d;switch(a.mode){case oa.orthogonal:d=Dj;break;case oa.isometric:d=Ej;break}let e=c.x-b.x,f=c.y-b.y;if(d.hasOwnProperty(e)){let g=d[e];if(g.hasOwnProperty(f))return g[f]}return null}function Td(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Gn);let f,g;switch(a.mode){case oa.orthogonal:f=fc[c][0],g=fc[c][1];break;case oa.isometric:f=Cc[c][0],g=Cc[c][1];break}return d===1?(e.x=b.x+f,e.y=b.y+g):(e.x=b.x+d*f,e.y=b.y+d*g),e}let Gn={x:0,y:0};function Jj(a,b,c,d={x:0,y:0}){return Td(a,b,c,1,d)}function Kj(a,b,c,d){return En[d]}const En={0:2,1:3,2:0,3:1,4:6,5:7,6:4,7:5};function Lj(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Fn),b-=a.x,c-=a.y;let e=b/a.width,f=c/a.height;switch(a.mode){case oa.orthogonal:d.x=Math.round(e),d.y=Math.round(f);break;case oa.isometric:d.x=Math.round(+e+f),d.y=Math.round(-e+f);break}return d}let Fn={x:0,y:0};function Mj(a,b,c,d={x:0,y:0}){return typeof c==="string"&&(c=Jb[c]),d===!0&&(d=In),d.x=c&1?-b.x:b.x,d.y=c&2?-b.y:b.y,d}let In={x:0,y:0};function Lb(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Jn);let f=b.x+c,g=b.y+d;return e.x=f,e.y=g,e}let Jn={x:0,y:0};function Oj(a,b,c,d=[]){let e,f;for(e=c,f=-c;f<=c;f++)d.push(Lb(a,b,e,f));for(f=c,e=c-1;e>=-c;e--)d.push(Lb(a,b,e,f));for(e=-c,f=c-1;f>=-c;f--)d.push(Lb(a,b,e,f));for(f=-c,e=-c+1;e<=c-1;e++)d.push(Lb(a,b,e,f));return d}function Pj(a,b,c,d={x:0,y:0}){d===!0&&(d=On),c=jb(c,0,3);let e,f;switch(c){case 1:e=-b.y,f=b.x;break;case 2:e=-b.x,f=-b.y;break;case 3:e=b.y,f=-b.x;break;default:e=b.x,f=b.y;break}return d.x=e,d.y=f,d}let On={x:0,y:0};function Qd(a){a._savedOriginX=a.x,a._savedOriginY=a.y}function Rd(a){a.x=a._savedOriginX,a.y=a._savedOriginY}class Bj extends Nj{get sides(){return 4}get allDirections(){return this.directions===4?Kn:Ln}get halfDirections(){return this.directions===4?Mn:Nn}directionBetween(a,b,c=!0){return Fj(this,a,b,c)}directionNormalize(a){return Pd(this,a)}getDistance(a,b,c=!1){return Gj(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return Hj(this,a,b,c)}getNeighborTileDirection(a,b){return Ij(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return Jj(this,a,b,c)}getOppositeDirection(a,b,c){return Kj(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return Lj(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return Td(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return Sd(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return Mj(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return Lb(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return Oj(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return Pj(this,a,b,c)}restoreOrigin(){return Rd(this),this}saveOrigin(){return Qd(this),this}}const Kn=[0,1,2,3],Ln=[0,1,2,3,4,5,6,7],Mn=[0,1],Nn=[0,1,4,5];var ca;(function(a){a[a.ODD_R=0]="ODD_R",a[a.EVEN_R=1]="EVEN_R",a[a.ODD_Q=2]="ODD_Q",a[a.EVEN_Q=3]="EVEN_Q"})(ca||(ca={}));var cb;(function(a){a[a.y=0]="y",a[a.flat=0]="flat",a[a.x=1]="x",a[a.pointy=1]="pointy"})(cb||(cb={}));var tb;(function(a){a[a.even=0]="even",a[a.odd=1]="odd"})(tb||(tb={}));class uj{constructor({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=cb.x,staggerIndex:g=tb.odd}={}){this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e)}fromJSON({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=cb.x,staggerIndex:g=tb.odd}={}){return this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e),this}toJSON(){return{x:this.x,y:this.y,radius:this.radius,cellWidth:this.cellWidth,cellHeight:this.cellHeight,staggerAxis:this.staggerAxis,staggerIndex:this.staggerIndex}}setOriginPosition(a,b){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this.radius=void 0,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setRadius(a=0){let b,c;return this.staggerAxis===cb.y?(b=2*a,c=Aj*a):(b=Aj*a,c=2*a),this.setCellSize(b,c),this.radius=a,this}setDirectionMode(){return this.directions=6,this}setType(a=1,b=1){return typeof a==="string"&&(a=cb[a]),typeof b==="string"&&(b=tb[b]),this.staggerAxis=a,this.staggerIndex=b,a===cb.y?this.mode=b===tb.even?ca.EVEN_Q:ca.ODD_Q:this.mode=b===tb.even?ca.EVEN_R:ca.ODD_R,this}}const Aj=Math.sqrt(3);function Pa(a,b,c,d={x:0,y:0,z:0}){d===!0&&(d=Ff);switch(a){case ca.ODD_R:d.x=b-(c-(c&1))/2,d.z=c;break;case ca.EVEN_R:d.x=b-(c+(c&1))/2,d.z=c;break;case ca.ODD_Q:d.x=b,d.z=c-(b-(b&1))/2;break;case ca.EVEN_Q:d.x=b,d.z=c-(b+(b&1))/2;break}return d.y=-d.x-d.z,d}function ij(a,b,c,d={x:0,y:0,z:0}){typeof a!=="number"&&(d=a,a=d.x,b=d.y,c=d.z),d===!0&&(d=Ff);let e=Math.round(a),f=Math.round(b),g=Math.round(c),j=Math.abs(e-a),i=Math.abs(f-b),l=Math.abs(g-c);return j>i&&j>l?e=-f-g:i>l?f=-e-g:g=-e-f,d.x=e,d.y=f,d.z=g,d}function Ba(a,b,c,d,e={x:0,y:0}){e===!0&&(e=on);switch(a){case ca.ODD_R:e.x=b+(d-(d&1))/2,e.y=d;break;case ca.EVEN_R:e.x=b+(d+(d&1))/2,e.y=d;break;case ca.ODD_Q:e.x=b,e.y=d+(b-(b&1))/2;break;case ca.EVEN_Q:e.x=b,e.y=d+(b+(b&1))/2;break}return e}function jj(a,b,c={x:0,y:0,z:0}){return c===!0&&(c=Ff),c.x=a,c.y=-a-b,c.z=b,c}let Ff={x:0,y:0,z:0},on={x:0,y:0};function lj(a,b,c,d=!0){let e;Pa(a.mode,b.x,b.y,Hd),Pa(a.mode,c.x,c.y,Id);let f=Id.x-Hd.x,g=Id.y-Hd.y,j=Id.z-Hd.z;return j===0?e=f>0?0:3:f===0?e=j>0?1:4:g===0?e=j>0?2:5:f>0&&g<0&&j>0?e=0+j/-g:f<0&&g<0&&j>0?e=1+-g/j:f<0&&g>0&&j>0?e=2+g/-f:f<0&&g>0&&j<0?e=3+-j/g:f>0&&g>0&&j<0?e=4+f/-j:e=5+-g/f,d&&(e=Math.round(e)),e}let Hd={x:0,y:0,z:0},Id={x:0,y:0,z:0};function mj(a,b,c,d=!1){Pa(a.mode,b.x,b.y,Jd),Pa(a.mode,c.x,c.y,Kd);let e=Kd.x-Jd.x,f=Kd.y-Jd.y,g=Kd.z-Jd.z;return(Math.abs(e)+Math.abs(f)+Math.abs(g))/2}let Jd={x:0,y:0,z:0},Kd={x:0,y:0,z:0};function Md(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=xn);let e=b*a.width,f=c*a.height;switch(a.mode){case ca.ODD_R:c&1&&(e+=a._halfWidth),f*=.75;break;case ca.EVEN_R:c&1&&(e-=a._halfWidth),f*=.75;break;case ca.ODD_Q:e*=.75,b&1&&(f+=a._halfHeight);break;case ca.EVEN_Q:e*=.75,b&1&&(f-=a._halfHeight);break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let xn={x:0,y:0};const op=Math.PI/180;function rb(a){return a*op}function nj(a,b=0,c=0,d=[]){if(typeof b==="object"){let g=b;c=g.y,b=g.x}d===!0&&(d=tn),Ld(6,d);let e,f;({x:e,y:f}=Md(a,b,c));if(a.radius!==void 0){let g=a.radius,j=a.staggerAxis===cb.flat?0:-30;for(let i=0;i<6;i++){let l=60*i+j,n=rb(l);d[i].x=e+g*Math.cos(n),d[i].y=f+g*Math.sin(n)}}else{let g=a._halfWidth,j=g/2,i=a._halfHeight,l=i/2;a.staggerAxis===cb.flat?(d[0].x=e+g,d[0].y=f,d[1].x=e+j,d[1].y=f+i,d[2].x=e-j,d[2].y=f+i,d[3].x=e-g,d[3].y=f,d[4].x=e-j,d[4].y=f-i,d[5].x=e+j,d[5].y=f-i):(d[0].x=e+g,d[0].y=f-l,d[1].x=e+g,d[1].y=f+l,d[2].x=e,d[2].y=f+i,d[3].x=e-g,d[3].y=f+l,d[4].x=e-g,d[4].y=f-l,d[5].x=e,d[5].y=f-i)}return d}let tn=[];const pn=[[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]]],qn=[[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]],[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]]],rn=[[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]],[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]]],sn=[[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]],[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]]],Wa=[pn,qn,rn,sn];function sb(a){let b={},c,d;for(let e in a)[c,d]=a[e],b.hasOwnProperty(c)||(b[c]={}),b[c][d]=parseInt(e);return b}const kj=[[sb(Wa[0][0]),sb(Wa[0][1])],[sb(Wa[1][0]),sb(Wa[1][1])],[sb(Wa[2][0]),sb(Wa[2][1])],[sb(Wa[3][0]),sb(Wa[3][1])]];function Nd(a,b,c){let d;switch(a){case ca.ODD_R:case ca.EVEN_R:d=c&1;break;case ca.ODD_Q:case ca.EVEN_Q:d=b&1;break}return d}function oj(a,b,c){let d=a.mode,e=Nd(d,b.x,b.y),f=kj[d][e],g=c.x-b.x,j=c.y-b.y;if(f.hasOwnProperty(g)){let i=f[g];if(i.hasOwnProperty(j))return i[j]}return null}function Od(a,b,c,d,e={x:0,y:0}){e===!0&&(e=wn);let f=a.mode,g=b.x,j=b.y;if(d===1){let i=Nd(f,g,j);e.x=g+Wa[f][i][c][0],e.y=j+Wa[f][i][c][1]}else if(d===0)e.x=g,e.y=j;else{let i=Pa(f,g,j,!0),l,n,u;switch(c){case 1:l=i.x,n=i.y-d,u=i.z+d;break;case 2:l=i.x-d,n=i.y,u=i.z+d;break;case 3:l=i.x-d,n=i.y+d,u=i.z;break;case 4:l=i.x,n=i.y+d,u=i.z-d;break;case 5:l=i.x+d,n=i.y,u=i.z-d;break;default:l=i.x+d,n=i.y-d,u=i.z;break}Ba(f,l,n,u,e)}return e}let wn={x:0,y:0};function pj(a,b,c,d={x:0,y:0}){return Od(a,b,c,1,d)}function qj(a,b,c,d){return(d+3)%6}const rj=4/3,sj=2/3;function tj(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=vn),b-=a.x,c-=a.y;let e,f;switch(a.mode){case ca.ODD_R:case ca.EVEN_R:f=c*rj/a.height,e=b/a.width-sj*(c/a.height);break;case ca.ODD_Q:case ca.EVEN_Q:f=c/a.height-sj*(b/a.width),e=b*rj/a.width;break}let g=jj(e,f,un);return ij(g),Ba(a.mode,g.x,g.y,g.z,d),d}let un={x:0,y:0,z:0},vn={x:0,y:0};function vj(a,b,c,d={x:0,y:0}){typeof c==="string"&&(c=Jb[c]),d===!0&&(d=An);let e=Pa(a.mode,b.x,b.y,!0),f=a.mode===ca.ODD_R||a.mode===ca.EVEN_R,g,j,i;return c&1&&(f?(g=e.y,j=e.x,i=e.z):(g=-e.x,j=-e.z,i=-e.y),e.x=g,e.y=j,e.z=i),c&2&&(f?(g=-e.y,j=-e.x,i=-e.z):(g=e.x,j=e.z,i=e.y)),Ba(a.mode,g,j,i,d),d}let An={x:0,y:0};function wj(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Bn);let f=b.x+c,g=b.y+d;switch(a.mode){case ca.ODD_R:(d&1)!==0&&((g&1)===0&&(f+=1));break;case ca.EVEN_R:(d&1)!==0&&((g&1)===0&&(f-=1));break;case ca.ODD_Q:(c&1)!==0&&((f&1)==0&&(g+=1));break;case ca.EVEN_Q:(c&1)!==0&&((f&1)==0&&(g-=1));break}return e.x=f,e.y=g,e}let Bn={x:0,y:0};function xj(a,b,c,d=[]){let e=Pa(a.mode,b.x,b.y,!0),f=e.x,g=e.y,j=e.z,i,l,n;for(n=c,i=0;i>=-c;i--)l=-i-n,d.push(Ba(a.mode,f+i,g+l,j+n));for(i=-c,l=1;l<=c;l++)n=-i-l,d.push(Ba(a.mode,f+i,g+l,j+n));for(l=c,n=-1;n>=-c;n--)i=-l-n,d.push(Ba(a.mode,f+i,g+l,j+n));for(n=-c,i=1;i<=c;i++)l=-i-n,d.push(Ba(a.mode,f+i,g+l,j+n));for(i=c,l=-1;l>=-c;l--)n=-i-l,d.push(Ba(a.mode,f+i,g+l,j+n));for(l=-c,n=1;n<=c-1;n++)i=-l-n,d.push(Ba(a.mode,f+i,g+l,j+n));return d}function yj(a,b,c,d={x:0,y:0}){d===!0&&(d=Cn),c=jb(c,0,5);let e=Pa(a.mode,b.x,b.y,!0),f,g,j;switch(c){case 1:f=-e.z,g=-e.x,j=-e.y;break;case 2:f=e.y,g=e.z,j=e.x;break;case 3:f=-e.x,g=-e.y,j=-e.z;break;case 4:f=e.z,g=e.x,j=e.y;break;case 5:f=-e.y,g=-e.z,j=-e.x;break;default:f=e.x,g=e.y,j=e.z;break}return Ba(a.mode,f,g,j,d),d}let Cn={x:0,y:0};class zj extends uj{get sides(){return 6}get allDirections(){return yn}get halfDirections(){return zn}directionBetween(a,b,c=!0){return lj(this,a,b,c)}directionNormalize(a){return Pd(this,a)}getDistance(a,b,c=!1){return mj(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return nj(this,a,b,c)}getNeighborTileDirection(a,b){return oj(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return pj(this,a,b,c)}getOppositeDirection(a,b,c){return qj(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return tj(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return Od(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return Md(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return vj(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return wj(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return xj(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return yj(this,a,b,c)}restoreOrigin(){return Rd(this),this}saveOrigin(){return Qd(this),this}}const yn=[0,1,2,3,4,5],zn=[0,1,2];var za;(function(a){a[a.random=0]="random",a[a.diagonal=1]="diagonal",a[a.straight=2]="straight",a[a.line=3]="line",a[a.astar=10]="astar",a[a["astar-random"]=11]="astar-random",a[a["astar-line"]=12]="astar-line"})(za||(za={}));const Mb=null;class tm{constructor(a){this.content=[],this.scoreFunction=a}clear(){this.content.length=0}push(a){this.content.push(a),this.sinkDown(this.content.length-1)}pop(){let a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.bubbleUp(0)),a}remove(a){let b=this.content.indexOf(a),c=this.content.pop();b!==this.content.length-1&&(this.content[b]=c,this.scoreFunction(c)<this.scoreFunction(a)?this.sinkDown(b):this.bubbleUp(b))}get size(){return this.content.length}rescoreElement(a){this.sinkDown(this.content.indexOf(a))}sinkDown(a){let b=this.content[a];for(;a>0;){let c=(a+1>>1)-1,d=this.content[c];if(this.scoreFunction(b)<this.scoreFunction(d))this.content[c]=b,this.content[a]=d,a=c;else break}}bubbleUp(a){let b=this.content.length,c=this.content[a],d=this.scoreFunction(c);for(;;){let e=a+1<<1,f=e-1,g=null,j;if(f<b){let i=this.content[f];j=this.scoreFunction(i),j<d&&(g=f)}if(e<b){let i=this.content[e],l=this.scoreFunction(i);l<(g===null?d:j)&&(g=e)}if(g!==null)this.content[a]=this.content[g],this.content[g]=c,a=g;else break}}}let baa=new tm(a=>a.f);const Be=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d=d.prevNodes[0];return c.reverse()};const wm=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d.prevNodes.length===1?d=d.prevNodes[0]:d=dc(d.prevNodes);return c.reverse()};const vm=function(a,b,c=[]){let d=b,e=b.angleTo(a);for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1)d=d.prevNodes[0];else{let f=Infinity;for(let g=1,j=d.prevNodes.length;g<j;g++){let i=d.prevNodes[g],l=Math.abs(b.angleTo(i)-e);l<f&&(f=l,d=i)}}}return c.reverse()};const um=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let j=0,i=d.prevNodes.length;j<i;j++){f=d.prevNodes[j],g=f.logicDirTo(d);if(g!==e)break}e=g,d=f}}return c.reverse()};const xm=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let j=0,i=d.prevNodes.length;j<i;j++){f=d.prevNodes[j],g=f.logicDirTo(d);if(g===e)break}e=g,d=f}}return c.reverse()};let Rb={};Rb[za.astar]=Be;Rb[za["astar-line"]]=Be;Rb[za["astar-random"]]=Be;Rb[za.random]=wm;Rb[za.line]=vm;Rb[za.diagonal]=um;Rb[za.straight]=xm;class Sj{constructor(){this.prevNodes=[]}shutdown(){this.key=void 0,this.prevNodes.length=0}destroy(){this.shutdown()}reset(a){this.key=a,this.f=0,this.g=0,this.h=void 0,this.closerH=void 0,this.visited=!1,this.closed=!1}heuristic(a,b,c){if(b===null)return 0;let d,e=this.distanceTo(a)*this.manager.weight;switch(b){case za.astar:d=e;break;case za["astar-line"]:if(c!==void 0){let f=a.angleTo(c)-this.angleTo(c);d=e+Math.abs(f)}else d=e;case za["astar-random"]:d=e+Math.random();break;default:d=e;break}return d}getNextNodes(){return[]}getCost(a){return Mb}distanceTo(a){return 0}angleTo(a){return 0}logicDirTo(a){return 0}getNode(a,b=!1){return this.manager.getNode(a,b)}}function Ud(a){for(let b=a.length-1;b>0;b--){let c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a}class Yn extends Sj{constructor(a){super();this.isTileXYZ=!0;this.pathFinder=a}reset(a){super.reset(a),this.key=a,Tj(a,this),this._px=void 0,this._py=void 0,this.cost=void 0}getNextNodes(){let a=Hb.GetNeighborTileXY(this.board,this);this.pathFinder.shuffleNeighbors&&Ud(a);let b=[];return a.forEach(c=>{let d=this.getNode(Ra(c.x,c.y),!0);b.push(d)}),b}getCost(a){return this.pathFinder.cacheCost?this.cost===void 0&&(this.cost=this.pathFinder.getCost(this,a)):this.cost=this.pathFinder.getCost(this,a),this.cost}distanceTo(a){return Va.GetDistance(this.board,this,a,!0)}angleTo(a){return Kb(this.worldX,this.wroldY,a.worldX,a.worldX)}logicDirTo(a){return Hb.GetNeighborTileDirection(this.board,this,a)}get board(){return this.pathFinder.board}get worldX(){if(this._px===void 0){let a=qb.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._px}get wroldY(){if(this._py===void 0){let a=qb.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._py}}class Tn{constructor(){this.data=[];this.visited=new Set()}push(a,b){if(Array.isArray(a)){let d=a;for(let e=0,f=d.length;e<f;e++)this.push(d[e]);return this}if(typeof a==="object"){let d=a;a=d.x,b=d.y}let c=`${a},${b}`;return this.visited.has(c)?this:(this.data.push({x:a,y:b}),this.visited.add(c),this)}pop(){return this.data.pop()}get length(){return this.data.length}clear(){return this.data.length=0,this.visited.clear(),this}}let bU=new Tn();var Gd;(function(a){a[a.direction=0]="direction",a[a.angle=1]="angle"})(Gd||(Gd={}));function Xb(a=32,b=32){const c=tc(a,b);return new $a(c.canvas)}function ji(a,b){const c=a.texture,d=b.shaders.current,e=d.buffer,f=c.binding;d.count===e.batchSize&&b.flush();const g=a.vertexData;b.textures.request(c);const j=f.index;g[4]=j,g[10]=j,g[16]=j,g[22]=j;const i=d.count*e.quadElementSize;e.vertexViewF32.set(g,i);const l=a.vertexColor,n=e.vertexViewU32;n[i+5]=l[0],n[i+11]=l[2],n[i+17]=l[3],n[i+23]=l[1],d.count++}class fi extends ad{constructor(a=0,b=0){super(a,b);this._alpha=1,this.type="Container"}setSize(a,b=a){return this.transform.updateExtent(a,b),this}setPosition(a,b){return this.transform.position.set(a,b),this}setOrigin(a,b=a){return this.transform.origin.set(a,b),this}setSkew(a,b=a){return this.transform.skew.set(a,b),this}setScale(a,b=a){return this.transform.scale.set(a,b),this}setRotation(a){return this.transform.rotation=a,this}set width(a){this.transform.updateExtent(a)}get width(){return this.transform.extent.width}set height(a){this.transform.updateExtent(void 0,a)}get height(){return this.transform.extent.height}set x(a){this.transform.position.x=a}get x(){return this.transform.position.x}set y(a){this.transform.position.y=a}get y(){return this.transform.position.y}set originX(a){this.transform.origin.x=a}get originX(){return this.transform.origin.x}set originY(a){this.transform.origin.y=a}get originY(){return this.transform.origin.y}set skewX(a){this.transform.skew.x=a}get skewX(){return this.transform.skew.x}set skewY(a){this.transform.skew.y=a}get skewY(){return this.transform.skew.y}set scaleX(a){this.transform.scale.x=a}get scaleX(){return this.transform.scale.x}set scaleY(a){this.transform.scale.y=a}get scaleY(){return this.transform.scale.y}set rotation(a){this.transform.rotation=a}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(a){a!==this._alpha&&(this._alpha=a,this.setDirty(aa.TRANSFORM))}}function ki(a,b){const c=a.frame;if(!c)return;const d=b.ctx,e=a.transform,{a:f,b:g,c:j,d:i,tx:l,ty:n}=e.world,{x:u,y:A}=e.extent;d.save(),d.setTransform(f,g,j,i,l,n),d.globalAlpha=a.alpha,d.drawImage(c.texture.image,c.x,c.y,c.width,c.height,u,A,c.width,c.height),d.restore()}function sc(a,b){const c=(b*255|0)&255;return(c<<24|a)>>>0}function li(a){const b=a.vertexAlpha,c=a.vertexTint,d=a.vertexColor;return d[0]=sc(c[0],b[0]),d[1]=sc(c[1],b[1]),d[2]=sc(c[2],b[2]),d[3]=sc(c[3],b[3]),a}function cd(a,b,...c){const d=a.getFrame(b),{u0:e,u1:f,v0:g,v1:j,pivot:i}=d;return c.forEach(l=>{if(!l||d===l.frame)return;l.frame=d,i&&l.setOrigin(i.x,i.y),l.frame.setExtent(l),l.hasTexture=!0;const n=l.vertexData;n[2]=e,n[3]=g,n[8]=e,n[9]=j,n[14]=f,n[15]=j,n[20]=f,n[21]=g}),c}function ii(a,b,...c){if(!a)c.forEach(d=>{d.texture=null,d.frame=null,d.hasTexture=!1});else{let d;a instanceof $a?d=a:d=Ka.get().get(a),d?(c.forEach(e=>{e.texture=d}),cd(d,b,...c)):console.warn(`Invalid Texture key: ${a}`)}return c}function mi(a){const b=a.vertexData,{x0:c,y0:d,x1:e,y1:f,x2:g,y2:j,x3:i,y3:l}=bd(a.transform);return b[0]=c,b[1]=d,b[6]=e,b[7]=f,b[12]=g,b[13]=j,b[18]=i,b[19]=l,a}class dd extends fi{constructor(a,b,c,d){super(a,b);this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertexData=new Float32Array(24).fill(0),this.vertexColor=new Uint32Array(4).fill(4294967295),this.vertexAlpha=new Float32Array(4).fill(1),this.vertexTint=new Uint32Array(4).fill(16777215),this.setTexture(c,d)}setTexture(a,b){return ii(a,b,this),this}setFrame(a){return cd(this.texture,a,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}preRender(){this.isDirty(aa.COLORS)&&(li(this),this.clearDirty(aa.COLORS)),this.isDirty(aa.TRANSFORM)&&(mi(this),this.clearDirty(aa.TRANSFORM))}renderGL(a){this.preRender(),ji(this,a)}renderCanvas(a){this.preRender(),ki(this,a)}get alpha(){return this._alpha}set alpha(a){if(a!==this._alpha){this._alpha=a;const b=this.vertexAlpha;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(aa.ALPHA)}}get tint(){return this._tint}set tint(a){if(a!==this._tint){this._tint=a;const b=this.vertexTint;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(aa.COLORS)}}destroy(a){super.destroy(a),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertexData=null,this.vertexColor=null,this.vertexAlpha=null,this.vertexTint=null}}function oe(a,b,c){let d=Math.ceil(b*a.resolution),e=Math.ceil(c*a.resolution),f=a.canvas;if(f.width===d||f.height===e){pe(a);return}f.width=d,f.height=e,a.texture.setSize(b,c),a.setSize(b,c),a.updateTexture()}function pe(a){a.context.clearRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function Gg(a,b="#fff"){let c=a.context;c.fillStyle=b,c.fillRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function qe(a,b,c){let d=new Image();d.onload=function(){let e=a.resolution,f=d.width/e,g=d.height/e;oe(a,f,g),a.context.drawImage(d,0,0),a.updateTexture(),c&&c(),d.onload=null,d.src="",d.remove()},d.src=b}function Hg(a,b){return new Promise(function(c,d){qe(a,b,c)})}function Ig(a,b,c){return a.canvas.toDataURL(b,c)}function Jg(a,b,c,d=[0,0,0,0]){let e=a.context.getImageData(b,c,1,1).data;return d[0]=e[0],d[1]=e[1],d[2]=e[2],d[3]=e[3],d}function Kg(a,b,c,d,e,f,g){g===void 0&&(g=d!==0||e!==0||f!==0?255:0);let j=a.context.createImageData(1,1);j.data[0]=d,j.data[1]=e,j.data[2]=f,j.data[3]=g,a.context.putImageData(j,b,c),a.updateTexture()}class Fg extends dd{constructor(a=0,b=0,c=32,d=32){super(a,b,Xb());this.type="rexCanvas";const e=wa.get();this.resolution=e.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.resize(c,d)}updateTexture(){return this.texture.binding&&this.texture.binding.update(),this.setDirty(aa.TEXTURE),this}destroy(a){this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}resize(a,b){return oe(this,a,b),this}clear(){return pe(this),this}}function yb(a,b,c,d=1){let e;if(typeof a==="string"){let j=Ka.get();j.has(a)||j.add(a,Xb()),e=j.get(a)}else e=a;let f=e.image,g=f.getContext("2d");return c?b.call(c,f,g):b(f,g),e.setSize(f.width/d,f.height/d),e.binding&&e.binding.update(),e}class ym{constructor(a=0,b=a,c=0,d=c,e=0){this._width=0;this._height=0;this.cornerRadius={tl:Za(0),tr:Za(0),bl:Za(0),br:Za(0)};this.setTo(a,b,c,d,e)}setTo(a=0,b=a,c=0,d=c,e=0){return this.setPosition(a,b),this.setRadius(e),this.setSize(c,d),this}setPosition(a=0,b=a){return this.x=a,this.y=b,this}setRadius(a=0){let b=this.cornerRadius;if(typeof a==="number"){const c=a,d=a;b.tl=Za(void 0,c,d),b.tr=Za(void 0,c,d),b.bl=Za(void 0,c,d),b.br=Za(void 0,c,d)}else{const c=a.x??0,d=a.y??0;b.tl=Za(a.tl,c,d),b.tr=Za(a.tr,c,d),b.bl=Za(a.bl,c,d),b.br=Za(a.br,c,d)}return this}setSize(a=0,b=a){return this.width=a,this.height=b,this}get minWidth(){let a=this.cornerRadius;return Math.max(a.tl.x+a.tr.x,a.bl.x+a.br.x)}get minHeight(){let a=this.cornerRadius;return Math.max(a.tl.y+a.bl.y,a.tr.y+a.br.y)}get width(){return this._width}set width(a){a==null&&(a=0),this._width=Math.max(a,this.minWidth)}get height(){return this._height}set height(a){a==null&&(a=0),this._height=Math.max(a,this.minHeight)}get radius(){let a=this.cornerRadius,b=Math.max(a.tl.x,a.tl.y,a.tr.x,a.tr.y,a.bl.x,a.bl.y,a.br.x,a.br.y);return b}}function Za(a,b,c){return a===void 0?{x:b,y:c}:typeof a==="number"?{x:a,y:a}:a}const zm=rb(0),Am=rb(90),Bm=rb(180),Cm=rb(270);function bh(a,b,c,d,e,f,g,j,i,l){const n=new ym(c,d,e,f,g),u=n.minWidth,A=n.minHeight,B=e>=u?1:e/u,D=f>=A?1:f/A,G=n.cornerRadius;let H,L,J,N,I;b.beginPath(),b.translate(c,d),H=G.br,L=H.x*B,J=H.y*D,N=n.width-L,I=n.height-J,Ce(H)?b.ellipse(N,I,L,J,0,zm,Am):(b.moveTo(n.width,I),b.lineTo(n.width,n.height),b.lineTo(N,n.height)),H=G.bl,L=H.x*B,J=H.y*D,N=L,I=n.height-J,b.lineTo(L,n.height),Ce(H)?b.ellipse(N,I,L,J,0,Am,Bm):(b.lineTo(0,n.height),b.lineTo(0,I)),H=G.tl,L=H.x*B,J=H.y*D,N=L,I=J,b.lineTo(0,I),Ce(H)?b.ellipse(N,I,L,J,0,Bm,Cm):(b.lineTo(0,0),b.lineTo(N,0)),H=G.tr,L=H.x*B,J=H.y*D,N=n.width-L,I=J,b.lineTo(N,0),Ce(H)?b.ellipse(N,I,L,J,0,Cm,zm):(b.lineTo(n.width,0),b.lineTo(n.width,I)),b.closePath(),j&&(b.fillStyle=j,b.fill()),i&&(b.strokeStyle=i,b.lineWidth=l,b.stroke())}function Ce(a){return a.x!==0&&a.y!==0}var sm;(function(a){a[a.right=0]="right",a[a.down=1]="down",a[a.left=2]="left",a[a.up=3]="up"})(sm||(sm={}));function Ml(a,b){b.width!==a.width&&(b.width=a.width),b.height!==a.height&&(b.height=a.height);let c=b.getContext("2d");c.drawImage(a.texture.image,a.x,a.y,a.width,a.height)}function Lg(a,b,c=0,d=0,e=a.width,f=a.height){let g=a.resolution,j=a.canvas,i=Math.ceil(e*g),l=Math.ceil(f*g);yb(b,function(n,u){n.width!==i&&(n.width=i),n.height!==l&&(n.height=l),u.clearRect(0,0,i,l),u.drawImage(j,c,d,i,l)},void 0,a.resolution)}function Mg(a,b,c){let d=Ka.get();if(!d.has(b))return;Ml(d.get(b).getFrame(c),a.canvas);let e=a.canvas.width,f=a.canvas.height,g=a.resolution,j=e/g,i=f/g;a.texture.setSize(j,i),a.setSize(j,i),a.updateTexture()}class Ll extends Fg{fill(a="#fff"){return Gg(this,a),this}getCanvas(){return this.canvas}getContext(){return this.context}getDataURL(a,b){return Ig(this,a,b)}getPixel(a,b,c=[0,0,0,0]){return Jg(this,a,b,c)}generateTexture(a,b=0,c=0,d=this.width,e=this.height){return Lg(this,a,b,c,d,e),this}loadFromURL(a,b){return qe(this,a,b),this}loadFromURLPromise(a){return Hg(this,a)}loadTexture(a,b){return Mg(this,a,b),this}setPixel(a,b,c,d,e,f){return Kg(this,a,b,c,d,e,f),this}}const Hba=Ga(Ri());const Jf="receive";const Wj={receive:Jf};function sh(a,b){return a.events.delete(b),a}function rh(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);for(const e of d)e.callback.apply(e.context,c),e.once&&d.delete(e);return d.size===0&&a.events.delete(b),!0}class oh{constructor(){this.events=new Map()}}class Pc{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function uh(a){return[...a.events.keys()]}function th(a,b){const c=a.events.get(b);return c?c.size:0}function vh(a,b){const c=[],d=a.events.get(b);return d.forEach(e=>{c.push(e.callback)}),c}function qh(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof Pc)g.delete(c);else{const j=!d,i=e!==void 0;for(const l of g)l.callback===c&&(j&&l.context===d)&&(i&&l.once===e)&&g.delete(l)}return g.size===0&&f.delete(b),a}function Oc(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new Pc(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function ph(a,b,c,d=a){return Oc(a,b,c,d,!0)}function De(a,b){b?a.events.delete(b):a.events.clear()}class Ca{setEventEmitter(a){return this.privateEE=a===void 0,this.eventEmitter=this.privateEE?new oh():a,this.lastEventInstance=null,this}clearEventEmitter(){return this.setEventEmitter(null),this}destroyEventEmitter(){return this.lastEventInstance=null,this.eventEmitter&&this.privateEE&&(De(this.eventEmitter),this.eventEmitter=null),this}on(a,b,c=this,d=!1){return this.lastEventInstance=null,this.eventEmitter&&(this.lastEventInstance=Oc(this.eventEmitter,a,b,c,d)),this}once(a,b,c=this){return this.lastEventInstance=null,this.eventEmitter&&(this.lastEventInstance=ph(this.eventEmitter,a,b,c)),this}off(a,b,c,d){return this.lastEventInstance=null,this.eventEmitter&&qh(this.eventEmitter,a,b,c,d),this}emit(a,...b){return this.lastEventInstance=null,this.eventEmitter&&rh(this.eventEmitter,a,...b),this}removeAllListeners(a){return this.lastEventInstance=null,this.eventEmitter&&De(this.eventEmitter,a),this}clearEvent(a){return this.lastEventInstance=null,this.eventEmitter&&sh(this.eventEmitter,a),this}getListenerCount(a){return this.lastEventInstance=null,this.eventEmitter?th(this.eventEmitter,a):0}getEventNames(){return this.lastEventInstance=null,this.eventEmitter?uh(this.eventEmitter):[]}getListeners(a){return this.lastEventInstance=null,this.eventEmitter?vh(this.eventEmitter,a):[]}}function Xj(a,b){(!a.sendToRef||a.sendToRef.key!==a.receiverID)&&(a.sendToRef=a.database.ref(a.rootPath).child(a.receiverID));if(b===void 0)return a.sendToRef.remove();let c={message:b,senderID:a.userID,stamp:a.stamp};return a.userName!==void 0&&(c.senderName=a.userName),a.skipFirst=!1,a.stamp=!a.stamp,a.sendToRef.set(c)}function Yj(a){if(a.isReceiving&&a.receiverRef.key===a.receiverID)return;If(a),a.isReceiving=!0,a.skipFirst=!0,a.receiverRef=a.database.ref(a.rootPath).child(a.receiverID),a.receiverRef.on("value",_j,a),a.receiverRef.onDisconnect().remove()}function If(a){if(!a.isReceiving)return;a.isReceiving=!1,a.receiverRef.off("value",_j,a),a.receiverRef.remove(),a.receiverRef.onDisconnect().cancel()}function _j(a){if(this.skipFirst){this.skipFirst=!1;return}let b=a.val();if(b==null)return;delete b.stamp,this.history.add(b),this.emit(this.eventNames.receive,b)}class Zj{constructor({maxLength:a=-1}={}){this.maxLength=a,this.records=[]}add(a){return this.maxLength===0?this:(this.records.push(a),this.maxLength>0&&this.records.length>this.maxLength&&this.records.shift(),this)}clear(){return this.records.length=0,this}changeUserName(a,b){return this.maxLength===0?this:(this.records.forEach(c=>{c.senderID===a&&(c.senderName=b)}),this)}}const gX=Ga(La());class gc extends Ca{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d,receiverID:e="",history:f=0,eventNames:g=Wj}={}){super();this.setEventEmitter(a),this.eventNames=g,this.database=gX.database(),this.setRootPath(b),this.skipFirst=!0,this.stamp=!1,this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.isReceiving=!1,f===!0?f=-1:f===!1&&(f=0),this.history=new Zj({maxLength:f})}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.sendToRef=void 0,this.receiverRef=void 0,this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.receiverID=a,this}changeUserName(a,b){return a===this.userID&&(this.userName=b),this.history.changeUserName(a,b),this}getHistory(){return this.history.records}clearHistory(){return this.history.clear(),this}send(a){return Xj(this,a)}startReceiving(){return Yj(this),this}stopReceiving(){return If(this),this}}const rp="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function $d(a,b,c=rp){let d=b===void 0?a:zc(a,b),e="";for(let f=0;f<d;f++)e+=dc(Array.from(c));return e}const x2=Ga(La());var ra;(function(a){a[a["1d"]=1]="1d",a[a["2d"]=2]="2d",a[a["3d"]=3]="3d"})(ra||(ra={}));const Qf="init";const Rf="update";const Kf="addkey0";const Lf="addkey1";const Mf="addkey2";const Sf="removekey0";const Tf="removekey1";const Uf="removekey2";const Nf="changekey0";const Of="changekey1";const Pf="changekey2";const $j={init:Qf,update:Rf,addkey0:Kf,removekey0:Sf,changekey0:Nf,addkey1:Lf,removekey1:Tf,changekey1:Of,addkey2:Mf,removekey2:Uf,changekey2:Pf};function Fm(a){return a==null||a===""||a.length===0}function qp(a,b,c={}){let d=a;if(!Fm(b)){typeof b==="string"&&(b=b.split("."));let e;for(let f=0,g=b.length;f<g;f++){e=b[f];if(d[e]==null||typeof d[e]!=="object"){let j;f===g-1?j=c:j={},d[e]=j}d=d[e]}}return d}function Gm(a,b,c){if(typeof a!=="object")return;if(Fm(b)){if(c==null)return;typeof c==="object"&&(a=c)}else{typeof b==="string"&&(b=b.split("."));let d=b.pop(),e=qp(a,b);e[d]=c}return a}function Ee(a){if(Array.isArray(a))a.length=0;else for(let b in a)delete a[b]}function Em(a){return JSON.parse(JSON.stringify(a))}class ak{constructor(){this.data={}}setValue(a,b){return a==null?this.clear():typeof a==="object"?this.data=a:Gm(this.data,a,b),this}getValue(a){if(a==null)return this.data;{typeof a==="string"&&(a=a.split("."));let b=this.data;for(let c=0,d=a.length;c<d;c++){if(!wh(b))return;b=b[a[c]]}return b}}cloneValue(a){return Em(this.getValue(a))}removeKey(a){if(a==null)this.clear();else{typeof a==="string"&&(a=a.split("."));let b=a.pop(),c=this.data;for(let d=0,e=a.length;d<e;d++){if(!wh(c))return this;c=c[a[d]]}wh(c)&&delete c[b]}return this}clear(){return Ee(this.data),this}}function wh(a){return a!=null&&typeof a==="object"}const xY=Ga(La());class Nb extends Ca{constructor({eventEmitter:a,parent:b,key:c,type:d,eventNames:e,table:f}={}){super();this.setEventEmitter(a),this.parent=b,this.children=new Map(),this.key=c,this.parent?this.fullKeyPath=kk(this.parent.fullKeyPath,this.key):this.fullKeyPath="",this.type=d,this.eventNames=e,this.table=f,this.database=xY.database(),this.setRootPath()}destroy(){this.stopUpdate().clear().destroyEventEmitter()}setRootPath(a){if(a===void 0){let b=this.parent?this.parent.rootPath:"";a=`${b}/${this.key}`}this.rootPath=a,this.rootRef=a!==""?this.database.ref(a):void 0;for(const[b,c]of this.children)c instanceof Nb&&c.setRootPath();return this}setData(a,b){if(arguments.length===0)this.clear();else if(typeof a=="string")this.setChildData(a,b);else{let c=a;for(const[d,e]of this.children)c.hasOwnProperty(d)||this.removeChild(d);for(let d in c)this.setChildData(d,c[d])}return this}clear(){this.table.removeKey(this.fullKeyPath);for(const[a,b]of this.children)this.removeChild(a);return this}get childClass(){return null}setChildData(a,b){const c=kk(this.fullKeyPath,a);this.table.setValue(c,b);if(!(typeof b!=="object")){if(this.children.has(a))this.children.get(a).setData(b);else if(this.childClass){let d=new this.childClass({parent:this,key:a,type:this.type,eventEmitter:this.eventEmitter,eventNames:this.eventNames,table:this.table});d.startUpdate(),this.children.set(a,d)}}return this}removeChild(a){return this.children.has(a)&&(this.children.get(a).destroy(),this.children.delete(a)),this}startUpdate(){return this}stopUpdate(){return this}}function kk(a,b){return a==null||a===""?b:b==null||b===""?a:`${a}.${b}`}class Dc extends Nb{startUpdate(){return this.rootRef.on("child_added",this.addCol,this),this.rootRef.on("child_removed",this.removeCol,this),this.rootRef.on("child_changed",this.changeColValue,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addCol,this),this.rootRef.off("child_removed",this.removeCol,this),this.rootRef.off("child_changed",this.changeColValue,this),this}addCol(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["1d"]:this.emit(this.eventNames.addkey0,b,c);break;case ra["2d"]:this.emit(this.eventNames.addkey1,this.key,b,c);break;default:this.emit(this.eventNames.addkey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}removeCol(a){const b=a.key;this.removeChild(b);switch(this.type){case ra["1d"]:this.emit(this.eventNames.removekey0,b);break;case ra["2d"]:this.emit(this.eventNames.removekey1,this.key,b);break;default:this.emit(this.eventNames.removekey2,this.pageKey,this.key,b);break}this.emit(this.eventNames.update,this.table.data)}changeColValue(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["1d"]:this.emit(this.eventNames.changekey0,b,c);break;case ra["2d"]:this.emit(this.eventNames.changekey1,this.key,b,c);break;default:this.emit(this.eventNames.changekey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}get pageKey(){return this.parent.key}}class Ec extends Nb{startUpdate(){return this.rootRef.on("child_added",this.addRow,this),this.rootRef.on("child_removed",this.removeRow,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addRow,this),this.rootRef.off("child_removed",this.removeRow,this),this}addRow(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["2d"]:this.emit(this.eventNames.addkey0,b,c);break;default:this.emit(this.eventNames.addkey1,this.key,b,c);break}}removeRow(a){const b=a.key;this.removeChild(b);switch(this.type){case ra["2d"]:this.emit(this.eventNames.removekey0,b);break;default:this.emit(this.eventNames.removekey1,this.key,b);break}}get childClass(){return Dc}}class Vf extends Nb{startUpdate(){return this.rootRef.on("child_added",this.addPage,this),this.rootRef.on("child_removed",this.removePage,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addPage,this),this.rootRef.off("child_removed",this.removePage,this),this}addPage(a){const b=a.key,c=a.val();this.setData(b,c),this.emit(this.eventNames.addkey0,b,c)}removePage(a){const b=a.key;this.removeChild(b),this.emit(this.eventNames.removekey0,b)}get childClass(){return Ec}}const Xd={};Xd[ra["1d"]]=Dc;Xd[ra["2d"]]=Ec;Xd[ra["3d"]]=Vf;function bk(a){return new Xd[a.tableType]({type:a.tableType,eventEmitter:a.eventEmitter,eventNames:a.eventNames,table:a.table})}function ck(a){return a.updater.clear(),a.initialFlag=!1,a.rootRef.once("value").then(function(b){let c=b.val()??{};return a.table.setValue(c),a.emit(a.eventNames.init,c),a.initialFlag=!0,Promise.resolve(c)})}function Fa(a,b,c,d){let e=a.rootRef;return e=b?e.child(b):e,e=c?e.child(c):e,e=d?e.child(d):e,e}function dk(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Fa(a,c,d,e).set(f)}function ek(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;default:c=b[0];break}return Fa(a,c,d,e).remove()}function fk(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Fa(a,c,d,e).transaction(function(g){return g===null&&(g=0),g+f})}function gk(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Fa(a,c,d,e).transaction(f)}function hk(a,b){return Fa(a).update(b)}function ik(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;case 1:c=b[0];break}return Fa(a,c,d,e).onDisconnect().remove()}function jk(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Fa(a,c,d,e).onDisconnect().set(f)}const AX=Ga(La());class hc extends Ca{constructor({eventEmitter:a,root:b="",type:c=ra["3d"],eventNames:d=$j}={}){super();this.setEventEmitter(a),this.eventNames=d,this.database=AX.database(),this.table=new ak(),this.setTableType(c),this.setRootPath(b),this.initialFlag=!1}destroy(){this.updater.destroy(),this.destroyEventEmitter().stopUpdate()}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):null,this.updater.setRootPath(a),this}setTableType(a){return typeof a==="string"&&(a=ra[a]),this.tableType=a,this.updater&&this.updater.destroy(),this.updater=bk(this),this}startUpdate(){return ck(this),this.updater.startUpdate(),this}stopUpdate(){return this.updater.stopUpdate(),this}clear(){return this.updater.clear(),this}getData(){return this.table.getValue(...arguments)}cloneData(){return this.table.cloneValue(...arguments)}getItemRef(a,b,c){return Fa(this,a,b,c)}setData(...a){return dk(this,...a)}removeData(...a){return ek(this,...a)}incValue(...a){return fk(this,...a)}transaction(...a){return gk(this,...a)}updateData(a){return hk(this,a)}removeDataOnDisconnect(...a){return ik(this,...a)}setDataOnDisconnect(...a){return jk(this,...a)}}const H1=Ga(La());var Ag;(function(a){a.d="d",a.w="w",a.m="m",a.y="y",a.day="d",a.week="w",a.month="m",a.year="y"})(Ag||(Ag={}));var Lc;(function(a){a.d="tagD",a.w="tagW",a.m="tagM",a.y="tagY"})(Lc||(Lc={}));var Mc;(function(a){a.d="scoreD",a.w="scoreW",a.m="scoreM",a.y="scoreY"})(Mc||(Mc={}));var sl;(function(a){a.d="day",a.w="week",a.m="month",a.y="year"})(sl||(sl={}));function Eg({query:a,totalLines:b=Infinity,linesPerPage:c=1e3,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g}){return Kl({query:a,remainderLines:b,linesPerPage:c,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g})}function Kl(a){let b=a.query;a.startDocRef&&(b=b[a.startMode](a.startDocRef));let c=Math.min(a.remainderLines,a.linesPerPage);return a.remainderLines-=c,b.limit(c).get().then(function(d){let e=a.remainderLines===0||d.size<c,f=!1;a.forEachPageCallback&&(f=a.forEachPageCallback(d)||!1),e=e||f;if(e){let g;return a.resolveCallback&&(g=a.resolveCallback()),Promise.resolve(g)}else return a.startDocRef=d.docs[d.size-1],a.startMode="startAfter",Kl(a)})}function Ja(a,b=Infinity,c=0,d,e){let f=[],g=0;return Eg({query:a,totalLines:c+b,startDocRef:d,startMode:e,forEachPageCallback:function(j){let i,l=j.size,n=c-g;n<=0?i=j.docs:n<l&&(i=j.docs.slice(n,l)),i&&f.push(...i),g+=l},resolveCallback:function(){return f}})}const M4=Ga(La());function Bl(a,b,c=0){return Ja(a.nextQuery,b,c,a.baselineDocRef,a.baselineMode).then(function(d){let e=d.length;return a.cacheItems=d,a.pageIndex=void 0,a.startItemIndex=c,a.endItemIndex=a.startItemIndex+e-1,a.isFullPage=b===void 0?!0:e===b,Promise.resolve(a.cacheItems)})}const k4=Ga(La());class ne{constructor({query:a={next:void 0,previous:void 0},itemCount:b=100,baselineDoc:c,baselineMode:d="startAt"}={}){this.setQuery(a),this.setItemCount(b),this.setBaselineDoc(c,d),this.pageIndex=void 0,this.baselineDocRef=void 0,this.baselineMode="startAt",this.startItemIndex=void 0,this.endItemIndex=void 0,this.cacheItems=void 0,this.isFullPage=void 0}setQuery(a,b){if(a instanceof k4.firestore.Query)this.nextQuery=a,this.prevQuery=b;else{var c=a;this.nextQuery=c.next,this.prevQuery=c.previous}return this.pageIndex=null,this.isFullPage=!0,this}setItemCount(a){return this.itemCount=a,this}setBaselineDoc(a,b){return a?(this.baselineDocRef=a.ref,this.baselineMode=b):this.baselineDocRef=void 0,this}load(a,b=0){return Bl(this,a,b)}loadFirstPage(){return this._loadFirstPage()}loadNextPage(){return this.pageIndex==null?this._loadFirstPage():this._loadNextPage()}loadPreviousPage(){return this.pageIndex==null||this.pageIndex===1?this._loadFirstPage():this._loadPreviousPage()}loadCurrentPage(){return this.pageIndex==null||this.pageIndex===0?this._loadFirstPage():this._loadCurrentPage()}}function Hl(a){return Ja(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=null,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function Cl(a){return Ja(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,Promise.resolve(a.cacheItems)})}function Il(a){return Ja(a.nextQuery,a.itemCount,0,a.currPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=a.currPageEndDocRef,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function Dl(a){let b=(a.pageIndex+1)*a.itemCount;return Ja(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function Jl(a){return Ja(a.prevQuery,a.itemCount+1,0,a.currPageStartDocRef,"startAfter").then(function(b){let c=b.length-1;return a.cacheItems=b,a.cacheItems.pop(),a.cacheItems.reverse(),a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-c+1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=b[c].ref,a.currPageStartDocRef=b[c-1].ref,a.currPageEndDocRef=b[0].ref,Promise.resolve(a.cacheItems)})}function El(a){let b=(a.pageIndex-1)*a.itemCount;return Ja(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-d+1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function Gl(a){return Ja(a.nextQuery,a.itemCount,0,a.prevPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function Fl(a){let b=a.pageIndex*a.itemCount;return Ja(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}class Bg extends ne{_loadFirstPage(){return Cl(this)}_loadNextPage(){return Dl(this)}_loadPreviousPage(){return El(this)}_loadCurrentPage(){return Fl(this)}}const k3=Ga(La());class me extends ne{_loadFirstPage(){return Hl(this)}_loadNextPage(){return Il(this)}_loadPreviousPage(){return Jl(this)}_loadCurrentPage(){return Gl(this)}}const d4=Ga(La());function ul(a,b){let c={senderID:a.userID,message:b,timestamp:d4.firestore.FieldValue.serverTimestamp()};return a.userName!==void 0&&(c.senderName=a.userName),a.receiverID!==void 0&&(c.receiverID=a.receiverID),a.rootRef.add(c)}function Cg(a,b=a.receiverID){let c=a.rootRef;return c=b!==void 0?c.where("receiverID","==",b):c,c}function tl(a,b=a.receiverID){let c=Cg(a,b),d=c.orderBy("timestamp"),e=c.orderBy("timestamp","desc");return{next:d,previous:e}}const Dg="receive";function vl(a){let b=Cg(a).orderBy("timestamp","desc").limit(1);a.unsubscribe=b.onSnapshot({includeMetadataChanges:!0},function(c){if(c.size>0){let d=c.docs[0];if(d.metadata.hasPendingWrites){a.skipFirst&&(a.skipFirst=!1);return}zl(a,a.receiverID,d);if(a.skipFirst)a.skipFirst=!1;else{let e=Al(d);a.cacheMessages.push(e),a.emit(Dg,e)}}else a.skipFirst&&(a.skipFirst=!1)},function(c){debugger})}function wl(a){a.unsubscribe&&a.unsubscribe(),a.resetQueryFlag=!0,a.cacheMessages.length=0}function xl(a){return zl(a),a.page.loadNextPage().then(function(b){let c=[];for(let d=0,e=b.length;d<e;d++)c.push(Al(b[d]));return a.cacheMessages.splice(0,0,...c),Promise.resolve(c)})}function zl(a,b=a.receiverID,c){if(!a.resetQueryFlag)return;a.resetQueryFlag=!1;let d=a.skipFirst?"startAt":"startAfter";a.page.setBaselineDoc(c,d).setQuery(tl(a,b));return}function Al(a){let b=a.data();return b.timestamp=b.timestamp.toDate(),b}const W3=Ga(La());class yl extends Ca{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d="",receiverID:e,pageItemCount:f=100}={}){super();this.setEventEmitter(a),this.database=W3.firestore(),this.setRootPath(b),this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.skipFirst=!0,this.unsubscribe=void 0,this.page=new me(),this.setPageItemCount(f),this.resetQueryFlag=!0,this.cacheMessages=[]}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.resetQueryFlag=this.resetQueryFlag||this.rootPath!==a,this.rootPath=a,this.rootRef=this.database.collection(a),this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.resetQueryFlag=this.resetQueryFlag||this.receiverID!==a,this.receiverID=a,this}setPageItemCount(a){return this.page.setItemCount(a),this}get hasPreviousMessage(){return this.page.isFullPage!==!1}send(a){return ul(this,a)}startReceiving(){return vl(this),this}stopReceiving(){return wl(this),this}loadPreviousMessages(){return xl(this)}}const Zf="join";const _f="leave";const ag="init";const $f="update";const Yf="changename";const Xf="change";const pk={join:Zf,leave:_f,update:$f,change:Xf,init:ag,changename:Yf};var nb;(function(a){a[a.once=0]="once",a[a.child=1]="child",a[a.all=2]="all"})(nb||(nb={}));const rg="add";const tg="remove";const sg="change";const ug="update";const hl={add:rg,remove:tg,update:ug,change:sg};function ke(a){a.items.length=0,a.itemID2Index.clear()}function il(a){return a.items}function jl(a,b){return a.itemID2Index.has(b)}function qg(a,b){return b==null?null:a.itemID2Index.get(b)}function kl(a,b){if(b==null)return null;let c=qg(a,b);return c==null?null:a.items[c]}function ll(a,b,c){a.items.forEach(b,c)}function xb(a){a.itemID2Index.clear();let b=a.items;for(var c=0,d=b.length;c<d;c++){let e=b[c][a.keyItemID];a.itemID2Index.set(e,c)}}function ml(a,b){if(b>=a.length)return;let c=a.length-1,d=a[b];for(let e=b;e<c;e++)a[e]=a[e+1];return a.length=c,d}function vg(a,b){let c=xg.call(this,a,b);xb(this),this.emit(this.eventNames.add,c),this.emit(this.eventNames.update,this.items)}function Jc(a,b){let c=nl.call(this,a);xb(this);let d=xg.call(this,a,b);xb(this),this.emit(this.eventNames.change,d,c),this.emit(this.eventNames.update,this.items)}function wg(a){let b=nl.call(this,a);xb(this),this.emit(this.eventNames.remove,b),this.emit(this.eventNames.update,this.items)}function Kc(a){ke(this),a.forEach(function(b){xg.call(this,b,null,!0)}.bind(this)),xb(this),this.emit(this.eventNames.update,this.items)}function xg(a,b,c=!1){let d,e=this.getItemCallback,f=this.getItemCallbackScope;f?d=e.call(f,a):d=e(a);if(c)return this.items.push(d),d;if(b==null)this.items.unshift(d);else{let g=this.itemID2Index.get(b);g===this.items.length-1?this.items.push(d):this.items.splice(g+1,0,d)}return d}function nl(a){let b=this.itemID2Index.get(a.key),c=ml(this.items,b);return c}const ql={start(a,b){a.isUpdating=!1,b.once("value",Kc,a)},stop(a){}};const pl={start(a,b){b.on("child_added",vg,a),b.on("child_removed",wg,a),b.on("child_moved",Jc,a),b.on("child_changed",Jc,a)},stop(a){a.query.off("child_added",vg,a),a.query.off("child_removed",wg,a),a.query.off("child_moved",Jc,a),a.query.off("child_changed",Jc,a)}};const ol={start(a,b){b.on("value",Kc,a)},stop(a){a.query.off("value",Kc,a)}};const Ic={};Ic[nb.all]=ol;Ic[nb.child]=pl;Ic[nb.once]=ql;class Ob extends Ca{constructor({eventEmitter:a,itemIDKey:b="__itemID__",mode:c=nb.child,getItemCallback:d=to,getItemCallbackScope:e,query:f,eventNames:g=hl}={}){super();this.setEventEmitter(a),this.eventNames=g,this.isUpdating=!1,this.items=[],this.itemID2Index=new Map(),this.setItemIDKey(b),this.setMode(c),e===void 0&&(e=this),this.setGetitemCallback(d,e),this.setQuery(f)}destroy(){this.stopUpdate().clear()}setItemIDKey(a){return this.keyItemID=a,this}setMode(a){return typeof a==="string"&&(a=nb[a]),this.mode=a,this.updater=Ic[a],this}setGetitemCallback(a,b){return this.getItemCallback=a,this.getItemCallbackScope=b,this}setQuery(a){return this.query=a,this}startUpdate(a){if(a)this.setQuery(a);else if(this.query)a=this.query;else return this;return this.stopUpdate().clear(),this.isUpdating=!0,this.updater.start(this,a),this}stopUpdate(){return!this.query||!this.isUpdating?this:(this.isUpdating=!1,this.updater.stop(this),this)}clear(){return ke(this),this}getItems(){return il(this)}hasItem(a){return jl(this,a)}getItemIndexFromItemID(a){return qg(this,a)}getItemFromItemID(a){return kl(this,a)}forEach(a,b){return ll(this,a,b),this}updateItemID2Index(){return xb(this),this}}const to=function(a){let b=a.val();return b[this.keyItemID]=a.key,b};function ub(a,b=a.userID){return a.userID2ItemID.has(b)}function Yd(a,b=a.userID){if(!ub(a,b))return null;let c=a.userID2ItemID.get(b);return a.rootRef.child(c)}function qk(a,b=a.userID){if(!ub(a,b))return null;let c=a.userID2ItemID.get(b);return a.userList.getItemFromItemID(c)}function Wf(a){return a.userList.getItems()}function rk(a){a.userList.clear()}function sk(a,b,c){a.userList.forEach(b,c)}function tk(a,b=a.userID){let c=a.userList.getItems()[0];return c&&c.userID===b}function uk(a){return a.maxUsers===0?!1:a.userList.getItems().length>=a.maxUsers}function mk(a=0,b){return new Promise(function(c,d){setTimeout(function(){c(b)},a)})}function nk(a,b=a.userID,c=a.userName){if(ub(a,b))return Promise.resolve();let d={userID:b,userName:c},e=a.maxUsers,f=a.database.ref(a.rootPath),g=f.push();return g.onDisconnect().remove().then(function(){return g.set(d)}).then(function(){return mk(0)}).then(function(){return e===0?(a.isInList=!0,Promise.resolve()):f.limitToFirst(e).once("value").then(function(j){return ho(j,b)?(a.isInList=!0,Promise.resolve()):(a.isInList=!1,g.remove().then(function(){return g.onDisconnect().cancel()}).then(function(){return Promise.reject()}))})})}function ho(a,b){let c=!1;return a.forEach(function(d){let e=d.val();if(e.userID===b)return c=!0,!0}),c}function ok(a,b=a.userID){if(!ub(a,b))return Promise.resolve();let c=a.userID2ItemID.get(b),d=a.database.ref(a.rootPath).child(c);return d.remove()}function lk(a,b){return new Promise(function(c,d){let e=Yd(a);if(e)return c(e);{let f=a.rootRef.orderByChild("userID").equalTo(a.userID);f.once("child_added").then(function(g){return c(g.ref)})}}).then(function(c){return c.child("userName").set(b)}).then(function(){return a.userName=b,Promise.resolve()})}const hZ=Ga(La());class ic extends Ca{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,eventNames:f=pk}={}){super();this.setEventEmitter(a),this.eventNames=f,this.database=hZ.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.setMaxUsers(e),this.userList=new Ob({eventEmitter:this.eventEmitter,itemIDKey:"joinAt",eventNames:{add:f.join,remove:f.leave,update:f.update,change:f.change}}),this.isInList=!1,this.userID2ItemID=new Map(),this.userList.on(this.eventNames.join,function(g){this.userID2ItemID.set(g.userID,g.joinAt),g.userID===this.userInfo.userID&&this.emit(this.eventNames.init,Wf(this))},this).on(this.eventNames.leave,function(g){this.userID2ItemID.delete(g.userID),g.userID===this.userID&&(this.isInList=!1)},this).on(this.eventNames.change,function(g,j){let i=g.userID,l=g.userName,n=j.userName;l!==n&&this.emit(this.eventNames.changename,i,l,n)},this)}destroy(){this.stopUpdate().destroyEventEmitter().leave(),this.userList.destroy()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setMaxUsers(a){return this.maxUsers=a,this}clear(){return rk(this),this}forEach(a,b){return sk(this,a,b),this}isFull(){return uk(this)}isFirstUser(a=this.userID){return tk(this,a)}getUser(a=this.userID){return qk(this,a)}getUsers(){return Wf(this)}getUserRef(a=this.userID){return Yd(this,a)}contains(a=this.userID){return ub(this,a)}join(a=this.userID,b=this.userName){return nk(this,a,b)}leave(a=this.userID){return ok(this,a)}changeUserName(a){return lk(this,a)}startUpdate(){let a=this.rootRef;return this.maxUsers>0&&(a=a.limitToFirst(this.maxUsers)),this.userList.startUpdate(a),this}stopUpdate(){return this.userList.stopUpdate(),this}}function Hk(a){const b=new ic({eventEmitter:a.eventEmitter,eventNames:{join:"userlist.join",leave:"userlist.leave",update:"userlist.update",change:"userlist.change",init:"userlist.init",changename:"userlist.changename"},userID:a.userInfo});return b.on("userlist.leave",function(c){c.userID===a.userID&&mo(a)}),a.on("room.join",function(){b.startUpdate()}).on("room.leave",function(){b.stopUpdate().clear()}),b}function mo(a){a.emit("room.leave"),setTimeout(function(){a.roomID=void 0,a.roomName=void 0,a.doorState=void 0,a.leftRoomFlag=!1},0)}function Ek(a){const b=new Ob({eventEmitter:a.eventEmitter,itemIDKey:"roomID",eventNames:{update:"roomlist.update",add:"roomlist.add",remove:"roomlist.remove",change:"roomlist.change"},mode:"once"});return b}function Ok(a){return a.split("|")[0]}function Nk(a){return a.split("|")[1]}function jc(a,b=""){return`${a}|${b}`}function db(a,b){let c=a.rootRef;return b&&(c=c.child(b)),c}function Gc(a,b,c){let d=db(a,"rooms");return b!==void 0&&(d=d.child(b),c!==void 0&&(d=d.child(c))),d}function Dk(a,b){return Gc(a,b,"alive")}function Ik(a,b){return Gc(a,b,"users")}function Fc(a,b){let c=db(a,"room-filters");return b!==void 0&&(c=c.child(b)),c}function kc(a,b){let c=db(a,"room-metadata");return b!==void 0&&(c=c.child(b)),c}function _d(a,b,c){let d=`${a.rootPath}/rooms/${b}`;return c&&(d+=`/${c}`),d}function be(a,b){return _d(a,b,"users")}function Fk(a,b,c){let d=_d(a,b,"tables");return c&&(d+=`/${c}`),d}function Jk(a,b,c="open"){let d=Fc(a);return d=d.orderByChild("filter"),b===void 0?d=d.startAt(c).endAt(`${c}~`):d=d.equalTo(jc(c,b)),d}function Ak(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new gc({eventEmitter:a.eventEmitter,eventNames:{receive:"broadcast.receive"},receiverID:"boradcast",senderID:a.userInfo,history:b.history});return a.on("room.join",function(d){c.setRootPath(_d(a,d.roomID)).startReceiving()}).on("room.leave",function(){c.stopReceiving()}).on("userlist.changename",function(d,e){c.changeUserName(d,e)}),c}function Gk(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,lo(a,d))}),a.on("room.join",function(d){for(const[e,f]of c)f.setRootPath(Fk(a,d.roomID,e)).startUpdate()}).on("room.leave",function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function lo(a,{key:b,type:c=ra["1d"]}){const d=new hc({eventEmitter:a.eventEmitter,type:c,eventNames:{init:`tables.${b}.init`,update:`tables.${b}.update`,addkey0:`tables.${b}.addkey0`,removekey0:`tables.${b}.removekey0`,changekey0:`tables.${b}.changekey0`,addkey1:`tables.${b}.addkey1`,removekey1:`tables.${b}.removekey1`,changekey1:`tables.${b}.changekey1`,addkey2:`tables.${b}.addkey2`,removekey2:`tables.${b}.removekey2`,changekey2:`tables.${b}.changekey2`}});return d}function Qa(a,b=a.roomID,c=a.roomName){return{roomID:b,roomName:c}}function fe(a,b){return b===void 0?a.roomID!==void 0:a.roomID===b}function Rk(a){return a.userList.isFull()}function Sk(a,b=a.userID){return a.userList.isFirstUser(b)}function Tk(a){return a.userList.getUsers()}function ce(a,b,c,d){a.roomID=b,a.roomName=c,a.roomType=d,a.emit("room.join",Qa(a))}function ae(a,b={}){return b.roomID==null&&(b.roomID=Gc(a).push().key),jo(a,b.roomID).then(function(){return ko(a,b)})}function jo(a,b){return Dk(a,b).transaction(function(c){return c===null?!0:void 0})}function ko(a,{roomID:b,roomName:c="",roomType:d="",maxUsers:e=0,presisted:f=!1,door:g="open",join:j=!0,filterData:i}){let l=Gc(a,b),n=Fc(a,b),u=kc(a,b);a.isRemoveRoomWhenLeft=!f,a.isRemoveRoomWhenLeft&&(l.onDisconnect().remove(),n.onDisconnect().remove(),u.onDisconnect().remove());const A=jc(g,d),B={},D={filter:A,name:c};i&&(D.data=i),B[`room-filters/${b}`]=D;const G={name:c,filter:A,maxUsers:e,moderators:{}};return G.moderators[a.userID]=a.userName,B[`room-metadata/${b}`]=G,new Promise(function(H,L){if(j){const J=a.userList.setRootPath(be(a,b)).setMaxUsers(0).join();return a.userList.setMaxUsers(e),J.then(H,L)}else return H()}).then(function(){return db(a).update(B)}).then(function(){return a.isRoomCreator=!0,j&&ce(a,b,c,d),Promise.resolve(Qa(a))})}function Bk(a,{digits:b=10,candidates:c="0123456789",retry:d=1e3}){let e=arguments[1];return Ck(a,b,c,d,e)}function Ck(a,b,c,d,e){return e.roomID=$d(b,b,c),d<=0?Promise.reject(e):(d--,ae(a,e).catch(function(){return Ck(a,b,c,d,e)}))}function ge(a,b=a.roomID){const c={};c[`room-filter/${b}`]=null,c[`room-metadata/${b}`]=null,c[`rooms/${b}`]=null;const d=Qa(a);return db(a).update(c).then(function(){return Promise.resolve(d)})}function lc(a){if(!fe(a))return Promise.resolve(Qa(a));a.leftRoomFlag=!0;if(a.isRemoveRoomWhenLeft)return ge(a);{const b=Qa(a);return a.userList.leave().then(function(){return Promise.resolve(b)})}}function ee(a,{leftThenJoin:b=!0,roomID:c}){return b?lc(a).then(function(){return Pk(a,c)}):Pk(a,c)}function Pk(a,b){return b==null?Promise.reject(Qa(a,b,"")):(a.isRemoveRoomWhenLeft=!1,no(a,b).then(function(c){return a.userList.setRootPath(be(a,b)).setMaxUsers(c.maxUsers).join().then(function(){return Promise.resolve(c)})}).then(function(c){return ce(a,b,c.name,Nk(c.filter)),Promise.resolve(Qa(a))}))}function no(a,b){return kc(a,b).once("value").then(function(c){let d=c.val();return oo(a,d)?Promise.resolve(d):Promise.reject()})}function oo(a,b){if(b==null)return!1;if(Ok(b.filter)==="closed")return!1;const c=a.userID;if(b.moderators[c])return!0;switch(b.permission){case"blocklist":const d=b.blocklist;return!(d&&d[c]);case"allowlist":const e=b.allowlist;return e&&e[c];default:return!0}}function de(a,b,c){return new Promise(function(d,e){a.roomList.once("roomlist.update",function(f){d(f)}).startUpdate(Jk(a,b,c))})}function Lk(a,{roomType:b="",leftThenJoin:c=!0}={}){return de(a,b,"open").then(function(d){if(d.length===0)return Promise.reject("No filtered room");Ud(d);const e={leftThenJoin:c,roomID:""};return Mk(a,e,d)})}function Mk(a,b,c,d=0){return d===c.length?Promise.reject("Can't join any room"):(b.roomID=c[d].roomID,d++,ee(a,b).catch(function(){return Mk(a,b,c,d)}))}function Qk(a,b){return a.userList.contains(b)?b===a.userID?lc(a):a.userList.leave(b):Promise.resolve()}function vb(a,b){return b===a.roomID?Promise.resolve(!0):kc(a,b).once("value").then(function(c){const d=c.val()!==null;return Promise.resolve(d)})}function Zd(a,b,c=a.roomID){return vb(a,c).then(function(d){if(!d)return Promise.resolve();const e=jc(b,a.roomType),f={};return f[`room-filters/${c}/filter`]=e,f[`room-metadata/${c}/filter`]=e,db(a).update(f)})}function xk(a,b=a.roomID){return Zd(a,"open",b)}function yk(a,b=a.roomID){return Zd(a,"closed",b)}function vk(a,b,c=a.roomID){return vb(a,c).then(function(d){return d?Fc(a,c).child("data").update(b):Promise.resolve()})}function zk(a,b){return a.userList.changeUserName(b)}function wk(a,b,c=a.roomID){return vb(a,c).then(function(d){if(!d)return Promise.resolve();const e={};return e[`room-filters/${c}/name`]=b,e[`room-metadata/${c}/name`]=b,db(a).update(e)})}function Kk(a,b=a.roomID){return b===a.roomID?a.userList.getUsers():new Promise(function(c,d){const e=new Ob({itemIDKey:"joinAt",mode:"once"});e.once("update",function(f){c(f)}).startUpdate(Ik(a,b))})}const Q_=Ga(La());class Uk extends Ca{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",broadcast:e=!0,tables:f=!1}={}){super();this.setEventEmitter(a),this.database=Q_.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.isRoomCreator=!1,this.roomID=void 0,this.roomName=void 0,this.roomType=void 0,this.doorState=void 0,this.leftRoomFlag=!1,this.isRemoveRoomWhenLeft=void 0,this.userList=Hk(this),this.roomList=Ek(this),this.broadcast=Ak(this,e),this.tables=Gk(this,f)}destroy(){var a=this;this.destroyEventEmitter().leaveRoom().then(function(){a.userList.destroy(),a.userList=void 0,a.roomList.destroy(),a.roomList=void 0,a.broadcast.destroy(),a.broadcast=void 0})}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}getRoomInfo(a,b){return Qa(this,a,b)}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(a){return fe(this,a)}isFull(){return Rk(this)}isFirstUser(a=this.userID){return Sk(this,a)}getUsers(){return Tk(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}createRoom(a){return ae(this,a)}createRandomRoom(a={}){return Bk(this,a)}joinRoom(a){return ee(this,a)}joinRandomRoom(a={}){return Lk(this,a)}leaveRoom(){return lc(this)}removeRoom(a=this.roomID){return ge(this,a)}kickUser(a){return Qk(this,a)}changeRoomState(a,b=this.roomID){return Zd(this,a,b)}openRoom(a=this.roomID){return xk(this,a)}closeRoom(a=this.roomID){return yk(this,a)}changeUserName(a){return zk(this,a)}changeFilterData(a,b=this.roomID){return vk(this,a,b)}changeRoomName(a,b,c=a.roomID){return wk(this,b,c)}getUserList(a=this.roomID){return Kk(this,a)}getRoomList(a,b){return de(this,a,b)}HasRoom(a){return vb(this,a)}}function $k(a,b){let c=a.rootPath;return b&&(c+=`/${b}`),c}function Zk(a){return $k(a,"users")}function Xk(a,b){return`${$k(a,"tables")}/${b}`}const mb="room.join";const wb="room.leave";const ng="userlist.join";const he="userlist.leave";const pg="userlist.init";const og="userlist.update";const Hc="userlist.changename";const bg="broadcast.receive";function cg(a){return`tables.${a}.init`}function dg(a){return`tables.${a}.update`}function eg(a){return`tables.${a}.addkey0`}function fg(a){return`tables.${a}.addkey1`}function gg(a){return`tables.${a}.addkey2`}function hg(a){return`tables.${a}.removekey0`}function ig(a){return`tables.${a}.removekey1`}function jg(a){return`tables.${a}.removekey2`}function kg(a){return`tables.${a}.changekey0`}function lg(a){return`tables.${a}.changekey1`}function mg(a){return`tables.${a}.changekey2`}function _k(a,b=0){const c=new ic({eventEmitter:a.eventEmitter,eventNames:{join:ng,leave:he,update:og,change:"userlist.change",init:pg,changename:Hc},root:Zk(a),userID:a.userInfo,maxUsers:b});return c.on(he,function(d){d.userID===a.userID&&ro(a)}),a.on(mb,function(){c.startUpdate()}).on(wb,function(){c.stopUpdate().clear()}),c}function ro(a){a.emit(wb),setTimeout(function(){a.leftRoomFlag=!1},0)}function Wk(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new gc({eventEmitter:a.eventEmitter,eventNames:{receive:bg},receiverID:"broadcast",senderID:a.userInfo,history:b.history});return a.on(mb,function(){c.setRootPath(a.rootPath).startReceiving()}).on(wb,function(){c.stopReceiving()}).on(Hc,function(d,e){c.changeUserName(d,e)}),c}function Yk(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,qo(a,d))}),a.on(mb,function(){for(const[d,e]of c)e.setRootPath(Xk(a,d)).startUpdate()}).on(wb,function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function qo(a,{key:b,type:c=ra["1d"]}){const d=new hc({eventEmitter:a.eventEmitter,type:c,eventNames:{init:cg(b),update:dg(b),addkey0:eg(b),removekey0:hg(b),changekey0:kg(b),addkey1:fg(b),removekey1:ig(b),changekey1:lg(b),addkey2:gg(b),removekey2:jg(b),changekey2:mg(b)}});return d}function je(a){return a.userList.isInList}function dl(a){return a.userList.isFull()}function el(a,b=a.userID){return a.userList.isFirstUser(b)}function fl(a){return a.userList.getUsers()}function bl(a){return a.userList.join().then(function(){return a.emit(mb),Promise.resolve()})}function ie(a){return je(a)?(a.leftRoomFlag=!0,a.userList.leave()):Promise.resolve()}function al(a){return a.userList.getUsers()}function cl(a,b){return a.userList.contains(b)?b===a.userID?ie(a):a.userList.leave(b):Promise.resolve()}function Vk(a,b){return a.userList.changeUserName(b)}const L$=Ga(La());class gl extends Ca{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,broadcast:f=!0,tables:g=!1}={}){const j=arguments[0];super();this.setEventEmitter(a),this.database=L$.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.leftRoomFlag=!1,this.userList=_k(this,e),this.broadcast=Wk(this,f),this.tables=Yk(this,g)}shutdown(){}destroy(){this.shutdown()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(){return je(this)}isFull(){return dl(this)}isFirstUser(a=this.userID){return el(this,a)}getUsers(){return fl(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}joinRoom(){return bl(this)}leaveRoom(){return ie(this)}getUserList(){return al(this)}kickUser(a){return cl(this,a)}changeUserName(a){return Vk(this,a)}}const hh="statechange";function ih(a){return`exit_${a}`}function jh(a){return`enter_${a}`}class gh extends Ca{constructor({eventEmitter:a=!0}={}){super();this.enable=!0;a&&this.setEventEmitter()}destroy(){this.destroyEventEmitter()}toJSON(){return{curState:this.state,prevState:this.prevState,enable:this.enable,start:this._start}}setEnable(a=!0){return this.enable=a,this}set state(a){if(!this.enable||this._stateLock)return;if(this._state===a)return;this._prevState=this._state,this._state=a,this._stateLock=!0,this.emit(hh,this);if(this._prevState!=null){let b=ih(this._prevState),c=this[b];c&&c.call(this),this.emit(b,this)}this._stateLock=!1;if(this._state!=null){let b=jh(this._state),c=this[b];c&&c.call(this),this.emit(b,this)}}get state(){return this._state}get prevState(){return this._prevState}start(a){return this._start=a,this._prevState=void 0,this._state=a,this}goto(a){return a!=null&&(this.state=a),this}next(){let a,b=this["next_"+this.state];return b?(typeof b==="string"?a=b:a=b.call(this),this.goto(a),this):this}update(a,b,c="update"){let d=this[`${c}_${this.state}`];d&&d.call(this,a,b)}preupdate(a,b){this.update(a,b,"preupdate")}postupdate(a,b){this.update(a,b,"postupdate")}addState(a,{next:b,exit:c,enter:d}){return b&&(this[`next_${a}`]=b),c&&(this[`exit_${a}`]=c),d&&(this[`enter_${a}`]=d),this}addStates(a){for(const b in a)this.addState(b,a[b]);return this}}var kh;(function(a){a[a.shuffle=0]="shuffle",a[a.random=1]="random"})(kh||(kh={}));const Fba=Ga(Jm());var lh;(function(a){a[a.none=0]="none",a[a.base64=1]="base64",a[a.utf16=2]="utf16",a[a.uri=3]="uri"})(lh||(lh={}));var Da;(function(a){a[a.none=0]="none",a[a.word=1]="word",a[a.char=2]="char"})(Da||(Da={}));var va;(function(a){a[a.none=0]="none",a[a.raw=1]="raw",a[a.wrapped=2]="wrapped"})(va||(va={}));const $g=/(?:\r\n|\r|\n)/;function bm(a,b,c,d,e,f=0){e<=0&&(d=0);let g=[];if(!a||!a.length)return g;let j=a.split($g),i=j.length-1;a.slice(-1)===`
`&&(j.length-=1);let l;for(let n=0,u=j.length;n<u;n++){let A=j[n],B=n===i?0:1;if(d===0){g.push(Qc(A,b(A,c),B));continue}n===0?l=e-f:l=e;if(A.length<=100){let J=b(A,c);if(J<=l){g.push(Qc(A,J,B));continue}}let D;d===1?D=A.split(" "):D=A;let G="",H="",L=0;for(let J=0,N=D.length;J<N;J++){let I=D[J];d===1?(G+=I,J<N-1&&(G+=" ")):G+=I;let V=b(G,c);V>l&&(J===0?g.push(Qc("",0,2)):(g.push(Qc(H,L,2)),G=I,d===1&&(J<N-1&&(G+=" ")),V=b(G,c)),l=e),H=G,L=V}g.push(Qc(H,L,B))}return g}let Qc=function(a,b,c){return{text:a,width:b,newLineMode:c}};var Xa;(function(a){a[a.left=0]="left",a[a.center=1]="center",a[a.right=2]="right"})(Xa||(Xa={}));var Ya;(function(a){a[a.top=0]="top",a[a.center=1]="center",a[a.bottom=2]="bottom"})(Ya||(Ya={}));class ch{constructor(){this.pens=[]}destroy(){this.pens.length=0}addPen(a){return this.pens.push(a),this}get firstPen(){return this.pens[0]}get lastPen(){return this.pens[this.pens.length-1]}hasPen(){return this.pens.length>0}get pensCount(){return this.pens.length}get startIndex(){let a=this.pens[0];return a?a.startIndex:0}get width(){let a=this.lastPen;return a?a.lastX:0}}function Qb(a,b=Array.isArray(a)?[]:{}){Ee(b);if(Array.isArray(a)){b.length=a.length;for(let c=0,d=a.length;c<d;c++)b[c]=a[c]}else for(let c in a)b[c]=a[c];return b}class dh{constructor(){this.text="";this.x=0;this.y=0;this.width=0;this.height=0;this.ascent=0;this.descent=0;this.prop={};this.newLineMode=va.none;this.startIndex=0}set(a="",b=0,c=0,d=0,e=0,f=0,g=0,j={},i=va.none,l=0){return this.text=a,this.x=b,this.y=c,this.width=d,this.height=e,this.ascent=f,this.descent=g,this.prop=j,this.newLineMode=i,this.startIndex=l,this}clone(){let a=new dh();return a.set(this.text,this.x,this.y,this.width,this.height,this.ascent,this.descent,Qb(this.prop),this.newLineMode,this.startIndex),a}get plainText(){return this.newLineMode===va.raw?`${this.text}
`:this.text}get wrapText(){return this.newLineMode!==va.none?`${this.text}
`:this.text}get plainTextLength(){let a=this.text.length;return this.newLineMode===va.raw&&(a+=1),a}get endIndex(){return this.startIndex+this.plainTextLength}get lastX(){return this.x+this.width}get isTextPen(){return this.text!==""}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}}class Nc{constructor({penPool:a}){this.pens=[];this.lines=[];this.pens=[],this.lines=[],this.penPool=a}destroy(){this.freePens()}freePens(){return this.penPool.pushMultiple(this.pens),this.lines.forEach(a=>{a.destroy()}),this.lines.length=0,this.maxLineWidth=0,this.totalLineHeight=0,this}addTextPen(a,b,c,d,e,f,g,j,i=va.none){let l=this.penPool.pop();return l==null&&(l=new dh()),l.set(a,b,c,d,e,f,g,j,i),this.addPen(l),this}addImagePen(a,b,c,d,e){return this.addTextPen("",a,b,c,d,d,0,e,va.none),this}addNewLinePen(a){let b=this.lastPen;return b&&b.newLineMode===va.none&&(b.newLineMode=a),this}addPen(a){let b=this.lastPen;b==null?a.startIndex=0:a.startIndex=b.endIndex,this.pens.push(a);let c=this.lastLine;return c==null&&(c=new ch(),this.lines.push(c)),c.addPen(a),a.newLineMode!==va.none&&(c=new ch(),this.lines.push(c)),this}clone(a){a==null&&(a=new Nc({penPool:this.penPool})),a.freePens();const b=this.pens;for(let e=0,f=b.length;e<f;e++)a.addPen(b[e].clone());const c=this.lines,d=a.lines;for(let e=0,f=c.length;e<f;e++){const g=c[e],j=d[e];j.y=g.y,j.height=g.height}return a}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(a){if(a>=this.lines.length)return this.getLineEndIndex(a);{let b=this.lines[a];if(!b)return 0;let c=b.firstPen;return c?c.startIndex:0}}getLineEndIndex(a){let b=this.lines.length;a>=b&&(a=b-1);for(let c=a;c>=0;c--){let d=this.lines[c];if(d&&d.hasPen())return d.lastPen.endIndex}return 0}getLineWidth(a){let b=this.lines[a];return b?b.width:0}getLineHeights(a=[]){return this.lines.forEach(function(b){a.push(b.height)}),a}get lineCount(){return this.lines.length}get plainText(){let a=[],b=this.pens;for(let c=0,d=b.length;c<d;c++)a.push(b[c].plainText);return a.join()}get plainTextLength(){let a=0;for(let b=0,c=this.pens.length;b<c;b++)a+=this.pens[b].plainTextLength;return a}getSliceTagText(a,b,c=0,d,e=!1){if(d===void 0){let l=this.lastPen;if(!l)return"";d=l.endIndex}let f=[],g;for(var j=0,i=this.pens.length;j<i;j++){let l=this.pens[j],n=l.endIndex;if(n<=c)continue;let u=e?l.wrapText:l.plainText,A=l.prop,B=l.startIndex,D=B>=c&&n<=d;D||(u=u.substring(c-B,d-B)),b?f.push(a.call(b,u,A,g)):f.push(a(u,A,g)),g=A;if(n>=d)break}return f.join()}}function _l(a,b,c){let d=Qb(a,c);for(let e in b)d.hasOwnProperty(e)&&(d[e]=b[e]);return d}function we(a,b,c={key:b}){c=_l(Oo,c);let d=Ka.get(),e=d.get(c.key);if(!e)return;let f=e.getFrame(c.frame);if(!f)return;let g=c.width,j=c.height;(g===void 0||j===void 0)&&(g===void 0&&j===void 0?(c.width=f.width,c.height=f.height):g===void 0?c.width=f.width*(j/f.height):j===void 0&&(c.height=f.height*(g/f.width))),a.images.set(b,c)}const Oo={key:void 0,frame:void 0,width:void 0,height:void 0,y:0,left:0,right:0,top:0,bottom:0};class Wl{constructor(){this.images=new Map()}destroy(){this.images.clear()}add(a,b){if(typeof a==="string")we(this,a,b);else if(Array.isArray(a)){let c=a;for(let d=0,e=c.length;d<e;d++)we(this,c[d])}else{let c=a;for(a in c)we(this,a,c[a])}return this}remove(a){return this.images.delete(a),this}get(a){return this.images.get(a)}getOuterWidth(a){let b=this.images.get(a);return b?b.width+b.left+b.right:0}getOuterHeight(a){let b=this.images.get(a);return b?b.height+b.top+b.bottom:0}getFrame(a){let b=this.images.get(a);if(!b)return;let c=Ka.get(),d=c.get(b.key);if(!d)return;let e=d.getFrame(b.frame);return e}hasTexture(a){return!!this.getFrame(a)}}function ue(a,b){a.font=b.font}function ve(a,b){a.textBaseline="alphabetic",a.textAlign="start",a.fillStyle=b.fillStyle,a.strokeStyle=b.strokeStyle,a.lineWidth=b.strokeThickness,a.lineCap="round",a.lineJoin="round",a.imageSmoothingEnabled=b.antialias}function ah(a,b,c){c?(a.shadowColor=b.shadowColor,a.shadowBlur=b.shadowBlur,a.shadowOffsetX=b.shadowOffsetX,a.shadowOffsetY=b.shadowOffsetY):(a.shadowColor="#000",a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0)}function $l(a,b){return b.measureText(a).width}function am(a,b,c=0){let d=b.measureText(a),e=d.actualBoundingBoxAscent,f=d.actualBoundingBoxDescent;return(!e&&!f||a==="")&&(e=c,f=0),Ae.ascent=e,Ae.descent=f,Ae.height=Math.ceil(Math.abs(e)+Math.abs(f)),Ae}let Ae={ascent:0,descent:0,height:0};function Xl(a,b,c,d,e){a.freePens();if(b==="")return a;let f=c.canvas,g=c.context,j=c.parent,i=c.parser.splitText(b),l,n,u=0;for(var A=0,B=i.length;A<B;A++){let J=c.parser.tagTextToProp(i[A],l),N=J.text;l=J.prop;if(l.img){let I,V;c.imageManager?(I=c.imageManager.getOuterWidth(l.img),V=c.imageManager.getOuterHeight(l.img)):(I=0,V=0),e>0&&d!==Da.none&&(e<u+I&&(a.addNewLinePen(va.wrapped),u=0)),a.addImagePen(u,0,I,V,Qb(l)),u+=I}else if(N!==""){g.save();let I=c.parser.propToStyle(j,l);ue(g,I),ve(g,I);let V=I.strokeThickness,W=V/2;n=bm(N,$l,g,d,e,u);let M=am("|MÃq",g);for(let q=0,r=n.length;q<r;q++){const h=n[q],m=M.height+V,k=M.ascent+W,p=M.descent+W;a.addTextPen(h.text,u,0,h.width,m,k,p,Qb(l),h.newLineMode),h.newLineMode!==va.none?u=0:u+=h.width}g.restore()}}let D=a.lines,G=c.parent.lineSpacing,H=0,L=0;for(let J=0,N=D.length;J<N;J++){const I=D[J],V=I.pens,W=V.length;let M=0,q=0;for(let m=0;m<W;m++){const k=V[m];M=Math.max(M,k.ascent),q=Math.max(q,k.descent)}const r=M+q,h=L+M;for(let m=0;m<W;m++)V[m].y+=h;I.y=h,I.height=r,H=Math.max(H,I.width),L+=r+G}return a.maxLineWidth=H,a.totalLineHeight=L-G,a}const oi={PI2:Math.PI*2,HALF_PI:Math.PI*.5,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};class No extends Ha{constructor(a,b,c,d,e){super(a,b,c,d);this.name=e}}class Zl{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return this.hitAreas.length=0,this}add(a,b,c,d,e){let f=new No(b,c,d,e,a);return this.hitAreas.push(f),this}getFirstHitArea(a,b){for(let c=0,d=this.hitAreas.length;c<d;c++){let e=this.hitAreas[c];if(e.contains(a,b))return e}return null}}function Yl(a,b,c,d,e,f=0,g=0,j=a.penManager){a.hitAreaManager&&a.hitAreaManager.clear();let i=j.totalLineHeight;if(i===0)return;const l=d<a.textWidth||e<a.textHeight;let n=a.context;n.save();let u=a.parent;Io(a,u),Jo(a,u),l&&(n.beginPath(),n.rect(b,c,d,e),n.clip());const A=u.hAlign,B=u.vAlign;let D=c+g;switch(B){case Ya.center:D+=(e-i)/2;break;case Ya.bottom:D+=e-i-2;break}let G=j.lines,H=D;const L=b+e;for(let J=0,N=G.length;J<N;J++){let I=G[J];if(H>L)break;const V=H+I.height;if(V<c){H=V;continue}let W=I.width;if(W===0){H=V;continue}let M=b+f;switch(A){case Xa.center:M+=(d-W)/2;break;case Xa.right:M+=d-W;break}let q=I.pens;for(let r=0,h=q.length;r<h;r++)Ho(a,q[r],M,D);H=V}n.restore()}function Ho(a,b,c,d){c+=b.x,d+=b.y;let e=a.canvas,f=a.context,g=a.parent;f.save();let j=a.parser.propToStyle(g,b.prop);ue(f,j),ve(f,j),j.underlineThickness>0&&b.width>0&&Ko(a,c,d,b.width,j),b.isTextPen&&Lo(a,c,d,b.text,j),b.isImagePen&&Mo(a,c,d,b.prop.img,j),f.restore(),b.hasAreaMarker&&b.width>0&&(a.hitAreaManager||(a.hitAreaManager=new Zl()),a.hitAreaManager.add(b.prop.area,c,d,b.width,b.height))}function Io(a,b){let c=a.canvas,d=a.context;d.clearRect(0,0,c.width,c.height)}function Jo(a,b){let c=a.canvas,d=a.context;d.clearRect(0,0,c.width,c.height);const e=b.backgroundFillStyle,f=b.backgroundStrokeStyle;if(e||f){const g=b.backgroundStrokeThickness,j=g/2,i=b.cornerRadius,l=j,n=j,u=c.width-g,A=c.height-g;bh(c,d,l,n,u,A,i,e,f,g)}else d.clearRect(0,0,c.width,c.height)}function Ko(a,b,c,d,e){c+=e.underlineOffsetY-e.underlineThickness/2;let f=a.context,g=f.lineCap;f.lineCap="butt",f.beginPath(),f.strokeStyle=e.underlineStyle,f.lineWidth=e.underlineThickness,f.moveTo(b,c),f.lineTo(b+d,c),f.stroke(),f.lineCap=g}function Lo(a,b,c,d,e){let f=a.context;e.strokeStyle&&e.strokeStyle!=="none"&&e.strokeThickness>0&&(ah(f,e,e.shadowStroke),f.strokeText(d,b,c)),e.fillStyle&&e.fillStyle!=="none"&&(ah(f,e,e.shadowFill),f.fillText(d,b,c))}function Mo(a,b,c,d,e){let f=a.imageManager;if(!f)return;let g=f.get(d),j=f.getFrame(d);b+=g.left,c+=g.y-g.height;let i=a.context;i.drawImage(j.texture.image,j.x,j.y,j.width,j.height,b,c,g.width,g.height)}class Nl{constructor({canvas:a,context:b,parent:c,parser:d,penPool:e=new Pb()}){this.textOffsetX=0;this.textOffsetY=0;this.canvas=a,this.context=b,this.parser=d,this.parent=c,this.penPool=e,this.penManager=new Nc({penPool:e})}destroy(){this.parser.destroy(),this.canvas=null,this.context=null,this.parser=null,this.parent=null,this.penManager&&(this.penManager.destroy(),this.penManager=null),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=null),this.imageManager&&(this.imageManager.destroy(),this.imageManager=null),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=null)}get textWidth(){return this.penManager.maxLineWidth}get textHeight(){return this.penManager.totalLineHeight}updatePenManager(a,b,c,d=this.penManager){return Xl(d,a,this,b,c)}draw(a,b,c,d,e=0,f=0){return Yl(this,a,b,c,d,e,f,this.penManager),this}get lines(){return this.penManager.lines}get tmpPenManager(){return this._tmpPenManager===null&&(this._tmpPenManager=new Nc({penPool:this.penPool})),this._tmpPenManager}getPlainText(a,b,c){let d;return a==null?d=this.penManager.plainText:d=this.parser.splitText(a,!0).join(""),(b!=null||c!=null)&&(b==null&&(b=0),c==null&&(c=d.length),d=d.substring(b,c)),d}getPenManager(a,b){return a===void 0?this.clonePenManager(b,this.penManager):(b===void 0&&(b=new Nc({penPool:this.penPool})),this.updatePenManager(a,this.parent.wrapMode,this.parent.wrapWidth,b),b)}getText(a,b,c,d){if(a==null)return this.penManager.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d);let e=this.tmpPenManager;return this.updatePenManager(a,this.parent.wrapMode,this.parent.wrapWidth,e),e.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d)}clonePenManager(a,b=this.penManager){return b.clone(a)}getLastPen(a=this.penManager){return a.lastPen}addImageInfo(a,b){return this.imageManager===void 0&&(this.imageManager=new Wl()),this.imageManager.add(a,b),this}}function Og(a){let b=a.canvasText;a.canvasText.updatePenManager(a.text,a.wrapMode,a.wrapWidth);let c=a.padding,d,e,f,g;a.fixedWidth===0?(d=b.textWidth,f=d+c.left+c.right):(f=a.fixedWidth,d=f-c.left-c.right,d>b.textWidth&&(d=b.textWidth)),a.fixedHeight===0?(e=b.textHeight,g=e+c.top+c.bottom):(g=a.fixedHeight,e=g-c.top-c.bottom,e>b.textHeight&&(e=b.textHeight));let j=a.resolution,i=Math.ceil(f*j),l=Math.ceil(g*j),n=a.canvas;(n.width!==i||n.height!==l)&&(n.width=i,n.height=l,a.texture.setSize(f,g),a.setSize(f,g));let u=a.context;u.save(),u.scale(j,j),b.draw(c.left,c.top,d,e,a.textOffsetX,a.textOffsetY),u.restore(),a.texture.binding&&a.texture.binding.update(),a.setDirty(aa.TEXTURE)}function re(a,b=0,c=0){a.fixedWidth=b,a.fixedHeight=c,te(a)}function Pg(a,b,c,d,e){const f=a.padding;if(typeof b==="number")f.left=b,f.right=c===void 0?b:c,f.top=d===void 0?b:d,f.bottom=e===void 0?b:e;else{let g=b;f.left=g.left??0,f.right=g.right??0,f.top=g.top??0,f.bottom=g.bottom??0}te(a)}function te(a){const b=a.fixedWidth;if(a.wrapMode!==Da.none){const c=a.padding,d=b-c.left-c.right;a.wrapWidth=Math.max(d,0)}else a.wrapWidth=0}function Ol(a,b){a.textOffsetY=b}function Qg(a,b=Xa.left){typeof b==="string"&&(b=Xa[b]),a.hAlign=b}function Rg(a,b=Ya.top){typeof b==="string"&&(b=Ya[b]),a.vAlign=b}function Sg(a,b=0){a.lineSpacing=b}function Tg(a,b,c,d=0,e=0){c||(d=0),a.backgroundFillStyle=b,a.backgroundStrokeStyle=c,a.backgroundStrokeThickness=d,a.cornerRadius=e}function Pl(a,b,c){b&&Ug(a,b),c&&Vg(a,c)}function Ug(a,b){a.fontFamily=b}function Vg(a,b){typeof b==="number"&&(b=`${b}px`),a.fontSize=b}function Wg(a,b){a.fillStyle=b}function Xg(a,b,c=2){a.strokeStyle=b,a.strokeThickness=c}function Yg(a,b="#000",c=5,d=0,e=0,f=!1,g=!1){a.shadowColor=b,a.shadowBlur=c,a.shadowOffsetX=d,a.shadowOffsetY=e,a.shadowFill=f,a.shadowStroke=g}function Zg(a,b,c){typeof b==="string"&&(b=Da[b]),a.wrapMode=b,c===void 0?te(a):a.wrapWidth=c}function _g(a,b,c=2,d=0){a.underlineStyle=b,a.underlineThickness=c,a.underlineOffsetY=d}function Ng(a,b,c){a.canvasText.addImageInfo(b,c)}function Ql(a,b,c,d){return b=a.canvasText.getText(b,c,d,!0),b.split($g)}function Rl(a,b,c,d){return a.canvasText.getPlainText(b,c,d)}function Sl(a,b,c,d){return a.canvasText.getText(b,c,d,!1)}function Tl(a,b,c,d){return a.canvasText.getText(b,c,d,!1)}function Ul(a,b){return a.canvasText.clonePenManager(b)}function Vl(a,b,c){return a.canvasText.getPenManager(b,c)}class se extends dd{constructor(a,b,c="",{width:d=0,height:e=0,padding:f,wrapMode:g=Da.none,backgroundFillStyle:j,backgroundStrokeStyle:i,backgroundStrokeThickness:l,cornerRadius:n=0,hAlign:u=Xa.left,vAlign:A=Ya.top,lineSpacing:B=0,fontFamily:D="monospace",fontSize:G="16px",fillStyle:H="#fff",strokeStyle:L,strokeThickness:J=1,shadowColor:N="#000",shadowBlur:I=4,shadowOffsetX:V=0,shadowOffsetY:W=0,shadowFill:M=!1,shadowStroke:q=!1,underlineStyle:r="#fff",underlineThickness:h=1,underlineOffsetY:m=0,images:k}={},p){super(a,b,Xb());this.antialias=!1;this.fontFamily="monospace";this.fontSize="16px";this.fillStyle="#fff";this.strokeThickness=1;this.shadowStroke=!1;this.shadowFill=!1;this.shadowColor="#000";this.shadowBlur=4;this.shadowOffsetX=0;this.shadowOffsetY=0;this.underlineStyle="#fff";this.underlineThickness=1;this.underlineOffsetY=0;this.hAlign=Xa.left;this.vAlign=Ya.top;this.lineSpacing=0;this.wrapMode=Da.none;this.wrapWidth=0;this.fixedWidth=0;this.fixedHeight=0;this.padding={left:0,right:0,top:0,bottom:0};this.textOffsetX=0;this.textOffsetY=0;this.type="rexText";const t=wa.get();this.resolution=t.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.canvasText=new Nl({canvas:this.canvas,context:this.context,parent:this,parser:p}),re(this,d,e),f&&Pg(this,f),Zg(this,g),Qg(this,u),Rg(this,A),Sg(this,B),Tg(this,j,i,l,n),Ug(this,D),Vg(this,G),Wg(this,H),L&&Xg(this,L,J),Yg(this,N,I,V,W,M,q),_g(this,r,h,m),k&&Ng(this,k),this.setText(c)}destroy(a){this.canvasText.destroy(),this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}updateText(){return Og(this),this}get text(){return this._text}set text(a){this.setText(a)}setText(a="",b=!0){return Array.isArray(a)&&(a=a.join(`
`)),a!==this._text&&(this._text=a.toString(),b&&this.updateText()),this}setBackgroundStyle(a,b,c=2,d=0){return Tg(this,a,b,c,d),this}setFixedSize(a,b){return re(this,a,b),this}setPadding(a,b,c,d){return Pg(this,a,b,c,d),this}setTextOffsetY(a){return Ol(this,a),this}setHAlign(a=Xa.left){return Qg(this,a),this}setVAlign(a=Ya.top){return Rg(this,a),this}setLineSpacing(a=0){return Sg(this,a),this}setFont(a,b){return Pl(this,a,b),this}setFillStyle(a){return Wg(this,a),this}setStrokeStyle(a,b=2){return Xg(this,a,b),this}setShadow(a="#000",b=5,c=0,d=0,e=!1,f=!1){return Yg(this,a,b,c,d,e,f),this}resize(a,b){return re(this,a,b),Og(this),this}setWrapMode(a,b=0){return Zg(this,a,b),this}setUnderline(a,b=2,c=0){return _g(this,a,b,c),this}addImageInfo(a,b){return Ng(this,a,b),this}getWrappedText(a,b,c){return Ql(this,a,b,c)}getPlainText(a,b,c){return Rl(this,a,b,c)}getText(a,b,c){return Sl(this,a,b,c)}getSubString(a,b,c){return Tl(this,a,b,c)}clonePenManager(a){return Ul(this,a)}getPenManager(a,b){return Vl(this,a,b)}}class xe{destroy(){}}const ye={text:null,prop:null},ze={font:void 0,fontFamily:void 0,fontStyle:void 0,fontSize:void 0,fillStyle:void 0,strokeStyle:void 0,strokeThickness:void 0,shadowColor:void 0,shadowOffsetX:void 0,shadowOffsetY:void 0,shadowBlur:void 0,shadowStroke:void 0,shadowFill:void 0,underlineStyle:void 0,underlineThickness:void 0,underlineOffsetY:void 0,image:void 0};class cm extends xe{splitText(a,b=!1){const c=[];let d=0;for(;;){const f=eh.exec(a);if(!f)break;const g=f[0],j=eh.lastIndex-g.length;d<j&&c.push(a.substring(d,j)),b||c.push(g),d=eh.lastIndex}const e=a.length;return d<e&&c.push(a.substring(d,e)),c}tagTextToProp(a,b){let c,d;b==null&&(b={}),b.img&&ta(b,gb,"img"),Ro.test(a)?(ta(b,Sa,"b",!0),c=""):So.test(a)?(ta(b,gb,"b"),c=""):To.test(a)?(ta(b,Sa,"i",!0),c=""):Uo.test(a)?(ta(b,gb,"i"),c=""):dm.test(a)?(d=a.match(dm),ta(b,Sa,"size",d[1]+"px"),c=""):Vo.test(a)?(ta(b,gb,"size"),c=""):em.test(a)?(d=a.match(em),ta(b,Sa,"color",d[1]),c=""):Wo.test(a)?(ta(b,gb,"color"),c=""):fm.test(a)?(d=a.match(fm),ta(b,Sa,"u",!0),c=""):gm.test(a)?(d=a.match(gm),ta(b,Sa,"u",d[1]),c=""):Xo.test(a)?(ta(b,gb,"u"),c=""):Yo.test(a)?(ta(b,Sa,"shadow",!0),c=""):hm.test(a)?(d=a.match(hm),ta(b,Sa,"shadow",d[1]),c=""):Zo.test(a)?(ta(b,gb,"shadow"),c=""):_o.test(a)?(ta(b,Sa,"stroke",!0),c=""):im.test(a)?(d=a.match(im),ta(b,Sa,"stroke",d[1]),c=""):$o.test(a)?(ta(b,gb,"stroke"),c=""):jm.test(a)?(d=a.match(jm),ta(b,Sa,"img",d[1]),c=""):ap.test(a)?(ta(b,gb,"img"),c=""):km.test(a)?(d=a.match(km),ta(b,Sa,"area",d[1]),c=""):bp.test(a)?(ta(b,gb,"area"),c=""):c=a;const e=ye;return e.text=c,e.prop=b,e}propToStyle(a,b){const c=ze;return b.hasOwnProperty("img")?c.image=b.img:(c.image=null,c.fontFamily=a.fontFamily,c.fontSize=b.size??a.fontSize,c.fontStyle=Po(b.b,b.i),c.font=`${c.fontStyle} ${c.fontSize} ${c.fontFamily}`,c.fillStyle=b.color??a.fillStyle,b.hasOwnProperty("stroke")?b.stroke===!0?(c.strokeStyle=a.strokeStyle,c.strokeThickness=a.strokeThickness):(c.strokeStyle=b.stroke,c.strokeThickness=a.strokeThickness):(c.strokeStyle=a.strokeStyle,c.strokeThickness=0)),b.hasOwnProperty("shadow")?b.shadow===!0?(c.shadowColor=a.shadowColor,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor=b.shadow,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor="#000",c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=0,c.shadowStroke=!1,c.shadowFill=!1),b.hasOwnProperty("u")?b.u===!0?(c.underlineStyle=a.underlineStyle,c.underlineThickness=a.underlineThickness,c.underlineOffsetY=a.underlineOffsetY):(c.underlineStyle=b.u,c.underlineThickness=a.underlineThickness,c.underlineOffsetY=a.underlineOffsetY):(c.underlineStyle="#000",c.underlineThickness=0,c.underlineOffsetY=0),c}propToTagText(a,b,c){c==null&&(c=Qo);let d=[];for(const f in c){if(b.hasOwnProperty(f))continue;d.push(`[/${f}]`)}a=`${d.join()}${a}`;let e=[];for(const f in b){if(c[f]===b[f])continue;switch(f){case"size":const g=b.size.replace("px","");e.push(`[size=${g}]`);break;case"color":case"img":case"area":e.push(`[${f}=${b[f]}]`);break;case"stroke":case"u":b[f]===!0?e.push(`[${f}]`):e.push(`[${f}=${b[f]}]`);break;default:e.push(`[${f}]`);break}}return a=`${a}${e.join()}`,a}}const ta=function(a,b,c,d){return b===Sa?a[c]=d:a.hasOwnProperty(c)&&delete a[c],a};var Po=function(a,b){return a&&b?"bold italic":a?"bold":b?"italic":""};const Qo={},eh=/\[b\]|\[\/b\]|\[i\]|\[\/i\]|\[size=(\d+)\]|\[\/size\]|\[color=([a-z]+|#[0-9abcdef]+)\]|\[\/color\]|\[u\]|\[u=([a-z]+|#[0-9abcdef]+)\]|\[\/u\]|\[shadow\]|\[shadow=([a-z]+|#[0-9abcdef]+)\]|\[\/shadow\]|\[stroke\]|\[stroke=([a-z]+|#[0-9abcdef]+)\]|\[\/stroke\]|\[img=([^\]]+)\]|\[\/img\]|\[area=([^\]]+)\]|\[\/area\]/ig;var Ro=/\[b\]/i,So=/\[\/b\]/i,To=/\[i\]/i,Uo=/\[\/i\]/i,dm=/\[size=(\d+)\]/i,Vo=/\[\/size\]/i,em=/\[color=([a-z]+|#[0-9abcdef]+)\]/i,Wo=/\[\/color\]/i,fm=/\[u\]/i,gm=/\[u=([a-z]+|#[0-9abcdef]+)\]/i,Xo=/\[\/u\]/i,Yo=/\[shadow\]/i,hm=/\[shadow=([a-z]+|#[0-9abcdef]+)\]/i,Zo=/\[\/shadow\]/i,_o=/\[stroke\]/i,im=/\[stroke=([a-z]+|#[0-9abcdef]+)\]/i,$o=/\[\/stroke\]/i,jm=/\[img=([^\]]+)\]/i,ap=/\[\/img\]/i,km=/\[area=([^\]]+)\]/i,bp=/\[\/area\]/i;const gb=!1,Sa=!0;class Tc extends se{constructor(a,b,c="",d){super(a,b,c,d,new cm());this.type="rexBBcodeText"}}class mm extends xe{constructor(a){super();this.tags=new Map();if(a)for(const b in a)this.addTag(b,a[b])}destroy(){this.tags.clear()}addTag(a,b){return this.tags.set(a,b),this}isTextTag(a){const b=this.tags.get(a);return b?b.img==null:!1}splitText(a,b=!1){const c=[];let d=0;for(;;){const f=fh.exec(a);if(!f)break;const g=f[0],j=fh.lastIndex-g.length;d<j&&c.push(a.substring(d,j));if(!b)c.push(g);else if(om.test(g)){const i=g.match(pm);c.push(i[2])}else if(qm.test(g)){const i=g.match(rm);c.push(i[2])}d=fh.lastIndex}const e=a.length;return d<e&&c.push(a.substring(d,e)),c}tagTextToProp(a,b){let c,d;if(om.test(a)){const f=a.match(pm);if(f!=null){const g=f[1],j=this.tags;d=j.get(g)??{},d._class=g,c=f[2]}}else if(qm.test(a)){const f=a.match(rm);if(f!=null){const g=f[1];d=cp(g),d._style=g,c=f[2]}}c===void 0&&(c=a),d===void 0&&(d={});const e=ye;return e.text=c,e.prop=d,e}propToStyle(a,b){const c=ze;if(b.hasOwnProperty("img"))c.image=b.img;else{c.image=null,c.fontFamily=b.family??b.fontFamily??b["font-family"]??a.fontFamily;let d=b.size??b.fontSize??b["font-size"]??a.fontSize;typeof d==="number"&&(d=`${d}px`),c.fontSize=d,c.fontStyle=b.style??b.fontStyle??b["font-style"]??"",c.font=`${c.fontStyle} ${c.fontSize} ${c.fontFamily}`,c.fillStyle=b.color??b["font-color"]??a.fillStyle;if(b.hasOwnProperty("stroke")){const e=b.stroke;c.strokeStyle=e.color??a.strokeStyle,c.strokeThickness=e.thinkness??a.strokeThickness}else c.strokeStyle=a.strokeStyle,c.strokeThickness=a.strokeThickness}if(b.hasOwnProperty("shadow")){const d=b.shadow;c.shadowColor=d.color??a.shadowColor,c.shadowOffsetX=d.offsetX??a.shadowOffsetX,c.shadowOffsetY=d.offsetY??a.shadowOffsetY,c.shadowBlur=d.blur??a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0}else c.shadowColor=a.shadowColor,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=a.shadowStroke,c.shadowFill=a.shadowFill;if(b.hasOwnProperty("u")||b.hasOwnProperty("underline")){const d=b.u??b.underline;c.underlineStyle=d.color??a.underlineStyle,c.underlineThickness=d.thinkness??a.underlineThickness,c.underlineOffsetY=d.offset??a.underlineOffsetY}else c.underlineStyle="#000",c.underlineThickness=0,c.underlineOffsetY=0;return c}propToTagText(a,b,c){if(b.hasOwnProperty("_class")){if(a===""){if(this.isTextTag(b._class))return""}return`<class=${b._class}>${a}</class>`}else if(b.hasOwnProperty("_style"))return`<style=${b._style}>${a}</style>`}}function cp(a){const b=a.split(";"),c={};for(var d=0,e=b.length;d<e;d++){const[f,g]=b[d].split(":");if(nm(f)||nm(g))continue;if(f==="stroke"){const j=g.split(" "),i={},l=j.length;l>=1&&(i.color=j[0]),l>=2&&(i.thinkness=parseInt(j[1].replace("px",""))),c.stroke=i}else if(f==="shadow"){const j=g.split(" "),i={},l=j.length;l>=1&&(i.color=j[0]),l>=2&&(i.offsetX=parseInt(j[1].replace("px",""))),l>=3&&(i.offsetY=parseInt(j[2].replace("px",""))),l>=4&&(i.blur=parseInt(j[3].replace("px",""))),c.shadow=i}else if(f==="u"||f==="underline"){const j=g.split(" "),i={},l=j.length;l>=1&&(i.color=j[0]),l>=2&&(i.thinkness=parseInt(j[1].replace("px",""))),l>=3&&(i.offset=parseInt(j[2].replace("px",""))),c[f]=i}else c[f]=g}return c}function nm(a){return a=a.replace(dp,""),a.length===0}const fh=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,om=/<\s*class=/i,pm=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,qm=/<\s*style=/i,rm=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,dp=/^\s+|\s+$/;class lm extends se{constructor(a,b,c="",d){const e=d?d.tags:void 0;super(a,b,c,d,new mm(e));this.type="rexTagText"}get parser(){return this.canvasText.parser}addTag(a,b){return this.parser.addTag(a,b),this}addTags(a){for(const b in a)this.parser.addTag(b,a[b]);return this}}var Hf;(function(a){a[a.ascending=0]="ascending",a[a.descending=1]="descending",a[a.logical_ascending=2]="logical_ascending",a[a.logical_descending=3]="logical_descending"})(Hf||(Hf={}));class Lm extends Ah{constructor(){super();Bh("dude","../assets/phaser-dude.png").load().then(()=>{this.create()})}create(){const a=new Le(this),b=`[size=30][color=red][i][u]Phaser[/i][img=dude][/u]\r
[size=20][color=blue][shadow=yellow][b]is[/b][/shadow]\r
[size=40][color=none][stroke=green]Fun`,c=new Tc(400,300,b,{backgroundStrokeStyle:"BurlyWood",backgroundStrokeThickness:4,cornerRadius:20,padding:10,images:["dude"]});Sc(a,c)}}new zh(Ke(),Je(800,600),He("game"),Ge(2960685),Ie(Lm));})();
/* @license
Papa Parse
v5.2.0
https://github.com/mholt/PapaParse
License: MIT
*/
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
//# sourceMappingURL=bundle.js.map

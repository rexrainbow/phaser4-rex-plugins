(()=>{var te=Object.defineProperty,il=Object.prototype.hasOwnProperty,db=(a,b)=>()=>(b||(b={exports:{}},a(b.exports,b)),b.exports),jl=a=>te(a,"__esModule",{value:!0}),Ob=(a,b)=>{jl(a);for(var c in b)te(a,c,{get:b[c],enumerable:!0})},Qn=(a,b)=>{jl(a);if(typeof b==="object"||typeof b==="function")for(let c in b)il.call(b,c)&&!il.call(a,c)&&c!=="default"&&te(a,c,{get:()=>b[c],enumerable:!0});return a},Ia=a=>a&&a.__esModule?a:Qn(te({},"default",{value:a,enumerable:!0}),a);var Bh=db((a,b)=>{!function(c,d){"function"==typeof define&&define.amd?define([],d):"object"==typeof b&&"undefined"!=typeof a?b.exports=d():c.Papa=d()}(a,function c(){"use strict";var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==d?d:{},e=!d.document&&!!d.postMessage,f=e&&/blob:/i.test((d.location||{}).protocol),g={},j=0,i={parse:function(q,r){var h=(r=r||{}).dynamicTyping||!1;M(h)&&(r.dynamicTypingFunction=h,h={});if(r.dynamicTyping=h,r.transform=!!M(r.transform)&&r.transform,r.worker&&i.WORKERS_SUPPORTED){var l=function(){if(!i.WORKERS_SUPPORTED)return!1;var p=(o=d.URL||d.webkitURL||null,D=c.toString(),i.BLOB_URL||(i.BLOB_URL=o.createObjectURL(new Blob(["(",D,")();"],{type:"text/javascript"})))),t=new d.Worker(p),o,D;return t.onmessage=I,t.id=j++,g[t.id]=t}();return l.userStep=r.step,l.userChunk=r.chunk,l.userComplete=r.complete,l.userError=r.error,r.step=M(r.step),r.chunk=M(r.chunk),r.complete=M(r.complete),r.error=M(r.error),delete r.worker,void l.postMessage({input:q,config:r,workerId:l.id})}var k=null;return i.NODE_STREAM_INPUT,"string"==typeof q?k=r.download?new u(r):new B(r):!0===q.readable&&M(q.read)&&M(q.on)?k=new E(r):(d.File&&q instanceof File||q instanceof Object)&&(k=new A(r)),k.stream(q)},unparse:function(q,r){var h=!1,l=!0,k=",",p=`\r
`,t='"',o=t+t,D=!1,F=null;!function(){if("object"!=typeof r)return;"string"!=typeof r.delimiter||i.BAD_DELIMITERS.filter(function(z){return-1!==r.delimiter.indexOf(z)}).length||(k=r.delimiter),("boolean"==typeof r.quotes||"function"==typeof r.quotes||Array.isArray(r.quotes))&&(h=r.quotes),"boolean"!=typeof r.skipEmptyLines&&"string"!=typeof r.skipEmptyLines||(D=r.skipEmptyLines),"string"==typeof r.newline&&(p=r.newline),"string"==typeof r.quoteChar&&(t=r.quoteChar),"boolean"==typeof r.header&&(l=r.header);if(Array.isArray(r.columns)){if(0===r.columns.length)throw new Error("Option columns is empty");F=r.columns}void 0!==r.escapeChar&&(o=r.escapeChar+t)}();var V=new RegExp(H(t),"g");"string"==typeof q&&(q=JSON.parse(q));if(Array.isArray(q)){if(!q.length||Array.isArray(q[0]))return W(null,q,D);if("object"==typeof q[0])return W(F||y(q[0]),q,D)}else if("object"==typeof q)return"string"==typeof q.data&&(q.data=JSON.parse(q.data)),Array.isArray(q.data)&&(q.fields||(q.fields=q.meta&&q.meta.fields),q.fields||(q.fields=Array.isArray(q.data[0])?q.fields:y(q.data[0])),Array.isArray(q.data[0])||"object"==typeof q.data[0]||(q.data=[q.data])),W(q.fields||[],q.data||[],D);throw new Error("Unable to serialize unrecognized input");function y(z){if("object"!=typeof z)return[];var J=[];for(var X in z)J.push(X);return J}function W(z,J,X){var ia="";"string"==typeof z&&(z=JSON.parse(z)),"string"==typeof J&&(J=JSON.parse(J));var na=Array.isArray(z)&&0<z.length,pa=!Array.isArray(J[0]);if(na&&l){for(var ma=0;ma<z.length;ma++)0<ma&&(ia+=k),ia+=O(z[ma],ma);0<J.length&&(ia+=p)}for(var T=0;T<J.length;T++){var ea=na?z.length:J[T].length,ja=!1,ka=na?0===Object.keys(J[T]).length:0===J[T].length;if(X&&!na&&(ja="greedy"===X?""===J[T].join("").trim():1===J[T].length&&0===J[T][0].length),"greedy"===X&&na){for(var R=[],S=0;S<ea;S++){var ga=pa?z[S]:S;R.push(J[T][ga])}ja=""===R.join("").trim()}if(!ja){for(var P=0;P<ea;P++){0<P&&!ka&&(ia+=k);var fa=na&&pa?z[P]:P;ia+=O(J[T][fa],P)}T<J.length-1&&(!X||0<ea&&!ka)&&(ia+=p)}}return ia}function O(z,J){if(null==z)return"";if(z.constructor===Date)return JSON.stringify(z).slice(1,25);var X=z.toString().replace(V,o),ia="boolean"==typeof h&&h||"function"==typeof h&&h(z,J)||Array.isArray(h)&&h[J]||function(na,pa){for(var ma=0;ma<pa.length;ma++)if(-1<na.indexOf(pa[ma]))return!0;return!1}(X,i.BAD_DELIMITERS)||-1<X.indexOf(k)||" "===X.charAt(0)||" "===X.charAt(X.length-1);return ia?t+X+t:X}}};if(i.RECORD_SEP=String.fromCharCode(30),i.UNIT_SEP=String.fromCharCode(31),i.BYTE_ORDER_MARK="ï»¿",i.BAD_DELIMITERS=["\r",`
`,'"',i.BYTE_ORDER_MARK],i.WORKERS_SUPPORTED=!e&&!!d.Worker,i.NODE_STREAM_INPUT=1,i.LocalChunkSize=10485760,i.RemoteChunkSize=5242880,i.DefaultDelimiter=",",i.Parser=K,i.ParserHandle=G,i.NetworkStreamer=u,i.FileStreamer=A,i.StringStreamer=B,i.ReadableStreamStreamer=E,d.jQuery){var m=d.jQuery;m.fn.parse=function(q){var r=q.config||{},h=[];return this.each(function(p){if(!("INPUT"===m(this).prop("tagName").toUpperCase()&&"file"===m(this).attr("type").toLowerCase()&&d.FileReader)||!this.files||0===this.files.length)return!0;for(var t=0;t<this.files.length;t++)h.push({file:this.files[t],inputElem:this,instanceConfig:m.extend({},r)})}),l(),this;function l(){if(0!==h.length){var p,t,o,D,F=h[0];if(M(q.before)){var V=q.before(F.file,F.inputElem);if("object"==typeof V){if("abort"===V.action)return p="AbortError",t=F.file,o=F.inputElem,D=V.reason,void(M(q.error)&&q.error({name:p},t,o,D));if("skip"===V.action)return void k();"object"==typeof V.config&&(F.instanceConfig=m.extend(F.instanceConfig,V.config))}else if("skip"===V)return void k()}var y=F.instanceConfig.complete;F.instanceConfig.complete=function(W){M(y)&&y(W,F.file,F.inputElem),k()},i.parse(F.file,F.instanceConfig)}else M(q.complete)&&q.complete()}function k(){h.splice(0,1),l()}}}function n(q){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(r){var h=_(r);h.chunkSize=parseInt(h.chunkSize),r.step||r.chunk||(h.chunkSize=null),this._handle=new G(h),(this._handle.streamer=this)._config=h}.call(this,q),this.parseChunk=function(r,h){if(this.isFirstChunk&&M(this._config.beforeFirstChunk)){var l=this._config.beforeFirstChunk(r);void 0!==l&&(r=l)}this.isFirstChunk=!1,this._halted=!1;var k=this._partialLine+r;this._partialLine="";var p=this._handle.parse(k,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var t=p.meta.cursor;this._finished||(this._partialLine=k.substring(t-this._baseIndex),this._baseIndex=t),p&&p.data&&(this._rowCount+=p.data.length);var o=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(f)d.postMessage({results:p,workerId:i.WORKER_ID,finished:o});else if(M(this._config.chunk)&&!h){if(this._config.chunk(p,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);p=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(p.data),this._completeResults.errors=this._completeResults.errors.concat(p.errors),this._completeResults.meta=p.meta),this._completed||!o||!M(this._config.complete)||p&&p.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),o||p&&p.meta.paused||this._nextChunk(),p}this._halted=!0},this._sendError=function(r){M(this._config.error)?this._config.error(r):f&&this._config.error&&d.postMessage({workerId:i.WORKER_ID,error:r,finished:!1})}}function u(q){var r;(q=q||{}).chunkSize||(q.chunkSize=i.RemoteChunkSize),n.call(this,q),this._nextChunk=e?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(h){this._input=h,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(r=new XMLHttpRequest(),this._config.withCredentials&&(r.withCredentials=this._config.withCredentials),e||(r.onload=Y(this._chunkLoaded,this),r.onerror=Y(this._chunkError,this)),r.open(this._config.downloadRequestBody?"POST":"GET",this._input,!e),this._config.downloadRequestHeaders){var h=this._config.downloadRequestHeaders;for(var l in h)r.setRequestHeader(l,h[l])}if(this._config.chunkSize){var k=this._start+this._config.chunkSize-1;r.setRequestHeader("Range","bytes="+this._start+"-"+k)}try{r.send(this._config.downloadRequestBody)}catch(p){this._chunkError(p.message)}e&&0===r.status&&this._chunkError()}},this._chunkLoaded=function(){4===r.readyState&&(r.status<200||400<=r.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:r.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(h){var l=h.getResponseHeader("Content-Range");return null===l?-1:parseInt(l.substring(l.lastIndexOf("/")+1))}(r),this.parseChunk(r.responseText)))},this._chunkError=function(h){var l=r.statusText||h;this._sendError(new Error(l))}}function A(q){var r,h;(q=q||{}).chunkSize||(q.chunkSize=i.LocalChunkSize),n.call(this,q);var l="undefined"!=typeof FileReader;this.stream=function(k){this._input=k,h=k.slice||k.webkitSlice||k.mozSlice,l?((r=new FileReader()).onload=Y(this._chunkLoaded,this),r.onerror=Y(this._chunkError,this)):r=new FileReaderSync(),this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var k=this._input;if(this._config.chunkSize){var p=Math.min(this._start+this._config.chunkSize,this._input.size);k=h.call(k,this._start,p)}var t=r.readAsText(k,this._config.encoding);l||this._chunkLoaded({target:{result:t}})},this._chunkLoaded=function(k){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(k.target.result)},this._chunkError=function(){this._sendError(r.error)}}function B(q){var r;n.call(this,q=q||{}),this.stream=function(h){return r=h,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var h,l=this._config.chunkSize;return l?(h=r.substring(0,l),r=r.substring(l)):(h=r,r=""),this._finished=!r,this.parseChunk(h)}}}function E(q){n.call(this,q=q||{});var r=[],h=!0,l=!1;this.pause=function(){n.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){n.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(k){this._input=k,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){l&&1===r.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),r.length?this.parseChunk(r.shift()):h=!0},this._streamData=Y(function(k){try{r.push("string"==typeof k?k:k.toString(this._config.encoding)),h&&(h=!1,this._checkIsFinished(),this.parseChunk(r.shift()))}catch(p){this._streamError(p)}},this),this._streamError=Y(function(k){this._streamCleanUp(),this._sendError(k)},this),this._streamEnd=Y(function(){this._streamCleanUp(),l=!0,this._streamData("")},this),this._streamCleanUp=Y(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function G(q){var r,h,l,k=Math.pow(2,53),p=-k,t=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)(e[-+]?\d+)?\s*$/,o=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,D=this,F=0,V=0,y=!1,W=!1,O=[],z={data:[],errors:[],meta:{}};if(M(q.step)){var J=q.step;q.step=function(T){if(z=T,na())ia();else{if(ia(),0===z.data.length)return;F+=T.data.length,q.preview&&F>q.preview?h.abort():(z.data=z.data[0],J(z,D))}}}function X(T){return"greedy"===q.skipEmptyLines?""===T.join("").trim():1===T.length&&0===T[0].length}function ia(){if(z&&l&&(ma("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+i.DefaultDelimiter+"'"),l=!1),q.skipEmptyLines)for(var T=0;T<z.data.length;T++)X(z.data[T])&&z.data.splice(T--,1);return na()&&function(){if(!z)return;function ea(ka){M(q.transformHeader)&&(ka=q.transformHeader(ka)),O.push(ka)}if(Array.isArray(z.data[0])){for(var ja=0;na()&&ja<z.data.length;ja++)z.data[ja].forEach(ea);z.data.splice(0,1)}else z.data.forEach(ea)}(),function(){if(!z||!q.header&&!q.dynamicTyping&&!q.transform)return z;function ea(ka,R){var S,ga=q.header?{}:[];for(S=0;S<ka.length;S++){var P=S,fa=ka[S];q.header&&(P=S>=O.length?"__parsed_extra":O[S]),q.transform&&(fa=q.transform(fa,P)),fa=pa(P,fa),"__parsed_extra"===P?(ga[P]=ga[P]||[],ga[P].push(fa)):ga[P]=fa}return q.header&&(S>O.length?ma("FieldMismatch","TooManyFields","Too many fields: expected "+O.length+" fields but parsed "+S,V+R):S<O.length&&ma("FieldMismatch","TooFewFields","Too few fields: expected "+O.length+" fields but parsed "+S,V+R)),ga}var ja=1;return!z.data.length||Array.isArray(z.data[0])?(z.data=z.data.map(ea),ja=z.data.length):z.data=ea(z.data,0),q.header&&z.meta&&(z.meta.fields=O),V+=ja,z}()}function na(){return q.header&&0===O.length}function pa(T,ea){return ja=T,q.dynamicTypingFunction&&void 0===q.dynamicTyping[ja]&&(q.dynamicTyping[ja]=q.dynamicTypingFunction(ja)),!0===(q.dynamicTyping[ja]||q.dynamicTyping)?"true"===ea||"TRUE"===ea||"false"!==ea&&"FALSE"!==ea&&(function(ka){if(t.test(ka)){var R=parseFloat(ka);if(p<R&&R<k)return!0}return!1}(ea)?parseFloat(ea):o.test(ea)?new Date(ea):""===ea?null:ea):ea;var ja}function ma(T,ea,ja,ka){var R={type:T,code:ea,message:ja};void 0!==ka&&(R.row=ka),z.errors.push(R)}this.parse=function(T,ea,ja){var ka=q.quoteChar||'"';if(q.newline||(q.newline=function(ga,P){ga=ga.substring(0,1048576);var fa=new RegExp(H(P)+"([^]*?)"+H(P),"gm"),Q=(ga=ga.replace(fa,"")).split("\r"),ta=ga.split(`
`),v=1<ta.length&&ta[0].length<Q[0].length;if(1===Q.length||v)return`
`;for(var s=0,x=0;x<Q.length;x++)`
`===Q[x][0]&&s++;return s>=Q.length/2?`\r
`:"\r"}(T,ka)),l=!1,q.delimiter)M(q.delimiter)&&(q.delimiter=q.delimiter(T),z.meta.delimiter=q.delimiter);else{var R=function(ga,P,fa,Q,ta){var v,s,x,C;ta=ta||[",","	","|",";",i.RECORD_SEP,i.UNIT_SEP];for(var w=0;w<ta.length;w++){var U=ta[w],$=0,Z=0,ha=0;x=void 0;for(var da=new K({comments:Q,delimiter:U,newline:P,preview:10}).parse(ga),sa=0;sa<da.data.length;sa++)if(fa&&X(da.data[sa]))ha++;else{var la=da.data[sa].length;Z+=la,void 0!==x?0<la&&($+=Math.abs(la-x),x=la):x=la}0<da.data.length&&(Z/=da.data.length-ha),(void 0===s||$<=s)&&(void 0===C||C<Z)&&1.99<Z&&(s=$,v=U,C=Z)}return{successful:!!(q.delimiter=v),bestDelimiter:v}}(T,q.newline,q.skipEmptyLines,q.comments,q.delimitersToGuess);R.successful?q.delimiter=R.bestDelimiter:(l=!0,q.delimiter=i.DefaultDelimiter),z.meta.delimiter=q.delimiter}var S=_(q);return q.preview&&q.header&&S.preview++,r=T,h=new K(S),z=h.parse(r,ea,ja),ia(),y?{meta:{paused:!0}}:z||{meta:{paused:!1}}},this.paused=function(){return y},this.pause=function(){y=!0,h.abort(),r=M(q.chunk)?"":r.substring(h.getCharIndex())},this.resume=function(){D.streamer._halted?(y=!1,D.streamer.parseChunk(r,!0)):setTimeout(D.resume,3)},this.aborted=function(){return W},this.abort=function(){W=!0,h.abort(),z.meta.aborted=!0,M(q.complete)&&q.complete(z),r=""}}function H(q){return q.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function K(q){var r,h=(q=q||{}).delimiter,l=q.newline,k=q.comments,p=q.step,t=q.preview,o=q.fastMode,D=r=void 0===q.quoteChar?'"':q.quoteChar;if(void 0!==q.escapeChar&&(D=q.escapeChar),("string"!=typeof h||-1<i.BAD_DELIMITERS.indexOf(h))&&(h=","),k===h)throw new Error("Comment character same as delimiter");!0===k?k="#":("string"!=typeof k||-1<i.BAD_DELIMITERS.indexOf(k))&&(k=!1),`
`!==l&&"\r"!==l&&`\r
`!==l&&(l=`
`);var F=0,V=!1;this.parse=function(y,W,O){if("string"!=typeof y)throw new Error("Input must be a string");var z=y.length,J=h.length,X=l.length,ia=k.length,na=M(p),pa=[],ma=[],T=[],ea=F=0;if(!y)return w();if(o||!1!==o&&-1===y.indexOf(r)){for(var ja=y.split(l),ka=0;ka<ja.length;ka++){if(T=ja[ka],F+=T.length,ka!==ja.length-1)F+=l.length;else if(O)return w();if(!k||T.substring(0,ia)!==k){if(na){if(pa=[],v(T.split(h)),U(),V)return w()}else v(T.split(h));if(t&&t<=ka)return pa=pa.slice(0,t),w(!0)}}return w()}for(var R=y.indexOf(h,F),S=y.indexOf(l,F),ga=new RegExp(H(D)+H(r),"g"),P=y.indexOf(r,F);;)if(y[F]!==r)if(k&&0===T.length&&y.substring(F,F+ia)===k){if(-1===S)return w();F=S+X,S=y.indexOf(l,F),R=y.indexOf(h,F)}else{if(-1!==R&&(R<S||-1===S)){if(!(R<P)){T.push(y.substring(F,R)),F=R+J,R=y.indexOf(h,F);continue}var fa=$(R,P,S);if(fa&&void 0!==fa.nextDelim){R=fa.nextDelim,P=fa.quoteSearch,T.push(y.substring(F,R)),F=R+J,R=y.indexOf(h,F);continue}}if(-1===S)break;if(T.push(y.substring(F,S)),C(S+X),na&&(U(),V))return w();if(t&&pa.length>=t)return w(!0)}else for(P=F,F++;;){if(-1===(P=y.indexOf(r,P+1)))return O||ma.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:pa.length,index:F}),x();if(P===z-1)return x(y.substring(F,P).replace(ga,r));if(r!==D||y[P+1]!==D){if(r===D||0===P||y[P-1]!==D){-1!==R&&R<P+1&&(R=y.indexOf(h,P+1)),-1!==S&&S<P+1&&(S=y.indexOf(l,P+1));var Q=s(-1===S?R:Math.min(R,S));if(y[P+1+Q]===h){T.push(y.substring(F,P).replace(ga,r)),y[F=P+1+Q+J]!==r&&(P=y.indexOf(r,F)),R=y.indexOf(h,F),S=y.indexOf(l,F);break}var ta=s(S);if(y.substring(P+1+ta,P+1+ta+X)===l){if(T.push(y.substring(F,P).replace(ga,r)),C(P+1+ta+X),R=y.indexOf(h,F),P=y.indexOf(r,F),na&&(U(),V))return w();if(t&&pa.length>=t)return w(!0);break}ma.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:pa.length,index:F}),P++}}else P++}return x();function v(Z){pa.push(Z),ea=F}function s(Z){var ha=0;if(-1!==Z){var da=y.substring(P+1,Z);da&&""===da.trim()&&(ha=da.length)}return ha}function x(Z){return O||(void 0===Z&&(Z=y.substring(F)),T.push(Z),F=z,v(T),na&&U()),w()}function C(Z){F=Z,v(T),T=[],S=y.indexOf(l,F)}function w(Z){return{data:pa,errors:ma,meta:{delimiter:h,linebreak:l,aborted:V,truncated:!!Z,cursor:ea+(W||0)}}}function U(){p(w()),pa=[],ma=[]}function $(Z,ha,da){var sa={nextDelim:void 0,quoteSearch:void 0},la=y.indexOf(r,ha+1);if(ha<Z&&Z<la&&(la<da||-1===da)){var xa=y.indexOf(h,la);if(-1===xa)return sa;la<xa&&(la=y.indexOf(r,la+1)),sa=$(xa,la,da)}else sa={nextDelim:Z,quoteSearch:ha};return sa}},this.abort=function(){V=!0},this.getCharIndex=function(){return F}}function I(q){var r=q.data,h=g[r.workerId],l=!1;if(r.error)h.userError(r.error,r.file);else if(r.results&&r.results.data){var k={abort:function(){l=!0,N(r.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:L,resume:L};if(M(h.userStep)){for(var p=0;p<r.results.data.length&&(h.userStep({data:r.results.data[p],errors:r.results.errors,meta:r.results.meta},k),!l);p++);delete r.results}else M(h.userChunk)&&(h.userChunk(r.results,k,r.file),delete r.results)}r.finished&&!l&&N(r.workerId,r.results)}function N(q,r){var h=g[q];M(h.userComplete)&&h.userComplete(r),h.terminate(),delete g[q]}function L(){throw new Error("Not implemented.")}function _(q){if("object"!=typeof q||null===q)return q;var r=Array.isArray(q)?[]:{};for(var h in q)r[h]=_(q[h]);return r}function Y(q,r){return function(){q.apply(r,arguments)}}function M(q){return"function"==typeof q}return f&&(d.onmessage=function(q){var r=q.data;void 0===i.WORKER_ID&&r&&(i.WORKER_ID=r.workerId);if("string"==typeof r.input)d.postMessage({workerId:i.WORKER_ID,results:i.parse(r.input,r.config),finished:!0});else if(d.File&&r.input instanceof File||r.input instanceof Object){var h=i.parse(r.input,r.config);h&&d.postMessage({workerId:i.WORKER_ID,results:h,finished:!0})}}),(u.prototype=Object.create(n.prototype)).constructor=u,(A.prototype=Object.create(n.prototype)).constructor=A,(B.prototype=Object.create(B.prototype)).constructor=B,(E.prototype=Object.create(n.prototype)).constructor=E,i})});var qg=db(q=>{Ob(q,{__assign:()=>c,__asyncDelegator:()=>K,__asyncGenerator:()=>H,__asyncValues:()=>I,__await:()=>G,__awaiter:()=>j,__classPrivateFieldGet:()=>Y,__classPrivateFieldSet:()=>M,__createBinding:()=>m,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>_,__importStar:()=>L,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>A,__rest:()=>d,__spread:()=>B,__spreadArrays:()=>E,__values:()=>u});var a=function(h,l){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,p){k.__proto__=p}||function(k,p){for(var t in p)p.hasOwnProperty(t)&&(k[t]=p[t])},a(h,l)};function b(h,l){a(h,l);function k(){this.constructor=h}h.prototype=l===null?Object.create(l):(k.prototype=l.prototype,new k())}var c=function(){return c=Object.assign||function h(l){for(var k,p=1,t=arguments.length;p<t;p++){k=arguments[p];for(var o in k)Object.prototype.hasOwnProperty.call(k,o)&&(l[o]=k[o])}return l},c.apply(this,arguments)};function d(h,l){var k={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&l.indexOf(p)<0&&(k[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var t=0,p=Object.getOwnPropertySymbols(h);t<p.length;t++)l.indexOf(p[t])<0&&Object.prototype.propertyIsEnumerable.call(h,p[t])&&(k[p[t]]=h[p[t]]);return k}function e(h,l,k,p){var t=arguments.length,o=t<3?l:p===null?p=Object.getOwnPropertyDescriptor(l,k):p,D;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(h,l,k,p);else for(var F=h.length-1;F>=0;F--)(D=h[F])&&(o=(t<3?D(o):t>3?D(l,k,o):D(l,k))||o);return t>3&&o&&Object.defineProperty(l,k,o),o}function f(h,l){return function(k,p){l(k,p,h)}}function g(h,l){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,l)}function j(h,l,k,p){function t(o){return o instanceof k?o:new k(function(D){D(o)})}return new(k||(k=Promise))(function(o,D){function F(W){try{y(p.next(W))}catch(O){D(O)}}function V(W){try{y(p.throw(W))}catch(O){D(O)}}function y(W){W.done?o(W.value):t(W.value).then(F,V)}y((p=p.apply(h,l||[])).next())})}function i(h,l){var k={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},p,t,o,D;return D={next:F(0),throw:F(1),return:F(2)},typeof Symbol==="function"&&(D[Symbol.iterator]=function(){return this}),D;function F(y){return function(W){return V([y,W])}}function V(y){if(p)throw new TypeError("Generator is already executing.");for(;k;)try{if(p=1,t&&(o=y[0]&2?t.return:y[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,y[1])).done)return o;(t=0,o)&&(y=[y[0]&2,o.value]);switch(y[0]){case 0:case 1:o=y;break;case 4:return k.label++,{value:y[1],done:!1};case 5:k.label++,t=y[1],y=[0];continue;case 7:y=k.ops.pop(),k.trys.pop();continue;default:if(!(o=k.trys,o=o.length>0&&o[o.length-1])&&(y[0]===6||y[0]===2)){k=0;continue}if(y[0]===3&&(!o||y[1]>o[0]&&y[1]<o[3])){k.label=y[1];break}if(y[0]===6&&k.label<o[1]){k.label=o[1],o=y;break}if(o&&k.label<o[2]){k.label=o[2],k.ops.push(y);break}o[2]&&k.ops.pop(),k.trys.pop();continue}y=l.call(h,k)}catch(W){y=[6,W],t=0}finally{p=o=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}function m(h,l,k,p){p===void 0&&(p=k),h[p]=l[k]}function n(h,l){for(var k in h)k!=="default"&&!l.hasOwnProperty(k)&&(l[k]=h[k])}function u(h){var l=typeof Symbol==="function"&&Symbol.iterator,k=l&&h[l],p=0;if(k)return k.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")}function A(h,l){var k=typeof Symbol==="function"&&h[Symbol.iterator];if(!k)return h;var p=k.call(h),t,o=[],D;try{for(;(l===void 0||l-- >0)&&!(t=p.next()).done;)o.push(t.value)}catch(F){D={error:F}}finally{try{t&&!t.done&&(k=p.return)&&k.call(p)}finally{if(D)throw D.error}}return o}function B(){for(var h=[],l=0;l<arguments.length;l++)h=h.concat(A(arguments[l]));return h}function E(){for(var h=0,l=0,k=arguments.length;l<k;l++)h+=arguments[l].length;for(var p=Array(h),t=0,l=0;l<k;l++)for(var o=arguments[l],D=0,F=o.length;D<F;D++,t++)p[t]=o[D];return p}function G(h){return this instanceof G?(this.v=h,this):new G(h)}function H(h,l,k){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=k.apply(h,l||[]),t,o=[];return t={},D("next"),D("throw"),D("return"),t[Symbol.asyncIterator]=function(){return this},t;function D(z){p[z]&&(t[z]=function(J){return new Promise(function(X,ia){o.push([z,J,X,ia])>1||F(z,J)})})}function F(z,J){try{V(p[z](J))}catch(X){O(o[0][3],X)}}function V(z){z.value instanceof G?Promise.resolve(z.value.v).then(y,W):O(o[0][2],z)}function y(z){F("next",z)}function W(z){F("throw",z)}function O(z,J){(z(J),o.shift(),o.length)&&F(o[0][0],o[0][1])}}function K(h){var l,k;return l={},p("next"),p("throw",function(t){throw t}),p("return"),l[Symbol.iterator]=function(){return this},l;function p(t,o){l[t]=h[t]?function(D){return(k=!k)?{value:G(h[t](D)),done:t==="return"}:o?o(D):D}:o}}function I(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l=h[Symbol.asyncIterator],k;return l?l.call(h):(h=typeof u==="function"?u(h):h[Symbol.iterator](),k={},p("next"),p("throw"),p("return"),k[Symbol.asyncIterator]=function(){return this},k);function p(o){k[o]=h[o]&&function(D){return new Promise(function(F,V){D=h[o](D),t(F,V,D.done,D.value)})}}function t(o,D,F,V){Promise.resolve(V).then(function(y){o({value:y,done:F})},D)}}function N(h,l){return Object.defineProperty?Object.defineProperty(h,"raw",{value:l}):h.raw=l,h}function L(h){if(h&&h.__esModule)return h;var l={};if(h!=null)for(var k in h)Object.hasOwnProperty.call(h,k)&&(l[k]=h[k]);return l.default=h,l}function _(h){return h&&h.__esModule?h:{default:h}}function Y(h,l){if(!l.has(h))throw new TypeError("attempted to get private field on non-instance");return l.get(h)}function M(h,l,k){if(!l.has(h))throw new TypeError("attempted to set private field on non-instance");return l.set(h,k),k}});var ug=db(q=>{Ob(q,{__assign:()=>c,__asyncDelegator:()=>K,__asyncGenerator:()=>H,__asyncValues:()=>I,__await:()=>G,__awaiter:()=>j,__classPrivateFieldGet:()=>Y,__classPrivateFieldSet:()=>M,__createBinding:()=>m,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>_,__importStar:()=>L,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>A,__rest:()=>d,__spread:()=>B,__spreadArrays:()=>E,__values:()=>u});var a=function(h,l){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,p){k.__proto__=p}||function(k,p){for(var t in p)p.hasOwnProperty(t)&&(k[t]=p[t])},a(h,l)};function b(h,l){a(h,l);function k(){this.constructor=h}h.prototype=l===null?Object.create(l):(k.prototype=l.prototype,new k())}var c=function(){return c=Object.assign||function h(l){for(var k,p=1,t=arguments.length;p<t;p++){k=arguments[p];for(var o in k)Object.prototype.hasOwnProperty.call(k,o)&&(l[o]=k[o])}return l},c.apply(this,arguments)};function d(h,l){var k={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&l.indexOf(p)<0&&(k[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var t=0,p=Object.getOwnPropertySymbols(h);t<p.length;t++)l.indexOf(p[t])<0&&Object.prototype.propertyIsEnumerable.call(h,p[t])&&(k[p[t]]=h[p[t]]);return k}function e(h,l,k,p){var t=arguments.length,o=t<3?l:p===null?p=Object.getOwnPropertyDescriptor(l,k):p,D;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(h,l,k,p);else for(var F=h.length-1;F>=0;F--)(D=h[F])&&(o=(t<3?D(o):t>3?D(l,k,o):D(l,k))||o);return t>3&&o&&Object.defineProperty(l,k,o),o}function f(h,l){return function(k,p){l(k,p,h)}}function g(h,l){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,l)}function j(h,l,k,p){function t(o){return o instanceof k?o:new k(function(D){D(o)})}return new(k||(k=Promise))(function(o,D){function F(W){try{y(p.next(W))}catch(O){D(O)}}function V(W){try{y(p.throw(W))}catch(O){D(O)}}function y(W){W.done?o(W.value):t(W.value).then(F,V)}y((p=p.apply(h,l||[])).next())})}function i(h,l){var k={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},p,t,o,D;return D={next:F(0),throw:F(1),return:F(2)},typeof Symbol==="function"&&(D[Symbol.iterator]=function(){return this}),D;function F(y){return function(W){return V([y,W])}}function V(y){if(p)throw new TypeError("Generator is already executing.");for(;k;)try{if(p=1,t&&(o=y[0]&2?t.return:y[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,y[1])).done)return o;(t=0,o)&&(y=[y[0]&2,o.value]);switch(y[0]){case 0:case 1:o=y;break;case 4:return k.label++,{value:y[1],done:!1};case 5:k.label++,t=y[1],y=[0];continue;case 7:y=k.ops.pop(),k.trys.pop();continue;default:if(!(o=k.trys,o=o.length>0&&o[o.length-1])&&(y[0]===6||y[0]===2)){k=0;continue}if(y[0]===3&&(!o||y[1]>o[0]&&y[1]<o[3])){k.label=y[1];break}if(y[0]===6&&k.label<o[1]){k.label=o[1],o=y;break}if(o&&k.label<o[2]){k.label=o[2],k.ops.push(y);break}o[2]&&k.ops.pop(),k.trys.pop();continue}y=l.call(h,k)}catch(W){y=[6,W],t=0}finally{p=o=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}function m(h,l,k,p){p===void 0&&(p=k),h[p]=l[k]}function n(h,l){for(var k in h)k!=="default"&&!l.hasOwnProperty(k)&&(l[k]=h[k])}function u(h){var l=typeof Symbol==="function"&&Symbol.iterator,k=l&&h[l],p=0;if(k)return k.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")}function A(h,l){var k=typeof Symbol==="function"&&h[Symbol.iterator];if(!k)return h;var p=k.call(h),t,o=[],D;try{for(;(l===void 0||l-- >0)&&!(t=p.next()).done;)o.push(t.value)}catch(F){D={error:F}}finally{try{t&&!t.done&&(k=p.return)&&k.call(p)}finally{if(D)throw D.error}}return o}function B(){for(var h=[],l=0;l<arguments.length;l++)h=h.concat(A(arguments[l]));return h}function E(){for(var h=0,l=0,k=arguments.length;l<k;l++)h+=arguments[l].length;for(var p=Array(h),t=0,l=0;l<k;l++)for(var o=arguments[l],D=0,F=o.length;D<F;D++,t++)p[t]=o[D];return p}function G(h){return this instanceof G?(this.v=h,this):new G(h)}function H(h,l,k){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=k.apply(h,l||[]),t,o=[];return t={},D("next"),D("throw"),D("return"),t[Symbol.asyncIterator]=function(){return this},t;function D(z){p[z]&&(t[z]=function(J){return new Promise(function(X,ia){o.push([z,J,X,ia])>1||F(z,J)})})}function F(z,J){try{V(p[z](J))}catch(X){O(o[0][3],X)}}function V(z){z.value instanceof G?Promise.resolve(z.value.v).then(y,W):O(o[0][2],z)}function y(z){F("next",z)}function W(z){F("throw",z)}function O(z,J){(z(J),o.shift(),o.length)&&F(o[0][0],o[0][1])}}function K(h){var l,k;return l={},p("next"),p("throw",function(t){throw t}),p("return"),l[Symbol.iterator]=function(){return this},l;function p(t,o){l[t]=h[t]?function(D){return(k=!k)?{value:G(h[t](D)),done:t==="return"}:o?o(D):D}:o}}function I(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l=h[Symbol.asyncIterator],k;return l?l.call(h):(h=typeof u==="function"?u(h):h[Symbol.iterator](),k={},p("next"),p("throw"),p("return"),k[Symbol.asyncIterator]=function(){return this},k);function p(o){k[o]=h[o]&&function(D){return new Promise(function(F,V){D=h[o](D),t(F,V,D.done,D.value)})}}function t(o,D,F,V){Promise.resolve(V).then(function(y){o({value:y,done:F})},D)}}function N(h,l){return Object.defineProperty?Object.defineProperty(h,"raw",{value:l}):h.raw=l,h}function L(h){if(h&&h.__esModule)return h;var l={};if(h!=null)for(var k in h)Object.hasOwnProperty.call(h,k)&&(l[k]=h[k]);return l.default=h,l}function _(h){return h&&h.__esModule?h:{default:h}}function Y(h,l){if(!l.has(h))throw new TypeError("attempted to get private field on non-instance");return l.get(h)}function M(h,l,k){if(!l.has(h))throw new TypeError("attempted to set private field on non-instance");return l.set(h,k),k}});var Be=db(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});var a=ug();var b={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};var c=function(v,s){if(!v)throw d(s)},d=function(v){return new Error("Firebase Database ("+b.SDK_VERSION+") INTERNAL ASSERT FAILED: "+v)};var e=function(v){for(var s=[],x=0,C=0;C<v.length;C++){var w=v.charCodeAt(C);w<128?s[x++]=w:w<2048?(s[x++]=w>>6|192,s[x++]=w&63|128):(w&64512)===55296&&C+1<v.length&&(v.charCodeAt(C+1)&64512)===56320?(w=65536+((w&1023)<<10)+(v.charCodeAt(++C)&1023),s[x++]=w>>18|240,s[x++]=w>>12&63|128,s[x++]=w>>6&63|128,s[x++]=w&63|128):(s[x++]=w>>12|224,s[x++]=w>>6&63|128,s[x++]=w&63|128)}return s},f=function(v){for(var s=[],x=0,C=0;x<v.length;){var w=v[x++];if(w<128)s[C++]=String.fromCharCode(w);else if(w>191&&w<224){var U=v[x++];s[C++]=String.fromCharCode((w&31)<<6|U&63)}else if(w>239&&w<365){var U=v[x++],$=v[x++],Z=v[x++],ha=((w&7)<<18|(U&63)<<12|($&63)<<6|Z&63)-65536;s[C++]=String.fromCharCode(55296+(ha>>10)),s[C++]=String.fromCharCode(56320+(ha&1023))}else{var U=v[x++],$=v[x++];s[C++]=String.fromCharCode((w&15)<<12|(U&63)<<6|$&63)}}return s.join("")},g={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob==="function",encodeByteArray:function(v,s){if(!Array.isArray(v))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var x=s?this.byteToCharMapWebSafe_:this.byteToCharMap_,C=[],w=0;w<v.length;w+=3){var U=v[w],$=w+1<v.length,Z=$?v[w+1]:0,ha=w+2<v.length,da=ha?v[w+2]:0,sa=U>>2,la=(U&3)<<4|Z>>4,xa=(Z&15)<<2|da>>6,ue=da&63;ha||(ue=64,$||(xa=64)),C.push(x[sa],x[la],x[xa],x[ue])}return C.join("")},encodeString:function(v,s){return this.HAS_NATIVE_SUPPORT&&!s?btoa(v):this.encodeByteArray(e(v),s)},decodeString:function(v,s){return this.HAS_NATIVE_SUPPORT&&!s?atob(v):f(this.decodeStringToByteArray(v,s))},decodeStringToByteArray:function(v,s){this.init_();for(var x=s?this.charToByteMapWebSafe_:this.charToByteMap_,C=[],w=0;w<v.length;){var U=x[v.charAt(w++)],$=w<v.length,Z=$?x[v.charAt(w)]:0;++w;var ha=w<v.length,da=ha?x[v.charAt(w)]:64;++w;var sa=w<v.length,la=sa?x[v.charAt(w)]:64;++w;if(U==null||Z==null||da==null||la==null)throw Error();var xa=U<<2|Z>>4;C.push(xa);if(da!==64){var ue=Z<<4&240|da>>2;C.push(ue);if(la!==64){var Rn=da<<6&192|la;C.push(Rn)}}}return C},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var v=0;v<this.ENCODED_VALS.length;v++)this.byteToCharMap_[v]=this.ENCODED_VALS.charAt(v),this.charToByteMap_[this.byteToCharMap_[v]]=v,this.byteToCharMapWebSafe_[v]=this.ENCODED_VALS_WEBSAFE.charAt(v),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[v]]=v,v>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(v)]=v,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(v)]=v)}}},j=function(v){var s=e(v);return g.encodeByteArray(s,!0)},i=function(v){try{return g.decodeString(v,!0)}catch(s){console.error("base64Decode failed: ",s)}return null};function m(v){return n(void 0,v)}function n(v,s){if(!(s instanceof Object))return s;switch(s.constructor){case Date:var x=s;return new Date(x.getTime());case Object:v===void 0&&(v={});break;case Array:v=[];break;default:return s}for(var C in s){if(!s.hasOwnProperty(C))continue;v[C]=n(v[C],s[C])}return v}var u=function(){function v(){var s=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(x,C){s.resolve=x,s.reject=C})}return v.prototype.wrapCallback=function(s){var x=this;return function(C,w){C?x.reject(C):x.resolve(w),typeof s==="function"&&(x.promise.catch(function(){}),s.length===1?s(C):s(C,w))}},v}();function A(){return typeof navigator!=="undefined"&&typeof navigator.userAgent==="string"?navigator.userAgent:""}function B(){return typeof window!=="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(A())}function E(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(v){return!1}}function G(){return typeof self==="object"&&self.self===self}function H(){var v=typeof chrome==="object"?chrome.runtime:typeof browser==="object"?browser.runtime:void 0;return typeof v==="object"&&v.id!==void 0}function K(){return typeof navigator==="object"&&navigator.product==="ReactNative"}function I(){return A().indexOf("Electron/")>=0}function N(){var v=A();return v.indexOf("MSIE ")>=0||v.indexOf("Trident/")>=0}function L(){return A().indexOf("MSAppHost/")>=0}function _(){return b.NODE_CLIENT===!0||b.NODE_ADMIN===!0}function Y(){return!E()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}var M="FirebaseError",q=function(v){a.__extends(s,v);function s(x,C){var w=v.call(this,C)||this;return w.code=x,w.name=M,Object.setPrototypeOf(w,s.prototype),Error.captureStackTrace&&Error.captureStackTrace(w,r.prototype.create),w}return s}(Error),r=function(){function v(s,x,C){this.service=s,this.serviceName=x,this.errors=C}return v.prototype.create=function(s){for(var x=[],C=1;C<arguments.length;C++)x[C-1]=arguments[C];for(var w=x[0]||{},U=this.service+"/"+s,$=this.errors[s],Z=$?h($,w):"Error",ha=this.serviceName+": "+Z+" ("+U+").",da=new q(U,ha),sa=0,la=Object.keys(w);sa<la.length;sa++){var xa=la[sa];xa.slice(-1)!=="_"&&(xa in da&&console.warn('Overwriting FirebaseError base field "'+xa+'" can cause unexpected behavior.'),da[xa]=w[xa])}return da},v}();function h(v,s){return v.replace(l,function(x,C){var w=s[C];return w!=null?String(w):"<"+C+"?>"})}var l=/\{\$([^}]+)}/g;function k(v){return JSON.parse(v)}function p(v){return JSON.stringify(v)}var t=function(v){var s={},x={},C={},w="";try{var U=v.split(".");s=k(i(U[0])||""),x=k(i(U[1])||""),w=U[2],C=x.d||{},delete x.d}catch($){}return{header:s,claims:x,data:C,signature:w}},o=function(v){var s=t(v).claims,x=Math.floor(new Date().getTime()/1e3),C=0,w=0;return typeof s==="object"&&(s.hasOwnProperty("nbf")?C=s.nbf:s.hasOwnProperty("iat")&&(C=s.iat),s.hasOwnProperty("exp")?w=s.exp:w=C+86400),!!x&&!!C&&!!w&&x>=C&&x<=w},D=function(v){var s=t(v).claims;return typeof s==="object"&&s.hasOwnProperty("iat")?s.iat:null},F=function(v){var s=t(v),x=s.claims;return!!x&&typeof x==="object"&&x.hasOwnProperty("iat")},V=function(v){var s=t(v).claims;return typeof s==="object"&&s.admin===!0};function y(v,s){return Object.prototype.hasOwnProperty.call(v,s)}function W(v,s){return Object.prototype.hasOwnProperty.call(v,s)?v[s]:void 0}function O(v){for(var s in v)if(Object.prototype.hasOwnProperty.call(v,s))return!1;return!0}function z(v,s,x){var C={};for(var w in v)Object.prototype.hasOwnProperty.call(v,w)&&(C[w]=s.call(x,v[w],w,v));return C}function J(v){for(var s=[],x=function(ha,da){Array.isArray(da)?da.forEach(function(sa){s.push(encodeURIComponent(ha)+"="+encodeURIComponent(sa))}):s.push(encodeURIComponent(ha)+"="+encodeURIComponent(da))},C=0,w=Object.entries(v);C<w.length;C++){var U=w[C],$=U[0],Z=U[1];x($,Z)}return s.length?"&"+s.join("&"):""}function X(v){var s={},x=v.replace(/^\?/,"").split("&");return x.forEach(function(C){if(C){var w=C.split("=");s[w[0]]=w[1]}}),s}var ia=function(){function v(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(var s=1;s<this.blockSize;++s)this.pad_[s]=0;this.reset()}return v.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},v.prototype.compress_=function(s,x){x||(x=0);var C=this.W_;if(typeof s==="string")for(var w=0;w<16;w++)C[w]=s.charCodeAt(x)<<24|s.charCodeAt(x+1)<<16|s.charCodeAt(x+2)<<8|s.charCodeAt(x+3),x+=4;else for(var w=0;w<16;w++)C[w]=s[x]<<24|s[x+1]<<16|s[x+2]<<8|s[x+3],x+=4;for(var w=16;w<80;w++){var U=C[w-3]^C[w-8]^C[w-14]^C[w-16];C[w]=(U<<1|U>>>31)&4294967295}for(var $=this.chain_[0],Z=this.chain_[1],ha=this.chain_[2],da=this.chain_[3],sa=this.chain_[4],la,xa,w=0;w<80;w++){w<40?w<20?(la=da^Z&(ha^da),xa=1518500249):(la=Z^ha^da,xa=1859775393):w<60?(la=Z&ha|da&(Z|ha),xa=2400959708):(la=Z^ha^da,xa=3395469782);var U=($<<5|$>>>27)+la+sa+xa+C[w]&4294967295;sa=da,da=ha,ha=(Z<<30|Z>>>2)&4294967295,Z=$,$=U}this.chain_[0]=this.chain_[0]+$&4294967295,this.chain_[1]=this.chain_[1]+Z&4294967295,this.chain_[2]=this.chain_[2]+ha&4294967295,this.chain_[3]=this.chain_[3]+da&4294967295,this.chain_[4]=this.chain_[4]+sa&4294967295},v.prototype.update=function(s,x){if(s==null)return;x===void 0&&(x=s.length);for(var C=x-this.blockSize,w=0,U=this.buf_,$=this.inbuf_;w<x;){if($===0)for(;w<=C;)this.compress_(s,w),w+=this.blockSize;if(typeof s==="string")for(;w<x;){U[$]=s.charCodeAt(w),++$,++w;if($===this.blockSize){this.compress_(U),$=0;break}}else for(;w<x;){U[$]=s[w],++$,++w;if($===this.blockSize){this.compress_(U),$=0;break}}}this.inbuf_=$,this.total_+=x},v.prototype.digest=function(){var s=[],x=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var C=this.blockSize-1;C>=56;C--)this.buf_[C]=x&255,x/=256;this.compress_(this.buf_);for(var w=0,C=0;C<5;C++)for(var U=24;U>=0;U-=8)s[w]=this.chain_[C]>>U&255,++w;return s},v}();function na(v,s){var x=new pa(v,s);return x.subscribe.bind(x)}var pa=function(){function v(s,x){var C=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=x,this.task.then(function(){s(C)}).catch(function(w){C.error(w)})}return v.prototype.next=function(s){this.forEachObserver(function(x){x.next(s)})},v.prototype.error=function(s){this.forEachObserver(function(x){x.error(s)}),this.close(s)},v.prototype.complete=function(){this.forEachObserver(function(s){s.complete()}),this.close()},v.prototype.subscribe=function(s,x,C){var w=this,U;if(s===void 0&&x===void 0&&C===void 0)throw new Error("Missing Observer.");T(s,["next","error","complete"])?U=s:U={next:s,error:x,complete:C},U.next===void 0&&(U.next=ea),U.error===void 0&&(U.error=ea),U.complete===void 0&&(U.complete=ea);var $=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{w.finalError?U.error(w.finalError):U.complete()}catch(Z){}return}),this.observers.push(U),$},v.prototype.unsubscribeOne=function(s){if(this.observers===void 0||this.observers[s]===void 0)return;delete this.observers[s],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this)},v.prototype.forEachObserver=function(s){if(this.finalized)return;for(var x=0;x<this.observers.length;x++)this.sendOne(x,s)},v.prototype.sendOne=function(s,x){var C=this;this.task.then(function(){if(C.observers!==void 0&&C.observers[s]!==void 0)try{x(C.observers[s])}catch(w){typeof console!=="undefined"&&console.error&&console.error(w)}})},v.prototype.close=function(s){var x=this;if(this.finalized)return;this.finalized=!0,s!==void 0&&(this.finalError=s),this.task.then(function(){x.observers=void 0,x.onNoObservers=void 0})},v}();function ma(v,s){return function(){for(var x=[],C=0;C<arguments.length;C++)x[C]=arguments[C];Promise.resolve(!0).then(function(){v.apply(void 0,x)}).catch(function(w){s&&s(w)})}}function T(v,s){if(typeof v!=="object"||v===null)return!1;for(var x=0,C=s;x<C.length;x++){var w=C[x];if(w in v&&typeof v[w]==="function")return!0}return!1}function ea(){}var ja=function(v,s,x,C){var w;C<s?w="at least "+s:C>x&&(w=x===0?"none":"no more than "+x);if(w){var U=v+" failed: Was called with "+C+(C===1?" argument.":" arguments.")+" Expects "+w+".";throw new Error(U)}};function ka(v,s,x){var C="";switch(s){case 1:C=x?"first":"First";break;case 2:C=x?"second":"Second";break;case 3:C=x?"third":"Third";break;case 4:C=x?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var w=v+" failed: ";return w+=C+" argument ",w}function R(v,s,x,C){if(C&&!x)return;if(typeof x!=="string")throw new Error(ka(v,s,C)+"must be a valid firebase namespace.")}function S(v,s,x,C){if(C&&!x)return;if(typeof x!=="function")throw new Error(ka(v,s,C)+"must be a valid function.")}function ga(v,s,x,C){if(C&&!x)return;if(typeof x!=="object"||x===null)throw new Error(ka(v,s,C)+"must be a valid context object.")}var P=function(v){for(var s=[],x=0,C=0;C<v.length;C++){var w=v.charCodeAt(C);if(w>=55296&&w<=56319){var U=w-55296;C++,c(C<v.length,"Surrogate pair missing trail surrogate.");var $=v.charCodeAt(C)-56320;w=65536+(U<<10)+$}w<128?s[x++]=w:w<2048?(s[x++]=w>>6|192,s[x++]=w&63|128):w<65536?(s[x++]=w>>12|224,s[x++]=w>>6&63|128,s[x++]=w&63|128):(s[x++]=w>>18|240,s[x++]=w>>12&63|128,s[x++]=w>>6&63|128,s[x++]=w&63|128)}return s},fa=function(v){for(var s=0,x=0;x<v.length;x++){var C=v.charCodeAt(x);C<128?s++:C<2048?s+=2:C>=55296&&C<=56319?(s+=4,x++):s+=3}return s};Q.CONSTANTS=b;Q.Deferred=u;Q.ErrorFactory=r;Q.FirebaseError=q;Q.Sha1=ia;Q.assert=c;Q.assertionError=d;Q.async=ma;Q.base64=g;Q.base64Decode=i;Q.base64Encode=j;Q.contains=y;Q.createSubscribe=na;Q.decode=t;Q.deepCopy=m;Q.deepExtend=n;Q.errorPrefix=ka;Q.getUA=A;Q.isAdmin=V;Q.isBrowser=G;Q.isBrowserExtension=H;Q.isElectron=I;Q.isEmpty=O;Q.isIE=N;Q.isMobileCordova=B;Q.isNode=E;Q.isNodeSdk=_;Q.isReactNative=K;Q.isSafari=Y;Q.isUWP=L;Q.isValidFormat=F;Q.isValidTimestamp=o;Q.issuedAtTime=D;Q.jsonEval=k;Q.map=z;Q.querystring=J;Q.querystringDecode=X;Q.safeGet=W;Q.stringLength=fa;Q.stringToByteArray=P;Q.stringify=p;Q.validateArgCount=ja;Q.validateCallback=S;Q.validateContextObject=ga;Q.validateNamespace=R});var sg=db(q=>{Ob(q,{__assign:()=>c,__asyncDelegator:()=>K,__asyncGenerator:()=>H,__asyncValues:()=>I,__await:()=>G,__awaiter:()=>j,__classPrivateFieldGet:()=>Y,__classPrivateFieldSet:()=>M,__createBinding:()=>m,__decorate:()=>e,__exportStar:()=>n,__extends:()=>b,__generator:()=>i,__importDefault:()=>_,__importStar:()=>L,__makeTemplateObject:()=>N,__metadata:()=>g,__param:()=>f,__read:()=>A,__rest:()=>d,__spread:()=>B,__spreadArrays:()=>E,__values:()=>u});var a=function(h,l){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,p){k.__proto__=p}||function(k,p){for(var t in p)p.hasOwnProperty(t)&&(k[t]=p[t])},a(h,l)};function b(h,l){a(h,l);function k(){this.constructor=h}h.prototype=l===null?Object.create(l):(k.prototype=l.prototype,new k())}var c=function(){return c=Object.assign||function h(l){for(var k,p=1,t=arguments.length;p<t;p++){k=arguments[p];for(var o in k)Object.prototype.hasOwnProperty.call(k,o)&&(l[o]=k[o])}return l},c.apply(this,arguments)};function d(h,l){var k={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&l.indexOf(p)<0&&(k[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols==="function")for(var t=0,p=Object.getOwnPropertySymbols(h);t<p.length;t++)l.indexOf(p[t])<0&&Object.prototype.propertyIsEnumerable.call(h,p[t])&&(k[p[t]]=h[p[t]]);return k}function e(h,l,k,p){var t=arguments.length,o=t<3?l:p===null?p=Object.getOwnPropertyDescriptor(l,k):p,D;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(h,l,k,p);else for(var F=h.length-1;F>=0;F--)(D=h[F])&&(o=(t<3?D(o):t>3?D(l,k,o):D(l,k))||o);return t>3&&o&&Object.defineProperty(l,k,o),o}function f(h,l){return function(k,p){l(k,p,h)}}function g(h,l){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(h,l)}function j(h,l,k,p){function t(o){return o instanceof k?o:new k(function(D){D(o)})}return new(k||(k=Promise))(function(o,D){function F(W){try{y(p.next(W))}catch(O){D(O)}}function V(W){try{y(p.throw(W))}catch(O){D(O)}}function y(W){W.done?o(W.value):t(W.value).then(F,V)}y((p=p.apply(h,l||[])).next())})}function i(h,l){var k={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},p,t,o,D;return D={next:F(0),throw:F(1),return:F(2)},typeof Symbol==="function"&&(D[Symbol.iterator]=function(){return this}),D;function F(y){return function(W){return V([y,W])}}function V(y){if(p)throw new TypeError("Generator is already executing.");for(;k;)try{if(p=1,t&&(o=y[0]&2?t.return:y[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,y[1])).done)return o;(t=0,o)&&(y=[y[0]&2,o.value]);switch(y[0]){case 0:case 1:o=y;break;case 4:return k.label++,{value:y[1],done:!1};case 5:k.label++,t=y[1],y=[0];continue;case 7:y=k.ops.pop(),k.trys.pop();continue;default:if(!(o=k.trys,o=o.length>0&&o[o.length-1])&&(y[0]===6||y[0]===2)){k=0;continue}if(y[0]===3&&(!o||y[1]>o[0]&&y[1]<o[3])){k.label=y[1];break}if(y[0]===6&&k.label<o[1]){k.label=o[1],o=y;break}if(o&&k.label<o[2]){k.label=o[2],k.ops.push(y);break}o[2]&&k.ops.pop(),k.trys.pop();continue}y=l.call(h,k)}catch(W){y=[6,W],t=0}finally{p=o=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}function m(h,l,k,p){p===void 0&&(p=k),h[p]=l[k]}function n(h,l){for(var k in h)k!=="default"&&!l.hasOwnProperty(k)&&(l[k]=h[k])}function u(h){var l=typeof Symbol==="function"&&Symbol.iterator,k=l&&h[l],p=0;if(k)return k.call(h);if(h&&typeof h.length==="number")return{next:function(){return h&&p>=h.length&&(h=void 0),{value:h&&h[p++],done:!h}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")}function A(h,l){var k=typeof Symbol==="function"&&h[Symbol.iterator];if(!k)return h;var p=k.call(h),t,o=[],D;try{for(;(l===void 0||l-- >0)&&!(t=p.next()).done;)o.push(t.value)}catch(F){D={error:F}}finally{try{t&&!t.done&&(k=p.return)&&k.call(p)}finally{if(D)throw D.error}}return o}function B(){for(var h=[],l=0;l<arguments.length;l++)h=h.concat(A(arguments[l]));return h}function E(){for(var h=0,l=0,k=arguments.length;l<k;l++)h+=arguments[l].length;for(var p=Array(h),t=0,l=0;l<k;l++)for(var o=arguments[l],D=0,F=o.length;D<F;D++,t++)p[t]=o[D];return p}function G(h){return this instanceof G?(this.v=h,this):new G(h)}function H(h,l,k){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=k.apply(h,l||[]),t,o=[];return t={},D("next"),D("throw"),D("return"),t[Symbol.asyncIterator]=function(){return this},t;function D(z){p[z]&&(t[z]=function(J){return new Promise(function(X,ia){o.push([z,J,X,ia])>1||F(z,J)})})}function F(z,J){try{V(p[z](J))}catch(X){O(o[0][3],X)}}function V(z){z.value instanceof G?Promise.resolve(z.value.v).then(y,W):O(o[0][2],z)}function y(z){F("next",z)}function W(z){F("throw",z)}function O(z,J){(z(J),o.shift(),o.length)&&F(o[0][0],o[0][1])}}function K(h){var l,k;return l={},p("next"),p("throw",function(t){throw t}),p("return"),l[Symbol.iterator]=function(){return this},l;function p(t,o){l[t]=h[t]?function(D){return(k=!k)?{value:G(h[t](D)),done:t==="return"}:o?o(D):D}:o}}function I(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l=h[Symbol.asyncIterator],k;return l?l.call(h):(h=typeof u==="function"?u(h):h[Symbol.iterator](),k={},p("next"),p("throw"),p("return"),k[Symbol.asyncIterator]=function(){return this},k);function p(o){k[o]=h[o]&&function(D){return new Promise(function(F,V){D=h[o](D),t(F,V,D.done,D.value)})}}function t(o,D,F,V){Promise.resolve(V).then(function(y){o({value:y,done:F})},D)}}function N(h,l){return Object.defineProperty?Object.defineProperty(h,"raw",{value:l}):h.raw=l,h}function L(h){if(h&&h.__esModule)return h;var l={};if(h!=null)for(var k in h)Object.hasOwnProperty.call(h,k)&&(l[k]=h[k]);return l.default=h,l}function _(h){return h&&h.__esModule?h:{default:h}}function Y(h,l){if(!l.has(h))throw new TypeError("attempted to get private field on non-instance");return l.get(h)}function M(h,l,k){if(!l.has(h))throw new TypeError("attempted to set private field on non-instance");return l.set(h,k),k}});var rg=db(i=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=sg(),b=Be(),c=function(){function n(u,A,B){this.name=u,this.instanceFactory=A,this.type=B,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return n.prototype.setInstantiationMode=function(u){return this.instantiationMode=u,this},n.prototype.setMultipleInstances=function(u){return this.multipleInstances=u,this},n.prototype.setServiceProps=function(u){return this.serviceProps=u,this},n}();var d="[DEFAULT]";var e=function(){function n(u,A){this.name=u,this.container=A,this.component=null,this.instances=new Map(),this.instancesDeferred=new Map()}return n.prototype.get=function(u){u===void 0&&(u=d);var A=this.normalizeInstanceIdentifier(u);if(!this.instancesDeferred.has(A)){var B=new b.Deferred();this.instancesDeferred.set(A,B);try{var E=this.getOrInitializeService(A);E&&B.resolve(E)}catch(G){}}return this.instancesDeferred.get(A).promise},n.prototype.getImmediate=function(u){var A=a.__assign({identifier:d,optional:!1},u),B=A.identifier,E=A.optional,G=this.normalizeInstanceIdentifier(B);try{var H=this.getOrInitializeService(G);if(!H){if(E)return null;throw Error("Service "+this.name+" is not available")}return H}catch(K){if(E)return null;throw K}},n.prototype.getComponent=function(){return this.component},n.prototype.setComponent=function(u){var A,B;if(u.name!==this.name)throw Error("Mismatching Component "+u.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");this.component=u;if(g(u))try{this.getOrInitializeService(d)}catch(_){}try{for(var E=a.__values(this.instancesDeferred.entries()),G=E.next();!G.done;G=E.next()){var H=a.__read(G.value,2),K=H[0],I=H[1],N=this.normalizeInstanceIdentifier(K);try{var L=this.getOrInitializeService(N);I.resolve(L)}catch(_){}}}catch(_){A={error:_}}finally{try{G&&!G.done&&(B=E.return)&&B.call(E)}finally{if(A)throw A.error}}},n.prototype.clearInstance=function(u){u===void 0&&(u=d),this.instancesDeferred.delete(u),this.instances.delete(u)},n.prototype.delete=function(){return a.__awaiter(this,void 0,void 0,function(){var u;return a.__generator(this,function(A){switch(A.label){case 0:return u=Array.from(this.instances.values()),[4,Promise.all(u.filter(function(B){return"INTERNAL"in B}).map(function(B){return B.INTERNAL.delete()}))];case 1:return A.sent(),[2]}})})},n.prototype.isComponentSet=function(){return this.component!=null},n.prototype.getOrInitializeService=function(u){var A=this.instances.get(u);return!A&&this.component&&(A=this.component.instanceFactory(this.container,f(u)),this.instances.set(u,A)),A||null},n.prototype.normalizeInstanceIdentifier=function(u){return this.component?this.component.multipleInstances?u:d:u},n}();function f(n){return n===d?void 0:n}function g(n){return n.instantiationMode==="EAGER"}var j=function(){function n(u){this.name=u,this.providers=new Map()}return n.prototype.addComponent=function(u){var A=this.getProvider(u.name);if(A.isComponentSet())throw new Error("Component "+u.name+" has already been registered with "+this.name);A.setComponent(u)},n.prototype.addOrOverwriteComponent=function(u){var A=this.getProvider(u.name);A.isComponentSet()&&this.providers.delete(u.name),this.addComponent(u)},n.prototype.getProvider=function(u){if(this.providers.has(u))return this.providers.get(u);var A=new e(u,this);return this.providers.set(u,A),A},n.prototype.getProviders=function(){return Array.from(this.providers.values())},n}();i.Component=c;i.ComponentContainer=j;i.Provider=e});var tg=db(u=>{Ob(u,{LogLevel:()=>d,Logger:()=>i,setLogLevel:()=>m,setUserLogHandler:()=>n});function a(){for(var B=0,E=0,G=arguments.length;E<G;E++)B+=arguments[E].length;for(var H=Array(B),K=0,E=0;E<G;E++)for(var I=arguments[E],N=0,L=I.length;N<L;N++,K++)H[K]=I[N];return H}var b,c=[],d;(function(B){B[B.DEBUG=0]="DEBUG",B[B.VERBOSE=1]="VERBOSE",B[B.INFO=2]="INFO",B[B.WARN=3]="WARN",B[B.ERROR=4]="ERROR",B[B.SILENT=5]="SILENT"})(d||(d={}));var e={debug:d.DEBUG,verbose:d.VERBOSE,info:d.INFO,warn:d.WARN,error:d.ERROR,silent:d.SILENT},f=d.INFO,g=(b={},b[d.DEBUG]="log",b[d.VERBOSE]="log",b[d.INFO]="info",b[d.WARN]="warn",b[d.ERROR]="error",b),j=function(B,E){for(var G=[],H=2;H<arguments.length;H++)G[H-2]=arguments[H];if(E<B.logLevel)return;var K=new Date().toISOString(),I=g[E];if(I)console[I].apply(console,a(["["+K+"]  "+B.name+":"],G));else throw new Error("Attempted to log a message with an invalid logType (value: "+E+")")},i=function(){function B(E){this.name=E,this._logLevel=f,this._logHandler=j,this._userLogHandler=null,c.push(this)}return Object.defineProperty(B.prototype,"logLevel",{get:function(){return this._logLevel},set:function(E){if(!(E in d))throw new TypeError('Invalid value "'+E+'" assigned to `logLevel`');this._logLevel=E},enumerable:!1,configurable:!0}),B.prototype.setLogLevel=function(E){this._logLevel=typeof E==="string"?e[E]:E},Object.defineProperty(B.prototype,"logHandler",{get:function(){return this._logHandler},set:function(E){if(typeof E!=="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=E},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(E){this._userLogHandler=E},enumerable:!1,configurable:!0}),B.prototype.debug=function(){for(var E=[],G=0;G<arguments.length;G++)E[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.DEBUG],E)),this._logHandler.apply(this,a([this,d.DEBUG],E))},B.prototype.log=function(){for(var E=[],G=0;G<arguments.length;G++)E[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.VERBOSE],E)),this._logHandler.apply(this,a([this,d.VERBOSE],E))},B.prototype.info=function(){for(var E=[],G=0;G<arguments.length;G++)E[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.INFO],E)),this._logHandler.apply(this,a([this,d.INFO],E))},B.prototype.warn=function(){for(var E=[],G=0;G<arguments.length;G++)E[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.WARN],E)),this._logHandler.apply(this,a([this,d.WARN],E))},B.prototype.error=function(){for(var E=[],G=0;G<arguments.length;G++)E[G]=arguments[G];this._userLogHandler&&this._userLogHandler.apply(this,a([this,d.ERROR],E)),this._logHandler.apply(this,a([this,d.ERROR],E))},B}();function m(B){c.forEach(function(E){E.setLogLevel(B)})}function n(B,E){for(var G=function(N){var L=null;E&&E.level&&(L=e[E.level]),B===null?N.userLogHandler=null:N.userLogHandler=function(_,Y){for(var M=[],q=2;q<arguments.length;q++)M[q-2]=arguments[q];var r=M.map(function(h){if(h==null)return null;{if(typeof h==="string")return h;{if(typeof h==="number"||typeof h==="boolean")return h.toString();{if(h instanceof Error)return h.message;try{return JSON.stringify(h)}catch(l){return null}}}}}).filter(function(h){return h}).join(" ");Y>=(L!==null&&L!==void 0?L:_.logLevel)&&B({level:d[Y].toLowerCase(),message:r,args:M,type:_.name})}},H=0,K=c;H<K.length;H++){var I=K[H];G(I)}}});var pg=db(y=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0});var a=qg(),b=Be(),c=rg(),d=tg();var e,f=(e={},e["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",e["bad-app-name"]="Illegal App name: '{$appName}",e["duplicate-app"]="Firebase App named '{$appName}' already exists",e["app-deleted"]="Firebase App named '{$appName}' already deleted",e["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",e["invalid-log-argument"]="First argument to `onLog` must be null or a function.",e),g=new b.ErrorFactory("app","Firebase",f),j="@firebase/app",i="0.6.8",m="@firebase/analytics",n="@firebase/auth",u="@firebase/database",A="@firebase/functions",B="@firebase/installations",E="@firebase/messaging",G="@firebase/performance",H="@firebase/remote-config",K="@firebase/storage",I="@firebase/firestore",N="firebase-wrapper";var L,_="[DEFAULT]",Y=(L={},L[j]="fire-core",L[m]="fire-analytics",L[n]="fire-auth",L[u]="fire-rtdb",L[A]="fire-fn",L[B]="fire-iid",L[E]="fire-fcm",L[G]="fire-perf",L[H]="fire-rc",L[K]="fire-gcs",L[I]="fire-fst",L["fire-js"]="fire-js",L[N]="fire-js-all",L);var M=new d.Logger("@firebase/app");var q=function(){function O(z,J,X){var ia,na,pa=this;this.firebase_=X,this.isDeleted_=!1,this.name_=J.name,this.automaticDataCollectionEnabled_=J.automaticDataCollectionEnabled||!1,this.options_=b.deepCopy(z),this.container=new c.ComponentContainer(J.name),this._addComponent(new c.Component("app",function(){return pa},"PUBLIC"));try{for(var ma=a.__values(this.firebase_.INTERNAL.components.values()),T=ma.next();!T.done;T=ma.next()){var ea=T.value;this._addComponent(ea)}}catch(ja){ia={error:ja}}finally{try{T&&!T.done&&(na=ma.return)&&na.call(ma)}finally{if(ia)throw ia.error}}}return Object.defineProperty(O.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(z){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=z},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),O.prototype.delete=function(){var z=this;return new Promise(function(J){z.checkDestroyed_(),J()}).then(function(){return z.firebase_.INTERNAL.removeApp(z.name_),Promise.all(z.container.getProviders().map(function(J){return J.delete()}))}).then(function(){z.isDeleted_=!0})},O.prototype._getService=function(z,J){return J===void 0&&(J=_),this.checkDestroyed_(),this.container.getProvider(z).getImmediate({identifier:J})},O.prototype._removeServiceInstance=function(z,J){J===void 0&&(J=_),this.container.getProvider(z).clearInstance(J)},O.prototype._addComponent=function(z){try{this.container.addComponent(z)}catch(J){M.debug("Component "+z.name+" failed to register with FirebaseApp "+this.name,J)}},O.prototype._addOrOverwriteComponent=function(z){this.container.addOrOverwriteComponent(z)},O.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw g.create("app-deleted",{appName:this.name_})},O}();q.prototype.name&&q.prototype.options||q.prototype.delete||console.log("dc");var r="7.16.0";function h(O){var z={},J=new Map(),X={__esModule:!0,initializeApp:pa,app:na,registerVersion:ea,setLogLevel:d.setLogLevel,onLog:ja,apps:null,SDK_VERSION:r,INTERNAL:{registerComponent:T,removeApp:ia,components:J,useAsService:ka}};X.default=X,Object.defineProperty(X,"apps",{get:ma});function ia(R){delete z[R]}function na(R){R=R||_;if(!b.contains(z,R))throw g.create("no-app",{appName:R});return z[R]}na.App=O;function pa(R,S){S===void 0&&(S={});if(typeof S!=="object"||S===null){var ga=S;S={name:ga}}var P=S;P.name===void 0&&(P.name=_);var fa=P.name;if(typeof fa!=="string"||!fa)throw g.create("bad-app-name",{appName:String(fa)});if(b.contains(z,fa))throw g.create("duplicate-app",{appName:fa});var Q=new O(R,P,X);return z[fa]=Q,Q}function ma(){return Object.keys(z).map(function(R){return z[R]})}function T(R){var S,ga,P=R.name;if(J.has(P))return M.debug("There were multiple attempts to register component "+P+"."),R.type==="PUBLIC"?X[P]:null;J.set(P,R);if(R.type==="PUBLIC"){var fa=function(s){s===void 0&&(s=na());if(typeof s[P]!=="function")throw g.create("invalid-app-argument",{appName:P});return s[P]()};R.serviceProps!==void 0&&b.deepExtend(fa,R.serviceProps),X[P]=fa,O.prototype[P]=function(){for(var s=[],x=0;x<arguments.length;x++)s[x]=arguments[x];var C=this._getService.bind(this,P);return C.apply(this,R.multipleInstances?s:[])}}try{for(var Q=a.__values(Object.keys(z)),ta=Q.next();!ta.done;ta=Q.next()){var v=ta.value;z[v]._addComponent(R)}}catch(s){S={error:s}}finally{try{ta&&!ta.done&&(ga=Q.return)&&ga.call(Q)}finally{if(S)throw S.error}}return R.type==="PUBLIC"?X[P]:null}function ea(R,S,ga){var P,fa=(P=Y[R])!==null&&P!==void 0?P:R;ga&&(fa+="-"+ga);var Q=fa.match(/\s|\//),ta=S.match(/\s|\//);if(Q||ta){var v=['Unable to register library "'+fa+'" with version "'+S+'":'];Q&&v.push('library name "'+fa+'" contains illegal characters (whitespace or "/")'),Q&&ta&&v.push("and"),ta&&v.push('version name "'+S+'" contains illegal characters (whitespace or "/")'),M.warn(v.join(" "));return}T(new c.Component(fa+"-version",function(){return{library:fa,version:S}},"VERSION"))}function ja(R,S){if(R!==null&&typeof R!=="function")throw g.create("invalid-log-argument",{appName:name});d.setUserLogHandler(R,S)}function ka(R,S){if(S==="serverAuth")return null;var ga=S;return ga}return X}function l(){var O=h(q);O.INTERNAL=a.__assign(a.__assign({},O.INTERNAL),{createFirebaseNamespace:l,extendNamespace:z,createSubscribe:b.createSubscribe,ErrorFactory:b.ErrorFactory,deepExtend:b.deepExtend});function z(J){b.deepExtend(O,J)}return O}var k=l();var p=function(){function O(z){this.container=z}return O.prototype.getPlatformInfoString=function(){var z=this.container.getProviders();return z.map(function(J){if(t(J)){var X=J.getImmediate();return X.library+"/"+X.version}else return null}).filter(function(J){return J}).join(" ")},O}();function t(O){var z=O.getComponent();return(z===null||z===void 0?void 0:z.type)==="VERSION"}function o(O,z){O.INTERNAL.registerComponent(new c.Component("platform-logger",function(J){return new p(J)},"PRIVATE")),O.registerVersion(j,i,z),O.registerVersion("fire-js","")}if(b.isBrowser()&&self.firebase!==void 0){M.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);var D=self.firebase.SDK_VERSION;D&&D.indexOf("LITE")>=0&&M.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}var F=k.initializeApp;k.initializeApp=function(){for(var O=[],z=0;z<arguments.length;z++)O[z]=arguments[z];return b.isNode()&&M.warn(`
      Warning: This is a browser-targeted Firebase bundle but it appears it is being
      run in a Node environment.  If running in a Node environment, make sure you
      are using the bundle specified by the "main" field in package.json.
      
      If you are using Webpack, you can specify "main" as the first item in
      "resolve.mainFields":
      https://webpack.js.org/configuration/resolve/#resolvemainfields
      
      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"
      as the first item in "mainFields", e.g. ['main', 'module'].
      https://github.com/rollup/rollup-plugin-node-resolve
      `),F.apply(void 0,O)};var V=k;o(V);y.default=V;y.firebase=V});var Ja=db((e,f)=>{"use strict";function a(g){return g&&typeof g==="object"&&"default"in g?g.default:g}var b=a(pg()),c="firebase",d="7.16.0";b.registerVersion(c,d,"app");f.exports=b});var hl=db((b,c)=>{var a=function(){function d(m,n){if(!j[m]){j[m]={};for(var u=0;u<m.length;u++)j[m][m.charAt(u)]=u}return j[m][n]}var e=String.fromCharCode,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",j={},i={compressToBase64:function(m){if(null==m)return"";var n=i._compress(m,6,function(u){return f.charAt(u)});switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(m){return null==m?"":""==m?null:i._decompress(m.length,32,function(n){return d(f,m.charAt(n))})},compressToUTF16:function(m){return null==m?"":i._compress(m,15,function(n){return e(n+32)})+" "},decompressFromUTF16:function(m){return null==m?"":""==m?null:i._decompress(m.length,16384,function(n){return m.charCodeAt(n)-32})},compressToUint8Array:function(m){for(var n=i.compress(m),u=new Uint8Array(2*n.length),A=0,B=n.length;B>A;A++){var E=n.charCodeAt(A);u[2*A]=E>>>8,u[2*A+1]=E%256}return u},decompressFromUint8Array:function(m){if(null===m||void 0===m)return i.decompress(m);for(var n=new Array(m.length/2),u=0,A=n.length;A>u;u++)n[u]=256*m[2*u]+m[2*u+1];var B=[];return n.forEach(function(E){B.push(e(E))}),i.decompress(B.join(""))},compressToEncodedURIComponent:function(m){return null==m?"":i._compress(m,6,function(n){return g.charAt(n)})},decompressFromEncodedURIComponent:function(m){return null==m?"":""==m?null:(m=m.replace(/ /g,"+"),i._decompress(m.length,32,function(n){return d(g,m.charAt(n))}))},compress:function(m){return i._compress(m,16,function(n){return e(n)})},_compress:function(m,n,u){if(null==m)return"";var A,B,E,G={},H={},K="",I="",N="",L=2,_=3,Y=2,M=[],q=0,r=0;for(E=0;E<m.length;E+=1)if(K=m.charAt(E),Object.prototype.hasOwnProperty.call(G,K)||(G[K]=_++,H[K]=!0),I=N+K,Object.prototype.hasOwnProperty.call(G,I))N=I;else{if(Object.prototype.hasOwnProperty.call(H,N)){if(N.charCodeAt(0)<256){for(A=0;Y>A;A++)q<<=1,r==n-1?(r=0,M.push(u(q)),q=0):r++;for(B=N.charCodeAt(0),A=0;8>A;A++)q=q<<1|1&B,r==n-1?(r=0,M.push(u(q)),q=0):r++,B>>=1}else{for(B=1,A=0;Y>A;A++)q=q<<1|B,r==n-1?(r=0,M.push(u(q)),q=0):r++,B=0;for(B=N.charCodeAt(0),A=0;16>A;A++)q=q<<1|1&B,r==n-1?(r=0,M.push(u(q)),q=0):r++,B>>=1}L--,0==L&&(L=Math.pow(2,Y),Y++),delete H[N]}else for(B=G[N],A=0;Y>A;A++)q=q<<1|1&B,r==n-1?(r=0,M.push(u(q)),q=0):r++,B>>=1;L--,0==L&&(L=Math.pow(2,Y),Y++),G[I]=_++,N=String(K)}if(""!==N){if(Object.prototype.hasOwnProperty.call(H,N)){if(N.charCodeAt(0)<256){for(A=0;Y>A;A++)q<<=1,r==n-1?(r=0,M.push(u(q)),q=0):r++;for(B=N.charCodeAt(0),A=0;8>A;A++)q=q<<1|1&B,r==n-1?(r=0,M.push(u(q)),q=0):r++,B>>=1}else{for(B=1,A=0;Y>A;A++)q=q<<1|B,r==n-1?(r=0,M.push(u(q)),q=0):r++,B=0;for(B=N.charCodeAt(0),A=0;16>A;A++)q=q<<1|1&B,r==n-1?(r=0,M.push(u(q)),q=0):r++,B>>=1}L--,0==L&&(L=Math.pow(2,Y),Y++),delete H[N]}else for(B=G[N],A=0;Y>A;A++)q=q<<1|1&B,r==n-1?(r=0,M.push(u(q)),q=0):r++,B>>=1;L--,0==L&&(L=Math.pow(2,Y),Y++)}for(B=2,A=0;Y>A;A++)q=q<<1|1&B,r==n-1?(r=0,M.push(u(q)),q=0):r++,B>>=1;for(;;){if(q<<=1,r==n-1){M.push(u(q));break}r++}return M.join("")},decompress:function(m){return null==m?"":""==m?null:i._decompress(m.length,32768,function(n){return m.charCodeAt(n)})},_decompress:function(m,n,u){var A,B,E,G,H,K,I,N,L=[],_=4,Y=4,M=3,q="",r=[],h={val:u(0),position:n,index:1};for(B=0;3>B;B+=1)L[B]=B;for(G=0,K=Math.pow(2,2),I=1;I!=K;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),G|=(H>0?1:0)*I,I<<=1;switch(A=G){case 0:for(G=0,K=Math.pow(2,8),I=1;I!=K;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),G|=(H>0?1:0)*I,I<<=1;N=e(G);break;case 1:for(G=0,K=Math.pow(2,16),I=1;I!=K;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),G|=(H>0?1:0)*I,I<<=1;N=e(G);break;case 2:return""}for(L[3]=N,E=N,r.push(N);;){if(h.index>m)return"";for(G=0,K=Math.pow(2,M),I=1;I!=K;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),G|=(H>0?1:0)*I,I<<=1;switch(N=G){case 0:for(G=0,K=Math.pow(2,8),I=1;I!=K;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),G|=(H>0?1:0)*I,I<<=1;L[Y++]=e(G),N=Y-1,_--;break;case 1:for(G=0,K=Math.pow(2,16),I=1;I!=K;)H=h.val&h.position,h.position>>=1,0==h.position&&(h.position=n,h.val=u(h.index++)),G|=(H>0?1:0)*I,I<<=1;L[Y++]=e(G),N=Y-1,_--;break;case 2:return r.join("")}if(0==_&&(_=Math.pow(2,M),M++),L[N])q=L[N];else{if(N!==Y)return null;q=E+E.charAt(0)}r.push(q),L[Y++]=E+q.charAt(0),_--,E=q,0==_&&(_=Math.pow(2,M),M++)}}};return i}();"function"==typeof define&&define.amd?define(function(){return a}):"undefined"!=typeof c&&null!=c&&(c.exports=a)});let Ag,Bg=0,Cg=0;const wa={get:()=>Ag,set:a=>{Ag=a},getFrame:()=>Bg,setFrame:a=>{Bg=a},getElapsed:()=>Cg,setElapsed:a=>{Cg=a}};let Gg=0;function ve(a=0){return()=>{Gg=a}}function Qc(){return Gg}let Fe="Phaser",ll="https://phaser4.io",ml="#fff",nl="linear-gradient(#3e0081 40%, #00bcc3)";function Ce(){if(Fe!==""){const a=wa.get(),b=Fe==="Phaser"?" v"+a.VERSION:"";console.log(`%c${Fe}${b}%c ${ll}`,`padding: 4px 16px; color: ${ml}; background: ${nl}`,"")}}let Lg=800,Mg=600,Ng=1;function ye(a=800,b=600,c=1){return c===0&&(c=window.devicePixelRatio),()=>{Lg=a,Mg=b,Ng=c}}function Pb(){return Lg}function Qb(){return Mg}function Rb(){return Ng}const Te=[],Tb={add:a=>{Te.push(a)},get:()=>Te,clear:()=>{Te.length=0}};let Kg;function Rc(a){Kg=a}function De(){return Kg}let Ge=.5,He=.5;let Hg=0;function Ie(a){Hg=a}function jc(){return Hg}function Sc(a){let b;return a&&(typeof a==="string"?b=document.getElementById(a):typeof a==="object"&&a.nodeType===1&&(b=a)),b||(b=document.body),b}let Ig;function we(a){return()=>{a&&(Ig=Sc(a))}}function Ee(){return Ig}let Jg=[];function xe(a){return()=>{Jg=[].concat(a)}}function Je(){return Jg}let pl={alpha:!1,antialias:!1,depth:!1,premultipliedAlpha:!1};function Ke(){return pl}class hh{constructor(a){this.stack=[],this.current=null,this.renderer=a}reset(){this.stack=[],this.current=null;const a=this.renderer,b=a.gl;b.bindFramebuffer(b.FRAMEBUFFER,null),b.viewport(0,0,a.width,a.height)}add(a,b=!0,c=0,d=0){this.stack.push({framebuffer:a,width:c,height:d}),this.set(a,b,c,d)}set(a,b=!0,c=0,d=0){const e=this.renderer,f=e.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),b&&(f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),c>0&&f.viewport(0,0,c,d),this.current=a}pop(){this.stack.pop();const a=this.stack.length;if(a>0){const b=this.stack[a-1];this.set(b.framebuffer,!1,b.width,b.height)}else this.reset()}rebind(){const a=this.renderer.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.current)}destroy(){this.stack=[]}}let gh;const Aa={get:()=>gh,set:a=>{gh=a}};function ih(a,b=[]){const c=a>>16&255,d=a>>8&255,e=a&255,f=a>16777215?a>>>24:255;return b[0]=c/255,b[1]=d/255,b[2]=e/255,b[3]=f/255,b}function dh(a,b){return a.a===b.a&&a.b===b.b&&a.c===b.c&&a.d===b.d&&a.tx===b.tx&&a.ty===b.ty}function ph(a,b){const c=Aa.get();b||(b=c.COLOR_ATTACHMENT0);const d=c.createFramebuffer();return c.bindFramebuffer(c.FRAMEBUFFER,d),c.framebufferTexture2D(c.FRAMEBUFFER,b,c.TEXTURE_2D,a,0),c.bindFramebuffer(c.FRAMEBUFFER,null),d}function fd(a){const b=Aa.get();if(!b)return;const{parent:c,flipY:d,unpackPremultiplyAlpha:e,minFilter:f,magFilter:g,wrapS:j,wrapT:i,generateMipmap:m,isPOT:n}=a,u=c.image;let A=c.width,B=c.height;const E=b.createTexture();return b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,E),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,d),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),u?(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,u),A=u.width,B=u.height):b.texImage2D(b.TEXTURE_2D,0,b.RGBA,A,B,0,b.RGBA,b.UNSIGNED_BYTE,null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,g),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,j),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,i),m&&n&&b.generateMipmap(b.TEXTURE_2D),a.texture=E,E}function qh(a){const b=Aa.get();b&&b.isFramebuffer(a)&&b.deleteFramebuffer(a)}function Ue(a){const b=Aa.get();if(!b)return;b.isTexture(a)&&b.deleteTexture(a)}function eh(a,b){return a<1||b<1?!1:(a&a-1)===0&&(b&b-1)===0}function th(a,b=!0){const c=Aa.get();c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,a);const d=b?c.LINEAR:c.NEAREST;c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,d),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,d)}function uh(a){const b=Aa.get(),c=a.parent.image,d=c.width,e=c.height;return d>0&&e>0&&(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,a.texture),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,a.flipY),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,c)),a.texture}class ed{constructor(a,b={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1;const c=Aa.get();this.parent=a,this.isPOT=eh(a.width,a.height);const{texture:d=null,framebuffer:e=null,unpackPremultiplyAlpha:f=!0,minFilter:g=c.LINEAR,magFilter:j=c.LINEAR,wrapS:i=c.CLAMP_TO_EDGE,wrapT:m=c.CLAMP_TO_EDGE,generateMipmap:n=this.isPOT,flipY:u=!1}=b;this.minFilter=g,this.magFilter=j,this.wrapS=i,this.wrapT=m,this.generateMipmap=n,this.flipY=u,this.unpackPremultiplyAlpha=f,e&&(this.framebuffer=e),d?this.texture=d:fd(this)}setFilter(a){this.texture&&th(this.texture,a)}create(){const a=this.texture;return a&&Ue(a),fd(this)}update(){const a=this.texture;return a?uh(this):fd(this)}setIndex(a){this.dirtyIndex=a!==this.index,this.index=a}destroy(){Ue(this.texture),qh(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}}class oh{constructor(a,b,c,d,e){this.batchSize=a,this.dataSize=b,this.indexSize=c,this.vertexElementSize=d,this.quadIndexSize=e,this.vertexByteSize=d*b,this.quadByteSize=this.vertexByteSize*4,this.quadElementSize=d*4,this.bufferByteSize=a*this.quadByteSize,this.create()}create(){let a=[];for(let c=0;c<this.batchSize*this.indexSize;c+=this.indexSize)a.push(c+0,c+1,c+2,c+2,c+3,c+0);this.data=new ArrayBuffer(this.bufferByteSize),this.index=new Uint16Array(a),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const b=Aa.get();this.vertexBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.data,b.DYNAMIC_DRAW),this.indexBuffer=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.index,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,null),a=[]}destroy(){}}class Ve{constructor(a,b,c,d,e,f){this.trimmed=!1,this.texture=a,this.key=b,this.x=c,this.y=d,this.width=e,this.height=f,this.sourceSizeWidth=e,this.sourceSizeHeight=f,this.updateUVs()}setPivot(a,b){this.pivot={x:a,y:b}}setSize(a,b){this.width=a,this.height=b,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.updateUVs()}setSourceSize(a,b){this.sourceSizeWidth=a,this.sourceSizeHeight=b}setTrim(a,b,c,d,e,f){this.trimmed=!0,this.sourceSizeWidth=a,this.sourceSizeHeight=b,this.spriteSourceSizeX=c,this.spriteSourceSizeY=d,this.spriteSourceSizeWidth=e,this.spriteSourceSizeHeight=f}getExtent(a,b){const c=this.sourceSizeWidth,d=this.sourceSizeHeight;let e,f,g,j;return this.trimmed?(e=this.spriteSourceSizeX-a*c,f=e+this.spriteSourceSizeWidth,g=this.spriteSourceSizeY-b*d,j=g+this.spriteSourceSizeHeight):(e=-a*c,f=e+c,g=-b*d,j=g+d),{left:e,right:f,top:g,bottom:j}}setExtent(a){const b=a.transform,c=b.origin.x,d=b.origin.y,e=this.sourceSizeWidth,f=this.sourceSizeHeight;let g,j,i,m;this.trimmed?(g=this.spriteSourceSizeX-c*e,j=this.spriteSourceSizeY-d*f,i=this.spriteSourceSizeWidth,m=this.spriteSourceSizeHeight):(g=-c*e,j=-d*f,i=e,m=f),b.setExtent(g,j,i,m)}updateUVs(){const{x:a,y:b,width:c,height:d}=this,e=this.texture.width,f=this.texture.height;this.u0=a/e,this.v0=b/f,this.u1=(a+c)/e,this.v1=(b+d)/f}}class Ya{constructor(a,b,c){this.key="",a&&(b=a.width,c=a.height),this.image=a,this.width=b,this.height=c,this.frames=new Map(),this.data={},this.addFrame("__BASE",0,0,b,c),Tb.add(this)}addFrame(a,b,c,d,e){if(this.frames.has(a))return null;const f=new Ve(this,a,b,c,d,e);return this.frames.set(a,f),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=f),f}getFrame(a){if(!a)return this.firstFrame;a instanceof Ve&&(a=a.key);let b=this.frames.get(a);return b||(console.warn(`Frame missing: ${a}`),b=this.firstFrame),b}setSize(a,b){this.width=a,this.height=b;const c=this.frames.get("__BASE");c.setSize(a,b)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}}let nh;const oc={get:()=>nh,set:a=>{nh=a}};const sh={fragmentShader:`\r
#define SHADER_NAME SINGLE_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture;\r
\r
void main (void)\r
{\r
    vec4 color = texture2D(uTexture, vTextureCoord);\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`,vertexShader:`\r
#define SHADER_NAME SINGLE_QUAD_VERT\r
\r
precision highp float;\r
\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
attribute float aTextureId;\r
attribute vec4 aTintColor;\r
\r
uniform mat4 uProjectionMatrix;\r
uniform mat4 uCameraMatrix;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
void main (void)\r
{\r
    vTextureCoord = aTextureCoord;\r
    vTextureId = aTextureId;\r
    vTintColor = aTintColor;\r
\r
    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\r
}`};class dd{constructor(a={}){this.attribs={aVertexPosition:0,aTextureCoord:0,aTextureId:0,aTintColor:0},this.uniforms={uProjectionMatrix:0,uCameraMatrix:0,uTexture:0,uTime:0,uResolution:0},this.renderToFBO=!1,this.renderer=oc.get();const{batchSize:b=4096,dataSize:c=4,indexSize:d=4,vertexElementSize:e=6,quadIndexSize:f=6,fragmentShader:g=sh.fragmentShader,vertexShader:j=sh.vertexShader,width:i=Pb(),height:m=Qb(),resolution:n=Rb(),renderToFBO:u=!1}=a;this.buffer=new oh(b,c,d,e,f),this.createShaders(g,j),this.count=0,this.renderToFBO=u;const A=new Ya(null,i*n,m*n),B=new ed(A);A.binding=B,B.framebuffer=ph(B.texture),this.texture=A,this.framebuffer=B.framebuffer}createShaders(a,b){const c=this.renderer.gl,d=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(d,a),c.compileShader(d);let e=!1,f=c.getShaderInfoLog(d);f.length>0&&(e=!0,console.error(f));const g=c.createShader(c.VERTEX_SHADER);c.shaderSource(g,b),c.compileShader(g),f=c.getShaderInfoLog(d),f.length>0&&(e=!0,console.error(f));if(e)return;const j=c.createProgram();c.attachShader(j,g),c.attachShader(j,d),c.linkProgram(j),c.useProgram(j),this.program=j;for(const i of Object.keys(this.attribs)){const m=c.getAttribLocation(j,i);c.enableVertexAttribArray(m),this.attribs[i]=m}for(const i of Object.keys(this.uniforms))this.uniforms[i]=c.getUniformLocation(j,i)}bind(a,b,c){if(!this.program)return!1;const d=this.renderer,e=d.gl,f=this.uniforms;return e.useProgram(this.program),e.uniformMatrix4fv(f.uProjectionMatrix,!1,a),e.uniformMatrix4fv(f.uCameraMatrix,!1,b),e.uniform1i(f.uTexture,d.textures.textureIndex[c]),e.uniform1f(f.uTime,performance.now()),e.uniform2f(f.uResolution,d.width,d.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}bindBuffers(a,b){const c=this.renderer.gl,d=this.buffer.vertexByteSize,e=this.attribs;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a),c.bindBuffer(c.ARRAY_BUFFER,b),c.vertexAttribPointer(e.aVertexPosition,2,c.FLOAT,!1,d,0),c.vertexAttribPointer(e.aTextureCoord,2,c.FLOAT,!1,d,8),c.vertexAttribPointer(e.aTextureId,1,c.FLOAT,!1,d,16),c.vertexAttribPointer(e.aTintColor,4,c.UNSIGNED_BYTE,!0,d,20),this.count=0}draw(a){const b=this.renderer,c=b.gl,d=this.buffer;if(a===d.batchSize)c.bufferData(c.ARRAY_BUFFER,d.data,c.DYNAMIC_DRAW);else{const e=d.vertexViewF32.subarray(0,a*d.quadElementSize);c.bufferSubData(c.ARRAY_BUFFER,0,e)}this.renderToFBO&&b.fbo.add(this.framebuffer,!0),c.drawElements(c.TRIANGLES,a*d.quadIndexSize,c.UNSIGNED_SHORT,0),this.renderToFBO&&b.fbo.pop()}flush(){const a=this.count;return a===0?!1:(this.draw(a),this.prevCount=a,this.count=0,!0)}}const zl=`\r
#define SHADER_NAME MULTI_QUAD_FRAG\r
\r
precision highp float;\r
\r
varying vec2 vTextureCoord;\r
varying float vTextureId;\r
varying vec4 vTintColor;\r
\r
uniform sampler2D uTexture[%count%];\r
\r
void main (void)\r
{\r
    vec4 color;\r
\r
    %forloop%\r
\r
    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\r
}`;class jh extends dd{constructor(a={fragmentShader:zl}){super(a)}createShaders(a,b){const c=jc();let d="";for(let e=1;e<c;e++)e>1&&(d+=`
	else `),e<c-1&&(d+=`if (vTextureId < ${e}.5)`),d+=`
	{`,d+=`
		color = texture2D(uTexture[${e}], vTextureCoord);`,d+=`
	}`;a=a.replace(/%count%/gi,`${c}`),a=a.replace(/%forloop%/gi,d),super.createShaders(a,b)}bind(a,b){if(!this.program)return!1;const c=this.renderer,d=c.gl,e=this.uniforms;return d.useProgram(this.program),d.uniformMatrix4fv(e.uProjectionMatrix,!1,a),d.uniformMatrix4fv(e.uCameraMatrix,!1,b),d.uniform1iv(e.uTexture,c.textures.textureIndex),d.uniform1f(e.uTime,performance.now()),d.uniform2f(e.uResolution,c.width,c.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}}function kh(a,b,c=-1,d=1){const e=-2*(1/-a),f=-2*(1/b),g=2*(1/(c-d));return new Float32Array([e,0,0,0,0,f,0,0,0,0,g,0,-1,1,0,1])}class lh{constructor(a,b){this.renderer=a;const c={shader:new b()};this.stack=[c],this.currentEntry=c,this.current=c.shader,this.singleQuadShader=new dd()}add(a,b){const c={shader:a,textureID:b};return this.stack.push(c),c}set(a,b){this.flush();const c=this.renderer,d=c.projectionMatrix,e=c.currentCamera.matrix,f=a.bind(d,e,b);if(f){const g=this.add(a,b);this.currentEntry=g,this.current=a}return f}setDefault(a){this.set(this.singleQuadShader,a)}pop(){this.flush();const a=this.stack;a.length>1&&a.pop(),this.currentEntry=a[a.length-1],this.current=this.currentEntry.shader}reset(){this.pop(),this.rebind()}flush(){return this.current.flush()?(this.renderer.flushTotal++,!0):!1}rebind(){const a=this.renderer,b=a.projectionMatrix,c=a.currentCamera.matrix,d=this.currentEntry;d.shader.bind(b,c,d.textureID)}popAndRebind(){this.pop(),this.rebind()}clear(){}destroy(){}}const xl=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function yl(a){let b="";for(let c=0;c<a;++c)c>0&&(b+=`
else `),c<a-1&&(b+=`if(test == ${c}.0){}`);return b}function rh(a,b){const c=b.createShader(b.FRAGMENT_SHADER);for(;;){const d=xl.replace(/%forloop%/gi,yl(a));b.shaderSource(c,d),b.compileShader(c);if(!b.getShaderParameter(c,b.COMPILE_STATUS))a=a/2|0;else break}return a}class mh{constructor(a){this.startActiveTexture=0,this.renderer=a,this.tempTextures=[],this.textureIndex=[]}init(){const a=this.renderer.gl;let b=rh(a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),a);const c=jc();c===0||c>0&&c>b?Ie(b):c>0&&c<b&&(b=Math.max(8,c));const d=this.tempTextures;d.length&&d.forEach(f=>{a.deleteTexture(f)});const e=[];for(let f=0;f<b;f++){const g=a.createTexture();a.activeTexture(a.TEXTURE0+f),a.bindTexture(a.TEXTURE_2D,g),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),d[f]=g,e.push(f)}this.maxTextures=b,this.textureIndex=e,this.currentActiveTexture=1}update(){const a=Tb.get();for(let b=0;b<a.length;b++){const c=a[b];c.binding||(c.binding=new ed(c))}Tb.clear()}reset(){const a=this.renderer.gl,b=this.tempTextures;for(let c=0;c<b.length;c++)a.activeTexture(a.TEXTURE0+c),a.bindTexture(a.TEXTURE_2D,b[c]);this.currentActiveTexture=1,this.startActiveTexture++}bind(a,b=0){const c=this.renderer.gl,d=a.binding;d.setIndex(b),c.activeTexture(c.TEXTURE0+b),c.bindTexture(c.TEXTURE_2D,d.texture)}unbind(a=0){const b=this.renderer.gl;b.activeTexture(b.TEXTURE0+a),b.bindTexture(b.TEXTURE_2D,this.tempTextures[a]),a>0&&this.startActiveTexture++}request(a){const b=this.renderer.gl,c=a.binding,d=this.currentActiveTexture;return c.indexCounter>=this.startActiveTexture?!1:(c.indexCounter=this.startActiveTexture,d<this.maxTextures?(c.setIndex(d),b.activeTexture(b.TEXTURE0+d),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture++):(this.renderer.flush(),this.startActiveTexture++,c.indexCounter=this.startActiveTexture,c.setIndex(1),b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,c.texture),this.currentActiveTexture=2),!0)}}class Og{constructor(){this.clearColor=[0,0,0,1],this.flushTotal=0,this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.currentCamera=null,this.width=Pb(),this.height=Qb(),this.resolution=Rb(),this.setBackgroundColor(Qc());const a=document.createElement("canvas");a.addEventListener("webglcontextlost",b=>this.onContextLost(b),!1),a.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=a,this.fbo=new hh(this),this.textures=new mh(this),this.initContext(),oc.set(this),this.shaders=new lh(this,jh)}initContext(){const a=this.canvas.getContext("webgl",Ke());Aa.set(a),this.gl=a,a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE),this.resize(this.width,this.height,this.resolution),this.textures.init()}resize(a,b,c=1){this.width=a*c,this.height=b*c,this.resolution=c;const d=this.canvas;d.width=this.width,d.height=this.height,this.autoResize&&(d.style.width=(this.width/c).toString()+"px",d.style.height=(this.height/c).toString()+"px"),this.gl.viewport(0,0,this.width,this.height),this.projectionMatrix=kh(a,b)}onContextLost(a){a.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(a){return ih(a,this.clearColor),this}reset(a=null,b=this.width,c=this.height){const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),d.viewport(0,0,b,c),d.enable(d.BLEND),d.blendFunc(d.ONE,d.ONE_MINUS_SRC_ALPHA),this.flushTotal=0,this.currentCamera=null,this.textures.update()}render(a){if(this.contextLost)return;this.reset();if(this.optimizeRedraw&&a.numDirtyFrames===0&&a.numDirtyCameras===0)return;const b=this.gl;if(this.clearBeforeRender){const d=this.clearColor;b.clearColor(d[0],d[1],d[2],d[3]),b.clear(b.COLOR_BUFFER_BIT)}const c=a.worldData;for(let d=0;d<c.length;d++){const{camera:e,renderList:f}=c[d];(!this.currentCamera||!dh(e.worldTransform,this.currentCamera.worldTransform))&&(this.flush(),this.currentCamera=e,this.shaders.rebind()),f.forEach(g=>{g.children.length?this.renderNode(g):g.node.renderGL(this)})}this.flush()}renderNode(a){a.node.renderGL(this),a.children.forEach(b=>{b.children.length>0?this.renderNode(b):b.node.renderGL(this)}),a.node.postRenderGL(this)}flush(){this.shaders.flush()}destroy(){oc.set(void 0)}}function ze(){return()=>{Rc(Og)}}function ya(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);for(const e of d)e.callback.apply(e.context,c),e.once&&d.delete(e);return d.size===0&&a.events.delete(b),!0}function vg(a,b){const c=Sc(b);return c.appendChild(a),a}function wg(a){const b=document.readyState;if(b==="complete"||b==="interactive"){a();return}const c=()=>{document.removeEventListener("deviceready",c,!0),document.removeEventListener("DOMContentLoaded",c,!0),window.removeEventListener("load",c,!0),a()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",c,!0):(document.addEventListener("DOMContentLoaded",c,!0),window.addEventListener("load",c,!0)):window.setTimeout(c,20)}class xg{constructor(){this.events=new Map()}}class Uc{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function Sb(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new Uc(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function Wc(a,b,c,d=a){return Sb(a,b,c,d,!0)}function vh(){return{gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]}}function yh(a,b=0){a.gameFrame=b,a.numTotalFrames=0,a.numDirtyFrames=0,a.numDirtyCameras=0,a.worldData.length=0}let zh;const gd={get:()=>zh,set:a=>{zh=a}};class yg{constructor(){this.scenes=new Map(),this.sceneIndex=0,this.flush=!1,this.renderResult=vh(),this.game=wa.get(),gd.set(this),Wc(this.game,"boot",()=>this.boot())}boot(){Je().forEach(a=>new a())}update(a,b){for(const c of this.scenes.values())ya(c,"update",a,b)}render(a){const b=this.renderResult;yh(b,a);for(const c of this.scenes.values())ya(c,"render",b);return this.flush&&(b.numDirtyFrames++,this.flush=!1),b}}function qc(a,b){const c=document.createElement("canvas");return c.width=a,c.height=b,c.getContext("2d")}let Ah;const kb={get:()=>Ah,set:a=>{Ah=a}};class zg{constructor(){this.textures=new Map(),this.createDefaultTextures(),kb.set(this)}createDefaultTextures(){this.add("__BLANK",new Ya(qc(32,32).canvas));const a=qc(32,32);a.strokeStyle="#0f0",a.moveTo(0,0),a.lineTo(32,32),a.stroke(),a.strokeRect(.5,.5,31,31),this.add("__MISSING",new Ya(a.canvas))}get(a){const b=this.textures;return b.has(a)?b.get(a):b.get("__MISSING")}has(a){return this.textures.has(a)}add(a,b){let c;const d=this.textures;return d.has(a)||(b instanceof Ya?c=b:c=new Ya(b),c.key=a,d.set(a,c)),c}}class ng extends xg{constructor(...a){super();this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,wa.set(this),wg(()=>this.boot(a))}boot(a){a.forEach(d=>d());const b=De();this.renderer=new b(),this.textureManager=new zg(),this.sceneManager=new yg();const c=Ee();c&&vg(this.renderer.canvas,c),this.isBooted=!0,Ce(),ya(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(a){const b=a-this.lastTick;this.lastTick=a,this.elapsed+=b,this.isPaused||(this.willUpdate&&(this.sceneManager.update(b,a),ya(this,"update",b,a)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,wa.setFrame(this.frame),wa.setElapsed(this.elapsed),requestAnimationFrame(c=>this.step(c))}destroy(){}}function wh(a,b,c){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:c}function xh(a,b={}){const c=gd.get(),d=c.scenes.size,e=c.sceneIndex,f=d===0;typeof b==="string"?a.key=b:(b||!b&&f)&&(a.key=wh(b,"key","scene"+e.toString())),c.scenes.has(a.key)?console.warn("Scene key already in use: "+a.key):(c.scenes.set(a.key,a),c.flush=!0,c.sceneIndex++)}class og{constructor(a){this.game=wa.get(),this.events=new Map(),xh(this,a)}}class vb{constructor(a=1,b=0,c=0,d=1,e=0,f=0){this.set(a,b,c,d,e,f)}set(a=1,b=0,c=0,d=1,e=0,f=0){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=e,this.ty=f,this}identity(){return this.set()}toArray(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]}fromArray(a){return this.set(a[0],a[1],a[2],a[3],a[4],a[5])}}function ad(a,b,c){return a.width<=0||a.height<=0?!1:a.x<=b&&a.x+a.width>=b&&a.y<=c&&a.y+a.height>=c}class Fa{constructor(a=0,b=0,c=0,d=0){this.set(a,b,c,d)}set(a=0,b=0,c=0,d=0){return this.x=a,this.y=b,this.width=c,this.height=d,this}contains(a,b){return ad(this,a,b)}set right(a){a<=this.x?this.width=0:this.width=a-this.x}get right(){return this.x+this.width}set bottom(a){a<=this.y?this.height=0:this.height=a-this.y}get bottom(){return this.y+this.height}}function fh(){}class eb{constructor(a,b=0,c=0,d=!1){this.compareValue=!1,this._x=b,this._y=c,this.callback=a,this.compareValue=d}set(a=0,b=0){return this._x=a,this._y=b,this.callback(this),this}destroy(){this.callback=fh}set x(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._x=a,this.callback(this))}get x(){return this._x}set y(a){(!this.compareValue||this.compareValue&&a!==this._x)&&(this._y=a,this.callback(this))}get y(){return this._y}}function ch(a,b,c){const d=c-b;return b+((a-b)%d+d)%d}function Dg(a){return ch(a,-Math.PI,Math.PI)}class Eg{constructor(){this._rotation=0,this.type="Camera",this.dirtyRender=!0;const a=wa.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1]),this.bounds=new Fa(),this.worldTransform=new vb(),this.position=new eb(()=>this.updateTransform(),0,0),this.scale=new eb(()=>this.updateTransform(),1,1),this.origin=new eb(()=>this.updateTransform(),.5,.5),this.reset()}updateTransform(){const a=this.matrix,b=this.position.x,c=this.position.y,d=this.scale.x,e=this.scale.y,f=-b+this.width*this.origin.x,g=-c+this.height*this.origin.y,j=Math.sin(this.rotation),i=Math.cos(this.rotation),m=j+j,n=j*m,u=i*m,A=(1-n)*d,B=u*d,E=-u*e,G=(1-n)*e;a[0]=A,a[1]=B,a[4]=E,a[5]=G,a[12]=b+f-(A*f+E*g),a[13]=c+g-(B*f+G*g),this.worldTransform.set(i*d,j*d,-j*e,i*e,-b,-c);const H=this.width*(1/d),K=this.height*(1/e);this.bounds.set(f-H/2,g-K/2,H,K),this.dirtyRender=!0}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}set rotation(a){a!==this._rotation&&(this._rotation=Dg(a),this.updateTransform())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.origin.destroy(),this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}class Fg{constructor(){this.type="StaticCamera",this.dirtyRender=!0;const a=wa.get();this.renderer=a.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.bounds=new Fa(),this.worldTransform=new vb(),this.reset()}reset(){const a=this.renderer.width,b=this.renderer.height;this.width=a,this.height=b,this.bounds.set(0,0,a,b)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}function xb(a){const b=[a],c=[];for(;b.length>0;){const d=b.shift();c.push(d);const e=d.numChildren;if(e>0)for(let f=e-1;f>=0;f--)b.unshift(d.children[f])}return c.shift(),c}function fb(a,b){return a.children.indexOf(b)}function Tc(a,b){const c=a.children;let d;if(b>=0&&b<c.length){const e=c.splice(b,1);e[0]&&(d=e[0],d.parent=null)}return d}function lc(a,b){const c=fb(a,b);return c>-1&&Tc(a,c),b}const Pe="addedtoworld";const Xc="destroy";const Vg="postupdate";const Qe="removedfromworld";const Wg="update";function Oe(a,...b){return b.forEach(c=>{c.world&&(ya(c.world,Qe,c,c.world),ya(c,Qe,c,c.world)),c.world=a,ya(a,Pe,c,a),ya(c,Pe,c,a)}),b}function wb(a,...b){b.forEach(d=>{d.parent&&lc(d.parent,d),d.parent=a});const c=a.world;return c&&Oe(c,...xb(a)),b}const aa={CLEAR:0,TRANSFORM:1,UPDATE:2,CHILD_CACHE:4,POST_RENDER:8,COLORS:16,BOUNDS:32,TEXTURE:64,FRAME:128,ALPHA:256,CHILD:512,DEFAULT:1+2+16+32,USER1:536870912,USER2:1073741824,USER3:2147483648,USER4:4294967296};function kc(a,b=0,c){const d=a.children;c===void 0&&(c=d.length);const e=c-b;if(e>0&&e<=c){const f=d.splice(b,e);return f.forEach(g=>{g.parent=null}),f}else return[]}function Le(a,b=0,c){const d=kc(a,b,c);d.forEach(e=>{e.destroy()})}function Me(a,...b){return b.forEach(c=>{lc(a,c)}),b}function Ne(a,b,c=0,d){const e=kc(a,c,d);return wb(b,...e),e.forEach(f=>{f.transform.updateWorld()}),e}function Vc(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof Uc)g.delete(c);else{const j=!d,i=e!==void 0;for(const m of g)m.callback===c&&(j&&m.context===d)&&(i&&m.once===e)&&g.delete(m)}return g.size===0&&f.delete(b),a}function Zc(a){const{a:b,b:c,c:d,d:e,tx:f,ty:g}=a.world,{x:j,y:i,right:m,bottom:n}=a.extent,u=j*b+i*d+f,A=j*c+i*e+g,B=j*b+n*d+f,E=j*c+n*e+g,G=m*b+n*d+f,H=m*c+n*e+g,K=m*b+i*d+f,I=m*c+i*e+g;return{x0:u,y0:A,x1:B,y1:E,x2:G,y2:H,x3:K,y3:I}}class Pg{constructor(a){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=a,this.area=new Fa()}set(a,b,c,d){this.area.set(a,b,c,d)}get(){return this.entity.isDirty(aa.BOUNDS)&&!this.fixed&&this.update(),this.area}updateLocal(){const{x0:a,y0:b,x1:c,y1:d,x2:e,y2:f,x3:g,y3:j}=Zc(this.entity.transform),i=Math.min(a,c,e,g),m=Math.min(b,d,f,j),n=Math.max(a,c,e,g),u=Math.max(b,d,f,j);return this.area.set(i,m,n-i,u-m)}update(){const a=this.updateLocal();this.entity.clearDirty(aa.BOUNDS);if(!this.includeChildren||!this.entity.numChildren)return a;const b=this.visibleOnly,c=this.entity.children;let d=a.x,e=a.y,f=a.right,g=a.bottom;for(let j=0;j<c.length;j++){const i=c[j];if(!i||b&&!i.visible)continue;const m=i.bounds.get();m.x<d&&(d=m.x),m.y<e&&(e=m.y),m.right>f&&(f=m.right),m.bottom>g&&(g=m.bottom)}return a.set(d,e,f-d,g-e)}destroy(){this.entity=null,this.area=null}}class Qg{constructor(a){this.enabled=!1,this.enabledChildren=!0,this.entity=a}destroy(){this.entity=null,this.hitArea=null}}class Xa{constructor(a=0,b=0){this.set(a,b)}set(a=0,b=0){return this.x=a,this.y=b,this}getArray(){return[this.x,this.y]}fromArray(a){return this.set(a[0],a[1])}toString(){return`[x=${this.x}, y=${this.y}]`}}function Sg(a){const b=a.local,c=a.position.x,d=a.position.y,e=a.rotation,f=a.scale.x,g=a.scale.y,j=a.skew.x,i=a.skew.y;b.set(Math.cos(e+i)*f,Math.sin(e+i)*f,-Math.sin(e-j)*g,Math.cos(e-j)*g,c,d)}function Re(a,b){return b.set(a.a,a.b,a.c,a.d,a.tx,a.ty)}function Tg(a){const b=a.parent,c=a.transform,d=c.local,e=c.world;if(!b)Re(d,e);else if(c.passthru)Re(b.transform.world,e);else{const{a:f,b:g,c:j,d:i,tx:m,ty:n}=d,{a:u,b:A,c:B,d:E,tx:G,ty:H}=b.transform.world;e.set(f*u+g*B,f*A+g*E,j*u+i*B,j*A+i*E,m*u+n*B+G,m*A+n*E+H)}}class Rg{constructor(a,b=0,c=0){this.passthru=!1,this._rotation=0,this.entity=a,this.local=new vb(),this.world=new vb(),this.position=new eb(()=>this.update(),b,c),this.scale=new eb(()=>this.update(),1,1,!0),this.skew=new eb(()=>this.update(),0,0,!0),this.origin=new eb(()=>this.updateExtent(),Ge,He),this.extent=new Fa()}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(aa.TRANSFORM,aa.BOUNDS),Sg(this)}updateWorld(){const a=this.entity;a.setDirty(aa.TRANSFORM,aa.BOUNDS),Tg(a),a.numChildren&&this.updateChildren()}updateChildren(){const a=this.entity.children;for(let b=0;b<a.length;b++){const c=a[b];c.transform.updateWorld()}}globalToLocal(a,b,c=new Xa()){const{a:d,b:e,c:f,d:g,tx:j,ty:i}=this.world,m=1/(d*g+f*-e);return c.x=g*m*a+-f*m*b+(i*f-j*g)*m,c.y=d*m*b+-e*m*a+(-i*d+j*e)*m,c}localToGlobal(a,b,c=new Xa()){const{a:d,b:e,c:f,d:g,tx:j,ty:i}=this.world;return c.x=d*a+f*b+j,c.y=e*a+g*b+i,c}setExtent(a,b,c,d){this.extent.set(a,b,c,d),this.entity.setDirty(aa.TRANSFORM,aa.BOUNDS)}updateExtent(a,b){const c=this.extent,d=this.entity;a!==void 0&&(c.width=a),b!==void 0&&(c.height=b),c.x=-this.origin.x*c.width,c.y=-this.origin.y*c.height,d.setDirty(aa.TRANSFORM,aa.BOUNDS)}set rotation(a){a!==this._rotation&&(this._rotation=a,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}}class Yc{constructor(a=0,b=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.events=new Map(),this.transform=new Rg(this,a,b),this.bounds=new Pg(this),this.input=new Qg(this),this.dirty=aa.DEFAULT,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(a){return(this.dirty&a)!==0}clearDirty(a){return this.isDirty(a)&&(this.dirty^=a),this}setDirty(a,b){return this.isDirty(a)||(this.dirty^=a,this.dirtyFrame=wa.getFrame()),this.isDirty(b)||(this.dirty^=b),this}update(a,b){if(this.willUpdateChildren){const c=this.children;for(let d=0;d<c.length;d++){const e=c[d];e&&e.willUpdate&&e.update(a,b)}}this.postUpdate(a,b)}postUpdate(a,b){}renderGL(a){}renderCanvas(a){}postRenderGL(a){}postRenderCanvas(a){}get numChildren(){return this.children.length}destroy(a){a?Ne(this,a):Le(this),ya(this,Xc,this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}}const bd="worldrender";const cd="worldshutdown";var wl=Object.freeze({__proto__:null,WorldRenderEvent:bd,WorldShutdownEvent:cd});function hd(a,b){b.numRendered++,b.numRenderable++,a.node.dirtyFrame>=b.gameFrame&&b.dirtyFrame++,a.children.forEach(c=>{c.children.length>0&&hd(c,b)})}function Ze(a){if(a.node.isDirty(aa.CHILD_CACHE))return!0;const b=[a];for(;b.length>0;){const c=b.pop();if(c.node.isDirty(aa.TRANSFORM))return!0;const d=c.children.length;if(d>0)for(let e=0;e<d;e++)b.push(c.children[e])}return b.length=0,!1}function Ye(a,b){a.forEach(c=>{b||Ze(c)?c.node.setDirty(aa.CHILD_CACHE):c.children.length=0})}function id(a,b,c=[]){for(let d=0;d<b.numChildren;d++){const e=b.children[d];if(e.isRenderable()){const f=[],g={node:e,children:f};c.push(g),e.willRenderChildren&&e.numChildren>0&&(e.willCacheChildren&&a.push(g),id(a,e,f))}}return c}function We(a){const b=[],c=[],d=id(b,a,c),e=a.renderData;b.length>0&&Ye(b,a.camera.dirtyRender),d.forEach(f=>{f.children.length?hd(f,e):(e.numRendered++,e.numRenderable++,f.node.dirtyFrame>=e.gameFrame&&e.dirtyFrame++)}),e.renderList=d,a.forceRefresh&&(e.dirtyFrame++,a.forceRefresh=!1)}function Xe(a,b){a.numDirtyFrames+=b.dirtyFrame,a.numTotalFrames+=b.numRendered,b.camera.dirtyRender&&a.numDirtyCameras++,a.worldData.push(b)}function rc(a,b){a.gameFrame=b,a.dirtyFrame=0,a.numRendered=0,a.numRenderable=0,a.renderList.length=0}class sc extends Yc{constructor(a){super();this.forceRefresh=!1,this.type="BaseWorld",this.scene=a,this.world=this,this.events=new Map(),this._updateListener=Sb(a,"update",(b,c)=>this.update(b,c)),this._renderListener=Sb(a,"render",b=>this.render(b)),this._shutdownListener=Sb(a,"shutdown",()=>this.shutdown()),Wc(a,"destroy",()=>this.destroy())}update(a,b){if(!this.willUpdate)return;ya(this,Wg,a,b,this),super.update(a,b)}postUpdate(a,b){ya(this,Vg,a,b,this)}render(a){const b=this.renderData;rc(b,a.gameFrame);if(!this.willRender||!this.visible)return;We(this),ya(this,bd,b,this),Xe(a,b),this.camera&&(this.camera.dirtyRender=!1)}shutdown(){const a=this.scene;Vc(a,"update",this._updateListener),Vc(a,"render",this._renderListener),Vc(a,"shutdown",this._shutdownListener),Me(this),ya(this,cd,this),rc(this.renderData,0),this.camera&&this.camera.reset()}destroy(a){super.destroy(a),ya(this,Xc,this),rc(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}}function tc(a){return{camera:a,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0,renderList:[]}}class Ae extends sc{constructor(a){super(a);this.type="StaticWorld",this.camera=new Fg(),this.renderData=tc(this.camera)}}class Al extends sc{constructor(a){super(a);this.enableCameraCull=!0,this.type="World",this.camera=new Eg(),this.renderData=tc(this.camera)}}function Oc(a,b){return a.children.push(b),wb(a,b),b.transform.updateWorld(),b}var dg;(function(a){a[a.IDLE=0]="IDLE",a[a.UPDATING=1]="UPDATING"})(dg||(dg={}));function Qa(a,b){return a===void 0||b===void 0?void 0:`${a}|${b}`}function Di(a,b){let c=a.split("|");return b===void 0&&(b=xm),b.x=parseInt(c[0]),b.y=parseInt(c[1]),b}let xm={x:0,y:0};class Mb{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(a){return this.items.push(a),this}pushMultiple(a){return this.items.push.apply(this.items,a),a.length=0,this}clear(){return this.items.length=0,this}}let fl=new Mb();function Lh(){let a=fl.pop();return a===null&&(a=new Map()),a}function Bd(a){fl.push(a)}function Jh(a,b,c,d,e,f,g,j){if(c===f&&d===g&&e===j)return;let i=Qa(c,d),m=Qa(f,g);if(i){let n=b.get(i);n.delete(e);if(i===m){n.set(j,a);return}else n.size===0&&(Bd(n),b.delete(i))}if(m){let n=b.get(m);n?n.set(j,a):(n=Lh(),n.set(j,a),b.set(m,n))}}function rf(a,b,c,d){let e=Qa(b,c),f=a.get(e);f&&(d!==void 0?(f.delete(d),f.size===0&&(Bd(f),a.delete(e))):(f.clear(),Bd(f),a.delete(e)))}let gl=new Mb();function Kh(){let a=gl.pop();return a===null&&(a=new Set()),a}function qf(a){gl.push(a)}function Ad(a,b,c,d){if(c===d)return;if(c!==void 0){let e=b.get(c);e&&(e.delete(a),e.size===0&&(qf(e),b.delete(c)))}if(d!==void 0){let e=b.get(d);e?e.add(a):(e=Kh(),e.add(a),b.set(d,e))}}function Bb(a,b,c){let d=a.get(b);d&&(d.delete(c),d.size===0&&(qf(d),a.delete(b)))}function Eh(a,b,c,d,e){let f=a.chessToXYZ.get(b),g=f?f.x:void 0,j=f?f.y:void 0,i=f?f.y:void 0;f?(f.x=c,f.y=d,f.z=e):a.chessToXYZ.set(b,{x:c,y:d,z:e}),Jh(b,a.XYToZMap,g,j,i,c,d,e),Ad(b,a.XToChessSet,g,c),Ad(b,a.YToChessSet,j,d),Ad(b,a.ZToChessSet,i,e)}function Ab(a,b,c,d){let e=a.XYToZMap.get(Qa(b,c));return e===void 0?null:d!==void 0?e.has(d)?e.get(d):null:e}function Fh(a,b,c,d){if(d!==void 0){let e=Ab(a,b,c,d);if(e===void 0)return;a.chessToXYZ.delete(e),rf(a.XYToZMap,b,c,d),Bb(a.XToChessSet,b,e),Bb(a.YToChessSet,c,e),Bb(a.ZToChessSet,d,e)}else{let e=Ab(a,b,c);if(e){for(const[f,g]of e)a.chessToXYZ.delete(g),Bb(a.XToChessSet,b,g),Bb(a.YToChessSet,c,g),Bb(a.ZToChessSet,f,g);rf(a.XYToZMap,b,c)}}}function Gh(a,b){return a.chessToXYZ.has(b)}function Hh(a,b,c,d){return Ab(a,b,c,d)!==null}function Ih(a,b){return a.chessToXYZ.get(b)||null}function of(a){let b=-Infinity;for(const[c,d]of a)b<c&&(b=c);return b}function pf(a){let b=Infinity;for(const[c,d]of a)b>c&&(b=c);return b}class _e{constructor(){this.chessToXYZ=new Map(),this.XYToZMap=new Map(),this.XToChessSet=new Map(),this.YToChessSet=new Map(),this.ZToChessSet=new Map(),this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0}destroy(){this.clear()}clear(){return this.chessToXYZ.clear(),this.XYToZMap.clear(),this.XToChessSet.clear(),this.YToChessSet.clear(),this.ZToChessSet.clear(),this.clearBounds(),this}clearBounds(){return this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0,this}addChess(a,b,c,d){return Eh(this,a,b,c,d),this.clearBounds(),this}getChess(a,b,c){return Ab(this,a,b,c)}removeChess(a,b,c){return Fh(this,a,b,c),this.clearBounds(),this}hasChess(a){return Gh(this,a)}contains(a,b,c){return Hh(this,a,b,c)}getXYZ(a){return Ih(this,a)}get xMax(){return this._xMax===void 0&&(this._xMax=of(this.XToChessSet)),this._xMax}get xMin(){return this._xMin===void 0&&(this._xMin=pf(this.XToChessSet)),this._xMin}get yMax(){return this._yMax===void 0&&(this._yMax=of(this.YToChessSet)),this._yMax}get yMin(){return this._yMin===void 0&&(this._yMin=pf(this.YToChessSet)),this._yMin}}function Za(a,b=[]){let c=a.boardData.chessToXYZ;for(const[d,e]of c)b.push(d);return b}function Ei(a){if(typeof a!=="object"||a.nodeType||a===a.window)return!1;try{if(a.constructor&&!{}.hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0}function yc(a){return Ei(a)?!0:typeof a==="object"?a.isTileXYZ:!1}function ba(a,b){let c=a.boardData.getXYZ(b);return c?c:yc(b)?b:null}function qa(a,b,c,d){return a.boardData.getChess(b,c,d)}class Mh{constructor(a){this.parent=a,this.board=null,this.blocker=!1,this.boot()}boot(){typeof this.parent==="object"&&this.parent.on&&this.parent.on("destroy",this.destroy,this)}destroy(){if(this.board){let a=this.tileXYZ;this.board.boardData.removeChess(a.x,a.y,a.z)}this.parent=void 0,this.board=null}setBoard(a){return this.board=a,this}get tileXYZ(){return this.board==null?null:this.board.boardData.getXYZ(this.parent)}setBlocker(a=!0){return this.blocker=a,this}setBlockEdge(a,b=!0){typeof this.blocker==="boolean"&&(this.blocker={});let c=this.blocker;if(typeof a==="object"){let d=a;for(let e in d)c[e]=d[e]}else c[a]=b;return this}getBlockEdge(a){return typeof this.blocker==="boolean"?!1:this.blocker.hasOwnProperty(a)?this.blocker[a]:!1}}function Sa(a){return a.hasOwnProperty("rexChess")||(a.rexChess=new Mh(a)),a.rexChess}function La(a,b,c,d,e,f=!1,g=!1){if(b){let j=ba(a,b);if(j)c=j.x,d=j.y,e=j.z;else return}else{b=qa(a,c,d,e);if(!b)return}g||a.boardData.removeChess(c,d,e),a._isBoard&&Sa(b).setBoard(null),f&&b.destroy&&b.destroy()}function zb(a,b){if(a.infinityMode)return;if(a.height===void 0||a.height<=b){a.height=b;return}let c=Za(a);c.forEach(d=>{let e=ba(a,d);e.y>b&&La(a,d)}),a.height=b}function yb(a,b){if(a.infinityMode)return;if(a.width===void 0||a.width<=b){a.width=b;return}let c=Za(a);c.forEach(d=>{let e=ba(a,d);e.x>b&&La(a,d)}),a.width=b}class jd{constructor({grid:a=void 0,wrap:b=!1,inifinity:c=!1,width:d=0,height:e=0}={}){this.boardData=new _e(),this._isBoard=!0,this.setGrid(a),this.setWrapMode(b),this.setInfinityMode(c),this.setBoardSize(d,e)}destroy(){}setGrid(a){return this.grid=a,this}setWrapMode(a=!0){return this.wrapMode=a,this}setInfinityMode(a=!0){return this.infinityMode=a,this}setBoardSize(a=0,b=0){return yb(this,a),zb(this,b),this}}function Ra(a,b,c,d){let e;return a.infinityMode?e=!0:e=b>=0&&b<a.width&&c>=0&&c<a.height,e&&d!==void 0&&(e=a.boardData.contains(b,c,d)),e}function Da(a,b,c,d){return a.grid.getWorldXY(b,c,d)}function _b(a,b,c,d){if(b===void 0){let e=Za(a);for(let f=0,g=e.length;f<g;f++){let j=e[f],i=ba(a,j);Da(a,i.x,i.y,j)}}else{if(c===void 0){let e=ba(a,b);c=e.x,d=e.y}Da(a,c,d,b)}}function lb(a,b,c,d,e,f=!0){if(!Ra(a,c,d))return;let g=ba(a,b);e===void 0&&(g?e=g.z:e=0);if(g&&g.x===c&&g.y===d&&g.z===e)return;let j=qa(a,c,d,e);j&&La(a,null,c,d,e),a.boardData.addChess(b,c,d,e),a._isBoard&&Sa(b).setBoard(a),f&&_b(a,b,c,d)}function Fb(a,b,c,d){return Math.atan2(d-b,c-a)}function mb(a,b,c){let d=ba(a,b),e=ba(a,c),f=Da(a,d.x,d.y,!0),g=f.x,j=f.y;f=Da(a,e.x,e.y,!0);let i=f.x,m=f.y;return Fb(g,j,i,m)}function gb(a,b,c){let d=c-b;return b+((a-b)%d+d)%d}function Zb(a,b,c,d={x:0,y:0}){return d===!0&&(d=Gl),a.wrapMode?b=gb(b,0,a.width):!a.infinityMode&&(b<0||b>=a.width)&&(b=null),a.wrapMode?c=gb(c,0,a.height):!a.infinityMode&&(c<0||c>=a.height)&&(c=null),d.x=b,d.y=c,d}let Gl={x:0,y:0};function Ka(a,b,c,d,e){let f=ba(a,b);if(f===null)return null;typeof c==="string"&&(c.indexOf(",")===-1?c=parseInt(c):c=c.split(".").map(m=>parseInt(m,10)));let g=typeof c==="number",j=typeof d==="number";if(g&&j){let m=a.grid.getTileXYAtDirection(f,c,d,e);return Zb(a,m.x,m.y,m),(m.x===null||m.y===null)&&(m=null),m}Array.isArray(e)||(e=[]),c===null&&(c=a.grid.allDirections);let i;if(g)if(Array.isArray(d))for(let m=0,n=d.length;m<n;m++)i=Ka(a,f,c,d[m]),i!==null&&e.push(i);else{let m,n,u;({end:m=1,start:n=m>0?1:-1,step:u=m>=n?1:-1}=d);if(n===m)i=Ka(a,f,c,m),i!==null&&e.push(i);else if(n<m)for(let A=n;A<=m;A+=u)i=Ka(a,f,c,A),i!==null&&e.push(i);else for(let A=n;A>=m;A+=u)i=Ka(a,f,c,A),i!==null&&e.push(i)}else for(let m=0,n=c.length;m<n;m++)j?(i=Ka(a,f,c[m],d),i!==null&&e.push(i)):Ka(a,f,c[m],d,e);return e}function bb(a,b,c=null,d={x:0,y:0}){return Ka(a,b,c,1,d)}function Wb(a,b,c){b===void 0&&(b=Kl);let d=a.wrapMode,e=a.infinityMode;a.wrapMode=!1,a.infinityMode=!0;let f=bb(a,b,c,!0);return a.wrapMode=d,a.infinityMode=e,mb(a,b,f)}let Kl={x:0,y:0};const Mn=180/Math.PI;function bc(a){return a*Mn}function Qh(a,b){let c=b-a;if(c===0)return 0;let d=Math.floor((c- -180)/360);return c-d*360}function Vb(a,b,c){c=bc(c);let d=a.grid.allDirections,e=Infinity,f;for(let g=0,j=d.length;g<j;g++){let i=bc(Wb(a,b,d[g])),m=Math.abs(Qh(c,i));m<e&&(e=m,f=g)}return f}function Yb(a,b,c){if(b===null||c===null)return null;if(b.x===c.x&&b.y===c.y)return null;let d=a.grid.getNeighborTileDirection(b,c);if(a.wrapMode&&d===null){let e=bb(a,b,null);for(let f=0,g=e.length;f<g;f++){let j=e[f];if(c.x===j.x&&c.y===j.y){d=f;break}}}return d}function Xb(a,b,c){let d=ba(a,b),e=ba(a,c);return Yb(a,d,e)}function ld(a,b,c){return Xb(a,b,c)!==null}function md(a,b,c,d=!0){let e=ba(a,b),f=ba(a,c);return e===null||f===null?null:a.grid.directionBetween(e,f,d)}function vc(a,b,c=1,d=[]){let e=a.grid.ringToTileXYArray(b,c);for(let f=0,g=e.length;f<g;f++){let j=e[f];Ra(a,j.x,j.y)&&d.push(j)}return d}function $e(a,b,c,d=!0,e=[]){for(let f=0;f<=c;f++){let g=d?f:c-f;vc(a,b,g,e)}return e}function _a(a,b,c,d,e={x:0,y:0}){return e===!0&&(e=Il),c===0&&d===0?(e.x=b.x,e.y=b.y):a.grid.offset(b,c,d,e),e}let Il={x:0,y:0};function af(a,b){let c=Infinity,d=Infinity,e;for(let j=0,i=b.length;j<i;j++)e=b[j],c=Math.min(c,e.x),d=Math.min(d,e.y);if(c!==0||d!==0)for(let j=0,i=b.length;j<i;j++)e=b[j],_a(a,e,-c,-d,e);let f=-Infinity,g=-Infinity;for(let j=0,i=b.length;j<i;j++)e=b[j],f=Math.max(f,e.x),g=Math.max(g,e.y);return yb(a,f+1),zb(a,g+1),b}var Db;(function(a){a[a["x+,y+"]=0]="x+,y+",a[a["x-,y+"]=1]="x-,y+",a[a["y+,x+"]=2]="y+,x+",a[a["y-,x+"]=3]="y-,x+"})(Db||(Db={}));function nd(a,b,c,d=0){let e={x:0,y:0};switch(d){case 0:for(let f=0;f<a.height;f++)for(let g=0;g<a.width;g++)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 1:for(let f=0;f<a.height;f++)for(let g=a.width-1;g>=0;g--)e.x=g,e.y=f,c?b.call(c,e,a):b(e,a);break;case 2:for(let f=0;f<a.width;f++)for(let g=0;g<a.height;g++)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a);break;case 3:for(let f=0;f<a.width;f++)for(let g=a.height-1;g>=0;g--)e.x=f,e.y=g,c?b.call(c,e,a):b(e,a)}}function od(a,b,c,d){return a.grid.getDistance(b,c,d)}function uc(a,b=0,c=[]){if(Array.isArray(b)){let d=b;for(let e=0;e<a.height;e++)for(let f=0;f<a.width;f++){let g=!0;for(let j=0,i=d.length;j<i;j++)if(qa(a,f,e,d[j])!==null){g=!1;break}g&&c.push({x:f,y:e})}}else for(let d=0;d<a.height;d++)for(let e=0;e<a.width;e++)qa(a,e,d,b)===null&&c.push({x:e,y:d});return c}function pd(a,b,c,d){return a.grid.getGridPoints(b,c,d)}function Ma(a,b,c,d=[]){let e=a.boardData.getChess(b,c);for(const[f,g]of e)d.push(g);return d}function $b(a,b,c,d=[]){let e=c!=null,f,g;for(let j=0,i=b.length;j<i;j++)f=b[j],e?(g=qa(a,f.x,f.y,c),g!==null&&d.push(g)):Ma(a,f.x,f.y,d);return d}function qd(a,b,c,d,e){let f=ba(a,b);if(f===null)return null;d==null&&(d=f.hasOwnProperty("z")?f.z:null);let g=bb(a,f,c,!0);return g===null?null:Array.isArray(g)?(e===void 0&&(e=[]),$b(a,g,d,e)):d==null?(e===void 0&&(e=[]),Ma(a,g.x,g.y,e)):qa(a,g.x,g.y,d)}function rd(a,b,c,d={x:0,y:0}){let e=Vb(a,b,c);return Ka(a,b,e,1,d)}function sd(a,b,c,d){return a.grid.getOppositeDirection(b,c,d)}function wc(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function ac(a,b=0,c=a.length){let d=b+Math.floor(Math.random()*c);return a[d]===void 0?null:a[d]}function bf(a,b=0,c={x:0,y:0}){c===!0&&(c=Dl);let d=Math.floor(a.width*a.height*.3);for(let f=0;f<d;f++){let g=wc(0,a.width-1),j=wc(0,a.height-1);if(qa(a,g,j,b)===null)return c.x=g,c.y=j,c}let e=uc(a,b);if(e.length===0)return null;{let f=ac(e);return c.x=f.x,c.y=f.y,c}}let Dl={x:0,y:0};function cf(a,b,c,d){if(d===void 0){let e=Ma(a,b,c);for(let f=0,g=e.length;f<g;f++){let j=Sa(e[f]).blocker;if(j===!0)return!0}return!1}else{let e=qa(a,b,c,d);if(e===null)return!1;let f=Sa(e).blocker;return f===!0}}function df(a,b){return a.boardData.chessToXYZ.has(b)}function ef(a,b,c,d,e){if(d===void 0){let f=Ma(a,b,c);for(let g=0,j=f.length;g<j;g++)if(Dh(Sa(f[g]).blocker,e))return!0;return!1}else{let f=qa(a,b,c,d);return f===null?!1:Dh(Sa(f).blocker,e)}}function Dh(a,b){return a===!1||a===!0?a:a[b]===!0}function tf(a){return a=a%bl,a>=0?a:a+bl}const bl=Math.PI*2;function Rh(a,b,c=1e-4){return Math.abs(a-b)<c}function td(a,b,c,d,e){let f=ba(a,b),g=ba(a,c),j=mb(a,f,g);j=tf(j);let i=Math.abs(j-d);i=Math.min(i,Ll-i);let m=e/2;return Rh(i,m)||i<m}const Ll=Math.PI*2;function ud(a,b,c,d,e){let f=ba(a,b),g=ba(a,c),j=a.grid.directions;a.grid.directions=a.grid.sides;let i=a.grid.directionBetween(f,g,!1);a.grid.directions=j;let m=Math.abs(i-d);return m=Math.min(m,a.grid.directions-m),m<=e/2}function Ga(a,b,c,d={x:0,y:0}){return a.grid.getTileXY(b,c,d)}function vd(a,b,c,d){if(a.infinityMode&&d===void 0)return!0;let e=Ga(a,b,c,!0);return Ra(a,e.x,e.y,d)}function Ph(a,b,c,d){let e=a-c,f=b-d;return Math.sqrt(e*e+f*f)}function sf(a,b,c){return(b-a)*c+a}function ff(a,b,c,d,e,f=[]){let g=Ph(b,c,d,e),j=Math.min(a.grid.width,a.grid.height),i=Math.ceil(g/(j/4)),m;for(let n=0;n<=i;n++){let u=n/i,A=sf(b,d,u),B=sf(c,e,u),E=Ga(a,A,B);if(!Ra(a,E.x,E.y))continue;if(m&&m.x===E.x&&m.y===E.y)continue;f.push(E),m=E}return f}var Eb;(function(a){a[a.x=1]="x",a[a.horizontal=1]="horizontal",a[a.h=1]="h",a[a.y=2]="y",a[a.vertical=2]="vertical",a[a.v=2]="v",a[a.xy=3]="xy"})(Eb||(Eb={}));function gf(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=Hl),d!==null?_a(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.mirror(e,c,e),d!==null&&_a(a,e,d.x,d.y,e),e}let Hl={x:0,y:0};function hf(a,b=!1,c=!1){let d=Za(a);for(let e=0,f=d.length;e<f;e++)La(a,d[e],void 0,void 0,void 0,b,c)}function jf(a,b,c,d=null,e={x:0,y:0}){return e===!0&&(e=Jl),d!==null?_a(a,b,-d.x,-d.y,e):(e.x=b.x,e.y=b.y),a.grid.rotate(e,c,e),d!==null&&_a(a,e,d.x,d.y,e),e}let Jl={x:0,y:0};function kf(a,b,c){let d=ba(a,b);if(d===null)return;lb(a,b,d.x,d.y,c)}function xc(a,b,c){return Math.max(b,Math.min(c,a))}function lf(a,b,c,d=[]){let e=Ga(a,b.left,b.top,!0),f=e.x-1,g=e.y-1,j=Ga(a,b.right,b.bottom,!0),i=j.x+1,m=j.y+1;a.infinityMode||(f=xc(f,0,a.width-1),g=xc(g,0,a.height-1),i=xc(i,0,a.width-1),m=xc(m,0,a.height-1));for(let n=f;n<=i;n++)for(let u=g;u<=m;u++){let A=Da(a,n,u,!0);c(b,A.x,A.y)&&d.push({x:n,y:u})}return d}function mf(a,b,c,d=!0){let e=ba(a,b),f=ba(a,c);if(e==null||f==null)return;La(a,b),La(a,c),lb(a,b,f.x,f.y,f.z,d),lb(a,c,e.x,e.y,e.z,d)}function wd(a,b,c=[]){let d=a.boardData.ZToChessSet.get(b);if(d)for(const e of d)c.push(e);return c}function xd(a,b,c=[]){for(let d=0,e=b.length;d<e;d++){let f=b[d];c.push(Da(a,f.x,f.y))}return c}function yd(a,b,c,d={x:0,y:0}){return d===!0&&(d=Ml),Ga(a,b,c,d),Da(a,d.x,d.y,d),d}let Ml={x:0,y:0};function zd(a,b,c,d,e){let f=Ga(a,b,c,!0);return d!==void 0?qa(a,f.x,f.y,d):Ma(a,f.x,f.y,e)}class kd extends jd{addChess(a,b,c,d,e=!0){return lb(this,a,b,c,d,e),this}angleBetween(a,b){return mb(this,a,b)}angleSnapToDirection(a,b){return Vb(this,a,b)}angleToward(a,b){return Wb(this,a,b)}areNeighbors(a,b){return ld(this,a,b)}chessToTileXYZ(a){return ba(this,a)}contains(a,b,c){return Ra(this,a,b,c)}directionBetween(a,b,c=!0){return md(this,a,b,c)}filledRingToTileXYArray(a,b,c=!0,d=[]){return $e(this,a,b,c,d)}fit(a){return af(this,a)}forEachTileXY(a,b,c=0){return nd(this,a,b,c),this}getAllChess(a=[]){return Za(this,a)}getChessData(a){return Sa(a)}getDistance(a,b,c=!1){return od(this,a,b,c)}getEmptyTileXYArray(a=0,b=[]){return uc(this,a,b)}getGridPoints(a,b,c){return pd(this,a,b,c)}getNeighborChess(a,b,c,d){return qd(this,a,b,c,d)}getNeighborChessDirection(a,b){return Xb(this,a,b)}getNeighborTileDirection(a,b){return Yb(this,a,b)}getNeighborTileXY(a,b=null,c={x:0,y:0}){return bb(this,a,b,c)}getNeighborTileXYAtAngle(a,b,c={x:0,y:0}){return rd(this,a,b,c)}getOppositeDirection(a,b,c){return sd(this,a,b,c)}getRandomEmptyTileXY(a=0,b={x:0,y:0}){return bf(this,a,b)}getTileXYAtDirection(a,b,c,d){return Ka(this,a,b,c,d)}getWrapTileXY(a,b,c={x:0,y:0}){return Zb(this,a,b,c)}gridAlign(a,b,c){return _b(this,a,b,c),this}hasBlocker(a,b,c){return cf(this,a,b,c)}hasChess(a){return df(this,a)}hasEdgeBlocker(a,b,c,d){return ef(this,a,b,c,d)}isAngleInCone(a,b,c,d){return td(this,a,b,c,d)}isDirectionInCone(a,b,c,d){return ud(this,a,b,c,d)}isOverlappingPoint(a,b,c){return vd(this,a,b,c)}lineToTileXYArray(a,b,c,d,e=[]){return ff(this,a,b,c,d,e)}mirror(a,b,c=null,d={x:0,y:0}){return gf(this,a,b,c,d)}offset(a,b,c,d){return _a(this,a,b,c,d)}removeAllChess(a=!1,b=!1){return hf(this,a,b),this}removeChess(a,b,c,d,e=!1,f=!1){return La(this,a,b,c,d,e,f),this}ringToTileXYArray(a,b=1,c=[]){return vc(this,a,b,c)}rotate(a,b,c=null,d={x:0,y:0}){return jf(this,a,b,c,d)}setBoardWidth(a=0){return yb(this,a),this}setBoardHeight(a=0){return zb(this,a),this}setTileZ(a,b){return kf(this,a,b),this}shapeToTileXYArray(a,b,c=[]){return lf(this,a,b,c)}swapChess(a,b,c=!0){return mf(this,a,b,c),this}tileXYArrayToChessArray(a,b,c=[]){return $b(this,a,b,c)}tileXYToChessArray(a,b,c=[]){return Ma(this,a,b,c)}tileXYZToChess(a,b,c){return qa(this,a,b,c)}tileZToChessArray(a,b=[]){return wd(this,a,b)}tileXYArrayToWorldXYArray(a,b=[]){return xd(this,a,b)}tileXYToWorldXY(a,b,c={x:0,y:0}){return Da(this,a,b,c)}worldXYSnapToGrid(a,b,c={x:0,y:0}){return yd(this,a,b,c)}worldXYToChess(a,b,c,d){return zd(this,a,b,c,d)}worldXYToTileXY(a,b,c){return Ga(this,a,b,c)}}class Ch extends kd{}const Ta={};Ob(Ta,{ChessToTileXYZ:()=>ba,Contains:()=>Ra,DirectionBetween:()=>md,ForEachTileXY:()=>nd,GetDistance:()=>od,GetOppositeDirection:()=>sd,GetTileXYAtDirection:()=>Ka,GetWrapTileXY:()=>Zb,IsDirectionInCone:()=>ud,TileXYArrayToChessArray:()=>$b,TileXYToChessArray:()=>Ma,TileXYZToChess:()=>qa,TileZToChessArray:()=>wd});const nb={};Ob(nb,{AngleBetween:()=>mb,AngleSnapToDirection:()=>Vb,AngleToward:()=>Wb,GetGridPoints:()=>pd,GridAlign:()=>_b,IsAngleInCone:()=>td,IsOverlappingPoint:()=>vd,TileXYArrayToWorldXYArray:()=>xd,TileXYToWorldXY:()=>Da,WorldXYSnapToGrid:()=>yd,WorldXYToChess:()=>zd,WorldXYToTileXY:()=>Ga});const Cb={};Ob(Cb,{AreNeighbors:()=>ld,GetNeighborChess:()=>qd,GetNeighborChessDirection:()=>Xb,GetNeighborTileDirection:()=>Yb,GetNeighborTileXY:()=>bb,GetNeighborTileXYAtAngle:()=>rd});var oa;(function(a){a[a.orthogonal=0]="orthogonal",a[a.isometric=1]="isometric"})(oa||(oa={}));var hb;(function(a){a[a["4dir"]=4]="4dir",a[a["8dir"]=8]="8dir"})(hb||(hb={}));class xi{constructor({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=oa.orthogonal,dir:f=hb["4dir"]}={}){this.setOriginPosition(a,b),this.setCellSize(c,d),this.setType(e),this.setDirectionMode(f)}fromJSON({x:a=0,y:b=0,cellWidth:c=0,cellHeight:d=0,type:e=oa.orthogonal,dir:f=hb["4dir"]}={}){return this.setType(e),this.setDirectionMode(f),this.setOriginPosition(a,b),this.setCellSize(c,d),this}toJSON(){return{x:this.x,y:this.y,cellWidth:this.cellWidth,cellHeight:this.cellHeight,type:this.mode,dir:this.directions}}setOriginPosition(a=0,b=0){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setType(a=oa.orthogonal){return typeof a==="string"&&(a=oa[a]),this.mode=a,this}setDirectionMode(a=hb["4dir"]){return typeof a==="string"&&(a=hb[a]),this.directions=a,this}}function pi(a,b,c,d=!0){let e;switch(a.mode){case oa.orthogonal:case oa.isometric:if(b.y===c.y)e=c.x>=b.x?0:2;else if(b.x===c.x)e=c.y>=b.y?1:3;else if(a.directions===hb["4dir"]){let f=bc(Fb(b.x,b.y,c.x,c.y));f<0&&(f+=360),e=f/90,d&&(e=Math.round(e))}else{let f=c.x-b.x,g=c.y-b.y;if(f===g)e=f>0?4:6;else if(f===-g)e=f>0?7:5;else{let j=bc(Math.atan2(g,f));j<0&&(j+=360);let i=j/45;d&&(i=Math.round(i)),i>=0&&i<1?e=i:i>=1&&i<2?e=i+3:i>=2&&i<3?e=i-1:i>=3&&i<4?e=i+2:i>=4&&i<5?e=i-2:i>=5&&i<6?e=i+1:i>=6&&i<7?e=i-3:e=i}}break}return e===a.directions&&(e=0),e}function Ld(a,b){return gb(b,0,a.directions)}function qi(a,b,c,d=!1){let e=c.x-b.x,f=c.y-b.y,g;return d?g=Math.abs(e)+Math.abs(f):g=Math.sqrt(e*e+f*f),g}function Hd(a,b=[]){if(!(b.length===a))if(b.length<a)for(let c=b.length;c<a;c++)b.push({x:0,y:0});else b.length=a;return b}function Od(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=fm);let e,f;switch(a.mode){case oa.orthogonal:e=b*a.width,f=c*a.height;break;case oa.isometric:e=(b-c)*a._halfWidth,f=(b+c)*a._halfHeight;break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let fm={x:0,y:0};function ri(a,b=0,c=0,d=[]){if(typeof b==="object"){let i=b;c=i.y,b=i.x}d===!0&&(d=bm),Hd(4,d);let e,f;({x:e,y:f}=Od(a,b,c));let g=a._halfWidth,j=a._halfHeight;switch(a.mode){case oa.orthogonal:d[0].x=e+g,d[0].y=f-j,d[1].x=e+g,d[1].y=f+j,d[2].x=e-g,d[2].y=f+j,d[3].x=e-g,d[3].y=f-j;break;case oa.isometric:d[0].x=e+g,d[0].y=f,d[1].x=e,d[1].y=f+j,d[2].x=e-g,d[2].y=f,d[3].x=e,d[3].y=f-j;break}return d}let bm=[];const cc=[[1,0],[0,1],[-1,0],[0,-1],[1,1],[-1,1],[-1,-1],[1,-1]],zc=cc;function mi(a){let b={},c,d,e;for(let f in a)c=a[f],d=c[0],e=c[1],b.hasOwnProperty(d)||(b[d]={}),b[d][e]=parseInt(f);return b}const ni=mi(cc),oi=mi(zc);function si(a,b,c){let d;switch(a.mode){case oa.orthogonal:d=ni;break;case oa.isometric:d=oi;break}let e=c.x-b.x,f=c.y-b.y;if(d.hasOwnProperty(e)){let g=d[e];if(g.hasOwnProperty(f))return g[f]}return null}function Pd(a,b,c,d,e={x:0,y:0}){e===!0&&(e=em);let f,g;switch(a.mode){case oa.orthogonal:f=cc[c][0],g=cc[c][1];break;case oa.isometric:f=zc[c][0],g=zc[c][1];break}return d===1?(e.x=b.x+f,e.y=b.y+g):(e.x=b.x+d*f,e.y=b.y+d*g),e}let em={x:0,y:0};function ti(a,b,c,d={x:0,y:0}){return Pd(a,b,c,1,d)}function ui(a,b,c,d){return cm[d]}const cm={0:2,1:3,2:0,3:1,4:6,5:7,6:4,7:5};function vi(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=dm),b-=a.x,c-=a.y;let e=b/a.width,f=c/a.height;switch(a.mode){case oa.orthogonal:d.x=Math.round(e),d.y=Math.round(f);break;case oa.isometric:d.x=Math.round(+e+f),d.y=Math.round(-e+f);break}return d}let dm={x:0,y:0};function wi(a,b,c,d={x:0,y:0}){return typeof c==="string"&&(c=Eb[c]),d===!0&&(d=gm),d.x=c&1?-b.x:b.x,d.y=c&2?-b.y:b.y,d}let gm={x:0,y:0};function Gb(a,b,c,d,e={x:0,y:0}){e===!0&&(e=hm);let f=b.x+c,g=b.y+d;return e.x=f,e.y=g,e}let hm={x:0,y:0};function yi(a,b,c,d=[]){let e,f;for(e=c,f=-c;f<=c;f++)d.push(Gb(a,b,e,f));for(f=c,e=c-1;e>=-c;e--)d.push(Gb(a,b,e,f));for(e=-c,f=c-1;f>=-c;f--)d.push(Gb(a,b,e,f));for(f=-c,e=-c+1;e<=c-1;e++)d.push(Gb(a,b,e,f));return d}function zi(a,b,c,d={x:0,y:0}){d===!0&&(d=mm),c=gb(c,0,3);let e,f;switch(c){case 1:e=-b.y,f=b.x;break;case 2:e=-b.x,f=-b.y;break;case 3:e=b.y,f=-b.x;break;default:e=b.x,f=b.y;break}return d.x=e,d.y=f,d}let mm={x:0,y:0};function Md(a){a._savedOriginX=a.x,a._savedOriginY=a.y}function Nd(a){a.x=a._savedOriginX,a.y=a._savedOriginY}class li extends xi{get sides(){return 4}get allDirections(){return this.directions===4?im:jm}get halfDirections(){return this.directions===4?km:lm}directionBetween(a,b,c=!0){return pi(this,a,b,c)}directionNormalize(a){return Ld(this,a)}getDistance(a,b,c=!1){return qi(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return ri(this,a,b,c)}getNeighborTileDirection(a,b){return si(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return ti(this,a,b,c)}getOppositeDirection(a,b,c){return ui(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return vi(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return Pd(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return Od(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return wi(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return Gb(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return yi(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return zi(this,a,b,c)}restoreOrigin(){return Nd(this),this}saveOrigin(){return Md(this),this}}const im=[0,1,2,3],jm=[0,1,2,3,4,5,6,7],km=[0,1],lm=[0,1,4,5];var ca;(function(a){a[a.ODD_R=0]="ODD_R",a[a.EVEN_R=1]="EVEN_R",a[a.ODD_Q=2]="ODD_Q",a[a.EVEN_Q=3]="EVEN_Q"})(ca||(ca={}));var $a;(function(a){a[a.y=0]="y",a[a.flat=0]="flat",a[a.x=1]="x",a[a.pointy=1]="pointy"})($a||($a={}));var qb;(function(a){a[a.even=0]="even",a[a.odd=1]="odd"})(qb||(qb={}));class ei{constructor({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=$a.x,staggerIndex:g=qb.odd}={}){this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e)}fromJSON({x:a=0,y:b=0,radius:c=void 0,cellWidth:d=0,cellHeight:e=0,staggerAxis:f=$a.x,staggerIndex:g=qb.odd}={}){return this.setType(f,g),this.setDirectionMode(),this.setOriginPosition(a,b),c!==void 0?this.setRadius(c):this.setCellSize(d,e),this}toJSON(){return{x:this.x,y:this.y,radius:this.radius,cellWidth:this.cellWidth,cellHeight:this.cellHeight,staggerAxis:this.staggerAxis,staggerIndex:this.staggerIndex}}setOriginPosition(a,b){return this.x=a,this.y=b,this}get width(){return this._width}set width(a){this._width=a,this._halfWidth=a/2}get height(){return this._height}set height(a){this._height=a,this._halfHeight=a/2}setCellSize(a=0,b=0){return this.width=a,this.height=b,this.radius=void 0,this}get cellWidth(){return this.width}set cellWidth(a){this.width=a}get cellHeight(){return this.height}set cellHeight(a){this.height=a}setRadius(a=0){let b,c;return this.staggerAxis===$a.y?(b=2*a,c=ki*a):(b=ki*a,c=2*a),this.setCellSize(b,c),this.radius=a,this}setDirectionMode(){return this.directions=6,this}setType(a=1,b=1){return typeof a==="string"&&(a=$a[a]),typeof b==="string"&&(b=qb[b]),this.staggerAxis=a,this.staggerIndex=b,a===$a.y?this.mode=b===qb.even?ca.EVEN_Q:ca.ODD_Q:this.mode=b===qb.even?ca.EVEN_R:ca.ODD_R,this}}const ki=Math.sqrt(3);function Na(a,b,c,d={x:0,y:0,z:0}){d===!0&&(d=uf);switch(a){case ca.ODD_R:d.x=b-(c-(c&1))/2,d.z=c;break;case ca.EVEN_R:d.x=b-(c+(c&1))/2,d.z=c;break;case ca.ODD_Q:d.x=b,d.z=c-(b-(b&1))/2;break;case ca.EVEN_Q:d.x=b,d.z=c-(b+(b&1))/2;break}return d.y=-d.x-d.z,d}function Uh(a,b,c,d={x:0,y:0,z:0}){typeof a!=="number"&&(d=a,a=d.x,b=d.y,c=d.z),d===!0&&(d=uf);let e=Math.round(a),f=Math.round(b),g=Math.round(c),j=Math.abs(e-a),i=Math.abs(f-b),m=Math.abs(g-c);return j>i&&j>m?e=-f-g:i>m?f=-e-g:g=-e-f,d.x=e,d.y=f,d.z=g,d}function Ba(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Ol);switch(a){case ca.ODD_R:e.x=b+(d-(d&1))/2,e.y=d;break;case ca.EVEN_R:e.x=b+(d+(d&1))/2,e.y=d;break;case ca.ODD_Q:e.x=b,e.y=d+(b-(b&1))/2;break;case ca.EVEN_Q:e.x=b,e.y=d+(b+(b&1))/2;break}return e}function Vh(a,b,c={x:0,y:0,z:0}){return c===!0&&(c=uf),c.x=a,c.y=-a-b,c.z=b,c}let uf={x:0,y:0,z:0},Ol={x:0,y:0};function Xh(a,b,c,d=!0){let e;Na(a.mode,b.x,b.y,Dd),Na(a.mode,c.x,c.y,Ed);let f=Ed.x-Dd.x,g=Ed.y-Dd.y,j=Ed.z-Dd.z;return j===0?e=f>0?0:3:f===0?e=j>0?1:4:g===0?e=j>0?2:5:f>0&&g<0&&j>0?e=0+j/-g:f<0&&g<0&&j>0?e=1+-g/j:f<0&&g>0&&j>0?e=2+g/-f:f<0&&g>0&&j<0?e=3+-j/g:f>0&&g>0&&j<0?e=4+f/-j:e=5+-g/f,d&&(e=Math.round(e)),e}let Dd={x:0,y:0,z:0},Ed={x:0,y:0,z:0};function Yh(a,b,c,d=!1){Na(a.mode,b.x,b.y,Fd),Na(a.mode,c.x,c.y,Gd);let e=Gd.x-Fd.x,f=Gd.y-Fd.y,g=Gd.z-Fd.z;return(Math.abs(e)+Math.abs(f)+Math.abs(g))/2}let Fd={x:0,y:0,z:0},Gd={x:0,y:0,z:0};function Id(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Xl);let e=b*a.width,f=c*a.height;switch(a.mode){case ca.ODD_R:c&1&&(e+=a._halfWidth),f*=.75;break;case ca.EVEN_R:c&1&&(e-=a._halfWidth),f*=.75;break;case ca.ODD_Q:e*=.75,b&1&&(f+=a._halfHeight);break;case ca.EVEN_Q:e*=.75,b&1&&(f-=a._halfHeight);break}return e+=a.x,f+=a.y,d.x=e,d.y=f,d}let Xl={x:0,y:0};const Ln=Math.PI/180;function ob(a){return a*Ln}function Zh(a,b=0,c=0,d=[]){if(typeof b==="object"){let g=b;c=g.y,b=g.x}d===!0&&(d=Tl),Hd(6,d);let e,f;({x:e,y:f}=Id(a,b,c));if(a.radius!==void 0){let g=a.radius,j=a.staggerAxis===$a.flat?0:-30;for(let i=0;i<6;i++){let m=60*i+j,n=ob(m);d[i].x=e+g*Math.cos(n),d[i].y=f+g*Math.sin(n)}}else{let g=a._halfWidth,j=g/2,i=a._halfHeight,m=i/2;a.staggerAxis===$a.flat?(d[0].x=e+g,d[0].y=f,d[1].x=e+j,d[1].y=f+i,d[2].x=e-j,d[2].y=f+i,d[3].x=e-g,d[3].y=f,d[4].x=e-j,d[4].y=f-i,d[5].x=e+j,d[5].y=f-i):(d[0].x=e+g,d[0].y=f-m,d[1].x=e+g,d[1].y=f+m,d[2].x=e,d[2].y=f+i,d[3].x=e-g,d[3].y=f+m,d[4].x=e-g,d[4].y=f-m,d[5].x=e,d[5].y=f-i)}return d}let Tl=[];const Pl=[[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]]],Ql=[[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]],[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]]],Rl=[[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]],[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]]],Sl=[[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]],[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]]],Ua=[Pl,Ql,Rl,Sl];function pb(a){let b={},c,d;for(let e in a)[c,d]=a[e],b.hasOwnProperty(c)||(b[c]={}),b[c][d]=parseInt(e);return b}const Wh=[[pb(Ua[0][0]),pb(Ua[0][1])],[pb(Ua[1][0]),pb(Ua[1][1])],[pb(Ua[2][0]),pb(Ua[2][1])],[pb(Ua[3][0]),pb(Ua[3][1])]];function Jd(a,b,c){let d;switch(a){case ca.ODD_R:case ca.EVEN_R:d=c&1;break;case ca.ODD_Q:case ca.EVEN_Q:d=b&1;break}return d}function _h(a,b,c){let d=a.mode,e=Jd(d,b.x,b.y),f=Wh[d][e],g=c.x-b.x,j=c.y-b.y;if(f.hasOwnProperty(g)){let i=f[g];if(i.hasOwnProperty(j))return i[j]}return null}function Kd(a,b,c,d,e={x:0,y:0}){e===!0&&(e=Wl);let f=a.mode,g=b.x,j=b.y;if(d===1){let i=Jd(f,g,j);e.x=g+Ua[f][i][c][0],e.y=j+Ua[f][i][c][1]}else if(d===0)e.x=g,e.y=j;else{let i=Na(f,g,j,!0),m,n,u;switch(c){case 1:m=i.x,n=i.y-d,u=i.z+d;break;case 2:m=i.x-d,n=i.y,u=i.z+d;break;case 3:m=i.x-d,n=i.y+d,u=i.z;break;case 4:m=i.x,n=i.y+d,u=i.z-d;break;case 5:m=i.x+d,n=i.y,u=i.z-d;break;default:m=i.x+d,n=i.y-d,u=i.z;break}Ba(f,m,n,u,e)}return e}let Wl={x:0,y:0};function $h(a,b,c,d={x:0,y:0}){return Kd(a,b,c,1,d)}function ai(a,b,c,d){return(d+3)%6}const bi=4/3,ci=2/3;function di(a,b,c,d={x:0,y:0}){typeof b==="object"&&(c=b.y,b=b.x),d===!0&&(d=Vl),b-=a.x,c-=a.y;let e,f;switch(a.mode){case ca.ODD_R:case ca.EVEN_R:f=c*bi/a.height,e=b/a.width-ci*(c/a.height);break;case ca.ODD_Q:case ca.EVEN_Q:f=c/a.height-ci*(b/a.width),e=b*bi/a.width;break}let g=Vh(e,f,Ul);return Uh(g),Ba(a.mode,g.x,g.y,g.z,d),d}let Ul={x:0,y:0,z:0},Vl={x:0,y:0};function fi(a,b,c,d={x:0,y:0}){typeof c==="string"&&(c=Eb[c]),d===!0&&(d=_l);let e=Na(a.mode,b.x,b.y,!0),f=a.mode===ca.ODD_R||a.mode===ca.EVEN_R,g,j,i;return c&1&&(f?(g=e.y,j=e.x,i=e.z):(g=-e.x,j=-e.z,i=-e.y),e.x=g,e.y=j,e.z=i),c&2&&(f?(g=-e.y,j=-e.x,i=-e.z):(g=e.x,j=e.z,i=e.y)),Ba(a.mode,g,j,i,d),d}let _l={x:0,y:0};function gi(a,b,c,d,e={x:0,y:0}){e===!0&&(e=$l);let f=b.x+c,g=b.y+d;switch(a.mode){case ca.ODD_R:(d&1)!==0&&((g&1)===0&&(f+=1));break;case ca.EVEN_R:(d&1)!==0&&((g&1)===0&&(f-=1));break;case ca.ODD_Q:(c&1)!==0&&((f&1)==0&&(g+=1));break;case ca.EVEN_Q:(c&1)!==0&&((f&1)==0&&(g-=1));break}return e.x=f,e.y=g,e}let $l={x:0,y:0};function hi(a,b,c,d=[]){let e=Na(a.mode,b.x,b.y,!0),f=e.x,g=e.y,j=e.z,i,m,n;for(n=c,i=0;i>=-c;i--)m=-i-n,d.push(Ba(a.mode,f+i,g+m,j+n));for(i=-c,m=1;m<=c;m++)n=-i-m,d.push(Ba(a.mode,f+i,g+m,j+n));for(m=c,n=-1;n>=-c;n--)i=-m-n,d.push(Ba(a.mode,f+i,g+m,j+n));for(n=-c,i=1;i<=c;i++)m=-i-n,d.push(Ba(a.mode,f+i,g+m,j+n));for(i=c,m=-1;m>=-c;m--)n=-i-m,d.push(Ba(a.mode,f+i,g+m,j+n));for(m=-c,n=1;n<=c-1;n++)i=-m-n,d.push(Ba(a.mode,f+i,g+m,j+n));return d}function ii(a,b,c,d={x:0,y:0}){d===!0&&(d=am),c=gb(c,0,5);let e=Na(a.mode,b.x,b.y,!0),f,g,j;switch(c){case 1:f=-e.z,g=-e.x,j=-e.y;break;case 2:f=e.y,g=e.z,j=e.x;break;case 3:f=-e.x,g=-e.y,j=-e.z;break;case 4:f=e.z,g=e.x,j=e.y;break;case 5:f=-e.y,g=-e.z,j=-e.x;break;default:f=e.x,g=e.y,j=e.z;break}return Ba(a.mode,f,g,j,d),d}let am={x:0,y:0};class ji extends ei{get sides(){return 6}get allDirections(){return Yl}get halfDirections(){return Zl}directionBetween(a,b,c=!0){return Xh(this,a,b,c)}directionNormalize(a){return Ld(this,a)}getDistance(a,b,c=!1){return Yh(this,a,b,c)}getGridPoints(a=0,b=0,c=[]){return Zh(this,a,b,c)}getNeighborTileDirection(a,b){return _h(this,a,b)}getNeighborTileXY(a,b,c={x:0,y:0}){return $h(this,a,b,c)}getOppositeDirection(a,b,c){return ai(this,a,b,c)}getTileXY(a,b,c={x:0,y:0}){return di(this,a,b,c)}getTileXYAtDirection(a,b,c,d={x:0,y:0}){return Kd(this,a,b,c,d)}getWorldXY(a,b,c={x:0,y:0}){return Id(this,a,b,c)}mirror(a,b,c={x:0,y:0}){return fi(this,a,b,c)}offset(a,b,c,d={x:0,y:0}){return gi(this,a,b,c,d)}ringToTileXYArray(a,b,c=[]){return hi(this,a,b,c)}rotate(a,b,c={x:0,y:0}){return ii(this,a,b,c)}restoreOrigin(){return Nd(this),this}saveOrigin(){return Md(this),this}}const Yl=[0,1,2,3,4,5],Zl=[0,1,2];var za;(function(a){a[a.random=0]="random",a[a.diagonal=1]="diagonal",a[a.straight=2]="straight",a[a.line=3]="line",a[a.astar=10]="astar",a[a["astar-random"]=11]="astar-random",a[a["astar-line"]=12]="astar-line"})(za||(za={}));const Hb=null;class Tk{constructor(a){this.content=[],this.scoreFunction=a}clear(){this.content.length=0}push(a){this.content.push(a),this.sinkDown(this.content.length-1)}pop(){let a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.bubbleUp(0)),a}remove(a){let b=this.content.indexOf(a),c=this.content.pop();b!==this.content.length-1&&(this.content[b]=c,this.scoreFunction(c)<this.scoreFunction(a)?this.sinkDown(b):this.bubbleUp(b))}get size(){return this.content.length}rescoreElement(a){this.sinkDown(this.content.indexOf(a))}sinkDown(a){let b=this.content[a];for(;a>0;){let c=(a+1>>1)-1,d=this.content[c];if(this.scoreFunction(b)<this.scoreFunction(d))this.content[c]=b,this.content[a]=d,a=c;else break}}bubbleUp(a){let b=this.content.length,c=this.content[a],d=this.scoreFunction(c);for(;;){let e=a+1<<1,f=e-1,g=null,j;if(f<b){let i=this.content[f];j=this.scoreFunction(i),j<d&&(g=f)}if(e<b){let i=this.content[e],m=this.scoreFunction(i);m<(g===null?d:j)&&(g=e)}if(g!==null)this.content[a]=this.content[g],this.content[g]=c,a=g;else break}}}let L5=new Tk(a=>a.f);const pe=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d=d.prevNodes[0];return c.reverse()};const Wk=function(a,b,c=[]){let d=b;for(;d.prevNodes.length>0;)c.push(d),d.prevNodes.length===1?d=d.prevNodes[0]:d=ac(d.prevNodes);return c.reverse()};const Vk=function(a,b,c=[]){let d=b,e=b.angleTo(a);for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1)d=d.prevNodes[0];else{let f=Infinity;for(let g=1,j=d.prevNodes.length;g<j;g++){let i=d.prevNodes[g],m=Math.abs(b.angleTo(i)-e);m<f&&(f=m,d=i)}}}return c.reverse()};const Uk=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let j=0,i=d.prevNodes.length;j<i;j++){f=d.prevNodes[j],g=f.logicDirTo(d);if(g!==e)break}e=g,d=f}}return c.reverse()};const Xk=function(a,b,c=[]){let d=b,e;for(;d.prevNodes.length>0;){c.push(d);if(d.prevNodes.length===1||e===void 0){let f=d.prevNodes[0];e=f.logicDirTo(d),d=f}else{let f,g;for(let j=0,i=d.prevNodes.length;j<i;j++){f=d.prevNodes[j],g=f.logicDirTo(d);if(g===e)break}e=g,d=f}}return c.reverse()};let Nb={};Nb[za.astar]=pe;Nb[za["astar-line"]]=pe;Nb[za["astar-random"]]=pe;Nb[za.random]=Wk;Nb[za.line]=Vk;Nb[za.diagonal]=Uk;Nb[za.straight]=Xk;class Ci{constructor(){this.prevNodes=[]}shutdown(){this.key=void 0,this.prevNodes.length=0}destroy(){this.shutdown()}reset(a){this.key=a,this.f=0,this.g=0,this.h=void 0,this.closerH=void 0,this.visited=!1,this.closed=!1}heuristic(a,b,c){if(b===null)return 0;let d,e=this.distanceTo(a)*this.manager.weight;switch(b){case za.astar:d=e;break;case za["astar-line"]:if(c!==void 0){let f=a.angleTo(c)-this.angleTo(c);d=e+Math.abs(f)}else d=e;case za["astar-random"]:d=e+Math.random();break;default:d=e;break}return d}getNextNodes(){return[]}getCost(a){return Hb}distanceTo(a){return 0}angleTo(a){return 0}logicDirTo(a){return 0}getNode(a,b=!1){return this.manager.getNode(a,b)}}function Qd(a){for(let b=a.length-1;b>0;b--){let c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a}class wm extends Ci{constructor(a){super();this.isTileXYZ=!0;this.pathFinder=a}reset(a){super.reset(a),this.key=a,Di(a,this),this._px=void 0,this._py=void 0,this.cost=void 0}getNextNodes(){let a=Cb.GetNeighborTileXY(this.board,this);this.pathFinder.shuffleNeighbors&&Qd(a);let b=[];return a.forEach(c=>{let d=this.getNode(Qa(c.x,c.y),!0);b.push(d)}),b}getCost(a){return this.pathFinder.cacheCost?this.cost===void 0&&(this.cost=this.pathFinder.getCost(this,a)):this.cost=this.pathFinder.getCost(this,a),this.cost}distanceTo(a){return Ta.GetDistance(this.board,this,a,!0)}angleTo(a){return Fb(this.worldX,this.wroldY,a.worldX,a.worldX)}logicDirTo(a){return Cb.GetNeighborTileDirection(this.board,this,a)}get board(){return this.pathFinder.board}get worldX(){if(this._px===void 0){let a=nb.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._px}get wroldY(){if(this._py===void 0){let a=nb.TileXYToWorldXY(this.board,this.x,this.y,!0);this._px=a.x,this._py=a.y}return this._py}}class rm{constructor(){this.data=[];this.visited=new Set()}push(a,b){if(Array.isArray(a)){let d=a;for(let e=0,f=d.length;e<f;e++)this.push(d[e]);return this}if(typeof a==="object"){let d=a;a=d.x,b=d.y}let c=`${a},${b}`;return this.visited.has(c)?this:(this.data.push({x:a,y:b}),this.visited.add(c),this)}pop(){return this.data.pop()}get length(){return this.data.length}clear(){return this.data.length=0,this.visited.clear(),this}}let rS=new rm();var Cd;(function(a){a[a.direction=0]="direction",a[a.angle=1]="angle"})(Cd||(Cd={}));function Ub(a=32,b=32){const c=qc(a,b);return new Ya(c.canvas)}function Yg(a,b){const c=a.texture,d=b.shaders.current,e=d.buffer,f=c.binding;d.count===e.batchSize&&b.flush();const g=a.vertexData;b.textures.request(c);const j=f.index;g[4]=j,g[10]=j,g[16]=j,g[22]=j;const i=d.count*e.quadElementSize;e.vertexViewF32.set(g,i);const m=a.vertexColor,n=e.vertexViewU32;n[i+5]=m[0],n[i+11]=m[2],n[i+17]=m[3],n[i+23]=m[1],d.count++}class Ug extends Yc{constructor(a=0,b=0){super(a,b);this._alpha=1,this.type="Container"}setSize(a,b=a){return this.transform.updateExtent(a,b),this}setPosition(a,b){return this.transform.position.set(a,b),this}setOrigin(a,b=a){return this.transform.origin.set(a,b),this}setSkew(a,b=a){return this.transform.skew.set(a,b),this}setScale(a,b=a){return this.transform.scale.set(a,b),this}setRotation(a){return this.transform.rotation=a,this}set width(a){this.transform.updateExtent(a)}get width(){return this.transform.extent.width}set height(a){this.transform.updateExtent(void 0,a)}get height(){return this.transform.extent.height}set x(a){this.transform.position.x=a}get x(){return this.transform.position.x}set y(a){this.transform.position.y=a}get y(){return this.transform.position.y}set originX(a){this.transform.origin.x=a}get originX(){return this.transform.origin.x}set originY(a){this.transform.origin.y=a}get originY(){return this.transform.origin.y}set skewX(a){this.transform.skew.x=a}get skewX(){return this.transform.skew.x}set skewY(a){this.transform.skew.y=a}get skewY(){return this.transform.skew.y}set scaleX(a){this.transform.scale.x=a}get scaleX(){return this.transform.scale.x}set scaleY(a){this.transform.scale.y=a}get scaleY(){return this.transform.scale.y}set rotation(a){this.transform.rotation=a}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(a){a!==this._alpha&&(this._alpha=a,this.setDirty(aa.TRANSFORM))}}function Zg(a,b){const c=a.frame;if(!c)return;const d=b.ctx,e=a.transform,{a:f,b:g,c:j,d:i,tx:m,ty:n}=e.world,{x:u,y:A}=e.extent;d.save(),d.setTransform(f,g,j,i,m,n),d.globalAlpha=a.alpha,d.drawImage(c.texture.image,c.x,c.y,c.width,c.height,u,A,c.width,c.height),d.restore()}function pc(a,b){const c=(b*255|0)&255;return(c<<24|a)>>>0}function _g(a){const b=a.vertexAlpha,c=a.vertexTint,d=a.vertexColor;return d[0]=pc(c[0],b[0]),d[1]=pc(c[1],b[1]),d[2]=pc(c[2],b[2]),d[3]=pc(c[3],b[3]),a}function _c(a,b,...c){const d=a.getFrame(b),{u0:e,u1:f,v0:g,v1:j,pivot:i}=d;return c.forEach(m=>{if(!m||d===m.frame)return;m.frame=d,i&&m.setOrigin(i.x,i.y),m.frame.setExtent(m),m.hasTexture=!0;const n=m.vertexData;n[2]=e,n[3]=g,n[8]=e,n[9]=j,n[14]=f,n[15]=j,n[20]=f,n[21]=g}),c}function Xg(a,b,...c){if(!a)c.forEach(d=>{d.texture=null,d.frame=null,d.hasTexture=!1});else{let d;a instanceof Ya?d=a:d=kb.get().get(a),d?(c.forEach(e=>{e.texture=d}),_c(d,b,...c)):console.warn(`Invalid Texture key: ${a}`)}return c}function $g(a){const b=a.vertexData,{x0:c,y0:d,x1:e,y1:f,x2:g,y2:j,x3:i,y3:m}=Zc(a.transform);return b[0]=c,b[1]=d,b[6]=e,b[7]=f,b[12]=g,b[13]=j,b[18]=i,b[19]=m,a}class $c extends Ug{constructor(a,b,c,d){super(a,b);this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertexData=new Float32Array(24).fill(0),this.vertexColor=new Uint32Array(4).fill(4294967295),this.vertexAlpha=new Float32Array(4).fill(1),this.vertexTint=new Uint32Array(4).fill(16777215),this.setTexture(c,d)}setTexture(a,b){return Xg(a,b,this),this}setFrame(a){return _c(this.texture,a,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}preRender(){this.isDirty(aa.COLORS)&&(_g(this),this.clearDirty(aa.COLORS)),this.isDirty(aa.TRANSFORM)&&($g(this),this.clearDirty(aa.TRANSFORM))}renderGL(a){this.preRender(),Yg(this,a)}renderCanvas(a){this.preRender(),Zg(this,a)}get alpha(){return this._alpha}set alpha(a){if(a!==this._alpha){this._alpha=a;const b=this.vertexAlpha;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(aa.ALPHA)}}get tint(){return this._tint}set tint(a){if(a!==this._tint){this._tint=a;const b=this.vertexTint;b[0]=a,b[1]=a,b[2]=a,b[3]=a,this.setDirty(aa.COLORS)}}destroy(a){super.destroy(a),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertexData=null,this.vertexColor=null,this.vertexAlpha=null,this.vertexTint=null}}function je(a,b,c){let d=Math.ceil(b*a.resolution),e=Math.ceil(c*a.resolution),f=a.canvas;if(f.width===d||f.height===e){ke(a);return}f.width=d,f.height=e,a.texture.setSize(b,c),a.setSize(b,c),a.updateTexture()}function ke(a){a.context.clearRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function Lf(a,b="#fff"){let c=a.context;c.fillStyle=b,c.fillRect(0,0,a.canvas.width,a.canvas.height),a.updateTexture()}function le(a,b,c){let d=new Image();d.onload=function(){let e=a.resolution,f=d.width/e,g=d.height/e;je(a,f,g),a.context.drawImage(d,0,0),a.updateTexture(),c&&c(),d.onload=null,d.src="",d.remove()},d.src=b}function Mf(a,b){return new Promise(function(c,d){le(a,b,c)})}function Nf(a,b,c){return a.canvas.toDataURL(b,c)}function Of(a,b,c,d=[0,0,0,0]){let e=a.context.getImageData(b,c,1,1).data;return d[0]=e[0],d[1]=e[1],d[2]=e[2],d[3]=e[3],d}function Pf(a,b,c,d,e,f,g){g===void 0&&(g=d!==0||e!==0||f!==0?255:0);let j=a.context.createImageData(1,1);j.data[0]=d,j.data[1]=e,j.data[2]=f,j.data[3]=g,a.context.putImageData(j,b,c),a.updateTexture()}class Kf extends $c{constructor(a=0,b=0,c=32,d=32){super(a,b,Ub());this.type="rexCanvas";const e=wa.get();this.resolution=e.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.resize(c,d)}updateTexture(){return this.texture.binding&&this.texture.binding.update(),this.setDirty(aa.TEXTURE),this}destroy(a){this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}resize(a,b){return je(this,a,b),this}clear(){return ke(this),this}}function ub(a,b,c,d=1){let e;if(typeof a==="string"){let j=kb.get();j.has(a)||j.add(a,Ub()),e=j.get(a)}else e=a;let f=e.image,g=f.getContext("2d");return c?b.call(c,f,g):b(f,g),e.setSize(f.width/d,f.height/d),e.binding&&e.binding.update(),e}class Yk{constructor(a=0,b=a,c=0,d=c,e=0){this._width=0;this._height=0;this.cornerRadius={tl:Wa(0),tr:Wa(0),bl:Wa(0),br:Wa(0)};this.setTo(a,b,c,d,e)}setTo(a=0,b=a,c=0,d=c,e=0){return this.setPosition(a,b),this.setRadius(e),this.setSize(c,d),this}setPosition(a=0,b=a){return this.x=a,this.y=b,this}setRadius(a=0){let b=this.cornerRadius;if(typeof a==="number"){const c=a,d=a;b.tl=Wa(void 0,c,d),b.tr=Wa(void 0,c,d),b.bl=Wa(void 0,c,d),b.br=Wa(void 0,c,d)}else{const c=a.x||0,d=a.y||0;b.tl=Wa(a.tl,c,d),b.tr=Wa(a.tr,c,d),b.bl=Wa(a.bl,c,d),b.br=Wa(a.br,c,d)}return this}setSize(a=0,b=a){return this.width=a,this.height=b,this}get minWidth(){let a=this.cornerRadius;return Math.max(a.tl.x+a.tr.x,a.bl.x+a.br.x)}get minHeight(){let a=this.cornerRadius;return Math.max(a.tl.y+a.bl.y,a.tr.y+a.br.y)}get width(){return this._width}set width(a){a==null&&(a=0),this._width=Math.max(a,this.minWidth)}get height(){return this._height}set height(a){a==null&&(a=0),this._height=Math.max(a,this.minHeight)}get radius(){let a=this.cornerRadius,b=Math.max(a.tl.x,a.tl.y,a.tr.x,a.tr.y,a.bl.x,a.bl.y,a.br.x,a.br.y);return b}}function Wa(a,b,c){return a===void 0?{x:b,y:c}:typeof a==="number"?{x:a,y:a}:a}const Zk=ob(0),_k=ob(90),$k=ob(180),al=ob(270);function Xf(a,b,c,d,e,f,g,j,i,m){const n=new Yk(c,d,e,f,g),u=n.minWidth,A=n.minHeight,B=e>=u?1:e/u,E=f>=A?1:f/A,G=n.cornerRadius;let H,K,I,N,L;b.beginPath(),b.translate(c,d),H=G.br,K=H.x*B,I=H.y*E,N=n.width-K,L=n.height-I,qe(H)?b.ellipse(N,L,K,I,0,Zk,_k):(b.moveTo(n.width,L),b.lineTo(n.width,n.height),b.lineTo(N,n.height)),H=G.bl,K=H.x*B,I=H.y*E,N=K,L=n.height-I,b.lineTo(K,n.height),qe(H)?b.ellipse(N,L,K,I,0,_k,$k):(b.lineTo(0,n.height),b.lineTo(0,L)),H=G.tl,K=H.x*B,I=H.y*E,N=K,L=I,b.lineTo(0,L),qe(H)?b.ellipse(N,L,K,I,0,$k,al):(b.lineTo(0,0),b.lineTo(N,0)),H=G.tr,K=H.x*B,I=H.y*E,N=n.width-K,L=I,b.lineTo(N,0),qe(H)?b.ellipse(N,L,K,I,0,al,Zk):(b.lineTo(n.width,0),b.lineTo(n.width,L)),b.closePath(),j&&(b.fillStyle=j,b.fill()),i&&(b.strokeStyle=i,b.lineWidth=m,b.stroke())}function qe(a){return a.x!==0&&a.y!==0}var Sk;(function(a){a[a.right=0]="right",a[a.down=1]="down",a[a.left=2]="left",a[a.up=3]="up"})(Sk||(Sk={}));function wk(a,b){b.width!==a.width&&(b.width=a.width),b.height!==a.height&&(b.height=a.height);let c=b.getContext("2d");c.drawImage(a.texture.image,a.x,a.y,a.width,a.height)}function Qf(a,b,c=0,d=0,e=a.width,f=a.height){let g=a.resolution,j=a.canvas,i=Math.ceil(e*g),m=Math.ceil(f*g);ub(b,function(n,u){n.width!==i&&(n.width=i),n.height!==m&&(n.height=m),u.clearRect(0,0,i,m),u.drawImage(j,c,d,i,m)},void 0,a.resolution)}function Rf(a,b,c){let d=kb.get();if(!d.has(b))return;wk(d.get(b).getFrame(c),a.canvas);let e=a.canvas.width,f=a.canvas.height,g=a.resolution,j=e/g,i=f/g;a.texture.setSize(j,i),a.setSize(j,i),a.updateTexture()}class vk extends Kf{fill(a="#fff"){return Lf(this,a),this}getCanvas(){return this.canvas}getContext(){return this.context}getDataURL(a,b){return Nf(this,a,b)}getPixel(a,b,c=[0,0,0,0]){return Of(this,a,b,c)}generateTexture(a,b=0,c=0,d=this.width,e=this.height){return Qf(this,a,b,c,d,e),this}loadFromURL(a,b){return le(this,a,b),this}loadFromURLPromise(a){return Mf(this,a)}loadTexture(a,b){return Rf(this,a,b),this}setPixel(a,b,c,d,e,f){return Pf(this,a,b,c,d,e,f),this}}const n7=Ia(Bh());const Gi={receive:"receive"};function ig(a,b){return a.events.delete(b),a}function hg(a,b,...c){if(a.events.size===0||!a.events.has(b))return!1;const d=a.events.get(b);for(const e of d)e.callback.apply(e.context,c),e.once&&d.delete(e);return d.size===0&&a.events.delete(b),!0}class eg{constructor(){this.events=new Map()}}class Mc{constructor(a,b,c=!1){this.callback=a,this.context=b,this.once=c}}function kg(a){return[...a.events.keys()]}function jg(a,b){const c=a.events.get(b);return c?c.size:0}function lg(a,b){const c=[],d=a.events.get(b);return d.forEach(e=>{c.push(e.callback)}),c}function gg(a,b,c,d,e){const f=a.events,g=f.get(b);if(!c)f.delete(b);else if(c instanceof Mc)g.delete(c);else{const j=!d,i=e!==void 0;for(const m of g)m.callback===c&&(j&&m.context===d)&&(i&&m.once===e)&&g.delete(m)}return g.size===0&&f.delete(b),a}function Lc(a,b,c,d=a,e=!1){if(typeof c!=="function")throw new TypeError("Listener not a function");const f=new Mc(c,d,e),g=a.events.get(b);return g?g.add(f):a.events.set(b,new Set([f])),f}function fg(a,b,c,d=a){return Lc(a,b,c,d,!0)}function re(a,b){b?a.events.delete(b):a.events.clear()}class Ca{setEventEmitter(a){return this.privateEE=a===void 0,this.eventEmitter=this.privateEE?new eg():a,this}clearEventEmitter(){return this.setEventEmitter(null),this}destroyEventEmitter(){return this.eventEmitter&&this.privateEE&&(re(this.eventEmitter),this.eventEmitter=null),this}on(a,b,c=this,d=!1){return this.eventEmitter&&Lc(this.eventEmitter,a,b,c,d),this}once(a,b,c=this){return this.eventEmitter&&fg(this.eventEmitter,a,b,c),this}off(a,b,c,d){return this.eventEmitter&&gg(this.eventEmitter,a,b,c,d),this}emit(a,...b){return this.eventEmitter&&hg(this.eventEmitter,a,...b),this}removeAllListeners(a){return this.eventEmitter&&re(this.eventEmitter,a),this}clearEvent(a){return this.eventEmitter&&ig(this.eventEmitter,a),this}getListenerCount(a){return this.eventEmitter?jg(this.eventEmitter,a):0}getEventNames(){return this.eventEmitter?kg(this.eventEmitter):[]}getListeners(a){return this.eventEmitter?lg(this.eventEmitter,a):[]}}function Hi(a,b){(!a.sendToRef||a.sendToRef.key!==a.receiverID)&&(a.sendToRef=a.database.ref(a.rootPath).child(a.receiverID));if(b===void 0)return a.sendToRef.remove();let c={message:b,senderID:a.userID,stamp:a.stamp};return a.userName!==void 0&&(c.senderName=a.userName),a.skipFirst=!1,a.stamp=!a.stamp,a.sendToRef.set(c)}function Ii(a){if(a.isReceiving&&a.receiverRef.key===a.receiverID)return;xf(a),a.isReceiving=!0,a.skipFirst=!0,a.receiverRef=a.database.ref(a.rootPath).child(a.receiverID),a.receiverRef.on("value",Ki,a),a.receiverRef.onDisconnect().remove()}function xf(a){if(!a.isReceiving)return;a.isReceiving=!1,a.receiverRef.off("value",Ki,a),a.receiverRef.remove(),a.receiverRef.onDisconnect().cancel()}function Ki(a){if(this.skipFirst){this.skipFirst=!1;return}let b=a.val();if(b==null)return;delete b.stamp,this.history.add(b),this.emit(this.eventNames.receive,b)}class Ji{constructor({maxLength:a=-1}={}){this.maxLength=a,this.records=[]}add(a){return this.maxLength===0?this:(this.records.push(a),this.maxLength>0&&this.records.length>this.maxLength&&this.records.shift(),this)}clear(){return this.records.length=0,this}changeUserName(a,b){return this.maxLength===0?this:(this.records.forEach(c=>{c.senderID===a&&(c.senderName=b)}),this)}}const wV=Ia(Ja());class dc extends Ca{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d,receiverID:e="",history:f=0,eventNames:g=Gi}={}){super();this.setEventEmitter(a),this.eventNames=g,this.database=wV.database(),this.setRootPath(b),this.skipFirst=!0,this.stamp=!1,this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.isReceiving=!1,f===!0?f=-1:f===!1&&(f=0),this.history=new Ji({maxLength:f})}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.sendToRef=void 0,this.receiverRef=void 0,this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.receiverID=a,this}changeUserName(a,b){return a===this.userID&&(this.userName=b),this.history.changeUserName(a,b),this}getHistory(){return this.history.records}clearHistory(){return this.history.clear(),this}send(a){return Hi(this,a)}startReceiving(){return Ii(this),this}stopReceiving(){return xf(this),this}}const On="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function Xd(a,b,c=On){let d=b===void 0?a:wc(a,b),e="";for(let f=0;f<d;f++)e+=ac(Array.from(c));return e}const b$=Ia(Ja());var ra;(function(a){a[a["1d"]=1]="1d",a[a["2d"]=2]="2d",a[a["3d"]=3]="3d"})(ra||(ra={}));const Li={init:"init",update:"update",addkey0:"addkey0",removekey0:"removekey0",changekey0:"changekey0",addkey1:"addkey1",removekey1:"removekey1",changekey1:"changekey1",addkey2:"addkey2",removekey2:"removekey2",changekey2:"changekey2"};function dl(a){return a==null||a===""||a.length===0}function Nn(a,b,c={}){let d=a;if(!dl(b)){typeof b==="string"&&(b=b.split("."));let e;for(let f=0,g=b.length;f<g;f++){e=b[f];if(d[e]==null||typeof d[e]!=="object"){let j;f===g-1?j=c:j={},d[e]=j}d=d[e]}}return d}function el(a,b,c){if(typeof a!=="object")return;if(dl(b)){if(c==null)return;typeof c==="object"&&(a=c)}else{typeof b==="string"&&(b=b.split("."));let d=b.pop(),e=Nn(a,b);e[d]=c}return a}function se(a){if(Array.isArray(a))a.length=0;else for(let b in a)delete a[b]}function cl(a){return JSON.parse(JSON.stringify(a))}class Mi{constructor(){this.data={}}setValue(a,b){return a==null?this.clear():typeof a==="object"?this.data=a:el(this.data,a,b),this}getValue(a){if(a==null)return this.data;{typeof a==="string"&&(a=a.split("."));let b=this.data;for(let c=0,d=a.length;c<d;c++){if(!mg(b))return;b=b[a[c]]}return b}}cloneValue(a){return cl(this.getValue(a))}removeKey(a){if(a==null)this.clear();else{typeof a==="string"&&(a=a.split("."));let b=a.pop(),c=this.data;for(let d=0,e=a.length;d<e;d++){if(!mg(c))return this;c=c[a[d]]}mg(c)&&delete c[b]}return this}clear(){return se(this.data),this}}function mg(a){return a!=null&&typeof a==="object"}const nW=Ia(Ja());class Ib extends Ca{constructor({eventEmitter:a,parent:b,key:c,type:d,eventNames:e,table:f}={}){super();this.setEventEmitter(a),this.parent=b,this.children=new Map(),this.key=c,this.parent?this.fullKeyPath=Wi(this.parent.fullKeyPath,this.key):this.fullKeyPath="",this.type=d,this.eventNames=e,this.table=f,this.database=nW.database(),this.setRootPath()}destroy(){this.stopUpdate().clear().destroyEventEmitter()}setRootPath(a){if(a===void 0){let b=this.parent?this.parent.rootPath:"";a=`${b}/${this.key}`}this.rootPath=a,this.rootRef=a!==""?this.database.ref(a):void 0;for(const[b,c]of this.children)c instanceof Ib&&c.setRootPath();return this}setData(a,b){if(arguments.length===0)this.clear();else if(typeof a=="string")this.setChildData(a,b);else{let c=a;for(const[d,e]of this.children)c.hasOwnProperty(d)||this.removeChild(d);for(let d in c)this.setChildData(d,c[d])}return this}clear(){this.table.removeKey(this.fullKeyPath);for(const[a,b]of this.children)this.removeChild(a);return this}get childClass(){return null}setChildData(a,b){const c=Wi(this.fullKeyPath,a);this.table.setValue(c,b);if(!(typeof b!=="object")){if(this.children.has(a))this.children.get(a).setData(b);else if(this.childClass){let d=new this.childClass({parent:this,key:a,type:this.type,eventEmitter:this.eventEmitter,eventNames:this.eventNames,table:this.table});d.startUpdate(),this.children.set(a,d)}}return this}removeChild(a){return this.children.has(a)&&(this.children.get(a).destroy(),this.children.delete(a)),this}startUpdate(){return this}stopUpdate(){return this}}function Wi(a,b){return a==null||a===""?b:b==null||b===""?a:`${a}.${b}`}class Ac extends Ib{startUpdate(){return this.rootRef.on("child_added",this.addCol,this),this.rootRef.on("child_removed",this.removeCol,this),this.rootRef.on("child_changed",this.changeColValue,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addCol,this),this.rootRef.off("child_removed",this.removeCol,this),this.rootRef.off("child_changed",this.changeColValue,this),this}addCol(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["1d"]:this.emit(this.eventNames.addkey0,b,c);break;case ra["2d"]:this.emit(this.eventNames.addkey1,this.key,b,c);break;default:this.emit(this.eventNames.addkey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}removeCol(a){const b=a.key;this.removeChild(b);switch(this.type){case ra["1d"]:this.emit(this.eventNames.removekey0,b);break;case ra["2d"]:this.emit(this.eventNames.removekey1,this.key,b);break;default:this.emit(this.eventNames.removekey2,this.pageKey,this.key,b);break}this.emit(this.eventNames.update,this.table.data)}changeColValue(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["1d"]:this.emit(this.eventNames.changekey0,b,c);break;case ra["2d"]:this.emit(this.eventNames.changekey1,this.key,b,c);break;default:this.emit(this.eventNames.changekey2,this.pageKey,this.key,b,c);break}this.emit(this.eventNames.update,this.table.data)}get pageKey(){return this.parent.key}}class Bc extends Ib{startUpdate(){return this.rootRef.on("child_added",this.addRow,this),this.rootRef.on("child_removed",this.removeRow,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addRow,this),this.rootRef.off("child_removed",this.removeRow,this),this}addRow(a){const b=a.key,c=a.val();this.setData(b,c);switch(this.type){case ra["2d"]:this.emit(this.eventNames.addkey0,this.key,b,c);break;default:this.emit(this.eventNames.addkey1,this.key,b,c);break}}removeRow(a){const b=a.key;this.removeChild(b);switch(this.type){case ra["2d"]:this.emit(this.eventNames.removekey0,b);break;default:this.emit(this.eventNames.removekey1,this.key,b);break}}get childClass(){return Ac}}class yf extends Ib{startUpdate(){return this.rootRef.on("child_added",this.addPage,this),this.rootRef.on("child_removed",this.removePage,this),this}stopUpdate(){return this.rootRef.off("child_added",this.addPage,this),this.rootRef.off("child_removed",this.removePage,this),this}addPage(a){const b=a.key,c=a.val();this.setData(b,c),this.emit(this.eventNames.addkey0,b,c)}removePage(a){const b=a.key;this.removeChild(b),this.emit(this.eventNames.removekey0,b)}get childClass(){return Bc}}const Td={};Td[ra["1d"]]=Ac;Td[ra["2d"]]=Bc;Td[ra["3d"]]=yf;function Ni(a){return new Td[a.tableType]({type:a.tableType,eventEmitter:a.eventEmitter,eventNames:a.eventNames,table:a.table})}function Oi(a){return a.updater.clear(),a.initialFlag=!1,a.rootRef.once("value").then(function(b){let c=b.val()||{};return a.table.setValue(c),a.emit(a.eventNames.init,c),a.initialFlag=!0,Promise.resolve(c)})}function Ea(a,b,c,d){let e=a.rootRef;return e=b?e.child(b):e,e=c?e.child(c):e,e=d?e.child(d):e,e}function Pi(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ea(a,c,d,e).set(f)}function Qi(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;default:c=b[0];break}return Ea(a,c,d,e).remove()}function Ri(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ea(a,c,d,e).transaction(function(g){return g===null&&(g=0),g+f})}function Si(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ea(a,c,d,e).transaction(f)}function Ti(a,b){return Ea(a).update(b)}function Ui(a,...b){let c,d,e;switch(b.length){case 3:[c,d,e]=b;break;case 2:[c,d]=b;break;case 1:c=b[0];break}return Ea(a,c,d,e).onDisconnect().remove()}function Vi(a,...b){let c,d,e,f;switch(b.length){case 4:[c,d,e,f]=b;break;case 3:[c,d,f]=b;break;case 2:[c,f]=b;break;default:f=b[0];break}return Ea(a,c,d,e).onDisconnect().set(f)}const QV=Ia(Ja());class ec extends Ca{constructor({eventEmitter:a,root:b="",type:c=ra["3d"],eventNames:d=Li}={}){super();this.setEventEmitter(a),this.eventNames=d,this.database=QV.database(),this.table=new Mi(),this.setTableType(c),this.setRootPath(b),this.initialFlag=!1}destroy(){this.updater.destroy(),this.destroyEventEmitter().stopUpdate()}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):null,this.updater.setRootPath(a),this}setTableType(a){return typeof a==="string"&&(a=ra[a]),this.tableType=a,this.updater&&this.updater.destroy(),this.updater=Ni(this),this}startUpdate(){return Oi(this),this.updater.startUpdate(),this}stopUpdate(){return this.updater.stopUpdate(),this}clear(){return this.updater.clear(),this}getData(){return this.table.getValue(...arguments)}cloneData(){return this.table.cloneValue(...arguments)}getItemRef(a,b,c){return Ea(this,a,b,c)}setData(...a){return Pi(this,...a)}removeData(...a){return Qi(this,...a)}incValue(...a){return Ri(this,...a)}transaction(...a){return Si(this,...a)}updateData(a){return Ti(this,a)}removeDataOnDisconnect(...a){return Ui(this,...a)}setDataOnDisconnect(...a){return Vi(this,...a)}}const l_=Ia(Ja());var Gf;(function(a){a.d="d",a.w="w",a.m="m",a.y="y",a.day="d",a.week="w",a.month="m",a.year="y"})(Gf||(Gf={}));var Hc;(function(a){a.d="tagD",a.w="tagW",a.m="tagM",a.y="tagY"})(Hc||(Hc={}));var Ic;(function(a){a.d="scoreD",a.w="scoreW",a.m="scoreM",a.y="scoreY"})(Ic||(Ic={}));var ck;(function(a){a.d="day",a.w="week",a.m="month",a.y="year"})(ck||(ck={}));function Jf({query:a,totalLines:b=Infinity,linesPerPage:c=1e3,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g}){return uk({query:a,remainderLines:b,linesPerPage:c,startDocRef:d,startMode:e,forEachPageCallback:f,resolveCallback:g})}function uk(a){let b=a.query;a.startDocRef&&(b=b[a.startMode](a.startDocRef));let c=Math.min(a.remainderLines,a.linesPerPage);return a.remainderLines-=c,b.limit(c).get().then(function(d){let e=a.remainderLines===0||d.size<c,f=!1;a.forEachPageCallback&&(f=a.forEachPageCallback(d)||!1),e=e||f;if(e){let g;return a.resolveCallback&&(g=a.resolveCallback()),Promise.resolve(g)}else return a.startDocRef=d.docs[d.size-1],a.startMode="startAfter",uk(a)})}function Ha(a,b=Infinity,c=0,d,e){let f=[],g=0;return Jf({query:a,totalLines:c+b,startDocRef:d,startMode:e,forEachPageCallback:function(j){let i,m=j.size,n=c-g;n<=0?i=j.docs:n<m&&(i=j.docs.slice(n,m)),i&&f.push(...i),g+=m},resolveCallback:function(){return f}})}const m1=Ia(Ja());function lk(a,b,c=0){return Ha(a.nextQuery,b,c,a.baselineDocRef,a.baselineMode).then(function(d){let e=d.length;return a.cacheItems=d,a.pageIndex=void 0,a.startItemIndex=c,a.endItemIndex=a.startItemIndex+e-1,a.isFullPage=b===void 0?!0:e===b,Promise.resolve(a.cacheItems)})}const M0=Ia(Ja());class ie{constructor({query:a={next:void 0,previous:void 0},itemCount:b=100,baselineDoc:c,baselineMode:d="startAt"}={}){this.setQuery(a),this.setItemCount(b),this.setBaselineDoc(c,d),this.pageIndex=void 0,this.baselineDocRef=void 0,this.baselineMode="startAt",this.startItemIndex=void 0,this.endItemIndex=void 0,this.cacheItems=void 0,this.isFullPage=void 0}setQuery(a,b){if(a instanceof M0.firestore.Query)this.nextQuery=a,this.prevQuery=b;else{var c=a;this.nextQuery=c.next,this.prevQuery=c.previous}return this.pageIndex=null,this.isFullPage=!0,this}setItemCount(a){return this.itemCount=a,this}setBaselineDoc(a,b){return a?(this.baselineDocRef=a.ref,this.baselineMode=b):this.baselineDocRef=void 0,this}load(a,b=0){return lk(this,a,b)}loadFirstPage(){return this._loadFirstPage()}loadNextPage(){return this.pageIndex==null?this._loadFirstPage():this._loadNextPage()}loadPreviousPage(){return this.pageIndex==null||this.pageIndex===1?this._loadFirstPage():this._loadPreviousPage()}loadCurrentPage(){return this.pageIndex==null||this.pageIndex===0?this._loadFirstPage():this._loadCurrentPage()}}function rk(a){return Ha(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=null,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function mk(a){return Ha(a.nextQuery,a.itemCount,0,a.baselineDocRef,a.baselineMode).then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex=0,a.startItemIndex=0,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,Promise.resolve(a.cacheItems)})}function sk(a){return Ha(a.nextQuery,a.itemCount,0,a.currPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=a.currPageEndDocRef,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function nk(a){let b=(a.pageIndex+1)*a.itemCount;return Ha(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex+=1,a.startItemIndex=a.endItemIndex+1,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function tk(a){return Ha(a.prevQuery,a.itemCount+1,0,a.currPageStartDocRef,"startAfter").then(function(b){let c=b.length-1;return a.cacheItems=b,a.cacheItems.pop(),a.cacheItems.reverse(),a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-c+1,a.isFullPage=c===a.itemCount,a.prevPageEndDocRef=b[c].ref,a.currPageStartDocRef=b[c-1].ref,a.currPageEndDocRef=b[0].ref,Promise.resolve(a.cacheItems)})}function ok(a){let b=(a.pageIndex-1)*a.itemCount;return Ha(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.pageIndex-=1,a.endItemIndex=a.startItemIndex-1,a.startItemIndex=a.endItemIndex-d+1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}function qk(a){return Ha(a.nextQuery,a.itemCount,0,a.prevPageEndDocRef,"startAfter").then(function(b){let c=b.length;return a.cacheItems=b,a.endItemIndex=a.startItemIndex+c-1,a.isFullPage=c===a.itemCount,a.currPageStartDocRef=b[0].ref,a.currPageEndDocRef=b[c-1].ref,Promise.resolve(a.cacheItems)})}function pk(a){let b=a.pageIndex*a.itemCount;return Ha(a.nextQuery,a.itemCount,b,a.baselineDocRef,a.baselineMode).then(function(c){let d=c.length;return a.cacheItems=c,a.endItemIndex=a.startItemIndex+d-1,a.isFullPage=d===a.itemCount,Promise.resolve(a.cacheItems)})}class Hf extends ie{_loadFirstPage(){return mk(this)}_loadNextPage(){return nk(this)}_loadPreviousPage(){return ok(this)}_loadCurrentPage(){return pk(this)}}const Q$=Ia(Ja());class he extends ie{_loadFirstPage(){return rk(this)}_loadNextPage(){return sk(this)}_loadPreviousPage(){return tk(this)}_loadCurrentPage(){return qk(this)}}const I0=Ia(Ja());function ek(a,b){let c={senderID:a.userID,message:b,timestamp:I0.firestore.FieldValue.serverTimestamp()};return a.userName!==void 0&&(c.senderName=a.userName),a.receiverID!==void 0&&(c.receiverID=a.receiverID),a.rootRef.add(c)}function If(a,b=a.receiverID){let c=a.rootRef;return c=b!==void 0?c.where("receiverID","==",b):c,c}function dk(a,b=a.receiverID){let c=If(a,b),d=c.orderBy("timestamp"),e=c.orderBy("timestamp","desc");return{next:d,previous:e}}function fk(a){let b=If(a).orderBy("timestamp","desc").limit(1);a.unsubscribe=b.onSnapshot({includeMetadataChanges:!0},function(c){if(c.size>0){let d=c.docs[0];if(d.metadata.hasPendingWrites){a.skipFirst&&(a.skipFirst=!1);return}jk(a,a.receiverID,d);if(a.skipFirst)a.skipFirst=!1;else{let e=kk(d);a.cacheMessages.push(e),a.emit("receive",e)}}else a.skipFirst&&(a.skipFirst=!1)},function(c){debugger})}function gk(a){a.unsubscribe&&a.unsubscribe(),a.resetQueryFlag=!0,a.cacheMessages.length=0}function hk(a){return jk(a),a.page.loadNextPage().then(function(b){let c=[];for(let d=0,e=b.length;d<e;d++)c.push(kk(b[d]));return a.cacheMessages.splice(0,0,...c),Promise.resolve(c)})}function jk(a,b=a.receiverID,c){if(!a.resetQueryFlag)return;a.resetQueryFlag=!1;let d=a.skipFirst?"startAt":"startAfter";a.page.setBaselineDoc(c,d).setQuery(dk(a,b));return}function kk(a){let b=a.data();return b.timestamp=b.timestamp.toDate(),b}const A0=Ia(Ja());class ik extends Ca{constructor({eventEmitter:a,root:b="",senderID:c="",senderName:d="",receiverID:e,pageItemCount:f=100}={}){super();this.setEventEmitter(a),this.database=A0.firestore(),this.setRootPath(b),this.userInfo={userID:"",userName:void 0},this.setSender(c,d),this.setReceiver(e),this.skipFirst=!0,this.unsubscribe=void 0,this.page=new he(),this.setPageItemCount(f),this.resetQueryFlag=!0,this.cacheMessages=[]}destroy(){this.stopReceiving().destroyEventEmitter()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.resetQueryFlag=this.resetQueryFlag||this.rootPath!==a,this.rootPath=a,this.rootRef=this.database.collection(a),this}setSender(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setReceiver(a){return this.resetQueryFlag=this.resetQueryFlag||this.receiverID!==a,this.receiverID=a,this}setPageItemCount(a){return this.page.setItemCount(a),this}get hasPreviousMessage(){return this.page.isFullPage!==!1}send(a){return ek(this,a)}startReceiving(){return fk(this),this}stopReceiving(){return gk(this),this}loadPreviousMessages(){return hk(this)}}const Yi={join:"join",leave:"leave",update:"update",change:"change",init:"init",changename:"changename"};var jb;(function(a){a[a.once=0]="once",a[a.child=1]="child",a[a.all=2]="all"})(jb||(jb={}));const Tj={update:"update",add:"add",remove:"remove",change:"change"};function fe(a){a.items.length=0,a.itemID2Index.clear()}function Uj(a){return a.items}function Vj(a,b){return a.itemID2Index.has(b)}function Af(a,b){return b==null?null:a.itemID2Index.get(b)}function Wj(a,b){if(b==null)return null;let c=Af(a,b);return c==null?null:a.items[c]}function Xj(a,b,c){a.items.forEach(b,c)}function tb(a){a.itemID2Index.clear();let b=a.items;for(var c=0,d=b.length;c<d;c++){let e=b[c][a.keyItemID];a.itemID2Index.set(e,c)}}function Yj(a,b){if(b>=a.length)return;let c=a.length-1,d=a[b];for(let e=b;e<c;e++)a[e]=a[e+1];return a.length=c,d}function Bf(a,b){let c=Df.call(this,a,b);tb(this),this.emit(this.eventNames.add,c),this.emit(this.eventNames.update,this.items)}function Fc(a,b){let c=Zj.call(this,a);tb(this);let d=Df.call(this,a,b);tb(this),this.emit(this.eventNames.change,d,c),this.emit(this.eventNames.update,this.items)}function Cf(a){let b=Zj.call(this,a);tb(this),this.emit(this.eventNames.remove,b),this.emit(this.eventNames.update,this.items)}function Gc(a){fe(this),a.forEach(function(b){Df.call(this,b,null,!0)}.bind(this)),tb(this),this.emit(this.eventNames.update,this.items)}function Df(a,b,c=!1){let d,e=this.getItemCallback,f=this.getItemCallbackScope;f?d=e.call(f,a):d=e(a);if(c)return this.items.push(d),d;if(b==null)this.items.unshift(d);else{let g=this.itemID2Index.get(b);g===this.items.length-1?this.items.push(d):this.items.splice(g+1,0,d)}return d}function Zj(a){let b=this.itemID2Index.get(a.key),c=Yj(this.items,b);return c}const ak={start(a,b){a.isUpdating=!1,b.once("value",Gc,a)},stop(a){}};const $j={start(a,b){b.on("child_added",Bf,a),b.on("child_removed",Cf,a),b.on("child_moved",Fc,a),b.on("child_changed",Fc,a)},stop(a){a.query.off("child_added",Bf,a),a.query.off("child_removed",Cf,a),a.query.off("child_moved",Fc,a),a.query.off("child_changed",Fc,a)}};const _j={start(a,b){b.on("value",Gc,a)},stop(a){a.query.off("value",Gc,a)}};const Ec={};Ec[jb.all]=_j;Ec[jb.child]=$j;Ec[jb.once]=ak;class Jb extends Ca{constructor({eventEmitter:a,itemIDKey:b="__itemID__",mode:c=jb.child,getItemCallback:d=Sm,getItemCallbackScope:e,query:f,eventNames:g=Tj}={}){super();this.setEventEmitter(a),this.eventNames=g,this.isUpdating=!1,this.items=[],this.itemID2Index=new Map(),this.setItemIDKey(b),this.setMode(c),e===void 0&&(e=this),this.setGetitemCallback(d,e),this.setQuery(f)}destroy(){this.stopUpdate().clear()}setItemIDKey(a){return this.keyItemID=a,this}setMode(a){return typeof a==="string"&&(a=jb[a]),this.mode=a,this.updater=Ec[a],this}setGetitemCallback(a,b){return this.getItemCallback=a,this.getItemCallbackScope=b,this}setQuery(a){return this.query=a,this}startUpdate(a){if(a)this.setQuery(a);else if(this.query)a=this.query;else return this;return this.stopUpdate().clear(),this.isUpdating=!0,this.updater.start(this,a),this}stopUpdate(){return!this.query||!this.isUpdating?this:(this.isUpdating=!1,this.updater.stop(this),this)}clear(){return fe(this),this}getItems(){return Uj(this)}hasItem(a){return Vj(this,a)}getItemIndexFromItemID(a){return Af(this,a)}getItemFromItemID(a){return Wj(this,a)}forEach(a,b){return Xj(this,a,b),this}updateItemID2Index(){return tb(this),this}}const Sm=function(a){let b=a.val();return b[this.keyItemID]=a.key,b};function rb(a,b=a.userID){return a.userID2ItemID.has(b)}function Ud(a,b=a.userID){if(!rb(a,b))return null;let c=a.userID2ItemID.get(b);return a.rootRef.child(c)}function aj(a,b=a.userID){if(!rb(a,b))return null;let c=a.userID2ItemID.get(b);return a.userList.getItemFromItemID(c)}function zf(a){return a.userList.getItems()}function bj(a){a.userList.clear()}function cj(a,b,c){a.userList.forEach(b,c)}function dj(a,b=a.userID){let c=a.userList.getItems()[0];return c&&c.userID===b}function ej(a){return a.maxUsers===0?!1:a.userList.getItems().length>=a.maxUsers}function Zi(a=0,b){return new Promise(function(c,d){setTimeout(function(){c(b)},a)})}function _i(a,b=a.userID,c=a.userName){if(rb(a,b))return Promise.resolve();let d={userID:b,userName:c},e=a.maxUsers,f=a.database.ref(a.rootPath),g=f.push();return g.onDisconnect().remove().then(function(){return g.set(d)}).then(function(){return Zi(0)}).then(function(){return e===0?(a.isInList=!0,Promise.resolve()):f.limitToFirst(e).once("value").then(function(j){return Gm(j,b)?(a.isInList=!0,Promise.resolve()):(a.isInList=!1,g.remove().then(function(){return g.onDisconnect().cancel()}).then(function(){return Promise.reject()}))})})}function Gm(a,b){let c=!1;return a.forEach(function(d){let e=d.val();if(e.userID===b)return c=!0,!0}),c}function $i(a,b=a.userID){if(!rb(a,b))return Promise.resolve();let c=a.userID2ItemID.get(b),d=a.database.ref(a.rootPath).child(c);return d.remove()}function Xi(a,b){return new Promise(function(c,d){let e=Ud(a);if(e)return c(e);{let f=a.rootRef.orderByChild("userID").equalTo(a.userID);f.once("child_added").then(function(g){return c(g.ref)})}}).then(function(c){return c.child("userName").set(b)}).then(function(){return a.userName=b,Promise.resolve()})}const _W=Ia(Ja());class fc extends Ca{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,eventNames:f=Yi}={}){super();this.setEventEmitter(a),this.eventNames=f,this.database=_W.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.setMaxUsers(e),this.userList=new Jb({eventEmitter:this.eventEmitter,itemIDKey:"joinAt",eventNames:{add:f.join,remove:f.leave,update:f.update,change:f.change}}),this.isInList=!1,this.userID2ItemID=new Map(),this.userList.on(this.eventNames.join,function(g){this.userID2ItemID.set(g.userID,g.joinAt),g.userID===this.userInfo.userID&&this.emit(this.eventNames.init,zf(this))},this).on(this.eventNames.leave,function(g){this.userID2ItemID.delete(g.userID),g.userID===this.userID&&(this.isInList=!1)},this).on(this.eventNames.change,function(g,j){let i=g.userID,m=g.userName,n=j.userName;m!==n&&this.emit(this.eventNames.changename,i,m,n)},this)}destroy(){this.stopUpdate().destroyEventEmitter().leave(),this.userList.destroy()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}setMaxUsers(a){return this.maxUsers=a,this}clear(){return bj(this),this}forEach(a,b){return cj(this,a,b),this}isFull(){return ej(this)}isFirstUser(a=this.userID){return dj(this,a)}getUser(a=this.userID){return aj(this,a)}getUsers(){return zf(this)}getUserRef(a=this.userID){return Ud(this,a)}contains(a=this.userID){return rb(this,a)}join(a=this.userID,b=this.userName){return _i(this,a,b)}leave(a=this.userID){return $i(this,a)}changeUserName(a){return Xi(this,a)}startUpdate(){let a=this.rootRef;return this.maxUsers>0&&(a=a.limitToFirst(this.maxUsers)),this.userList.startUpdate(a),this}stopUpdate(){return this.userList.stopUpdate(),this}}function rj(a){const b=new fc({eventEmitter:a.eventEmitter,eventNames:{join:"userlist.join",leave:"userlist.leave",update:"userlist.update",change:"userlist.change",init:"userlist.init",changename:"userlist.changename"},userID:a.userInfo});return b.on("userlist.leave",function(c){c.userID===a.userID&&Lm(a)}),a.on("room.join",function(){b.startUpdate()}).on("room.leave",function(){b.stopUpdate().clear()}),b}function Lm(a){a.emit("room.leave"),setTimeout(function(){a.roomID=void 0,a.roomName=void 0,a.doorState=void 0,a.leftRoomFlag=!1},0)}function oj(a){const b=new Jb({eventEmitter:a.eventEmitter,itemIDKey:"roomID",eventNames:{update:"roomlist.update",add:"roomlist.add",remove:"roomlist.remove",change:"roomlist.change"},mode:"once"});return b}function yj(a){return a.split("|")[0]}function xj(a){return a.split("|")[1]}function gc(a,b=""){return`${a}|${b}`}function ab(a,b){let c=a.rootRef;return b&&(c=c.child(b)),c}function Dc(a,b,c){let d=ab(a,"rooms");return b!==void 0&&(d=d.child(b),c!==void 0&&(d=d.child(c))),d}function nj(a,b){return Dc(a,b,"alive")}function sj(a,b){return Dc(a,b,"users")}function Cc(a,b){let c=ab(a,"room-filters");return b!==void 0&&(c=c.child(b)),c}function hc(a,b){let c=ab(a,"room-metadata");return b!==void 0&&(c=c.child(b)),c}function Wd(a,b,c){let d=`${a.rootPath}/rooms/${b}`;return c&&(d+=`/${c}`),d}function Zd(a,b){return Wd(a,b,"users")}function pj(a,b,c){let d=Wd(a,b,"tables");return c&&(d+=`/${c}`),d}function tj(a,b,c="open"){let d=Cc(a);return d=d.orderByChild("filter"),b===void 0?d=d.startAt(c).endAt(`${c}~`):d=d.equalTo(gc(c,b)),d}function kj(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new dc({eventEmitter:a.eventEmitter,eventNames:{receive:"broadcast.receive"},receiverID:"boradcast",senderID:a.userInfo,history:b.history});return a.on("room.join",function(d){c.setRootPath(Wd(a,d.roomID)).startReceiving()}).on("room.leave",function(){c.stopReceiving()}).on("userlist.changename",function(d,e){c.changeUserName(d,e)}),c}function qj(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,Km(a,d))}),a.on("room.join",function(d){for(const[e,f]of c)f.setRootPath(pj(a,d.roomID,e)).startUpdate()}).on("room.leave",function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function Km(a,{key:b,type:c=ra["1d"]}){const d=new ec({eventEmitter:a.eventEmitter,type:c,eventNames:{init:`tables.${b}.init`,update:`tables.${b}.update`,addkey0:`tables.${b}.addkey0`,removekey0:`tables.${b}.removekey0`,changekey0:`tables.${b}.changekey0`,addkey1:`tables.${b}.addkey1`,removekey1:`tables.${b}.removekey1`,changekey1:`tables.${b}.changekey1`,addkey2:`tables.${b}.addkey2`,removekey2:`tables.${b}.removekey2`,changekey2:`tables.${b}.changekey2`}});return d}function Oa(a,b=a.roomID,c=a.roomName){return{roomID:b,roomName:c}}function be(a,b){return b===void 0?a.roomID!==void 0:a.roomID===b}function Bj(a){return a.userList.isFull()}function Cj(a,b=a.userID){return a.userList.isFirstUser(b)}function Dj(a){return a.userList.getUsers()}function _d(a,b,c,d){a.roomID=b,a.roomName=c,a.roomType=d,a.emit("room.join",Oa(a))}function Yd(a,b={}){return b.roomID==null&&(b.roomID=Dc(a).push().key),Im(a,b.roomID).then(function(){return Jm(a,b)})}function Im(a,b){return nj(a,b).transaction(function(c){return c===null?!0:void 0})}function Jm(a,{roomID:b,roomName:c="",roomType:d="",maxUsers:e=0,presisted:f=!1,door:g="open",join:j=!0,filterData:i}){let m=Dc(a,b),n=Cc(a,b),u=hc(a,b);a.isRemoveRoomWhenLeft=!f,a.isRemoveRoomWhenLeft&&(m.onDisconnect().remove(),n.onDisconnect().remove(),u.onDisconnect().remove());const A=gc(g,d),B={},E={filter:A,name:c};i&&(E.data=i),B[`room-filters/${b}`]=E;const G={name:c,filter:A,maxUsers:e,moderators:{}};return G.moderators[a.userID]=a.userName,B[`room-metadata/${b}`]=G,new Promise(function(H,K){if(j){const I=a.userList.setRootPath(Zd(a,b)).setMaxUsers(0).join();return a.userList.setMaxUsers(e),I.then(H,K)}else return H()}).then(function(){return ab(a).update(B)}).then(function(){return a.isRoomCreator=!0,j&&_d(a,b,c,d),Promise.resolve(Oa(a))})}function lj(a,{digits:b=10,candidates:c="0123456789",retry:d=1e3}){let e=arguments[1];return mj(a,b,c,d,e)}function mj(a,b,c,d,e){return e.roomID=Xd(b,b,c),d<=0?Promise.reject(e):(d--,Yd(a,e).catch(function(){return mj(a,b,c,d,e)}))}function ce(a,b=a.roomID){const c={};c[`room-filter/${b}`]=null,c[`room-metadata/${b}`]=null,c[`rooms/${b}`]=null;const d=Oa(a);return ab(a).update(c).then(function(){return Promise.resolve(d)})}function ic(a){if(!be(a))return Promise.resolve(Oa(a));a.leftRoomFlag=!0;if(a.isRemoveRoomWhenLeft)return ce(a);{const b=Oa(a);return a.userList.leave().then(function(){return Promise.resolve(b)})}}function ae(a,{leftThenJoin:b=!0,roomID:c}){return b?ic(a).then(function(){return zj(a,c)}):zj(a,c)}function zj(a,b){return b==null?Promise.reject(Oa(a,b,"")):(a.isRemoveRoomWhenLeft=!1,Mm(a,b).then(function(c){return a.userList.setRootPath(Zd(a,b)).setMaxUsers(c.maxUsers).join().then(function(){return Promise.resolve(c)})}).then(function(c){return _d(a,b,c.name,xj(c.filter)),Promise.resolve(Oa(a))}))}function Mm(a,b){return hc(a,b).once("value").then(function(c){let d=c.val();return Nm(a,d)?Promise.resolve(d):Promise.reject()})}function Nm(a,b){if(b==null)return!1;if(yj(b.filter)==="closed")return!1;const c=a.userID;if(b.moderators[c])return!0;switch(b.permission){case"blocklist":const d=b.blocklist;return!(d&&d[c]);case"allowlist":const e=b.allowlist;return e&&e[c];default:return!0}}function $d(a,b,c){return new Promise(function(d,e){a.roomList.once("roomlist.update",function(f){d(f)}).startUpdate(tj(a,b,c))})}function vj(a,{roomType:b="",leftThenJoin:c=!0}={}){return $d(a,b,"open").then(function(d){if(d.length===0)return Promise.reject("No filtered room");Qd(d);const e={leftThenJoin:c,roomID:""};return wj(a,e,d)})}function wj(a,b,c,d=0){return d===c.length?Promise.reject("Can't join any room"):(b.roomID=c[d].roomID,d++,ae(a,b).catch(function(){return wj(a,b,c,d)}))}function Aj(a,b){return a.userList.contains(b)?b===a.userID?ic(a):a.userList.leave(b):Promise.resolve()}function sb(a,b){return b===a.roomID?Promise.resolve(!0):hc(a,b).once("value").then(function(c){const d=c.val()!==null;return Promise.resolve(d)})}function Vd(a,b,c=a.roomID){return sb(a,c).then(function(d){if(!d)return Promise.resolve();const e=gc(b,a.roomType),f={};return f[`room-filters/${c}/filter`]=e,f[`room-metadata/${c}/filter`]=e,ab(a).update(f)})}function hj(a,b=a.roomID){return Vd(a,"open",b)}function ij(a,b=a.roomID){return Vd(a,"closed",b)}function fj(a,b,c=a.roomID){return sb(a,c).then(function(d){return d?Cc(a,c).child("data").update(b):Promise.resolve()})}function jj(a,b){return a.userList.changeUserName(b)}function gj(a,b,c=a.roomID){return sb(a,c).then(function(d){if(!d)return Promise.resolve();const e={};return e[`room-filters/${c}/name`]=b,e[`room-metadata/${c}/name`]=b,ab(a).update(e)})}function uj(a,b=a.roomID){return b===a.roomID?a.userList.getUsers():new Promise(function(c,d){const e=new Jb({itemIDKey:"joinAt",mode:"once"});e.once("update",function(f){c(f)}).startUpdate(sj(a,b))})}const vY=Ia(Ja());class Ej extends Ca{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",broadcast:e=!0,tables:f=!1}={}){super();this.setEventEmitter(a),this.database=vY.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.isRoomCreator=!1,this.roomID=void 0,this.roomName=void 0,this.roomType=void 0,this.doorState=void 0,this.leftRoomFlag=!1,this.isRemoveRoomWhenLeft=void 0,this.userList=rj(this),this.roomList=oj(this),this.broadcast=kj(this,e),this.tables=qj(this,f)}destroy(){var a=this;this.destroyEventEmitter().leaveRoom().then(function(){a.userList.destroy(),a.userList=void 0,a.roomList.destroy(),a.roomList=void 0,a.broadcast.destroy(),a.broadcast=void 0})}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}getRoomInfo(a,b){return Oa(this,a,b)}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(a){return be(this,a)}isFull(){return Bj(this)}isFirstUser(a=this.userID){return Cj(this,a)}getUsers(){return Dj(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}createRoom(a){return Yd(this,a)}createRandomRoom(a={}){return lj(this,a)}joinRoom(a){return ae(this,a)}joinRandomRoom(a={}){return vj(this,a)}leaveRoom(){return ic(this)}removeRoom(a=this.roomID){return ce(this,a)}kickUser(a){return Aj(this,a)}changeRoomState(a,b=this.roomID){return Vd(this,a,b)}openRoom(a=this.roomID){return hj(this,a)}closeRoom(a=this.roomID){return ij(this,a)}changeUserName(a){return jj(this,a)}changeFilterData(a,b=this.roomID){return fj(this,a,b)}changeRoomName(a,b,c=a.roomID){return gj(this,b,c)}getUserList(a=this.roomID){return uj(this,a)}getRoomList(a,b){return $d(this,a,b)}HasRoom(a){return sb(this,a)}}function Lj(a,b){let c=a.rootPath;return b&&(c+=`/${b}`),c}function Jj(a){return Lj(a,"users")}function Hj(a,b){return`${Lj(a,"tables")}/${b}`}function Kj(a,b=0){const c=new fc({eventEmitter:a.eventEmitter,eventNames:{join:"userlist.join",leave:"userlist.leave",update:"userlist.update",change:"userlist.change",init:"userlist.init",changename:"userlist.changename"},root:Jj(a),userID:a.userInfo,maxUsers:b});return c.on("userlist.leave",function(d){d.userID===a.userID&&Qm(a)}),a.on("room.join",function(){c.startUpdate()}).on("room.leave",function(){c.stopUpdate().clear()}),c}function Qm(a){a.emit("room.leave"),setTimeout(function(){a.leftRoomFlag=!1},0)}function Gj(a,b){if(b)b===!0&&(b={history:!1});else return null;const c=new dc({eventEmitter:a.eventEmitter,eventNames:{receive:"broadcast.receive"},receiverID:"broadcast",senderID:a.userInfo,history:b.history});return a.on("room.join",function(){c.setRootPath(a.rootPath).startReceiving()}).on("room.leave",function(){c.stopReceiving()}).on("userlist.changename",function(d,e){c.changeUserName(d,e)}),c}function Ij(a,b){const c=new Map();return b?(b.forEach(d=>{c.set(d.key,Pm(a,d))}),a.on("room.join",function(){for(const[d,e]of c)e.setRootPath(Hj(a,d)).startUpdate()}).on("room.leave",function(){for(const[d,e]of c)e.stopUpdate().clear()}),c):c}function Pm(a,{key:b,type:c=ra["1d"]}){const d=new ec({eventEmitter:a.eventEmitter,type:c,eventNames:{init:`tables.${b}.init`,update:`tables.${b}.update`,addkey0:`tables.${b}.addkey0`,removekey0:`tables.${b}.removekey0`,changekey0:`tables.${b}.changekey0`,addkey1:`tables.${b}.addkey1`,removekey1:`tables.${b}.removekey1`,changekey1:`tables.${b}.changekey1`,addkey2:`tables.${b}.addkey2`,removekey2:`tables.${b}.removekey2`,changekey2:`tables.${b}.changekey2`}});return d}function ee(a){return a.userList.isInList}function Pj(a){return a.userList.isFull()}function Qj(a,b=a.userID){return a.userList.isFirstUser(b)}function Rj(a){return a.userList.getUsers()}function Nj(a){return a.userList.join().then(function(){return a.emit("room.join"),Promise.resolve()})}function de(a){return ee(a)?(a.leftRoomFlag=!0,a.userList.leave()):Promise.resolve()}function Mj(a){return a.userList.getUsers()}function Oj(a,b){return a.userList.contains(b)?b===a.userID?de(a):a.userList.leave(b):Promise.resolve()}function Fj(a,b){return a.userList.changeUserName(b)}const mZ=Ia(Ja());class Sj extends Ca{constructor({eventEmitter:a,root:b="",userID:c="",userName:d="",maxUsers:e=0,broadcast:f=!0,tables:g=!1}={}){const j=arguments[0];super();this.setEventEmitter(a),this.database=mZ.database(),this.setRootPath(b),this.userInfo={userID:"",userName:""},this.setUser(c,d),this.leftRoomFlag=!1,this.userList=Kj(this,e),this.broadcast=Gj(this,f),this.tables=Ij(this,g)}shutdown(){}destroy(){this.shutdown()}get userID(){return this.userInfo.userID}set userID(a){this.userInfo.userID=a}get userName(){return this.userInfo.userName}set userName(a){this.userInfo.userName=a}setRootPath(a){return this.rootPath=a,this.rootRef=a!==""?this.database.ref(this.rootPath):void 0,this}setUser(a,b){return typeof a==="string"?(this.userID=a,this.userName=b):this.userInfo=a,this}isInRoom(){return ee(this)}isFull(){return Pj(this)}isFirstUser(a=this.userID){return Qj(this,a)}getUsers(){return Rj(this)}get maxUsers(){return this.userList.maxUsers}getTable(a){return this.tables.get(a)}joinRoom(){return Nj(this)}leaveRoom(){return de(this)}getUserList(){return Mj(this)}kickUser(a){return Oj(this,a)}changeUserName(a){return Fj(this,a)}}class $f extends Ca{constructor({eventEmitter:a=!0}={}){super();this.enable=!0;a&&this.setEventEmitter()}destroy(){this.destroyEventEmitter()}toJSON(){return{curState:this.state,prevState:this.prevState,enable:this.enable,start:this._start}}setEnable(a=!0){return this.enable=a,this}set state(a){if(!this.enable||this._stateLock)return;if(this._state===a)return;this._prevState=this._state,this._state=a,this._stateLock=!0,this.emit("statechange",this);if(this._prevState!=null){let b=`exit_${this._prevState}`,c=this[b];c&&c.call(this),this.emit(b,this)}this._stateLock=!1;if(this._state!=null){let b=`enter_${this._state}`,c=this[b];c&&c.call(this),this.emit(b,this)}}get state(){return this._state}get prevState(){return this._prevState}start(a){return this._start=a,this._prevState=void 0,this._state=a,this}goto(a){return a!=null&&(this.state=a),this}next(){let a,b=this["next_"+this.state];return b?(typeof b==="string"?a=b:a=b.call(this),this.goto(a),this):this}update(a,b,c="update"){let d=this[`${c}_${this.state}`];d&&d.call(this,a,b)}preupdate(a,b){this.update(a,b,"preupdate")}postupdate(a,b){this.update(a,b,"postupdate")}addState(a,{next:b,exit:c,enter:d}){return b&&(this[`next_${a}`]=b),c&&(this[`exit_${a}`]=c),d&&(this[`enter_${a}`]=d),this}addStates(a){for(const b in a)this.addState(b,a[b]);return this}}var ag;(function(a){a[a.shuffle=0]="shuffle",a[a.random=1]="random"})(ag||(ag={}));const l7=Ia(hl());var bg;(function(a){a[a.none=0]="none",a[a.base64=1]="base64",a[a.utf16=2]="utf16",a[a.uri=3]="uri"})(bg||(bg={}));var Pa;(function(a){a[a.none=0]="none",a[a.word=1]="word",a[a.char=2]="char"})(Pa||(Pa={}));var ua;(function(a){a[a.none=0]="none",a[a.raw=1]="raw",a[a.wrapped=2]="wrapped"})(ua||(ua={}));const Pn=/(?:\r\n|\r|\n)/;function Jk(a,b,c,d,e,f=0){e<=0&&(d=0);let g=[];if(!a||!a.length)return g;let j=a.split(Pn),i=j.length-1;a.slice(-1)===`
`&&(j.length-=1);let m;for(let n=0,u=j.length;n<u;n++){let A=j[n],B=n===i?0:1;if(d===0){g.push(Nc(A,b(A,c),B));continue}n===0?m=e-f:m=e;if(A.length<=100){let I=b(A,c);if(I<=m){g.push(Nc(A,I,B));continue}}let E;d===1?E=A.split(" "):E=A;let G="",H="",K=0;for(let I=0,N=E.length;I<N;I++){let L=E[I];d===1?(G+=L,I<N-1&&(G+=" ")):G+=L;let _=b(G,c);_>m&&(I===0?g.push(Nc("",0,2)):(g.push(Nc(H,K,2)),G=L,d===1&&(I<N-1&&(G+=" ")),_=b(G,c)),m=e),H=G,K=_}g.push(Nc(H,K,B))}return g}let Nc=function(a,b,c){return{text:a,width:b,newLineMode:c}};var Kb;(function(a){a[a.left=0]="left",a[a.center=1]="center",a[a.right=2]="right"})(Kb||(Kb={}));var Lb;(function(a){a[a.top=0]="top",a[a.center=1]="center",a[a.bottom=2]="bottom"})(Lb||(Lb={}));class Yf{constructor(){this.pens=[]}destroy(){this.pens.length=0}addPen(a){return this.pens.push(a),this}get firstPen(){return this.pens[0]}get lastPen(){return this.pens[this.pens.length-1]}hasPen(){return this.pens.length>0}get pensCount(){return this.pens.length}get startIndex(){let a=this.pens[0];return a?a.startIndex:0}get width(){let a=this.lastPen;return a?a.lastX:0}}function Kc(a,b=Array.isArray(a)?[]:{}){se(b);if(Array.isArray(a)){b.length=a.length;for(let c=0,d=a.length;c<d;c++)b[c]=a[c]}else for(let c in a)b[c]=a[c];return b}class Zf{constructor(){this.text="";this.x=0;this.y=0;this.width=0;this.height=0;this.ascent=0;this.prop={};this.newLineMode=ua.none;this.startIndex=0}set(a="",b=0,c=0,d=0,e=0,f=0,g={},j=ua.none,i=0){return this.text=a,this.x=b,this.y=c,this.width=d,this.height=e,this.ascent=f,this.prop=g,this.newLineMode=j,this.startIndex=i,this}clone(){let a=new Zf();return a.set(this.text,this.x,this.y,this.ascent,this.width,this.height,Kc(this.prop),this.newLineMode,this.startIndex),a}get plainText(){return this.newLineMode===ua.raw?`${this.text}
`:this.text}get wrapText(){return this.newLineMode!==ua.none?`${this.text}
`:this.text}get plainTextLength(){let a=this.text.length;return this.newLineMode===ua.raw&&(a+=1),a}get endIndex(){return this.startIndex+this.plainTextLength}get lastX(){return this.x+this.width}get isTextPen(){return this.text!==""}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}}class Jc{constructor({penPool:a}){this.pens=[];this.lines=[];this.pens=[],this.lines=[],this.penPool=a}destroy(){this.freePens()}freePens(){return this.penPool.pushMultiple(this.pens),this.lines.forEach(a=>{a.destroy()}),this.lines.length=0,this.totalLineHeight=0,this}addTextPen(a,b,c,d,e,f,g,j=ua.none){let i=this.penPool.pop();return i==null&&(i=new Zf()),i.set(a,b,c,d,e,f,g,j),this.addPen(i),this}addImagePen(a,b,c,d,e){return this.addTextPen(null,a,b,c,d,0,e,ua.none),this}addNewLinePen(a){let b=this.lastPen;return b&&b.newLineMode===ua.none&&(b.newLineMode=a),this}addPen(a){let b=this.lastPen;b==null?a.startIndex=0:a.startIndex=b.endIndex,this.pens.push(a);let c=this.lastLine;return c==null&&(c=new Yf(),this.lines.push(c)),c.addPen(a),a.newLineMode!==ua.none&&(c=new Yf(),this.lines.push(c)),this}clone(a){return a==null&&(a=new Jc({penPool:this.penPool})),a.freePens(),this.pens.forEach(b=>{a.addPen(b.clone())}),a}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(a){if(a>=this.lines.length)return this.getLineEndIndex(a);{let b=this.lines[a];if(!b)return 0;let c=b.firstPen;return c?c.startIndex:0}}getLineEndIndex(a){let b=this.lines.length;a>=b&&(a=b-1);for(let c=a;c>=0;c--){let d=this.lines[c];if(d&&d.hasPen())return d.lastPen.endIndex}return 0}getLineWidth(a){let b=this.lines[a];return b?b.width:0}getLineHeights(a=[]){return this.lines.forEach(function(b){a.push(b.height)}),a}get lineCount(){return this.lines.length}get plainText(){let a=[],b=this.pens;for(let c=0,d=b.length;c<d;c++)a.push(b[c].plainText);return a.join()}get plainTextLength(){let a=0;for(let b=0,c=this.pens.length;b<c;b++)a+=this.pens[b].plainTextLength;return a}getSliceTagText(a,b,c=0,d,e=!1){if(d===void 0){let m=this.lastPen;if(!m)return"";d=m.endIndex}let f=[],g;for(var j=0,i=this.pens.length;j<i;j++){let m=this.pens[j],n=m.endIndex;if(n<=c)continue;let u=e?m.wrapText:m.plainText,A=m.prop,B=m.startIndex,E=B>=c&&n<=d;E||(u=u.substring(c-B,d-B)),b?f.push(a.call(b,u,A,g)):f.push(a(u,A,g)),g=A;if(n>=d)break}return f.join()}}function me(a,b){a.font=b.font}function ne(a,b){a.textBaseline="alphabetic",a.textAlign="start",a.fillStyle=b.fillStyle,a.strokeStyle=b.strokeStyle,a.lineWidth=b.strokeThickness,a.lineCap="round",a.lineJoin="round",a.imageSmoothingEnabled=b.antialias}function Wf(a,b,c){c?(a.shadowOffsetX=b.shadowOffsetX,a.shadowOffsetY=b.shadowOffsetY,a.shadowColor=b.shadowColor,a.shadowBlur=b.shadowBlur):(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowColor="#000",a.shadowBlur=0)}function Hk(a,b){return b.measureText(a).width}function Ik(a,b,c=0){let d=b.measureText(a),e=d.actualBoundingBoxAscent,f=d.actualBoundingBoxDescent;return(!e&&!f||a==="")&&(e=c,f=0),oe.ascent=e,oe.descent=f,oe.height=Math.ceil(Math.abs(e)+Math.abs(f)),oe}let oe={ascent:0,descent:0,height:0};function Ck(a,b,c,d,e){a.freePens();if(b==="")return a;let f=c.canvas,g=c.context,j=c.parent,i=c.parser.splitText(b),m,n,u=0;for(var A=0,B=i.length;A<B;A++){let _=c.parser.tagTextToProp(i[A],m),Y=_.text;m=_.prop;if(m.img){let M,q;c.imageManager?(M=c.imageManager.getOuterWidth(m.img),q=c.imageManager.getOuterHeight(m.img)):(M=0,q=0),e>0&&d!==Pa.none&&(e<u+M&&(a.addNewLinePen(ua.wrapped),u=0)),a.addImagePen(u,0,M,q,Kc(m)),u+=M}else if(Y!==""){g.save();let M=c.parser.propToStyle(j,m);me(g,M),ne(g,M);let q=M.strokeThickness,r=q/2;n=Jk(Y,Hk,g,d,e,u);let h=Ik("|MÃq",g);for(let l=0,k=n.length;l<k;l++){let p=n[l],t=h.height+q,o=h.ascent+r;a.addTextPen(p.text,u,0,p.width,t,o,Kc(m),p.newLineMode),p.newLineMode!==ua.none?u=0:u+=p.width}g.restore()}}let E=a.lines,G=c.parent.lineSpacing,H=0,K=0,I=0,N=0,L=0;for(let _=0,Y=E.length;_<Y;_++){const M=E[_],q=M.pens,r=q.length;H=0,K=0;for(let h=0;h<r;h++){const l=q[h];H=Math.max(H,l.height),K=Math.max(K,l.ascent)}I=L+K;for(let h=0;h<r;h++)q[h].y+=I;M.y=I,M.height=H,N=Math.max(N,M.width),L+=H+G}return a.maxLineWidth=N,a.totalLineHeight=L-G,a}const bh={PI2:Math.PI*2,HALF_PI:Math.PI*.5,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};class kn extends Fa{constructor(a,b,c,d,e){super(a,b,c,d);this.name=e}}class Ek{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return this.hitAreas.length=0,this}add(a,b,c,d,e){let f=new kn(b,c,d,e,a);return this.hitAreas.push(f),this}getFirstHitArea(a,b){for(let c=0,d=this.hitAreas.length;c<d;c++){let e=this.hitAreas[c];if(e.contains(a,b))return e}return null}}function Dk(a,b=0,c=0,d=a.textWidth,e=a.textHeight,f=a.penManager){a.hitAreaManager&&a.hitAreaManager.clear();let g=f.totalLineHeight;if(g===0)return;let j=a.context;j.save();let i=a.parent;fn(a,i),b+=a.startXOffset,c+=a.startYOffset;let m=i.halign,n=i.valign,u=c;switch(n){case Lb.center:u+=(e-g)/2;break;case Lb.bottom:u+=e-g-2;break}let A=f.lines;for(let B=0,E=A.length;B<E;B++){let G=A[B],H=G.width;if(H===0)continue;let K=b;switch(m){case Kb.center:K+=(d-H)/2;break;case Kb.right:K+=d-H;break}let I=G.pens;for(let N=0,L=I.length;N<L;N++)en(a,I[N],K,u)}j.restore()}function en(a,b,c,d){c+=b.x,d+=b.y;let e=a.canvas,f=a.context,g=a.parent;f.save();let j=a.parser.propToStyle(g,b.prop);me(f,j),ne(f,j),j.underlineThickness>0&&b.width>0&&gn(a,c,d,b.width,j),b.isTextPen&&hn(a,c,d,b.text,j),b.isImagePen&&jn(a,c,d,b.prop.img,j),f.restore(),b.hasAreaMarker&&b.width>0&&(a.hitAreaManager||(a.hitAreaManager=new Ek()),a.hitAreaManager.add(b.prop.area,c,d-a.startYOffset,b.width,b.height))}function fn(a,b){let c=a.canvas,d=a.context;const e=b.backgroundFillStyle,f=b.backgroundStrokeStyle;if(e||f){const g=b.backgroundStrokeThickness,j=g/2,i=b.cornerRadius,m=j,n=j,u=c.width-g,A=c.height-g;Xf(c,d,m,n,u,A,i,e,f,g)}else d.clearRect(0,0,c.width,c.height)}function gn(a,b,c,d,e){c+=e.underlineOffset-e.underlineThickness/2;let f=a.context,g=f.lineCap;f.lineCap="butt",f.beginPath(),f.strokeStyle=e.underlineStyle,f.lineWidth=e.underlineThickness,f.moveTo(b,c),f.lineTo(b+d,c),f.stroke(),f.lineCap=g}function hn(a,b,c,d,e){let f=a.context;e.strokeThickness&&(Wf(f,e,e.shadowStroke),f.strokeText(d,b,c)),e.fillStyle&&e.fillStyle!=="none"&&(Wf(f,e,e.shadowFill),f.fillText(d,b,c))}function jn(a,b,c,d,e){let f=a.imageManager;if(!f)return;let g=f.get(d),j=f.getFrame(d);b+=g.left,c+=-a.startYOffset+g.y;let i=a.context;i.drawImage(j.texture.image,j.x,j.y,j.width,j.height,b,c,g.width,g.height)}class xk{constructor({canvas:a,context:b,parent:c,parser:d,penPool:e=new Mb()}){this.canvas=a,this.context=b,this.parser=d,this.parent=c,this.penPool=e,this.penManager=new Jc({penPool:e})}destroy(){this.canvas=null,this.context=null,this.parser=null,this.parent=null,this.penManager&&(this.penManager.destroy(),this.penManager=null),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=null),this.imageManager&&(this.imageManager.destroy(),this.imageManager=null),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=null)}get textWidth(){return this.penManager.maxLineWidth}get textHeight(){return this.penManager.totalLineHeight}updatePenManager(a,b,c,d=this.penManager){return Ck(d,a,this,b,c)}draw(a=0,b=0,c=this.textWidth,d=this.textHeight){return Dk(this,a,b,c,d,this.penManager),this}get startXOffset(){let a=this.parent.strokeStyle,b=this.parent.strokeThickness;return a!=null&&b!=null?b/2:0}get startYOffset(){let a=this.parent.strokeStyle,b=this.parent.strokeThickness;return a!=null&&b!=null?b/2:0}get lines(){return this.penManager.lines}get tmpPenManager(){return this._tmpPenManager===null&&(this._tmpPenManager=new Jc({penPool:this.penPool})),this._tmpPenManager}getPlainText(a,b,c){let d;return a==null?d=this.penManager.plainText:d=this.parser.splitText(a,!0).join(""),(b!=null||c!=null)&&(b==null&&(b=0),c==null&&(c=d.length),d=d.substring(b,c)),d}getPenManager(a,b){return a===void 0?this.clonePenManager(b,this.penManager):(b===void 0&&(b=new Jc({penPool:this.penPool})),this.updatePenManager(a,this.parent.wrapMode,this.parent.wrapWidth,b),b)}getText(a,b,c,d){if(a==null)return this.penManager.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d);let e=this.tmpPenManager;return this.updatePenManager(a,this.parent.wrapMode,this.parent.wrapWidth,e),e.getSliceTagText(this.parser.propToTagText,this.parser,b,c,d)}clonePenManager(a,b=this.penManager){return b.clone(a)}getLastPen(a=this.penManager){return a.lastPen}}function yk(a){let b=a.canvasText;a.canvasText.updatePenManager(a.text,a.wrapMode,a.wrapWidth);let c=a.padding,d,e,f,g;a.fixedWidth===0?(d=b.textWidth,f=d+c.left+c.right):(f=a.fixedWidth,d=f-c.left-c.right,d<b.textWidth&&(d=b.textWidth)),a.fixedHeight===0?(e=b.textHeight,g=e+c.top+c.bottom):(g=a.fixedHeight,e=g-c.top-c.bottom,e<b.textHeight&&(e=b.textHeight));let j=a.resolution,i=Math.ceil(f*j),m=Math.ceil(g*j),n=a.canvas;(n.width!==i||n.height!==m)&&(n.width=i,n.height=m,a.texture.setSize(f,g),a.setSize(f,g));let u=a.context;u.save(),u.scale(j,j),b.draw(c.left,c.top,d,e),u.restore(),a.texture.binding&&a.texture.binding.update(),a.setDirty(aa.TEXTURE)}function Sf(a,b,c,d=0,e=0){c||(d=0),a.backgroundFillStyle=b,a.backgroundStrokeStyle=c,a.backgroundStrokeThickness=d,a.cornerRadius=e}function zk(a,b,c){b&&Tf(a,b),c&&Uf(a,c)}function Tf(a,b){a.fontFamily=b}function Uf(a,b){typeof b==="number"&&(b=`${b}px`),a.fontSize=b}function Ak(a,b,c){a.fixedWidth=b,a.fixedHeight=c;if(a.wrapMode!==Pa.none){const d=a.padding;let e=b-d.left-d.right;a.wrapWidth=Math.max(e,0)}}function Vf(a,b,c,d,e){const f=a.padding;if(typeof b==="number")f.left=b,f.right=c===void 0?b:c,f.top=d===void 0?b:d,f.bottom=e===void 0?b:e;else{let g=b;f.left=g.left||0,f.right=g.right||0,f.top=g.top||0,f.bottom=g.bottom||0}}class Bk extends $c{constructor(a,b,c="",{backgroundFillStyle:d,backgroundStrokeStyle:e,backgroundStrokeThickness:f,cornerRadius:g=0,padding:j,fontStyle:i,fontFamily:m,fontSize:n,fillStyle:u,strokeStyle:A}={},B){super(a,b,Ub());this.antialias=!1;this.fontFamily="monospace";this.fontSize="16px";this.fillStyle="#fff";this.halign=Kb.left;this.valign=Lb.top;this.lineSpacing=0;this.wrapMode=Pa.none;this.wrapWidth=0;this.fixedWidth=0;this.fixedHeight=0;this.padding={left:0,right:0,top:0,bottom:0};this.type="rexText";const E=wa.get();this.resolution=E.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.canvasText=new xk({canvas:this.canvas,context:this.context,parent:this,parser:B}),Sf(this,d,e,f,g),j&&Vf(this,j),m&&Tf(this,m),n&&Uf(this,n),u&&(this.fillStyle=u),this.setText(c)}destroy(a){this.texture.destroy(),this.canvas=null,this.context=null,super.destroy(a)}updateText(){return yk(this),this}get text(){return this._text}set text(a){this.setText(a)}setText(a="",b=!0){return Array.isArray(a)&&(a=a.join(`
`)),a!==this._text&&(this._text=a.toString(),b&&this.updateText()),this}setBackgroundStyle(a,b,c=2,d=0){return Sf(this,a,b,c,d),this}setFont(a,b){return zk(this,a,b),this}setFixedSize(a,b){return Ak(this,a,b),this}setPadding(a,b,c,d){return Vf(this,a,b,c,d),this}}class Fk{}const Gk={font:void 0,fontFamily:void 0,fontStyle:void 0,fontSize:void 0,fillStyle:void 0,strokeStyle:void 0,strokeThickness:void 0,shadowColor:void 0,shadowOffsetX:void 0,shadowOffsetY:void 0,shadowBlur:void 0,shadowStroke:void 0,shadowFill:void 0,underlineStyle:void 0,underlineThickness:void 0,underlineOffset:void 0,image:void 0};class Kk extends Fk{splitText(a,b=!1){let c=[],d=0;for(;;){const f=_f.exec(a);if(!f)break;const g=f[0],j=_f.lastIndex-g.length;d<j&&c.push(a.substring(d,j)),b||c.push(g),d=_f.lastIndex}let e=a.length;return d<e&&c.push(a.substring(d,e)),c}tagTextToProp(a,b){let c,d;b==null&&(b={}),b.img&&va(b,cb,"img"),on.test(a)?(va(b,Va,"b",!0),c=""):pn.test(a)?(va(b,cb,"b"),c=""):qn.test(a)?(va(b,Va,"i",!0),c=""):rn.test(a)?(va(b,cb,"i"),c=""):Lk.test(a)?(d=a.match(Lk),va(b,Va,"size",d[1]+"px"),c=""):sn.test(a)?(va(b,cb,"size"),c=""):Mk.test(a)?(d=a.match(Mk),va(b,Va,"color",d[1]),c=""):tn.test(a)?(va(b,cb,"color"),c=""):Nk.test(a)?(d=a.match(Nk),va(b,Va,"u",!0),c=""):Ok.test(a)?(d=a.match(Ok),va(b,Va,"u",d[1]),c=""):un.test(a)?(va(b,cb,"u"),c=""):vn.test(a)?(va(b,Va,"shadow",!0),c=""):wn.test(a)?(va(b,cb,"shadow"),c=""):xn.test(a)?(va(b,Va,"stroke",!0),c=""):Pk.test(a)?(d=a.match(Pk),va(b,Va,"stroke",d[1]),c=""):yn.test(a)?(va(b,cb,"stroke"),c=""):Qk.test(a)?(d=a.match(Qk),va(b,Va,"img",d[1]),c=""):zn.test(a)?(va(b,cb,"img"),c=""):Rk.test(a)?(d=a.match(Rk),va(b,Va,"area",d[1]),c=""):An.test(a)?(va(b,cb,"area"),c=""):c=a;let e=mn;return e.text=c,e.prop=b,e}propToStyle(a,b){let c=Gk;return b.hasOwnProperty("img")?c.image=b.img:(c.image=null,c.fontFamily=a.fontFamily,b.hasOwnProperty("size")?c.fontSize=b.size:c.fontSize=a.fontSize,c.fontStyle=ln(b.b,b.i),c.font=`${c.fontStyle} ${c.fontSize} ${c.fontFamily}`,b.hasOwnProperty("color")?c.fillStyle=b.color:c.fillStyle=a.fillStyle,b.hasOwnProperty("stroke")?b.stroke===!0?(c.strokeStyle=a.strokeStyle,c.strokeThickness=a.strokeThickness):(c.strokeStyle=b.stroke,c.strokeThickness=a.strokeThickness):(c.strokeStyle=a.strokeStyle,c.strokeThickness=0)),b.hasOwnProperty("shadow")?b.shadow===!0?(c.shadowColor=a.shadowColor,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor=b.shadow,c.shadowOffsetX=a.shadowOffsetX,c.shadowOffsetY=a.shadowOffsetY,c.shadowBlur=a.shadowBlur,c.shadowStroke=!0,c.shadowFill=!0):(c.shadowColor="#000",c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=0,c.shadowStroke=!1,c.shadowFill=!1),b.hasOwnProperty("u")?b.u===!0?(c.underlineStyle=a.underlineStyle,c.underlineThickness=a.underlineThickness,c.underlineOffset=a.underlineOffset):(c.underlineStyle=b.u,c.underlineThickness=a.underlineThickness,c.underlineOffset=a.underlineOffset):(c.underlineStyle="#000",c.underlineThickness=0,c.underlineOffset=0),c}propToTagText(a,b,c){c==null&&(c=nn);let d=[];for(const f in c){if(b.hasOwnProperty(f))continue;d.push(`[/${f}]`)}a=`${d.join()}${a}`;let e=[];for(const f in b){if(c[f]===b[f])continue;switch(f){case"size":const g=b.size.replace("px","");e.push(`[size=${g}]`);break;case"color":case"img":case"area":e.push(`[${f}=${b[f]}]`);break;case"stroke":case"u":b[f]===!0?e.push(`[${f}]`):e.push(`[${f}=${b[f]}]`);break;default:e.push(`[${f}]`);break}}return a=`${a}${e.join()}`,a}}const va=function(a,b,c,d){return b===Va?a[c]=d:a.hasOwnProperty(c)&&delete a[c],a};var ln=function(a,b){return a&&b?"bold italic":a?"bold":b?"italic":""};const mn={text:null,prop:null},nn={},_f=/\[b\]|\[\/b\]|\[i\]|\[\/i\]|\[size=(\d+)\]|\[\/size\]|\[color=([a-z]+|#[0-9abcdef]+)\]|\[\/color\]|\[u\]|\[u=([a-z]+|#[0-9abcdef]+)\]|\[\/u\]|\[shadow\]|\[\/shadow\]|\[stroke\]|\[stroke=([a-z]+|#[0-9abcdef]+)\]|\[\/stroke\]|\[img=([^\]]+)\]|\[\/img\]|\[area=([^\]]+)\]|\[\/area\]/ig;var on=/\[b\]/i,pn=/\[\/b\]/i,qn=/\[i\]/i,rn=/\[\/i\]/i,Lk=/\[size=(\d+)\]/i,sn=/\[\/size\]/i,Mk=/\[color=([a-z]+|#[0-9abcdef]+)\]/i,tn=/\[\/color\]/i,Nk=/\[u\]/i,Ok=/\[u=([a-z]+|#[0-9abcdef]+)\]/i,un=/\[\/u\]/i,vn=/\[shadow\]/i,wn=/\[\/shadow\]/i,xn=/\[stroke\]/i,Pk=/\[stroke=([a-z]+|#[0-9abcdef]+)\]/i,yn=/\[\/stroke\]/i,Qk=/\[img=([^\]]+)\]/i,zn=/\[\/img\]/i,Rk=/\[area=([^\]]+)\]/i,An=/\[\/area\]/i;const cb=!1,Va=!0;class Pc extends Bk{constructor(a,b,c="",d){super(a,b,c,d,new Kk());this.type="rexBBcodeText"}}var wf;(function(a){a[a.ascending=0]="ascending",a[a.descending=1]="descending",a[a.logical_ascending=2]="logical_ascending",a[a.logical_descending=3]="logical_descending"})(wf||(wf={}));class kl extends og{constructor(){super();const a=`[color=red][size=30]Phaser\r
[color=blue][size=20]is\r
[size=40][color=green]Fun[/color]`,b=new Pc(400,300,a,{backgroundStrokeStyle:"BurlyWood",backgroundStrokeThickness:4,cornerRadius:20,padding:10,fontFamily:"monospace",fontSize:40}),c=new Ae(this);Oc(c,b)}}new ng(ze(),ye(800,600),we("game"),ve(2960685),xe(kl));})();
/* @license
Papa Parse
v5.2.0
https://github.com/mholt/PapaParse
License: MIT
*/
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
//# sourceMappingURL=bundle.js.map
